#ifdef __GNUC__
#pragma GCC diagnostic ignored "-Wunused-function"
#pragma GCC diagnostic ignored "-Wunused-variable"
#pragma GCC diagnostic ignored "-Wparentheses"
#pragma GCC diagnostic ignored "-Wunused-label"
#endif
#ifdef __clang__
#pragma clang diagnostic ignored "-Wunused-function"
#pragma clang diagnostic ignored "-Wunused-variable"
#pragma clang diagnostic ignored "-Wparentheses"
#pragma clang diagnostic ignored "-Wunused-label"
#endif
// Headers

#define _GNU_SOURCE
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#define CL_TARGET_OPENCL_VERSION 120
#define CL_USE_DEPRECATED_OPENCL_1_2_APIS
#ifdef __APPLE__
#define CL_SILENCE_DEPRECATION
#include <OpenCL/cl.h>
#else
#include <CL/cl.h>
#endif


// Initialisation

int futhark_get_num_sizes(void);
const char *futhark_get_size_name(int);
const char *futhark_get_size_class(int);
struct futhark_context_config ;
struct futhark_context_config *futhark_context_config_new(void);
void futhark_context_config_free(struct futhark_context_config *cfg);
void futhark_context_config_add_build_option(struct futhark_context_config *cfg,
                                             const char *opt);
void futhark_context_config_set_debugging(struct futhark_context_config *cfg,
                                          int flag);
void futhark_context_config_set_profiling(struct futhark_context_config *cfg,
                                          int flag);
void futhark_context_config_set_logging(struct futhark_context_config *cfg,
                                        int flag);
void futhark_context_config_set_device(struct futhark_context_config *cfg, const
                                       char *s);
void futhark_context_config_set_platform(struct futhark_context_config *cfg,
                                         const char *s);
void
futhark_context_config_select_device_interactively(struct futhark_context_config *cfg);
void futhark_context_config_list_devices(struct futhark_context_config *cfg);
void futhark_context_config_dump_program_to(struct futhark_context_config *cfg,
                                            const char *path);
void
futhark_context_config_load_program_from(struct futhark_context_config *cfg,
                                         const char *path);
void futhark_context_config_dump_binary_to(struct futhark_context_config *cfg,
                                           const char *path);
void futhark_context_config_load_binary_from(struct futhark_context_config *cfg,
                                             const char *path);
void
futhark_context_config_set_default_group_size(struct futhark_context_config *cfg,
                                              int size);
void
futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg,
                                              int num);
void
futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg,
                                             int num);
void
futhark_context_config_set_default_threshold(struct futhark_context_config *cfg,
                                             int num);
int futhark_context_config_set_size(struct futhark_context_config *cfg, const
                                    char *size_name, size_t size_value);
struct futhark_context ;
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg);
struct futhark_context
*futhark_context_new_with_command_queue(struct futhark_context_config *cfg,
                                        cl_command_queue queue);
void futhark_context_free(struct futhark_context *ctx);
cl_command_queue futhark_context_get_command_queue(struct futhark_context *ctx);

// Arrays

struct futhark_f32_1d ;
struct futhark_f32_1d *futhark_new_f32_1d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0);
struct futhark_f32_1d *futhark_new_raw_f32_1d(struct futhark_context *ctx, const
                                              cl_mem data, int offset,
                                              int64_t dim0);
int futhark_free_f32_1d(struct futhark_context *ctx,
                        struct futhark_f32_1d *arr);
int futhark_values_f32_1d(struct futhark_context *ctx,
                          struct futhark_f32_1d *arr, float *data);
cl_mem futhark_values_raw_f32_1d(struct futhark_context *ctx,
                                 struct futhark_f32_1d *arr);
const int64_t *futhark_shape_f32_1d(struct futhark_context *ctx,
                                    struct futhark_f32_1d *arr);

// Opaque values


// Entry points

int futhark_entry_main(struct futhark_context *ctx, float *out0,
                       struct futhark_f32_1d **out1, const int64_t in0, const
                       int64_t in1, const float in2, const int64_t in3, const
                       float in4, const float in5, const float in6, const
                       float in7, const float in8);

// Miscellaneous

int futhark_context_sync(struct futhark_context *ctx);
int futhark_context_clear_caches(struct futhark_context *ctx);
char *futhark_context_report(struct futhark_context *ctx);
char *futhark_context_get_error(struct futhark_context *ctx);
void futhark_context_pause_profiling(struct futhark_context *ctx);
void futhark_context_unpause_profiling(struct futhark_context *ctx);
#define FUTHARK_BACKEND_opencl
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <math.h>
#include <stdint.h>
#undef NDEBUG
#include <assert.h>
#include <stdarg.h>
// Start of util.h.
//
// Various helper functions that are useful in all generated C code.

#include <errno.h>
#include <string.h>

static const char *fut_progname = "(embedded Futhark)";

static void futhark_panic(int eval, const char *fmt, ...) {
  va_list ap;
  va_start(ap, fmt);
  fprintf(stderr, "%s: ", fut_progname);
  vfprintf(stderr, fmt, ap);
  va_end(ap);
  exit(eval);
}

// For generating arbitrary-sized error messages.  It is the callers
// responsibility to free the buffer at some point.
static char* msgprintf(const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = 1 + (size_t)vsnprintf(NULL, 0, s, vl);
  char *buffer = (char*) malloc(needed);
  va_start(vl, s); // Must re-init.
  vsnprintf(buffer, needed, s, vl);
  return buffer;
}


static inline void check_err(int errval, int sets_errno, const char *fun, int line,
                            const char *msg, ...)
{
  if (errval) {
    char str[256];
    char errnum[10];
    sprintf(errnum, "%d", errval);
    sprintf(str, "ERROR: %s in %s() at line %d with error code %s\n", msg, fun, line,
            sets_errno ? strerror(errno) : errnum);
    fprintf(stderr, "%s", str);
    exit(errval);
  }
}

#define CHECK_ERR(err, msg...) check_err(err, 0, __func__, __LINE__, msg)
#define CHECK_ERRNO(err, msg...) check_err(err, 1, __func__, __LINE__, msg)

// Read a file into a NUL-terminated string; returns NULL on error.
static void* slurp_file(const char *filename, size_t *size) {
  unsigned char *s;
  FILE *f = fopen(filename, "rb"); // To avoid Windows messing with linebreaks.
  if (f == NULL) return NULL;
  fseek(f, 0, SEEK_END);
  size_t src_size = ftell(f);
  fseek(f, 0, SEEK_SET);
  s = (unsigned char*) malloc(src_size + 1);
  if (fread(s, 1, src_size, f) != src_size) {
    free(s);
    s = NULL;
  } else {
    s[src_size] = '\0';
  }
  fclose(f);

  if (size) {
    *size = src_size;
  }

  return s;
}

// Dump 'n' bytes from 'buf' into the file at the designated location.
// Returns 0 on success.
static int dump_file(const char *file, const void *buf, size_t n) {
  FILE *f = fopen(file, "w");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(buf, sizeof(char), n, f) != n) {
    return 1;
  }

  if (fclose(f) != 0) {
    return 1;
  }

  return 0;
}

struct str_builder {
  char *str;
  size_t capacity; // Size of buffer.
  size_t used; // Bytes used, *not* including final zero.
};

static void str_builder_init(struct str_builder *b) {
  b->capacity = 10;
  b->used = 0;
  b->str = malloc(b->capacity);
  b->str[0] = 0;
}

static void str_builder(struct str_builder *b, const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = (size_t)vsnprintf(NULL, 0, s, vl);

  while (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }

  va_start(vl, s); // Must re-init.
  vsnprintf(b->str+b->used, b->capacity-b->used, s, vl);
  b->used += needed;
}

// End of util.h.

// Start of timing.h.

// The function get_wall_time() returns the wall time in microseconds
// (with an unspecified offset).

#ifdef _WIN32

#include <windows.h>

static int64_t get_wall_time(void) {
  LARGE_INTEGER time,freq;
  assert(QueryPerformanceFrequency(&freq));
  assert(QueryPerformanceCounter(&time));
  return ((double)time.QuadPart / freq.QuadPart) * 1000000;
}

#else
// Assuming POSIX

#include <time.h>
#include <sys/time.h>

static int64_t get_wall_time(void) {
  struct timeval time;
  assert(gettimeofday(&time,NULL) == 0);
  return time.tv_sec * 1000000 + time.tv_usec;
}

static int64_t get_wall_time_ns(void) {
  struct timespec time;
  assert(clock_gettime(CLOCK_REALTIME, &time) == 0);
  return time.tv_sec * 1000000000 + time.tv_nsec;
}


static inline uint64_t rdtsc() {
  unsigned int hi, lo;
  __asm__ __volatile__("rdtsc" : "=a"(lo), "=d"(hi));
  return  ((uint64_t) lo) | (((uint64_t) hi) << 32);
}

static inline void rdtsc_wait(uint64_t n) {
  const uint64_t start = rdtsc();
  while (rdtsc() < (start + n)) {
    __asm__("PAUSE");
  }
}
static inline void spin_for(uint64_t nb_cycles) {
  rdtsc_wait(nb_cycles);
}


#endif

// End of timing.h.

#include <string.h>
#include <inttypes.h>
#include <errno.h>
#include <ctype.h>
#include <errno.h>
#include <getopt.h>
// Start of values.h.

//// Text I/O

typedef int (*writer)(FILE*, const void*);
typedef int (*bin_reader)(void*);
typedef int (*str_reader)(const char *, void*);

struct array_reader {
  char* elems;
  int64_t n_elems_space;
  int64_t elem_size;
  int64_t n_elems_used;
  int64_t *shape;
  str_reader elem_reader;
};

static void skipspaces() {
  int c;
  do {
    c = getchar();
  } while (isspace(c));

  if (c != EOF) {
    ungetc(c, stdin);
  }
}

static int constituent(char c) {
  return isalnum(c) || c == '.' || c == '-' || c == '+' || c == '_';
}

// Produces an empty token only on EOF.
static void next_token(char *buf, int bufsize) {
 start:
  skipspaces();

  int i = 0;
  while (i < bufsize) {
    int c = getchar();
    buf[i] = (char)c;

    if (c == EOF) {
      buf[i] = 0;
      return;
    } else if (c == '-' && i == 1 && buf[0] == '-') {
      // Line comment, so skip to end of line and start over.
      for (; c != '\n' && c != EOF; c = getchar());
      goto start;
    } else if (!constituent((char)c)) {
      if (i == 0) {
        // We permit single-character tokens that are not
        // constituents; this lets things like ']' and ',' be
        // tokens.
        buf[i+1] = 0;
        return;
      } else {
        ungetc(c, stdin);
        buf[i] = 0;
        return;
      }
    }

    i++;
  }

  buf[bufsize-1] = 0;
}

static int next_token_is(char *buf, int bufsize, const char* expected) {
  next_token(buf, bufsize);
  return strcmp(buf, expected) == 0;
}

static void remove_underscores(char *buf) {
  char *w = buf;

  for (char *r = buf; *r; r++) {
    if (*r != '_') {
      *w++ = *r;
    }
  }

  *w++ = 0;
}

static int read_str_elem(char *buf, struct array_reader *reader) {
  int ret;
  if (reader->n_elems_used == reader->n_elems_space) {
    reader->n_elems_space *= 2;
    reader->elems = (char*) realloc(reader->elems,
                                    (size_t)(reader->n_elems_space * reader->elem_size));
  }

  ret = reader->elem_reader(buf, reader->elems + reader->n_elems_used * reader->elem_size);

  if (ret == 0) {
    reader->n_elems_used++;
  }

  return ret;
}

static int read_str_array_elems(char *buf, int bufsize,
                                struct array_reader *reader, int64_t dims) {
  int ret;
  int first = 1;
  char *knows_dimsize = (char*) calloc((size_t)dims, sizeof(char));
  int cur_dim = dims-1;
  int64_t *elems_read_in_dim = (int64_t*) calloc((size_t)dims, sizeof(int64_t));

  while (1) {
    next_token(buf, bufsize);

    if (strcmp(buf, "]") == 0) {
      if (knows_dimsize[cur_dim]) {
        if (reader->shape[cur_dim] != elems_read_in_dim[cur_dim]) {
          ret = 1;
          break;
        }
      } else {
        knows_dimsize[cur_dim] = 1;
        reader->shape[cur_dim] = elems_read_in_dim[cur_dim];
      }
      if (cur_dim == 0) {
        ret = 0;
        break;
      } else {
        cur_dim--;
        elems_read_in_dim[cur_dim]++;
      }
    } else if (strcmp(buf, ",") == 0) {
      next_token(buf, bufsize);
      if (strcmp(buf, "[") == 0) {
        if (cur_dim == dims - 1) {
          ret = 1;
          break;
        }
        first = 1;
        cur_dim++;
        elems_read_in_dim[cur_dim] = 0;
      } else if (cur_dim == dims - 1) {
        ret = read_str_elem(buf, reader);
        if (ret != 0) {
          break;
        }
        elems_read_in_dim[cur_dim]++;
      } else {
        ret = 1;
        break;
      }
    } else if (strlen(buf) == 0) {
      // EOF
      ret = 1;
      break;
    } else if (first) {
      if (strcmp(buf, "[") == 0) {
        if (cur_dim == dims - 1) {
          ret = 1;
          break;
        }
        cur_dim++;
        elems_read_in_dim[cur_dim] = 0;
      } else {
        ret = read_str_elem(buf, reader);
        if (ret != 0) {
          break;
        }
        elems_read_in_dim[cur_dim]++;
        first = 0;
      }
    } else {
      ret = 1;
      break;
    }
  }

  free(knows_dimsize);
  free(elems_read_in_dim);
  return ret;
}

static int read_str_empty_array(char *buf, int bufsize,
                                const char *type_name, int64_t *shape, int64_t dims) {
  if (strlen(buf) == 0) {
    // EOF
    return 1;
  }

  if (strcmp(buf, "empty") != 0) {
    return 1;
  }

  if (!next_token_is(buf, bufsize, "(")) {
    return 1;
  }

  for (int i = 0; i < dims; i++) {
    if (!next_token_is(buf, bufsize, "[")) {
      return 1;
    }

    next_token(buf, bufsize);

    if (sscanf(buf, "%"SCNu64, (uint64_t*)&shape[i]) != 1) {
      return 1;
    }

    if (!next_token_is(buf, bufsize, "]")) {
      return 1;
    }
  }

  if (!next_token_is(buf, bufsize, type_name)) {
    return 1;
  }


  if (!next_token_is(buf, bufsize, ")")) {
    return 1;
  }

  // Check whether the array really is empty.
  for (int i = 0; i < dims; i++) {
    if (shape[i] == 0) {
      return 0;
    }
  }

  // Not an empty array!
  return 1;
}

static int read_str_array(int64_t elem_size, str_reader elem_reader,
                          const char *type_name,
                          void **data, int64_t *shape, int64_t dims) {
  int ret;
  struct array_reader reader;
  char buf[100];

  int dims_seen;
  for (dims_seen = 0; dims_seen < dims; dims_seen++) {
    if (!next_token_is(buf, sizeof(buf), "[")) {
      break;
    }
  }

  if (dims_seen == 0) {
    return read_str_empty_array(buf, sizeof(buf), type_name, shape, dims);
  }

  if (dims_seen != dims) {
    return 1;
  }

  reader.shape = shape;
  reader.n_elems_used = 0;
  reader.elem_size = elem_size;
  reader.n_elems_space = 16;
  reader.elems = (char*) realloc(*data, (size_t)(elem_size*reader.n_elems_space));
  reader.elem_reader = elem_reader;

  ret = read_str_array_elems(buf, sizeof(buf), &reader, dims);

  *data = reader.elems;

  return ret;
}

#define READ_STR(MACRO, PTR, SUFFIX)                                   \
  remove_underscores(buf);                                              \
  int j;                                                                \
  if (sscanf(buf, "%"MACRO"%n", (PTR*)dest, &j) == 1) {                 \
    return !(strcmp(buf+j, "") == 0 || strcmp(buf+j, SUFFIX) == 0);     \
  } else {                                                              \
    return 1;                                                           \
  }

static int read_str_i8(char *buf, void* dest) {
  // Some platforms (WINDOWS) does not support scanf %hhd or its
  // cousin, %SCNi8.  Read into int first to avoid corrupting
  // memory.
  //
  // https://gcc.gnu.org/bugzilla/show_bug.cgi?id=63417
  remove_underscores(buf);
  int j, x;
  if (sscanf(buf, "%i%n", &x, &j) == 1) {
    *(int8_t*)dest = (int8_t)x;
    return !(strcmp(buf+j, "") == 0 || strcmp(buf+j, "i8") == 0);
  } else {
    return 1;
  }
}

static int read_str_u8(char *buf, void* dest) {
  // Some platforms (WINDOWS) does not support scanf %hhd or its
  // cousin, %SCNu8.  Read into int first to avoid corrupting
  // memory.
  //
  // https://gcc.gnu.org/bugzilla/show_bug.cgi?id=63417
  remove_underscores(buf);
  int j, x;
  if (sscanf(buf, "%i%n", &x, &j) == 1) {
    *(uint8_t*)dest = (uint8_t)x;
    return !(strcmp(buf+j, "") == 0 || strcmp(buf+j, "u8") == 0);
  } else {
    return 1;
  }
}

static int read_str_i16(char *buf, void* dest) {
  READ_STR(SCNi16, int16_t, "i16");
}

static int read_str_u16(char *buf, void* dest) {
  READ_STR(SCNi16, int16_t, "u16");
}

static int read_str_i32(char *buf, void* dest) {
  READ_STR(SCNi32, int32_t, "i32");
}

static int read_str_u32(char *buf, void* dest) {
  READ_STR(SCNi32, int32_t, "u32");
}

static int read_str_i64(char *buf, void* dest) {
  READ_STR(SCNi64, int64_t, "i64");
}

static int read_str_u64(char *buf, void* dest) {
  // FIXME: This is not correct, as SCNu64 only permits decimal
  // literals.  However, SCNi64 does not handle very large numbers
  // correctly (it's really for signed numbers, so that's fair).
  READ_STR(SCNu64, uint64_t, "u64");
}

static int read_str_f32(char *buf, void* dest) {
  remove_underscores(buf);
  if (strcmp(buf, "f32.nan") == 0) {
    *(float*)dest = NAN;
    return 0;
  } else if (strcmp(buf, "f32.inf") == 0) {
    *(float*)dest = INFINITY;
    return 0;
  } else if (strcmp(buf, "-f32.inf") == 0) {
    *(float*)dest = -INFINITY;
    return 0;
  } else {
    READ_STR("f", float, "f32");
  }
}

static int read_str_f64(char *buf, void* dest) {
  remove_underscores(buf);
  if (strcmp(buf, "f64.nan") == 0) {
    *(double*)dest = NAN;
    return 0;
  } else if (strcmp(buf, "f64.inf") == 0) {
    *(double*)dest = INFINITY;
    return 0;
  } else if (strcmp(buf, "-f64.inf") == 0) {
    *(double*)dest = -INFINITY;
    return 0;
  } else {
    READ_STR("lf", double, "f64");
  }
}

static int read_str_bool(char *buf, void* dest) {
  if (strcmp(buf, "true") == 0) {
    *(char*)dest = 1;
    return 0;
  } else if (strcmp(buf, "false") == 0) {
    *(char*)dest = 0;
    return 0;
  } else {
    return 1;
  }
}

static int write_str_i8(FILE *out, int8_t *src) {
  return fprintf(out, "%hhdi8", *src);
}

static int write_str_u8(FILE *out, uint8_t *src) {
  return fprintf(out, "%hhuu8", *src);
}

static int write_str_i16(FILE *out, int16_t *src) {
  return fprintf(out, "%hdi16", *src);
}

static int write_str_u16(FILE *out, uint16_t *src) {
  return fprintf(out, "%huu16", *src);
}

static int write_str_i32(FILE *out, int32_t *src) {
  return fprintf(out, "%di32", *src);
}

static int write_str_u32(FILE *out, uint32_t *src) {
  return fprintf(out, "%uu32", *src);
}

static int write_str_i64(FILE *out, int64_t *src) {
  return fprintf(out, "%"PRIi64"i64", *src);
}

static int write_str_u64(FILE *out, uint64_t *src) {
  return fprintf(out, "%"PRIu64"u64", *src);
}

static int write_str_f32(FILE *out, float *src) {
  float x = *src;
  if (isnan(x)) {
    return fprintf(out, "f32.nan");
  } else if (isinf(x) && x >= 0) {
    return fprintf(out, "f32.inf");
  } else if (isinf(x)) {
    return fprintf(out, "-f32.inf");
  } else {
    return fprintf(out, "%.6ff32", x);
  }
}

static int write_str_f64(FILE *out, double *src) {
  double x = *src;
  if (isnan(x)) {
    return fprintf(out, "f64.nan");
  } else if (isinf(x) && x >= 0) {
    return fprintf(out, "f64.inf");
  } else if (isinf(x)) {
    return fprintf(out, "-f64.inf");
  } else {
    return fprintf(out, "%.6ff64", *src);
  }
}

static int write_str_bool(FILE *out, void *src) {
  return fprintf(out, *(char*)src ? "true" : "false");
}

//// Binary I/O

#define BINARY_FORMAT_VERSION 2
#define IS_BIG_ENDIAN (!*(unsigned char *)&(uint16_t){1})

static void flip_bytes(int elem_size, unsigned char *elem) {
  for (int j=0; j<elem_size/2; j++) {
    unsigned char head = elem[j];
    int tail_index = elem_size-1-j;
    elem[j] = elem[tail_index];
    elem[tail_index] = head;
  }
}

// On Windows we need to explicitly set the file mode to not mangle
// newline characters.  On *nix there is no difference.
#ifdef _WIN32
#include <io.h>
#include <fcntl.h>
static void set_binary_mode(FILE *f) {
  setmode(fileno(f), O_BINARY);
}
#else
static void set_binary_mode(FILE *f) {
  (void)f;
}
#endif

static int read_byte(void* dest) {
  int num_elems_read = fread(dest, 1, 1, stdin);
  return num_elems_read == 1 ? 0 : 1;
}

//// Types

struct primtype_info_t {
  const char binname[4]; // Used for parsing binary data.
  const char* type_name; // Same name as in Futhark.
  const int64_t size; // in bytes
  const writer write_str; // Write in text format.
  const str_reader read_str; // Read in text format.
};

static const struct primtype_info_t i8_info =
  {.binname = "  i8", .type_name = "i8",   .size = 1,
   .write_str = (writer)write_str_i8, .read_str = (str_reader)read_str_i8};
static const struct primtype_info_t i16_info =
  {.binname = " i16", .type_name = "i16",  .size = 2,
   .write_str = (writer)write_str_i16, .read_str = (str_reader)read_str_i16};
static const struct primtype_info_t i32_info =
  {.binname = " i32", .type_name = "i32",  .size = 4,
   .write_str = (writer)write_str_i32, .read_str = (str_reader)read_str_i32};
static const struct primtype_info_t i64_info =
  {.binname = " i64", .type_name = "i64",  .size = 8,
   .write_str = (writer)write_str_i64, .read_str = (str_reader)read_str_i64};
static const struct primtype_info_t u8_info =
  {.binname = "  u8", .type_name = "u8",   .size = 1,
   .write_str = (writer)write_str_u8, .read_str = (str_reader)read_str_u8};
static const struct primtype_info_t u16_info =
  {.binname = " u16", .type_name = "u16",  .size = 2,
   .write_str = (writer)write_str_u16, .read_str = (str_reader)read_str_u16};
static const struct primtype_info_t u32_info =
  {.binname = " u32", .type_name = "u32",  .size = 4,
   .write_str = (writer)write_str_u32, .read_str = (str_reader)read_str_u32};
static const struct primtype_info_t u64_info =
  {.binname = " u64", .type_name = "u64",  .size = 8,
   .write_str = (writer)write_str_u64, .read_str = (str_reader)read_str_u64};
static const struct primtype_info_t f32_info =
  {.binname = " f32", .type_name = "f32",  .size = 4,
   .write_str = (writer)write_str_f32, .read_str = (str_reader)read_str_f32};
static const struct primtype_info_t f64_info =
  {.binname = " f64", .type_name = "f64",  .size = 8,
   .write_str = (writer)write_str_f64, .read_str = (str_reader)read_str_f64};
static const struct primtype_info_t bool_info =
  {.binname = "bool", .type_name = "bool", .size = 1,
   .write_str = (writer)write_str_bool, .read_str = (str_reader)read_str_bool};

static const struct primtype_info_t* primtypes[] = {
  &i8_info, &i16_info, &i32_info, &i64_info,
  &u8_info, &u16_info, &u32_info, &u64_info,
  &f32_info, &f64_info,
  &bool_info,
  NULL // NULL-terminated
};

// General value interface.  All endian business taken care of at
// lower layers.

static int read_is_binary() {
  skipspaces();
  int c = getchar();
  if (c == 'b') {
    int8_t bin_version;
    int ret = read_byte(&bin_version);

    if (ret != 0) { futhark_panic(1, "binary-input: could not read version.\n"); }

    if (bin_version != BINARY_FORMAT_VERSION) {
      futhark_panic(1, "binary-input: File uses version %i, but I only understand version %i.\n",
            bin_version, BINARY_FORMAT_VERSION);
    }

    return 1;
  }
  ungetc(c, stdin);
  return 0;
}

static const struct primtype_info_t* read_bin_read_type_enum() {
  char read_binname[4];

  int num_matched = scanf("%4c", read_binname);
  if (num_matched != 1) { futhark_panic(1, "binary-input: Couldn't read element type.\n"); }

  const struct primtype_info_t **type = primtypes;

  for (; *type != NULL; type++) {
    // I compare the 4 characters manually instead of using strncmp because
    // this allows any value to be used, also NULL bytes
    if (memcmp(read_binname, (*type)->binname, 4) == 0) {
      return *type;
    }
  }
  futhark_panic(1, "binary-input: Did not recognize the type '%s'.\n", read_binname);
  return NULL;
}

static void read_bin_ensure_scalar(const struct primtype_info_t *expected_type) {
  int8_t bin_dims;
  int ret = read_byte(&bin_dims);
  if (ret != 0) { futhark_panic(1, "binary-input: Couldn't get dims.\n"); }

  if (bin_dims != 0) {
    futhark_panic(1, "binary-input: Expected scalar (0 dimensions), but got array with %i dimensions.\n",
          bin_dims);
  }

  const struct primtype_info_t *bin_type = read_bin_read_type_enum();
  if (bin_type != expected_type) {
    futhark_panic(1, "binary-input: Expected scalar of type %s but got scalar of type %s.\n",
          expected_type->type_name,
          bin_type->type_name);
  }
}

//// High-level interface

static int read_bin_array(const struct primtype_info_t *expected_type, void **data, int64_t *shape, int64_t dims) {
  int ret;

  int8_t bin_dims;
  ret = read_byte(&bin_dims);
  if (ret != 0) { futhark_panic(1, "binary-input: Couldn't get dims.\n"); }

  if (bin_dims != dims) {
    futhark_panic(1, "binary-input: Expected %i dimensions, but got array with %i dimensions.\n",
          dims, bin_dims);
  }

  const struct primtype_info_t *bin_primtype = read_bin_read_type_enum();
  if (expected_type != bin_primtype) {
    futhark_panic(1, "binary-input: Expected %iD-array with element type '%s' but got %iD-array with element type '%s'.\n",
          dims, expected_type->type_name, dims, bin_primtype->type_name);
  }

  int64_t elem_count = 1;
  for (int i=0; i<dims; i++) {
    int64_t bin_shape;
    ret = fread(&bin_shape, sizeof(bin_shape), 1, stdin);
    if (ret != 1) {
      futhark_panic(1, "binary-input: Couldn't read size for dimension %i of array.\n", i);
    }
    if (IS_BIG_ENDIAN) {
      flip_bytes(sizeof(bin_shape), (unsigned char*) &bin_shape);
    }
    elem_count *= bin_shape;
    shape[i] = bin_shape;
  }

  int64_t elem_size = expected_type->size;
  void* tmp = realloc(*data, (size_t)(elem_count * elem_size));
  if (tmp == NULL) {
    futhark_panic(1, "binary-input: Failed to allocate array of size %i.\n",
          elem_count * elem_size);
  }
  *data = tmp;

  int64_t num_elems_read = (int64_t)fread(*data, (size_t)elem_size, (size_t)elem_count, stdin);
  if (num_elems_read != elem_count) {
    futhark_panic(1, "binary-input: tried to read %i elements of an array, but only got %i elements.\n",
          elem_count, num_elems_read);
  }

  // If we're on big endian platform we must change all multibyte elements
  // from using little endian to big endian
  if (IS_BIG_ENDIAN && elem_size != 1) {
    flip_bytes(elem_size, (unsigned char*) *data);
  }

  return 0;
}

static int read_array(const struct primtype_info_t *expected_type, void **data, int64_t *shape, int64_t dims) {
  if (!read_is_binary()) {
    return read_str_array(expected_type->size, (str_reader)expected_type->read_str, expected_type->type_name, data, shape, dims);
  } else {
    return read_bin_array(expected_type, data, shape, dims);
  }
}

static int end_of_input() {
  skipspaces();
  char token[2];
  next_token(token, sizeof(token));
  if (strcmp(token, "") == 0) {
    return 0;
  } else {
    return 1;
  }
}

static int write_str_array(FILE *out,
                           const struct primtype_info_t *elem_type,
                           const unsigned char *data,
                           const int64_t *shape,
                           int8_t rank) {
  if (rank==0) {
    elem_type->write_str(out, (void*)data);
  } else {
    int64_t len = (int64_t)shape[0];
    int64_t slice_size = 1;

    int64_t elem_size = elem_type->size;
    for (int8_t i = 1; i < rank; i++) {
      slice_size *= shape[i];
    }

    if (len*slice_size == 0) {
      printf("empty(");
      for (int64_t i = 0; i < rank; i++) {
        printf("[%"PRIi64"]", shape[i]);
      }
      printf("%s", elem_type->type_name);
      printf(")");
    } else if (rank==1) {
      putchar('[');
      for (int64_t i = 0; i < len; i++) {
        elem_type->write_str(out, (void*) (data + i * elem_size));
        if (i != len-1) {
          printf(", ");
        }
      }
      putchar(']');
    } else {
      putchar('[');
      for (int64_t i = 0; i < len; i++) {
        write_str_array(out, elem_type, data + i * slice_size * elem_size, shape+1, rank-1);
        if (i != len-1) {
          printf(", ");
        }
      }
      putchar(']');
    }
  }
  return 0;
}

static int write_bin_array(FILE *out,
                           const struct primtype_info_t *elem_type,
                           const unsigned char *data,
                           const int64_t *shape,
                           int8_t rank) {
  int64_t num_elems = 1;
  for (int64_t i = 0; i < rank; i++) {
    num_elems *= shape[i];
  }

  fputc('b', out);
  fputc((char)BINARY_FORMAT_VERSION, out);
  fwrite(&rank, sizeof(int8_t), 1, out);
  fputs(elem_type->binname, out);
  if (shape != NULL) {
    fwrite(shape, sizeof(int64_t), (size_t)rank, out);
  }

  if (IS_BIG_ENDIAN) {
    for (int64_t i = 0; i < num_elems; i++) {
      const unsigned char *elem = data+i*elem_type->size;
      for (int64_t j = 0; j < elem_type->size; j++) {
        fwrite(&elem[elem_type->size-j], 1, 1, out);
      }
    }
  } else {
    fwrite(data, (size_t)elem_type->size, (size_t)num_elems, out);
  }

  return 0;
}

static int write_array(FILE *out, int write_binary,
                       const struct primtype_info_t *elem_type,
                       const void *data,
                       const int64_t *shape,
                       const int8_t rank) {
  if (write_binary) {
    return write_bin_array(out, elem_type, data, shape, rank);
  } else {
    return write_str_array(out, elem_type, data, shape, rank);
  }
}

static int read_scalar(const struct primtype_info_t *expected_type, void *dest) {
  if (!read_is_binary()) {
    char buf[100];
    next_token(buf, sizeof(buf));
    return expected_type->read_str(buf, dest);
  } else {
    read_bin_ensure_scalar(expected_type);
    int64_t elem_size = expected_type->size;
    int num_elems_read = fread(dest, (size_t)elem_size, 1, stdin);
    if (IS_BIG_ENDIAN) {
      flip_bytes(elem_size, (unsigned char*) dest);
    }
    return num_elems_read == 1 ? 0 : 1;
  }
}

static int write_scalar(FILE *out, int write_binary, const struct primtype_info_t *type, void *src) {
  if (write_binary) {
    return write_bin_array(out, type, src, NULL, 0);
  } else {
    return type->write_str(out, src);
  }
}

// End of values.h.

#define __private
static int binary_output = 0;
static FILE *runtime_file;
static int perform_warmup = 0;
static int num_runs = 1;
static const char *entry_point = "main";
// Start of tuning.h.

static char* load_tuning_file(const char *fname,
                              void *cfg,
                              int (*set_size)(void*, const char*, size_t)) {
  const int max_line_len = 1024;
  char* line = (char*) malloc(max_line_len);

  FILE *f = fopen(fname, "r");

  if (f == NULL) {
    snprintf(line, max_line_len, "Cannot open file: %s", strerror(errno));
    return line;
  }

  int lineno = 0;
  while (fgets(line, max_line_len, f) != NULL) {
    lineno++;
    char *eql = strstr(line, "=");
    if (eql) {
      *eql = 0;
      int value = atoi(eql+1);
      if (set_size(cfg, line, value) != 0) {
        strncpy(eql+1, line, max_line_len-strlen(line)-1);
        snprintf(line, max_line_len, "Unknown name '%s' on line %d.", eql+1, lineno);
        return line;
      }
    } else {
      snprintf(line, max_line_len, "Invalid line %d (must be of form 'name=int').",
               lineno);
      return line;
    }
  }

  free(line);

  return NULL;
}

// End of tuning.h.

int parse_options(struct futhark_context_config *cfg, int argc,
                  char *const argv[])
{
    int ch;
    static struct option long_options[] = {{"write-runtime-to",
                                            required_argument, NULL, 1},
                                           {"runs", required_argument, NULL, 2},
                                           {"debugging", no_argument, NULL, 3},
                                           {"log", no_argument, NULL, 4},
                                           {"entry-point", required_argument,
                                            NULL, 5}, {"binary-output",
                                                       no_argument, NULL, 6},
                                           {"help", no_argument, NULL, 7},
                                           {"device", required_argument, NULL,
                                            8}, {"default-group-size",
                                                 required_argument, NULL, 9},
                                           {"default-num-groups",
                                            required_argument, NULL, 10},
                                           {"default-tile-size",
                                            required_argument, NULL, 11},
                                           {"default-threshold",
                                            required_argument, NULL, 12},
                                           {"print-sizes", no_argument, NULL,
                                            13}, {"size", required_argument,
                                                  NULL, 14}, {"tuning",
                                                              required_argument,
                                                              NULL, 15},
                                           {"platform", required_argument, NULL,
                                            16}, {"dump-opencl",
                                                  required_argument, NULL, 17},
                                           {"load-opencl", required_argument,
                                            NULL, 18}, {"dump-opencl-binary",
                                                        required_argument, NULL,
                                                        19},
                                           {"load-opencl-binary",
                                            required_argument, NULL, 20},
                                           {"build-option", required_argument,
                                            NULL, 21}, {"profile", no_argument,
                                                        NULL, 22},
                                           {"list-devices", no_argument, NULL,
                                            23}, {0, 0, 0, 0}};
    static char *option_descriptions =
                "  -t/--write-runtime-to FILE Print the time taken to execute the program to the indicated file, an integral number of microseconds.\n  -r/--runs INT              Perform NUM runs of the program.\n  -D/--debugging             Perform possibly expensive internal correctness checks and verbose logging.\n  -L/--log                   Print various low-overhead logging information to stderr while running.\n  -e/--entry-point NAME      The entry point to run. Defaults to main.\n  -b/--binary-output         Print the program result in the binary output format.\n  -h/--help                  Print help information and exit.\n  -d/--device NAME           Use the first OpenCL device whose name contains the given string.\n  --default-group-size INT   The default size of OpenCL workgroups that are launched.\n  --default-num-groups INT   The default number of OpenCL workgroups that are launched.\n  --default-tile-size INT    The default tile size used when performing two-dimensional tiling.\n  --default-threshold INT    The default parallelism threshold.\n  --print-sizes              Print all sizes that can be set with -size or --tuning.\n  --size ASSIGNMENT          Set a configurable run-time parameter to the given value.\n  --tuning FILE              Read size=value assignments from the given file.\n  -p/--platform NAME         Use the first OpenCL platform whose name contains the given string.\n  --dump-opencl FILE         Dump the embedded OpenCL program to the indicated file.\n  --load-opencl FILE         Instead of using the embedded OpenCL program, load it from the indicated file.\n  --dump-opencl-binary FILE  Dump the compiled version of the embedded OpenCL program to the indicated file.\n  --load-opencl-binary FILE  Load an OpenCL binary from the indicated file.\n  --build-option OPT         Add an additional build option to the string passed to clBuildProgram().\n  -P/--profile               Gather profiling data while executing and print out a summary at the end.\n  --list-devices             List all OpenCL devices and platforms available on the system.\n";
    
    while ((ch = getopt_long(argc, argv, ":t:r:DLe:bhd:p:P", long_options,
                             NULL)) != -1) {
        if (ch == 1 || ch == 't') {
            runtime_file = fopen(optarg, "w");
            if (runtime_file == NULL)
                futhark_panic(1, "Cannot open %s: %s\n", optarg,
                              strerror(errno));
        }
        if (ch == 2 || ch == 'r') {
            num_runs = atoi(optarg);
            perform_warmup = 1;
            if (num_runs <= 0)
                futhark_panic(1, "Need a positive number of runs, not %s\n",
                              optarg);
        }
        if (ch == 3 || ch == 'D')
            futhark_context_config_set_debugging(cfg, 1);
        if (ch == 4 || ch == 'L')
            futhark_context_config_set_logging(cfg, 1);
        if (ch == 5 || ch == 'e') {
            if (entry_point != NULL)
                entry_point = optarg;
        }
        if (ch == 6 || ch == 'b')
            binary_output = 1;
        if (ch == 7 || ch == 'h') {
            printf("Usage: %s [OPTION]...\nOptions:\n\n%s\nFor more information, consult the Futhark User's Guide or the man pages.\n",
                   fut_progname, option_descriptions);
            exit(0);
        }
        if (ch == 8 || ch == 'd')
            futhark_context_config_set_device(cfg, optarg);
        if (ch == 9)
            futhark_context_config_set_default_group_size(cfg, atoi(optarg));
        if (ch == 10)
            futhark_context_config_set_default_num_groups(cfg, atoi(optarg));
        if (ch == 11)
            futhark_context_config_set_default_tile_size(cfg, atoi(optarg));
        if (ch == 12)
            futhark_context_config_set_default_threshold(cfg, atoi(optarg));
        if (ch == 13) {
            int n = futhark_get_num_sizes();
            
            for (int i = 0; i < n; i++)
                printf("%s (%s)\n", futhark_get_size_name(i),
                       futhark_get_size_class(i));
            exit(0);
        }
        if (ch == 14) {
            char *name = optarg;
            char *equals = strstr(optarg, "=");
            char *value_str = equals != NULL ? equals + 1 : optarg;
            int value = atoi(value_str);
            
            if (equals != NULL) {
                *equals = 0;
                if (futhark_context_config_set_size(cfg, name, value) != 0)
                    futhark_panic(1, "Unknown size: %s\n", name);
            } else
                futhark_panic(1, "Invalid argument for size option: %s\n",
                              optarg);
        }
        if (ch == 15) {
            char *ret = load_tuning_file(optarg, cfg, (int (*)(void *, const
                                                               char *,
                                                               size_t)) futhark_context_config_set_size);
            
            if (ret != NULL)
                futhark_panic(1, "When loading tuning from '%s': %s\n", optarg,
                              ret);
        }
        if (ch == 16 || ch == 'p')
            futhark_context_config_set_platform(cfg, optarg);
        if (ch == 17) {
            futhark_context_config_dump_program_to(cfg, optarg);
            entry_point = NULL;
        }
        if (ch == 18)
            futhark_context_config_load_program_from(cfg, optarg);
        if (ch == 19) {
            futhark_context_config_dump_binary_to(cfg, optarg);
            entry_point = NULL;
        }
        if (ch == 20)
            futhark_context_config_load_binary_from(cfg, optarg);
        if (ch == 21)
            futhark_context_config_add_build_option(cfg, optarg);
        if (ch == 22 || ch == 'P')
            futhark_context_config_set_profiling(cfg, 1);
        if (ch == 23) {
            futhark_context_config_list_devices(cfg);
            entry_point = NULL;
        }
        if (ch == ':')
            futhark_panic(-1, "Missing argument for option %s\n", argv[optind -
                                                                       1]);
        if (ch == '?') {
            fprintf(stderr, "Usage: %s: %s\n", fut_progname,
                    "  -t/--write-runtime-to FILE Print the time taken to execute the program to the indicated file, an integral number of microseconds.\n  -r/--runs INT              Perform NUM runs of the program.\n  -D/--debugging             Perform possibly expensive internal correctness checks and verbose logging.\n  -L/--log                   Print various low-overhead logging information to stderr while running.\n  -e/--entry-point NAME      The entry point to run. Defaults to main.\n  -b/--binary-output         Print the program result in the binary output format.\n  -h/--help                  Print help information and exit.\n  -d/--device NAME           Use the first OpenCL device whose name contains the given string.\n  --default-group-size INT   The default size of OpenCL workgroups that are launched.\n  --default-num-groups INT   The default number of OpenCL workgroups that are launched.\n  --default-tile-size INT    The default tile size used when performing two-dimensional tiling.\n  --default-threshold INT    The default parallelism threshold.\n  --print-sizes              Print all sizes that can be set with -size or --tuning.\n  --size ASSIGNMENT          Set a configurable run-time parameter to the given value.\n  --tuning FILE              Read size=value assignments from the given file.\n  -p/--platform NAME         Use the first OpenCL platform whose name contains the given string.\n  --dump-opencl FILE         Dump the embedded OpenCL program to the indicated file.\n  --load-opencl FILE         Instead of using the embedded OpenCL program, load it from the indicated file.\n  --dump-opencl-binary FILE  Dump the compiled version of the embedded OpenCL program to the indicated file.\n  --load-opencl-binary FILE  Load an OpenCL binary from the indicated file.\n  --build-option OPT         Add an additional build option to the string passed to clBuildProgram().\n  -P/--profile               Gather profiling data while executing and print out a summary at the end.\n  --list-devices             List all OpenCL devices and platforms available on the system.\n");
            futhark_panic(1, "Unknown option: %s\n", argv[optind - 1]);
        }
    }
    return optind;
}
static void futrts_cli_entry_main(struct futhark_context *ctx)
{
    int64_t t_start, t_end;
    int time_runs = 0, profile_run = 0;
    
    // We do not want to profile all the initialisation.
    futhark_context_pause_profiling(ctx);
    // Declare and read input.
    set_binary_mode(stdin);
    
    int64_t read_value_20838;
    
    if (read_scalar(&i64_info, &read_value_20838) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      0, i64_info.type_name, strerror(errno));
    
    int64_t read_value_20839;
    
    if (read_scalar(&i64_info, &read_value_20839) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      1, i64_info.type_name, strerror(errno));
    
    float read_value_20840;
    
    if (read_scalar(&f32_info, &read_value_20840) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      2, f32_info.type_name, strerror(errno));
    
    int64_t read_value_20841;
    
    if (read_scalar(&i64_info, &read_value_20841) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      3, i64_info.type_name, strerror(errno));
    
    float read_value_20842;
    
    if (read_scalar(&f32_info, &read_value_20842) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      4, f32_info.type_name, strerror(errno));
    
    float read_value_20843;
    
    if (read_scalar(&f32_info, &read_value_20843) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      5, f32_info.type_name, strerror(errno));
    
    float read_value_20844;
    
    if (read_scalar(&f32_info, &read_value_20844) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      6, f32_info.type_name, strerror(errno));
    
    float read_value_20845;
    
    if (read_scalar(&f32_info, &read_value_20845) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      7, f32_info.type_name, strerror(errno));
    
    float read_value_20846;
    
    if (read_scalar(&f32_info, &read_value_20846) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      8, f32_info.type_name, strerror(errno));
    if (end_of_input() != 0)
        futhark_panic(1, "Expected EOF on stdin after reading input for %s.\n",
                      "\"main\"");
    
    float result_20847;
    struct futhark_f32_1d *result_20848;
    
    if (perform_warmup) {
        int r;
        
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        // Only profile last run.
        if (profile_run)
            futhark_context_unpause_profiling(ctx);
        t_start = get_wall_time();
        r = futhark_entry_main(ctx, &result_20847, &result_20848,
                               read_value_20838, read_value_20839,
                               read_value_20840, read_value_20841,
                               read_value_20842, read_value_20843,
                               read_value_20844, read_value_20845,
                               read_value_20846);
        if (r != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        if (profile_run)
            futhark_context_pause_profiling(ctx);
        t_end = get_wall_time();
        
        long elapsed_usec = t_end - t_start;
        
        if (time_runs && runtime_file != NULL) {
            fprintf(runtime_file, "%lld\n", (long long) elapsed_usec);
            fflush(runtime_file);
        }
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        assert(futhark_free_f32_1d(ctx, result_20848) == 0);
    }
    time_runs = 1;
    // Proper run.
    for (int run = 0; run < num_runs; run++) {
        // Only profile last run.
        profile_run = run == num_runs - 1;
        
        int r;
        
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        // Only profile last run.
        if (profile_run)
            futhark_context_unpause_profiling(ctx);
        t_start = get_wall_time();
        r = futhark_entry_main(ctx, &result_20847, &result_20848,
                               read_value_20838, read_value_20839,
                               read_value_20840, read_value_20841,
                               read_value_20842, read_value_20843,
                               read_value_20844, read_value_20845,
                               read_value_20846);
        if (r != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        if (profile_run)
            futhark_context_pause_profiling(ctx);
        t_end = get_wall_time();
        
        long elapsed_usec = t_end - t_start;
        
        if (time_runs && runtime_file != NULL) {
            fprintf(runtime_file, "%lld\n", (long long) elapsed_usec);
            fflush(runtime_file);
        }
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        if (run < num_runs - 1) {
            ;
            assert(futhark_free_f32_1d(ctx, result_20848) == 0);
        }
    }
    ;
    ;
    ;
    ;
    ;
    ;
    ;
    ;
    ;
    if (binary_output)
        set_binary_mode(stdout);
    write_scalar(stdout, binary_output, &f32_info, &result_20847);
    printf("\n");
    {
        float *arr = calloc(sizeof(float), futhark_shape_f32_1d(ctx,
                                                                result_20848)[0]);
        
        assert(arr != NULL);
        assert(futhark_values_f32_1d(ctx, result_20848, arr) == 0);
        write_array(stdout, binary_output, &f32_info, arr,
                    futhark_shape_f32_1d(ctx, result_20848), 1);
        free(arr);
    }
    printf("\n");
    ;
    assert(futhark_free_f32_1d(ctx, result_20848) == 0);
}
typedef void entry_point_fun(struct futhark_context *);
struct entry_point_entry {
    const char *name;
    entry_point_fun *fun;
} ;
int main(int argc, char **argv)
{
    fut_progname = argv[0];
    
    struct entry_point_entry entry_points[] = {{.name ="main", .fun =
                                                futrts_cli_entry_main}};
    struct futhark_context_config *cfg = futhark_context_config_new();
    
    assert(cfg != NULL);
    
    int parsed_options = parse_options(cfg, argc, argv);
    
    argc -= parsed_options;
    argv += parsed_options;
    if (argc != 0)
        futhark_panic(1, "Excess non-option: %s\n", argv[0]);
    
    struct futhark_context *ctx = futhark_context_new(cfg);
    
    assert(ctx != NULL);
    
    char *error = futhark_context_get_error(ctx);
    
    if (error != NULL)
        futhark_panic(1, "%s", error);
    if (entry_point != NULL) {
        int num_entry_points = sizeof(entry_points) / sizeof(entry_points[0]);
        entry_point_fun *entry_point_fun = NULL;
        
        for (int i = 0; i < num_entry_points; i++) {
            if (strcmp(entry_points[i].name, entry_point) == 0) {
                entry_point_fun = entry_points[i].fun;
                break;
            }
        }
        if (entry_point_fun == NULL) {
            fprintf(stderr,
                    "No entry point '%s'.  Select another with --entry-point.  Options are:\n",
                    entry_point);
            for (int i = 0; i < num_entry_points; i++)
                fprintf(stderr, "%s\n", entry_points[i].name);
            return 1;
        }
        entry_point_fun(ctx);
        if (runtime_file != NULL)
            fclose(runtime_file);
        
        char *report = futhark_context_report(ctx);
        
        fputs(report, stderr);
        free(report);
    }
    futhark_context_free(ctx);
    futhark_context_config_free(cfg);
    return 0;
}
#ifdef _MSC_VER
#define inline __inline
#endif
#include <string.h>
#include <inttypes.h>
#include <ctype.h>
#include <errno.h>
#include <assert.h>
#define CL_TARGET_OPENCL_VERSION 120
#define CL_USE_DEPRECATED_OPENCL_1_2_APIS
#ifdef __APPLE__
#define CL_SILENCE_DEPRECATION
#include <OpenCL/cl.h>
#else
#include <CL/cl.h>
#endif

// Start of lock.h.

// A very simple cross-platform implementation of locks.  Uses
// pthreads on Unix and some Windows thing there.  Futhark's
// host-level code is not multithreaded, but user code may be, so we
// need some mechanism for ensuring atomic access to API functions.
// This is that mechanism.  It is not exposed to user code at all, so
// we do not have to worry about name collisions.

#ifdef _WIN32

typedef HANDLE lock_t;

static void create_lock(lock_t *lock) {
  *lock = CreateMutex(NULL,  // Default security attributes.
                      FALSE, // Initially unlocked.
                      NULL); // Unnamed.
}

static void lock_lock(lock_t *lock) {
  assert(WaitForSingleObject(*lock, INFINITE) == WAIT_OBJECT_0);
}

static void lock_unlock(lock_t *lock) {
  assert(ReleaseMutex(*lock));
}

static void free_lock(lock_t *lock) {
  CloseHandle(*lock);
}

#else
// Assuming POSIX

#include <pthread.h>

typedef pthread_mutex_t lock_t;

static void create_lock(lock_t *lock) {
  int r = pthread_mutex_init(lock, NULL);
  assert(r == 0);
}

static void lock_lock(lock_t *lock) {
  int r = pthread_mutex_lock(lock);
  assert(r == 0);
}

static void lock_unlock(lock_t *lock) {
  int r = pthread_mutex_unlock(lock);
  assert(r == 0);
}

static void free_lock(lock_t *lock) {
  // Nothing to do for pthreads.
  (void)lock;
}

#endif

// End of lock.h.

static inline uint8_t add8(uint8_t x, uint8_t y)
{
    return x + y;
}
static inline uint16_t add16(uint16_t x, uint16_t y)
{
    return x + y;
}
static inline uint32_t add32(uint32_t x, uint32_t y)
{
    return x + y;
}
static inline uint64_t add64(uint64_t x, uint64_t y)
{
    return x + y;
}
static inline uint8_t sub8(uint8_t x, uint8_t y)
{
    return x - y;
}
static inline uint16_t sub16(uint16_t x, uint16_t y)
{
    return x - y;
}
static inline uint32_t sub32(uint32_t x, uint32_t y)
{
    return x - y;
}
static inline uint64_t sub64(uint64_t x, uint64_t y)
{
    return x - y;
}
static inline uint8_t mul8(uint8_t x, uint8_t y)
{
    return x * y;
}
static inline uint16_t mul16(uint16_t x, uint16_t y)
{
    return x * y;
}
static inline uint32_t mul32(uint32_t x, uint32_t y)
{
    return x * y;
}
static inline uint64_t mul64(uint64_t x, uint64_t y)
{
    return x * y;
}
static inline uint8_t udiv8(uint8_t x, uint8_t y)
{
    return x / y;
}
static inline uint16_t udiv16(uint16_t x, uint16_t y)
{
    return x / y;
}
static inline uint32_t udiv32(uint32_t x, uint32_t y)
{
    return x / y;
}
static inline uint64_t udiv64(uint64_t x, uint64_t y)
{
    return x / y;
}
static inline uint8_t udiv_up8(uint8_t x, uint8_t y)
{
    return (x + y - 1) / y;
}
static inline uint16_t udiv_up16(uint16_t x, uint16_t y)
{
    return (x + y - 1) / y;
}
static inline uint32_t udiv_up32(uint32_t x, uint32_t y)
{
    return (x + y - 1) / y;
}
static inline uint64_t udiv_up64(uint64_t x, uint64_t y)
{
    return (x + y - 1) / y;
}
static inline uint8_t umod8(uint8_t x, uint8_t y)
{
    return x % y;
}
static inline uint16_t umod16(uint16_t x, uint16_t y)
{
    return x % y;
}
static inline uint32_t umod32(uint32_t x, uint32_t y)
{
    return x % y;
}
static inline uint64_t umod64(uint64_t x, uint64_t y)
{
    return x % y;
}
static inline uint8_t udiv_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint16_t udiv_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint32_t udiv_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint64_t udiv_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint8_t udiv_up_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint16_t udiv_up_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint32_t udiv_up_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint64_t udiv_up_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint8_t umod_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint16_t umod_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint32_t umod_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint64_t umod_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int8_t sdiv8(int8_t x, int8_t y)
{
    int8_t q = x / y;
    int8_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int16_t sdiv16(int16_t x, int16_t y)
{
    int16_t q = x / y;
    int16_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int32_t sdiv32(int32_t x, int32_t y)
{
    int32_t q = x / y;
    int32_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int64_t sdiv64(int64_t x, int64_t y)
{
    int64_t q = x / y;
    int64_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int8_t sdiv_up8(int8_t x, int8_t y)
{
    return sdiv8(x + y - 1, y);
}
static inline int16_t sdiv_up16(int16_t x, int16_t y)
{
    return sdiv16(x + y - 1, y);
}
static inline int32_t sdiv_up32(int32_t x, int32_t y)
{
    return sdiv32(x + y - 1, y);
}
static inline int64_t sdiv_up64(int64_t x, int64_t y)
{
    return sdiv64(x + y - 1, y);
}
static inline int8_t smod8(int8_t x, int8_t y)
{
    int8_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int16_t smod16(int16_t x, int16_t y)
{
    int16_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int32_t smod32(int32_t x, int32_t y)
{
    int32_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int64_t smod64(int64_t x, int64_t y)
{
    int64_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int8_t sdiv_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : sdiv8(x, y);
}
static inline int16_t sdiv_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : sdiv16(x, y);
}
static inline int32_t sdiv_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : sdiv32(x, y);
}
static inline int64_t sdiv_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : sdiv64(x, y);
}
static inline int8_t sdiv_up_safe8(int8_t x, int8_t y)
{
    return sdiv_safe8(x + y - 1, y);
}
static inline int16_t sdiv_up_safe16(int16_t x, int16_t y)
{
    return sdiv_safe16(x + y - 1, y);
}
static inline int32_t sdiv_up_safe32(int32_t x, int32_t y)
{
    return sdiv_safe32(x + y - 1, y);
}
static inline int64_t sdiv_up_safe64(int64_t x, int64_t y)
{
    return sdiv_safe64(x + y - 1, y);
}
static inline int8_t smod_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : smod8(x, y);
}
static inline int16_t smod_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : smod16(x, y);
}
static inline int32_t smod_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : smod32(x, y);
}
static inline int64_t smod_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : smod64(x, y);
}
static inline int8_t squot8(int8_t x, int8_t y)
{
    return x / y;
}
static inline int16_t squot16(int16_t x, int16_t y)
{
    return x / y;
}
static inline int32_t squot32(int32_t x, int32_t y)
{
    return x / y;
}
static inline int64_t squot64(int64_t x, int64_t y)
{
    return x / y;
}
static inline int8_t srem8(int8_t x, int8_t y)
{
    return x % y;
}
static inline int16_t srem16(int16_t x, int16_t y)
{
    return x % y;
}
static inline int32_t srem32(int32_t x, int32_t y)
{
    return x % y;
}
static inline int64_t srem64(int64_t x, int64_t y)
{
    return x % y;
}
static inline int8_t squot_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int16_t squot_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int32_t squot_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int64_t squot_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int8_t srem_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int16_t srem_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int32_t srem_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int64_t srem_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int8_t smin8(int8_t x, int8_t y)
{
    return x < y ? x : y;
}
static inline int16_t smin16(int16_t x, int16_t y)
{
    return x < y ? x : y;
}
static inline int32_t smin32(int32_t x, int32_t y)
{
    return x < y ? x : y;
}
static inline int64_t smin64(int64_t x, int64_t y)
{
    return x < y ? x : y;
}
static inline uint8_t umin8(uint8_t x, uint8_t y)
{
    return x < y ? x : y;
}
static inline uint16_t umin16(uint16_t x, uint16_t y)
{
    return x < y ? x : y;
}
static inline uint32_t umin32(uint32_t x, uint32_t y)
{
    return x < y ? x : y;
}
static inline uint64_t umin64(uint64_t x, uint64_t y)
{
    return x < y ? x : y;
}
static inline int8_t smax8(int8_t x, int8_t y)
{
    return x < y ? y : x;
}
static inline int16_t smax16(int16_t x, int16_t y)
{
    return x < y ? y : x;
}
static inline int32_t smax32(int32_t x, int32_t y)
{
    return x < y ? y : x;
}
static inline int64_t smax64(int64_t x, int64_t y)
{
    return x < y ? y : x;
}
static inline uint8_t umax8(uint8_t x, uint8_t y)
{
    return x < y ? y : x;
}
static inline uint16_t umax16(uint16_t x, uint16_t y)
{
    return x < y ? y : x;
}
static inline uint32_t umax32(uint32_t x, uint32_t y)
{
    return x < y ? y : x;
}
static inline uint64_t umax64(uint64_t x, uint64_t y)
{
    return x < y ? y : x;
}
static inline uint8_t shl8(uint8_t x, uint8_t y)
{
    return x << y;
}
static inline uint16_t shl16(uint16_t x, uint16_t y)
{
    return x << y;
}
static inline uint32_t shl32(uint32_t x, uint32_t y)
{
    return x << y;
}
static inline uint64_t shl64(uint64_t x, uint64_t y)
{
    return x << y;
}
static inline uint8_t lshr8(uint8_t x, uint8_t y)
{
    return x >> y;
}
static inline uint16_t lshr16(uint16_t x, uint16_t y)
{
    return x >> y;
}
static inline uint32_t lshr32(uint32_t x, uint32_t y)
{
    return x >> y;
}
static inline uint64_t lshr64(uint64_t x, uint64_t y)
{
    return x >> y;
}
static inline int8_t ashr8(int8_t x, int8_t y)
{
    return x >> y;
}
static inline int16_t ashr16(int16_t x, int16_t y)
{
    return x >> y;
}
static inline int32_t ashr32(int32_t x, int32_t y)
{
    return x >> y;
}
static inline int64_t ashr64(int64_t x, int64_t y)
{
    return x >> y;
}
static inline uint8_t and8(uint8_t x, uint8_t y)
{
    return x & y;
}
static inline uint16_t and16(uint16_t x, uint16_t y)
{
    return x & y;
}
static inline uint32_t and32(uint32_t x, uint32_t y)
{
    return x & y;
}
static inline uint64_t and64(uint64_t x, uint64_t y)
{
    return x & y;
}
static inline uint8_t or8(uint8_t x, uint8_t y)
{
    return x | y;
}
static inline uint16_t or16(uint16_t x, uint16_t y)
{
    return x | y;
}
static inline uint32_t or32(uint32_t x, uint32_t y)
{
    return x | y;
}
static inline uint64_t or64(uint64_t x, uint64_t y)
{
    return x | y;
}
static inline uint8_t xor8(uint8_t x, uint8_t y)
{
    return x ^ y;
}
static inline uint16_t xor16(uint16_t x, uint16_t y)
{
    return x ^ y;
}
static inline uint32_t xor32(uint32_t x, uint32_t y)
{
    return x ^ y;
}
static inline uint64_t xor64(uint64_t x, uint64_t y)
{
    return x ^ y;
}
static inline bool ult8(uint8_t x, uint8_t y)
{
    return x < y;
}
static inline bool ult16(uint16_t x, uint16_t y)
{
    return x < y;
}
static inline bool ult32(uint32_t x, uint32_t y)
{
    return x < y;
}
static inline bool ult64(uint64_t x, uint64_t y)
{
    return x < y;
}
static inline bool ule8(uint8_t x, uint8_t y)
{
    return x <= y;
}
static inline bool ule16(uint16_t x, uint16_t y)
{
    return x <= y;
}
static inline bool ule32(uint32_t x, uint32_t y)
{
    return x <= y;
}
static inline bool ule64(uint64_t x, uint64_t y)
{
    return x <= y;
}
static inline bool slt8(int8_t x, int8_t y)
{
    return x < y;
}
static inline bool slt16(int16_t x, int16_t y)
{
    return x < y;
}
static inline bool slt32(int32_t x, int32_t y)
{
    return x < y;
}
static inline bool slt64(int64_t x, int64_t y)
{
    return x < y;
}
static inline bool sle8(int8_t x, int8_t y)
{
    return x <= y;
}
static inline bool sle16(int16_t x, int16_t y)
{
    return x <= y;
}
static inline bool sle32(int32_t x, int32_t y)
{
    return x <= y;
}
static inline bool sle64(int64_t x, int64_t y)
{
    return x <= y;
}
static inline int8_t pow8(int8_t x, int8_t y)
{
    int8_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int16_t pow16(int16_t x, int16_t y)
{
    int16_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int32_t pow32(int32_t x, int32_t y)
{
    int32_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int64_t pow64(int64_t x, int64_t y)
{
    int64_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline bool itob_i8_bool(int8_t x)
{
    return x;
}
static inline bool itob_i16_bool(int16_t x)
{
    return x;
}
static inline bool itob_i32_bool(int32_t x)
{
    return x;
}
static inline bool itob_i64_bool(int64_t x)
{
    return x;
}
static inline int8_t btoi_bool_i8(bool x)
{
    return x;
}
static inline int16_t btoi_bool_i16(bool x)
{
    return x;
}
static inline int32_t btoi_bool_i32(bool x)
{
    return x;
}
static inline int64_t btoi_bool_i64(bool x)
{
    return x;
}
#define sext_i8_i8(x) ((int8_t) (int8_t) x)
#define sext_i8_i16(x) ((int16_t) (int8_t) x)
#define sext_i8_i32(x) ((int32_t) (int8_t) x)
#define sext_i8_i64(x) ((int64_t) (int8_t) x)
#define sext_i16_i8(x) ((int8_t) (int16_t) x)
#define sext_i16_i16(x) ((int16_t) (int16_t) x)
#define sext_i16_i32(x) ((int32_t) (int16_t) x)
#define sext_i16_i64(x) ((int64_t) (int16_t) x)
#define sext_i32_i8(x) ((int8_t) (int32_t) x)
#define sext_i32_i16(x) ((int16_t) (int32_t) x)
#define sext_i32_i32(x) ((int32_t) (int32_t) x)
#define sext_i32_i64(x) ((int64_t) (int32_t) x)
#define sext_i64_i8(x) ((int8_t) (int64_t) x)
#define sext_i64_i16(x) ((int16_t) (int64_t) x)
#define sext_i64_i32(x) ((int32_t) (int64_t) x)
#define sext_i64_i64(x) ((int64_t) (int64_t) x)
#define zext_i8_i8(x) ((int8_t) (uint8_t) x)
#define zext_i8_i16(x) ((int16_t) (uint8_t) x)
#define zext_i8_i32(x) ((int32_t) (uint8_t) x)
#define zext_i8_i64(x) ((int64_t) (uint8_t) x)
#define zext_i16_i8(x) ((int8_t) (uint16_t) x)
#define zext_i16_i16(x) ((int16_t) (uint16_t) x)
#define zext_i16_i32(x) ((int32_t) (uint16_t) x)
#define zext_i16_i64(x) ((int64_t) (uint16_t) x)
#define zext_i32_i8(x) ((int8_t) (uint32_t) x)
#define zext_i32_i16(x) ((int16_t) (uint32_t) x)
#define zext_i32_i32(x) ((int32_t) (uint32_t) x)
#define zext_i32_i64(x) ((int64_t) (uint32_t) x)
#define zext_i64_i8(x) ((int8_t) (uint64_t) x)
#define zext_i64_i16(x) ((int16_t) (uint64_t) x)
#define zext_i64_i32(x) ((int32_t) (uint64_t) x)
#define zext_i64_i64(x) ((int64_t) (uint64_t) x)
#if defined(__OPENCL_VERSION__)
static int32_t futrts_popc8(int8_t x)
{
    return popcount(x);
}
static int32_t futrts_popc16(int16_t x)
{
    return popcount(x);
}
static int32_t futrts_popc32(int32_t x)
{
    return popcount(x);
}
static int32_t futrts_popc64(int64_t x)
{
    return popcount(x);
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_popc8(int8_t x)
{
    return __popc(zext_i8_i32(x));
}
static int32_t futrts_popc16(int16_t x)
{
    return __popc(zext_i16_i32(x));
}
static int32_t futrts_popc32(int32_t x)
{
    return __popc(x);
}
static int32_t futrts_popc64(int64_t x)
{
    return __popcll(x);
}
#else
static int32_t futrts_popc8(int8_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc16(int16_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc32(int32_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc64(int64_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
#endif
#if defined(__OPENCL_VERSION__)
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    return mul_hi(a, b);
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    return mul_hi(a, b);
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    return mul_hi(a, b);
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    return mul_hi(a, b);
}
#elif defined(__CUDA_ARCH__)
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    uint16_t aa = a;
    uint16_t bb = b;
    
    return aa * bb >> 8;
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    uint32_t aa = a;
    uint32_t bb = b;
    
    return aa * bb >> 16;
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    return mulhi(a, b);
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    return mul64hi(a, b);
}
#else
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    uint16_t aa = a;
    uint16_t bb = b;
    
    return aa * bb >> 8;
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    uint32_t aa = a;
    uint32_t bb = b;
    
    return aa * bb >> 16;
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    uint64_t aa = a;
    uint64_t bb = b;
    
    return aa * bb >> 32;
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    __uint128_t aa = a;
    __uint128_t bb = b;
    
    return aa * bb >> 64;
}
#endif
#if defined(__OPENCL_VERSION__)
static uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)
{
    return mad_hi(a, b, c);
}
static uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)
{
    return mad_hi(a, b, c);
}
static uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)
{
    return mad_hi(a, b, c);
}
static uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)
{
    return mad_hi(a, b, c);
}
#else
static uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)
{
    return futrts_mul_hi8(a, b) + c;
}
static uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)
{
    return futrts_mul_hi16(a, b) + c;
}
static uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)
{
    return futrts_mul_hi32(a, b) + c;
}
static uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)
{
    return futrts_mul_hi64(a, b) + c;
}
#endif
#if defined(__OPENCL_VERSION__)
static int32_t futrts_clzz8(int8_t x)
{
    return clz(x);
}
static int32_t futrts_clzz16(int16_t x)
{
    return clz(x);
}
static int32_t futrts_clzz32(int32_t x)
{
    return clz(x);
}
static int32_t futrts_clzz64(int64_t x)
{
    return clz(x);
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_clzz8(int8_t x)
{
    return __clz(zext_i8_i32(x)) - 24;
}
static int32_t futrts_clzz16(int16_t x)
{
    return __clz(zext_i16_i32(x)) - 16;
}
static int32_t futrts_clzz32(int32_t x)
{
    return __clz(x);
}
static int32_t futrts_clzz64(int64_t x)
{
    return __clzll(x);
}
#else
static int32_t futrts_clzz8(int8_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz16(int16_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz32(int32_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz64(int64_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
#endif
#if defined(__OPENCL_VERSION__)
static int32_t futrts_ctzz8(int8_t x)
{
    int i = 0;
    
    for (; i < 8 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz16(int16_t x)
{
    int i = 0;
    
    for (; i < 16 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz32(int32_t x)
{
    int i = 0;
    
    for (; i < 32 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz64(int64_t x)
{
    int i = 0;
    
    for (; i < 64 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_ctzz8(int8_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 8 : y - 1;
}
static int32_t futrts_ctzz16(int16_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 16 : y - 1;
}
static int32_t futrts_ctzz32(int32_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 32 : y - 1;
}
static int32_t futrts_ctzz64(int64_t x)
{
    int y = __ffsll(x);
    
    return y == 0 ? 64 : y - 1;
}
#else
static int32_t futrts_ctzz8(int8_t x)
{
    return x == 0 ? 8 : __builtin_ctz((uint32_t) x);
}
static int32_t futrts_ctzz16(int16_t x)
{
    return x == 0 ? 16 : __builtin_ctz((uint32_t) x);
}
static int32_t futrts_ctzz32(int32_t x)
{
    return x == 0 ? 32 : __builtin_ctz(x);
}
static int32_t futrts_ctzz64(int64_t x)
{
    return x == 0 ? 64 : __builtin_ctzl(x);
}
#endif
static inline float fdiv32(float x, float y)
{
    return x / y;
}
static inline float fadd32(float x, float y)
{
    return x + y;
}
static inline float fsub32(float x, float y)
{
    return x - y;
}
static inline float fmul32(float x, float y)
{
    return x * y;
}
static inline float fmin32(float x, float y)
{
    return fmin(x, y);
}
static inline float fmax32(float x, float y)
{
    return fmax(x, y);
}
static inline float fpow32(float x, float y)
{
    return pow(x, y);
}
static inline bool cmplt32(float x, float y)
{
    return x < y;
}
static inline bool cmple32(float x, float y)
{
    return x <= y;
}
static inline float sitofp_i8_f32(int8_t x)
{
    return (float) x;
}
static inline float sitofp_i16_f32(int16_t x)
{
    return (float) x;
}
static inline float sitofp_i32_f32(int32_t x)
{
    return (float) x;
}
static inline float sitofp_i64_f32(int64_t x)
{
    return (float) x;
}
static inline float uitofp_i8_f32(uint8_t x)
{
    return (float) x;
}
static inline float uitofp_i16_f32(uint16_t x)
{
    return (float) x;
}
static inline float uitofp_i32_f32(uint32_t x)
{
    return (float) x;
}
static inline float uitofp_i64_f32(uint64_t x)
{
    return (float) x;
}
static inline int8_t fptosi_f32_i8(float x)
{
    return (int8_t) x;
}
static inline int16_t fptosi_f32_i16(float x)
{
    return (int16_t) x;
}
static inline int32_t fptosi_f32_i32(float x)
{
    return (int32_t) x;
}
static inline int64_t fptosi_f32_i64(float x)
{
    return (int64_t) x;
}
static inline uint8_t fptoui_f32_i8(float x)
{
    return (uint8_t) x;
}
static inline uint16_t fptoui_f32_i16(float x)
{
    return (uint16_t) x;
}
static inline uint32_t fptoui_f32_i32(float x)
{
    return (uint32_t) x;
}
static inline uint64_t fptoui_f32_i64(float x)
{
    return (uint64_t) x;
}
static inline double fdiv64(double x, double y)
{
    return x / y;
}
static inline double fadd64(double x, double y)
{
    return x + y;
}
static inline double fsub64(double x, double y)
{
    return x - y;
}
static inline double fmul64(double x, double y)
{
    return x * y;
}
static inline double fmin64(double x, double y)
{
    return fmin(x, y);
}
static inline double fmax64(double x, double y)
{
    return fmax(x, y);
}
static inline double fpow64(double x, double y)
{
    return pow(x, y);
}
static inline bool cmplt64(double x, double y)
{
    return x < y;
}
static inline bool cmple64(double x, double y)
{
    return x <= y;
}
static inline double sitofp_i8_f64(int8_t x)
{
    return (double) x;
}
static inline double sitofp_i16_f64(int16_t x)
{
    return (double) x;
}
static inline double sitofp_i32_f64(int32_t x)
{
    return (double) x;
}
static inline double sitofp_i64_f64(int64_t x)
{
    return (double) x;
}
static inline double uitofp_i8_f64(uint8_t x)
{
    return (double) x;
}
static inline double uitofp_i16_f64(uint16_t x)
{
    return (double) x;
}
static inline double uitofp_i32_f64(uint32_t x)
{
    return (double) x;
}
static inline double uitofp_i64_f64(uint64_t x)
{
    return (double) x;
}
static inline int8_t fptosi_f64_i8(double x)
{
    return (int8_t) x;
}
static inline int16_t fptosi_f64_i16(double x)
{
    return (int16_t) x;
}
static inline int32_t fptosi_f64_i32(double x)
{
    return (int32_t) x;
}
static inline int64_t fptosi_f64_i64(double x)
{
    return (int64_t) x;
}
static inline uint8_t fptoui_f64_i8(double x)
{
    return (uint8_t) x;
}
static inline uint16_t fptoui_f64_i16(double x)
{
    return (uint16_t) x;
}
static inline uint32_t fptoui_f64_i32(double x)
{
    return (uint32_t) x;
}
static inline uint64_t fptoui_f64_i64(double x)
{
    return (uint64_t) x;
}
static inline float fpconv_f32_f32(float x)
{
    return (float) x;
}
static inline double fpconv_f32_f64(float x)
{
    return (double) x;
}
static inline float fpconv_f64_f32(double x)
{
    return (float) x;
}
static inline double fpconv_f64_f64(double x)
{
    return (double) x;
}
static inline float futrts_log32(float x)
{
    return log(x);
}
static inline float futrts_log2_32(float x)
{
    return log2(x);
}
static inline float futrts_log10_32(float x)
{
    return log10(x);
}
static inline float futrts_sqrt32(float x)
{
    return sqrt(x);
}
static inline float futrts_exp32(float x)
{
    return exp(x);
}
static inline float futrts_cos32(float x)
{
    return cos(x);
}
static inline float futrts_sin32(float x)
{
    return sin(x);
}
static inline float futrts_tan32(float x)
{
    return tan(x);
}
static inline float futrts_acos32(float x)
{
    return acos(x);
}
static inline float futrts_asin32(float x)
{
    return asin(x);
}
static inline float futrts_atan32(float x)
{
    return atan(x);
}
static inline float futrts_cosh32(float x)
{
    return cosh(x);
}
static inline float futrts_sinh32(float x)
{
    return sinh(x);
}
static inline float futrts_tanh32(float x)
{
    return tanh(x);
}
static inline float futrts_acosh32(float x)
{
    return acosh(x);
}
static inline float futrts_asinh32(float x)
{
    return asinh(x);
}
static inline float futrts_atanh32(float x)
{
    return atanh(x);
}
static inline float futrts_atan2_32(float x, float y)
{
    return atan2(x, y);
}
static inline float futrts_gamma32(float x)
{
    return tgamma(x);
}
static inline float futrts_lgamma32(float x)
{
    return lgamma(x);
}
static inline bool futrts_isnan32(float x)
{
    return isnan(x);
}
static inline bool futrts_isinf32(float x)
{
    return isinf(x);
}
static inline int32_t futrts_to_bits32(float x)
{
    union {
        float f;
        int32_t t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline float futrts_from_bits32(int32_t x)
{
    union {
        int32_t f;
        float t;
    } p;
    
    p.f = x;
    return p.t;
}
#ifdef __OPENCL_VERSION__
static inline float fmod32(float x, float y)
{
    return fmod(x, y);
}
static inline float futrts_round32(float x)
{
    return rint(x);
}
static inline float futrts_floor32(float x)
{
    return floor(x);
}
static inline float futrts_ceil32(float x)
{
    return ceil(x);
}
static inline float futrts_lerp32(float v0, float v1, float t)
{
    return mix(v0, v1, t);
}
static inline float futrts_mad32(float a, float b, float c)
{
    return mad(a, b, c);
}
static inline float futrts_fma32(float a, float b, float c)
{
    return fma(a, b, c);
}
#else
static inline float fmod32(float x, float y)
{
    return fmodf(x, y);
}
static inline float futrts_round32(float x)
{
    return rintf(x);
}
static inline float futrts_floor32(float x)
{
    return floorf(x);
}
static inline float futrts_ceil32(float x)
{
    return ceilf(x);
}
static inline float futrts_lerp32(float v0, float v1, float t)
{
    return v0 + (v1 - v0) * t;
}
static inline float futrts_mad32(float a, float b, float c)
{
    return a * b + c;
}
static inline float futrts_fma32(float a, float b, float c)
{
    return fmaf(a, b, c);
}
#endif
static inline double futrts_log64(double x)
{
    return log(x);
}
static inline double futrts_log2_64(double x)
{
    return log2(x);
}
static inline double futrts_log10_64(double x)
{
    return log10(x);
}
static inline double futrts_sqrt64(double x)
{
    return sqrt(x);
}
static inline double futrts_exp64(double x)
{
    return exp(x);
}
static inline double futrts_cos64(double x)
{
    return cos(x);
}
static inline double futrts_sin64(double x)
{
    return sin(x);
}
static inline double futrts_tan64(double x)
{
    return tan(x);
}
static inline double futrts_acos64(double x)
{
    return acos(x);
}
static inline double futrts_asin64(double x)
{
    return asin(x);
}
static inline double futrts_atan64(double x)
{
    return atan(x);
}
static inline double futrts_cosh64(double x)
{
    return cosh(x);
}
static inline double futrts_sinh64(double x)
{
    return sinh(x);
}
static inline double futrts_tanh64(double x)
{
    return tanh(x);
}
static inline double futrts_acosh64(double x)
{
    return acosh(x);
}
static inline double futrts_asinh64(double x)
{
    return asinh(x);
}
static inline double futrts_atanh64(double x)
{
    return atanh(x);
}
static inline double futrts_atan2_64(double x, double y)
{
    return atan2(x, y);
}
static inline double futrts_gamma64(double x)
{
    return tgamma(x);
}
static inline double futrts_lgamma64(double x)
{
    return lgamma(x);
}
static inline double futrts_fma64(double a, double b, double c)
{
    return fma(a, b, c);
}
static inline double futrts_round64(double x)
{
    return rint(x);
}
static inline double futrts_ceil64(double x)
{
    return ceil(x);
}
static inline double futrts_floor64(double x)
{
    return floor(x);
}
static inline bool futrts_isnan64(double x)
{
    return isnan(x);
}
static inline bool futrts_isinf64(double x)
{
    return isinf(x);
}
static inline int64_t futrts_to_bits64(double x)
{
    union {
        double f;
        int64_t t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline double futrts_from_bits64(int64_t x)
{
    union {
        int64_t f;
        double t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline double fmod64(double x, double y)
{
    return fmod(x, y);
}
#ifdef __OPENCL_VERSION__
static inline double futrts_lerp64(double v0, double v1, double t)
{
    return mix(v0, v1, t);
}
static inline double futrts_mad64(double a, double b, double c)
{
    return mad(a, b, c);
}
#else
static inline double futrts_lerp64(double v0, double v1, double t)
{
    return v0 + (v1 - v0) * t;
}
static inline double futrts_mad64(double a, double b, double c)
{
    return a * b + c;
}
#endif
int init_constants(struct futhark_context *);
int free_constants(struct futhark_context *);
static int32_t mainzicounter_mem_realtype_20655[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzicounter_mem_realtype_20662[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzihist_locks_mem_realtype_20704[100151];
static int32_t mainzicounter_mem_realtype_20715[10240];
static int32_t mainzicounter_mem_realtype_20786[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzicounter_mem_realtype_20803[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzicounter_mem_realtype_20820[10240];
static int32_t mainzicounter_mem_realtype_20831[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
struct memblock_device {
    int *references;
    cl_mem mem;
    int64_t size;
    const char *desc;
} ;
struct memblock {
    int *references;
    char *mem;
    int64_t size;
    const char *desc;
} ;
typedef cl_mem fl_mem_t;
// Start of free_list.h.

// An entry in the free list.  May be invalid, to avoid having to
// deallocate entries as soon as they are removed.  There is also a
// tag, to help with memory reuse.
struct free_list_entry {
  size_t size;
  fl_mem_t mem;
  const char *tag;
  unsigned char valid;
};

struct free_list {
  struct free_list_entry *entries;        // Pointer to entries.
  int capacity;                           // Number of entries.
  int used;                               // Number of valid entries.
};

static void free_list_init(struct free_list *l) {
  l->capacity = 30; // Picked arbitrarily.
  l->used = 0;
  l->entries = (struct free_list_entry*) malloc(sizeof(struct free_list_entry) * l->capacity);
  for (int i = 0; i < l->capacity; i++) {
    l->entries[i].valid = 0;
  }
}

// Remove invalid entries from the free list.
static void free_list_pack(struct free_list *l) {
  int p = 0;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[p] = l->entries[i];
      p++;
    }
  }

  // Now p is the number of used elements.  We don't want it to go
  // less than the default capacity (although in practice it's OK as
  // long as it doesn't become 1).
  if (p < 30) {
    p = 30;
  }
  l->entries = realloc(l->entries, p * sizeof(struct free_list_entry));
  l->capacity = p;
}

static void free_list_destroy(struct free_list *l) {
  assert(l->used == 0);
  free(l->entries);
}

static int free_list_find_invalid(struct free_list *l) {
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (!l->entries[i].valid) {
      break;
    }
  }
  return i;
}

static void free_list_insert(struct free_list *l, size_t size, fl_mem_t mem, const char *tag) {
  int i = free_list_find_invalid(l);

  if (i == l->capacity) {
    // List is full; so we have to grow it.
    int new_capacity = l->capacity * 2 * sizeof(struct free_list_entry);
    l->entries = realloc(l->entries, new_capacity);
    for (int j = 0; j < l->capacity; j++) {
      l->entries[j+l->capacity].valid = 0;
    }
    l->capacity *= 2;
  }

  // Now 'i' points to the first invalid entry.
  l->entries[i].valid = 1;
  l->entries[i].size = size;
  l->entries[i].mem = mem;
  l->entries[i].tag = tag;

  l->used++;
}

// Find and remove a memory block of the indicated tag, or if that
// does not exist, another memory block with exactly the desired size.
// Returns 0 on success.
static int free_list_find(struct free_list *l, size_t size,
                          size_t *size_out, fl_mem_t *mem_out) {
  int size_match = -1;
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid &&
        size <= l->entries[i].size &&
        (size_match < 0 || l->entries[i].size < l->entries[size_match].size)) {
      // If this entry is valid, has sufficient size, and is smaller than the
      // best entry found so far, use this entry.
      size_match = i;
    }
  }

  if (size_match >= 0) {
    l->entries[size_match].valid = 0;
    *size_out = l->entries[size_match].size;
    *mem_out = l->entries[size_match].mem;
    l->used--;
    return 0;
  } else {
    return 1;
  }
}

// Remove the first block in the free list.  Returns 0 if a block was
// removed, and nonzero if the free list was already empty.
static int free_list_first(struct free_list *l, fl_mem_t *mem_out) {
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[i].valid = 0;
      *mem_out = l->entries[i].mem;
      l->used--;
      return 0;
    }
  }

  return 1;
}

// End of free_list.h.

// Start of opencl.h.

#define OPENCL_SUCCEED_FATAL(e) opencl_succeed_fatal(e, #e, __FILE__, __LINE__)
#define OPENCL_SUCCEED_NONFATAL(e) opencl_succeed_nonfatal(e, #e, __FILE__, __LINE__)
// Take care not to override an existing error.
#define OPENCL_SUCCEED_OR_RETURN(e) {             \
    char *serror = OPENCL_SUCCEED_NONFATAL(e);    \
    if (serror) {                                 \
      if (!ctx->error) {                          \
        ctx->error = serror;                      \
        return bad;                               \
      } else {                                    \
        free(serror);                             \
      }                                           \
    }                                             \
  }

// OPENCL_SUCCEED_OR_RETURN returns the value of the variable 'bad' in
// scope.  By default, it will be this one.  Create a local variable
// of some other type if needed.  This is a bit of a hack, but it
// saves effort in the code generator.
static const int bad = 1;

struct opencl_config {
  int debugging;
  int profiling;
  int logging;
  int preferred_device_num;
  const char *preferred_platform;
  const char *preferred_device;
  int ignore_blacklist;

  const char* dump_program_to;
  const char* load_program_from;
  const char* dump_binary_to;
  const char* load_binary_from;

  size_t default_group_size;
  size_t default_num_groups;
  size_t default_tile_size;
  size_t default_threshold;

  int default_group_size_changed;
  int default_tile_size_changed;

  int num_sizes;
  const char **size_names;
  const char **size_vars;
  size_t *size_values;
  const char **size_classes;
};

static void opencl_config_init(struct opencl_config *cfg,
                               int num_sizes,
                               const char *size_names[],
                               const char *size_vars[],
                               size_t *size_values,
                               const char *size_classes[]) {
  cfg->debugging = 0;
  cfg->logging = 0;
  cfg->profiling = 0;
  cfg->preferred_device_num = 0;
  cfg->preferred_platform = "";
  cfg->preferred_device = "";
  cfg->ignore_blacklist = 0;
  cfg->dump_program_to = NULL;
  cfg->load_program_from = NULL;
  cfg->dump_binary_to = NULL;
  cfg->load_binary_from = NULL;

  // The following are dummy sizes that mean the concrete defaults
  // will be set during initialisation via hardware-inspection-based
  // heuristics.
  cfg->default_group_size = 0;
  cfg->default_num_groups = 0;
  cfg->default_tile_size = 0;
  cfg->default_threshold = 0;

  cfg->default_group_size_changed = 0;
  cfg->default_tile_size_changed = 0;

  cfg->num_sizes = num_sizes;
  cfg->size_names = size_names;
  cfg->size_vars = size_vars;
  cfg->size_values = size_values;
  cfg->size_classes = size_classes;
}

// A record of something that happened.
struct profiling_record {
  cl_event *event;
  int *runs;
  int64_t *runtime;
};

struct opencl_context {
  cl_device_id device;
  cl_context ctx;
  cl_command_queue queue;

  struct opencl_config cfg;

  struct free_list free_list;

  size_t max_group_size;
  size_t max_num_groups;
  size_t max_tile_size;
  size_t max_threshold;
  size_t max_local_memory;

  size_t lockstep_width;

  struct profiling_record *profiling_records;
  int profiling_records_capacity;
  int profiling_records_used;
};

struct opencl_device_option {
  cl_platform_id platform;
  cl_device_id device;
  cl_device_type device_type;
  char *platform_name;
  char *device_name;
};

// This function must be defined by the user.  It is invoked by
// setup_opencl() after the platform and device has been found, but
// before the program is loaded.  Its intended use is to tune
// constants based on the selected platform and device.
static void post_opencl_setup(struct opencl_context*, struct opencl_device_option*);

static char *strclone(const char *str) {
  size_t size = strlen(str) + 1;
  char *copy = (char*) malloc(size);
  if (copy == NULL) {
    return NULL;
  }

  memcpy(copy, str, size);
  return copy;
}

static const char* opencl_error_string(cl_int err)
{
    switch (err) {
        case CL_SUCCESS:                            return "Success!";
        case CL_DEVICE_NOT_FOUND:                   return "Device not found.";
        case CL_DEVICE_NOT_AVAILABLE:               return "Device not available";
        case CL_COMPILER_NOT_AVAILABLE:             return "Compiler not available";
        case CL_MEM_OBJECT_ALLOCATION_FAILURE:      return "Memory object allocation failure";
        case CL_OUT_OF_RESOURCES:                   return "Out of resources";
        case CL_OUT_OF_HOST_MEMORY:                 return "Out of host memory";
        case CL_PROFILING_INFO_NOT_AVAILABLE:       return "Profiling information not available";
        case CL_MEM_COPY_OVERLAP:                   return "Memory copy overlap";
        case CL_IMAGE_FORMAT_MISMATCH:              return "Image format mismatch";
        case CL_IMAGE_FORMAT_NOT_SUPPORTED:         return "Image format not supported";
        case CL_BUILD_PROGRAM_FAILURE:              return "Program build failure";
        case CL_MAP_FAILURE:                        return "Map failure";
        case CL_INVALID_VALUE:                      return "Invalid value";
        case CL_INVALID_DEVICE_TYPE:                return "Invalid device type";
        case CL_INVALID_PLATFORM:                   return "Invalid platform";
        case CL_INVALID_DEVICE:                     return "Invalid device";
        case CL_INVALID_CONTEXT:                    return "Invalid context";
        case CL_INVALID_QUEUE_PROPERTIES:           return "Invalid queue properties";
        case CL_INVALID_COMMAND_QUEUE:              return "Invalid command queue";
        case CL_INVALID_HOST_PTR:                   return "Invalid host pointer";
        case CL_INVALID_MEM_OBJECT:                 return "Invalid memory object";
        case CL_INVALID_IMAGE_FORMAT_DESCRIPTOR:    return "Invalid image format descriptor";
        case CL_INVALID_IMAGE_SIZE:                 return "Invalid image size";
        case CL_INVALID_SAMPLER:                    return "Invalid sampler";
        case CL_INVALID_BINARY:                     return "Invalid binary";
        case CL_INVALID_BUILD_OPTIONS:              return "Invalid build options";
        case CL_INVALID_PROGRAM:                    return "Invalid program";
        case CL_INVALID_PROGRAM_EXECUTABLE:         return "Invalid program executable";
        case CL_INVALID_KERNEL_NAME:                return "Invalid kernel name";
        case CL_INVALID_KERNEL_DEFINITION:          return "Invalid kernel definition";
        case CL_INVALID_KERNEL:                     return "Invalid kernel";
        case CL_INVALID_ARG_INDEX:                  return "Invalid argument index";
        case CL_INVALID_ARG_VALUE:                  return "Invalid argument value";
        case CL_INVALID_ARG_SIZE:                   return "Invalid argument size";
        case CL_INVALID_KERNEL_ARGS:                return "Invalid kernel arguments";
        case CL_INVALID_WORK_DIMENSION:             return "Invalid work dimension";
        case CL_INVALID_WORK_GROUP_SIZE:            return "Invalid work group size";
        case CL_INVALID_WORK_ITEM_SIZE:             return "Invalid work item size";
        case CL_INVALID_GLOBAL_OFFSET:              return "Invalid global offset";
        case CL_INVALID_EVENT_WAIT_LIST:            return "Invalid event wait list";
        case CL_INVALID_EVENT:                      return "Invalid event";
        case CL_INVALID_OPERATION:                  return "Invalid operation";
        case CL_INVALID_GL_OBJECT:                  return "Invalid OpenGL object";
        case CL_INVALID_BUFFER_SIZE:                return "Invalid buffer size";
        case CL_INVALID_MIP_LEVEL:                  return "Invalid mip-map level";
        default:                                    return "Unknown";
    }
}

static void opencl_succeed_fatal(unsigned int ret,
                                 const char *call,
                                 const char *file,
                                 int line) {
  if (ret != CL_SUCCESS) {
    futhark_panic(-1, "%s:%d: OpenCL call\n  %s\nfailed with error code %d (%s)\n",
          file, line, call, ret, opencl_error_string(ret));
  }
}

static char* opencl_succeed_nonfatal(unsigned int ret,
                                     const char *call,
                                     const char *file,
                                     int line) {
  if (ret != CL_SUCCESS) {
    return msgprintf("%s:%d: OpenCL call\n  %s\nfailed with error code %d (%s)\n",
                     file, line, call, ret, opencl_error_string(ret));
  } else {
    return NULL;
  }
}

static void set_preferred_platform(struct opencl_config *cfg, const char *s) {
  cfg->preferred_platform = s;
  cfg->ignore_blacklist = 1;
}

static void set_preferred_device(struct opencl_config *cfg, const char *s) {
  int x = 0;
  if (*s == '#') {
    s++;
    while (isdigit(*s)) {
      x = x * 10 + (*s++)-'0';
    }
    // Skip trailing spaces.
    while (isspace(*s)) {
      s++;
    }
  }
  cfg->preferred_device = s;
  cfg->preferred_device_num = x;
  cfg->ignore_blacklist = 1;
}

static char* opencl_platform_info(cl_platform_id platform,
                                  cl_platform_info param) {
  size_t req_bytes;
  char *info;

  OPENCL_SUCCEED_FATAL(clGetPlatformInfo(platform, param, 0, NULL, &req_bytes));

  info = (char*) malloc(req_bytes);

  OPENCL_SUCCEED_FATAL(clGetPlatformInfo(platform, param, req_bytes, info, NULL));

  return info;
}

static char* opencl_device_info(cl_device_id device,
                                cl_device_info param) {
  size_t req_bytes;
  char *info;

  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device, param, 0, NULL, &req_bytes));

  info = (char*) malloc(req_bytes);

  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device, param, req_bytes, info, NULL));

  return info;
}

static void opencl_all_device_options(struct opencl_device_option **devices_out,
                                      size_t *num_devices_out) {
  size_t num_devices = 0, num_devices_added = 0;

  cl_platform_id *all_platforms;
  cl_uint *platform_num_devices;

  cl_uint num_platforms;

  // Find the number of platforms.
  OPENCL_SUCCEED_FATAL(clGetPlatformIDs(0, NULL, &num_platforms));

  // Make room for them.
  all_platforms = calloc(num_platforms, sizeof(cl_platform_id));
  platform_num_devices = calloc(num_platforms, sizeof(cl_uint));

  // Fetch all the platforms.
  OPENCL_SUCCEED_FATAL(clGetPlatformIDs(num_platforms, all_platforms, NULL));

  // Count the number of devices for each platform, as well as the
  // total number of devices.
  for (cl_uint i = 0; i < num_platforms; i++) {
    if (clGetDeviceIDs(all_platforms[i], CL_DEVICE_TYPE_ALL,
                       0, NULL, &platform_num_devices[i]) == CL_SUCCESS) {
      num_devices += platform_num_devices[i];
    } else {
      platform_num_devices[i] = 0;
    }
  }

  // Make room for all the device options.
  struct opencl_device_option *devices =
    calloc(num_devices, sizeof(struct opencl_device_option));

  // Loop through the platforms, getting information about their devices.
  for (cl_uint i = 0; i < num_platforms; i++) {
    cl_platform_id platform = all_platforms[i];
    cl_uint num_platform_devices = platform_num_devices[i];

    if (num_platform_devices == 0) {
      continue;
    }

    char *platform_name = opencl_platform_info(platform, CL_PLATFORM_NAME);
    cl_device_id *platform_devices =
      calloc(num_platform_devices, sizeof(cl_device_id));

    // Fetch all the devices.
    OPENCL_SUCCEED_FATAL(clGetDeviceIDs(platform, CL_DEVICE_TYPE_ALL,
                                  num_platform_devices, platform_devices, NULL));

    // Loop through the devices, adding them to the devices array.
    for (cl_uint i = 0; i < num_platform_devices; i++) {
      char *device_name = opencl_device_info(platform_devices[i], CL_DEVICE_NAME);
      devices[num_devices_added].platform = platform;
      devices[num_devices_added].device = platform_devices[i];
      OPENCL_SUCCEED_FATAL(clGetDeviceInfo(platform_devices[i], CL_DEVICE_TYPE,
                                     sizeof(cl_device_type),
                                     &devices[num_devices_added].device_type,
                                     NULL));
      // We don't want the structs to share memory, so copy the platform name.
      // Each device name is already unique.
      devices[num_devices_added].platform_name = strclone(platform_name);
      devices[num_devices_added].device_name = device_name;
      num_devices_added++;
    }
    free(platform_devices);
    free(platform_name);
  }
  free(all_platforms);
  free(platform_num_devices);

  *devices_out = devices;
  *num_devices_out = num_devices;
}

// Returns 0 on success.
static int list_devices(struct opencl_config *cfg) {
  struct opencl_device_option *devices;
  size_t num_devices;

  opencl_all_device_options(&devices, &num_devices);

  const char *cur_platform = "";
  for (size_t i = 0; i < num_devices; i++) {
    struct opencl_device_option device = devices[i];
    if (strcmp(cur_platform, device.platform_name) != 0) {
      printf("Platform: %s\n", device.platform_name);
      cur_platform = device.platform_name;
    }
    printf("[%d]: %s\n", (int)i, device.device_name);
  }

  // Free all the platform and device names.
  for (size_t j = 0; j < num_devices; j++) {
    free(devices[j].platform_name);
    free(devices[j].device_name);
  }
  free(devices);

  return 0;
}

// Returns 0 on success.
static int select_device_interactively(struct opencl_config *cfg) {
  struct opencl_device_option *devices;
  size_t num_devices;
  int ret = 1;

  opencl_all_device_options(&devices, &num_devices);

  printf("Choose OpenCL device:\n");
  const char *cur_platform = "";
  for (size_t i = 0; i < num_devices; i++) {
    struct opencl_device_option device = devices[i];
    if (strcmp(cur_platform, device.platform_name) != 0) {
      printf("Platform: %s\n", device.platform_name);
      cur_platform = device.platform_name;
    }
    printf("[%d] %s\n", (int)i, device.device_name);
  }

  int selection;
  printf("Choice: ");
  if (scanf("%d", &selection) == 1) {
    ret = 0;
    cfg->preferred_platform = "";
    cfg->preferred_device = "";
    cfg->preferred_device_num = selection;
    cfg->ignore_blacklist = 1;
  }

  // Free all the platform and device names.
  for (size_t j = 0; j < num_devices; j++) {
    free(devices[j].platform_name);
    free(devices[j].device_name);
  }
  free(devices);

  return ret;
}

static int is_blacklisted(const char *platform_name, const char *device_name,
                          const struct opencl_config *cfg) {
  if (strcmp(cfg->preferred_platform, "") != 0 ||
      strcmp(cfg->preferred_device, "") != 0) {
    return 0;
  } else if (strstr(platform_name, "Apple") != NULL &&
             strstr(device_name, "Intel(R) Core(TM)") != NULL) {
    return 1;
  } else {
    return 0;
  }
}

static struct opencl_device_option get_preferred_device(const struct opencl_config *cfg) {
  struct opencl_device_option *devices;
  size_t num_devices;

  opencl_all_device_options(&devices, &num_devices);

  int num_device_matches = 0;

  for (size_t i = 0; i < num_devices; i++) {
    struct opencl_device_option device = devices[i];
    if (strstr(device.platform_name, cfg->preferred_platform) != NULL &&
        strstr(device.device_name, cfg->preferred_device) != NULL &&
        (cfg->ignore_blacklist ||
         !is_blacklisted(device.platform_name, device.device_name, cfg)) &&
        num_device_matches++ == cfg->preferred_device_num) {
      // Free all the platform and device names, except the ones we have chosen.
      for (size_t j = 0; j < num_devices; j++) {
        if (j != i) {
          free(devices[j].platform_name);
          free(devices[j].device_name);
        }
      }
      free(devices);
      return device;
    }
  }

  futhark_panic(1, "Could not find acceptable OpenCL device.\n");
  exit(1); // Never reached
}

static void describe_device_option(struct opencl_device_option device) {
  fprintf(stderr, "Using platform: %s\n", device.platform_name);
  fprintf(stderr, "Using device: %s\n", device.device_name);
}

static cl_build_status build_opencl_program(cl_program program, cl_device_id device, const char* options) {
  cl_int clBuildProgram_error = clBuildProgram(program, 1, &device, options, NULL, NULL);

  // Avoid termination due to CL_BUILD_PROGRAM_FAILURE
  if (clBuildProgram_error != CL_SUCCESS &&
      clBuildProgram_error != CL_BUILD_PROGRAM_FAILURE) {
    OPENCL_SUCCEED_FATAL(clBuildProgram_error);
  }

  cl_build_status build_status;
  OPENCL_SUCCEED_FATAL(clGetProgramBuildInfo(program,
                                             device,
                                             CL_PROGRAM_BUILD_STATUS,
                                             sizeof(cl_build_status),
                                             &build_status,
                                             NULL));

  if (build_status != CL_SUCCESS) {
    char *build_log;
    size_t ret_val_size;
    OPENCL_SUCCEED_FATAL(clGetProgramBuildInfo(program, device, CL_PROGRAM_BUILD_LOG, 0, NULL, &ret_val_size));

    build_log = (char*) malloc(ret_val_size+1);
    OPENCL_SUCCEED_FATAL(clGetProgramBuildInfo(program, device, CL_PROGRAM_BUILD_LOG, ret_val_size, build_log, NULL));

    // The spec technically does not say whether the build log is zero-terminated, so let's be careful.
    build_log[ret_val_size] = '\0';

    fprintf(stderr, "Build log:\n%s\n", build_log);

    free(build_log);
  }

  return build_status;
}

// Fields in a bitmask indicating which types we must be sure are
// available.
enum opencl_required_type { OPENCL_F64 = 1 };

// We take as input several strings representing the program, because
// C does not guarantee that the compiler supports particularly large
// literals.  Notably, Visual C has a limit of 2048 characters.  The
// array must be NULL-terminated.
static cl_program setup_opencl_with_command_queue(struct opencl_context *ctx,
                                                  cl_command_queue queue,
                                                  const char *srcs[],
                                                  int required_types,
                                                  const char *extra_build_opts[]) {
  int error;

  free_list_init(&ctx->free_list);
  ctx->queue = queue;

  OPENCL_SUCCEED_FATAL(clGetCommandQueueInfo(ctx->queue, CL_QUEUE_CONTEXT, sizeof(cl_context), &ctx->ctx, NULL));

  // Fill out the device info.  This is redundant work if we are
  // called from setup_opencl() (which is the common case), but I
  // doubt it matters much.
  struct opencl_device_option device_option;
  OPENCL_SUCCEED_FATAL(clGetCommandQueueInfo(ctx->queue, CL_QUEUE_DEVICE,
                                       sizeof(cl_device_id),
                                       &device_option.device,
                                       NULL));
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_PLATFORM,
                                 sizeof(cl_platform_id),
                                 &device_option.platform,
                                 NULL));
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_TYPE,
                                 sizeof(cl_device_type),
                                 &device_option.device_type,
                                 NULL));
  device_option.platform_name = opencl_platform_info(device_option.platform, CL_PLATFORM_NAME);
  device_option.device_name = opencl_device_info(device_option.device, CL_DEVICE_NAME);

  ctx->device = device_option.device;

  if (required_types & OPENCL_F64) {
    cl_uint supported;
    OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_PREFERRED_VECTOR_WIDTH_DOUBLE,
                                   sizeof(cl_uint), &supported, NULL));
    if (!supported) {
      futhark_panic(1, "Program uses double-precision floats, but this is not supported on the chosen device: %s\n",
            device_option.device_name);
    }
  }

  size_t max_group_size;
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_MAX_WORK_GROUP_SIZE,
                                 sizeof(size_t), &max_group_size, NULL));

  size_t max_tile_size = sqrt(max_group_size);

  cl_ulong max_local_memory;
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_LOCAL_MEM_SIZE,
                                       sizeof(size_t), &max_local_memory, NULL));

  // Futhark reserves 4 bytes for bookkeeping information.
  max_local_memory -= 4;

  // The OpenCL implementation may reserve some local memory bytes for
  // various purposes.  In principle, we should use
  // clGetKernelWorkGroupInfo() to figure out for each kernel how much
  // is actually available, but our current code generator design
  // makes this infeasible.  Instead, we have this nasty hack where we
  // arbitrarily subtract some bytes, based on empirical measurements
  // (but which might be arbitrarily wrong).  Fortunately, we rarely
  // try to really push the local memory usage.
  if (strstr(device_option.platform_name, "NVIDIA CUDA") != NULL) {
    max_local_memory -= 12;
  } else if (strstr(device_option.platform_name, "AMD") != NULL) {
    max_local_memory -= 16;
  }

  // Make sure this function is defined.
  post_opencl_setup(ctx, &device_option);

  if (max_group_size < ctx->cfg.default_group_size) {
    if (ctx->cfg.default_group_size_changed) {
      fprintf(stderr, "Note: Device limits default group size to %zu (down from %zu).\n",
              max_group_size, ctx->cfg.default_group_size);
    }
    ctx->cfg.default_group_size = max_group_size;
  }

  if (max_tile_size < ctx->cfg.default_tile_size) {
    if (ctx->cfg.default_tile_size_changed) {
      fprintf(stderr, "Note: Device limits default tile size to %zu (down from %zu).\n",
              max_tile_size, ctx->cfg.default_tile_size);
    }
    ctx->cfg.default_tile_size = max_tile_size;
  }

  ctx->max_group_size = max_group_size;
  ctx->max_tile_size = max_tile_size; // No limit.
  ctx->max_threshold = ctx->max_num_groups = 0; // No limit.
  ctx->max_local_memory = max_local_memory;

  // Now we go through all the sizes, clamp them to the valid range,
  // or set them to the default.
  for (int i = 0; i < ctx->cfg.num_sizes; i++) {
    const char *size_class = ctx->cfg.size_classes[i];
    size_t *size_value = &ctx->cfg.size_values[i];
    const char* size_name = ctx->cfg.size_names[i];
    size_t max_value = 0, default_value = 0;
    if (strstr(size_class, "group_size") == size_class) {
      max_value = max_group_size;
      default_value = ctx->cfg.default_group_size;
    } else if (strstr(size_class, "num_groups") == size_class) {
      max_value = max_group_size; // Futhark assumes this constraint.
      default_value = ctx->cfg.default_num_groups;
      // XXX: as a quick and dirty hack, use twice as many threads for
      // histograms by default.  We really should just be smarter
      // about sizes somehow.
      if (strstr(size_name, ".seghist_") != NULL) {
        default_value *= 2;
      }
    } else if (strstr(size_class, "tile_size") == size_class) {
      max_value = sqrt(max_group_size);
      default_value = ctx->cfg.default_tile_size;
    } else if (strstr(size_class, "threshold") == size_class) {
      // Threshold can be as large as it takes.
      default_value = ctx->cfg.default_threshold;
    } else {
      // Bespoke sizes have no limit or default.
    }
    if (*size_value == 0) {
      *size_value = default_value;
    } else if (max_value > 0 && *size_value > max_value) {
      fprintf(stderr, "Note: Device limits %s to %d (down from %d)\n",
              size_name, (int)max_value, (int)*size_value);
      *size_value = max_value;
    }
  }

  if (ctx->lockstep_width == 0) {
    ctx->lockstep_width = 1;
  }

  if (ctx->cfg.logging) {
    fprintf(stderr, "Lockstep width: %d\n", (int)ctx->lockstep_width);
    fprintf(stderr, "Default group size: %d\n", (int)ctx->cfg.default_group_size);
    fprintf(stderr, "Default number of groups: %d\n", (int)ctx->cfg.default_num_groups);
  }

  char *fut_opencl_src = NULL;
  cl_program prog;
  error = CL_SUCCESS;

  if (ctx->cfg.load_binary_from == NULL) {
    size_t src_size = 0;

    // Maybe we have to read OpenCL source from somewhere else (used for debugging).
    if (ctx->cfg.load_program_from != NULL) {
      fut_opencl_src = slurp_file(ctx->cfg.load_program_from, NULL);
      assert(fut_opencl_src != NULL);
    } else {
      // Construct the OpenCL source concatenating all the fragments.
      for (const char **src = srcs; src && *src; src++) {
        src_size += strlen(*src);
      }

      fut_opencl_src = (char*) malloc(src_size + 1);

      size_t n, i;
      for (i = 0, n = 0; srcs && srcs[i]; i++) {
        strncpy(fut_opencl_src+n, srcs[i], src_size-n);
        n += strlen(srcs[i]);
      }
      fut_opencl_src[src_size] = 0;
    }

    if (ctx->cfg.dump_program_to != NULL) {
      if (ctx->cfg.debugging) {
        fprintf(stderr, "Dumping OpenCL source to %s...\n", ctx->cfg.dump_program_to);
      }

      dump_file(ctx->cfg.dump_program_to, fut_opencl_src, strlen(fut_opencl_src));
    }

    if (ctx->cfg.debugging) {
      fprintf(stderr, "Creating OpenCL program...\n");
    }

    const char* src_ptr[] = {fut_opencl_src};
    prog = clCreateProgramWithSource(ctx->ctx, 1, src_ptr, &src_size, &error);
    OPENCL_SUCCEED_FATAL(error);
  } else {
    if (ctx->cfg.debugging) {
      fprintf(stderr, "Loading OpenCL binary from %s...\n", ctx->cfg.load_binary_from);
    }
    size_t binary_size;
    unsigned char *fut_opencl_bin =
      (unsigned char*) slurp_file(ctx->cfg.load_binary_from, &binary_size);
    assert(fut_opencl_bin != NULL);
    const unsigned char *binaries[1] = { fut_opencl_bin };
    cl_int status = 0;

    prog = clCreateProgramWithBinary(ctx->ctx, 1, &device_option.device,
                                     &binary_size, binaries,
                                     &status, &error);

    OPENCL_SUCCEED_FATAL(status);
    OPENCL_SUCCEED_FATAL(error);
  }

  int compile_opts_size = 1024;

  for (int i = 0; i < ctx->cfg.num_sizes; i++) {
    compile_opts_size += strlen(ctx->cfg.size_names[i]) + 20;
  }

  for (int i = 0; extra_build_opts[i] != NULL; i++) {
    compile_opts_size += strlen(extra_build_opts[i] + 1);
  }

  char *compile_opts = (char*) malloc(compile_opts_size);

  int w = snprintf(compile_opts, compile_opts_size,
                   "-DLOCKSTEP_WIDTH=%d ",
                   (int)ctx->lockstep_width);

  for (int i = 0; i < ctx->cfg.num_sizes; i++) {
    w += snprintf(compile_opts+w, compile_opts_size-w,
                  "-D%s=%d ",
                  ctx->cfg.size_vars[i],
                  (int)ctx->cfg.size_values[i]);
  }

  for (int i = 0; extra_build_opts[i] != NULL; i++) {
    w += snprintf(compile_opts+w, compile_opts_size-w,
                  "%s ", extra_build_opts[i]);
  }

  if (ctx->cfg.debugging) {
    fprintf(stderr, "OpenCL compiler options: %s\n", compile_opts);
    fprintf(stderr, "Building OpenCL program...\n");
  }
  OPENCL_SUCCEED_FATAL(build_opencl_program(prog, device_option.device, compile_opts));

  free(compile_opts);
  free(fut_opencl_src);

  if (ctx->cfg.dump_binary_to != NULL) {
    if (ctx->cfg.debugging) {
      fprintf(stderr, "Dumping OpenCL binary to %s...\n", ctx->cfg.dump_binary_to);
    }

    size_t binary_size;
    OPENCL_SUCCEED_FATAL(clGetProgramInfo(prog, CL_PROGRAM_BINARY_SIZES,
                                          sizeof(size_t), &binary_size, NULL));
    unsigned char *binary = (unsigned char*) malloc(binary_size);
    unsigned char *binaries[1] = { binary };
    OPENCL_SUCCEED_FATAL(clGetProgramInfo(prog, CL_PROGRAM_BINARIES,
                                          sizeof(unsigned char*), binaries, NULL));

    dump_file(ctx->cfg.dump_binary_to, binary, binary_size);
  }

  return prog;
}

static cl_program setup_opencl(struct opencl_context *ctx,
                               const char *srcs[],
                               int required_types,
                               const char *extra_build_opts[]) {

  ctx->lockstep_width = 0; // Real value set later.

  struct opencl_device_option device_option = get_preferred_device(&ctx->cfg);

  if (ctx->cfg.logging) {
    describe_device_option(device_option);
  }

  // Note that NVIDIA's OpenCL requires the platform property
  cl_context_properties properties[] = {
    CL_CONTEXT_PLATFORM,
    (cl_context_properties)device_option.platform,
    0
  };

  cl_int clCreateContext_error;
  ctx->ctx = clCreateContext(properties, 1, &device_option.device, NULL, NULL, &clCreateContext_error);
  OPENCL_SUCCEED_FATAL(clCreateContext_error);

  cl_int clCreateCommandQueue_error;
  cl_command_queue queue =
    clCreateCommandQueue(ctx->ctx,
                         device_option.device,
                         ctx->cfg.profiling ? CL_QUEUE_PROFILING_ENABLE : 0,
                         &clCreateCommandQueue_error);
  OPENCL_SUCCEED_FATAL(clCreateCommandQueue_error);

  return setup_opencl_with_command_queue(ctx, queue, srcs, required_types, extra_build_opts);
}

// Count up the runtime all the profiling_records that occured during execution.
// Also clears the buffer of profiling_records.
static cl_int opencl_tally_profiling_records(struct opencl_context *ctx) {
  cl_int err;
  for (int i = 0; i < ctx->profiling_records_used; i++) {
    struct profiling_record record = ctx->profiling_records[i];

    cl_ulong start_t, end_t;

    if ((err = clGetEventProfilingInfo(*record.event,
                                       CL_PROFILING_COMMAND_START,
                                       sizeof(start_t),
                                       &start_t,
                                       NULL)) != CL_SUCCESS) {
      return err;
    }

    if ((err = clGetEventProfilingInfo(*record.event,
                                       CL_PROFILING_COMMAND_END,
                                       sizeof(end_t),
                                       &end_t,
                                       NULL)) != CL_SUCCESS) {
      return err;
    }

    // OpenCL provides nanosecond resolution, but we want
    // microseconds.
    *record.runs += 1;
    *record.runtime += (end_t - start_t)/1000;

    if ((err = clReleaseEvent(*record.event)) != CL_SUCCESS) {
      return err;
    }
    free(record.event);
  }

  ctx->profiling_records_used = 0;

  return CL_SUCCESS;
}

// If profiling, produce an event associated with a profiling record.
static cl_event* opencl_get_event(struct opencl_context *ctx, int *runs, int64_t *runtime) {
    if (ctx->profiling_records_used == ctx->profiling_records_capacity) {
      ctx->profiling_records_capacity *= 2;
      ctx->profiling_records =
        realloc(ctx->profiling_records,
                ctx->profiling_records_capacity *
                sizeof(struct profiling_record));
    }
    cl_event *event = malloc(sizeof(cl_event));
    ctx->profiling_records[ctx->profiling_records_used].event = event;
    ctx->profiling_records[ctx->profiling_records_used].runs = runs;
    ctx->profiling_records[ctx->profiling_records_used].runtime = runtime;
    ctx->profiling_records_used++;
    return event;
}

// Allocate memory from driver. The problem is that OpenCL may perform
// lazy allocation, so we cannot know whether an allocation succeeded
// until the first time we try to use it.  Hence we immediately
// perform a write to see if the allocation succeeded.  This is slow,
// but the assumption is that this operation will be rare (most things
// will go through the free list).
static int opencl_alloc_actual(struct opencl_context *ctx, size_t size, cl_mem *mem_out) {
  int error;
  *mem_out = clCreateBuffer(ctx->ctx, CL_MEM_READ_WRITE, size, NULL, &error);

  if (error != CL_SUCCESS) {
    return error;
  }

  int x = 2;
  error = clEnqueueWriteBuffer(ctx->queue, *mem_out, 1, 0, sizeof(x), &x, 0, NULL, NULL);

  // No need to wait for completion here. clWaitForEvents() cannot
  // return mem object allocation failures. This implies that the
  // buffer is faulted onto the device on enqueue. (Observation by
  // Andreas Kloeckner.)

  return error;
}

static int opencl_alloc(struct opencl_context *ctx, size_t min_size, const char *tag, cl_mem *mem_out) {
  (void)tag;
  if (min_size < sizeof(int)) {
    min_size = sizeof(int);
  }

  size_t size;

  if (free_list_find(&ctx->free_list, min_size, &size, mem_out) == 0) {
    // Successfully found a free block.  Is it big enough?
    //
    // FIXME: we might also want to check whether the block is *too
    // big*, to avoid internal fragmentation.  However, this can
    // sharply impact performance on programs where arrays change size
    // frequently.  Fortunately, such allocations are usually fairly
    // short-lived, as they are necessarily within a loop, so the risk
    // of internal fragmentation resulting in an OOM situation is
    // limited.  However, it would be preferable if we could go back
    // and *shrink* oversize allocations when we encounter an OOM
    // condition.  That is technically feasible, since we do not
    // expose OpenCL pointer values directly to the application, but
    // instead rely on a level of indirection.
    if (size >= min_size) {
      if (ctx->cfg.debugging) {
        fprintf(stderr, "No need to allocate: Found a block in the free list.\n");
      }

      return CL_SUCCESS;
    } else {
      if (ctx->cfg.debugging) {
        fprintf(stderr, "Found a free block, but it was too small.\n");
      }

      // Not just right - free it.
      int error = clReleaseMemObject(*mem_out);
      if (error != CL_SUCCESS) {
        return error;
      }
    }
  }

  // We have to allocate a new block from the driver.  If the
  // allocation does not succeed, then we might be in an out-of-memory
  // situation.  We now start freeing things from the free list until
  // we think we have freed enough that the allocation will succeed.
  // Since we don't know how far the allocation is from fitting, we
  // have to check after every deallocation.  This might be pretty
  // expensive.  Let's hope that this case is hit rarely.

  if (ctx->cfg.debugging) {
    fprintf(stderr, "Actually allocating the desired block.\n");
  }

  int error = opencl_alloc_actual(ctx, min_size, mem_out);

  while (error == CL_MEM_OBJECT_ALLOCATION_FAILURE) {
    if (ctx->cfg.debugging) {
      fprintf(stderr, "Out of OpenCL memory: releasing entry from the free list...\n");
    }
    cl_mem mem;
    if (free_list_first(&ctx->free_list, &mem) == 0) {
      error = clReleaseMemObject(mem);
      if (error != CL_SUCCESS) {
        return error;
      }
    } else {
      break;
    }
    error = opencl_alloc_actual(ctx, min_size, mem_out);
  }

  return error;
}

static int opencl_free(struct opencl_context *ctx, cl_mem mem, const char *tag) {
  size_t size;
  cl_mem existing_mem;

  // If there is already a block with this tag, then remove it.
  if (free_list_find(&ctx->free_list, -1, &size, &existing_mem) == 0) {
    int error = clReleaseMemObject(existing_mem);
    if (error != CL_SUCCESS) {
      return error;
    }
  }

  int error = clGetMemObjectInfo(mem, CL_MEM_SIZE, sizeof(size_t), &size, NULL);

  if (error == CL_SUCCESS) {
    free_list_insert(&ctx->free_list, size, mem, tag);
  }

  return error;
}

static int opencl_free_all(struct opencl_context *ctx) {
  cl_mem mem;
  free_list_pack(&ctx->free_list);
  while (free_list_first(&ctx->free_list, &mem) == 0) {
    int error = clReleaseMemObject(mem);
    if (error != CL_SUCCESS) {
      return error;
    }
  }

  return CL_SUCCESS;
}

// Free everything that belongs to 'ctx', but do not free 'ctx'
// itself.
static void teardown_opencl(struct opencl_context *ctx) {
  (void)opencl_tally_profiling_records(ctx);
  free(ctx->profiling_records);
  (void)opencl_free_all(ctx);
  (void)clReleaseCommandQueue(ctx->queue);
  (void)clReleaseContext(ctx->ctx);
}

// End of opencl.h.

static const char *opencl_program[] =
                  {"#ifdef cl_clang_storage_class_specifiers\n#pragma OPENCL EXTENSION cl_clang_storage_class_specifiers : enable\n#endif\n#pragma OPENCL EXTENSION cl_khr_byte_addressable_store : enable\n__kernel void dummy_kernel(__global unsigned char *dummy, int n)\n{\n    const int thread_gid = get_global_id(0);\n    \n    if (thread_gid >= n)\n        return;\n}\ntypedef char int8_t;\ntypedef short int16_t;\ntypedef int int32_t;\ntypedef long int64_t;\ntypedef uchar uint8_t;\ntypedef ushort uint16_t;\ntypedef uint uint32_t;\ntypedef ulong uint64_t;\n#ifdef cl_nv_pragma_unroll\nstatic inline void mem_fence_global()\n{\n    asm(\"membar.gl;\");\n}\n#else\nstatic inline void mem_fence_global()\n{\n    mem_fence(CLK_LOCAL_MEM_FENCE | CLK_GLOBAL_MEM_FENCE);\n}\n#endif\nstatic inline void mem_fence_local()\n{\n    mem_fence(CLK_LOCAL_MEM_FENCE);\n}\nstatic inline uint8_t add8(uint8_t x, uint8_t y)\n{\n    return x + y;\n}\nstatic inline uint16_t add16(uint16_t x, uint16_t y)\n{\n    return x + y;\n}\nstatic inline uint32_t add32(uint32_t x, uint32_t y)\n{\n    return x + y;\n}\nstatic inline uint64_t add64(uint64_t x, uint64_t y)\n{\n    return x + y;\n}\nstatic inline uint8_t sub8(uint8_t x, uint8_t y)\n{\n    return x - y;\n}\nstatic inline uint16_t sub16(uint16_t x, uint16_t y)\n{\n    return x - y;\n}\nstatic inline uint32_t sub32(uint32_t x, uint32_t y)\n{\n    return x - y;\n}\nstatic inline uint64_t sub64(uint64_t x, uint64_t y)\n{\n    return x - y;\n}\nstatic inline uint8_t mul8(uint8_t x, uint8_t y)\n{\n    return x * y;\n}\nstatic inline uint16_t mul16(uint16_t x, uint16_t y)\n{\n    return x * y;\n}\nstatic inline uint32_t mul32(uint32_t x, uint32_t y)\n{\n    return x * y;\n}\nstatic inline uint64_t mul64(uint64_t x, uint64_t y)\n{\n    return x * y;\n}\nstatic inline uint8_t udiv8(uint8_t x, uint8_t y)\n{\n    return x / y;\n}\nstatic inline uint16_t udiv16(uint16_t x, uint16_t y)\n{\n    return x / y;\n}\nstatic inline uint32_t udiv32(uint32_t x, uint32_t y)\n{\n    return x / y;\n}\nstatic inline uint64_t udiv64(uint64_t x, uint64_t y)\n{\n    return x / y;\n}\nstatic ",
                   "inline uint8_t udiv_up8(uint8_t x, uint8_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint16_t udiv_up16(uint16_t x, uint16_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint32_t udiv_up32(uint32_t x, uint32_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint64_t udiv_up64(uint64_t x, uint64_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint8_t umod8(uint8_t x, uint8_t y)\n{\n    return x % y;\n}\nstatic inline uint16_t umod16(uint16_t x, uint16_t y)\n{\n    return x % y;\n}\nstatic inline uint32_t umod32(uint32_t x, uint32_t y)\n{\n    return x % y;\n}\nstatic inline uint64_t umod64(uint64_t x, uint64_t y)\n{\n    return x % y;\n}\nstatic inline uint8_t udiv_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint16_t udiv_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint32_t udiv_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint64_t udiv_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint8_t udiv_up_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint16_t udiv_up_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint32_t udiv_up_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint64_t udiv_up_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint8_t umod_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint16_t umod_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint32_t umod_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint64_t umod_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int8_t sdiv8(int8_t x, int8_t y)\n{\n    int8_t q = x / y;\n    int8_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int16_t sdiv16(int16",
                   "_t x, int16_t y)\n{\n    int16_t q = x / y;\n    int16_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int32_t sdiv32(int32_t x, int32_t y)\n{\n    int32_t q = x / y;\n    int32_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int64_t sdiv64(int64_t x, int64_t y)\n{\n    int64_t q = x / y;\n    int64_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int8_t sdiv_up8(int8_t x, int8_t y)\n{\n    return sdiv8(x + y - 1, y);\n}\nstatic inline int16_t sdiv_up16(int16_t x, int16_t y)\n{\n    return sdiv16(x + y - 1, y);\n}\nstatic inline int32_t sdiv_up32(int32_t x, int32_t y)\n{\n    return sdiv32(x + y - 1, y);\n}\nstatic inline int64_t sdiv_up64(int64_t x, int64_t y)\n{\n    return sdiv64(x + y - 1, y);\n}\nstatic inline int8_t smod8(int8_t x, int8_t y)\n{\n    int8_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int16_t smod16(int16_t x, int16_t y)\n{\n    int16_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int32_t smod32(int32_t x, int32_t y)\n{\n    int32_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int64_t smod64(int64_t x, int64_t y)\n{\n    int64_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int8_t sdiv_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : sdiv8(x, y);\n}\nstatic inline int16_t sdiv_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : sdiv16(x, y);\n}\nstatic inline int32_t sdiv_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : sdiv32(x, y);\n}\nstatic inline int64_t sdiv_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : sdiv64(x, y);\n}\nstatic inline int8_t sdiv_up_safe8(int8_t x, int8_t y)\n{\n    return sdiv_safe8(x + y - 1, y);\n}\nstatic inline int16_t sdiv_up_safe16(int16_t x, int16_t y)\n{\n    return sdiv_safe16(x + y - 1, y",
                   ");\n}\nstatic inline int32_t sdiv_up_safe32(int32_t x, int32_t y)\n{\n    return sdiv_safe32(x + y - 1, y);\n}\nstatic inline int64_t sdiv_up_safe64(int64_t x, int64_t y)\n{\n    return sdiv_safe64(x + y - 1, y);\n}\nstatic inline int8_t smod_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : smod8(x, y);\n}\nstatic inline int16_t smod_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : smod16(x, y);\n}\nstatic inline int32_t smod_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : smod32(x, y);\n}\nstatic inline int64_t smod_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : smod64(x, y);\n}\nstatic inline int8_t squot8(int8_t x, int8_t y)\n{\n    return x / y;\n}\nstatic inline int16_t squot16(int16_t x, int16_t y)\n{\n    return x / y;\n}\nstatic inline int32_t squot32(int32_t x, int32_t y)\n{\n    return x / y;\n}\nstatic inline int64_t squot64(int64_t x, int64_t y)\n{\n    return x / y;\n}\nstatic inline int8_t srem8(int8_t x, int8_t y)\n{\n    return x % y;\n}\nstatic inline int16_t srem16(int16_t x, int16_t y)\n{\n    return x % y;\n}\nstatic inline int32_t srem32(int32_t x, int32_t y)\n{\n    return x % y;\n}\nstatic inline int64_t srem64(int64_t x, int64_t y)\n{\n    return x % y;\n}\nstatic inline int8_t squot_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int16_t squot_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int32_t squot_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int64_t squot_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int8_t srem_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int16_t srem_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int32_t srem_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int64_t srem_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int8_t smin8(int8_t x, int8_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int16_t smi",
                   "n16(int16_t x, int16_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int32_t smin32(int32_t x, int32_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int64_t smin64(int64_t x, int64_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint8_t umin8(uint8_t x, uint8_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint16_t umin16(uint16_t x, uint16_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint32_t umin32(uint32_t x, uint32_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint64_t umin64(uint64_t x, uint64_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int8_t smax8(int8_t x, int8_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int16_t smax16(int16_t x, int16_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int32_t smax32(int32_t x, int32_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int64_t smax64(int64_t x, int64_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint8_t umax8(uint8_t x, uint8_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint16_t umax16(uint16_t x, uint16_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint32_t umax32(uint32_t x, uint32_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint64_t umax64(uint64_t x, uint64_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint8_t shl8(uint8_t x, uint8_t y)\n{\n    return x << y;\n}\nstatic inline uint16_t shl16(uint16_t x, uint16_t y)\n{\n    return x << y;\n}\nstatic inline uint32_t shl32(uint32_t x, uint32_t y)\n{\n    return x << y;\n}\nstatic inline uint64_t shl64(uint64_t x, uint64_t y)\n{\n    return x << y;\n}\nstatic inline uint8_t lshr8(uint8_t x, uint8_t y)\n{\n    return x >> y;\n}\nstatic inline uint16_t lshr16(uint16_t x, uint16_t y)\n{\n    return x >> y;\n}\nstatic inline uint32_t lshr32(uint32_t x, uint32_t y)\n{\n    return x >> y;\n}\nstatic inline uint64_t lshr64(uint64_t x, uint64_t y)\n{\n    return x >> y;\n}\nstatic inline int8_t ashr8(int8_t x, int8_t y)\n{\n    return x >> y;\n}\nstatic inline int16_t ashr16(int16_t x, int16_t y)\n{\n    return x >> y;\n}\nstatic inline int32_t ashr32(int32_t x, int32_t y)",
                   "\n{\n    return x >> y;\n}\nstatic inline int64_t ashr64(int64_t x, int64_t y)\n{\n    return x >> y;\n}\nstatic inline uint8_t and8(uint8_t x, uint8_t y)\n{\n    return x & y;\n}\nstatic inline uint16_t and16(uint16_t x, uint16_t y)\n{\n    return x & y;\n}\nstatic inline uint32_t and32(uint32_t x, uint32_t y)\n{\n    return x & y;\n}\nstatic inline uint64_t and64(uint64_t x, uint64_t y)\n{\n    return x & y;\n}\nstatic inline uint8_t or8(uint8_t x, uint8_t y)\n{\n    return x | y;\n}\nstatic inline uint16_t or16(uint16_t x, uint16_t y)\n{\n    return x | y;\n}\nstatic inline uint32_t or32(uint32_t x, uint32_t y)\n{\n    return x | y;\n}\nstatic inline uint64_t or64(uint64_t x, uint64_t y)\n{\n    return x | y;\n}\nstatic inline uint8_t xor8(uint8_t x, uint8_t y)\n{\n    return x ^ y;\n}\nstatic inline uint16_t xor16(uint16_t x, uint16_t y)\n{\n    return x ^ y;\n}\nstatic inline uint32_t xor32(uint32_t x, uint32_t y)\n{\n    return x ^ y;\n}\nstatic inline uint64_t xor64(uint64_t x, uint64_t y)\n{\n    return x ^ y;\n}\nstatic inline bool ult8(uint8_t x, uint8_t y)\n{\n    return x < y;\n}\nstatic inline bool ult16(uint16_t x, uint16_t y)\n{\n    return x < y;\n}\nstatic inline bool ult32(uint32_t x, uint32_t y)\n{\n    return x < y;\n}\nstatic inline bool ult64(uint64_t x, uint64_t y)\n{\n    return x < y;\n}\nstatic inline bool ule8(uint8_t x, uint8_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule16(uint16_t x, uint16_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule32(uint32_t x, uint32_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule64(uint64_t x, uint64_t y)\n{\n    return x <= y;\n}\nstatic inline bool slt8(int8_t x, int8_t y)\n{\n    return x < y;\n}\nstatic inline bool slt16(int16_t x, int16_t y)\n{\n    return x < y;\n}\nstatic inline bool slt32(int32_t x, int32_t y)\n{\n    return x < y;\n}\nstatic inline bool slt64(int64_t x, int64_t y)\n{\n    return x < y;\n}\nstatic inline bool sle8(int8_t x, int8_t y)\n{\n    return x <= y;\n}\nstatic inline bool sle16(int16_t x, int16_t y)\n{\n    return x <= y;\n}\nstatic inline bool sle32(int32_t x, int32_",
                   "t y)\n{\n    return x <= y;\n}\nstatic inline bool sle64(int64_t x, int64_t y)\n{\n    return x <= y;\n}\nstatic inline int8_t pow8(int8_t x, int8_t y)\n{\n    int8_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int16_t pow16(int16_t x, int16_t y)\n{\n    int16_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int32_t pow32(int32_t x, int32_t y)\n{\n    int32_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int64_t pow64(int64_t x, int64_t y)\n{\n    int64_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline bool itob_i8_bool(int8_t x)\n{\n    return x;\n}\nstatic inline bool itob_i16_bool(int16_t x)\n{\n    return x;\n}\nstatic inline bool itob_i32_bool(int32_t x)\n{\n    return x;\n}\nstatic inline bool itob_i64_bool(int64_t x)\n{\n    return x;\n}\nstatic inline int8_t btoi_bool_i8(bool x)\n{\n    return x;\n}\nstatic inline int16_t btoi_bool_i16(bool x)\n{\n    return x;\n}\nstatic inline int32_t btoi_bool_i32(bool x)\n{\n    return x;\n}\nstatic inline int64_t btoi_bool_i64(bool x)\n{\n    return x;\n}\n#define sext_i8_i8(x) ((int8_t) (int8_t) x)\n#define sext_i8_i16(x) ((int16_t) (int8_t) x)\n#define sext_i8_i32(x) ((int32_t) (int8_t) x)\n#define sext_i8_i64(x) ((int64_t) (int8_t) x)\n#define sext_i16_i8(x) ((int8_t) (int16_t) x)\n#define sext_i16_i16(x) ((int16_t) (int16_t) x)\n#define sext_i16_i32(x) ((int32_t) (int16_t) x)\n#define sext_i16_i64(x) ((int64_t) (int16_t) x)\n#define sext_i32_i8(x) ((int8_t) (int32_t) x)\n#define sext_i32_i16(x) ((int16_t) (int32_t) x)\n#define sext_i32_i32(x) ((int32_t) (int32_t) x)\n#define sext_i32_i64(x) ((int64_t) (int32_t) x)\n#defi",
                   "ne sext_i64_i8(x) ((int8_t) (int64_t) x)\n#define sext_i64_i16(x) ((int16_t) (int64_t) x)\n#define sext_i64_i32(x) ((int32_t) (int64_t) x)\n#define sext_i64_i64(x) ((int64_t) (int64_t) x)\n#define zext_i8_i8(x) ((int8_t) (uint8_t) x)\n#define zext_i8_i16(x) ((int16_t) (uint8_t) x)\n#define zext_i8_i32(x) ((int32_t) (uint8_t) x)\n#define zext_i8_i64(x) ((int64_t) (uint8_t) x)\n#define zext_i16_i8(x) ((int8_t) (uint16_t) x)\n#define zext_i16_i16(x) ((int16_t) (uint16_t) x)\n#define zext_i16_i32(x) ((int32_t) (uint16_t) x)\n#define zext_i16_i64(x) ((int64_t) (uint16_t) x)\n#define zext_i32_i8(x) ((int8_t) (uint32_t) x)\n#define zext_i32_i16(x) ((int16_t) (uint32_t) x)\n#define zext_i32_i32(x) ((int32_t) (uint32_t) x)\n#define zext_i32_i64(x) ((int64_t) (uint32_t) x)\n#define zext_i64_i8(x) ((int8_t) (uint64_t) x)\n#define zext_i64_i16(x) ((int16_t) (uint64_t) x)\n#define zext_i64_i32(x) ((int32_t) (uint64_t) x)\n#define zext_i64_i64(x) ((int64_t) (uint64_t) x)\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_popc8(int8_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    return popcount(x);\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_popc8(int8_t x)\n{\n    return __popc(zext_i8_i32(x));\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    return __popc(zext_i16_i32(x));\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    return __popc(x);\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    return __popcll(x);\n}\n#else\nstatic int32_t futrts_popc8(int8_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    int c = 0;\n    \n    for ",
                   "(; x; ++c)\n        x &= x - 1;\n    return c;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    return mul_hi(a, b);\n}\n#elif defined(__CUDA_ARCH__)\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    uint16_t aa = a;\n    uint16_t bb = b;\n    \n    return aa * bb >> 8;\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    uint32_t aa = a;\n    uint32_t bb = b;\n    \n    return aa * bb >> 16;\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    return mulhi(a, b);\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    return mul64hi(a, b);\n}\n#else\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    uint16_t aa = a;\n    uint16_t bb = b;\n    \n    return aa * bb >> 8;\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    uint32_t aa = a;\n    uint32_t bb = b;\n    \n    return aa * bb >> 16;\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    uint64_t aa = a;\n    uint64_t bb = b;\n    \n    return aa * bb >> 32;\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    __uint128_t aa = a;\n    __uint128_t bb = b;\n    \n    return aa * bb >> 64;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)\n{\n    return mad_hi(a, b, c);\n}\n#else\nstatic uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)\n{\n    return futrts_mul_hi8(a, b) + c;\n}\nstatic uint16_t futrts_mad_hi16(uin",
                   "t16_t a, uint16_t b, uint16_t c)\n{\n    return futrts_mul_hi16(a, b) + c;\n}\nstatic uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)\n{\n    return futrts_mul_hi32(a, b) + c;\n}\nstatic uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)\n{\n    return futrts_mul_hi64(a, b) + c;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    return clz(x);\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    return __clz(zext_i8_i32(x)) - 24;\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    return __clz(zext_i16_i32(x)) - 16;\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    return __clz(x);\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    return __clzll(x);\n}\n#else\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    int i = 0;\n    \n    for (; i < 8 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz16(int16_t ",
                   "x)\n{\n    int i = 0;\n    \n    for (; i < 16 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    int i = 0;\n    \n    for (; i < 32 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    int i = 0;\n    \n    for (; i < 64 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 8 : y - 1;\n}\nstatic int32_t futrts_ctzz16(int16_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 16 : y - 1;\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 32 : y - 1;\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    int y = __ffsll(x);\n    \n    return y == 0 ? 64 : y - 1;\n}\n#else\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    return x == 0 ? 8 : __builtin_ctz((uint32_t) x);\n}\nstatic int32_t futrts_ctzz16(int16_t x)\n{\n    return x == 0 ? 16 : __builtin_ctz((uint32_t) x);\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    return x == 0 ? 32 : __builtin_ctz(x);\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    return x == 0 ? 64 : __builtin_ctzl(x);\n}\n#endif\nstatic inline float fdiv32(float x, float y)\n{\n    return x / y;\n}\nstatic inline float fadd32(float x, float y)\n{\n    return x + y;\n}\nstatic inline float fsub32(float x, float y)\n{\n    return x - y;\n}\nstatic inline float fmul32(float x, float y)\n{\n    return x * y;\n}\nstatic inline float fmin32(float x, float y)\n{\n    return fmin(x, y);\n}\nstatic inline float fmax32(float x, float y)\n{\n    return fmax(x, y);\n}\nstatic inline float fpow32(float x, float y)\n{\n    return pow(x, y);\n}\nstatic inline bool cmplt32(float x, float y)\n{\n    return x < y;\n}\nstatic inline bool cmple32(float x, float y)\n{\n    return x <= y;\n}\nstatic inline float sitofp_i8_f32(int8_t x)\n{\n    return (float) x;\n}\nstatic inline float sitofp_i16_f32(int16_t x)\n{\n    return (float) x;\n}\nstatic inline float sitofp_i32_f32(int32_t x)",
                   "\n{\n    return (float) x;\n}\nstatic inline float sitofp_i64_f32(int64_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i8_f32(uint8_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i16_f32(uint16_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i32_f32(uint32_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i64_f32(uint64_t x)\n{\n    return (float) x;\n}\nstatic inline int8_t fptosi_f32_i8(float x)\n{\n    return (int8_t) x;\n}\nstatic inline int16_t fptosi_f32_i16(float x)\n{\n    return (int16_t) x;\n}\nstatic inline int32_t fptosi_f32_i32(float x)\n{\n    return (int32_t) x;\n}\nstatic inline int64_t fptosi_f32_i64(float x)\n{\n    return (int64_t) x;\n}\nstatic inline uint8_t fptoui_f32_i8(float x)\n{\n    return (uint8_t) x;\n}\nstatic inline uint16_t fptoui_f32_i16(float x)\n{\n    return (uint16_t) x;\n}\nstatic inline uint32_t fptoui_f32_i32(float x)\n{\n    return (uint32_t) x;\n}\nstatic inline uint64_t fptoui_f32_i64(float x)\n{\n    return (uint64_t) x;\n}\nstatic inline float futrts_log32(float x)\n{\n    return log(x);\n}\nstatic inline float futrts_log2_32(float x)\n{\n    return log2(x);\n}\nstatic inline float futrts_log10_32(float x)\n{\n    return log10(x);\n}\nstatic inline float futrts_sqrt32(float x)\n{\n    return sqrt(x);\n}\nstatic inline float futrts_exp32(float x)\n{\n    return exp(x);\n}\nstatic inline float futrts_cos32(float x)\n{\n    return cos(x);\n}\nstatic inline float futrts_sin32(float x)\n{\n    return sin(x);\n}\nstatic inline float futrts_tan32(float x)\n{\n    return tan(x);\n}\nstatic inline float futrts_acos32(float x)\n{\n    return acos(x);\n}\nstatic inline float futrts_asin32(float x)\n{\n    return asin(x);\n}\nstatic inline float futrts_atan32(float x)\n{\n    return atan(x);\n}\nstatic inline float futrts_cosh32(float x)\n{\n    return cosh(x);\n}\nstatic inline float futrts_sinh32(float x)\n{\n    return sinh(x);\n}\nstatic inline float futrts_tanh32(float x)\n{\n    return tanh(x);\n}\nstatic inline float futrts_acosh32(float x)\n{\n    return acosh(x);\n}\nstatic inline fl",
                   "oat futrts_asinh32(float x)\n{\n    return asinh(x);\n}\nstatic inline float futrts_atanh32(float x)\n{\n    return atanh(x);\n}\nstatic inline float futrts_atan2_32(float x, float y)\n{\n    return atan2(x, y);\n}\nstatic inline float futrts_gamma32(float x)\n{\n    return tgamma(x);\n}\nstatic inline float futrts_lgamma32(float x)\n{\n    return lgamma(x);\n}\nstatic inline bool futrts_isnan32(float x)\n{\n    return isnan(x);\n}\nstatic inline bool futrts_isinf32(float x)\n{\n    return isinf(x);\n}\nstatic inline int32_t futrts_to_bits32(float x)\n{\n    union {\n        float f;\n        int32_t t;\n    } p;\n    \n    p.f = x;\n    return p.t;\n}\nstatic inline float futrts_from_bits32(int32_t x)\n{\n    union {\n        int32_t f;\n        float t;\n    } p;\n    \n    p.f = x;\n    return p.t;\n}\n#ifdef __OPENCL_VERSION__\nstatic inline float fmod32(float x, float y)\n{\n    return fmod(x, y);\n}\nstatic inline float futrts_round32(float x)\n{\n    return rint(x);\n}\nstatic inline float futrts_floor32(float x)\n{\n    return floor(x);\n}\nstatic inline float futrts_ceil32(float x)\n{\n    return ceil(x);\n}\nstatic inline float futrts_lerp32(float v0, float v1, float t)\n{\n    return mix(v0, v1, t);\n}\nstatic inline float futrts_mad32(float a, float b, float c)\n{\n    return mad(a, b, c);\n}\nstatic inline float futrts_fma32(float a, float b, float c)\n{\n    return fma(a, b, c);\n}\n#else\nstatic inline float fmod32(float x, float y)\n{\n    return fmodf(x, y);\n}\nstatic inline float futrts_round32(float x)\n{\n    return rintf(x);\n}\nstatic inline float futrts_floor32(float x)\n{\n    return floorf(x);\n}\nstatic inline float futrts_ceil32(float x)\n{\n    return ceilf(x);\n}\nstatic inline float futrts_lerp32(float v0, float v1, float t)\n{\n    return v0 + (v1 - v0) * t;\n}\nstatic inline float futrts_mad32(float a, float b, float c)\n{\n    return a * b + c;\n}\nstatic inline float futrts_fma32(float a, float b, float c)\n{\n    return fmaf(a, b, c);\n}\n#endif\n// Start of atomics.h\n\ninline int32_t atomic_add_i32_global(volatile __global int32_t *p, ",
                   "int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((int32_t*)p, x);\n#else\n  return atomic_add(p, x);\n#endif\n}\n\ninline int32_t atomic_add_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((int32_t*)p, x);\n#else\n  return atomic_add(p, x);\n#endif\n}\n\ninline float atomic_fadd_f32_global(volatile __global float *p, float x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((float*)p, x);\n#else\n  union { int32_t i; float f; } old;\n  union { int32_t i; float f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg((volatile __global int32_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\ninline float atomic_fadd_f32_local(volatile __local float *p, float x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((float*)p, x);\n#else\n  union { int32_t i; float f; } old;\n  union { int32_t i; float f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg((volatile __local int32_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\ninline int32_t atomic_smax_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline int32_t atomic_smax_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline int32_t atomic_smin_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline int32_t atomic_smin_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline uint32_t atomic_umax_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p",
                   ", x);\n#endif\n}\n\ninline uint32_t atomic_umax_i32_local(volatile __local uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline uint32_t atomic_umin_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline uint32_t atomic_umin_i32_local(volatile __local uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline int32_t atomic_and_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\ninline int32_t atomic_and_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\ninline int32_t atomic_or_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\ninline int32_t atomic_or_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\ninline int32_t atomic_xor_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xor_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xchg_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xchg_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t",
                   " atomic_cmpxchg_i32_global(volatile __global int32_t *p,\n                                         int32_t cmp, int32_t val) {\n#ifdef FUTHARK_CUDA\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\ninline int32_t atomic_cmpxchg_i32_local(volatile __local int32_t *p,\n                                         int32_t cmp, int32_t val) {\n#ifdef FUTHARK_CUDA\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\n// End of atomics.h\n\n\n\n\n__kernel void builtinzhreplicate_i64zireplicate_19876(__global\n                                                      unsigned char *mem_19872,\n                                                      int32_t num_elems_19873,\n                                                      int64_t val_19874)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t replicate_gtid_19876;\n    int32_t replicate_ltid_19877;\n    int32_t replicate_gid_19878;\n    \n    replicate_gtid_19876 = get_global_id(0);\n    replicate_ltid_19877 = get_local_id(0);\n    replicate_gid_19878 = get_group_id(0);\n    if (slt64(replicate_gtid_19876, num_elems_19873)) {\n        ((__global int64_t *) mem_19872)[sext_i32_i64(replicate_gtid_19876)] =\n            val_19874;\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32(__local volatile\n                                    int64_t *block_9_backing_aligned_0,\n                                    int32_t destoffset_1, int32_t srcoffset_3,\n                                    int32_t num_arrays_4, int32_t x_elems_5,\n                                    int32_t y_elems_6, int32_t mulx_7,\n                                    int32_t muly_8, __global\n                                    unsigned char *destmem_0, __global\n                                    unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile c",
                   "har *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_global_id_0_37;\n    int32_t y_index_32 = get_group_id_1_41 * 32 + get_local_id_1_39;\n    \n    if (slt32(x_index_31, x_elems_5)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_in_35 = (y_index_32 + j_43 * 8) * x_elems_5 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, y_elems_6)) {\n                ((__local float *) block_9)[sext_i32_i64((get_local_id_1_39 +\n                                                          j_43 * 8) * 33 +\n                                            get_local_id_0_38)] = ((__global\n                                                                    float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                       index_in_35)];\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 32 + get_local_id_0_38;\n    y_index_32 = get_group_id_0_40 * 32 + get_local_id_1_39;\n    if (slt32(x_inde",
                   "x_31, y_elems_6)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_out_36 = (y_index_32 + j_43 * 8) * y_elems_6 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, x_elems_5)) {\n                ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                               index_out_36)] = ((__local\n                                                                  float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                    33 +\n                                                                                    get_local_id_1_39 +\n                                                                                    j_43 *\n                                                                                    8)];\n            }\n        }\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_low_height(__local volatile\n                                               int64_t *block_9_backing_aligned_0,\n                                               int32_t destoffset_1,\n                                               int32_t srcoffset_3,\n                                               int32_t num_arrays_4,\n                                               int32_t x_elems_5,\n                                               int32_t y_elems_6,\n                                               int32_t mulx_7, int32_t muly_8,\n                                               __global\n                                               unsigned char *destmem_0,\n                                               __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *",
                   "block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_0_38 +\n            srem32(get_local_id_1_39, mulx_7) * 16;\n    int32_t y_index_32 = get_group_id_1_41 * 16 + squot32(get_local_id_1_39,\n                                                          mulx_7);\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local float *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                    get_local_id_0_38)] = ((__global\n                                                            float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                               index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 + squot32(get_local_id_0_38, mulx_7);\n    y_index_32 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_1_39 +\n        srem32(get_local_id_0_38, mulx_7) * 16;\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_o",
                   "ffset_33 +\n                                       index_out_36)] = ((__local\n                                                          float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                            17 +\n                                                                            get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_low_width(__local volatile\n                                              int64_t *block_9_backing_aligned_0,\n                                              int32_t destoffset_1,\n                                              int32_t srcoffset_3,\n                                              int32_t num_arrays_4,\n                                              int32_t x_elems_5,\n                                              int32_t y_elems_6, int32_t mulx_7,\n                                              int32_t muly_8, __global\n                                              unsigned char *destmem_0, __global\n                                              unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group",
                   "_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 + squot32(get_local_id_0_38,\n                                                          muly_8);\n    int32_t y_index_32 = get_group_id_1_41 * 16 * muly_8 + get_local_id_1_39 +\n            srem32(get_local_id_0_38, muly_8) * 16;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local float *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                    get_local_id_0_38)] = ((__global\n                                                            float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                               index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 * muly_8 + get_local_id_0_38 +\n        srem32(get_local_id_1_39, muly_8) * 16;\n    y_index_32 = get_group_id_0_40 * 16 + squot32(get_local_id_1_39, muly_8);\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__local\n                                                          float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                            17 +\n                                                                            get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_small(__local volatile\n                                          int64_t *block_9_backing_aligned_0,\n                                          int32_t destoffset_1,\n      ",
                   "                                    int32_t srcoffset_3,\n                                          int32_t num_arrays_4,\n                                          int32_t x_elems_5, int32_t y_elems_6,\n                                          int32_t mulx_7, int32_t muly_8,\n                                          __global unsigned char *destmem_0,\n                                          __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = squot32(get_global_id_0_37, y_elems_6 *\n                                          x_elems_5) * (y_elems_6 * x_elems_5);\n    int32_t x_index_31 = squot32(srem32(get_global_id_0_37, y_elems_6 *\n                                        x_elems_5), y_elems_6);\n    int32_t y_index_32 = srem32(get_global_id_0_37, y_elems_6);\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    int32_t index_out_36 = x_index_31 * y_elems_6 + y_index_32;\n    \n    if (slt32(get_global_id_0_37, x_elems_5 * y_elems_6 * num_arrays_4)) {\n        ((__glob",
                   "al float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__global\n                                                          float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                             index_in_35)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i64(__local volatile\n                                    int64_t *block_9_backing_aligned_0,\n                                    int32_t destoffset_1, int32_t srcoffset_3,\n                                    int32_t num_arrays_4, int32_t x_elems_5,\n                                    int32_t y_elems_6, int32_t mulx_7,\n                                    int32_t muly_8, __global\n                                    unsigned char *destmem_0, __global\n                                    unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 8) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 8) + our_array_offset_30;\n    int32_t x_index_31 = g",
                   "et_global_id_0_37;\n    int32_t y_index_32 = get_group_id_1_41 * 32 + get_local_id_1_39;\n    \n    if (slt32(x_index_31, x_elems_5)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_in_35 = (y_index_32 + j_43 * 8) * x_elems_5 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, y_elems_6)) {\n                ((__local int64_t *) block_9)[sext_i32_i64((get_local_id_1_39 +\n                                                            j_43 * 8) * 33 +\n                                              get_local_id_0_38)] = ((__global\n                                                                      int64_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                           index_in_35)];\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 32 + get_local_id_0_38;\n    y_index_32 = get_group_id_0_40 * 32 + get_local_id_1_39;\n    if (slt32(x_index_31, y_elems_6)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_out_36 = (y_index_32 + j_43 * 8) * y_elems_6 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, x_elems_5)) {\n                ((__global int64_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                                 index_out_36)] = ((__local\n                                                                    int64_t *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                        33 +\n                                                                                        get_local_id_1_39 +\n                                                                                        j_43 *\n                                                                                        8)];\n            }\n        }\n    }\n    \n  error_0:\n    return",
                   ";\n}\n__kernel void gpu_map_transpose_i64_low_height(__local volatile\n                                               int64_t *block_9_backing_aligned_0,\n                                               int32_t destoffset_1,\n                                               int32_t srcoffset_3,\n                                               int32_t num_arrays_4,\n                                               int32_t x_elems_5,\n                                               int32_t y_elems_6,\n                                               int32_t mulx_7, int32_t muly_8,\n                                               __global\n                                               unsigned char *destmem_0,\n                                               __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 8) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 8) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_0_38 +\n            srem32(get_local_id_1_39, mulx_7) * 16;\n    int32_t y_index",
                   "_32 = get_group_id_1_41 * 16 + squot32(get_local_id_1_39,\n                                                          mulx_7);\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local int64_t *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                      get_local_id_0_38)] = ((__global\n                                                              int64_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                   index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 + squot32(get_local_id_0_38, mulx_7);\n    y_index_32 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_1_39 +\n        srem32(get_local_id_0_38, mulx_7) * 16;\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global int64_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                         index_out_36)] = ((__local\n                                                            int64_t *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                17 +\n                                                                                get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i64_low_width(__local volatile\n                                              int64_t *block_9_backing_aligned_0,\n                                              int32_t destoffset_1,\n                                              int32_t srcoffset_3,\n                                              int32_t num_arrays_4,\n                                              int32_t x_elems_5,\n                                              int32_t y_elems_6, int32_t mulx_7,\n                        ",
                   "                      int32_t muly_8, __global\n                                              unsigned char *destmem_0, __global\n                                              unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 8) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 8) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 + squot32(get_local_id_0_38,\n                                                          muly_8);\n    int32_t y_index_32 = get_group_id_1_41 * 16 * muly_8 + get_local_id_1_39 +\n            srem32(get_local_id_0_38, muly_8) * 16;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local int64_t *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                      get_local_id_0_38)] = ((__global\n                                                              int64_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                     ",
                   "                              index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 * muly_8 + get_local_id_0_38 +\n        srem32(get_local_id_1_39, muly_8) * 16;\n    y_index_32 = get_group_id_0_40 * 16 + squot32(get_local_id_1_39, muly_8);\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global int64_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                         index_out_36)] = ((__local\n                                                            int64_t *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                17 +\n                                                                                get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i64_small(__local volatile\n                                          int64_t *block_9_backing_aligned_0,\n                                          int32_t destoffset_1,\n                                          int32_t srcoffset_3,\n                                          int32_t num_arrays_4,\n                                          int32_t x_elems_5, int32_t y_elems_6,\n                                          int32_t mulx_7, int32_t muly_8,\n                                          __global unsigned char *destmem_0,\n                                          __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n ",
                   "   \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = squot32(get_global_id_0_37, y_elems_6 *\n                                          x_elems_5) * (y_elems_6 * x_elems_5);\n    int32_t x_index_31 = squot32(srem32(get_global_id_0_37, y_elems_6 *\n                                        x_elems_5), y_elems_6);\n    int32_t y_index_32 = srem32(get_global_id_0_37, y_elems_6);\n    int32_t odata_offset_33 = squot32(destoffset_1, 8) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 8) + our_array_offset_30;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    int32_t index_out_36 = x_index_31 * y_elems_6 + y_index_32;\n    \n    if (slt32(get_global_id_0_37, x_elems_5 * y_elems_6 * num_arrays_4)) {\n        ((__global int64_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                         index_out_36)] = ((__global\n                                                            int64_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                 index_in_35)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void mainzicopy_19995(int64_t paths_16674, int64_t res_16723, __global\n                               unsigned char *mem_19277,\n                               int32_t num_subhistos_19971, __global\n                               unsigned char *res_r_subhistos_mem_19972)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_19995;\n    int32_t copy_ltid_19996;\n    int32_t copy_gid_19997;\n    \n    copy_gtid_19995 = get_global_id(0);\n    copy_ltid_19996",
                   " = get_local_id(0);\n    copy_gid_19997 = get_group_id(0);\n    if (slt64(sext_i32_i64(copy_gtid_19995), paths_16674 * res_16723)) {\n        ((__global\n          int64_t *) res_r_subhistos_mem_19972)[squot64(sext_i32_i64(copy_gtid_19995),\n                                                        res_16723) *\n                                                (res_16723 *\n                                                 num_subhistos_19971) +\n                                                (sext_i32_i64(copy_gtid_19995) -\n                                                 squot64(sext_i32_i64(copy_gtid_19995),\n                                                         res_16723) *\n                                                 res_16723)] = ((__global\n                                                                 int64_t *) mem_19277)[squot64(sext_i32_i64(copy_gtid_19995),\n                                                                                               res_16723) *\n                                                                                       res_16723 +\n                                                                                       (sext_i32_i64(copy_gtid_19995) -\n                                                                                        squot64(sext_i32_i64(copy_gtid_19995),\n                                                                                                res_16723) *\n                                                                                        res_16723)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void mainzicopy_20049(int64_t paths_16674, int64_t res_16723, __global\n                               unsigned char *mem_19277,\n                               int32_t num_subhistos_19971, __global\n                               unsigned char *res_r_subhistos_mem_19972)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_20049;\n    int32_t copy_ltid_",
                   "20050;\n    int32_t copy_gid_20051;\n    \n    copy_gtid_20049 = get_global_id(0);\n    copy_ltid_20050 = get_local_id(0);\n    copy_gid_20051 = get_group_id(0);\n    if (slt64(sext_i32_i64(copy_gtid_20049), paths_16674 * res_16723)) {\n        ((__global\n          int64_t *) res_r_subhistos_mem_19972)[squot64(sext_i32_i64(copy_gtid_20049),\n                                                        res_16723) *\n                                                (res_16723 *\n                                                 num_subhistos_19971) +\n                                                (sext_i32_i64(copy_gtid_20049) -\n                                                 squot64(sext_i32_i64(copy_gtid_20049),\n                                                         res_16723) *\n                                                 res_16723)] = ((__global\n                                                                 int64_t *) mem_19277)[squot64(sext_i32_i64(copy_gtid_20049),\n                                                                                               res_16723) *\n                                                                                       res_16723 +\n                                                                                       (sext_i32_i64(copy_gtid_20049) -\n                                                                                        squot64(sext_i32_i64(copy_gtid_20049),\n                                                                                                res_16723) *\n                                                                                        res_16723)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void mainzicopy_20402(int64_t paths_16674, int64_t res_16723, __global\n                               unsigned char *mem_19500, __global\n                               unsigned char *mem_19518)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_20402;",
                   "\n    int32_t copy_ltid_20403;\n    int32_t copy_gid_20404;\n    \n    copy_gtid_20402 = get_global_id(0);\n    copy_ltid_20403 = get_local_id(0);\n    copy_gid_20404 = get_group_id(0);\n    if (slt64(sext_i32_i64(copy_gtid_20402), paths_16674 * res_16723)) {\n        ((__global bool *) mem_19518)[(sext_i32_i64(copy_gtid_20402) -\n                                       squot64(sext_i32_i64(copy_gtid_20402),\n                                               res_16723) * res_16723) *\n                                      paths_16674 +\n                                      squot64(sext_i32_i64(copy_gtid_20402),\n                                              res_16723)] = ((__global\n                                                              bool *) mem_19500)[squot64(sext_i32_i64(copy_gtid_20402),\n                                                                                         res_16723) *\n                                                                                 res_16723 +\n                                                                                 smod64(sext_i32_i64(copy_gtid_20402) -\n                                                                                        squot64(sext_i32_i64(copy_gtid_20402),\n                                                                                                res_16723) *\n                                                                                        res_16723 +\n                                                                                        1,\n                                                                                        res_16723)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void mainziscan_stage1_17045(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_19797_backing_aligned_0,\n                                      int64_t steps_16675,\n                                      float swap_term_16676",
                   ",\n                                      int64_t payments_16677,\n                                      float sims_per_year_16687, __global\n                                      unsigned char *mem_19265, __global\n                                      unsigned char *mem_19267, __global\n                                      unsigned char *mem_19269,\n                                      int32_t num_threads_19791)\n{\n    #define segscan_group_sizze_17040 (mainzisegscan_group_sizze_17039)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_19797_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_19797_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_19792;\n    int32_t local_tid_19793;\n    int64_t group_sizze_19796;\n    int32_t wave_sizze_19795;\n    int32_t group_tid_19794;\n    \n    global_tid_19792 = get_global_id(0);\n    local_tid_19793 = get_local_id(0);\n    group_sizze_19796 = get_local_size(0);\n    wave_sizze_19795 = LOCKSTEP_WIDTH;\n    group_tid_19794 = get_group_id(0);\n    \n    int32_t phys_tid_17045;\n    \n    phys_tid_17045 = global_tid_19792;\n    \n    __local char *scan_arr_mem_19797;\n    \n    scan_arr_mem_19797 = (__local char *) scan_arr_mem_19797_backing_0;\n    \n    int64_t x_16706;\n    int64_t x_16707;\n    \n    x_16706 = 0;\n    for (int64_t j_19799 = 0; j_19799 < sdiv_up64(steps_16675,\n                                                  sext_i32_i64(num_threads_19791));\n         j_19799++) {\n        int64_t chunk_offset_19800 = segscan_group_sizze_17040 * j_19799 +\n                sext_i32_i64(group_tid_19794) * (segscan_group_sizze_17040 *\n                                                 sdiv_up64(steps_16675,\n                                                           sext_i32_i64(num_threads_19791)));\n        int64_t flat_idx_19801 = chunk_offset_19800 +\n                ",
                   "sext_i32_i64(local_tid_19793);\n        int64_t gtid_17044 = flat_idx_19801;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_17044, steps_16675)) {\n                int64_t index_primexp_19119 = add64(1, gtid_17044);\n                float res_16710 = sitofp_i64_f32(index_primexp_19119);\n                float res_16711 = res_16710 / sims_per_year_16687;\n                float x_16712 = res_16711 / swap_term_16676;\n                float ceil_arg_16713 = x_16712 - 1.0F;\n                float res_16714;\n                \n                res_16714 = futrts_ceil32(ceil_arg_16713);\n                \n                int64_t res_16715 = fptosi_f32_i64(res_16714);\n                int64_t res_16716 = sub64(payments_16677, res_16715);\n                bool cond_16717 = res_16716 == 0;\n                int64_t res_16718;\n                \n                if (cond_16717) {\n                    res_16718 = 1;\n                } else {\n                    res_16718 = res_16716;\n                }\n                // write to-scan values to parameters\n                {\n                    x_16707 = res_16718;\n                }\n                // write mapped values results to global memory\n                {\n                    ((__global int64_t *) mem_19267)[gtid_17044] = res_16718;\n                    ((__global float *) mem_19269)[gtid_17044] = res_16711;\n                }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_17044, steps_16675)) {\n                    x_16707 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                int64_t res_16708 = add64(x_16706, x_16707);\n                \n                ((__local\n                  int64_t *) scan_arr_mem_19797)[sext_i32_i64(local_tid_19793)] =\n                    res_16708;\n        ",
                   "    }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int64_t x_19802;\n            int64_t x_19803;\n            int64_t x_19805;\n            int64_t x_19806;\n            bool ltid_in_bounds_19808;\n            \n            ltid_in_bounds_19808 = slt64(sext_i32_i64(local_tid_19793),\n                                         segscan_group_sizze_17040);\n            \n            int32_t skip_threads_19809;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_19808) {\n                    x_19803 = ((volatile __local\n                                int64_t *) scan_arr_mem_19797)[sext_i32_i64(local_tid_19793)];\n                    if ((local_tid_19793 - squot32(local_tid_19793, 32) * 32) ==\n                        0) {\n                        x_19802 = x_19803;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_19809 = 1;\n                while (slt32(skip_threads_19809, 32)) {\n                    if (sle32(skip_threads_19809, local_tid_19793 -\n                              squot32(local_tid_19793, 32) * 32) &&\n                        ltid_in_bounds_19808) {\n                        // read operands\n                        {\n                            x_19802 = ((volatile __local\n                                        int64_t *) scan_arr_mem_19797)[sext_i32_i64(local_tid_19793) -\n                                                                       sext_i32_i64(skip_threads_19809)];\n                        }\n                        // perform operation\n                        {\n                            int64_t res_19804 = add64(x_19802, x_19803);\n                            \n                            x_19802 = res_19804;\n                        }\n                    }\n                    if (sle32(wave_sizze_19795, skip_threads_19809)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n   ",
                   "                 }\n                    if (sle32(skip_threads_19809, local_tid_19793 -\n                              squot32(local_tid_19793, 32) * 32) &&\n                        ltid_in_bounds_19808) {\n                        // write result\n                        {\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_19797)[sext_i32_i64(local_tid_19793)] =\n                                x_19802;\n                            x_19803 = x_19802;\n                        }\n                    }\n                    if (sle32(wave_sizze_19795, skip_threads_19809)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_19809 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_19793 - squot32(local_tid_19793, 32) * 32) ==\n                    31 && ltid_in_bounds_19808) {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_19797)[sext_i32_i64(squot32(local_tid_19793,\n                                                                          32))] =\n                        x_19802;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_19810;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_19793, 32) == 0 &&\n                        ltid_in_bounds_19808) {\n                        x_19806 = ((volatile __local\n                                    int64_t *) scan_arr_mem_19797)[sext_i32_i64(local_tid_19793)];\n                        if ((local_tid_19793 - squot32(local_tid_19793, 32) *\n                             32) == 0) {\n                            x_19805 = x_1",
                   "9806;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_19810 = 1;\n                    while (slt32(skip_threads_19810, 32)) {\n                        if (sle32(skip_threads_19810, local_tid_19793 -\n                                  squot32(local_tid_19793, 32) * 32) &&\n                            (squot32(local_tid_19793, 32) == 0 &&\n                             ltid_in_bounds_19808)) {\n                            // read operands\n                            {\n                                x_19805 = ((volatile __local\n                                            int64_t *) scan_arr_mem_19797)[sext_i32_i64(local_tid_19793) -\n                                                                           sext_i32_i64(skip_threads_19810)];\n                            }\n                            // perform operation\n                            {\n                                int64_t res_19807 = add64(x_19805, x_19806);\n                                \n                                x_19805 = res_19807;\n                            }\n                        }\n                        if (sle32(wave_sizze_19795, skip_threads_19810)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_19810, local_tid_19793 -\n                                  squot32(local_tid_19793, 32) * 32) &&\n                            (squot32(local_tid_19793, 32) == 0 &&\n                             ltid_in_bounds_19808)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_19797)[sext_i32_i64(local_tid_19793)] =\n                                    x_19805;\n                                x_19806 = x_19805;\n                            }\n                        }",
                   "\n                        if (sle32(wave_sizze_19795, skip_threads_19810)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_19810 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_19793, 32) == 0 ||\n                      !ltid_in_bounds_19808)) {\n                    // read operands\n                    {\n                        x_19803 = x_19802;\n                        x_19802 = ((__local\n                                    int64_t *) scan_arr_mem_19797)[sext_i32_i64(squot32(local_tid_19793,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_19804 = add64(x_19802, x_19803);\n                        \n                        x_19802 = res_19804;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          int64_t *) scan_arr_mem_19797)[sext_i32_i64(local_tid_19793)] =\n                            x_19802;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_19793, 32) == 0) {\n                    ((__local\n                      int64_t *) scan_arr_mem_19797)[sext_i32_i64(local_tid_19793)] =\n                        x_19803;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_17044, steps_16675)) {\n                    ((__global int64_t *) mem_19265)[gtid_",
                   "17044] = ((__local\n                                                                     int64_t *) scan_arr_mem_19797)[sext_i32_i64(local_tid_19793)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_19811 = 0;\n                bool should_load_carry_19812 = local_tid_19793 == 0 &&\n                     !crosses_segment_19811;\n                \n                if (should_load_carry_19812) {\n                    x_16706 = ((__local\n                                int64_t *) scan_arr_mem_19797)[segscan_group_sizze_17040 -\n                                                               1];\n                }\n                if (!should_load_carry_19812) {\n                    x_16706 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_17040\n}\n__kernel void mainziscan_stage1_17934(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20354_backing_aligned_0,\n                                      int64_t paths_16674, int64_t res_16723,\n                                      __global unsigned char *mem_19500,\n                                      __global unsigned char *mem_19513,\n                                      int32_t num_threads_20348)\n{\n    #define segscan_group_sizze_18767 (mainzisegscan_group_sizze_17928)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20354_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20354_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20349;\n    int32_t local_tid_20350;\n    int64_t group_sizze_20353;\n    i",
                   "nt32_t wave_sizze_20352;\n    int32_t group_tid_20351;\n    \n    global_tid_20349 = get_global_id(0);\n    local_tid_20350 = get_local_id(0);\n    group_sizze_20353 = get_local_size(0);\n    wave_sizze_20352 = LOCKSTEP_WIDTH;\n    group_tid_20351 = get_group_id(0);\n    \n    int32_t phys_tid_17934;\n    \n    phys_tid_17934 = global_tid_20349;\n    \n    __local char *scan_arr_mem_20354;\n    \n    scan_arr_mem_20354 = (__local char *) scan_arr_mem_20354_backing_0;\n    \n    int64_t x_18771;\n    int64_t x_18772;\n    \n    x_18771 = 0;\n    for (int64_t j_20356 = 0; j_20356 < sdiv_up64(paths_16674 * res_16723,\n                                                  sext_i32_i64(num_threads_20348));\n         j_20356++) {\n        int64_t chunk_offset_20357 = segscan_group_sizze_18767 * j_20356 +\n                sext_i32_i64(group_tid_20351) * (segscan_group_sizze_18767 *\n                                                 sdiv_up64(paths_16674 *\n                                                           res_16723,\n                                                           sext_i32_i64(num_threads_20348)));\n        int64_t flat_idx_20358 = chunk_offset_20357 +\n                sext_i32_i64(local_tid_20350);\n        int64_t gtid_17925 = squot64(flat_idx_20358, res_16723);\n        int64_t gtid_17933 = flat_idx_20358 - squot64(flat_idx_20358,\n                                                      res_16723) * res_16723;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_17925, paths_16674) && slt64(gtid_17933,\n                                                        res_16723)) {\n                int64_t rot_i_19150 = smod64(gtid_17925, paths_16674);\n                int64_t i_p_o_19151 = add64(1, gtid_17933);\n                int64_t rot_i_19152 = smod64(i_p_o_19151, res_16723);\n                bool x_18775 = ((__global bool *) mem_19500)[rot_i_19150 *\n                                                             res_16723 +\n                                            ",
                   "                 rot_i_19152];\n                int64_t res_18776 = btoi_bool_i64(x_18775);\n                \n                // write to-scan values to parameters\n                {\n                    x_18772 = res_18776;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!(slt64(gtid_17925, paths_16674) && slt64(gtid_17933,\n                                                              res_16723))) {\n                    x_18772 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                int64_t res_18773 = add64(x_18771, x_18772);\n                \n                ((__local\n                  int64_t *) scan_arr_mem_20354)[sext_i32_i64(local_tid_20350)] =\n                    res_18773;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int64_t x_20359;\n            int64_t x_20360;\n            int64_t x_20362;\n            int64_t x_20363;\n            bool ltid_in_bounds_20365;\n            \n            ltid_in_bounds_20365 = slt64(sext_i32_i64(local_tid_20350),\n                                         segscan_group_sizze_18767);\n            \n            int32_t skip_threads_20366;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_20365) {\n                    x_20360 = ((volatile __local\n                                int64_t *) scan_arr_mem_20354)[sext_i32_i64(local_tid_20350)];\n                    if ((local_tid_20350 - squot32(local_tid_20350, 32) * 32) ==\n                        0) {\n                        x_20359 = x_20360;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threa",
                   "ds_20366 = 1;\n                while (slt32(skip_threads_20366, 32)) {\n                    if (sle32(skip_threads_20366, local_tid_20350 -\n                              squot32(local_tid_20350, 32) * 32) &&\n                        ltid_in_bounds_20365) {\n                        // read operands\n                        {\n                            x_20359 = ((volatile __local\n                                        int64_t *) scan_arr_mem_20354)[sext_i32_i64(local_tid_20350) -\n                                                                       sext_i32_i64(skip_threads_20366)];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_20367 =\n                                 slt64(srem64(sext_i32_i64(local_tid_20350) +\n                                              chunk_offset_20357, res_16723),\n                                       sext_i32_i64(local_tid_20350) +\n                                       chunk_offset_20357 -\n                                       (sext_i32_i64(local_tid_20350 -\n                                        skip_threads_20366) +\n                                        chunk_offset_20357));\n                            \n                            if (inactive_20367) {\n                                x_20359 = x_20360;\n                            }\n                            if (!inactive_20367) {\n                                int64_t res_20361 = add64(x_20359, x_20360);\n                                \n                                x_20359 = res_20361;\n                            }\n                        }\n                    }\n                    if (sle32(wave_sizze_20352, skip_threads_20366)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_20366, local_tid_20350 -\n                              squot32(local_tid_20350, 32) * 32) &&\n                        ltid_in_bounds_20365) {\n ",
                   "                       // write result\n                        {\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_20354)[sext_i32_i64(local_tid_20350)] =\n                                x_20359;\n                            x_20360 = x_20359;\n                        }\n                    }\n                    if (sle32(wave_sizze_20352, skip_threads_20366)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_20366 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_20350 - squot32(local_tid_20350, 32) * 32) ==\n                    31 && ltid_in_bounds_20365) {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_20354)[sext_i32_i64(squot32(local_tid_20350,\n                                                                          32))] =\n                        x_20359;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_20368;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_20350, 32) == 0 &&\n                        ltid_in_bounds_20365) {\n                        x_20363 = ((volatile __local\n                                    int64_t *) scan_arr_mem_20354)[sext_i32_i64(local_tid_20350)];\n                        if ((local_tid_20350 - squot32(local_tid_20350, 32) *\n                             32) == 0) {\n                            x_20362 = x_20363;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_20368 = 1;\n      ",
                   "              while (slt32(skip_threads_20368, 32)) {\n                        if (sle32(skip_threads_20368, local_tid_20350 -\n                                  squot32(local_tid_20350, 32) * 32) &&\n                            (squot32(local_tid_20350, 32) == 0 &&\n                             ltid_in_bounds_20365)) {\n                            // read operands\n                            {\n                                x_20362 = ((volatile __local\n                                            int64_t *) scan_arr_mem_20354)[sext_i32_i64(local_tid_20350) -\n                                                                           sext_i32_i64(skip_threads_20368)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_20369 =\n                                     slt64(srem64(sext_i32_i64(local_tid_20350 *\n                                                  32 + 32 - 1) +\n                                                  chunk_offset_20357,\n                                                  res_16723),\n                                           sext_i32_i64(local_tid_20350 * 32 +\n                                           32 - 1) + chunk_offset_20357 -\n                                           (sext_i32_i64((local_tid_20350 -\n                                                          skip_threads_20368) *\n                                            32 + 32 - 1) + chunk_offset_20357));\n                                \n                                if (inactive_20369) {\n                                    x_20362 = x_20363;\n                                }\n                                if (!inactive_20369) {\n                                    int64_t res_20364 = add64(x_20362, x_20363);\n                                    \n                                    x_20362 = res_20364;\n                                }\n                            }\n                        }\n  ",
                   "                      if (sle32(wave_sizze_20352, skip_threads_20368)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_20368, local_tid_20350 -\n                                  squot32(local_tid_20350, 32) * 32) &&\n                            (squot32(local_tid_20350, 32) == 0 &&\n                             ltid_in_bounds_20365)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_20354)[sext_i32_i64(local_tid_20350)] =\n                                    x_20362;\n                                x_20363 = x_20362;\n                            }\n                        }\n                        if (sle32(wave_sizze_20352, skip_threads_20368)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_20368 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_20350, 32) == 0 ||\n                      !ltid_in_bounds_20365)) {\n                    // read operands\n                    {\n                        x_20360 = x_20359;\n                        x_20359 = ((__local\n                                    int64_t *) scan_arr_mem_20354)[sext_i32_i64(squot32(local_tid_20350,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        bool inactive_20370 =\n                             slt64(srem64(sext_i32_i64(local_tid_20350) +\n                                          chunk_offset_20357, res_16723),\n                          ",
                   "         sext_i32_i64(local_tid_20350) +\n                                   chunk_offset_20357 -\n                                   (sext_i32_i64(squot32(local_tid_20350, 32) *\n                                    32 - 1) + chunk_offset_20357));\n                        \n                        if (inactive_20370) {\n                            x_20359 = x_20360;\n                        }\n                        if (!inactive_20370) {\n                            int64_t res_20361 = add64(x_20359, x_20360);\n                            \n                            x_20359 = res_20361;\n                        }\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          int64_t *) scan_arr_mem_20354)[sext_i32_i64(local_tid_20350)] =\n                            x_20359;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_20350, 32) == 0) {\n                    ((__local\n                      int64_t *) scan_arr_mem_20354)[sext_i32_i64(local_tid_20350)] =\n                        x_20360;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_17925, paths_16674) && slt64(gtid_17933,\n                                                            res_16723)) {\n                    ((__global int64_t *) mem_19513)[gtid_17925 * res_16723 +\n                                                     gtid_17933] = ((__local\n                                                                     int64_t *) scan_arr_mem_20354)[sext_i32_i64(local_tid_20350)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool cro",
                   "sses_segment_20371 = slt64(srem64(chunk_offset_20357 +\n                                                          segscan_group_sizze_18767,\n                                                          res_16723),\n                                                   chunk_offset_20357 +\n                                                   segscan_group_sizze_18767 -\n                                                   (chunk_offset_20357 +\n                                                    segscan_group_sizze_18767 -\n                                                    1));\n                bool should_load_carry_20372 = local_tid_20350 == 0 &&\n                     !crosses_segment_20371;\n                \n                if (should_load_carry_20372) {\n                    x_18771 = ((__local\n                                int64_t *) scan_arr_mem_20354)[segscan_group_sizze_18767 -\n                                                               1];\n                }\n                if (!should_load_carry_20372) {\n                    x_18771 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_18767\n}\n__kernel void mainziscan_stage1_18042(__global int *global_failure,\n                                      int failure_is_an_option, __global\n                                      int64_t *global_failure_args,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20284_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20282_backing_aligned_1,\n                                      int64_t paths_16674, int64_t steps_16675,\n                                      float swap_term_16676,\n                                      int64_t payments_16677,\n                                      float notional_16678, float a_16679,\n                            ",
                   "          float b_16680, float sigma_16681,\n                                      float sims_per_year_16687,\n                                      int64_t res_16723, __global\n                                      unsigned char *mem_19492, __global\n                                      unsigned char *mem_19498, __global\n                                      unsigned char *mem_19500, __global\n                                      unsigned char *mem_19503, __global\n                                      unsigned char *mem_19506, __global\n                                      unsigned char *mem_19509,\n                                      int32_t num_threads_20276)\n{\n    #define segscan_group_sizze_18629 (mainzisegscan_group_sizze_18036)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20284_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_20284_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_20282_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20282_backing_aligned_1;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_20277;\n    int32_t local_tid_20278;\n    int64_t group_sizze_20281;\n    int32_t wave_sizze_20280;\n    int32_t group_tid_20279;\n    \n    global_tid_20277 = get_global_id(0);\n    local_tid_20278 = get_local_id(0);\n    group_sizze_20281 = get_local_size(0);\n    wave_sizze_20280 = LOCKSTEP_WIDTH;\n    group_tid_20279 = get_group_id(0);\n    \n    int32_t phys_tid_18042;\n    \n    phys_tid_18042 = global_tid_20277;\n    \n    __local char *scan_arr_mem_20282;\n    __local char *scan_arr_mem_20284;\n    \n    scan_arr_mem_20282 = (__local ",
                   "char *) scan_arr_mem_20282_backing_0;\n    scan_arr_mem_20284 = (__local char *) scan_arr_mem_20284_backing_1;\n    \n    bool x_18634;\n    float x_18635;\n    bool x_18636;\n    float x_18637;\n    \n    x_18634 = 0;\n    x_18635 = 0.0F;\n    for (int64_t j_20286 = 0; j_20286 < sdiv_up64(paths_16674 * res_16723,\n                                                  sext_i32_i64(num_threads_20276));\n         j_20286++) {\n        int64_t chunk_offset_20287 = segscan_group_sizze_18629 * j_20286 +\n                sext_i32_i64(group_tid_20279) * (segscan_group_sizze_18629 *\n                                                 sdiv_up64(paths_16674 *\n                                                           res_16723,\n                                                           sext_i32_i64(num_threads_20276)));\n        int64_t flat_idx_20288 = chunk_offset_20287 +\n                sext_i32_i64(local_tid_20278);\n        int64_t gtid_18033 = squot64(flat_idx_20288, res_16723);\n        int64_t gtid_18041 = flat_idx_20288 - squot64(flat_idx_20288,\n                                                      res_16723) * res_16723;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_18033, paths_16674) && slt64(gtid_18041,\n                                                        res_16723)) {\n                int64_t x_18647 = ((__global int64_t *) mem_19498)[gtid_18033 *\n                                                                   res_16723 +\n                                                                   gtid_18041];\n                int64_t x_18648 = ((__global int64_t *) mem_19492)[gtid_18033 *\n                                                                   res_16723 +\n                                                                   gtid_18041];\n                bool x_18649 = ((__global bool *) mem_19500)[gtid_18033 *\n                                                             res_16723 +\n                                                             gt",
                   "id_18041];\n                int64_t res_18652 = sub64(x_18647, 1);\n                bool x_18653 = sle64(0, x_18648);\n                bool y_18654 = slt64(x_18648, steps_16675);\n                bool bounds_check_18655 = x_18653 && y_18654;\n                bool index_certs_18656;\n                \n                if (!bounds_check_18655) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 8) ==\n                            -1) {\n                            global_failure_args[0] = x_18648;\n                            global_failure_args[1] = steps_16675;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int64_t convop_x_18658 = add64(1, x_18648);\n                float binop_x_18659 = sitofp_i64_f32(convop_x_18658);\n                float index_primexp_18660 = binop_x_18659 / sims_per_year_16687;\n                float x_18661 = index_primexp_18660 / swap_term_16676;\n                float ceil_arg_18662 = x_18661 - 1.0F;\n                float res_18663;\n                \n                res_18663 = futrts_ceil32(ceil_arg_18662);\n                \n                int64_t res_18664 = fptosi_f32_i64(res_18663);\n                int64_t res_18665 = sub64(payments_16677, res_18664);\n                bool cond_18666 = res_18665 == 0;\n                float res_18667;\n                \n                if (cond_18666) {\n                    res_18667 = 0.0F;\n                } else {\n                    float lifted_0_get_arg_18657 = ((__global\n                                                     float *) mem_19503)[gtid_18033 *\n                                                                         steps_16675 +\n                                                                         x_18648];\n                    float res_18668;\n                    \n                    res_18668 = ",
                   "futrts_ceil32(x_18661);\n                    \n                    float start_18669 = swap_term_16676 * res_18668;\n                    float res_18670;\n                    \n                    res_18670 = futrts_ceil32(ceil_arg_18662);\n                    \n                    int64_t res_18671 = fptosi_f32_i64(res_18670);\n                    int64_t res_18672 = sub64(payments_16677, res_18671);\n                    int64_t sizze_18673 = sub64(res_18672, 1);\n                    bool cond_18674 = res_18652 == 0;\n                    float res_18675;\n                    \n                    if (cond_18674) {\n                        res_18675 = 1.0F;\n                    } else {\n                        res_18675 = 0.0F;\n                    }\n                    \n                    bool cond_18676 = slt64(0, res_18652);\n                    float res_18677;\n                    \n                    if (cond_18676) {\n                        float y_18678 = 5.056644e-2F * swap_term_16676;\n                        float res_18679 = res_18675 - y_18678;\n                        \n                        res_18677 = res_18679;\n                    } else {\n                        res_18677 = res_18675;\n                    }\n                    \n                    bool cond_18680 = res_18652 == sizze_18673;\n                    float res_18681;\n                    \n                    if (cond_18680) {\n                        float res_18682 = res_18677 - 1.0F;\n                        \n                        res_18681 = res_18682;\n                    } else {\n                        res_18681 = res_18677;\n                    }\n                    \n                    float res_18683 = notional_16678 * res_18681;\n                    float res_18684 = sitofp_i64_f32(res_18652);\n                    float y_18685 = swap_term_16676 * res_18684;\n                    float bondprice_arg_18686 = start_18669 + y_18685;\n                    float y_18687 = bondprice_arg_18686 - index_primexp_186",
                   "60;\n                    float negate_arg_18688 = a_16679 * y_18687;\n                    float exp_arg_18689 = 0.0F - negate_arg_18688;\n                    float res_18690 = fpow32(2.7182817F, exp_arg_18689);\n                    float x_18691 = 1.0F - res_18690;\n                    float B_18692 = x_18691 / a_16679;\n                    float x_18693 = B_18692 - bondprice_arg_18686;\n                    float x_18694 = index_primexp_18660 + x_18693;\n                    float x_18695 = fpow32(a_16679, 2.0F);\n                    float x_18696 = b_16680 * x_18695;\n                    float x_18697 = fpow32(sigma_16681, 2.0F);\n                    float y_18698 = x_18697 / 2.0F;\n                    float y_18699 = x_18696 - y_18698;\n                    float x_18700 = x_18694 * y_18699;\n                    float A1_18701 = x_18700 / x_18695;\n                    float y_18702 = fpow32(B_18692, 2.0F);\n                    float x_18703 = x_18697 * y_18702;\n                    float y_18704 = 4.0F * a_16679;\n                    float A2_18705 = x_18703 / y_18704;\n                    float exp_arg_18706 = A1_18701 - A2_18705;\n                    float res_18707 = fpow32(2.7182817F, exp_arg_18706);\n                    float negate_arg_18708 = lifted_0_get_arg_18657 * B_18692;\n                    float exp_arg_18709 = 0.0F - negate_arg_18708;\n                    float res_18710 = fpow32(2.7182817F, exp_arg_18709);\n                    float res_18711 = res_18707 * res_18710;\n                    float res_18712 = res_18683 * res_18711;\n                    \n                    res_18667 = res_18712;\n                }\n                // write to-scan values to parameters\n                {\n                    x_18636 = x_18649;\n                    x_18637 = res_18667;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-sca",
                   "n values to parameters, or read neutral\n            {\n                if (!(slt64(gtid_18033, paths_16674) && slt64(gtid_18041,\n                                                              res_16723))) {\n                    x_18636 = 0;\n                    x_18637 = 0.0F;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                bool res_18638 = x_18634 || x_18636;\n                float res_18639;\n                \n                if (x_18636) {\n                    res_18639 = x_18637;\n                } else {\n                    float res_18640 = x_18635 + x_18637;\n                    \n                    res_18639 = res_18640;\n                }\n                ((__local\n                  bool *) scan_arr_mem_20282)[sext_i32_i64(local_tid_20278)] =\n                    res_18638;\n                ((__local\n                  float *) scan_arr_mem_20284)[sext_i32_i64(local_tid_20278)] =\n                    res_18639;\n            }\n            \n          error_0:\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_failure)\n                return;\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_20289;\n            float x_20290;\n            bool x_20291;\n            float x_20292;\n            bool x_20296;\n            float x_20297;\n            bool x_20298;\n            float x_20299;\n            bool ltid_in_bounds_20303;\n            \n            ltid_in_bounds_20303 = slt64(sext_i32_i64(local_tid_20278),\n                                         segscan_group_sizze_18629);\n            \n            int32_t skip_threads_20304;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_20303) {\n                    x_20291 = ((volatile __local\n                                bool *) scan_arr_mem_20282)[sext_i32_i64(local_tid_20278)];\n                    x_20292 = ((volatile __local\n                                float *) scan_a",
                   "rr_mem_20284)[sext_i32_i64(local_tid_20278)];\n                    if ((local_tid_20278 - squot32(local_tid_20278, 32) * 32) ==\n                        0) {\n                        x_20289 = x_20291;\n                        x_20290 = x_20292;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_20304 = 1;\n                while (slt32(skip_threads_20304, 32)) {\n                    if (sle32(skip_threads_20304, local_tid_20278 -\n                              squot32(local_tid_20278, 32) * 32) &&\n                        ltid_in_bounds_20303) {\n                        // read operands\n                        {\n                            x_20289 = ((volatile __local\n                                        bool *) scan_arr_mem_20282)[sext_i32_i64(local_tid_20278) -\n                                                                    sext_i32_i64(skip_threads_20304)];\n                            x_20290 = ((volatile __local\n                                        float *) scan_arr_mem_20284)[sext_i32_i64(local_tid_20278) -\n                                                                     sext_i32_i64(skip_threads_20304)];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_20305 =\n                                 slt64(srem64(sext_i32_i64(local_tid_20278) +\n                                              chunk_offset_20287, res_16723),\n                                       sext_i32_i64(local_tid_20278) +\n                                       chunk_offset_20287 -\n                                       (sext_i32_i64(local_tid_20278 -\n                                        skip_threads_20304) +\n                                        chunk_offset_20287));\n                            \n                            if (inactive_20305) {\n                                x_20289 = x_20291;\n  ",
                   "                              x_20290 = x_20292;\n                            }\n                            if (!inactive_20305) {\n                                bool res_20293 = x_20289 || x_20291;\n                                float res_20294;\n                                \n                                if (x_20291) {\n                                    res_20294 = x_20292;\n                                } else {\n                                    float res_20295 = x_20290 + x_20292;\n                                    \n                                    res_20294 = res_20295;\n                                }\n                                x_20289 = res_20293;\n                                x_20290 = res_20294;\n                            }\n                        }\n                    }\n                    if (sle32(wave_sizze_20280, skip_threads_20304)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_20304, local_tid_20278 -\n                              squot32(local_tid_20278, 32) * 32) &&\n                        ltid_in_bounds_20303) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_20282)[sext_i32_i64(local_tid_20278)] =\n                                x_20289;\n                            x_20291 = x_20289;\n                            ((volatile __local\n                              float *) scan_arr_mem_20284)[sext_i32_i64(local_tid_20278)] =\n                                x_20290;\n                            x_20292 = x_20290;\n                        }\n                    }\n                    if (sle32(wave_sizze_20280, skip_threads_20304)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_20304 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thr",
                   "ead of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_20278 - squot32(local_tid_20278, 32) * 32) ==\n                    31 && ltid_in_bounds_20303) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_20282)[sext_i32_i64(squot32(local_tid_20278,\n                                                                       32))] =\n                        x_20289;\n                    ((volatile __local\n                      float *) scan_arr_mem_20284)[sext_i32_i64(squot32(local_tid_20278,\n                                                                        32))] =\n                        x_20290;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_20306;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_20278, 32) == 0 &&\n                        ltid_in_bounds_20303) {\n                        x_20298 = ((volatile __local\n                                    bool *) scan_arr_mem_20282)[sext_i32_i64(local_tid_20278)];\n                        x_20299 = ((volatile __local\n                                    float *) scan_arr_mem_20284)[sext_i32_i64(local_tid_20278)];\n                        if ((local_tid_20278 - squot32(local_tid_20278, 32) *\n                             32) == 0) {\n                            x_20296 = x_20298;\n                            x_20297 = x_20299;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_20306 = 1;\n                    while (slt32(skip_threads_20306, 32)) {\n                        if (sle32(skip_threads_20306, local_tid_20278 -\n                                  squot32(local_tid_20278, 32) * 32) &&\n    ",
                   "                        (squot32(local_tid_20278, 32) == 0 &&\n                             ltid_in_bounds_20303)) {\n                            // read operands\n                            {\n                                x_20296 = ((volatile __local\n                                            bool *) scan_arr_mem_20282)[sext_i32_i64(local_tid_20278) -\n                                                                        sext_i32_i64(skip_threads_20306)];\n                                x_20297 = ((volatile __local\n                                            float *) scan_arr_mem_20284)[sext_i32_i64(local_tid_20278) -\n                                                                         sext_i32_i64(skip_threads_20306)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_20307 =\n                                     slt64(srem64(sext_i32_i64(local_tid_20278 *\n                                                  32 + 32 - 1) +\n                                                  chunk_offset_20287,\n                                                  res_16723),\n                                           sext_i32_i64(local_tid_20278 * 32 +\n                                           32 - 1) + chunk_offset_20287 -\n                                           (sext_i32_i64((local_tid_20278 -\n                                                          skip_threads_20306) *\n                                            32 + 32 - 1) + chunk_offset_20287));\n                                \n                                if (inactive_20307) {\n                                    x_20296 = x_20298;\n                                    x_20297 = x_20299;\n                                }\n                                if (!inactive_20307) {\n                                    bool res_20300 = x_20296 || x_20298;\n                                    float res_20301;\n                    ",
                   "                \n                                    if (x_20298) {\n                                        res_20301 = x_20299;\n                                    } else {\n                                        float res_20302 = x_20297 + x_20299;\n                                        \n                                        res_20301 = res_20302;\n                                    }\n                                    x_20296 = res_20300;\n                                    x_20297 = res_20301;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_20280, skip_threads_20306)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_20306, local_tid_20278 -\n                                  squot32(local_tid_20278, 32) * 32) &&\n                            (squot32(local_tid_20278, 32) == 0 &&\n                             ltid_in_bounds_20303)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_20282)[sext_i32_i64(local_tid_20278)] =\n                                    x_20296;\n                                x_20298 = x_20296;\n                                ((volatile __local\n                                  float *) scan_arr_mem_20284)[sext_i32_i64(local_tid_20278)] =\n                                    x_20297;\n                                x_20299 = x_20297;\n                            }\n                        }\n                        if (sle32(wave_sizze_20280, skip_threads_20306)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_20306 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n    ",
                   "        {\n                if (!(squot32(local_tid_20278, 32) == 0 ||\n                      !ltid_in_bounds_20303)) {\n                    // read operands\n                    {\n                        x_20291 = x_20289;\n                        x_20292 = x_20290;\n                        x_20289 = ((__local\n                                    bool *) scan_arr_mem_20282)[sext_i32_i64(squot32(local_tid_20278,\n                                                                                     32)) -\n                                                                1];\n                        x_20290 = ((__local\n                                    float *) scan_arr_mem_20284)[sext_i32_i64(squot32(local_tid_20278,\n                                                                                      32)) -\n                                                                 1];\n                    }\n                    // perform operation\n                    {\n                        bool inactive_20308 =\n                             slt64(srem64(sext_i32_i64(local_tid_20278) +\n                                          chunk_offset_20287, res_16723),\n                                   sext_i32_i64(local_tid_20278) +\n                                   chunk_offset_20287 -\n                                   (sext_i32_i64(squot32(local_tid_20278, 32) *\n                                    32 - 1) + chunk_offset_20287));\n                        \n                        if (inactive_20308) {\n                            x_20289 = x_20291;\n                            x_20290 = x_20292;\n                        }\n                        if (!inactive_20308) {\n                            bool res_20293 = x_20289 || x_20291;\n                            float res_20294;\n                            \n                            if (x_20291) {\n                                res_20294 = x_20292;\n                            } else {\n                                float res_20295 = x_20290 + x_2",
                   "0292;\n                                \n                                res_20294 = res_20295;\n                            }\n                            x_20289 = res_20293;\n                            x_20290 = res_20294;\n                        }\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_20282)[sext_i32_i64(local_tid_20278)] =\n                            x_20289;\n                        ((__local\n                          float *) scan_arr_mem_20284)[sext_i32_i64(local_tid_20278)] =\n                            x_20290;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_20278, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_20282)[sext_i32_i64(local_tid_20278)] =\n                        x_20291;\n                    ((__local\n                      float *) scan_arr_mem_20284)[sext_i32_i64(local_tid_20278)] =\n                        x_20292;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_18033, paths_16674) && slt64(gtid_18041,\n                                                            res_16723)) {\n                    ((__global bool *) mem_19506)[gtid_18033 * res_16723 +\n                                                  gtid_18041] = ((__local\n                                                                  bool *) scan_arr_mem_20282)[sext_i32_i64(local_tid_20278)];\n                    ((__global float *) mem_19509)[gtid_18033 * res_16723 +\n                                                   gtid_18041] = ((__local\n                                                                   float *) scan_arr_mem_20284)[sext_i32_i64(local_t",
                   "id_20278)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_20309 = slt64(srem64(chunk_offset_20287 +\n                                                          segscan_group_sizze_18629,\n                                                          res_16723),\n                                                   chunk_offset_20287 +\n                                                   segscan_group_sizze_18629 -\n                                                   (chunk_offset_20287 +\n                                                    segscan_group_sizze_18629 -\n                                                    1));\n                bool should_load_carry_20310 = local_tid_20278 == 0 &&\n                     !crosses_segment_20309;\n                \n                if (should_load_carry_20310) {\n                    x_18634 = ((__local\n                                bool *) scan_arr_mem_20282)[segscan_group_sizze_18629 -\n                                                            1];\n                    x_18635 = ((__local\n                                float *) scan_arr_mem_20284)[segscan_group_sizze_18629 -\n                                                             1];\n                }\n                if (!should_load_carry_20310) {\n                    x_18634 = 0;\n                    x_18635 = 0.0F;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_18629\n}\n__kernel void mainziscan_stage1_18150(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20212_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20210_backing_aligned_1,\n                     ",
                   "                 int64_t paths_16674, int64_t res_16723,\n                                      __global unsigned char *mem_19492,\n                                      __global unsigned char *mem_19495,\n                                      __global unsigned char *mem_19498,\n                                      __global unsigned char *mem_19500,\n                                      int32_t num_threads_20204)\n{\n    #define segscan_group_sizze_18588 (mainzisegscan_group_sizze_18144)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20212_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_20212_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_20210_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20210_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20205;\n    int32_t local_tid_20206;\n    int64_t group_sizze_20209;\n    int32_t wave_sizze_20208;\n    int32_t group_tid_20207;\n    \n    global_tid_20205 = get_global_id(0);\n    local_tid_20206 = get_local_id(0);\n    group_sizze_20209 = get_local_size(0);\n    wave_sizze_20208 = LOCKSTEP_WIDTH;\n    group_tid_20207 = get_group_id(0);\n    \n    int32_t phys_tid_18150;\n    \n    phys_tid_18150 = global_tid_20205;\n    \n    __local char *scan_arr_mem_20210;\n    __local char *scan_arr_mem_20212;\n    \n    scan_arr_mem_20210 = (__local char *) scan_arr_mem_20210_backing_0;\n    scan_arr_mem_20212 = (__local char *) scan_arr_mem_20212_backing_1;\n    \n    bool x_18594;\n    int64_t x_18595;\n    bool x_18596;\n    int64_t x_18597;\n    \n    x_18594 = 0;\n    x_18595 = 0;\n    for (int64_t j_20214 = 0; j_20214 < sdiv_up64(paths_16674 * res_16723,\n                                                  sext_i32_i64(num_threads_20204));\n         j_20214++) {\n        int64_t chunk_offset",
                   "_20215 = segscan_group_sizze_18588 * j_20214 +\n                sext_i32_i64(group_tid_20207) * (segscan_group_sizze_18588 *\n                                                 sdiv_up64(paths_16674 *\n                                                           res_16723,\n                                                           sext_i32_i64(num_threads_20204)));\n        int64_t flat_idx_20216 = chunk_offset_20215 +\n                sext_i32_i64(local_tid_20206);\n        int64_t gtid_18141 = squot64(flat_idx_20216, res_16723);\n        int64_t gtid_18149 = flat_idx_20216 - squot64(flat_idx_20216,\n                                                      res_16723) * res_16723;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_18141, paths_16674) && slt64(gtid_18149,\n                                                        res_16723)) {\n                int64_t x_18604 = ((__global int64_t *) mem_19492)[gtid_18141 *\n                                                                   res_16723 +\n                                                                   gtid_18149];\n                int64_t rot_i_19146 = smod64(gtid_18141, paths_16674);\n                int64_t i_p_o_19147 = add64(-1, gtid_18149);\n                int64_t rot_i_19148 = smod64(i_p_o_19147, res_16723);\n                int64_t x_18605 = ((__global int64_t *) mem_19492)[rot_i_19146 *\n                                                                   res_16723 +\n                                                                   rot_i_19148];\n                bool res_18607 = x_18604 == x_18605;\n                bool res_18608 = !res_18607;\n                \n                // write to-scan values to parameters\n                {\n                    x_18596 = res_18608;\n                    x_18597 = 1;\n                }\n                // write mapped values results to global memory\n                {\n                    ((__global bool *) mem_19500)[gtid_18141 * res_16723 +\n          ",
                   "                                        gtid_18149] = res_18608;\n                }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!(slt64(gtid_18141, paths_16674) && slt64(gtid_18149,\n                                                              res_16723))) {\n                    x_18596 = 0;\n                    x_18597 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                bool res_18598 = x_18594 || x_18596;\n                int64_t res_18599;\n                \n                if (x_18596) {\n                    res_18599 = x_18597;\n                } else {\n                    int64_t res_18600 = add64(x_18595, x_18597);\n                    \n                    res_18599 = res_18600;\n                }\n                ((__local\n                  bool *) scan_arr_mem_20210)[sext_i32_i64(local_tid_20206)] =\n                    res_18598;\n                ((__local\n                  int64_t *) scan_arr_mem_20212)[sext_i32_i64(local_tid_20206)] =\n                    res_18599;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_20217;\n            int64_t x_20218;\n            bool x_20219;\n            int64_t x_20220;\n            bool x_20224;\n            int64_t x_20225;\n            bool x_20226;\n            int64_t x_20227;\n            bool ltid_in_bounds_20231;\n            \n            ltid_in_bounds_20231 = slt64(sext_i32_i64(local_tid_20206),\n                                         segscan_group_sizze_18588);\n            \n            int32_t skip_threads_20232;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_20231) {\n                    x_20219 = ((volatile __local\n                                bool *) scan_arr_mem_20210)[sext_i32_i64(local_tid_20206)];\n      ",
                   "              x_20220 = ((volatile __local\n                                int64_t *) scan_arr_mem_20212)[sext_i32_i64(local_tid_20206)];\n                    if ((local_tid_20206 - squot32(local_tid_20206, 32) * 32) ==\n                        0) {\n                        x_20217 = x_20219;\n                        x_20218 = x_20220;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_20232 = 1;\n                while (slt32(skip_threads_20232, 32)) {\n                    if (sle32(skip_threads_20232, local_tid_20206 -\n                              squot32(local_tid_20206, 32) * 32) &&\n                        ltid_in_bounds_20231) {\n                        // read operands\n                        {\n                            x_20217 = ((volatile __local\n                                        bool *) scan_arr_mem_20210)[sext_i32_i64(local_tid_20206) -\n                                                                    sext_i32_i64(skip_threads_20232)];\n                            x_20218 = ((volatile __local\n                                        int64_t *) scan_arr_mem_20212)[sext_i32_i64(local_tid_20206) -\n                                                                       sext_i32_i64(skip_threads_20232)];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_20233 =\n                                 slt64(srem64(sext_i32_i64(local_tid_20206) +\n                                              chunk_offset_20215, res_16723),\n                                       sext_i32_i64(local_tid_20206) +\n                                       chunk_offset_20215 -\n                                       (sext_i32_i64(local_tid_20206 -\n                                        skip_threads_20232) +\n                                        chunk_offset_20215));\n                            \n       ",
                   "                     if (inactive_20233) {\n                                x_20217 = x_20219;\n                                x_20218 = x_20220;\n                            }\n                            if (!inactive_20233) {\n                                bool res_20221 = x_20217 || x_20219;\n                                int64_t res_20222;\n                                \n                                if (x_20219) {\n                                    res_20222 = x_20220;\n                                } else {\n                                    int64_t res_20223 = add64(x_20218, x_20220);\n                                    \n                                    res_20222 = res_20223;\n                                }\n                                x_20217 = res_20221;\n                                x_20218 = res_20222;\n                            }\n                        }\n                    }\n                    if (sle32(wave_sizze_20208, skip_threads_20232)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_20232, local_tid_20206 -\n                              squot32(local_tid_20206, 32) * 32) &&\n                        ltid_in_bounds_20231) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_20210)[sext_i32_i64(local_tid_20206)] =\n                                x_20217;\n                            x_20219 = x_20217;\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_20212)[sext_i32_i64(local_tid_20206)] =\n                                x_20218;\n                            x_20220 = x_20218;\n                        }\n                    }\n                    if (sle32(wave_sizze_20208, skip_threads_20232)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_2",
                   "0232 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_20206 - squot32(local_tid_20206, 32) * 32) ==\n                    31 && ltid_in_bounds_20231) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_20210)[sext_i32_i64(squot32(local_tid_20206,\n                                                                       32))] =\n                        x_20217;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_20212)[sext_i32_i64(squot32(local_tid_20206,\n                                                                          32))] =\n                        x_20218;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_20234;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_20206, 32) == 0 &&\n                        ltid_in_bounds_20231) {\n                        x_20226 = ((volatile __local\n                                    bool *) scan_arr_mem_20210)[sext_i32_i64(local_tid_20206)];\n                        x_20227 = ((volatile __local\n                                    int64_t *) scan_arr_mem_20212)[sext_i32_i64(local_tid_20206)];\n                        if ((local_tid_20206 - squot32(local_tid_20206, 32) *\n                             32) == 0) {\n                            x_20224 = x_20226;\n                            x_20225 = x_20227;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_20234 = 1;\n                    while (slt32(skip_threads_20234, 32)) {\n                        if (sle32(",
                   "skip_threads_20234, local_tid_20206 -\n                                  squot32(local_tid_20206, 32) * 32) &&\n                            (squot32(local_tid_20206, 32) == 0 &&\n                             ltid_in_bounds_20231)) {\n                            // read operands\n                            {\n                                x_20224 = ((volatile __local\n                                            bool *) scan_arr_mem_20210)[sext_i32_i64(local_tid_20206) -\n                                                                        sext_i32_i64(skip_threads_20234)];\n                                x_20225 = ((volatile __local\n                                            int64_t *) scan_arr_mem_20212)[sext_i32_i64(local_tid_20206) -\n                                                                           sext_i32_i64(skip_threads_20234)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_20235 =\n                                     slt64(srem64(sext_i32_i64(local_tid_20206 *\n                                                  32 + 32 - 1) +\n                                                  chunk_offset_20215,\n                                                  res_16723),\n                                           sext_i32_i64(local_tid_20206 * 32 +\n                                           32 - 1) + chunk_offset_20215 -\n                                           (sext_i32_i64((local_tid_20206 -\n                                                          skip_threads_20234) *\n                                            32 + 32 - 1) + chunk_offset_20215));\n                                \n                                if (inactive_20235) {\n                                    x_20224 = x_20226;\n                                    x_20225 = x_20227;\n                                }\n                                if (!inactive_20235) {\n                            ",
                   "        bool res_20228 = x_20224 || x_20226;\n                                    int64_t res_20229;\n                                    \n                                    if (x_20226) {\n                                        res_20229 = x_20227;\n                                    } else {\n                                        int64_t res_20230 = add64(x_20225,\n                                                                  x_20227);\n                                        \n                                        res_20229 = res_20230;\n                                    }\n                                    x_20224 = res_20228;\n                                    x_20225 = res_20229;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_20208, skip_threads_20234)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_20234, local_tid_20206 -\n                                  squot32(local_tid_20206, 32) * 32) &&\n                            (squot32(local_tid_20206, 32) == 0 &&\n                             ltid_in_bounds_20231)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_20210)[sext_i32_i64(local_tid_20206)] =\n                                    x_20224;\n                                x_20226 = x_20224;\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_20212)[sext_i32_i64(local_tid_20206)] =\n                                    x_20225;\n                                x_20227 = x_20225;\n                            }\n                        }\n                        if (sle32(wave_sizze_20208, skip_threads_20234)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n          ",
                   "              skip_threads_20234 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_20206, 32) == 0 ||\n                      !ltid_in_bounds_20231)) {\n                    // read operands\n                    {\n                        x_20219 = x_20217;\n                        x_20220 = x_20218;\n                        x_20217 = ((__local\n                                    bool *) scan_arr_mem_20210)[sext_i32_i64(squot32(local_tid_20206,\n                                                                                     32)) -\n                                                                1];\n                        x_20218 = ((__local\n                                    int64_t *) scan_arr_mem_20212)[sext_i32_i64(squot32(local_tid_20206,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        bool inactive_20236 =\n                             slt64(srem64(sext_i32_i64(local_tid_20206) +\n                                          chunk_offset_20215, res_16723),\n                                   sext_i32_i64(local_tid_20206) +\n                                   chunk_offset_20215 -\n                                   (sext_i32_i64(squot32(local_tid_20206, 32) *\n                                    32 - 1) + chunk_offset_20215));\n                        \n                        if (inactive_20236) {\n                            x_20217 = x_20219;\n                            x_20218 = x_20220;\n                        }\n                        if (!inactive_20236) {\n                            bool res_20221 = x_20217 || x_20219;\n                            int64_t res_20222;\n                     ",
                   "       \n                            if (x_20219) {\n                                res_20222 = x_20220;\n                            } else {\n                                int64_t res_20223 = add64(x_20218, x_20220);\n                                \n                                res_20222 = res_20223;\n                            }\n                            x_20217 = res_20221;\n                            x_20218 = res_20222;\n                        }\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_20210)[sext_i32_i64(local_tid_20206)] =\n                            x_20217;\n                        ((__local\n                          int64_t *) scan_arr_mem_20212)[sext_i32_i64(local_tid_20206)] =\n                            x_20218;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_20206, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_20210)[sext_i32_i64(local_tid_20206)] =\n                        x_20219;\n                    ((__local\n                      int64_t *) scan_arr_mem_20212)[sext_i32_i64(local_tid_20206)] =\n                        x_20220;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_18141, paths_16674) && slt64(gtid_18149,\n                                                            res_16723)) {\n                    ((__global bool *) mem_19495)[gtid_18141 * res_16723 +\n                                                  gtid_18149] = ((__local\n                                                                  bool *) scan_arr_mem_20210)[sext_i32_i64(local_tid_20206)];\n                    ((__global int64_t *) mem_19498",
                   ")[gtid_18141 * res_16723 +\n                                                     gtid_18149] = ((__local\n                                                                     int64_t *) scan_arr_mem_20212)[sext_i32_i64(local_tid_20206)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_20237 = slt64(srem64(chunk_offset_20215 +\n                                                          segscan_group_sizze_18588,\n                                                          res_16723),\n                                                   chunk_offset_20215 +\n                                                   segscan_group_sizze_18588 -\n                                                   (chunk_offset_20215 +\n                                                    segscan_group_sizze_18588 -\n                                                    1));\n                bool should_load_carry_20238 = local_tid_20206 == 0 &&\n                     !crosses_segment_20237;\n                \n                if (should_load_carry_20238) {\n                    x_18594 = ((__local\n                                bool *) scan_arr_mem_20210)[segscan_group_sizze_18588 -\n                                                            1];\n                    x_18595 = ((__local\n                                int64_t *) scan_arr_mem_20212)[segscan_group_sizze_18588 -\n                                                               1];\n                }\n                if (!should_load_carry_20238) {\n                    x_18594 = 0;\n                    x_18595 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_18588\n}\n__kernel void mainziscan_stage1_18193(__global int *global_failure,\n                                      __local volatile\n                     ",
                   "                 int64_t *scan_arr_mem_20140_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20138_backing_aligned_1,\n                                      int64_t paths_16674, int64_t res_16723,\n                                      __global unsigned char *mem_19277,\n                                      __global unsigned char *mem_19489,\n                                      __global unsigned char *mem_19492,\n                                      int32_t num_threads_20132)\n{\n    #define segscan_group_sizze_18557 (mainzisegscan_group_sizze_18187)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20140_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_20140_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_20138_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20138_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20133;\n    int32_t local_tid_20134;\n    int64_t group_sizze_20137;\n    int32_t wave_sizze_20136;\n    int32_t group_tid_20135;\n    \n    global_tid_20133 = get_global_id(0);\n    local_tid_20134 = get_local_id(0);\n    group_sizze_20137 = get_local_size(0);\n    wave_sizze_20136 = LOCKSTEP_WIDTH;\n    group_tid_20135 = get_group_id(0);\n    \n    int32_t phys_tid_18193;\n    \n    phys_tid_18193 = global_tid_20133;\n    \n    __local char *scan_arr_mem_20138;\n    __local char *scan_arr_mem_20140;\n    \n    scan_arr_mem_20138 = (__local char *) scan_arr_mem_20138_backing_0;\n    scan_arr_mem_20140 = (__local char *) scan_arr_mem_20140_backing_1;\n    \n    bool x_18562;\n    int64_t x_18563;\n    bool x_18564;\n    int64_t x_18565;\n    \n    x_18562 = 0;\n    x_18563 = 0;\n    for (int64_t j_20142 = 0; j_20142 < sdiv_up64(paths_1",
                   "6674 * res_16723,\n                                                  sext_i32_i64(num_threads_20132));\n         j_20142++) {\n        int64_t chunk_offset_20143 = segscan_group_sizze_18557 * j_20142 +\n                sext_i32_i64(group_tid_20135) * (segscan_group_sizze_18557 *\n                                                 sdiv_up64(paths_16674 *\n                                                           res_16723,\n                                                           sext_i32_i64(num_threads_20132)));\n        int64_t flat_idx_20144 = chunk_offset_20143 +\n                sext_i32_i64(local_tid_20134);\n        int64_t gtid_18184 = squot64(flat_idx_20144, res_16723);\n        int64_t gtid_18192 = flat_idx_20144 - squot64(flat_idx_20144,\n                                                      res_16723) * res_16723;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_18184, paths_16674) && slt64(gtid_18192,\n                                                        res_16723)) {\n                int64_t x_18570 = ((__global int64_t *) mem_19277)[gtid_18184 *\n                                                                   res_16723 +\n                                                                   gtid_18192];\n                bool res_18571 = slt64(0, x_18570);\n                \n                // write to-scan values to parameters\n                {\n                    x_18564 = res_18571;\n                    x_18565 = x_18570;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!(slt64(gtid_18184, paths_16674) && slt64(gtid_18192,\n                                                              res_16723))) {\n                    x_18564 = 0;\n                    x_18565 = 0;\n                }\n      ",
                   "      }\n            // combine with carry and write to local memory\n            {\n                bool res_18566 = x_18562 || x_18564;\n                int64_t res_18567;\n                \n                if (x_18564) {\n                    res_18567 = x_18565;\n                } else {\n                    int64_t res_18568 = add64(x_18563, x_18565);\n                    \n                    res_18567 = res_18568;\n                }\n                ((__local\n                  bool *) scan_arr_mem_20138)[sext_i32_i64(local_tid_20134)] =\n                    res_18566;\n                ((__local\n                  int64_t *) scan_arr_mem_20140)[sext_i32_i64(local_tid_20134)] =\n                    res_18567;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_20145;\n            int64_t x_20146;\n            bool x_20147;\n            int64_t x_20148;\n            bool x_20152;\n            int64_t x_20153;\n            bool x_20154;\n            int64_t x_20155;\n            bool ltid_in_bounds_20159;\n            \n            ltid_in_bounds_20159 = slt64(sext_i32_i64(local_tid_20134),\n                                         segscan_group_sizze_18557);\n            \n            int32_t skip_threads_20160;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_20159) {\n                    x_20147 = ((volatile __local\n                                bool *) scan_arr_mem_20138)[sext_i32_i64(local_tid_20134)];\n                    x_20148 = ((volatile __local\n                                int64_t *) scan_arr_mem_20140)[sext_i32_i64(local_tid_20134)];\n                    if ((local_tid_20134 - squot32(local_tid_20134, 32) * 32) ==\n                        0) {\n                        x_20145 = x_20147;\n                        x_20146 = x_20148;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_20160 ",
                   "= 1;\n                while (slt32(skip_threads_20160, 32)) {\n                    if (sle32(skip_threads_20160, local_tid_20134 -\n                              squot32(local_tid_20134, 32) * 32) &&\n                        ltid_in_bounds_20159) {\n                        // read operands\n                        {\n                            x_20145 = ((volatile __local\n                                        bool *) scan_arr_mem_20138)[sext_i32_i64(local_tid_20134) -\n                                                                    sext_i32_i64(skip_threads_20160)];\n                            x_20146 = ((volatile __local\n                                        int64_t *) scan_arr_mem_20140)[sext_i32_i64(local_tid_20134) -\n                                                                       sext_i32_i64(skip_threads_20160)];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_20161 =\n                                 slt64(srem64(sext_i32_i64(local_tid_20134) +\n                                              chunk_offset_20143, res_16723),\n                                       sext_i32_i64(local_tid_20134) +\n                                       chunk_offset_20143 -\n                                       (sext_i32_i64(local_tid_20134 -\n                                        skip_threads_20160) +\n                                        chunk_offset_20143));\n                            \n                            if (inactive_20161) {\n                                x_20145 = x_20147;\n                                x_20146 = x_20148;\n                            }\n                            if (!inactive_20161) {\n                                bool res_20149 = x_20145 || x_20147;\n                                int64_t res_20150;\n                                \n                                if (x_20147) {\n                                    res_20150 = x_20148;\n              ",
                   "                  } else {\n                                    int64_t res_20151 = add64(x_20146, x_20148);\n                                    \n                                    res_20150 = res_20151;\n                                }\n                                x_20145 = res_20149;\n                                x_20146 = res_20150;\n                            }\n                        }\n                    }\n                    if (sle32(wave_sizze_20136, skip_threads_20160)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_20160, local_tid_20134 -\n                              squot32(local_tid_20134, 32) * 32) &&\n                        ltid_in_bounds_20159) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_20138)[sext_i32_i64(local_tid_20134)] =\n                                x_20145;\n                            x_20147 = x_20145;\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_20140)[sext_i32_i64(local_tid_20134)] =\n                                x_20146;\n                            x_20148 = x_20146;\n                        }\n                    }\n                    if (sle32(wave_sizze_20136, skip_threads_20160)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_20160 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_20134 - squot32(local_tid_20134, 32) * 32) ==\n                    31 && ltid_in_bounds_20159) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_20138)[sext_i32_i64(squot32(local_tid_20134,\n                                                                       3",
                   "2))] =\n                        x_20145;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_20140)[sext_i32_i64(squot32(local_tid_20134,\n                                                                          32))] =\n                        x_20146;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_20162;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_20134, 32) == 0 &&\n                        ltid_in_bounds_20159) {\n                        x_20154 = ((volatile __local\n                                    bool *) scan_arr_mem_20138)[sext_i32_i64(local_tid_20134)];\n                        x_20155 = ((volatile __local\n                                    int64_t *) scan_arr_mem_20140)[sext_i32_i64(local_tid_20134)];\n                        if ((local_tid_20134 - squot32(local_tid_20134, 32) *\n                             32) == 0) {\n                            x_20152 = x_20154;\n                            x_20153 = x_20155;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_20162 = 1;\n                    while (slt32(skip_threads_20162, 32)) {\n                        if (sle32(skip_threads_20162, local_tid_20134 -\n                                  squot32(local_tid_20134, 32) * 32) &&\n                            (squot32(local_tid_20134, 32) == 0 &&\n                             ltid_in_bounds_20159)) {\n                            // read operands\n                            {\n                                x_20152 = ((volatile __local\n                                            bool *) scan_arr_mem_20138)[sext_i32_i64(local_tid_20134) -\n                           ",
                   "                                             sext_i32_i64(skip_threads_20162)];\n                                x_20153 = ((volatile __local\n                                            int64_t *) scan_arr_mem_20140)[sext_i32_i64(local_tid_20134) -\n                                                                           sext_i32_i64(skip_threads_20162)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_20163 =\n                                     slt64(srem64(sext_i32_i64(local_tid_20134 *\n                                                  32 + 32 - 1) +\n                                                  chunk_offset_20143,\n                                                  res_16723),\n                                           sext_i32_i64(local_tid_20134 * 32 +\n                                           32 - 1) + chunk_offset_20143 -\n                                           (sext_i32_i64((local_tid_20134 -\n                                                          skip_threads_20162) *\n                                            32 + 32 - 1) + chunk_offset_20143));\n                                \n                                if (inactive_20163) {\n                                    x_20152 = x_20154;\n                                    x_20153 = x_20155;\n                                }\n                                if (!inactive_20163) {\n                                    bool res_20156 = x_20152 || x_20154;\n                                    int64_t res_20157;\n                                    \n                                    if (x_20154) {\n                                        res_20157 = x_20155;\n                                    } else {\n                                        int64_t res_20158 = add64(x_20153,\n                                                                  x_20155);\n                                        \n           ",
                   "                             res_20157 = res_20158;\n                                    }\n                                    x_20152 = res_20156;\n                                    x_20153 = res_20157;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_20136, skip_threads_20162)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_20162, local_tid_20134 -\n                                  squot32(local_tid_20134, 32) * 32) &&\n                            (squot32(local_tid_20134, 32) == 0 &&\n                             ltid_in_bounds_20159)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_20138)[sext_i32_i64(local_tid_20134)] =\n                                    x_20152;\n                                x_20154 = x_20152;\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_20140)[sext_i32_i64(local_tid_20134)] =\n                                    x_20153;\n                                x_20155 = x_20153;\n                            }\n                        }\n                        if (sle32(wave_sizze_20136, skip_threads_20162)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_20162 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_20134, 32) == 0 ||\n                      !ltid_in_bounds_20159)) {\n                    // read operands\n                    {\n                        x_20147 = x_20145;\n                        x_20148 = x_20146;\n                        x_20145 = ((__l",
                   "ocal\n                                    bool *) scan_arr_mem_20138)[sext_i32_i64(squot32(local_tid_20134,\n                                                                                     32)) -\n                                                                1];\n                        x_20146 = ((__local\n                                    int64_t *) scan_arr_mem_20140)[sext_i32_i64(squot32(local_tid_20134,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        bool inactive_20164 =\n                             slt64(srem64(sext_i32_i64(local_tid_20134) +\n                                          chunk_offset_20143, res_16723),\n                                   sext_i32_i64(local_tid_20134) +\n                                   chunk_offset_20143 -\n                                   (sext_i32_i64(squot32(local_tid_20134, 32) *\n                                    32 - 1) + chunk_offset_20143));\n                        \n                        if (inactive_20164) {\n                            x_20145 = x_20147;\n                            x_20146 = x_20148;\n                        }\n                        if (!inactive_20164) {\n                            bool res_20149 = x_20145 || x_20147;\n                            int64_t res_20150;\n                            \n                            if (x_20147) {\n                                res_20150 = x_20148;\n                            } else {\n                                int64_t res_20151 = add64(x_20146, x_20148);\n                                \n                                res_20150 = res_20151;\n                            }\n                            x_20145 = res_20149;\n                            x_20146 = res_20150;\n                        }\n                    }\n               ",
                   "     // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_20138)[sext_i32_i64(local_tid_20134)] =\n                            x_20145;\n                        ((__local\n                          int64_t *) scan_arr_mem_20140)[sext_i32_i64(local_tid_20134)] =\n                            x_20146;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_20134, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_20138)[sext_i32_i64(local_tid_20134)] =\n                        x_20147;\n                    ((__local\n                      int64_t *) scan_arr_mem_20140)[sext_i32_i64(local_tid_20134)] =\n                        x_20148;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_18184, paths_16674) && slt64(gtid_18192,\n                                                            res_16723)) {\n                    ((__global bool *) mem_19489)[gtid_18184 * res_16723 +\n                                                  gtid_18192] = ((__local\n                                                                  bool *) scan_arr_mem_20138)[sext_i32_i64(local_tid_20134)];\n                    ((__global int64_t *) mem_19492)[gtid_18184 * res_16723 +\n                                                     gtid_18192] = ((__local\n                                                                     int64_t *) scan_arr_mem_20140)[sext_i32_i64(local_tid_20134)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_20165 = slt64(srem64(chunk_offset_20143 +\n                ",
                   "                                          segscan_group_sizze_18557,\n                                                          res_16723),\n                                                   chunk_offset_20143 +\n                                                   segscan_group_sizze_18557 -\n                                                   (chunk_offset_20143 +\n                                                    segscan_group_sizze_18557 -\n                                                    1));\n                bool should_load_carry_20166 = local_tid_20134 == 0 &&\n                     !crosses_segment_20165;\n                \n                if (should_load_carry_20166) {\n                    x_18562 = ((__local\n                                bool *) scan_arr_mem_20138)[segscan_group_sizze_18557 -\n                                                            1];\n                    x_18563 = ((__local\n                                int64_t *) scan_arr_mem_20140)[segscan_group_sizze_18557 -\n                                                               1];\n                }\n                if (!should_load_carry_20166) {\n                    x_18562 = 0;\n                    x_18563 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_18557\n}\n__kernel void mainziscan_stage2_17045(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_19818_backing_aligned_0,\n                                      int64_t steps_16675, __global\n                                      unsigned char *mem_19265,\n                                      int64_t stage1_num_groups_19790,\n                                      int32_t num_threads_19791)\n{\n    #define segscan_group_sizze_17040 (mainzisegscan_group_sizze_17039)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 =",
                   " 2;\n    __local volatile char *restrict scan_arr_mem_19818_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_19818_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_19813;\n    int32_t local_tid_19814;\n    int64_t group_sizze_19817;\n    int32_t wave_sizze_19816;\n    int32_t group_tid_19815;\n    \n    global_tid_19813 = get_global_id(0);\n    local_tid_19814 = get_local_id(0);\n    group_sizze_19817 = get_local_size(0);\n    wave_sizze_19816 = LOCKSTEP_WIDTH;\n    group_tid_19815 = get_group_id(0);\n    \n    int32_t phys_tid_17045;\n    \n    phys_tid_17045 = global_tid_19813;\n    \n    __local char *scan_arr_mem_19818;\n    \n    scan_arr_mem_19818 = (__local char *) scan_arr_mem_19818_backing_0;\n    \n    int64_t flat_idx_19820;\n    \n    flat_idx_19820 = (sext_i32_i64(local_tid_19814) + 1) *\n        (segscan_group_sizze_17040 * sdiv_up64(steps_16675,\n                                               sext_i32_i64(num_threads_19791))) -\n        1;\n    \n    int64_t gtid_17044;\n    \n    gtid_17044 = flat_idx_19820;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_17044, steps_16675)) {\n            ((__local\n              int64_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814)] =\n                ((__global int64_t *) mem_19265)[gtid_17044];\n        } else {\n            ((__local\n              int64_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int64_t x_16706;\n    int64_t x_16707;\n    int64_t x_19821;\n    int64_t x_19822;\n    bool ltid_in_bounds_19824;\n    \n    ltid_in_bounds_19824 = slt64(sext_i32_i64(local_tid_19814),\n                                 stage1_num_groups_19790);\n    \n    int32_t skip_threads_19825;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_19824) {\n            x_16707 = ((volatile __local\n                        int6",
                   "4_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814)];\n            if ((local_tid_19814 - squot32(local_tid_19814, 32) * 32) == 0) {\n                x_16706 = x_16707;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_19825 = 1;\n        while (slt32(skip_threads_19825, 32)) {\n            if (sle32(skip_threads_19825, local_tid_19814 -\n                      squot32(local_tid_19814, 32) * 32) &&\n                ltid_in_bounds_19824) {\n                // read operands\n                {\n                    x_16706 = ((volatile __local\n                                int64_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814) -\n                                                               sext_i32_i64(skip_threads_19825)];\n                }\n                // perform operation\n                {\n                    int64_t res_16708 = add64(x_16706, x_16707);\n                    \n                    x_16706 = res_16708;\n                }\n            }\n            if (sle32(wave_sizze_19816, skip_threads_19825)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_19825, local_tid_19814 -\n                      squot32(local_tid_19814, 32) * 32) &&\n                ltid_in_bounds_19824) {\n                // write result\n                {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814)] =\n                        x_16706;\n                    x_16707 = x_16706;\n                }\n            }\n            if (sle32(wave_sizze_19816, skip_threads_19825)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_19825 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_19814 - squot32(local_tid_19814, 32) * 32) == 31 &&\n            ltid_in_bounds_19824) {\n            ((volatile",
                   " __local\n              int64_t *) scan_arr_mem_19818)[sext_i32_i64(squot32(local_tid_19814,\n                                                                  32))] =\n                x_16706;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_19826;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_19814, 32) == 0 && ltid_in_bounds_19824) {\n                x_19822 = ((volatile __local\n                            int64_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814)];\n                if ((local_tid_19814 - squot32(local_tid_19814, 32) * 32) ==\n                    0) {\n                    x_19821 = x_19822;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_19826 = 1;\n            while (slt32(skip_threads_19826, 32)) {\n                if (sle32(skip_threads_19826, local_tid_19814 -\n                          squot32(local_tid_19814, 32) * 32) &&\n                    (squot32(local_tid_19814, 32) == 0 &&\n                     ltid_in_bounds_19824)) {\n                    // read operands\n                    {\n                        x_19821 = ((volatile __local\n                                    int64_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814) -\n                                                                   sext_i32_i64(skip_threads_19826)];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_19823 = add64(x_19821, x_19822);\n                        \n                        x_19821 = res_19823;\n                    }\n                }\n                if (sle32(wave_sizze_19816, skip_threads_19826)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_19826, local_tid_19814 -\n              ",
                   "            squot32(local_tid_19814, 32) * 32) &&\n                    (squot32(local_tid_19814, 32) == 0 &&\n                     ltid_in_bounds_19824)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814)] =\n                            x_19821;\n                        x_19822 = x_19821;\n                    }\n                }\n                if (sle32(wave_sizze_19816, skip_threads_19826)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_19826 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_19814, 32) == 0 || !ltid_in_bounds_19824)) {\n            // read operands\n            {\n                x_16707 = x_16706;\n                x_16706 = ((__local\n                            int64_t *) scan_arr_mem_19818)[sext_i32_i64(squot32(local_tid_19814,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                int64_t res_16708 = add64(x_16706, x_16707);\n                \n                x_16706 = res_16708;\n            }\n            // write final result\n            {\n                ((__local\n                  int64_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814)] =\n                    x_16706;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_19814, 32) == 0) {\n            ((__local\n              int64_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814)] =\n                x_16707;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_17044, step",
                   "s_16675)) {\n            ((__global int64_t *) mem_19265)[gtid_17044] = ((__local\n                                                             int64_t *) scan_arr_mem_19818)[sext_i32_i64(local_tid_19814)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_17040\n}\n__kernel void mainziscan_stage2_17934(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20378_backing_aligned_0,\n                                      int64_t paths_16674, int64_t res_16723,\n                                      __global unsigned char *mem_19513,\n                                      int64_t stage1_num_groups_20347,\n                                      int32_t num_threads_20348)\n{\n    #define segscan_group_sizze_18767 (mainzisegscan_group_sizze_17928)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20378_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20378_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20373;\n    int32_t local_tid_20374;\n    int64_t group_sizze_20377;\n    int32_t wave_sizze_20376;\n    int32_t group_tid_20375;\n    \n    global_tid_20373 = get_global_id(0);\n    local_tid_20374 = get_local_id(0);\n    group_sizze_20377 = get_local_size(0);\n    wave_sizze_20376 = LOCKSTEP_WIDTH;\n    group_tid_20375 = get_group_id(0);\n    \n    int32_t phys_tid_17934;\n    \n    phys_tid_17934 = global_tid_20373;\n    \n    __local char *scan_arr_mem_20378;\n    \n    scan_arr_mem_20378 = (__local char *) scan_arr_mem_20378_backing_0;\n    \n    int64_t flat_idx_20380;\n    \n    flat_idx_20380 = (sext_i32_i64(local_tid_20374) + 1) *\n        (segscan_group_sizze_18767 * sdiv_up64(paths_16674 * res_16723,\n                                               sext_i32_i64(num_threads_20348))) -\n    ",
                   "    1;\n    \n    int64_t gtid_17925;\n    \n    gtid_17925 = squot64(flat_idx_20380, res_16723);\n    \n    int64_t gtid_17933;\n    \n    gtid_17933 = flat_idx_20380 - squot64(flat_idx_20380, res_16723) *\n        res_16723;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_17925, paths_16674) && slt64(gtid_17933, res_16723)) {\n            ((__local\n              int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374)] =\n                ((__global int64_t *) mem_19513)[gtid_17925 * res_16723 +\n                                                 gtid_17933];\n        } else {\n            ((__local\n              int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int64_t x_18771;\n    int64_t x_18772;\n    int64_t x_20381;\n    int64_t x_20382;\n    bool ltid_in_bounds_20384;\n    \n    ltid_in_bounds_20384 = slt64(sext_i32_i64(local_tid_20374),\n                                 stage1_num_groups_20347);\n    \n    int32_t skip_threads_20385;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_20384) {\n            x_18772 = ((volatile __local\n                        int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374)];\n            if ((local_tid_20374 - squot32(local_tid_20374, 32) * 32) == 0) {\n                x_18771 = x_18772;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_20385 = 1;\n        while (slt32(skip_threads_20385, 32)) {\n            if (sle32(skip_threads_20385, local_tid_20374 -\n                      squot32(local_tid_20374, 32) * 32) &&\n                ltid_in_bounds_20384) {\n                // read operands\n                {\n                    x_18771 = ((volatile __local\n                                int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374) -\n                                                               sext_i32_i64(skip_threads_20385)",
                   "];\n                }\n                // perform operation\n                {\n                    bool inactive_20386 =\n                         slt64(srem64((sext_i32_i64(local_tid_20374) + 1) *\n                                      (segscan_group_sizze_18767 *\n                                       sdiv_up64(paths_16674 * res_16723,\n                                                 sext_i32_i64(num_threads_20348))) -\n                                      1, res_16723),\n                               (sext_i32_i64(local_tid_20374) + 1) *\n                               (segscan_group_sizze_18767 *\n                                sdiv_up64(paths_16674 * res_16723,\n                                          sext_i32_i64(num_threads_20348))) -\n                               1 - ((sext_i32_i64(local_tid_20374 -\n                                     skip_threads_20385) + 1) *\n                                    (segscan_group_sizze_18767 *\n                                     sdiv_up64(paths_16674 * res_16723,\n                                               sext_i32_i64(num_threads_20348))) -\n                                    1));\n                    \n                    if (inactive_20386) {\n                        x_18771 = x_18772;\n                    }\n                    if (!inactive_20386) {\n                        int64_t res_18773 = add64(x_18771, x_18772);\n                        \n                        x_18771 = res_18773;\n                    }\n                }\n            }\n            if (sle32(wave_sizze_20376, skip_threads_20385)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_20385, local_tid_20374 -\n                      squot32(local_tid_20374, 32) * 32) &&\n                ltid_in_bounds_20384) {\n                // write result\n                {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374)] =\n                        x_18771;\n     ",
                   "               x_18772 = x_18771;\n                }\n            }\n            if (sle32(wave_sizze_20376, skip_threads_20385)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_20385 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_20374 - squot32(local_tid_20374, 32) * 32) == 31 &&\n            ltid_in_bounds_20384) {\n            ((volatile __local\n              int64_t *) scan_arr_mem_20378)[sext_i32_i64(squot32(local_tid_20374,\n                                                                  32))] =\n                x_18771;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_20387;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_20374, 32) == 0 && ltid_in_bounds_20384) {\n                x_20382 = ((volatile __local\n                            int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374)];\n                if ((local_tid_20374 - squot32(local_tid_20374, 32) * 32) ==\n                    0) {\n                    x_20381 = x_20382;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_20387 = 1;\n            while (slt32(skip_threads_20387, 32)) {\n                if (sle32(skip_threads_20387, local_tid_20374 -\n                          squot32(local_tid_20374, 32) * 32) &&\n                    (squot32(local_tid_20374, 32) == 0 &&\n                     ltid_in_bounds_20384)) {\n                    // read operands\n                    {\n                        x_20381 = ((volatile __local\n                                    int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374) -\n                                                                   sext_i32_i64(skip_threads_20387)]",
                   ";\n                    }\n                    // perform operation\n                    {\n                        bool inactive_20388 =\n                             slt64(srem64((sext_i32_i64(local_tid_20374 * 32 +\n                                           32 - 1) + 1) *\n                                          (segscan_group_sizze_18767 *\n                                           sdiv_up64(paths_16674 * res_16723,\n                                                     sext_i32_i64(num_threads_20348))) -\n                                          1, res_16723),\n                                   (sext_i32_i64(local_tid_20374 * 32 + 32 -\n                                    1) + 1) * (segscan_group_sizze_18767 *\n                                               sdiv_up64(paths_16674 *\n                                                         res_16723,\n                                                         sext_i32_i64(num_threads_20348))) -\n                                   1 - ((sext_i32_i64((local_tid_20374 -\n                                                       skip_threads_20387) *\n                                         32 + 32 - 1) + 1) *\n                                        (segscan_group_sizze_18767 *\n                                         sdiv_up64(paths_16674 * res_16723,\n                                                   sext_i32_i64(num_threads_20348))) -\n                                        1));\n                        \n                        if (inactive_20388) {\n                            x_20381 = x_20382;\n                        }\n                        if (!inactive_20388) {\n                            int64_t res_20383 = add64(x_20381, x_20382);\n                            \n                            x_20381 = res_20383;\n                        }\n                    }\n                }\n                if (sle32(wave_sizze_20376, skip_threads_20387)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (",
                   "sle32(skip_threads_20387, local_tid_20374 -\n                          squot32(local_tid_20374, 32) * 32) &&\n                    (squot32(local_tid_20374, 32) == 0 &&\n                     ltid_in_bounds_20384)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374)] =\n                            x_20381;\n                        x_20382 = x_20381;\n                    }\n                }\n                if (sle32(wave_sizze_20376, skip_threads_20387)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_20387 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_20374, 32) == 0 || !ltid_in_bounds_20384)) {\n            // read operands\n            {\n                x_18772 = x_18771;\n                x_18771 = ((__local\n                            int64_t *) scan_arr_mem_20378)[sext_i32_i64(squot32(local_tid_20374,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                bool inactive_20389 =\n                     slt64(srem64((sext_i32_i64(local_tid_20374) + 1) *\n                                  (segscan_group_sizze_18767 *\n                                   sdiv_up64(paths_16674 * res_16723,\n                                             sext_i32_i64(num_threads_20348))) -\n                                  1, res_16723),\n                           (sext_i32_i64(local_tid_20374) + 1) *\n                           (segscan_group_sizze_18767 * sdiv_up64(paths_16674 *\n                                                                  res_16723,\n                                                                  sext_i32_i64(num_threa",
                   "ds_20348))) -\n                           1 - ((sext_i32_i64(squot32(local_tid_20374, 32) *\n                                 32 - 1) + 1) * (segscan_group_sizze_18767 *\n                                                 sdiv_up64(paths_16674 *\n                                                           res_16723,\n                                                           sext_i32_i64(num_threads_20348))) -\n                                1));\n                \n                if (inactive_20389) {\n                    x_18771 = x_18772;\n                }\n                if (!inactive_20389) {\n                    int64_t res_18773 = add64(x_18771, x_18772);\n                    \n                    x_18771 = res_18773;\n                }\n            }\n            // write final result\n            {\n                ((__local\n                  int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374)] =\n                    x_18771;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_20374, 32) == 0) {\n            ((__local\n              int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374)] =\n                x_18772;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_17925, paths_16674) && slt64(gtid_17933, res_16723)) {\n            ((__global int64_t *) mem_19513)[gtid_17925 * res_16723 +\n                                             gtid_17933] = ((__local\n                                                             int64_t *) scan_arr_mem_20378)[sext_i32_i64(local_tid_20374)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_18767\n}\n__kernel void mainziscan_stage2_18042(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20318_backing_aligned_0,\n                                     ",
                   " __local volatile\n                                      int64_t *scan_arr_mem_20316_backing_aligned_1,\n                                      int64_t paths_16674, int64_t res_16723,\n                                      __global unsigned char *mem_19506,\n                                      __global unsigned char *mem_19509,\n                                      int64_t stage1_num_groups_20275,\n                                      int32_t num_threads_20276)\n{\n    #define segscan_group_sizze_18629 (mainzisegscan_group_sizze_18036)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20318_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_20318_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_20316_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20316_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20311;\n    int32_t local_tid_20312;\n    int64_t group_sizze_20315;\n    int32_t wave_sizze_20314;\n    int32_t group_tid_20313;\n    \n    global_tid_20311 = get_global_id(0);\n    local_tid_20312 = get_local_id(0);\n    group_sizze_20315 = get_local_size(0);\n    wave_sizze_20314 = LOCKSTEP_WIDTH;\n    group_tid_20313 = get_group_id(0);\n    \n    int32_t phys_tid_18042;\n    \n    phys_tid_18042 = global_tid_20311;\n    \n    __local char *scan_arr_mem_20316;\n    __local char *scan_arr_mem_20318;\n    \n    scan_arr_mem_20316 = (__local char *) scan_arr_mem_20316_backing_0;\n    scan_arr_mem_20318 = (__local char *) scan_arr_mem_20318_backing_1;\n    \n    int64_t flat_idx_20320;\n    \n    flat_idx_20320 = (sext_i32_i64(local_tid_20312) + 1) *\n        (segscan_group_sizze_18629 * sdiv_up64(paths_16674 * res_16723,\n                                               sext_i32_i64(num_threads_20276))) -\n        1;\n    \n    int64_t gt",
                   "id_18033;\n    \n    gtid_18033 = squot64(flat_idx_20320, res_16723);\n    \n    int64_t gtid_18041;\n    \n    gtid_18041 = flat_idx_20320 - squot64(flat_idx_20320, res_16723) *\n        res_16723;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_18033, paths_16674) && slt64(gtid_18041, res_16723)) {\n            ((__local\n              bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312)] =\n                ((__global bool *) mem_19506)[gtid_18033 * res_16723 +\n                                              gtid_18041];\n            ((__local\n              float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312)] =\n                ((__global float *) mem_19509)[gtid_18033 * res_16723 +\n                                               gtid_18041];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312)] = 0;\n            ((__local\n              float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312)] =\n                0.0F;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_18634;\n    float x_18635;\n    bool x_18636;\n    float x_18637;\n    bool x_20321;\n    float x_20322;\n    bool x_20323;\n    float x_20324;\n    bool ltid_in_bounds_20328;\n    \n    ltid_in_bounds_20328 = slt64(sext_i32_i64(local_tid_20312),\n                                 stage1_num_groups_20275);\n    \n    int32_t skip_threads_20329;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_20328) {\n            x_18636 = ((volatile __local\n                        bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312)];\n            x_18637 = ((volatile __local\n                        float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312)];\n            if ((local_tid_20312 - squot32(local_tid_20312, 32) * 32) == 0) {\n                x_18634 = x_18636;\n                x_18635 = x_18637;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n  ",
                   "  {\n        skip_threads_20329 = 1;\n        while (slt32(skip_threads_20329, 32)) {\n            if (sle32(skip_threads_20329, local_tid_20312 -\n                      squot32(local_tid_20312, 32) * 32) &&\n                ltid_in_bounds_20328) {\n                // read operands\n                {\n                    x_18634 = ((volatile __local\n                                bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312) -\n                                                            sext_i32_i64(skip_threads_20329)];\n                    x_18635 = ((volatile __local\n                                float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312) -\n                                                             sext_i32_i64(skip_threads_20329)];\n                }\n                // perform operation\n                {\n                    bool inactive_20330 =\n                         slt64(srem64((sext_i32_i64(local_tid_20312) + 1) *\n                                      (segscan_group_sizze_18629 *\n                                       sdiv_up64(paths_16674 * res_16723,\n                                                 sext_i32_i64(num_threads_20276))) -\n                                      1, res_16723),\n                               (sext_i32_i64(local_tid_20312) + 1) *\n                               (segscan_group_sizze_18629 *\n                                sdiv_up64(paths_16674 * res_16723,\n                                          sext_i32_i64(num_threads_20276))) -\n                               1 - ((sext_i32_i64(local_tid_20312 -\n                                     skip_threads_20329) + 1) *\n                                    (segscan_group_sizze_18629 *\n                                     sdiv_up64(paths_16674 * res_16723,\n                                               sext_i32_i64(num_threads_20276))) -\n                                    1));\n                    \n                    if (inactive_20330) {\n                        x_18634",
                   " = x_18636;\n                        x_18635 = x_18637;\n                    }\n                    if (!inactive_20330) {\n                        bool res_18638 = x_18634 || x_18636;\n                        float res_18639;\n                        \n                        if (x_18636) {\n                            res_18639 = x_18637;\n                        } else {\n                            float res_18640 = x_18635 + x_18637;\n                            \n                            res_18639 = res_18640;\n                        }\n                        x_18634 = res_18638;\n                        x_18635 = res_18639;\n                    }\n                }\n            }\n            if (sle32(wave_sizze_20314, skip_threads_20329)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_20329, local_tid_20312 -\n                      squot32(local_tid_20312, 32) * 32) &&\n                ltid_in_bounds_20328) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312)] =\n                        x_18634;\n                    x_18636 = x_18634;\n                    ((volatile __local\n                      float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312)] =\n                        x_18635;\n                    x_18637 = x_18635;\n                }\n            }\n            if (sle32(wave_sizze_20314, skip_threads_20329)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_20329 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_20312 - squot32(local_tid_20312, 32) * 32) == 31 &&\n            ltid_in_bounds_20328) {\n            ((volatile __local\n              bool *) scan_arr_mem_20316)[sext_i32_i64(squot32(local_tid_20312,\n                                                             ",
                   "  32))] = x_18634;\n            ((volatile __local\n              float *) scan_arr_mem_20318)[sext_i32_i64(squot32(local_tid_20312,\n                                                                32))] = x_18635;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_20331;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_20312, 32) == 0 && ltid_in_bounds_20328) {\n                x_20323 = ((volatile __local\n                            bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312)];\n                x_20324 = ((volatile __local\n                            float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312)];\n                if ((local_tid_20312 - squot32(local_tid_20312, 32) * 32) ==\n                    0) {\n                    x_20321 = x_20323;\n                    x_20322 = x_20324;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_20331 = 1;\n            while (slt32(skip_threads_20331, 32)) {\n                if (sle32(skip_threads_20331, local_tid_20312 -\n                          squot32(local_tid_20312, 32) * 32) &&\n                    (squot32(local_tid_20312, 32) == 0 &&\n                     ltid_in_bounds_20328)) {\n                    // read operands\n                    {\n                        x_20321 = ((volatile __local\n                                    bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312) -\n                                                                sext_i32_i64(skip_threads_20331)];\n                        x_20322 = ((volatile __local\n                                    float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312) -\n                                                                 sext_i32_i64(skip_threads_20331)];\n                    }\n                    ",
                   "// perform operation\n                    {\n                        bool inactive_20332 =\n                             slt64(srem64((sext_i32_i64(local_tid_20312 * 32 +\n                                           32 - 1) + 1) *\n                                          (segscan_group_sizze_18629 *\n                                           sdiv_up64(paths_16674 * res_16723,\n                                                     sext_i32_i64(num_threads_20276))) -\n                                          1, res_16723),\n                                   (sext_i32_i64(local_tid_20312 * 32 + 32 -\n                                    1) + 1) * (segscan_group_sizze_18629 *\n                                               sdiv_up64(paths_16674 *\n                                                         res_16723,\n                                                         sext_i32_i64(num_threads_20276))) -\n                                   1 - ((sext_i32_i64((local_tid_20312 -\n                                                       skip_threads_20331) *\n                                         32 + 32 - 1) + 1) *\n                                        (segscan_group_sizze_18629 *\n                                         sdiv_up64(paths_16674 * res_16723,\n                                                   sext_i32_i64(num_threads_20276))) -\n                                        1));\n                        \n                        if (inactive_20332) {\n                            x_20321 = x_20323;\n                            x_20322 = x_20324;\n                        }\n                        if (!inactive_20332) {\n                            bool res_20325 = x_20321 || x_20323;\n                            float res_20326;\n                            \n                            if (x_20323) {\n                                res_20326 = x_20324;\n                            } else {\n                                float res_20327 = x_20322 + x_20324;\n                            ",
                   "    \n                                res_20326 = res_20327;\n                            }\n                            x_20321 = res_20325;\n                            x_20322 = res_20326;\n                        }\n                    }\n                }\n                if (sle32(wave_sizze_20314, skip_threads_20331)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_20331, local_tid_20312 -\n                          squot32(local_tid_20312, 32) * 32) &&\n                    (squot32(local_tid_20312, 32) == 0 &&\n                     ltid_in_bounds_20328)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312)] =\n                            x_20321;\n                        x_20323 = x_20321;\n                        ((volatile __local\n                          float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312)] =\n                            x_20322;\n                        x_20324 = x_20322;\n                    }\n                }\n                if (sle32(wave_sizze_20314, skip_threads_20331)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_20331 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_20312, 32) == 0 || !ltid_in_bounds_20328)) {\n            // read operands\n            {\n                x_18636 = x_18634;\n                x_18637 = x_18635;\n                x_18634 = ((__local\n                            bool *) scan_arr_mem_20316)[sext_i32_i64(squot32(local_tid_20312,\n                                                                             32)) -\n                                                        1];\n                x_18635 = ((__local\n                            float *) scan_arr_mem_20318)[sext_i32",
                   "_i64(squot32(local_tid_20312,\n                                                                              32)) -\n                                                         1];\n            }\n            // perform operation\n            {\n                bool inactive_20333 =\n                     slt64(srem64((sext_i32_i64(local_tid_20312) + 1) *\n                                  (segscan_group_sizze_18629 *\n                                   sdiv_up64(paths_16674 * res_16723,\n                                             sext_i32_i64(num_threads_20276))) -\n                                  1, res_16723),\n                           (sext_i32_i64(local_tid_20312) + 1) *\n                           (segscan_group_sizze_18629 * sdiv_up64(paths_16674 *\n                                                                  res_16723,\n                                                                  sext_i32_i64(num_threads_20276))) -\n                           1 - ((sext_i32_i64(squot32(local_tid_20312, 32) *\n                                 32 - 1) + 1) * (segscan_group_sizze_18629 *\n                                                 sdiv_up64(paths_16674 *\n                                                           res_16723,\n                                                           sext_i32_i64(num_threads_20276))) -\n                                1));\n                \n                if (inactive_20333) {\n                    x_18634 = x_18636;\n                    x_18635 = x_18637;\n                }\n                if (!inactive_20333) {\n                    bool res_18638 = x_18634 || x_18636;\n                    float res_18639;\n                    \n                    if (x_18636) {\n                        res_18639 = x_18637;\n                    } else {\n                        float res_18640 = x_18635 + x_18637;\n                        \n                        res_18639 = res_18640;\n                    }\n                    x_18634 = res_18638;\n                    x_18635",
                   " = res_18639;\n                }\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312)] =\n                    x_18634;\n                ((__local\n                  float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312)] =\n                    x_18635;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_20312, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312)] =\n                x_18636;\n            ((__local\n              float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312)] =\n                x_18637;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_18033, paths_16674) && slt64(gtid_18041, res_16723)) {\n            ((__global bool *) mem_19506)[gtid_18033 * res_16723 + gtid_18041] =\n                ((__local\n                  bool *) scan_arr_mem_20316)[sext_i32_i64(local_tid_20312)];\n            ((__global float *) mem_19509)[gtid_18033 * res_16723 +\n                                           gtid_18041] = ((__local\n                                                           float *) scan_arr_mem_20318)[sext_i32_i64(local_tid_20312)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_18629\n}\n__kernel void mainziscan_stage2_18150(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20246_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20244_backing_aligned_1,\n                                      int64_t paths_16674, int64_t res_16723,\n                                      __global unsigned char *mem_19495,\n                        ",
                   "              __global unsigned char *mem_19498,\n                                      int64_t stage1_num_groups_20203,\n                                      int32_t num_threads_20204)\n{\n    #define segscan_group_sizze_18588 (mainzisegscan_group_sizze_18144)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20246_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_20246_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_20244_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20244_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20239;\n    int32_t local_tid_20240;\n    int64_t group_sizze_20243;\n    int32_t wave_sizze_20242;\n    int32_t group_tid_20241;\n    \n    global_tid_20239 = get_global_id(0);\n    local_tid_20240 = get_local_id(0);\n    group_sizze_20243 = get_local_size(0);\n    wave_sizze_20242 = LOCKSTEP_WIDTH;\n    group_tid_20241 = get_group_id(0);\n    \n    int32_t phys_tid_18150;\n    \n    phys_tid_18150 = global_tid_20239;\n    \n    __local char *scan_arr_mem_20244;\n    __local char *scan_arr_mem_20246;\n    \n    scan_arr_mem_20244 = (__local char *) scan_arr_mem_20244_backing_0;\n    scan_arr_mem_20246 = (__local char *) scan_arr_mem_20246_backing_1;\n    \n    int64_t flat_idx_20248;\n    \n    flat_idx_20248 = (sext_i32_i64(local_tid_20240) + 1) *\n        (segscan_group_sizze_18588 * sdiv_up64(paths_16674 * res_16723,\n                                               sext_i32_i64(num_threads_20204))) -\n        1;\n    \n    int64_t gtid_18141;\n    \n    gtid_18141 = squot64(flat_idx_20248, res_16723);\n    \n    int64_t gtid_18149;\n    \n    gtid_18149 = flat_idx_20248 - squot64(flat_idx_20248, res_16723) *\n        res_16723;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt",
                   "64(gtid_18141, paths_16674) && slt64(gtid_18149, res_16723)) {\n            ((__local\n              bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240)] =\n                ((__global bool *) mem_19495)[gtid_18141 * res_16723 +\n                                              gtid_18149];\n            ((__local\n              int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240)] =\n                ((__global int64_t *) mem_19498)[gtid_18141 * res_16723 +\n                                                 gtid_18149];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240)] = 0;\n            ((__local\n              int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_18594;\n    int64_t x_18595;\n    bool x_18596;\n    int64_t x_18597;\n    bool x_20249;\n    int64_t x_20250;\n    bool x_20251;\n    int64_t x_20252;\n    bool ltid_in_bounds_20256;\n    \n    ltid_in_bounds_20256 = slt64(sext_i32_i64(local_tid_20240),\n                                 stage1_num_groups_20203);\n    \n    int32_t skip_threads_20257;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_20256) {\n            x_18596 = ((volatile __local\n                        bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240)];\n            x_18597 = ((volatile __local\n                        int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240)];\n            if ((local_tid_20240 - squot32(local_tid_20240, 32) * 32) == 0) {\n                x_18594 = x_18596;\n                x_18595 = x_18597;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_20257 = 1;\n        while (slt32(skip_threads_20257, 32)) {\n            if (sle32(skip_threads_20257, local_tid_20240 -\n                      squot32(local_tid_20240, 32) * 32) &&\n                ltid_in_bounds_20256) {\n                // read operands\n  ",
                   "              {\n                    x_18594 = ((volatile __local\n                                bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240) -\n                                                            sext_i32_i64(skip_threads_20257)];\n                    x_18595 = ((volatile __local\n                                int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240) -\n                                                               sext_i32_i64(skip_threads_20257)];\n                }\n                // perform operation\n                {\n                    bool inactive_20258 =\n                         slt64(srem64((sext_i32_i64(local_tid_20240) + 1) *\n                                      (segscan_group_sizze_18588 *\n                                       sdiv_up64(paths_16674 * res_16723,\n                                                 sext_i32_i64(num_threads_20204))) -\n                                      1, res_16723),\n                               (sext_i32_i64(local_tid_20240) + 1) *\n                               (segscan_group_sizze_18588 *\n                                sdiv_up64(paths_16674 * res_16723,\n                                          sext_i32_i64(num_threads_20204))) -\n                               1 - ((sext_i32_i64(local_tid_20240 -\n                                     skip_threads_20257) + 1) *\n                                    (segscan_group_sizze_18588 *\n                                     sdiv_up64(paths_16674 * res_16723,\n                                               sext_i32_i64(num_threads_20204))) -\n                                    1));\n                    \n                    if (inactive_20258) {\n                        x_18594 = x_18596;\n                        x_18595 = x_18597;\n                    }\n                    if (!inactive_20258) {\n                        bool res_18598 = x_18594 || x_18596;\n                        int64_t res_18599;\n                        \n                        if",
                   " (x_18596) {\n                            res_18599 = x_18597;\n                        } else {\n                            int64_t res_18600 = add64(x_18595, x_18597);\n                            \n                            res_18599 = res_18600;\n                        }\n                        x_18594 = res_18598;\n                        x_18595 = res_18599;\n                    }\n                }\n            }\n            if (sle32(wave_sizze_20242, skip_threads_20257)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_20257, local_tid_20240 -\n                      squot32(local_tid_20240, 32) * 32) &&\n                ltid_in_bounds_20256) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240)] =\n                        x_18594;\n                    x_18596 = x_18594;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240)] =\n                        x_18595;\n                    x_18597 = x_18595;\n                }\n            }\n            if (sle32(wave_sizze_20242, skip_threads_20257)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_20257 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_20240 - squot32(local_tid_20240, 32) * 32) == 31 &&\n            ltid_in_bounds_20256) {\n            ((volatile __local\n              bool *) scan_arr_mem_20244)[sext_i32_i64(squot32(local_tid_20240,\n                                                               32))] = x_18594;\n            ((volatile __local\n              int64_t *) scan_arr_mem_20246)[sext_i32_i64(squot32(local_tid_20240,\n                                                                  32))] =\n                x_18595;\n        }\n    }\n    barrier(CLK",
                   "_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_20259;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_20240, 32) == 0 && ltid_in_bounds_20256) {\n                x_20251 = ((volatile __local\n                            bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240)];\n                x_20252 = ((volatile __local\n                            int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240)];\n                if ((local_tid_20240 - squot32(local_tid_20240, 32) * 32) ==\n                    0) {\n                    x_20249 = x_20251;\n                    x_20250 = x_20252;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_20259 = 1;\n            while (slt32(skip_threads_20259, 32)) {\n                if (sle32(skip_threads_20259, local_tid_20240 -\n                          squot32(local_tid_20240, 32) * 32) &&\n                    (squot32(local_tid_20240, 32) == 0 &&\n                     ltid_in_bounds_20256)) {\n                    // read operands\n                    {\n                        x_20249 = ((volatile __local\n                                    bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240) -\n                                                                sext_i32_i64(skip_threads_20259)];\n                        x_20250 = ((volatile __local\n                                    int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240) -\n                                                                   sext_i32_i64(skip_threads_20259)];\n                    }\n                    // perform operation\n                    {\n                        bool inactive_20260 =\n                             slt64(srem64((sext_i32_i64(local_tid_20240 * 32 +\n                                           32 - 1) + 1) *\n           ",
                   "                               (segscan_group_sizze_18588 *\n                                           sdiv_up64(paths_16674 * res_16723,\n                                                     sext_i32_i64(num_threads_20204))) -\n                                          1, res_16723),\n                                   (sext_i32_i64(local_tid_20240 * 32 + 32 -\n                                    1) + 1) * (segscan_group_sizze_18588 *\n                                               sdiv_up64(paths_16674 *\n                                                         res_16723,\n                                                         sext_i32_i64(num_threads_20204))) -\n                                   1 - ((sext_i32_i64((local_tid_20240 -\n                                                       skip_threads_20259) *\n                                         32 + 32 - 1) + 1) *\n                                        (segscan_group_sizze_18588 *\n                                         sdiv_up64(paths_16674 * res_16723,\n                                                   sext_i32_i64(num_threads_20204))) -\n                                        1));\n                        \n                        if (inactive_20260) {\n                            x_20249 = x_20251;\n                            x_20250 = x_20252;\n                        }\n                        if (!inactive_20260) {\n                            bool res_20253 = x_20249 || x_20251;\n                            int64_t res_20254;\n                            \n                            if (x_20251) {\n                                res_20254 = x_20252;\n                            } else {\n                                int64_t res_20255 = add64(x_20250, x_20252);\n                                \n                                res_20254 = res_20255;\n                            }\n                            x_20249 = res_20253;\n                            x_20250 = res_20254;\n                        }\n             ",
                   "       }\n                }\n                if (sle32(wave_sizze_20242, skip_threads_20259)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_20259, local_tid_20240 -\n                          squot32(local_tid_20240, 32) * 32) &&\n                    (squot32(local_tid_20240, 32) == 0 &&\n                     ltid_in_bounds_20256)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240)] =\n                            x_20249;\n                        x_20251 = x_20249;\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240)] =\n                            x_20250;\n                        x_20252 = x_20250;\n                    }\n                }\n                if (sle32(wave_sizze_20242, skip_threads_20259)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_20259 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_20240, 32) == 0 || !ltid_in_bounds_20256)) {\n            // read operands\n            {\n                x_18596 = x_18594;\n                x_18597 = x_18595;\n                x_18594 = ((__local\n                            bool *) scan_arr_mem_20244)[sext_i32_i64(squot32(local_tid_20240,\n                                                                             32)) -\n                                                        1];\n                x_18595 = ((__local\n                            int64_t *) scan_arr_mem_20246)[sext_i32_i64(squot32(local_tid_20240,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operat",
                   "ion\n            {\n                bool inactive_20261 =\n                     slt64(srem64((sext_i32_i64(local_tid_20240) + 1) *\n                                  (segscan_group_sizze_18588 *\n                                   sdiv_up64(paths_16674 * res_16723,\n                                             sext_i32_i64(num_threads_20204))) -\n                                  1, res_16723),\n                           (sext_i32_i64(local_tid_20240) + 1) *\n                           (segscan_group_sizze_18588 * sdiv_up64(paths_16674 *\n                                                                  res_16723,\n                                                                  sext_i32_i64(num_threads_20204))) -\n                           1 - ((sext_i32_i64(squot32(local_tid_20240, 32) *\n                                 32 - 1) + 1) * (segscan_group_sizze_18588 *\n                                                 sdiv_up64(paths_16674 *\n                                                           res_16723,\n                                                           sext_i32_i64(num_threads_20204))) -\n                                1));\n                \n                if (inactive_20261) {\n                    x_18594 = x_18596;\n                    x_18595 = x_18597;\n                }\n                if (!inactive_20261) {\n                    bool res_18598 = x_18594 || x_18596;\n                    int64_t res_18599;\n                    \n                    if (x_18596) {\n                        res_18599 = x_18597;\n                    } else {\n                        int64_t res_18600 = add64(x_18595, x_18597);\n                        \n                        res_18599 = res_18600;\n                    }\n                    x_18594 = res_18598;\n                    x_18595 = res_18599;\n                }\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240)] =\n          ",
                   "          x_18594;\n                ((__local\n                  int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240)] =\n                    x_18595;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_20240, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240)] =\n                x_18596;\n            ((__local\n              int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240)] =\n                x_18597;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_18141, paths_16674) && slt64(gtid_18149, res_16723)) {\n            ((__global bool *) mem_19495)[gtid_18141 * res_16723 + gtid_18149] =\n                ((__local\n                  bool *) scan_arr_mem_20244)[sext_i32_i64(local_tid_20240)];\n            ((__global int64_t *) mem_19498)[gtid_18141 * res_16723 +\n                                             gtid_18149] = ((__local\n                                                             int64_t *) scan_arr_mem_20246)[sext_i32_i64(local_tid_20240)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_18588\n}\n__kernel void mainziscan_stage2_18193(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20174_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20172_backing_aligned_1,\n                                      int64_t paths_16674, int64_t res_16723,\n                                      __global unsigned char *mem_19489,\n                                      __global unsigned char *mem_19492,\n                                      int64_t stage1_num_groups_20131,\n                                      int32_t num_threads_20132)\n{\n    #defin",
                   "e segscan_group_sizze_18557 (mainzisegscan_group_sizze_18187)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20174_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_20174_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_20172_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20172_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20167;\n    int32_t local_tid_20168;\n    int64_t group_sizze_20171;\n    int32_t wave_sizze_20170;\n    int32_t group_tid_20169;\n    \n    global_tid_20167 = get_global_id(0);\n    local_tid_20168 = get_local_id(0);\n    group_sizze_20171 = get_local_size(0);\n    wave_sizze_20170 = LOCKSTEP_WIDTH;\n    group_tid_20169 = get_group_id(0);\n    \n    int32_t phys_tid_18193;\n    \n    phys_tid_18193 = global_tid_20167;\n    \n    __local char *scan_arr_mem_20172;\n    __local char *scan_arr_mem_20174;\n    \n    scan_arr_mem_20172 = (__local char *) scan_arr_mem_20172_backing_0;\n    scan_arr_mem_20174 = (__local char *) scan_arr_mem_20174_backing_1;\n    \n    int64_t flat_idx_20176;\n    \n    flat_idx_20176 = (sext_i32_i64(local_tid_20168) + 1) *\n        (segscan_group_sizze_18557 * sdiv_up64(paths_16674 * res_16723,\n                                               sext_i32_i64(num_threads_20132))) -\n        1;\n    \n    int64_t gtid_18184;\n    \n    gtid_18184 = squot64(flat_idx_20176, res_16723);\n    \n    int64_t gtid_18192;\n    \n    gtid_18192 = flat_idx_20176 - squot64(flat_idx_20176, res_16723) *\n        res_16723;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_18184, paths_16674) && slt64(gtid_18192, res_16723)) {\n            ((__local\n              bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168)] =\n                ((__global bool *) me",
                   "m_19489)[gtid_18184 * res_16723 +\n                                              gtid_18192];\n            ((__local\n              int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168)] =\n                ((__global int64_t *) mem_19492)[gtid_18184 * res_16723 +\n                                                 gtid_18192];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168)] = 0;\n            ((__local\n              int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_18562;\n    int64_t x_18563;\n    bool x_18564;\n    int64_t x_18565;\n    bool x_20177;\n    int64_t x_20178;\n    bool x_20179;\n    int64_t x_20180;\n    bool ltid_in_bounds_20184;\n    \n    ltid_in_bounds_20184 = slt64(sext_i32_i64(local_tid_20168),\n                                 stage1_num_groups_20131);\n    \n    int32_t skip_threads_20185;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_20184) {\n            x_18564 = ((volatile __local\n                        bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168)];\n            x_18565 = ((volatile __local\n                        int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168)];\n            if ((local_tid_20168 - squot32(local_tid_20168, 32) * 32) == 0) {\n                x_18562 = x_18564;\n                x_18563 = x_18565;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_20185 = 1;\n        while (slt32(skip_threads_20185, 32)) {\n            if (sle32(skip_threads_20185, local_tid_20168 -\n                      squot32(local_tid_20168, 32) * 32) &&\n                ltid_in_bounds_20184) {\n                // read operands\n                {\n                    x_18562 = ((volatile __local\n                                bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168) -\n                                        ",
                   "                    sext_i32_i64(skip_threads_20185)];\n                    x_18563 = ((volatile __local\n                                int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168) -\n                                                               sext_i32_i64(skip_threads_20185)];\n                }\n                // perform operation\n                {\n                    bool inactive_20186 =\n                         slt64(srem64((sext_i32_i64(local_tid_20168) + 1) *\n                                      (segscan_group_sizze_18557 *\n                                       sdiv_up64(paths_16674 * res_16723,\n                                                 sext_i32_i64(num_threads_20132))) -\n                                      1, res_16723),\n                               (sext_i32_i64(local_tid_20168) + 1) *\n                               (segscan_group_sizze_18557 *\n                                sdiv_up64(paths_16674 * res_16723,\n                                          sext_i32_i64(num_threads_20132))) -\n                               1 - ((sext_i32_i64(local_tid_20168 -\n                                     skip_threads_20185) + 1) *\n                                    (segscan_group_sizze_18557 *\n                                     sdiv_up64(paths_16674 * res_16723,\n                                               sext_i32_i64(num_threads_20132))) -\n                                    1));\n                    \n                    if (inactive_20186) {\n                        x_18562 = x_18564;\n                        x_18563 = x_18565;\n                    }\n                    if (!inactive_20186) {\n                        bool res_18566 = x_18562 || x_18564;\n                        int64_t res_18567;\n                        \n                        if (x_18564) {\n                            res_18567 = x_18565;\n                        } else {\n                            int64_t res_18568 = add64(x_18563, x_18565);\n                            \n",
                   "                            res_18567 = res_18568;\n                        }\n                        x_18562 = res_18566;\n                        x_18563 = res_18567;\n                    }\n                }\n            }\n            if (sle32(wave_sizze_20170, skip_threads_20185)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_20185, local_tid_20168 -\n                      squot32(local_tid_20168, 32) * 32) &&\n                ltid_in_bounds_20184) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168)] =\n                        x_18562;\n                    x_18564 = x_18562;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168)] =\n                        x_18563;\n                    x_18565 = x_18563;\n                }\n            }\n            if (sle32(wave_sizze_20170, skip_threads_20185)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_20185 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_20168 - squot32(local_tid_20168, 32) * 32) == 31 &&\n            ltid_in_bounds_20184) {\n            ((volatile __local\n              bool *) scan_arr_mem_20172)[sext_i32_i64(squot32(local_tid_20168,\n                                                               32))] = x_18562;\n            ((volatile __local\n              int64_t *) scan_arr_mem_20174)[sext_i32_i64(squot32(local_tid_20168,\n                                                                  32))] =\n                x_18563;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_20187;\n        \n        // read input for in-block scan\n ",
                   "       {\n            if (squot32(local_tid_20168, 32) == 0 && ltid_in_bounds_20184) {\n                x_20179 = ((volatile __local\n                            bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168)];\n                x_20180 = ((volatile __local\n                            int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168)];\n                if ((local_tid_20168 - squot32(local_tid_20168, 32) * 32) ==\n                    0) {\n                    x_20177 = x_20179;\n                    x_20178 = x_20180;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_20187 = 1;\n            while (slt32(skip_threads_20187, 32)) {\n                if (sle32(skip_threads_20187, local_tid_20168 -\n                          squot32(local_tid_20168, 32) * 32) &&\n                    (squot32(local_tid_20168, 32) == 0 &&\n                     ltid_in_bounds_20184)) {\n                    // read operands\n                    {\n                        x_20177 = ((volatile __local\n                                    bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168) -\n                                                                sext_i32_i64(skip_threads_20187)];\n                        x_20178 = ((volatile __local\n                                    int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168) -\n                                                                   sext_i32_i64(skip_threads_20187)];\n                    }\n                    // perform operation\n                    {\n                        bool inactive_20188 =\n                             slt64(srem64((sext_i32_i64(local_tid_20168 * 32 +\n                                           32 - 1) + 1) *\n                                          (segscan_group_sizze_18557 *\n                                           sdiv_up64(paths_16674 * res_16723,\n                                                     sext_i",
                   "32_i64(num_threads_20132))) -\n                                          1, res_16723),\n                                   (sext_i32_i64(local_tid_20168 * 32 + 32 -\n                                    1) + 1) * (segscan_group_sizze_18557 *\n                                               sdiv_up64(paths_16674 *\n                                                         res_16723,\n                                                         sext_i32_i64(num_threads_20132))) -\n                                   1 - ((sext_i32_i64((local_tid_20168 -\n                                                       skip_threads_20187) *\n                                         32 + 32 - 1) + 1) *\n                                        (segscan_group_sizze_18557 *\n                                         sdiv_up64(paths_16674 * res_16723,\n                                                   sext_i32_i64(num_threads_20132))) -\n                                        1));\n                        \n                        if (inactive_20188) {\n                            x_20177 = x_20179;\n                            x_20178 = x_20180;\n                        }\n                        if (!inactive_20188) {\n                            bool res_20181 = x_20177 || x_20179;\n                            int64_t res_20182;\n                            \n                            if (x_20179) {\n                                res_20182 = x_20180;\n                            } else {\n                                int64_t res_20183 = add64(x_20178, x_20180);\n                                \n                                res_20182 = res_20183;\n                            }\n                            x_20177 = res_20181;\n                            x_20178 = res_20182;\n                        }\n                    }\n                }\n                if (sle32(wave_sizze_20170, skip_threads_20187)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_thre",
                   "ads_20187, local_tid_20168 -\n                          squot32(local_tid_20168, 32) * 32) &&\n                    (squot32(local_tid_20168, 32) == 0 &&\n                     ltid_in_bounds_20184)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168)] =\n                            x_20177;\n                        x_20179 = x_20177;\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168)] =\n                            x_20178;\n                        x_20180 = x_20178;\n                    }\n                }\n                if (sle32(wave_sizze_20170, skip_threads_20187)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_20187 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_20168, 32) == 0 || !ltid_in_bounds_20184)) {\n            // read operands\n            {\n                x_18564 = x_18562;\n                x_18565 = x_18563;\n                x_18562 = ((__local\n                            bool *) scan_arr_mem_20172)[sext_i32_i64(squot32(local_tid_20168,\n                                                                             32)) -\n                                                        1];\n                x_18563 = ((__local\n                            int64_t *) scan_arr_mem_20174)[sext_i32_i64(squot32(local_tid_20168,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                bool inactive_20189 =\n                     slt64(srem64((sext_i32_i64(local_tid_20168) + 1) *\n                                  (segscan_group_sizze_18557 *\n      ",
                   "                             sdiv_up64(paths_16674 * res_16723,\n                                             sext_i32_i64(num_threads_20132))) -\n                                  1, res_16723),\n                           (sext_i32_i64(local_tid_20168) + 1) *\n                           (segscan_group_sizze_18557 * sdiv_up64(paths_16674 *\n                                                                  res_16723,\n                                                                  sext_i32_i64(num_threads_20132))) -\n                           1 - ((sext_i32_i64(squot32(local_tid_20168, 32) *\n                                 32 - 1) + 1) * (segscan_group_sizze_18557 *\n                                                 sdiv_up64(paths_16674 *\n                                                           res_16723,\n                                                           sext_i32_i64(num_threads_20132))) -\n                                1));\n                \n                if (inactive_20189) {\n                    x_18562 = x_18564;\n                    x_18563 = x_18565;\n                }\n                if (!inactive_20189) {\n                    bool res_18566 = x_18562 || x_18564;\n                    int64_t res_18567;\n                    \n                    if (x_18564) {\n                        res_18567 = x_18565;\n                    } else {\n                        int64_t res_18568 = add64(x_18563, x_18565);\n                        \n                        res_18567 = res_18568;\n                    }\n                    x_18562 = res_18566;\n                    x_18563 = res_18567;\n                }\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168)] =\n                    x_18562;\n                ((__local\n                  int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168)] =\n                    x_18563;\n            }\n        }\n    }\n    barrier",
                   "(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_20168, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168)] =\n                x_18564;\n            ((__local\n              int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168)] =\n                x_18565;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_18184, paths_16674) && slt64(gtid_18192, res_16723)) {\n            ((__global bool *) mem_19489)[gtid_18184 * res_16723 + gtid_18192] =\n                ((__local\n                  bool *) scan_arr_mem_20172)[sext_i32_i64(local_tid_20168)];\n            ((__global int64_t *) mem_19492)[gtid_18184 * res_16723 +\n                                             gtid_18192] = ((__local\n                                                             int64_t *) scan_arr_mem_20174)[sext_i32_i64(local_tid_20168)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_18557\n}\n__kernel void mainziscan_stage3_17045(__global int *global_failure,\n                                      int64_t steps_16675,\n                                      int64_t num_groups_17042, __global\n                                      unsigned char *mem_19265,\n                                      int32_t num_threads_19791,\n                                      int32_t required_groups_19827)\n{\n    #define segscan_group_sizze_17040 (mainzisegscan_group_sizze_17039)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_19828;\n    int32_t local_tid_19829;\n    int64_t group_sizze_19832;\n    int32_t wave_sizze_19831;\n    int32_t group_tid_19830;\n    \n    global_tid_19828 = get_global_id(0);\n    local_tid_19829 = get_local_id(0);\n    group_sizze_19832 = get_local_size(0);\n    wave_sizze_19",
                   "831 = LOCKSTEP_WIDTH;\n    group_tid_19830 = get_group_id(0);\n    \n    int32_t phys_tid_17045;\n    \n    phys_tid_17045 = global_tid_19828;\n    \n    int32_t phys_group_id_19833;\n    \n    phys_group_id_19833 = get_group_id(0);\n    for (int32_t i_19834 = 0; i_19834 < sdiv_up32(required_groups_19827 -\n                                                  phys_group_id_19833,\n                                                  sext_i64_i32(num_groups_17042));\n         i_19834++) {\n        int32_t virt_group_id_19835 = phys_group_id_19833 + i_19834 *\n                sext_i64_i32(num_groups_17042);\n        int64_t flat_idx_19836 = sext_i32_i64(virt_group_id_19835) *\n                segscan_group_sizze_17040 + sext_i32_i64(local_tid_19829);\n        int64_t gtid_17044 = flat_idx_19836;\n        int64_t orig_group_19837 = squot64(flat_idx_19836,\n                                           segscan_group_sizze_17040 *\n                                           sdiv_up64(steps_16675,\n                                                     sext_i32_i64(num_threads_19791)));\n        int64_t carry_in_flat_idx_19838 = orig_group_19837 *\n                (segscan_group_sizze_17040 * sdiv_up64(steps_16675,\n                                                       sext_i32_i64(num_threads_19791))) -\n                1;\n        \n        if (slt64(gtid_17044, steps_16675)) {\n            if (!(orig_group_19837 == 0 || flat_idx_19836 == (orig_group_19837 +\n                                                              1) *\n                  (segscan_group_sizze_17040 * sdiv_up64(steps_16675,\n                                                         sext_i32_i64(num_threads_19791))) -\n                  1)) {\n                int64_t x_16706;\n                int64_t x_16707;\n                \n                x_16706 = ((__global\n                            int64_t *) mem_19265)[carry_in_flat_idx_19838];\n                x_16707 = ((__global int64_t *) mem_19265)[gtid_17044];\n                \n                int64",
                   "_t res_16708;\n                \n                res_16708 = add64(x_16706, x_16707);\n                x_16706 = res_16708;\n                ((__global int64_t *) mem_19265)[gtid_17044] = x_16706;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_17040\n}\n__kernel void mainziscan_stage3_17934(__global int *global_failure,\n                                      int64_t paths_16674, int64_t res_16723,\n                                      int64_t num_groups_18768, __global\n                                      unsigned char *mem_19513,\n                                      int32_t num_threads_20348,\n                                      int32_t required_groups_20390)\n{\n    #define segscan_group_sizze_18767 (mainzisegscan_group_sizze_17928)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20391;\n    int32_t local_tid_20392;\n    int64_t group_sizze_20395;\n    int32_t wave_sizze_20394;\n    int32_t group_tid_20393;\n    \n    global_tid_20391 = get_global_id(0);\n    local_tid_20392 = get_local_id(0);\n    group_sizze_20395 = get_local_size(0);\n    wave_sizze_20394 = LOCKSTEP_WIDTH;\n    group_tid_20393 = get_group_id(0);\n    \n    int32_t phys_tid_17934;\n    \n    phys_tid_17934 = global_tid_20391;\n    \n    int32_t phys_group_id_20396;\n    \n    phys_group_id_20396 = get_group_id(0);\n    for (int32_t i_20397 = 0; i_20397 < sdiv_up32(required_groups_20390 -\n                                                  phys_group_id_20396,\n                                                  sext_i64_i32(num_groups_18768));\n         i_20397++) {\n        int32_t virt_group_id_20398 = phys_group_id_20396 + i_20397 *\n                sext_i64_i32(num_groups_18768);\n        int64_t flat_idx_20399 = sext_i32_i64(virt_group_id_20398) *\n                segscan_group_sizze_18767 + sext_i32",
                   "_i64(local_tid_20392);\n        int64_t gtid_17925 = squot64(flat_idx_20399, res_16723);\n        int64_t gtid_17933 = flat_idx_20399 - squot64(flat_idx_20399,\n                                                      res_16723) * res_16723;\n        int64_t orig_group_20400 = squot64(flat_idx_20399,\n                                           segscan_group_sizze_18767 *\n                                           sdiv_up64(paths_16674 * res_16723,\n                                                     sext_i32_i64(num_threads_20348)));\n        int64_t carry_in_flat_idx_20401 = orig_group_20400 *\n                (segscan_group_sizze_18767 * sdiv_up64(paths_16674 * res_16723,\n                                                       sext_i32_i64(num_threads_20348))) -\n                1;\n        \n        if (slt64(gtid_17925, paths_16674) && slt64(gtid_17933, res_16723)) {\n            if (!(orig_group_20400 == 0 || (flat_idx_20399 ==\n                                            (orig_group_20400 + 1) *\n                                            (segscan_group_sizze_18767 *\n                                             sdiv_up64(paths_16674 * res_16723,\n                                                       sext_i32_i64(num_threads_20348))) -\n                                            1 || slt64(srem64(flat_idx_20399,\n                                                              res_16723),\n                                                       flat_idx_20399 -\n                                                       carry_in_flat_idx_20401)))) {\n                int64_t x_18771;\n                int64_t x_18772;\n                \n                x_18771 = ((__global\n                            int64_t *) mem_19513)[squot64(carry_in_flat_idx_20401,\n                                                          res_16723) *\n                                                  res_16723 +\n                                                  (carry_in_flat_idx_20401 -\n                                 ",
                   "                  squot64(carry_in_flat_idx_20401,\n                                                           res_16723) *\n                                                   res_16723)];\n                x_18772 = ((__global int64_t *) mem_19513)[gtid_17925 *\n                                                           res_16723 +\n                                                           gtid_17933];\n                \n                int64_t res_18773;\n                \n                res_18773 = add64(x_18771, x_18772);\n                x_18771 = res_18773;\n                ((__global int64_t *) mem_19513)[gtid_17925 * res_16723 +\n                                                 gtid_17933] = x_18771;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_18767\n}\n__kernel void mainziscan_stage3_18042(__global int *global_failure,\n                                      int64_t paths_16674, int64_t res_16723,\n                                      int64_t num_groups_18630, __global\n                                      unsigned char *mem_19506, __global\n                                      unsigned char *mem_19509,\n                                      int32_t num_threads_20276,\n                                      int32_t required_groups_20334)\n{\n    #define segscan_group_sizze_18629 (mainzisegscan_group_sizze_18036)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20335;\n    int32_t local_tid_20336;\n    int64_t group_sizze_20339;\n    int32_t wave_sizze_20338;\n    int32_t group_tid_20337;\n    \n    global_tid_20335 = get_global_id(0);\n    local_tid_20336 = get_local_id(0);\n    group_sizze_20339 = get_local_size(0);\n    wave_sizze_20338 = LOCKSTEP_WIDTH;\n    group_tid_20337 = get_group_id(0);\n    \n    int32_t phys_tid_18042;\n    \n    phys_tid_18042 = global",
                   "_tid_20335;\n    \n    int32_t phys_group_id_20340;\n    \n    phys_group_id_20340 = get_group_id(0);\n    for (int32_t i_20341 = 0; i_20341 < sdiv_up32(required_groups_20334 -\n                                                  phys_group_id_20340,\n                                                  sext_i64_i32(num_groups_18630));\n         i_20341++) {\n        int32_t virt_group_id_20342 = phys_group_id_20340 + i_20341 *\n                sext_i64_i32(num_groups_18630);\n        int64_t flat_idx_20343 = sext_i32_i64(virt_group_id_20342) *\n                segscan_group_sizze_18629 + sext_i32_i64(local_tid_20336);\n        int64_t gtid_18033 = squot64(flat_idx_20343, res_16723);\n        int64_t gtid_18041 = flat_idx_20343 - squot64(flat_idx_20343,\n                                                      res_16723) * res_16723;\n        int64_t orig_group_20344 = squot64(flat_idx_20343,\n                                           segscan_group_sizze_18629 *\n                                           sdiv_up64(paths_16674 * res_16723,\n                                                     sext_i32_i64(num_threads_20276)));\n        int64_t carry_in_flat_idx_20345 = orig_group_20344 *\n                (segscan_group_sizze_18629 * sdiv_up64(paths_16674 * res_16723,\n                                                       sext_i32_i64(num_threads_20276))) -\n                1;\n        \n        if (slt64(gtid_18033, paths_16674) && slt64(gtid_18041, res_16723)) {\n            if (!(orig_group_20344 == 0 || (flat_idx_20343 ==\n                                            (orig_group_20344 + 1) *\n                                            (segscan_group_sizze_18629 *\n                                             sdiv_up64(paths_16674 * res_16723,\n                                                       sext_i32_i64(num_threads_20276))) -\n                                            1 || slt64(srem64(flat_idx_20343,\n                                                              res_16723),\n                ",
                   "                                       flat_idx_20343 -\n                                                       carry_in_flat_idx_20345)))) {\n                bool x_18634;\n                float x_18635;\n                bool x_18636;\n                float x_18637;\n                \n                x_18634 = ((__global\n                            bool *) mem_19506)[squot64(carry_in_flat_idx_20345,\n                                                       res_16723) * res_16723 +\n                                               (carry_in_flat_idx_20345 -\n                                                squot64(carry_in_flat_idx_20345,\n                                                        res_16723) *\n                                                res_16723)];\n                x_18635 = ((__global\n                            float *) mem_19509)[squot64(carry_in_flat_idx_20345,\n                                                        res_16723) * res_16723 +\n                                                (carry_in_flat_idx_20345 -\n                                                 squot64(carry_in_flat_idx_20345,\n                                                         res_16723) *\n                                                 res_16723)];\n                x_18636 = ((__global bool *) mem_19506)[gtid_18033 * res_16723 +\n                                                        gtid_18041];\n                x_18637 = ((__global float *) mem_19509)[gtid_18033 *\n                                                         res_16723 +\n                                                         gtid_18041];\n                \n                bool res_18638;\n                \n                res_18638 = x_18634 || x_18636;\n                \n                float res_18639;\n                \n                if (x_18636) {\n                    res_18639 = x_18637;\n                } else {\n                    float res_18640 = x_18635 + x_18637;\n                    \n                    res_18639 = res",
                   "_18640;\n                }\n                x_18634 = res_18638;\n                x_18635 = res_18639;\n                ((__global bool *) mem_19506)[gtid_18033 * res_16723 +\n                                              gtid_18041] = x_18634;\n                ((__global float *) mem_19509)[gtid_18033 * res_16723 +\n                                               gtid_18041] = x_18635;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_18629\n}\n__kernel void mainziscan_stage3_18150(__global int *global_failure,\n                                      int64_t paths_16674, int64_t res_16723,\n                                      int64_t num_groups_18589, __global\n                                      unsigned char *mem_19495, __global\n                                      unsigned char *mem_19498,\n                                      int32_t num_threads_20204,\n                                      int32_t required_groups_20262)\n{\n    #define segscan_group_sizze_18588 (mainzisegscan_group_sizze_18144)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20263;\n    int32_t local_tid_20264;\n    int64_t group_sizze_20267;\n    int32_t wave_sizze_20266;\n    int32_t group_tid_20265;\n    \n    global_tid_20263 = get_global_id(0);\n    local_tid_20264 = get_local_id(0);\n    group_sizze_20267 = get_local_size(0);\n    wave_sizze_20266 = LOCKSTEP_WIDTH;\n    group_tid_20265 = get_group_id(0);\n    \n    int32_t phys_tid_18150;\n    \n    phys_tid_18150 = global_tid_20263;\n    \n    int32_t phys_group_id_20268;\n    \n    phys_group_id_20268 = get_group_id(0);\n    for (int32_t i_20269 = 0; i_20269 < sdiv_up32(required_groups_20262 -\n                                                  phys_group_id_20268,\n                                                  sext_i64_i32(num_groups_18589));",
                   "\n         i_20269++) {\n        int32_t virt_group_id_20270 = phys_group_id_20268 + i_20269 *\n                sext_i64_i32(num_groups_18589);\n        int64_t flat_idx_20271 = sext_i32_i64(virt_group_id_20270) *\n                segscan_group_sizze_18588 + sext_i32_i64(local_tid_20264);\n        int64_t gtid_18141 = squot64(flat_idx_20271, res_16723);\n        int64_t gtid_18149 = flat_idx_20271 - squot64(flat_idx_20271,\n                                                      res_16723) * res_16723;\n        int64_t orig_group_20272 = squot64(flat_idx_20271,\n                                           segscan_group_sizze_18588 *\n                                           sdiv_up64(paths_16674 * res_16723,\n                                                     sext_i32_i64(num_threads_20204)));\n        int64_t carry_in_flat_idx_20273 = orig_group_20272 *\n                (segscan_group_sizze_18588 * sdiv_up64(paths_16674 * res_16723,\n                                                       sext_i32_i64(num_threads_20204))) -\n                1;\n        \n        if (slt64(gtid_18141, paths_16674) && slt64(gtid_18149, res_16723)) {\n            if (!(orig_group_20272 == 0 || (flat_idx_20271 ==\n                                            (orig_group_20272 + 1) *\n                                            (segscan_group_sizze_18588 *\n                                             sdiv_up64(paths_16674 * res_16723,\n                                                       sext_i32_i64(num_threads_20204))) -\n                                            1 || slt64(srem64(flat_idx_20271,\n                                                              res_16723),\n                                                       flat_idx_20271 -\n                                                       carry_in_flat_idx_20273)))) {\n                bool x_18594;\n                int64_t x_18595;\n                bool x_18596;\n                int64_t x_18597;\n                \n                x_18594 = ((__global\n    ",
                   "                        bool *) mem_19495)[squot64(carry_in_flat_idx_20273,\n                                                       res_16723) * res_16723 +\n                                               (carry_in_flat_idx_20273 -\n                                                squot64(carry_in_flat_idx_20273,\n                                                        res_16723) *\n                                                res_16723)];\n                x_18595 = ((__global\n                            int64_t *) mem_19498)[squot64(carry_in_flat_idx_20273,\n                                                          res_16723) *\n                                                  res_16723 +\n                                                  (carry_in_flat_idx_20273 -\n                                                   squot64(carry_in_flat_idx_20273,\n                                                           res_16723) *\n                                                   res_16723)];\n                x_18596 = ((__global bool *) mem_19495)[gtid_18141 * res_16723 +\n                                                        gtid_18149];\n                x_18597 = ((__global int64_t *) mem_19498)[gtid_18141 *\n                                                           res_16723 +\n                                                           gtid_18149];\n                \n                bool res_18598;\n                \n                res_18598 = x_18594 || x_18596;\n                \n                int64_t res_18599;\n                \n                if (x_18596) {\n                    res_18599 = x_18597;\n                } else {\n                    int64_t res_18600 = add64(x_18595, x_18597);\n                    \n                    res_18599 = res_18600;\n                }\n                x_18594 = res_18598;\n                x_18595 = res_18599;\n                ((__global bool *) mem_19495)[gtid_18141 * res_16723 +\n                                              gtid_18149] = x_18594;\n   ",
                   "             ((__global int64_t *) mem_19498)[gtid_18141 * res_16723 +\n                                                 gtid_18149] = x_18595;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_18588\n}\n__kernel void mainziscan_stage3_18193(__global int *global_failure,\n                                      int64_t paths_16674, int64_t res_16723,\n                                      int64_t num_groups_18558, __global\n                                      unsigned char *mem_19489, __global\n                                      unsigned char *mem_19492,\n                                      int32_t num_threads_20132,\n                                      int32_t required_groups_20190)\n{\n    #define segscan_group_sizze_18557 (mainzisegscan_group_sizze_18187)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20191;\n    int32_t local_tid_20192;\n    int64_t group_sizze_20195;\n    int32_t wave_sizze_20194;\n    int32_t group_tid_20193;\n    \n    global_tid_20191 = get_global_id(0);\n    local_tid_20192 = get_local_id(0);\n    group_sizze_20195 = get_local_size(0);\n    wave_sizze_20194 = LOCKSTEP_WIDTH;\n    group_tid_20193 = get_group_id(0);\n    \n    int32_t phys_tid_18193;\n    \n    phys_tid_18193 = global_tid_20191;\n    \n    int32_t phys_group_id_20196;\n    \n    phys_group_id_20196 = get_group_id(0);\n    for (int32_t i_20197 = 0; i_20197 < sdiv_up32(required_groups_20190 -\n                                                  phys_group_id_20196,\n                                                  sext_i64_i32(num_groups_18558));\n         i_20197++) {\n        int32_t virt_group_id_20198 = phys_group_id_20196 + i_20197 *\n                sext_i64_i32(num_groups_18558);\n        int64_t flat_idx_20199 = sext_i32_i64(virt_group_id_20198) *\n                segscan_group",
                   "_sizze_18557 + sext_i32_i64(local_tid_20192);\n        int64_t gtid_18184 = squot64(flat_idx_20199, res_16723);\n        int64_t gtid_18192 = flat_idx_20199 - squot64(flat_idx_20199,\n                                                      res_16723) * res_16723;\n        int64_t orig_group_20200 = squot64(flat_idx_20199,\n                                           segscan_group_sizze_18557 *\n                                           sdiv_up64(paths_16674 * res_16723,\n                                                     sext_i32_i64(num_threads_20132)));\n        int64_t carry_in_flat_idx_20201 = orig_group_20200 *\n                (segscan_group_sizze_18557 * sdiv_up64(paths_16674 * res_16723,\n                                                       sext_i32_i64(num_threads_20132))) -\n                1;\n        \n        if (slt64(gtid_18184, paths_16674) && slt64(gtid_18192, res_16723)) {\n            if (!(orig_group_20200 == 0 || (flat_idx_20199 ==\n                                            (orig_group_20200 + 1) *\n                                            (segscan_group_sizze_18557 *\n                                             sdiv_up64(paths_16674 * res_16723,\n                                                       sext_i32_i64(num_threads_20132))) -\n                                            1 || slt64(srem64(flat_idx_20199,\n                                                              res_16723),\n                                                       flat_idx_20199 -\n                                                       carry_in_flat_idx_20201)))) {\n                bool x_18562;\n                int64_t x_18563;\n                bool x_18564;\n                int64_t x_18565;\n                \n                x_18562 = ((__global\n                            bool *) mem_19489)[squot64(carry_in_flat_idx_20201,\n                                                       res_16723) * res_16723 +\n                                               (carry_in_flat_idx_20201 -\n         ",
                   "                                       squot64(carry_in_flat_idx_20201,\n                                                        res_16723) *\n                                                res_16723)];\n                x_18563 = ((__global\n                            int64_t *) mem_19492)[squot64(carry_in_flat_idx_20201,\n                                                          res_16723) *\n                                                  res_16723 +\n                                                  (carry_in_flat_idx_20201 -\n                                                   squot64(carry_in_flat_idx_20201,\n                                                           res_16723) *\n                                                   res_16723)];\n                x_18564 = ((__global bool *) mem_19489)[gtid_18184 * res_16723 +\n                                                        gtid_18192];\n                x_18565 = ((__global int64_t *) mem_19492)[gtid_18184 *\n                                                           res_16723 +\n                                                           gtid_18192];\n                \n                bool res_18566;\n                \n                res_18566 = x_18562 || x_18564;\n                \n                int64_t res_18567;\n                \n                if (x_18564) {\n                    res_18567 = x_18565;\n                } else {\n                    int64_t res_18568 = add64(x_18563, x_18565);\n                    \n                    res_18567 = res_18568;\n                }\n                x_18562 = res_18566;\n                x_18563 = res_18567;\n                ((__global bool *) mem_19489)[gtid_18184 * res_16723 +\n                                              gtid_18192] = x_18562;\n                ((__global int64_t *) mem_19492)[gtid_18184 * res_16723 +\n                                                 gtid_18192] = x_18563;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n",
                   "  error_0:\n    return;\n    #undef segscan_group_sizze_18557\n}\n__kernel void mainziseghist_global_18214(__global int *global_failure,\n                                         int64_t paths_16674,\n                                         int64_t steps_16675, int64_t res_16723,\n                                         int64_t num_groups_18547, __global\n                                         unsigned char *mem_19274,\n                                         int32_t num_subhistos_19971, __global\n                                         unsigned char *res_r_subhistos_mem_19972,\n                                         __global\n                                         unsigned char *mainzihist_locks_mem_20054,\n                                         int32_t chk_i_20056,\n                                         int64_t hist_H_chk_20057)\n{\n    #define seghist_group_sizze_18546 (mainziseghist_group_sizze_18208)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20058;\n    int32_t local_tid_20059;\n    int64_t group_sizze_20062;\n    int32_t wave_sizze_20061;\n    int32_t group_tid_20060;\n    \n    global_tid_20058 = get_global_id(0);\n    local_tid_20059 = get_local_id(0);\n    group_sizze_20062 = get_local_size(0);\n    wave_sizze_20061 = LOCKSTEP_WIDTH;\n    group_tid_20060 = get_group_id(0);\n    \n    int32_t phys_tid_18214;\n    \n    phys_tid_18214 = global_tid_20058;\n    \n    int32_t subhisto_ind_20063;\n    \n    subhisto_ind_20063 = squot32(global_tid_20058,\n                                 sdiv_up32(sext_i64_i32(seghist_group_sizze_18546 *\n                                           num_groups_18547),\n                                           num_subhistos_19971));\n    for (int64_t i_20064 = 0; i_20064 < sdiv_up64(paths_16674 * steps_16675 -\n                                                  sext_i32_i64(global_tid_20058),\n                                  ",
                   "                sext_i32_i64(sext_i64_i32(seghist_group_sizze_18546 *\n                                                  num_groups_18547)));\n         i_20064++) {\n        int32_t gtid_18205 = sext_i64_i32(squot64(i_20064 *\n                                                  sext_i32_i64(sext_i64_i32(seghist_group_sizze_18546 *\n                                                  num_groups_18547)) +\n                                                  sext_i32_i64(global_tid_20058),\n                                                  steps_16675));\n        int32_t gtid_18213 = sext_i64_i32(i_20064 *\n                sext_i32_i64(sext_i64_i32(seghist_group_sizze_18546 *\n                num_groups_18547)) + sext_i32_i64(global_tid_20058) -\n                squot64(i_20064 *\n                        sext_i32_i64(sext_i64_i32(seghist_group_sizze_18546 *\n                        num_groups_18547)) + sext_i32_i64(global_tid_20058),\n                        steps_16675) * steps_16675);\n        \n        if (slt64(i_20064 *\n                  sext_i32_i64(sext_i64_i32(seghist_group_sizze_18546 *\n                  num_groups_18547)) + sext_i32_i64(global_tid_20058),\n                  paths_16674 * steps_16675)) {\n            int64_t bucket_p_18553 = ((__global\n                                       int64_t *) mem_19274)[gtid_18213];\n            \n            // save map-out results\n            { }\n            // perform atomic updates\n            {\n                if (sle64(sext_i32_i64(chk_i_20056) * hist_H_chk_20057,\n                          bucket_p_18553) && (slt64(bucket_p_18553,\n                                                    sext_i32_i64(chk_i_20056) *\n                                                    hist_H_chk_20057 +\n                                                    hist_H_chk_20057) &&\n                                              slt64(bucket_p_18553,\n                                                    res_16723))) {\n                    int64_t x_18550;\n                  ",
                   "  int64_t x_18551;\n                    \n                    x_18551 = gtid_18213;\n                    \n                    int32_t old_20065;\n                    volatile bool continue_20066;\n                    \n                    continue_20066 = 1;\n                    while (continue_20066) {\n                        old_20065 =\n                            atomic_cmpxchg_i32_global(&((volatile __global\n                                                         int *) mainzihist_locks_mem_20054)[srem64(gtid_18205 *\n                                                                                                   res_16723 +\n                                                                                                   sext_i32_i64(subhisto_ind_20063),\n                                                                                                   100151)],\n                                                      0, 1);\n                        if (old_20065 == 0) {\n                            int64_t x_18550;\n                            \n                            // bind lhs\n                            {\n                                x_18550 = ((volatile __global\n                                            int64_t *) res_r_subhistos_mem_19972)[gtid_18205 *\n                                                                                  (res_16723 *\n                                                                                   num_subhistos_19971) +\n                                                                                  sext_i32_i64(subhisto_ind_20063) *\n                                                                                  res_16723 +\n                                                                                  bucket_p_18553];\n                            }\n                            // execute operation\n                            {\n                                int64_t res_18552 = smax64(x_18550, x_18551);\n                    ",
                   "            \n                                x_18550 = res_18552;\n                            }\n                            // update global result\n                            {\n                                ((volatile __global\n                                  int64_t *) res_r_subhistos_mem_19972)[gtid_18205 *\n                                                                        (res_16723 *\n                                                                         num_subhistos_19971) +\n                                                                        sext_i32_i64(subhisto_ind_20063) *\n                                                                        res_16723 +\n                                                                        bucket_p_18553] =\n                                    x_18550;\n                            }\n                            mem_fence_global();\n                            old_20065 =\n                                atomic_cmpxchg_i32_global(&((volatile __global\n                                                             int *) mainzihist_locks_mem_20054)[srem64(gtid_18205 *\n                                                                                                       res_16723 +\n                                                                                                       sext_i32_i64(subhisto_ind_20063),\n                                                                                                       100151)],\n                                                          1, 0);\n                            continue_20066 = 0;\n                        }\n                        mem_fence_global();\n                    }\n                }\n            }\n        }\n    }\n    \n  error_0:\n    return;\n    #undef seghist_group_sizze_18546\n}\n__kernel void mainziseghist_local_18214(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *lock",
                   "s_mem_20019_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *subhistogram_local_mem_20017_backing_aligned_1,\n                                        int64_t steps_16675, int64_t res_16723,\n                                        __global unsigned char *mem_19274,\n                                        int32_t num_subhistos_19971, __global\n                                        unsigned char *res_r_subhistos_mem_19972,\n                                        int32_t max_group_sizze_19981,\n                                        int64_t num_groups_19982,\n                                        int32_t hist_M_19989,\n                                        int64_t groups_per_segment_19993,\n                                        int32_t chk_i_20000,\n                                        int64_t num_segments_20001,\n                                        int64_t hist_H_chk_20002,\n                                        int64_t histo_sizze_20003,\n                                        int32_t init_per_thread_20004)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict locks_mem_20019_backing_1 =\n                          (__local volatile\n                           char *) locks_mem_20019_backing_aligned_0;\n    __local volatile char *restrict subhistogram_local_mem_20017_backing_0 =\n                          (__local volatile\n                           char *) subhistogram_local_mem_20017_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20005;\n    int32_t local_tid_20006;\n    int64_t group_sizze_20009;\n    int32_t wave_sizze_20008;\n    int32_t group_tid_20007;\n    \n    global_tid_20005 = get_global_id(0);\n    local_tid_20006 = get_local_id(0);\n    group_sizze_20009 = get_local_size(0);\n    wave_sizze_20008 = LOCKSTEP_WIDTH;\n    group_tid_20007 = get_group_id(0);\n    \n    ",
                   "int32_t phys_tid_18214;\n    \n    phys_tid_18214 = global_tid_20005;\n    \n    int32_t phys_group_id_20010;\n    \n    phys_group_id_20010 = get_group_id(0);\n    for (int32_t i_20011 = 0; i_20011 <\n         sdiv_up32(sext_i64_i32(groups_per_segment_19993 * num_segments_20001) -\n                   phys_group_id_20010, sext_i64_i32(num_groups_19982));\n         i_20011++) {\n        int32_t virt_group_id_20012 = phys_group_id_20010 + i_20011 *\n                sext_i64_i32(num_groups_19982);\n        int32_t flat_segment_id_20013 = squot32(virt_group_id_20012,\n                                                sext_i64_i32(groups_per_segment_19993));\n        int32_t gid_in_segment_20014 = srem32(virt_group_id_20012,\n                                              sext_i64_i32(groups_per_segment_19993));\n        int32_t pgtid_in_segment_20015 = gid_in_segment_20014 *\n                sext_i64_i32(max_group_sizze_19981) + local_tid_20006;\n        int32_t threads_per_segment_20016 =\n                sext_i64_i32(groups_per_segment_19993 * max_group_sizze_19981);\n        int64_t gtid_18205 = sext_i32_i64(flat_segment_id_20013);\n        __local char *subhistogram_local_mem_20017;\n        \n        subhistogram_local_mem_20017 = (__local\n                                        char *) subhistogram_local_mem_20017_backing_0;\n        \n        __local char *locks_mem_20019;\n        \n        locks_mem_20019 = (__local char *) locks_mem_20019_backing_1;\n        // All locks start out unlocked\n        {\n            for (int64_t i_20021 = 0; i_20021 < sdiv_up64(hist_M_19989 *\n                                                          hist_H_chk_20002 -\n                                                          sext_i32_i64(local_tid_20006),\n                                                          max_group_sizze_19981);\n                 i_20021++) {\n                ((__local int32_t *) locks_mem_20019)[squot64(i_20021 *\n                                                              max_group_sizze_",
                   "19981 +\n                                                              sext_i32_i64(local_tid_20006),\n                                                              hist_H_chk_20002) *\n                                                      hist_H_chk_20002 +\n                                                      (i_20021 *\n                                                       max_group_sizze_19981 +\n                                                       sext_i32_i64(local_tid_20006) -\n                                                       squot64(i_20021 *\n                                                               max_group_sizze_19981 +\n                                                               sext_i32_i64(local_tid_20006),\n                                                               hist_H_chk_20002) *\n                                                       hist_H_chk_20002)] = 0;\n            }\n        }\n        \n        int32_t thread_local_subhisto_i_20022;\n        \n        thread_local_subhisto_i_20022 = srem32(local_tid_20006, hist_M_19989);\n        // initialize histograms in local memory\n        {\n            for (int32_t local_i_20023 = 0; local_i_20023 <\n                 init_per_thread_20004; local_i_20023++) {\n                int32_t j_20024 = local_i_20023 *\n                        sext_i64_i32(max_group_sizze_19981) + local_tid_20006;\n                int32_t j_offset_20025 = hist_M_19989 *\n                        sext_i64_i32(histo_sizze_20003) * gid_in_segment_20014 +\n                        j_20024;\n                int32_t local_subhisto_i_20026 = squot32(j_20024,\n                                                         sext_i64_i32(histo_sizze_20003));\n                int32_t global_subhisto_i_20027 = squot32(j_offset_20025,\n                                                          sext_i64_i32(histo_sizze_20003));\n                \n                if (slt32(j_20024, hist_M_19989 *\n                          sext_i64_i32(histo_sizze_20003))) {\n",
                   "                    // First subhistogram is initialised from global memory; others with neutral element.\n                    {\n                        if (global_subhisto_i_20027 == 0) {\n                            ((__local\n                              int64_t *) subhistogram_local_mem_20017)[sext_i32_i64(local_subhisto_i_20026) *\n                                                                       hist_H_chk_20002 +\n                                                                       sext_i32_i64(srem32(j_20024,\n                                                                                           sext_i64_i32(histo_sizze_20003)))] =\n                                ((__global\n                                  int64_t *) res_r_subhistos_mem_19972)[gtid_18205 *\n                                                                        (res_16723 *\n                                                                         num_subhistos_19971) +\n                                                                        (sext_i32_i64(srem32(j_20024,\n                                                                                             sext_i64_i32(histo_sizze_20003))) +\n                                                                         sext_i32_i64(chk_i_20000) *\n                                                                         hist_H_chk_20002)];\n                        } else {\n                            ((__local\n                              int64_t *) subhistogram_local_mem_20017)[sext_i32_i64(local_subhisto_i_20026) *\n                                                                       hist_H_chk_20002 +\n                                                                       sext_i32_i64(srem32(j_20024,\n                                                                                           sext_i64_i32(histo_sizze_20003)))] =\n                                0;\n                        }\n                    }\n                }\n            ",
                   "}\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_20028 = 0; i_20028 <\n             sdiv_up32(sext_i64_i32(steps_16675) - pgtid_in_segment_20015,\n                       threads_per_segment_20016); i_20028++) {\n            int32_t gtid_18213 = i_20028 * threads_per_segment_20016 +\n                    pgtid_in_segment_20015;\n            int64_t bucket_p_18553 = ((__global\n                                       int64_t *) mem_19274)[gtid_18213];\n            \n            if (chk_i_20000 == 0) {\n                // save map-out results\n                { }\n            }\n            // perform atomic updates\n            {\n                if (slt64(bucket_p_18553, res_16723) &&\n                    (sle64(sext_i32_i64(chk_i_20000) * hist_H_chk_20002,\n                           bucket_p_18553) && slt64(bucket_p_18553,\n                                                    sext_i32_i64(chk_i_20000) *\n                                                    hist_H_chk_20002 +\n                                                    hist_H_chk_20002))) {\n                    int64_t x_18550;\n                    int64_t x_18551;\n                    \n                    x_18551 = gtid_18213;\n                    \n                    int32_t old_20029;\n                    volatile bool continue_20030;\n                    \n                    continue_20030 = 1;\n                    while (continue_20030) {\n                        old_20029 = atomic_cmpxchg_i32_local(&((volatile __local\n                                                                int *) locks_mem_20019)[sext_i32_i64(thread_local_subhisto_i_20022) *\n                                                                                        hist_H_chk_20002 +\n                                                                                        (bucket_p_18553 -\n                                                                                         sext_i32_i64(chk_i_20000) *\n                                   ",
                   "                                                      hist_H_chk_20002)],\n                                                             0, 1);\n                        if (old_20029 == 0) {\n                            int64_t x_18550;\n                            \n                            // bind lhs\n                            {\n                                x_18550 = ((volatile __local\n                                            int64_t *) subhistogram_local_mem_20017)[sext_i32_i64(thread_local_subhisto_i_20022) *\n                                                                                     hist_H_chk_20002 +\n                                                                                     (bucket_p_18553 -\n                                                                                      sext_i32_i64(chk_i_20000) *\n                                                                                      hist_H_chk_20002)];\n                            }\n                            // execute operation\n                            {\n                                int64_t res_18552 = smax64(x_18550, x_18551);\n                                \n                                x_18550 = res_18552;\n                            }\n                            // update global result\n                            {\n                                ((volatile __local\n                                  int64_t *) subhistogram_local_mem_20017)[sext_i32_i64(thread_local_subhisto_i_20022) *\n                                                                           hist_H_chk_20002 +\n                                                                           (bucket_p_18553 -\n                                                                            sext_i32_i64(chk_i_20000) *\n                                                                            hist_H_chk_20002)] =\n                                    x_18550;\n                            }\n                            m",
                   "em_fence_local();\n                            old_20029 =\n                                atomic_cmpxchg_i32_local(&((volatile __local\n                                                            int *) locks_mem_20019)[sext_i32_i64(thread_local_subhisto_i_20022) *\n                                                                                    hist_H_chk_20002 +\n                                                                                    (bucket_p_18553 -\n                                                                                     sext_i32_i64(chk_i_20000) *\n                                                                                     hist_H_chk_20002)],\n                                                         1, 0);\n                            continue_20030 = 0;\n                        }\n                        mem_fence_local();\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Compact the multiple local memory subhistograms to result in global memory\n        {\n            int64_t trunc_H_20031 = smin64(hist_H_chk_20002, res_16723 -\n                                           sext_i32_i64(chk_i_20000) *\n                                           hist_H_chk_20002);\n            int32_t histo_sizze_20032 = sext_i64_i32(trunc_H_20031);\n            \n            for (int32_t local_i_20033 = 0; local_i_20033 <\n                 init_per_thread_20004; local_i_20033++) {\n                int32_t j_20034 = local_i_20033 *\n                        sext_i64_i32(max_group_sizze_19981) + local_tid_20006;\n                \n                if (slt32(j_20034, histo_sizze_20032)) {\n                    int64_t x_18550;\n                    int64_t x_18551;\n                    \n                    // Read values from subhistogram 0.\n                    {\n                        x_18550 = ((__local\n                                    int64_t *) subhistogram_local_mem_20017)[sext_i32_i64(j_20034)];\n     ",
                   "               }\n                    // Accumulate based on values in other subhistograms.\n                    {\n                        for (int32_t subhisto_id_20035 = 0; subhisto_id_20035 <\n                             hist_M_19989 - 1; subhisto_id_20035++) {\n                            x_18551 = ((__local\n                                        int64_t *) subhistogram_local_mem_20017)[(sext_i32_i64(subhisto_id_20035) +\n                                                                                  1) *\n                                                                                 hist_H_chk_20002 +\n                                                                                 sext_i32_i64(j_20034)];\n                            \n                            int64_t res_18552;\n                            \n                            res_18552 = smax64(x_18550, x_18551);\n                            x_18550 = res_18552;\n                        }\n                    }\n                    // Put final bucket value in global memory.\n                    {\n                        ((__global\n                          int64_t *) res_r_subhistos_mem_19972)[gtid_18205 *\n                                                                (res_16723 *\n                                                                 num_subhistos_19971) +\n                                                                srem64(sext_i32_i64(virt_group_id_20012),\n                                                                       groups_per_segment_19993) *\n                                                                res_16723 +\n                                                                (sext_i32_i64(j_20034) +\n                                                                 sext_i32_i64(chk_i_20000) *\n                                                                 hist_H_chk_20002)] =\n                            x_18550;\n                    }\n                }\n            }\n        }\n",
                   "        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\n__kernel void mainzisegmap_17115(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args,\n                                 int64_t paths_16674, int64_t steps_16675,\n                                 float swap_term_16676, int64_t payments_16677,\n                                 float notional_16678, float a_16679,\n                                 float b_16680, float sigma_16681,\n                                 float r0_16682, float dt_16686,\n                                 float sims_per_year_16687,\n                                 int64_t upper_bound_16701, float res_16702,\n                                 int64_t res_16723, unsigned char cond_16737,\n                                 int64_t num_groups_17362, __global\n                                 unsigned char *mem_19274, __global\n                                 unsigned char *mem_19280, __global\n                                 unsigned char *mem_19294, __global\n                                 unsigned char *mem_19308, __global\n                                 unsigned char *mem_19322, __global\n                                 unsigned char *mem_19336, __global\n                                 unsigned char *mem_19338, __global\n                                 unsigned char *mem_19364, __global\n                                 unsigned char *mem_19378, __global\n                                 unsigned char *mem_19392, __global\n                                 unsigned char *mem_19407,\n                                 int64_t num_threads_19582)\n{\n    #define segmap_group_sizze_17361 (mainzisegmap_group_sizze_17117)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *glo",
                   "bal_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_19924;\n    int32_t local_tid_19925;\n    int64_t group_sizze_19928;\n    int32_t wave_sizze_19927;\n    int32_t group_tid_19926;\n    \n    global_tid_19924 = get_global_id(0);\n    local_tid_19925 = get_local_id(0);\n    group_sizze_19928 = get_local_size(0);\n    wave_sizze_19927 = LOCKSTEP_WIDTH;\n    group_tid_19926 = get_group_id(0);\n    \n    int32_t phys_tid_17115;\n    \n    phys_tid_17115 = global_tid_19924;\n    \n    int32_t phys_group_id_19929;\n    \n    phys_group_id_19929 = get_group_id(0);\n    for (int32_t i_19930 = 0; i_19930 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(paths_16674,\n                                          segmap_group_sizze_17361)) -\n                   phys_group_id_19929, sext_i64_i32(num_groups_17362));\n         i_19930++) {\n        int32_t virt_group_id_19931 = phys_group_id_19929 + i_19930 *\n                sext_i64_i32(num_groups_17362);\n        int64_t gtid_17114 = sext_i32_i64(virt_group_id_19931) *\n                segmap_group_sizze_17361 + sext_i32_i64(local_tid_19925);\n        \n        if (slt64(gtid_17114, paths_16674)) {\n            int32_t res_17366 = sext_i64_i32(gtid_17114);\n            int32_t x_17367 = lshr32(res_17366, 16);\n            int32_t x_17368 = res_17366 ^ x_17367;\n            int32_t x_17369 = mul32(73244475, x_17368);\n            int32_t x_17370 = lshr32(x_17369, 16);\n            int32_t x_17371 = x_17369 ^ x_17370;\n            int32_t x_17372 = mul32(73244475, x_17371);\n            int32_t x_17373 = lshr32(x_17372, 16);\n            int32_t x_17374 = x_17372 ^ x_17373;\n            int32_t unsign_arg_17375 = 777822902 ^ x_17374;\n            int32_t unsign_arg_17376 = mul32(48271, unsign_arg_17375);\n            int32_t unsign_arg_17377 = umod32(unsign_arg_17376, 2147483647);\n            \n            for (int64_t i_19193 = 0; i_19193 < steps_16675; i_19193++) {\n ",
                   "               int32_t res_17380 = sext_i64_i32(i_19193);\n                int32_t x_17381 = lshr32(res_17380, 16);\n                int32_t x_17382 = res_17380 ^ x_17381;\n                int32_t x_17383 = mul32(73244475, x_17382);\n                int32_t x_17384 = lshr32(x_17383, 16);\n                int32_t x_17385 = x_17383 ^ x_17384;\n                int32_t x_17386 = mul32(73244475, x_17385);\n                int32_t x_17387 = lshr32(x_17386, 16);\n                int32_t x_17388 = x_17386 ^ x_17387;\n                int32_t unsign_arg_17389 = unsign_arg_17377 ^ x_17388;\n                int32_t unsign_arg_17390 = mul32(48271, unsign_arg_17389);\n                int32_t unsign_arg_17391 = umod32(unsign_arg_17390, 2147483647);\n                int32_t unsign_arg_17392 = mul32(48271, unsign_arg_17391);\n                int32_t unsign_arg_17393 = umod32(unsign_arg_17392, 2147483647);\n                float res_17394 = uitofp_i32_f32(unsign_arg_17391);\n                float res_17395 = res_17394 / 2.1474836e9F;\n                float res_17396 = uitofp_i32_f32(unsign_arg_17393);\n                float res_17397 = res_17396 / 2.1474836e9F;\n                float res_17398;\n                \n                res_17398 = futrts_log32(res_17395);\n                \n                float res_17399 = -2.0F * res_17398;\n                float res_17400;\n                \n                res_17400 = futrts_sqrt32(res_17399);\n                \n                float res_17401 = 6.2831855F * res_17397;\n                float res_17402;\n                \n                res_17402 = futrts_cos32(res_17401);\n                \n                float res_17403 = res_17400 * res_17402;\n                \n                ((__global float *) mem_19280)[phys_tid_17115 + i_19193 *\n                                               (num_groups_17362 *\n                                                segmap_group_sizze_17361)] =\n                    res_17403;\n            }\n            for (int64_t i_19933 = 0; i_19933 ",
                   "< steps_16675; i_19933++) {\n                ((__global float *) mem_19294)[phys_tid_17115 + i_19933 *\n                                               (num_groups_17362 *\n                                                segmap_group_sizze_17361)] =\n                    r0_16682;\n            }\n            for (int64_t i_17406 = 0; i_17406 < upper_bound_16701; i_17406++) {\n                bool y_17408 = slt64(i_17406, steps_16675);\n                bool index_certs_17409;\n                \n                if (!y_17408) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 1) ==\n                            -1) {\n                            global_failure_args[0] = i_17406;\n                            global_failure_args[1] = steps_16675;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                float shortstep_arg_17410 = ((__global\n                                              float *) mem_19280)[phys_tid_17115 +\n                                                                  i_17406 *\n                                                                  (num_groups_17362 *\n                                                                   segmap_group_sizze_17361)];\n                float shortstep_arg_17411 = ((__global\n                                              float *) mem_19294)[phys_tid_17115 +\n                                                                  i_17406 *\n                                                                  (num_groups_17362 *\n                                                                   segmap_group_sizze_17361)];\n                float y_17412 = b_16680 - shortstep_arg_17411;\n                float x_17413 = a_16679 * y_17412;\n                float x_17414 = dt_16686 * x_17413;\n                float x_17415 = res_16702 * shortstep_arg_17410;",
                   "\n                float y_17416 = sigma_16681 * x_17415;\n                float delta_r_17417 = x_17414 + y_17416;\n                float res_17418 = shortstep_arg_17411 + delta_r_17417;\n                int64_t i_17419 = add64(1, i_17406);\n                bool x_17420 = sle64(0, i_17419);\n                bool y_17421 = slt64(i_17419, steps_16675);\n                bool bounds_check_17422 = x_17420 && y_17421;\n                bool index_certs_17423;\n                \n                if (!bounds_check_17422) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 2) ==\n                            -1) {\n                            global_failure_args[0] = i_17419;\n                            global_failure_args[1] = steps_16675;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                ((__global float *) mem_19294)[phys_tid_17115 + i_17419 *\n                                               (num_groups_17362 *\n                                                segmap_group_sizze_17361)] =\n                    res_17418;\n            }\n            for (int64_t i_19935 = 0; i_19935 < res_16723; i_19935++) {\n                ((__global int64_t *) mem_19308)[phys_tid_17115 + i_19935 *\n                                                 (num_groups_17362 *\n                                                  segmap_group_sizze_17361)] =\n                    0;\n            }\n            for (int64_t iter_19195 = 0; iter_19195 < steps_16675;\n                 iter_19195++) {\n                int64_t pixel_19197 = ((__global\n                                        int64_t *) mem_19274)[iter_19195];\n                bool less_than_zzero_19199 = slt64(pixel_19197, 0);\n                bool greater_than_sizze_19200 = sle64(res_16723, pixel_19197);\n                bool outside_bounds_dim_19201 = less_than_zzero_19199 ||\n       ",
                   "              greater_than_sizze_19200;\n                \n                if (!outside_bounds_dim_19201) {\n                    int64_t read_hist_19203 = ((__global\n                                                int64_t *) mem_19308)[phys_tid_17115 +\n                                                                      pixel_19197 *\n                                                                      (num_groups_17362 *\n                                                                       segmap_group_sizze_17361)];\n                    int64_t res_17429 = smax64(iter_19195, read_hist_19203);\n                    \n                    ((__global int64_t *) mem_19308)[phys_tid_17115 +\n                                                     pixel_19197 *\n                                                     (num_groups_17362 *\n                                                      segmap_group_sizze_17361)] =\n                        res_17429;\n                }\n            }\n            \n            int64_t discard_19216;\n            int64_t scanacc_19209 = 0;\n            \n            for (int64_t i_19212 = 0; i_19212 < res_16723; i_19212++) {\n                int64_t x_17441 = ((__global\n                                    int64_t *) mem_19308)[phys_tid_17115 +\n                                                          i_19212 *\n                                                          (num_groups_17362 *\n                                                           segmap_group_sizze_17361)];\n                bool res_17442 = slt64(0, x_17441);\n                int64_t res_17439;\n                \n                if (res_17442) {\n                    res_17439 = x_17441;\n                } else {\n                    int64_t res_17440 = add64(x_17441, scanacc_19209);\n                    \n                    res_17439 = res_17440;\n                }\n                ((__global int64_t *) mem_19322)[phys_tid_17115 + i_19212 *\n                                                 (num_groups_1",
                   "7362 *\n                                                  segmap_group_sizze_17361)] =\n                    res_17439;\n                \n                int64_t scanacc_tmp_19937 = res_17439;\n                \n                scanacc_19209 = scanacc_tmp_19937;\n            }\n            discard_19216 = scanacc_19209;\n            \n            int64_t inpacc_17445;\n            float inpacc_17447;\n            int64_t inpacc_17453;\n            float inpacc_17455;\n            \n            inpacc_17453 = 0;\n            inpacc_17455 = 0.0F;\n            for (int64_t i_19185 = 0; i_19185 < res_16723; i_19185++) {\n                int64_t x_17469 = ((__global\n                                    int64_t *) mem_19322)[phys_tid_17115 +\n                                                          i_19185 *\n                                                          (num_groups_17362 *\n                                                           segmap_group_sizze_17361)];\n                int64_t i_p_o_19189 = add64(-1, i_19185);\n                int64_t rot_i_19190 = smod64(i_p_o_19189, res_16723);\n                int64_t x_17470 = ((__global\n                                    int64_t *) mem_19322)[phys_tid_17115 +\n                                                          rot_i_19190 *\n                                                          (num_groups_17362 *\n                                                           segmap_group_sizze_17361)];\n                bool res_17472 = x_17469 == x_17470;\n                bool res_17473 = !res_17472;\n                int64_t res_17481;\n                \n                if (res_17473) {\n                    res_17481 = 1;\n                } else {\n                    int64_t res_17482 = add64(1, inpacc_17453);\n                    \n                    res_17481 = res_17482;\n                }\n                \n                int64_t res_17496;\n                \n                if (res_17473) {\n                    res_17496 = 1;\n                } else {\n    ",
                   "                int64_t res_17497 = add64(1, inpacc_17453);\n                    \n                    res_17496 = res_17497;\n                }\n                \n                int64_t res_17498 = sub64(res_17496, 1);\n                bool x_17499 = sle64(0, x_17469);\n                bool y_17500 = slt64(x_17469, steps_16675);\n                bool bounds_check_17501 = x_17499 && y_17500;\n                bool index_certs_17502;\n                \n                if (!bounds_check_17501) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 3) ==\n                            -1) {\n                            global_failure_args[0] = x_17469;\n                            global_failure_args[1] = steps_16675;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int64_t convop_x_17504 = add64(1, x_17469);\n                float binop_x_17505 = sitofp_i64_f32(convop_x_17504);\n                float index_primexp_17506 = binop_x_17505 / sims_per_year_16687;\n                float x_17507 = index_primexp_17506 / swap_term_16676;\n                float ceil_arg_17508 = x_17507 - 1.0F;\n                float res_17509;\n                \n                res_17509 = futrts_ceil32(ceil_arg_17508);\n                \n                int64_t res_17510 = fptosi_f32_i64(res_17509);\n                int64_t res_17511 = sub64(payments_16677, res_17510);\n                bool cond_17512 = res_17511 == 0;\n                float res_17513;\n                \n                if (cond_17512) {\n                    res_17513 = 0.0F;\n                } else {\n                    float lifted_0_get_arg_17503 = ((__global\n                                                     float *) mem_19294)[phys_tid_17115 +\n                                                                         x_17469 *\n                       ",
                   "                                                  (num_groups_17362 *\n                                                                          segmap_group_sizze_17361)];\n                    float res_17514;\n                    \n                    res_17514 = futrts_ceil32(x_17507);\n                    \n                    float start_17515 = swap_term_16676 * res_17514;\n                    float res_17516;\n                    \n                    res_17516 = futrts_ceil32(ceil_arg_17508);\n                    \n                    int64_t res_17517 = fptosi_f32_i64(res_17516);\n                    int64_t res_17518 = sub64(payments_16677, res_17517);\n                    int64_t sizze_17519 = sub64(res_17518, 1);\n                    bool cond_17520 = res_17498 == 0;\n                    float res_17521;\n                    \n                    if (cond_17520) {\n                        res_17521 = 1.0F;\n                    } else {\n                        res_17521 = 0.0F;\n                    }\n                    \n                    bool cond_17522 = slt64(0, res_17498);\n                    float res_17523;\n                    \n                    if (cond_17522) {\n                        float y_17524 = 5.056644e-2F * swap_term_16676;\n                        float res_17525 = res_17521 - y_17524;\n                        \n                        res_17523 = res_17525;\n                    } else {\n                        res_17523 = res_17521;\n                    }\n                    \n                    bool cond_17526 = res_17498 == sizze_17519;\n                    float res_17527;\n                    \n                    if (cond_17526) {\n                        float res_17528 = res_17523 - 1.0F;\n                        \n                        res_17527 = res_17528;\n                    } else {\n                        res_17527 = res_17523;\n                    }\n                    \n                    float res_17529 = notional_16678 * res_17527;\n              ",
                   "      float res_17530 = sitofp_i64_f32(res_17498);\n                    float y_17531 = swap_term_16676 * res_17530;\n                    float bondprice_arg_17532 = start_17515 + y_17531;\n                    float y_17533 = bondprice_arg_17532 - index_primexp_17506;\n                    float negate_arg_17534 = a_16679 * y_17533;\n                    float exp_arg_17535 = 0.0F - negate_arg_17534;\n                    float res_17536 = fpow32(2.7182817F, exp_arg_17535);\n                    float x_17537 = 1.0F - res_17536;\n                    float B_17538 = x_17537 / a_16679;\n                    float x_17539 = B_17538 - bondprice_arg_17532;\n                    float x_17540 = index_primexp_17506 + x_17539;\n                    float x_17541 = fpow32(a_16679, 2.0F);\n                    float x_17542 = b_16680 * x_17541;\n                    float x_17543 = fpow32(sigma_16681, 2.0F);\n                    float y_17544 = x_17543 / 2.0F;\n                    float y_17545 = x_17542 - y_17544;\n                    float x_17546 = x_17540 * y_17545;\n                    float A1_17547 = x_17546 / x_17541;\n                    float y_17548 = fpow32(B_17538, 2.0F);\n                    float x_17549 = x_17543 * y_17548;\n                    float y_17550 = 4.0F * a_16679;\n                    float A2_17551 = x_17549 / y_17550;\n                    float exp_arg_17552 = A1_17547 - A2_17551;\n                    float res_17553 = fpow32(2.7182817F, exp_arg_17552);\n                    float negate_arg_17554 = lifted_0_get_arg_17503 * B_17538;\n                    float exp_arg_17555 = 0.0F - negate_arg_17554;\n                    float res_17556 = fpow32(2.7182817F, exp_arg_17555);\n                    float res_17557 = res_17553 * res_17556;\n                    float res_17558 = res_17529 * res_17557;\n                    \n                    res_17513 = res_17558;\n                }\n                \n                float res_17568;\n                \n                if (res_17473) {\n           ",
                   "         res_17568 = res_17513;\n                } else {\n                    float res_17569 = inpacc_17455 + res_17513;\n                    \n                    res_17568 = res_17569;\n                }\n                \n                float res_17571;\n                \n                if (res_17473) {\n                    res_17571 = res_17513;\n                } else {\n                    float res_17572 = inpacc_17455 + res_17513;\n                    \n                    res_17571 = res_17572;\n                }\n                ((__global float *) mem_19336)[phys_tid_17115 + i_19185 *\n                                               (num_groups_17362 *\n                                                segmap_group_sizze_17361)] =\n                    res_17568;\n                ((__global bool *) mem_19338)[phys_tid_17115 + i_19185 *\n                                              (num_groups_17362 *\n                                               segmap_group_sizze_17361)] =\n                    res_17473;\n                \n                int64_t inpacc_tmp_19939 = res_17481;\n                float inpacc_tmp_19940 = res_17571;\n                \n                inpacc_17453 = inpacc_tmp_19939;\n                inpacc_17455 = inpacc_tmp_19940;\n            }\n            inpacc_17445 = inpacc_17453;\n            inpacc_17447 = inpacc_17455;\n            \n            int64_t discard_19222;\n            int64_t scanacc_19218 = 0;\n            \n            for (int64_t i_19220 = 0; i_19220 < res_16723; i_19220++) {\n                int64_t i_p_o_19257 = add64(1, i_19220);\n                int64_t rot_i_19258 = smod64(i_p_o_19257, res_16723);\n                bool x_17578 = ((__global bool *) mem_19338)[phys_tid_17115 +\n                                                             rot_i_19258 *\n                                                             (num_groups_17362 *\n                                                              segmap_group_sizze_17361)];\n                int64_t res_175",
                   "79 = btoi_bool_i64(x_17578);\n                int64_t res_17577 = add64(res_17579, scanacc_19218);\n                \n                ((__global int64_t *) mem_19364)[phys_tid_17115 + i_19220 *\n                                                 (num_groups_17362 *\n                                                  segmap_group_sizze_17361)] =\n                    res_17577;\n                \n                int64_t scanacc_tmp_19943 = res_17577;\n                \n                scanacc_19218 = scanacc_tmp_19943;\n            }\n            discard_19222 = scanacc_19218;\n            \n            int64_t num_segments_17580;\n            \n            if (cond_16737) {\n                int64_t i_17581 = sub64(res_16723, 1);\n                bool x_17582 = sle64(0, i_17581);\n                bool y_17583 = slt64(i_17581, res_16723);\n                bool bounds_check_17584 = x_17582 && y_17583;\n                bool index_certs_17585;\n                \n                if (!bounds_check_17584) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 4) ==\n                            -1) {\n                            global_failure_args[0] = i_17581;\n                            global_failure_args[1] = res_16723;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int64_t res_17586 = ((__global\n                                      int64_t *) mem_19364)[phys_tid_17115 +\n                                                            i_17581 *\n                                                            (num_groups_17362 *\n                                                             segmap_group_sizze_17361)];\n                \n                num_segments_17580 = res_17586;\n            } else {\n                num_segments_17580 = 0;\n            }\n            for (int64_t i_19945 = 0; i_19945 < nu",
                   "m_segments_17580; i_19945++) {\n                ((__global float *) mem_19378)[phys_tid_17115 + i_19945 *\n                                               num_threads_19582] = 0.0F;\n            }\n            for (int64_t write_iter_19223 = 0; write_iter_19223 < res_16723;\n                 write_iter_19223++) {\n                int64_t i_p_o_19260 = add64(1, write_iter_19223);\n                int64_t rot_i_19261 = smod64(i_p_o_19260, res_16723);\n                bool write_iv_19226 = ((__global\n                                        bool *) mem_19338)[phys_tid_17115 +\n                                                           rot_i_19261 *\n                                                           (num_groups_17362 *\n                                                            segmap_group_sizze_17361)];\n                int64_t res_17595;\n                \n                if (write_iv_19226) {\n                    int64_t write_iv_19225 = ((__global\n                                               int64_t *) mem_19364)[phys_tid_17115 +\n                                                                     write_iter_19223 *\n                                                                     (num_groups_17362 *\n                                                                      segmap_group_sizze_17361)];\n                    int64_t res_17596 = sub64(write_iv_19225, 1);\n                    \n                    res_17595 = res_17596;\n                } else {\n                    res_17595 = -1;\n                }\n                \n                bool less_than_zzero_19228 = slt64(res_17595, 0);\n                bool greater_than_sizze_19229 = sle64(num_segments_17580,\n                                                      res_17595);\n                bool outside_bounds_dim_19230 = less_than_zzero_19228 ||\n                     greater_than_sizze_19229;\n                \n                if (!outside_bounds_dim_19230) {\n                    for (int64_t i_19947 = 0; i_19947 < 1; i_1994",
                   "7++) {\n                        ((__global float *) mem_19378)[phys_tid_17115 +\n                                                       (res_17595 + i_19947) *\n                                                       num_threads_19582] =\n                            ((__global float *) mem_19336)[phys_tid_17115 +\n                                                           num_groups_17362 *\n                                                           segmap_group_sizze_17361 *\n                                                           write_iter_19223 +\n                                                           i_19947 *\n                                                           (num_groups_17362 *\n                                                            segmap_group_sizze_17361)];\n                    }\n                }\n            }\n            \n            bool dim_match_17597 = steps_16675 == num_segments_17580;\n            bool empty_or_match_cert_17598;\n            \n            if (!dim_match_17597) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 5) ==\n                        -1) {\n                        global_failure_args[0] = num_segments_17580;\n                        global_failure_args[1] = steps_16675;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_0;\n                }\n            }\n            for (int64_t i_19236 = 0; i_19236 < steps_16675; i_19236++) {\n                float x_17601 = ((__global float *) mem_19378)[phys_tid_17115 +\n                                                               i_19236 *\n                                                               num_threads_19582];\n                float res_17602 = fmax32(0.0F, x_17601);\n                \n                ((__global float *) mem_19392)[phys_tid_17115 + i_19236 *\n                                               (num_groups_17362 *\n                                              ",
                   "  segmap_group_sizze_17361)] =\n                    res_17602;\n            }\n            for (int64_t i_19949 = 0; i_19949 < steps_16675; i_19949++) {\n                ((__global float *) mem_19407)[i_19949 * paths_16674 +\n                                               gtid_17114] = ((__global\n                                                               float *) mem_19392)[phys_tid_17115 +\n                                                                                   i_19949 *\n                                                                                   (num_groups_17362 *\n                                                                                    segmap_group_sizze_17361)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_17361\n}\n__kernel void mainzisegmap_17864(__global int *global_failure,\n                                 int64_t paths_16674, int64_t steps_16675,\n                                 __global unsigned char *mem_19539, __global\n                                 unsigned char *mem_19543)\n{\n    #define segmap_group_sizze_18815 (mainzisegmap_group_sizze_17867)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20449;\n    int32_t local_tid_20450;\n    int64_t group_sizze_20453;\n    int32_t wave_sizze_20452;\n    int32_t group_tid_20451;\n    \n    global_tid_20449 = get_global_id(0);\n    local_tid_20450 = get_local_id(0);\n    group_sizze_20453 = get_local_size(0);\n    wave_sizze_20452 = LOCKSTEP_WIDTH;\n    group_tid_20451 = get_group_id(0);\n    \n    int32_t phys_tid_17864;\n    \n    phys_tid_17864 = global_tid_20449;\n    \n    int64_t gtid_17862;\n    \n    gtid_17862 = squot64(sext_i32_i64(group_tid_20451) *\n                         segmap_group_sizze_18815 +\n                         sext_i32_i64(local_tid_20450), steps_16675);\n",
                   "    \n    int64_t gtid_17863;\n    \n    gtid_17863 = sext_i32_i64(group_tid_20451) * segmap_group_sizze_18815 +\n        sext_i32_i64(local_tid_20450) - squot64(sext_i32_i64(group_tid_20451) *\n                                                segmap_group_sizze_18815 +\n                                                sext_i32_i64(local_tid_20450),\n                                                steps_16675) * steps_16675;\n    if (slt64(gtid_17862, paths_16674) && slt64(gtid_17863, steps_16675)) {\n        float x_18818 = ((__global float *) mem_19539)[gtid_17863 *\n                                                       paths_16674 +\n                                                       gtid_17862];\n        float res_18819 = fmax32(0.0F, x_18818);\n        \n        ((__global float *) mem_19543)[gtid_17862 * steps_16675 + gtid_17863] =\n            res_18819;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_18815\n}\n__kernel void mainzisegmap_17894(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args,\n                                 int64_t paths_16674, int64_t steps_16675,\n                                 int64_t res_16723, unsigned char cond_16737,\n                                 int64_t num_groups_18779, __global\n                                 unsigned char *mem_19516, __global\n                                 unsigned char *mem_19518, __global\n                                 unsigned char *mem_19521, __global\n                                 unsigned char *mem_19524, __global\n                                 unsigned char *mem_19539,\n                                 int64_t num_threads_19741)\n{\n    #define segmap_group_sizze_18778 (mainzisegmap_group_sizze_17896)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int fai",
                   "led = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_20437;\n    int32_t local_tid_20438;\n    int64_t group_sizze_20441;\n    int32_t wave_sizze_20440;\n    int32_t group_tid_20439;\n    \n    global_tid_20437 = get_global_id(0);\n    local_tid_20438 = get_local_id(0);\n    group_sizze_20441 = get_local_size(0);\n    wave_sizze_20440 = LOCKSTEP_WIDTH;\n    group_tid_20439 = get_group_id(0);\n    \n    int32_t phys_tid_17894;\n    \n    phys_tid_17894 = global_tid_20437;\n    \n    int32_t phys_group_id_20442;\n    \n    phys_group_id_20442 = get_group_id(0);\n    for (int32_t i_20443 = 0; i_20443 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(paths_16674,\n                                          segmap_group_sizze_18778)) -\n                   phys_group_id_20442, sext_i64_i32(num_groups_18779));\n         i_20443++) {\n        int32_t virt_group_id_20444 = phys_group_id_20442 + i_20443 *\n                sext_i64_i32(num_groups_18779);\n        int64_t gtid_17893 = sext_i32_i64(virt_group_id_20444) *\n                segmap_group_sizze_18778 + sext_i32_i64(local_tid_20438);\n        \n        if (slt64(gtid_17893, paths_16674)) {\n            int64_t num_segments_18785;\n            \n            if (cond_16737) {\n                int64_t i_18786 = sub64(res_16723, 1);\n                bool x_18787 = sle64(0, i_18786);\n                bool y_18788 = slt64(i_18786, res_16723);\n                bool bounds_check_18789 = x_18787 && y_18788;\n                bool index_certs_18790;\n                \n                if (!bounds_check_18789) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 10) ==\n                            -1) {\n                            global_failure_args[0] = i_18786;\n                            global_failure_args[1] = res_16723;\n                            ;\n                        }\n                        local_fai",
                   "lure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int64_t res_18791 = ((__global int64_t *) mem_19521)[i_18786 *\n                                                                     paths_16674 +\n                                                                     gtid_17893];\n                \n                num_segments_18785 = res_18791;\n            } else {\n                num_segments_18785 = 0;\n            }\n            for (int64_t i_20445 = 0; i_20445 < num_segments_18785; i_20445++) {\n                ((__global float *) mem_19524)[phys_tid_17894 + i_20445 *\n                                               num_threads_19741] = 0.0F;\n            }\n            for (int64_t write_iter_19238 = 0; write_iter_19238 < res_16723;\n                 write_iter_19238++) {\n                bool write_iv_19241 = ((__global\n                                        bool *) mem_19518)[write_iter_19238 *\n                                                           paths_16674 +\n                                                           gtid_17893];\n                int64_t res_18801;\n                \n                if (write_iv_19241) {\n                    int64_t write_iv_19240 = ((__global\n                                               int64_t *) mem_19521)[write_iter_19238 *\n                                                                     paths_16674 +\n                                                                     gtid_17893];\n                    int64_t res_18802 = sub64(write_iv_19240, 1);\n                    \n                    res_18801 = res_18802;\n                } else {\n                    res_18801 = -1;\n                }\n                \n                bool less_than_zzero_19243 = slt64(res_18801, 0);\n                bool greater_than_sizze_19244 = sle64(num_segments_18785,\n                                                      res_18801);\n                bool outside_bounds_dim_19245 ",
                   "= less_than_zzero_19243 ||\n                     greater_than_sizze_19244;\n                \n                if (!outside_bounds_dim_19245) {\n                    for (int64_t i_20447 = 0; i_20447 < 1; i_20447++) {\n                        ((__global float *) mem_19524)[phys_tid_17894 +\n                                                       (res_18801 + i_20447) *\n                                                       num_threads_19741] =\n                            ((__global float *) mem_19516)[paths_16674 *\n                                                           write_iter_19238 +\n                                                           gtid_17893 +\n                                                           i_20447 *\n                                                           paths_16674];\n                    }\n                }\n            }\n            \n            bool dim_match_18803 = steps_16675 == num_segments_18785;\n            bool empty_or_match_cert_18804;\n            \n            if (!dim_match_18803) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 11) ==\n                        -1) {\n                        global_failure_args[0] = num_segments_18785;\n                        global_failure_args[1] = steps_16675;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_0;\n                }\n            }\n            for (int64_t i_20448 = 0; i_20448 < steps_16675; i_20448++) {\n                ((__global float *) mem_19539)[i_20448 * paths_16674 +\n                                               gtid_17893] = ((__global\n                                                               float *) mem_19524)[phys_tid_17894 +\n                                                                                   i_20448 *\n                                                                                   num_threads_19741];\n            }\n        }\n        barrier(C",
                   "LK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_18778\n}\n__kernel void mainzisegmap_18253(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args,\n                                 int64_t paths_16674, int64_t steps_16675,\n                                 float a_16679, float b_16680,\n                                 float sigma_16681, float r0_16682,\n                                 float dt_16686, int64_t upper_bound_16701,\n                                 float res_16702, int64_t num_groups_18505,\n                                 __global unsigned char *mem_19467, __global\n                                 unsigned char *mem_19470, __global\n                                 unsigned char *mem_19485)\n{\n    #define segmap_group_sizze_18504 (mainzisegmap_group_sizze_18255)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_19960;\n    int32_t local_tid_19961;\n    int64_t group_sizze_19964;\n    int32_t wave_sizze_19963;\n    int32_t group_tid_19962;\n    \n    global_tid_19960 = get_global_id(0);\n    local_tid_19961 = get_local_id(0);\n    group_sizze_19964 = get_local_size(0);\n    wave_sizze_19963 = LOCKSTEP_WIDTH;\n    group_tid_19962 = get_group_id(0);\n    \n    int32_t phys_tid_18253;\n    \n    phys_tid_18253 = global_tid_19960;\n    \n    int32_t phys_group_id_19965;\n    \n    phys_group_id_19965 = get_group_id(0);\n    for (int32_t i_19966 = 0; i_19966 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(paths_16674,\n                                          segmap_group_sizze_18504)) -\n                   phys_group_id_19",
                   "965, sext_i64_i32(num_groups_18505));\n         i_19966++) {\n        int32_t virt_group_id_19967 = phys_group_id_19965 + i_19966 *\n                sext_i64_i32(num_groups_18505);\n        int64_t gtid_18252 = sext_i32_i64(virt_group_id_19967) *\n                segmap_group_sizze_18504 + sext_i32_i64(local_tid_19961);\n        \n        if (slt64(gtid_18252, paths_16674)) {\n            for (int64_t i_19968 = 0; i_19968 < steps_16675; i_19968++) {\n                ((__global float *) mem_19470)[phys_tid_18253 + i_19968 *\n                                               (num_groups_18505 *\n                                                segmap_group_sizze_18504)] =\n                    r0_16682;\n            }\n            for (int64_t i_18511 = 0; i_18511 < upper_bound_16701; i_18511++) {\n                bool y_18513 = slt64(i_18511, steps_16675);\n                bool index_certs_18514;\n                \n                if (!y_18513) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 6) ==\n                            -1) {\n                            global_failure_args[0] = i_18511;\n                            global_failure_args[1] = steps_16675;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                float shortstep_arg_18515 = ((__global\n                                              float *) mem_19467)[i_18511 *\n                                                                  paths_16674 +\n                                                                  gtid_18252];\n                float shortstep_arg_18516 = ((__global\n                                              float *) mem_19470)[phys_tid_18253 +\n                                                                  i_18511 *\n                                                                  (num_groups_18505 *\n            ",
                   "                                                       segmap_group_sizze_18504)];\n                float y_18517 = b_16680 - shortstep_arg_18516;\n                float x_18518 = a_16679 * y_18517;\n                float x_18519 = dt_16686 * x_18518;\n                float x_18520 = res_16702 * shortstep_arg_18515;\n                float y_18521 = sigma_16681 * x_18520;\n                float delta_r_18522 = x_18519 + y_18521;\n                float res_18523 = shortstep_arg_18516 + delta_r_18522;\n                int64_t i_18524 = add64(1, i_18511);\n                bool x_18525 = sle64(0, i_18524);\n                bool y_18526 = slt64(i_18524, steps_16675);\n                bool bounds_check_18527 = x_18525 && y_18526;\n                bool index_certs_18528;\n                \n                if (!bounds_check_18527) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 7) ==\n                            -1) {\n                            global_failure_args[0] = i_18524;\n                            global_failure_args[1] = steps_16675;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                ((__global float *) mem_19470)[phys_tid_18253 + i_18524 *\n                                               (num_groups_18505 *\n                                                segmap_group_sizze_18504)] =\n                    res_18523;\n            }\n            for (int64_t i_19970 = 0; i_19970 < steps_16675; i_19970++) {\n                ((__global float *) mem_19485)[i_19970 * paths_16674 +\n                                               gtid_18252] = ((__global\n                                                               float *) mem_19470)[phys_tid_18253 +\n                                                                                   i_19970 *\n                                                             ",
                   "                      (num_groups_18505 *\n                                                                                    segmap_group_sizze_18504)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_18504\n}\n__kernel void mainzisegmap_18351(__global int *global_failure,\n                                 int64_t paths_16674, int64_t steps_16675,\n                                 __global unsigned char *mem_19460, __global\n                                 unsigned char *mem_19464)\n{\n    #define segmap_group_sizze_18459 (mainzisegmap_group_sizze_18354)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_19955;\n    int32_t local_tid_19956;\n    int64_t group_sizze_19959;\n    int32_t wave_sizze_19958;\n    int32_t group_tid_19957;\n    \n    global_tid_19955 = get_global_id(0);\n    local_tid_19956 = get_local_id(0);\n    group_sizze_19959 = get_local_size(0);\n    wave_sizze_19958 = LOCKSTEP_WIDTH;\n    group_tid_19957 = get_group_id(0);\n    \n    int32_t phys_tid_18351;\n    \n    phys_tid_18351 = global_tid_19955;\n    \n    int64_t gtid_18349;\n    \n    gtid_18349 = squot64(sext_i32_i64(group_tid_19957) *\n                         segmap_group_sizze_18459 +\n                         sext_i32_i64(local_tid_19956), steps_16675);\n    \n    int64_t gtid_18350;\n    \n    gtid_18350 = sext_i32_i64(group_tid_19957) * segmap_group_sizze_18459 +\n        sext_i32_i64(local_tid_19956) - squot64(sext_i32_i64(group_tid_19957) *\n                                                segmap_group_sizze_18459 +\n                                                sext_i32_i64(local_tid_19956),\n                                                steps_16675) * steps_16675;\n    if (slt64(gtid_18349, paths_16674) && slt64(gtid_18350, steps_16675)) {\n        int32_t unsign_arg_18462 = ((__global int32",
                   "_t *) mem_19460)[gtid_18349];\n        int32_t res_18464 = sext_i64_i32(gtid_18350);\n        int32_t x_18465 = lshr32(res_18464, 16);\n        int32_t x_18466 = res_18464 ^ x_18465;\n        int32_t x_18467 = mul32(73244475, x_18466);\n        int32_t x_18468 = lshr32(x_18467, 16);\n        int32_t x_18469 = x_18467 ^ x_18468;\n        int32_t x_18470 = mul32(73244475, x_18469);\n        int32_t x_18471 = lshr32(x_18470, 16);\n        int32_t x_18472 = x_18470 ^ x_18471;\n        int32_t unsign_arg_18473 = unsign_arg_18462 ^ x_18472;\n        int32_t unsign_arg_18474 = mul32(48271, unsign_arg_18473);\n        int32_t unsign_arg_18475 = umod32(unsign_arg_18474, 2147483647);\n        int32_t unsign_arg_18476 = mul32(48271, unsign_arg_18475);\n        int32_t unsign_arg_18477 = umod32(unsign_arg_18476, 2147483647);\n        float res_18478 = uitofp_i32_f32(unsign_arg_18475);\n        float res_18479 = res_18478 / 2.1474836e9F;\n        float res_18480 = uitofp_i32_f32(unsign_arg_18477);\n        float res_18481 = res_18480 / 2.1474836e9F;\n        float res_18482;\n        \n        res_18482 = futrts_log32(res_18479);\n        \n        float res_18483 = -2.0F * res_18482;\n        float res_18484;\n        \n        res_18484 = futrts_sqrt32(res_18483);\n        \n        float res_18485 = 6.2831855F * res_18481;\n        float res_18486;\n        \n        res_18486 = futrts_cos32(res_18485);\n        \n        float res_18487 = res_18484 * res_18486;\n        \n        ((__global float *) mem_19464)[gtid_18349 * steps_16675 + gtid_18350] =\n            res_18487;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_18459\n}\n__kernel void mainzisegmap_18415(__global int *global_failure,\n                                 int64_t paths_16674, __global\n                                 unsigned char *mem_19460)\n{\n    #define segmap_group_sizze_18434 (mainzisegmap_group_sizze_18417)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global",
                   "_failure >= 0)\n        return;\n    \n    int32_t global_tid_19950;\n    int32_t local_tid_19951;\n    int64_t group_sizze_19954;\n    int32_t wave_sizze_19953;\n    int32_t group_tid_19952;\n    \n    global_tid_19950 = get_global_id(0);\n    local_tid_19951 = get_local_id(0);\n    group_sizze_19954 = get_local_size(0);\n    wave_sizze_19953 = LOCKSTEP_WIDTH;\n    group_tid_19952 = get_group_id(0);\n    \n    int32_t phys_tid_18415;\n    \n    phys_tid_18415 = global_tid_19950;\n    \n    int64_t gtid_18414;\n    \n    gtid_18414 = sext_i32_i64(group_tid_19952) * segmap_group_sizze_18434 +\n        sext_i32_i64(local_tid_19951);\n    if (slt64(gtid_18414, paths_16674)) {\n        int32_t res_18438 = sext_i64_i32(gtid_18414);\n        int32_t x_18439 = lshr32(res_18438, 16);\n        int32_t x_18440 = res_18438 ^ x_18439;\n        int32_t x_18441 = mul32(73244475, x_18440);\n        int32_t x_18442 = lshr32(x_18441, 16);\n        int32_t x_18443 = x_18441 ^ x_18442;\n        int32_t x_18444 = mul32(73244475, x_18443);\n        int32_t x_18445 = lshr32(x_18444, 16);\n        int32_t x_18446 = x_18444 ^ x_18445;\n        int32_t unsign_arg_18447 = 777822902 ^ x_18446;\n        int32_t unsign_arg_18448 = mul32(48271, unsign_arg_18447);\n        int32_t unsign_arg_18449 = umod32(unsign_arg_18448, 2147483647);\n        \n        ((__global int32_t *) mem_19460)[gtid_18414] = unsign_arg_18449;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_18434\n}\n__kernel void mainzisegmap_18878(__global int *global_failure,\n                                 int64_t paths_16674, int64_t steps_16675,\n                                 float a_16679, float res_16997, float x_16998,\n                                 float x_17000, float y_17002, float y_17003,\n                                 __global unsigned char *mem_19269, __global\n                                 unsigned char *res_mem_19549, __global\n                                 unsigned char *mem_19557, __global\n                                 unsigne",
                   "d char *mem_19559)\n{\n    #define segmap_group_sizze_19037 (mainzisegmap_group_sizze_18880)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20489;\n    int32_t local_tid_20490;\n    int64_t group_sizze_20493;\n    int32_t wave_sizze_20492;\n    int32_t group_tid_20491;\n    \n    global_tid_20489 = get_global_id(0);\n    local_tid_20490 = get_local_id(0);\n    group_sizze_20493 = get_local_size(0);\n    wave_sizze_20492 = LOCKSTEP_WIDTH;\n    group_tid_20491 = get_group_id(0);\n    \n    int32_t phys_tid_18878;\n    \n    phys_tid_18878 = global_tid_20489;\n    \n    int64_t gtid_18877;\n    \n    gtid_18877 = sext_i32_i64(group_tid_20491) * segmap_group_sizze_19037 +\n        sext_i32_i64(local_tid_20490);\n    if (slt64(gtid_18877, steps_16675)) {\n        float x_19042 = ((__global float *) mem_19269)[gtid_18877];\n        float res_19043;\n        float redout_19251 = 0.0F;\n        \n        for (int64_t i_19252 = 0; i_19252 < paths_16674; i_19252++) {\n            float x_19047 = ((__global float *) res_mem_19549)[i_19252 *\n                                                               steps_16675 +\n                                                               gtid_18877];\n            float res_19046 = x_19047 + redout_19251;\n            float redout_tmp_20494 = res_19046;\n            \n            redout_19251 = redout_tmp_20494;\n        }\n        res_19043 = redout_19251;\n        \n        float res_19048 = res_19043 / res_16997;\n        float negate_arg_19049 = a_16679 * x_19042;\n        float exp_arg_19050 = 0.0F - negate_arg_19049;\n        float res_19051 = fpow32(2.7182817F, exp_arg_19050);\n        float x_19052 = 1.0F - res_19051;\n        float B_19053 = x_19052 / a_16679;\n        float x_19054 = B_19053 - x_19042;\n        float x_19055 = y_17002 * x_19054;\n        float A1_19056 = x_19055 / x_16998;\n        float y_19057 = fpow32(B_19053, 2.0F);\n        fl",
                   "oat x_19058 = x_17000 * y_19057;\n        float A2_19059 = x_19058 / y_17003;\n        float exp_arg_19060 = A1_19056 - A2_19059;\n        float res_19061 = fpow32(2.7182817F, exp_arg_19060);\n        float negate_arg_19062 = 5.0e-2F * B_19053;\n        float exp_arg_19063 = 0.0F - negate_arg_19062;\n        float res_19064 = fpow32(2.7182817F, exp_arg_19063);\n        float res_19065 = res_19061 * res_19064;\n        float res_19066 = res_19048 * res_19065;\n        \n        ((__global float *) mem_19557)[gtid_18877] = res_19066;\n        ((__global float *) mem_19559)[gtid_18877] = res_19066;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_19037\n}\n__kernel void mainzisegmap_18942(__global int *global_failure,\n                                 int64_t steps_16675, float a_16679,\n                                 float res_16997, float x_16998, float x_17000,\n                                 float y_17002, float y_17003, __global\n                                 unsigned char *mem_19269, __global\n                                 unsigned char *mem_19565, __global\n                                 unsigned char *mem_19568, __global\n                                 unsigned char *mem_19570)\n{\n    #define segmap_group_sizze_19079 (mainzisegmap_group_sizze_18944)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20555;\n    int32_t local_tid_20556;\n    int64_t group_sizze_20559;\n    int32_t wave_sizze_20558;\n    int32_t group_tid_20557;\n    \n    global_tid_20555 = get_global_id(0);\n    local_tid_20556 = get_local_id(0);\n    group_sizze_20559 = get_local_size(0);\n    wave_sizze_20558 = LOCKSTEP_WIDTH;\n    group_tid_20557 = get_group_id(0);\n    \n    int32_t phys_tid_18942;\n    \n    phys_tid_18942 = global_tid_20555;\n    \n    int64_t gtid_18941;\n    \n    gtid_18941 = sext_i32_i64(group_tid_20557) * segmap_group_sizze_19079 +\n        sext_i32_i64(loc",
                   "al_tid_20556);\n    if (slt64(gtid_18941, steps_16675)) {\n        float x_19083 = ((__global float *) mem_19269)[gtid_18941];\n        float res_19084 = ((__global float *) mem_19565)[gtid_18941];\n        float res_19085 = res_19084 / res_16997;\n        float negate_arg_19086 = a_16679 * x_19083;\n        float exp_arg_19087 = 0.0F - negate_arg_19086;\n        float res_19088 = fpow32(2.7182817F, exp_arg_19087);\n        float x_19089 = 1.0F - res_19088;\n        float B_19090 = x_19089 / a_16679;\n        float x_19091 = B_19090 - x_19083;\n        float x_19092 = y_17002 * x_19091;\n        float A1_19093 = x_19092 / x_16998;\n        float y_19094 = fpow32(B_19090, 2.0F);\n        float x_19095 = x_17000 * y_19094;\n        float A2_19096 = x_19095 / y_17003;\n        float exp_arg_19097 = A1_19093 - A2_19096;\n        float res_19098 = fpow32(2.7182817F, exp_arg_19097);\n        float negate_arg_19099 = 5.0e-2F * B_19090;\n        float exp_arg_19100 = 0.0F - negate_arg_19099;\n        float res_19101 = fpow32(2.7182817F, exp_arg_19100);\n        float res_19102 = res_19098 * res_19101;\n        float res_19103 = res_19085 * res_19102;\n        \n        ((__global float *) mem_19568)[gtid_18941] = res_19103;\n        ((__global float *) mem_19570)[gtid_18941] = res_19103;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_19079\n}\n__kernel void mainzisegred_large_18977(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *sync_arr_mem_20532_backing_aligned_0,\n                                       __local volatile\n                                       int64_t *red_arr_mem_20530_backing_aligned_1,\n                                       int64_t paths_16674,\n                                       int64_t num_groups_19070, __global\n                                       unsigned char *mem_19562, __global\n                                       unsigned char *mem_19565,\n                           ",
                   "            int64_t groups_per_segment_20516,\n                                       int64_t elements_per_thread_20517,\n                                       int64_t virt_num_groups_20518,\n                                       int64_t threads_per_segment_20520,\n                                       __global\n                                       unsigned char *group_res_arr_mem_20521,\n                                       __global\n                                       unsigned char *mainzicounter_mem_20523)\n{\n    #define segred_group_sizze_19069 (mainzisegred_group_sizze_18971)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict sync_arr_mem_20532_backing_1 =\n                          (__local volatile\n                           char *) sync_arr_mem_20532_backing_aligned_0;\n    __local volatile char *restrict red_arr_mem_20530_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_20530_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20525;\n    int32_t local_tid_20526;\n    int64_t group_sizze_20529;\n    int32_t wave_sizze_20528;\n    int32_t group_tid_20527;\n    \n    global_tid_20525 = get_global_id(0);\n    local_tid_20526 = get_local_id(0);\n    group_sizze_20529 = get_local_size(0);\n    wave_sizze_20528 = LOCKSTEP_WIDTH;\n    group_tid_20527 = get_group_id(0);\n    \n    int32_t phys_tid_18977;\n    \n    phys_tid_18977 = global_tid_20525;\n    \n    __local char *red_arr_mem_20530;\n    \n    red_arr_mem_20530 = (__local char *) red_arr_mem_20530_backing_0;\n    \n    __local char *sync_arr_mem_20532;\n    \n    sync_arr_mem_20532 = (__local char *) sync_arr_mem_20532_backing_1;\n    \n    int32_t phys_group_id_20534;\n    \n    phys_group_id_20534 = get_group_id(0);\n    for (int32_t i_20535 = 0; i_20535 <\n         sdiv_up32(sext_i64_i32(virt_num_groups_20518) - phys_group_id_20534,\n                   s",
                   "ext_i64_i32(num_groups_19070)); i_20535++) {\n        int32_t virt_group_id_20536 = phys_group_id_20534 + i_20535 *\n                sext_i64_i32(num_groups_19070);\n        int32_t flat_segment_id_20537 = squot32(virt_group_id_20536,\n                                                sext_i64_i32(groups_per_segment_20516));\n        int64_t global_tid_20538 = srem64(sext_i32_i64(virt_group_id_20536) *\n                                          segred_group_sizze_19069 +\n                                          sext_i32_i64(local_tid_20526),\n                                          segred_group_sizze_19069 *\n                                          groups_per_segment_20516);\n        int64_t gtid_18968 = sext_i32_i64(flat_segment_id_20537);\n        int64_t gtid_18976;\n        float x_acc_20539;\n        int64_t chunk_sizze_20540;\n        \n        chunk_sizze_20540 = smin64(elements_per_thread_20517,\n                                   sdiv_up64(paths_16674 -\n                                             sext_i32_i64(sext_i64_i32(global_tid_20538)),\n                                             threads_per_segment_20520));\n        \n        float x_19073;\n        float x_19074;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_20539 = 0.0F;\n        }\n        for (int64_t i_20544 = 0; i_20544 < chunk_sizze_20540; i_20544++) {\n            gtid_18976 = sext_i32_i64(sext_i64_i32(global_tid_20538)) +\n                threads_per_segment_20520 * i_20544;\n            // apply map function\n            {\n                float x_19077 = ((__global float *) mem_19562)[gtid_18968 *\n                                                               paths_16674 +\n                                                               gtid_18976];\n                \n                // save map-out results\n                { }\n                // load accumulator\n                {\n                    x_19073 = x_acc_20539;\n                }\n                // load new values\n  ",
                   "              {\n                    x_19074 = x_19077;\n                }\n                // apply reduction operator\n                {\n                    float res_19075 = x_19073 + x_19074;\n                    \n                    // store in accumulator\n                    {\n                        x_acc_20539 = res_19075;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_19073 = x_acc_20539;\n            ((__local\n              float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526)] =\n                x_19073;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_20545;\n        int32_t skip_waves_20546;\n        \n        skip_waves_20546 = 1;\n        \n        float x_20541;\n        float x_20542;\n        \n        offset_20545 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_20526,\n                      sext_i64_i32(segred_group_sizze_19069))) {\n                x_20541 = ((__local\n                            float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526 +\n                                                        offset_20545)];\n            }\n        }\n        offset_20545 = 1;\n        while (slt32(offset_20545, wave_sizze_20528)) {\n            if (slt32(local_tid_20526 + offset_20545,\n                      sext_i64_i32(segred_group_sizze_19069)) &&\n                ((local_tid_20526 - squot32(local_tid_20526, wave_sizze_20528) *\n                  wave_sizze_20528) & (2 * offset_20545 - 1)) == 0) {\n                // read array element\n                {\n                    x_20542 = ((volatile __local\n                                float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526 +\n                                                            offset_20545)];\n                }\n                // apply reduction operation\n                {\n                    float ",
                   "res_20543 = x_20541 + x_20542;\n                    \n                    x_20541 = res_20543;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526)] =\n                        x_20541;\n                }\n            }\n            offset_20545 *= 2;\n        }\n        while (slt32(skip_waves_20546,\n                     squot32(sext_i64_i32(segred_group_sizze_19069) +\n                             wave_sizze_20528 - 1, wave_sizze_20528))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_20545 = skip_waves_20546 * wave_sizze_20528;\n            if (slt32(local_tid_20526 + offset_20545,\n                      sext_i64_i32(segred_group_sizze_19069)) &&\n                ((local_tid_20526 - squot32(local_tid_20526, wave_sizze_20528) *\n                  wave_sizze_20528) == 0 && (squot32(local_tid_20526,\n                                                     wave_sizze_20528) & (2 *\n                                                                          skip_waves_20546 -\n                                                                          1)) ==\n                 0)) {\n                // read array element\n                {\n                    x_20542 = ((__local\n                                float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526 +\n                                                            offset_20545)];\n                }\n                // apply reduction operation\n                {\n                    float res_20543 = x_20541 + x_20542;\n                    \n                    x_20541 = res_20543;\n                }\n                // write result of operation\n                {\n                    ((__local\n                      float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526)] =\n                        x_20541;\n                }\n            }\n            skip_waves_20546 *= 2;\n        ",
                   "}\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (sext_i32_i64(local_tid_20526) == 0) {\n                x_acc_20539 = x_20541;\n            }\n        }\n        if (groups_per_segment_20516 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_20526 == 0) {\n                    ((__global float *) mem_19565)[gtid_18968] = x_acc_20539;\n                }\n            }\n        } else {\n            int32_t old_counter_20547;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_20526 == 0) {\n                    ((__global\n                      float *) group_res_arr_mem_20521)[sext_i32_i64(virt_group_id_20536) *\n                                                        segred_group_sizze_19069] =\n                        x_acc_20539;\n                    mem_fence_global();\n                    old_counter_20547 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_20523)[sext_i32_i64(srem32(flat_segment_id_20537,\n                                                                                                     10240))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_20532)[0] =\n                        old_counter_20547 == groups_per_segment_20516 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            \n            bool is_last_group_20548;\n            \n            is_last_group_20548 = ((__local bool *) sync_arr_mem_20532)[0];\n            if (is_last_group_20548) {\n                if (local_tid_20526 == 0) {\n                    old_counter_20547 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 in",
                   "t *) mainzicounter_mem_20523)[sext_i32_i64(srem32(flat_segment_id_20537,\n                                                                                                     10240))],\n                                              (int) (0 -\n                                                     groups_per_segment_20516));\n                }\n                // read in the per-group-results\n                {\n                    int64_t read_per_thread_20549 =\n                            sdiv_up64(groups_per_segment_20516,\n                                      segred_group_sizze_19069);\n                    \n                    x_19073 = 0.0F;\n                    for (int64_t i_20550 = 0; i_20550 < read_per_thread_20549;\n                         i_20550++) {\n                        int64_t group_res_id_20551 =\n                                sext_i32_i64(local_tid_20526) *\n                                read_per_thread_20549 + i_20550;\n                        int64_t index_of_group_res_20552 =\n                                sext_i32_i64(flat_segment_id_20537) *\n                                groups_per_segment_20516 + group_res_id_20551;\n                        \n                        if (slt64(group_res_id_20551,\n                                  groups_per_segment_20516)) {\n                            x_19074 = ((__global\n                                        float *) group_res_arr_mem_20521)[index_of_group_res_20552 *\n                                                                          segred_group_sizze_19069];\n                            \n                            float res_19075;\n                            \n                            res_19075 = x_19073 + x_19074;\n                            x_19073 = res_19075;\n                        }\n                    }\n                }\n                ((__local\n                  float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526)] =\n                    x_19073;\n                barrier(CLK_LOCAL_MEM_FENCE)",
                   ";\n                // reduce the per-group results\n                {\n                    int32_t offset_20553;\n                    int32_t skip_waves_20554;\n                    \n                    skip_waves_20554 = 1;\n                    \n                    float x_20541;\n                    float x_20542;\n                    \n                    offset_20553 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_20526,\n                                  sext_i64_i32(segred_group_sizze_19069))) {\n                            x_20541 = ((__local\n                                        float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526 +\n                                                                    offset_20553)];\n                        }\n                    }\n                    offset_20553 = 1;\n                    while (slt32(offset_20553, wave_sizze_20528)) {\n                        if (slt32(local_tid_20526 + offset_20553,\n                                  sext_i64_i32(segred_group_sizze_19069)) &&\n                            ((local_tid_20526 - squot32(local_tid_20526,\n                                                        wave_sizze_20528) *\n                              wave_sizze_20528) & (2 * offset_20553 - 1)) ==\n                            0) {\n                            // read array element\n                            {\n                                x_20542 = ((volatile __local\n                                            float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526 +\n                                                                        offset_20553)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_20543 = x_20541 + x_20542;\n                                \n                                x_20541 = res_20543;\n                    ",
                   "        }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526)] =\n                                    x_20541;\n                            }\n                        }\n                        offset_20553 *= 2;\n                    }\n                    while (slt32(skip_waves_20554,\n                                 squot32(sext_i64_i32(segred_group_sizze_19069) +\n                                         wave_sizze_20528 - 1,\n                                         wave_sizze_20528))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_20553 = skip_waves_20554 * wave_sizze_20528;\n                        if (slt32(local_tid_20526 + offset_20553,\n                                  sext_i64_i32(segred_group_sizze_19069)) &&\n                            ((local_tid_20526 - squot32(local_tid_20526,\n                                                        wave_sizze_20528) *\n                              wave_sizze_20528) == 0 &&\n                             (squot32(local_tid_20526, wave_sizze_20528) & (2 *\n                                                                            skip_waves_20554 -\n                                                                            1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_20542 = ((__local\n                                            float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526 +\n                                                                        offset_20553)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_20543 = x_20541 + x_20542;\n                                \n                   ",
                   "             x_20541 = res_20543;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  float *) red_arr_mem_20530)[sext_i32_i64(local_tid_20526)] =\n                                    x_20541;\n                            }\n                        }\n                        skip_waves_20554 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_20526 == 0) {\n                            ((__global float *) mem_19565)[gtid_18968] =\n                                x_20541;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_19069\n}\n__kernel void mainzisegred_large_20069(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *sync_arr_mem_20107_backing_aligned_0,\n                                       __local volatile\n                                       int64_t *red_arr_mem_20105_backing_aligned_1,\n                                       int64_t res_16723,\n                                       int64_t num_groups_18547, __global\n                                       unsigned char *mem_19277,\n                                       int32_t num_subhistos_19971, __global\n                                       unsigned char *res_r_subhistos_mem_19972,\n                                       int64_t groups_per_segment_20091,\n                                       int64_t elements_per_thread_20092,\n                                       int64_t virt_num_groups_20093,\n                                       int64_t threads_per_segment_20095,\n                                       __global\n                     ",
                   "                  unsigned char *group_res_arr_mem_20096,\n                                       __global\n                                       unsigned char *mainzicounter_mem_20098)\n{\n    #define seghist_group_sizze_18546 (mainziseghist_group_sizze_18208)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict sync_arr_mem_20107_backing_1 =\n                          (__local volatile\n                           char *) sync_arr_mem_20107_backing_aligned_0;\n    __local volatile char *restrict red_arr_mem_20105_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_20105_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20100;\n    int32_t local_tid_20101;\n    int64_t group_sizze_20104;\n    int32_t wave_sizze_20103;\n    int32_t group_tid_20102;\n    \n    global_tid_20100 = get_global_id(0);\n    local_tid_20101 = get_local_id(0);\n    group_sizze_20104 = get_local_size(0);\n    wave_sizze_20103 = LOCKSTEP_WIDTH;\n    group_tid_20102 = get_group_id(0);\n    \n    int32_t flat_gtid_20069;\n    \n    flat_gtid_20069 = global_tid_20100;\n    \n    __local char *red_arr_mem_20105;\n    \n    red_arr_mem_20105 = (__local char *) red_arr_mem_20105_backing_0;\n    \n    __local char *sync_arr_mem_20107;\n    \n    sync_arr_mem_20107 = (__local char *) sync_arr_mem_20107_backing_1;\n    \n    int32_t phys_group_id_20109;\n    \n    phys_group_id_20109 = get_group_id(0);\n    for (int32_t i_20110 = 0; i_20110 <\n         sdiv_up32(sext_i64_i32(virt_num_groups_20093) - phys_group_id_20109,\n                   sext_i64_i32(num_groups_18547)); i_20110++) {\n        int32_t virt_group_id_20111 = phys_group_id_20109 + i_20110 *\n                sext_i64_i32(num_groups_18547);\n        int32_t flat_segment_id_20112 = squot32(virt_group_id_20111,\n                                                sext_i64_i32(groups_per_segment_20091));\n        ",
                   "int64_t global_tid_20113 = srem64(sext_i32_i64(virt_group_id_20111) *\n                                          seghist_group_sizze_18546 +\n                                          sext_i32_i64(local_tid_20101),\n                                          seghist_group_sizze_18546 *\n                                          groups_per_segment_20091);\n        int64_t gtid_18205 = squot64(sext_i32_i64(flat_segment_id_20112),\n                                     res_16723);\n        int64_t bucket_id_20067 = sext_i32_i64(flat_segment_id_20112) -\n                squot64(sext_i32_i64(flat_segment_id_20112), res_16723) *\n                res_16723;\n        int64_t subhistogram_id_20068;\n        int64_t x_acc_20114;\n        int64_t chunk_sizze_20115;\n        \n        chunk_sizze_20115 = smin64(elements_per_thread_20092,\n                                   sdiv_up64(num_subhistos_19971 -\n                                             sext_i32_i64(sext_i64_i32(global_tid_20113)),\n                                             threads_per_segment_20095));\n        \n        int64_t x_18550;\n        int64_t x_18551;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_20114 = 0;\n        }\n        for (int64_t i_20119 = 0; i_20119 < chunk_sizze_20115; i_20119++) {\n            subhistogram_id_20068 =\n                sext_i32_i64(sext_i64_i32(global_tid_20113)) +\n                threads_per_segment_20095 * i_20119;\n            // apply map function\n            {\n                // load accumulator\n                {\n                    x_18550 = x_acc_20114;\n                }\n                // load new values\n                {\n                    x_18551 = ((__global\n                                int64_t *) res_r_subhistos_mem_19972)[gtid_18205 *\n                                                                      (res_16723 *\n                                                                       num_subhistos_19971) +\n                                     ",
                   "                                 subhistogram_id_20068 *\n                                                                      res_16723 +\n                                                                      bucket_id_20067];\n                }\n                // apply reduction operator\n                {\n                    int64_t res_18552 = smax64(x_18550, x_18551);\n                    \n                    // store in accumulator\n                    {\n                        x_acc_20114 = res_18552;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_18550 = x_acc_20114;\n            ((__local\n              int64_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101)] =\n                x_18550;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_20120;\n        int32_t skip_waves_20121;\n        \n        skip_waves_20121 = 1;\n        \n        int64_t x_20116;\n        int64_t x_20117;\n        \n        offset_20120 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_20101,\n                      sext_i64_i32(seghist_group_sizze_18546))) {\n                x_20116 = ((__local\n                            int64_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101 +\n                                                          offset_20120)];\n            }\n        }\n        offset_20120 = 1;\n        while (slt32(offset_20120, wave_sizze_20103)) {\n            if (slt32(local_tid_20101 + offset_20120,\n                      sext_i64_i32(seghist_group_sizze_18546)) &&\n                ((local_tid_20101 - squot32(local_tid_20101, wave_sizze_20103) *\n                  wave_sizze_20103) & (2 * offset_20120 - 1)) == 0) {\n                // read array element\n                {\n                    x_20117 = ((volatile __local\n                                int64_t *) red_arr_mem_20105)[sext_i32_i64(local_",
                   "tid_20101 +\n                                                              offset_20120)];\n                }\n                // apply reduction operation\n                {\n                    int64_t res_20118 = smax64(x_20116, x_20117);\n                    \n                    x_20116 = res_20118;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      int64_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101)] =\n                        x_20116;\n                }\n            }\n            offset_20120 *= 2;\n        }\n        while (slt32(skip_waves_20121,\n                     squot32(sext_i64_i32(seghist_group_sizze_18546) +\n                             wave_sizze_20103 - 1, wave_sizze_20103))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_20120 = skip_waves_20121 * wave_sizze_20103;\n            if (slt32(local_tid_20101 + offset_20120,\n                      sext_i64_i32(seghist_group_sizze_18546)) &&\n                ((local_tid_20101 - squot32(local_tid_20101, wave_sizze_20103) *\n                  wave_sizze_20103) == 0 && (squot32(local_tid_20101,\n                                                     wave_sizze_20103) & (2 *\n                                                                          skip_waves_20121 -\n                                                                          1)) ==\n                 0)) {\n                // read array element\n                {\n                    x_20117 = ((__local\n                                int64_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101 +\n                                                              offset_20120)];\n                }\n                // apply reduction operation\n                {\n                    int64_t res_20118 = smax64(x_20116, x_20117);\n                    \n                    x_20116 = res_20118;\n                }\n                // write result of operation\n                ",
                   "{\n                    ((__local\n                      int64_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101)] =\n                        x_20116;\n                }\n            }\n            skip_waves_20121 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (sext_i32_i64(local_tid_20101) == 0) {\n                x_acc_20114 = x_20116;\n            }\n        }\n        if (groups_per_segment_20091 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_20101 == 0) {\n                    ((__global int64_t *) mem_19277)[gtid_18205 * res_16723 +\n                                                     bucket_id_20067] =\n                        x_acc_20114;\n                }\n            }\n        } else {\n            int32_t old_counter_20122;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_20101 == 0) {\n                    ((__global\n                      int64_t *) group_res_arr_mem_20096)[sext_i32_i64(virt_group_id_20111) *\n                                                          seghist_group_sizze_18546] =\n                        x_acc_20114;\n                    mem_fence_global();\n                    old_counter_20122 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_20098)[sext_i32_i64(srem32(flat_segment_id_20112,\n                                                                                                     10240))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_20107)[0] =\n                        old_counter_20122 == groups_per_segment_20091 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            \n            bool is_last_grou",
                   "p_20123;\n            \n            is_last_group_20123 = ((__local bool *) sync_arr_mem_20107)[0];\n            if (is_last_group_20123) {\n                if (local_tid_20101 == 0) {\n                    old_counter_20122 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_20098)[sext_i32_i64(srem32(flat_segment_id_20112,\n                                                                                                     10240))],\n                                              (int) (0 -\n                                                     groups_per_segment_20091));\n                }\n                // read in the per-group-results\n                {\n                    int64_t read_per_thread_20124 =\n                            sdiv_up64(groups_per_segment_20091,\n                                      seghist_group_sizze_18546);\n                    \n                    x_18550 = 0;\n                    for (int64_t i_20125 = 0; i_20125 < read_per_thread_20124;\n                         i_20125++) {\n                        int64_t group_res_id_20126 =\n                                sext_i32_i64(local_tid_20101) *\n                                read_per_thread_20124 + i_20125;\n                        int64_t index_of_group_res_20127 =\n                                sext_i32_i64(flat_segment_id_20112) *\n                                groups_per_segment_20091 + group_res_id_20126;\n                        \n                        if (slt64(group_res_id_20126,\n                                  groups_per_segment_20091)) {\n                            x_18551 = ((__global\n                                        int64_t *) group_res_arr_mem_20096)[index_of_group_res_20127 *\n                                                                            seghist_group_sizze_18546];\n                            \n                            int64_t res_18552;\n                            \n        ",
                   "                    res_18552 = smax64(x_18550, x_18551);\n                            x_18550 = res_18552;\n                        }\n                    }\n                }\n                ((__local\n                  int64_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101)] =\n                    x_18550;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n                    int32_t offset_20128;\n                    int32_t skip_waves_20129;\n                    \n                    skip_waves_20129 = 1;\n                    \n                    int64_t x_20116;\n                    int64_t x_20117;\n                    \n                    offset_20128 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_20101,\n                                  sext_i64_i32(seghist_group_sizze_18546))) {\n                            x_20116 = ((__local\n                                        int64_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101 +\n                                                                      offset_20128)];\n                        }\n                    }\n                    offset_20128 = 1;\n                    while (slt32(offset_20128, wave_sizze_20103)) {\n                        if (slt32(local_tid_20101 + offset_20128,\n                                  sext_i64_i32(seghist_group_sizze_18546)) &&\n                            ((local_tid_20101 - squot32(local_tid_20101,\n                                                        wave_sizze_20103) *\n                              wave_sizze_20103) & (2 * offset_20128 - 1)) ==\n                            0) {\n                            // read array element\n                            {\n                                x_20117 = ((volatile __local\n                                            int64_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101 +\n               ",
                   "                                                           offset_20128)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t res_20118 = smax64(x_20116, x_20117);\n                                \n                                x_20116 = res_20118;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  int64_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101)] =\n                                    x_20116;\n                            }\n                        }\n                        offset_20128 *= 2;\n                    }\n                    while (slt32(skip_waves_20129,\n                                 squot32(sext_i64_i32(seghist_group_sizze_18546) +\n                                         wave_sizze_20103 - 1,\n                                         wave_sizze_20103))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_20128 = skip_waves_20129 * wave_sizze_20103;\n                        if (slt32(local_tid_20101 + offset_20128,\n                                  sext_i64_i32(seghist_group_sizze_18546)) &&\n                            ((local_tid_20101 - squot32(local_tid_20101,\n                                                        wave_sizze_20103) *\n                              wave_sizze_20103) == 0 &&\n                             (squot32(local_tid_20101, wave_sizze_20103) & (2 *\n                                                                            skip_waves_20129 -\n                                                                            1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_20117 = ((__local\n                                            int64",
                   "_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101 +\n                                                                          offset_20128)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t res_20118 = smax64(x_20116, x_20117);\n                                \n                                x_20116 = res_20118;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  int64_t *) red_arr_mem_20105)[sext_i32_i64(local_tid_20101)] =\n                                    x_20116;\n                            }\n                        }\n                        skip_waves_20129 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_20101 == 0) {\n                            ((__global int64_t *) mem_19277)[gtid_18205 *\n                                                             res_16723 +\n                                                             bucket_id_20067] =\n                                x_20116;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef seghist_group_sizze_18546\n}\n__kernel void mainzisegred_nonseg_17056(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_19852_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_19850_backing_aligned_1,\n                                        int64_t steps_16675,\n                                        int64_t num_groups_17050, __global\n                        ",
                   "                unsigned char *mem_19265, __global\n                                        unsigned char *mem_19267, __global\n                                        unsigned char *mem_19272, __global\n                                        unsigned char *mem_19274, __global\n                                        unsigned char *mainzicounter_mem_19840,\n                                        __global\n                                        unsigned char *group_res_arr_mem_19842,\n                                        int64_t num_threads_19844)\n{\n    #define segred_group_sizze_17048 (mainzisegred_group_sizze_17047)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_19852_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_19852_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_19850_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_19850_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_19845;\n    int32_t local_tid_19846;\n    int64_t group_sizze_19849;\n    int32_t wave_sizze_19848;\n    int32_t group_tid_19847;\n    \n    global_tid_19845 = get_global_id(0);\n    local_tid_19846 = get_local_id(0);\n    group_sizze_19849 = get_local_size(0);\n    wave_sizze_19848 = LOCKSTEP_WIDTH;\n    group_tid_19847 = get_group_id(0);\n    \n    int32_t phys_tid_17056;\n    \n    phys_tid_17056 = global_tid_19845;\n    \n    __local char *sync_arr_mem_19850;\n    \n    sync_arr_mem_19850 = (__local char *) sync_arr_mem_19850_backing_0;\n    \n    __local char *red_arr_mem_19852;\n    \n    red_arr_mem_19852 = (__local char *) red_arr_mem_19852_backing_1;\n    \n    int64_t dummy_17054;\n    \n    dummy_17054 = 0;\n    \n    int64_t gtid_17055;\n    \n    gtid_17055 = 0;\n    \n    int64_t x_acc_19854;\n    int64_t chunk_sizze_19855;\n    \n    chunk_sizz",
                   "e_19855 = smin64(sdiv_up64(steps_16675,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_17048 *\n                                         num_groups_17050))),\n                               sdiv_up64(steps_16675 -\n                                         sext_i32_i64(phys_tid_17056),\n                                         num_threads_19844));\n    \n    int64_t x_16725;\n    int64_t x_16726;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_19854 = 0;\n    }\n    for (int64_t i_19859 = 0; i_19859 < chunk_sizze_19855; i_19859++) {\n        gtid_17055 = sext_i32_i64(phys_tid_17056) + num_threads_19844 * i_19859;\n        // apply map function\n        {\n            int64_t i_p_o_19120 = add64(-1, gtid_17055);\n            int64_t rot_i_19121 = smod64(i_p_o_19120, steps_16675);\n            int64_t x_16730 = ((__global int64_t *) mem_19267)[gtid_17055];\n            bool cond_16731 = gtid_17055 == 0;\n            int64_t res_16732;\n            \n            if (cond_16731) {\n                res_16732 = 0;\n            } else {\n                int64_t x_16729 = ((__global int64_t *) mem_19265)[rot_i_19121];\n                \n                res_16732 = x_16729;\n            }\n            // save map-out results\n            {\n                ((__global int64_t *) mem_19274)[dummy_17054 * steps_16675 +\n                                                 gtid_17055] = res_16732;\n            }\n            // load accumulator\n            {\n                x_16725 = x_acc_19854;\n            }\n            // load new values\n            {\n                x_16726 = x_16730;\n            }\n            // apply reduction operator\n            {\n                int64_t res_16727 = add64(x_16725, x_16726);\n                \n                // store in accumulator\n                {\n                    x_acc_19854 = res_16727;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n      ",
                   "  x_16725 = x_acc_19854;\n        ((__local int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846)] =\n            x_16725;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_19860;\n    int32_t skip_waves_19861;\n    \n    skip_waves_19861 = 1;\n    \n    int64_t x_19856;\n    int64_t x_19857;\n    \n    offset_19860 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_19846, sext_i64_i32(segred_group_sizze_17048))) {\n            x_19856 = ((__local\n                        int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846 +\n                                                      offset_19860)];\n        }\n    }\n    offset_19860 = 1;\n    while (slt32(offset_19860, wave_sizze_19848)) {\n        if (slt32(local_tid_19846 + offset_19860,\n                  sext_i64_i32(segred_group_sizze_17048)) && ((local_tid_19846 -\n                                                               squot32(local_tid_19846,\n                                                                       wave_sizze_19848) *\n                                                               wave_sizze_19848) &\n                                                              (2 *\n                                                               offset_19860 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_19857 = ((volatile __local\n                            int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846 +\n                                                          offset_19860)];\n            }\n            // apply reduction operation\n            {\n                int64_t res_19858 = add64(x_19856, x_19857);\n                \n                x_19856 = res_19858;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846)] =\n              ",
                   "      x_19856;\n            }\n        }\n        offset_19860 *= 2;\n    }\n    while (slt32(skip_waves_19861,\n                 squot32(sext_i64_i32(segred_group_sizze_17048) +\n                         wave_sizze_19848 - 1, wave_sizze_19848))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_19860 = skip_waves_19861 * wave_sizze_19848;\n        if (slt32(local_tid_19846 + offset_19860,\n                  sext_i64_i32(segred_group_sizze_17048)) && ((local_tid_19846 -\n                                                               squot32(local_tid_19846,\n                                                                       wave_sizze_19848) *\n                                                               wave_sizze_19848) ==\n                                                              0 &&\n                                                              (squot32(local_tid_19846,\n                                                                       wave_sizze_19848) &\n                                                               (2 *\n                                                                skip_waves_19861 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_19857 = ((__local\n                            int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846 +\n                                                          offset_19860)];\n            }\n            // apply reduction operation\n            {\n                int64_t res_19858 = add64(x_19856, x_19857);\n                \n                x_19856 = res_19858;\n            }\n            // write result of operation\n            {\n                ((__local\n                  int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846)] =\n                    x_19856;\n            }\n        }\n        skip_waves_19861 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n   ",
                   "     if (sext_i32_i64(local_tid_19846) == 0) {\n            x_acc_19854 = x_19856;\n        }\n    }\n    \n    int32_t old_counter_19862;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_19846 == 0) {\n            ((__global\n              int64_t *) group_res_arr_mem_19842)[sext_i32_i64(group_tid_19847) *\n                                                  segred_group_sizze_17048] =\n                x_acc_19854;\n            mem_fence_global();\n            old_counter_19862 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_19840)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_19850)[0] = old_counter_19862 ==\n                num_groups_17050 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_19863;\n    \n    is_last_group_19863 = ((__local bool *) sync_arr_mem_19850)[0];\n    if (is_last_group_19863) {\n        if (local_tid_19846 == 0) {\n            old_counter_19862 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_19840)[0],\n                                                      (int) (0 -\n                                                             num_groups_17050));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_19864 = sdiv_up64(num_groups_17050,\n                                                      segred_group_sizze_17048);\n            \n            x_16725 = 0;\n            for (int64_t i_19865 = 0; i_19865 < read_per_thread_19864;\n                 i_19865++) {\n                int64_t group_res_id_19866 = sext_i32_i64(local_tid_19846) *\n                        read_per_thread_19864 + i_19865;\n                int64_t index_of_group_res_19867 = group_res_id_19866;\n                \n                if (slt64(g",
                   "roup_res_id_19866, num_groups_17050)) {\n                    x_16726 = ((__global\n                                int64_t *) group_res_arr_mem_19842)[index_of_group_res_19867 *\n                                                                    segred_group_sizze_17048];\n                    \n                    int64_t res_16727;\n                    \n                    res_16727 = add64(x_16725, x_16726);\n                    x_16725 = res_16727;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846)] =\n            x_16725;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_19868;\n            int32_t skip_waves_19869;\n            \n            skip_waves_19869 = 1;\n            \n            int64_t x_19856;\n            int64_t x_19857;\n            \n            offset_19868 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_19846,\n                          sext_i64_i32(segred_group_sizze_17048))) {\n                    x_19856 = ((__local\n                                int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846 +\n                                                              offset_19868)];\n                }\n            }\n            offset_19868 = 1;\n            while (slt32(offset_19868, wave_sizze_19848)) {\n                if (slt32(local_tid_19846 + offset_19868,\n                          sext_i64_i32(segred_group_sizze_17048)) &&\n                    ((local_tid_19846 - squot32(local_tid_19846,\n                                                wave_sizze_19848) *\n                      wave_sizze_19848) & (2 * offset_19868 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_19857 = ((volatile __local\n                                    int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846 +\n                ",
                   "                                                  offset_19868)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t res_19858 = add64(x_19856, x_19857);\n                        \n                        x_19856 = res_19858;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846)] =\n                            x_19856;\n                    }\n                }\n                offset_19868 *= 2;\n            }\n            while (slt32(skip_waves_19869,\n                         squot32(sext_i64_i32(segred_group_sizze_17048) +\n                                 wave_sizze_19848 - 1, wave_sizze_19848))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_19868 = skip_waves_19869 * wave_sizze_19848;\n                if (slt32(local_tid_19846 + offset_19868,\n                          sext_i64_i32(segred_group_sizze_17048)) &&\n                    ((local_tid_19846 - squot32(local_tid_19846,\n                                                wave_sizze_19848) *\n                      wave_sizze_19848) == 0 && (squot32(local_tid_19846,\n                                                         wave_sizze_19848) &\n                                                 (2 * skip_waves_19869 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_19857 = ((__local\n                                    int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846 +\n                                                                  offset_19868)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t res_19858 = add64(x_19856, x_19857);\n                        \n                        x_19856 = res_19858;\n      ",
                   "              }\n                    // write result of operation\n                    {\n                        ((__local\n                          int64_t *) red_arr_mem_19852)[sext_i32_i64(local_tid_19846)] =\n                            x_19856;\n                    }\n                }\n                skip_waves_19869 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_19846 == 0) {\n                    ((__global int64_t *) mem_19272)[0] = x_19856;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_17048\n}\n__kernel void mainzisegred_nonseg_18835(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_20470_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_20468_backing_aligned_1,\n                                        int64_t paths_16674,\n                                        int64_t steps_16675, float a_16679,\n                                        float res_16997, float x_16998,\n                                        float x_17000, float y_17002,\n                                        float y_17003, int64_t num_groups_18838,\n                                        __global unsigned char *mem_19269,\n                                        __global unsigned char *res_mem_19549,\n                                        __global unsigned char *mem_19552,\n                                        __global unsigned char *mem_19554,\n                                        __global\n                                        unsigned char *mainzicounter_mem_20458,\n                                        __global\n                                        unsigned char *group_res_arr_mem_20460,\n                                        int64_t num_threads_20462)\n{\n    #define segre",
                   "d_group_sizze_18837 (mainzisegred_group_sizze_18826)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_20470_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_20470_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_20468_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_20468_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20463;\n    int32_t local_tid_20464;\n    int64_t group_sizze_20467;\n    int32_t wave_sizze_20466;\n    int32_t group_tid_20465;\n    \n    global_tid_20463 = get_global_id(0);\n    local_tid_20464 = get_local_id(0);\n    group_sizze_20467 = get_local_size(0);\n    wave_sizze_20466 = LOCKSTEP_WIDTH;\n    group_tid_20465 = get_group_id(0);\n    \n    int32_t phys_tid_18835;\n    \n    phys_tid_18835 = global_tid_20463;\n    \n    __local char *sync_arr_mem_20468;\n    \n    sync_arr_mem_20468 = (__local char *) sync_arr_mem_20468_backing_0;\n    \n    __local char *red_arr_mem_20470;\n    \n    red_arr_mem_20470 = (__local char *) red_arr_mem_20470_backing_1;\n    \n    int64_t dummy_18833;\n    \n    dummy_18833 = 0;\n    \n    int64_t gtid_18834;\n    \n    gtid_18834 = 0;\n    \n    float x_acc_20472;\n    int64_t chunk_sizze_20473;\n    \n    chunk_sizze_20473 = smin64(sdiv_up64(steps_16675,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_18837 *\n                                         num_groups_18838))),\n                               sdiv_up64(steps_16675 -\n                                         sext_i32_i64(phys_tid_18835),\n                                         num_threads_20462));\n    \n    float x_18842;\n    float x_18843;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_20472 = 0.0F;\n    }\n    for (int64_t i_20477 = 0; i_20477 < chunk_sizze_20473;",
                   " i_20477++) {\n        gtid_18834 = sext_i32_i64(phys_tid_18835) + num_threads_20462 * i_20477;\n        // apply map function\n        {\n            float x_18846 = ((__global float *) mem_19269)[gtid_18834];\n            float res_18847;\n            float redout_19249 = 0.0F;\n            \n            for (int64_t i_19250 = 0; i_19250 < paths_16674; i_19250++) {\n                float x_18851 = ((__global float *) res_mem_19549)[i_19250 *\n                                                                   steps_16675 +\n                                                                   gtid_18834];\n                float res_18850 = x_18851 + redout_19249;\n                float redout_tmp_20478 = res_18850;\n                \n                redout_19249 = redout_tmp_20478;\n            }\n            res_18847 = redout_19249;\n            \n            float res_18852 = res_18847 / res_16997;\n            float negate_arg_18853 = a_16679 * x_18846;\n            float exp_arg_18854 = 0.0F - negate_arg_18853;\n            float res_18855 = fpow32(2.7182817F, exp_arg_18854);\n            float x_18856 = 1.0F - res_18855;\n            float B_18857 = x_18856 / a_16679;\n            float x_18858 = B_18857 - x_18846;\n            float x_18859 = y_17002 * x_18858;\n            float A1_18860 = x_18859 / x_16998;\n            float y_18861 = fpow32(B_18857, 2.0F);\n            float x_18862 = x_17000 * y_18861;\n            float A2_18863 = x_18862 / y_17003;\n            float exp_arg_18864 = A1_18860 - A2_18863;\n            float res_18865 = fpow32(2.7182817F, exp_arg_18864);\n            float negate_arg_18866 = 5.0e-2F * B_18857;\n            float exp_arg_18867 = 0.0F - negate_arg_18866;\n            float res_18868 = fpow32(2.7182817F, exp_arg_18867);\n            float res_18869 = res_18865 * res_18868;\n            float res_18870 = res_18852 * res_18869;\n            \n            // save map-out results\n            {\n                ((__global float *) mem_19554)[dummy_18833 * steps_16675 +\n ",
                   "                                              gtid_18834] = res_18870;\n            }\n            // load accumulator\n            {\n                x_18842 = x_acc_20472;\n            }\n            // load new values\n            {\n                x_18843 = res_18870;\n            }\n            // apply reduction operator\n            {\n                float res_18844 = x_18842 + x_18843;\n                \n                // store in accumulator\n                {\n                    x_acc_20472 = res_18844;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_18842 = x_acc_20472;\n        ((__local float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464)] =\n            x_18842;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_20479;\n    int32_t skip_waves_20480;\n    \n    skip_waves_20480 = 1;\n    \n    float x_20474;\n    float x_20475;\n    \n    offset_20479 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_20464, sext_i64_i32(segred_group_sizze_18837))) {\n            x_20474 = ((__local\n                        float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464 +\n                                                    offset_20479)];\n        }\n    }\n    offset_20479 = 1;\n    while (slt32(offset_20479, wave_sizze_20466)) {\n        if (slt32(local_tid_20464 + offset_20479,\n                  sext_i64_i32(segred_group_sizze_18837)) && ((local_tid_20464 -\n                                                               squot32(local_tid_20464,\n                                                                       wave_sizze_20466) *\n                                                               wave_sizze_20466) &\n                                                              (2 *\n                                                               offset_20479 -\n                                                               1)) == 0) {\n            // re",
                   "ad array element\n            {\n                x_20475 = ((volatile __local\n                            float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464 +\n                                                        offset_20479)];\n            }\n            // apply reduction operation\n            {\n                float res_20476 = x_20474 + x_20475;\n                \n                x_20474 = res_20476;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464)] =\n                    x_20474;\n            }\n        }\n        offset_20479 *= 2;\n    }\n    while (slt32(skip_waves_20480,\n                 squot32(sext_i64_i32(segred_group_sizze_18837) +\n                         wave_sizze_20466 - 1, wave_sizze_20466))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_20479 = skip_waves_20480 * wave_sizze_20466;\n        if (slt32(local_tid_20464 + offset_20479,\n                  sext_i64_i32(segred_group_sizze_18837)) && ((local_tid_20464 -\n                                                               squot32(local_tid_20464,\n                                                                       wave_sizze_20466) *\n                                                               wave_sizze_20466) ==\n                                                              0 &&\n                                                              (squot32(local_tid_20464,\n                                                                       wave_sizze_20466) &\n                                                               (2 *\n                                                                skip_waves_20480 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_20475 = ((__local\n                            float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464 +\n             ",
                   "                                           offset_20479)];\n            }\n            // apply reduction operation\n            {\n                float res_20476 = x_20474 + x_20475;\n                \n                x_20474 = res_20476;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464)] =\n                    x_20474;\n            }\n        }\n        skip_waves_20480 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_20464) == 0) {\n            x_acc_20472 = x_20474;\n        }\n    }\n    \n    int32_t old_counter_20481;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_20464 == 0) {\n            ((__global\n              float *) group_res_arr_mem_20460)[sext_i32_i64(group_tid_20465) *\n                                                segred_group_sizze_18837] =\n                x_acc_20472;\n            mem_fence_global();\n            old_counter_20481 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20458)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_20468)[0] = old_counter_20481 ==\n                num_groups_18838 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_20482;\n    \n    is_last_group_20482 = ((__local bool *) sync_arr_mem_20468)[0];\n    if (is_last_group_20482) {\n        if (local_tid_20464 == 0) {\n            old_counter_20481 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20458)[0],\n                                                      (int) (0 -\n                                                             num_groups_18838));\n        }\n  ",
                   "      // read in the per-group-results\n        {\n            int64_t read_per_thread_20483 = sdiv_up64(num_groups_18838,\n                                                      segred_group_sizze_18837);\n            \n            x_18842 = 0.0F;\n            for (int64_t i_20484 = 0; i_20484 < read_per_thread_20483;\n                 i_20484++) {\n                int64_t group_res_id_20485 = sext_i32_i64(local_tid_20464) *\n                        read_per_thread_20483 + i_20484;\n                int64_t index_of_group_res_20486 = group_res_id_20485;\n                \n                if (slt64(group_res_id_20485, num_groups_18838)) {\n                    x_18843 = ((__global\n                                float *) group_res_arr_mem_20460)[index_of_group_res_20486 *\n                                                                  segred_group_sizze_18837];\n                    \n                    float res_18844;\n                    \n                    res_18844 = x_18842 + x_18843;\n                    x_18842 = res_18844;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464)] =\n            x_18842;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_20487;\n            int32_t skip_waves_20488;\n            \n            skip_waves_20488 = 1;\n            \n            float x_20474;\n            float x_20475;\n            \n            offset_20487 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_20464,\n                          sext_i64_i32(segred_group_sizze_18837))) {\n                    x_20474 = ((__local\n                                float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464 +\n                                                            offset_20487)];\n                }\n            }\n            offset_20487 = 1;\n            while (slt32(offset_20487, wave_sizze_204",
                   "66)) {\n                if (slt32(local_tid_20464 + offset_20487,\n                          sext_i64_i32(segred_group_sizze_18837)) &&\n                    ((local_tid_20464 - squot32(local_tid_20464,\n                                                wave_sizze_20466) *\n                      wave_sizze_20466) & (2 * offset_20487 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_20475 = ((volatile __local\n                                    float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464 +\n                                                                offset_20487)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_20476 = x_20474 + x_20475;\n                        \n                        x_20474 = res_20476;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464)] =\n                            x_20474;\n                    }\n                }\n                offset_20487 *= 2;\n            }\n            while (slt32(skip_waves_20488,\n                         squot32(sext_i64_i32(segred_group_sizze_18837) +\n                                 wave_sizze_20466 - 1, wave_sizze_20466))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_20487 = skip_waves_20488 * wave_sizze_20466;\n                if (slt32(local_tid_20464 + offset_20487,\n                          sext_i64_i32(segred_group_sizze_18837)) &&\n                    ((local_tid_20464 - squot32(local_tid_20464,\n                                                wave_sizze_20466) *\n                      wave_sizze_20466) == 0 && (squot32(local_tid_20464,\n                                                         wave_sizze_20466) &\n                                                 (2 * skip_waves_20488 - 1)",
                   ") ==\n                     0)) {\n                    // read array element\n                    {\n                        x_20475 = ((__local\n                                    float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464 +\n                                                                offset_20487)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_20476 = x_20474 + x_20475;\n                        \n                        x_20474 = res_20476;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_20470)[sext_i32_i64(local_tid_20464)] =\n                            x_20474;\n                    }\n                }\n                skip_waves_20488 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_20464 == 0) {\n                    ((__global float *) mem_19552)[0] = x_20474;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_18837\n}\n__kernel void mainzisegred_nonseg_19031(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_20573_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_20571_backing_aligned_1,\n                                        int64_t steps_16675,\n                                        int64_t num_groups_19108, __global\n                                        unsigned char *res_map_acc_mem_19571,\n                                        __global unsigned char *mem_19575,\n                                        __global\n                                        unsigned char *mainzicounter_mem_20561,\n                                        __global\n",
                   "                                        unsigned char *group_res_arr_mem_20563,\n                                        int64_t num_threads_20565)\n{\n    #define segred_group_sizze_19107 (mainzisegred_group_sizze_19023)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_20573_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_20573_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_20571_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_20571_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20566;\n    int32_t local_tid_20567;\n    int64_t group_sizze_20570;\n    int32_t wave_sizze_20569;\n    int32_t group_tid_20568;\n    \n    global_tid_20566 = get_global_id(0);\n    local_tid_20567 = get_local_id(0);\n    group_sizze_20570 = get_local_size(0);\n    wave_sizze_20569 = LOCKSTEP_WIDTH;\n    group_tid_20568 = get_group_id(0);\n    \n    int32_t phys_tid_19031;\n    \n    phys_tid_19031 = global_tid_20566;\n    \n    __local char *sync_arr_mem_20571;\n    \n    sync_arr_mem_20571 = (__local char *) sync_arr_mem_20571_backing_0;\n    \n    __local char *red_arr_mem_20573;\n    \n    red_arr_mem_20573 = (__local char *) red_arr_mem_20573_backing_1;\n    \n    int64_t dummy_19029;\n    \n    dummy_19029 = 0;\n    \n    int64_t gtid_19030;\n    \n    gtid_19030 = 0;\n    \n    float x_acc_20575;\n    int64_t chunk_sizze_20576;\n    \n    chunk_sizze_20576 = smin64(sdiv_up64(steps_16675,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_19107 *\n                                         num_groups_19108))),\n                               sdiv_up64(steps_16675 -\n                                         sext_i32_i64(phys_tid_19031),\n                                         num_threads_20565));\n    \n    float x_19111;",
                   "\n    float x_19112;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_20575 = 0.0F;\n    }\n    for (int64_t i_20580 = 0; i_20580 < chunk_sizze_20576; i_20580++) {\n        gtid_19030 = sext_i32_i64(phys_tid_19031) + num_threads_20565 * i_20580;\n        // apply map function\n        {\n            float x_19114 = ((__global\n                              float *) res_map_acc_mem_19571)[gtid_19030];\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_19111 = x_acc_20575;\n            }\n            // load new values\n            {\n                x_19112 = x_19114;\n            }\n            // apply reduction operator\n            {\n                float res_19113 = x_19111 + x_19112;\n                \n                // store in accumulator\n                {\n                    x_acc_20575 = res_19113;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_19111 = x_acc_20575;\n        ((__local float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567)] =\n            x_19111;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_20581;\n    int32_t skip_waves_20582;\n    \n    skip_waves_20582 = 1;\n    \n    float x_20577;\n    float x_20578;\n    \n    offset_20581 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_20567, sext_i64_i32(segred_group_sizze_19107))) {\n            x_20577 = ((__local\n                        float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567 +\n                                                    offset_20581)];\n        }\n    }\n    offset_20581 = 1;\n    while (slt32(offset_20581, wave_sizze_20569)) {\n        if (slt32(local_tid_20567 + offset_20581,\n                  sext_i64_i32(segred_group_sizze_19107)) && ((local_tid_20567 -\n                                                               squot32(local_tid_20567,\n                  ",
                   "                                                     wave_sizze_20569) *\n                                                               wave_sizze_20569) &\n                                                              (2 *\n                                                               offset_20581 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_20578 = ((volatile __local\n                            float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567 +\n                                                        offset_20581)];\n            }\n            // apply reduction operation\n            {\n                float res_20579 = x_20577 + x_20578;\n                \n                x_20577 = res_20579;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567)] =\n                    x_20577;\n            }\n        }\n        offset_20581 *= 2;\n    }\n    while (slt32(skip_waves_20582,\n                 squot32(sext_i64_i32(segred_group_sizze_19107) +\n                         wave_sizze_20569 - 1, wave_sizze_20569))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_20581 = skip_waves_20582 * wave_sizze_20569;\n        if (slt32(local_tid_20567 + offset_20581,\n                  sext_i64_i32(segred_group_sizze_19107)) && ((local_tid_20567 -\n                                                               squot32(local_tid_20567,\n                                                                       wave_sizze_20569) *\n                                                               wave_sizze_20569) ==\n                                                              0 &&\n                                                              (squot32(local_tid_20567,\n                                                                       wave_sizze_20569) &\n                   ",
                   "                                            (2 *\n                                                                skip_waves_20582 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_20578 = ((__local\n                            float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567 +\n                                                        offset_20581)];\n            }\n            // apply reduction operation\n            {\n                float res_20579 = x_20577 + x_20578;\n                \n                x_20577 = res_20579;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567)] =\n                    x_20577;\n            }\n        }\n        skip_waves_20582 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_20567) == 0) {\n            x_acc_20575 = x_20577;\n        }\n    }\n    \n    int32_t old_counter_20583;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_20567 == 0) {\n            ((__global\n              float *) group_res_arr_mem_20563)[sext_i32_i64(group_tid_20568) *\n                                                segred_group_sizze_19107] =\n                x_acc_20575;\n            mem_fence_global();\n            old_counter_20583 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20561)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_20571)[0] = old_counter_20583 ==\n                num_groups_19108 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_20584;\n    \n    is_last_group_20584 = ((__local bool *) sync_arr_mem_20571)[0];\n",
                   "    if (is_last_group_20584) {\n        if (local_tid_20567 == 0) {\n            old_counter_20583 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20561)[0],\n                                                      (int) (0 -\n                                                             num_groups_19108));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_20585 = sdiv_up64(num_groups_19108,\n                                                      segred_group_sizze_19107);\n            \n            x_19111 = 0.0F;\n            for (int64_t i_20586 = 0; i_20586 < read_per_thread_20585;\n                 i_20586++) {\n                int64_t group_res_id_20587 = sext_i32_i64(local_tid_20567) *\n                        read_per_thread_20585 + i_20586;\n                int64_t index_of_group_res_20588 = group_res_id_20587;\n                \n                if (slt64(group_res_id_20587, num_groups_19108)) {\n                    x_19112 = ((__global\n                                float *) group_res_arr_mem_20563)[index_of_group_res_20588 *\n                                                                  segred_group_sizze_19107];\n                    \n                    float res_19113;\n                    \n                    res_19113 = x_19111 + x_19112;\n                    x_19111 = res_19113;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567)] =\n            x_19111;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_20589;\n            int32_t skip_waves_20590;\n            \n            skip_waves_20590 = 1;\n            \n            float x_20577;\n            float x_20578;\n            \n            offset_20589 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_20567",
                   ",\n                          sext_i64_i32(segred_group_sizze_19107))) {\n                    x_20577 = ((__local\n                                float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567 +\n                                                            offset_20589)];\n                }\n            }\n            offset_20589 = 1;\n            while (slt32(offset_20589, wave_sizze_20569)) {\n                if (slt32(local_tid_20567 + offset_20589,\n                          sext_i64_i32(segred_group_sizze_19107)) &&\n                    ((local_tid_20567 - squot32(local_tid_20567,\n                                                wave_sizze_20569) *\n                      wave_sizze_20569) & (2 * offset_20589 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_20578 = ((volatile __local\n                                    float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567 +\n                                                                offset_20589)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_20579 = x_20577 + x_20578;\n                        \n                        x_20577 = res_20579;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567)] =\n                            x_20577;\n                    }\n                }\n                offset_20589 *= 2;\n            }\n            while (slt32(skip_waves_20590,\n                         squot32(sext_i64_i32(segred_group_sizze_19107) +\n                                 wave_sizze_20569 - 1, wave_sizze_20569))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_20589 = skip_waves_20590 * wave_sizze_20569;\n                if (slt32(local_tid_20567 + offset_20589,\n                          sext_i64_",
                   "i32(segred_group_sizze_19107)) &&\n                    ((local_tid_20567 - squot32(local_tid_20567,\n                                                wave_sizze_20569) *\n                      wave_sizze_20569) == 0 && (squot32(local_tid_20567,\n                                                         wave_sizze_20569) &\n                                                 (2 * skip_waves_20590 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_20578 = ((__local\n                                    float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567 +\n                                                                offset_20589)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_20579 = x_20577 + x_20578;\n                        \n                        x_20577 = res_20579;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_20573)[sext_i32_i64(local_tid_20567)] =\n                            x_20577;\n                    }\n                }\n                skip_waves_20590 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_20567 == 0) {\n                    ((__global float *) mem_19575)[0] = x_20577;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_19107\n}\n__kernel void mainzisegred_nonseg_19606(__global int *global_failure,\n                                        int failure_is_an_option, __global\n                                        int64_t *global_failure_args,\n                                        __local volatile\n                                        int64_t *red_arr_mem_19899_backing_aligned_0,\n                                        __local volatile\n                ",
                   "                        int64_t *sync_arr_mem_19897_backing_aligned_1,\n                                        int64_t paths_16674,\n                                        int64_t steps_16675, int64_t res_16723,\n                                        unsigned char cond_16737, __global\n                                        unsigned char *mem_19274, __global\n                                        unsigned char *mem_19670, __global\n                                        unsigned char *mem_19684, __global\n                                        unsigned char *mem_19698, __global\n                                        unsigned char *mem_19712, __global\n                                        unsigned char *mem_19726, __global\n                                        unsigned char *mainzicounter_mem_19887,\n                                        __global\n                                        unsigned char *group_res_arr_mem_19889,\n                                        int64_t num_threads_19891)\n{\n    #define segred_num_groups_19600 (mainzisegred_num_groups_19599)\n    #define segred_group_sizze_19602 (mainzisegred_group_sizze_19601)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_19899_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_19899_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_19897_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_19897_backing_aligned_1;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_19892;\n    int32_t local_tid_19893;\n    int64_t group_sizze_19896;\n    int32_t wave_sizze_19895;\n    int32_t group_tid_19",
                   "894;\n    \n    global_tid_19892 = get_global_id(0);\n    local_tid_19893 = get_local_id(0);\n    group_sizze_19896 = get_local_size(0);\n    wave_sizze_19895 = LOCKSTEP_WIDTH;\n    group_tid_19894 = get_group_id(0);\n    \n    int32_t phys_tid_19606;\n    \n    phys_tid_19606 = global_tid_19892;\n    \n    __local char *sync_arr_mem_19897;\n    \n    sync_arr_mem_19897 = (__local char *) sync_arr_mem_19897_backing_0;\n    \n    __local char *red_arr_mem_19899;\n    \n    red_arr_mem_19899 = (__local char *) red_arr_mem_19899_backing_1;\n    \n    int64_t dummy_19604;\n    \n    dummy_19604 = 0;\n    \n    int64_t gtid_19605;\n    \n    gtid_19605 = 0;\n    \n    int64_t x_acc_19901;\n    int64_t chunk_sizze_19902;\n    \n    chunk_sizze_19902 = smin64(sdiv_up64(paths_16674,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_19602 *\n                                         segred_num_groups_19600))),\n                               sdiv_up64(paths_16674 -\n                                         sext_i32_i64(phys_tid_19606),\n                                         num_threads_19891));\n    \n    int64_t x_19607;\n    int64_t y_19608;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_19901 = 0;\n    }\n    for (int64_t i_19906 = 0; i_19906 < chunk_sizze_19902; i_19906++) {\n        gtid_19605 = sext_i32_i64(phys_tid_19606) + num_threads_19891 * i_19906;\n        // apply map function\n        {\n            for (int64_t i_19907 = 0; i_19907 < res_16723; i_19907++) {\n                ((__global int64_t *) mem_19670)[phys_tid_19606 + i_19907 *\n                                                 (segred_num_groups_19600 *\n                                                  segred_group_sizze_19602)] =\n                    0;\n            }\n            for (int64_t iter_19613 = 0; iter_19613 < steps_16675;\n                 iter_19613++) {\n                int64_t pixel_19615 = ((__global\n                                        int64_t *) mem_19274)[iter_19613];\n     ",
                   "           bool less_than_zzero_19616 = slt64(pixel_19615, 0);\n                bool greater_than_sizze_19617 = sle64(res_16723, pixel_19615);\n                bool outside_bounds_dim_19618 = less_than_zzero_19616 ||\n                     greater_than_sizze_19617;\n                \n                if (!outside_bounds_dim_19618) {\n                    int64_t read_hist_19620 = ((__global\n                                                int64_t *) mem_19670)[phys_tid_19606 +\n                                                                      pixel_19615 *\n                                                                      (segred_num_groups_19600 *\n                                                                       segred_group_sizze_19602)];\n                    int64_t res_19621 = smax64(iter_19613, read_hist_19620);\n                    \n                    ((__global int64_t *) mem_19670)[phys_tid_19606 +\n                                                     pixel_19615 *\n                                                     (segred_num_groups_19600 *\n                                                      segred_group_sizze_19602)] =\n                        res_19621;\n                }\n            }\n            \n            int64_t discard_19624;\n            int64_t scanacc_19627 = 0;\n            \n            for (int64_t i_19626 = 0; i_19626 < res_16723; i_19626++) {\n                int64_t x_19629 = ((__global\n                                    int64_t *) mem_19670)[phys_tid_19606 +\n                                                          i_19626 *\n                                                          (segred_num_groups_19600 *\n                                                           segred_group_sizze_19602)];\n                bool res_19630 = slt64(0, x_19629);\n                int64_t res_19631;\n                \n                if (res_19630) {\n                    res_19631 = x_19629;\n                } else {\n                    int64_t res_19632 = add64(sc",
                   "anacc_19627, x_19629);\n                    \n                    res_19631 = res_19632;\n                }\n                ((__global int64_t *) mem_19684)[phys_tid_19606 + i_19626 *\n                                                 (segred_num_groups_19600 *\n                                                  segred_group_sizze_19602)] =\n                    res_19631;\n                \n                int64_t scanacc_tmp_19909 = res_19631;\n                \n                scanacc_19627 = scanacc_tmp_19909;\n            }\n            discard_19624 = scanacc_19627;\n            for (int64_t i_19636 = 0; i_19636 < res_16723; i_19636++) {\n                int64_t x_19638 = ((__global\n                                    int64_t *) mem_19684)[phys_tid_19606 +\n                                                          i_19636 *\n                                                          (segred_num_groups_19600 *\n                                                           segred_group_sizze_19602)];\n                int64_t i_p_o_19639 = add64(-1, i_19636);\n                int64_t rot_i_19640 = smod64(i_p_o_19639, res_16723);\n                int64_t x_19641 = ((__global\n                                    int64_t *) mem_19684)[phys_tid_19606 +\n                                                          rot_i_19640 *\n                                                          (segred_num_groups_19600 *\n                                                           segred_group_sizze_19602)];\n                bool res_19642 = x_19638 == x_19641;\n                bool res_19643 = !res_19642;\n                \n                ((__global bool *) mem_19698)[phys_tid_19606 + i_19636 *\n                                              (segred_num_groups_19600 *\n                                               segred_group_sizze_19602)] =\n                    res_19643;\n            }\n            \n            int64_t discard_19646;\n            int64_t scanacc_19649 = 0;\n            \n            for (int64_t i_196",
                   "48 = 0; i_19648 < res_16723; i_19648++) {\n                int64_t i_p_o_19651 = add64(1, i_19648);\n                int64_t rot_i_19652 = smod64(i_p_o_19651, res_16723);\n                bool x_19653 = ((__global bool *) mem_19698)[phys_tid_19606 +\n                                                             rot_i_19652 *\n                                                             (segred_num_groups_19600 *\n                                                              segred_group_sizze_19602)];\n                int64_t res_19654 = btoi_bool_i64(x_19653);\n                int64_t res_19655 = add64(scanacc_19649, res_19654);\n                \n                ((__global int64_t *) mem_19712)[phys_tid_19606 + i_19648 *\n                                                 (segred_num_groups_19600 *\n                                                  segred_group_sizze_19602)] =\n                    res_19655;\n                \n                int64_t scanacc_tmp_19912 = res_19655;\n                \n                scanacc_19649 = scanacc_tmp_19912;\n            }\n            discard_19646 = scanacc_19649;\n            \n            int64_t num_segments_19657;\n            \n            if (cond_16737) {\n                int64_t i_19658 = sub64(res_16723, 1);\n                bool x_19659 = sle64(0, i_19658);\n                bool y_19660 = slt64(i_19658, res_16723);\n                bool bounds_check_19661 = x_19659 && y_19660;\n                bool index_certs_19662;\n                \n                if (!bounds_check_19661) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 0) ==\n                            -1) {\n                            global_failure_args[0] = i_19658;\n                            global_failure_args[1] = res_16723;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n               ",
                   " int64_t res_19663 = ((__global\n                                      int64_t *) mem_19712)[phys_tid_19606 +\n                                                            i_19658 *\n                                                            (segred_num_groups_19600 *\n                                                             segred_group_sizze_19602)];\n                \n                num_segments_19657 = res_19663;\n            } else {\n                num_segments_19657 = 0;\n            }\n            \n            int64_t bytes_19664 = 4 * num_segments_19657;\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_19607 = x_acc_19901;\n            }\n            // load new values\n            {\n                y_19608 = bytes_19664;\n            }\n            // apply reduction operator\n            {\n                int64_t zz_19609 = smax64(x_19607, y_19608);\n                \n                // store in accumulator\n                {\n                    x_acc_19901 = zz_19609;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_19607 = x_acc_19901;\n        ((__local int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893)] =\n            x_19607;\n    }\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_19914;\n    int32_t skip_waves_19915;\n    \n    skip_waves_19915 = 1;\n    \n    int64_t x_19903;\n    int64_t y_19904;\n    \n    offset_19914 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_19893, sext_i64_i32(segred_group_sizze_19602))) {\n            x_19903 = ((__local\n                        int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893 +\n                                                      offset_19914)];\n        }\n    }\n    offset_19914 = 1;\n    while (slt32(offset_1991",
                   "4, wave_sizze_19895)) {\n        if (slt32(local_tid_19893 + offset_19914,\n                  sext_i64_i32(segred_group_sizze_19602)) && ((local_tid_19893 -\n                                                               squot32(local_tid_19893,\n                                                                       wave_sizze_19895) *\n                                                               wave_sizze_19895) &\n                                                              (2 *\n                                                               offset_19914 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                y_19904 = ((volatile __local\n                            int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893 +\n                                                          offset_19914)];\n            }\n            // apply reduction operation\n            {\n                int64_t zz_19905 = smax64(x_19903, y_19904);\n                \n                x_19903 = zz_19905;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893)] =\n                    x_19903;\n            }\n        }\n        offset_19914 *= 2;\n    }\n    while (slt32(skip_waves_19915,\n                 squot32(sext_i64_i32(segred_group_sizze_19602) +\n                         wave_sizze_19895 - 1, wave_sizze_19895))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_19914 = skip_waves_19915 * wave_sizze_19895;\n        if (slt32(local_tid_19893 + offset_19914,\n                  sext_i64_i32(segred_group_sizze_19602)) && ((local_tid_19893 -\n                                                               squot32(local_tid_19893,\n                                                                       wave_sizze_19895) *\n                                                               wave_sizze_1",
                   "9895) ==\n                                                              0 &&\n                                                              (squot32(local_tid_19893,\n                                                                       wave_sizze_19895) &\n                                                               (2 *\n                                                                skip_waves_19915 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                y_19904 = ((__local\n                            int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893 +\n                                                          offset_19914)];\n            }\n            // apply reduction operation\n            {\n                int64_t zz_19905 = smax64(x_19903, y_19904);\n                \n                x_19903 = zz_19905;\n            }\n            // write result of operation\n            {\n                ((__local\n                  int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893)] =\n                    x_19903;\n            }\n        }\n        skip_waves_19915 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_19893) == 0) {\n            x_acc_19901 = x_19903;\n        }\n    }\n    \n    int32_t old_counter_19916;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_19893 == 0) {\n            ((__global\n              int64_t *) group_res_arr_mem_19889)[sext_i32_i64(group_tid_19894) *\n                                                  segred_group_sizze_19602] =\n                x_acc_19901;\n            mem_fence_global();\n            old_counter_19916 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_19887)[0],\n                                                      (int) 1);\n    ",
                   "        ((__local bool *) sync_arr_mem_19897)[0] = old_counter_19916 ==\n                segred_num_groups_19600 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_19917;\n    \n    is_last_group_19917 = ((__local bool *) sync_arr_mem_19897)[0];\n    if (is_last_group_19917) {\n        if (local_tid_19893 == 0) {\n            old_counter_19916 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_19887)[0],\n                                                      (int) (0 -\n                                                             segred_num_groups_19600));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_19918 = sdiv_up64(segred_num_groups_19600,\n                                                      segred_group_sizze_19602);\n            \n            x_19607 = 0;\n            for (int64_t i_19919 = 0; i_19919 < read_per_thread_19918;\n                 i_19919++) {\n                int64_t group_res_id_19920 = sext_i32_i64(local_tid_19893) *\n                        read_per_thread_19918 + i_19919;\n                int64_t index_of_group_res_19921 = group_res_id_19920;\n                \n                if (slt64(group_res_id_19920, segred_num_groups_19600)) {\n                    y_19608 = ((__global\n                                int64_t *) group_res_arr_mem_19889)[index_of_group_res_19921 *\n                                                                    segred_group_sizze_19602];\n                    \n                    int64_t zz_19609;\n                    \n                    zz_19609 = smax64(x_19607, y_19608);\n                    x_19607 = zz_19609;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893)] =\n            x_19607;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_",
                   "t offset_19922;\n            int32_t skip_waves_19923;\n            \n            skip_waves_19923 = 1;\n            \n            int64_t x_19903;\n            int64_t y_19904;\n            \n            offset_19922 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_19893,\n                          sext_i64_i32(segred_group_sizze_19602))) {\n                    x_19903 = ((__local\n                                int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893 +\n                                                              offset_19922)];\n                }\n            }\n            offset_19922 = 1;\n            while (slt32(offset_19922, wave_sizze_19895)) {\n                if (slt32(local_tid_19893 + offset_19922,\n                          sext_i64_i32(segred_group_sizze_19602)) &&\n                    ((local_tid_19893 - squot32(local_tid_19893,\n                                                wave_sizze_19895) *\n                      wave_sizze_19895) & (2 * offset_19922 - 1)) == 0) {\n                    // read array element\n                    {\n                        y_19904 = ((volatile __local\n                                    int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893 +\n                                                                  offset_19922)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zz_19905 = smax64(x_19903, y_19904);\n                        \n                        x_19903 = zz_19905;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893)] =\n                            x_19903;\n                    }\n                }\n                offset_19922 *= 2;\n            }\n            while (slt32(skip_waves_19923,\n         ",
                   "                squot32(sext_i64_i32(segred_group_sizze_19602) +\n                                 wave_sizze_19895 - 1, wave_sizze_19895))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_19922 = skip_waves_19923 * wave_sizze_19895;\n                if (slt32(local_tid_19893 + offset_19922,\n                          sext_i64_i32(segred_group_sizze_19602)) &&\n                    ((local_tid_19893 - squot32(local_tid_19893,\n                                                wave_sizze_19895) *\n                      wave_sizze_19895) == 0 && (squot32(local_tid_19893,\n                                                         wave_sizze_19895) &\n                                                 (2 * skip_waves_19923 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        y_19904 = ((__local\n                                    int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893 +\n                                                                  offset_19922)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zz_19905 = smax64(x_19903, y_19904);\n                        \n                        x_19903 = zz_19905;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          int64_t *) red_arr_mem_19899)[sext_i32_i64(local_tid_19893)] =\n                            x_19903;\n                    }\n                }\n                skip_waves_19923 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_19893 == 0) {\n                    ((__global int64_t *) mem_19726)[0] = x_19903;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_num_groups_19600\n    #undef segred_group_sizze_19602\n}\n__kernel void mainzisegred_nonse",
                   "g_19757(__global int *global_failure,\n                                        int failure_is_an_option, __global\n                                        int64_t *global_failure_args,\n                                        __local volatile\n                                        int64_t *red_arr_mem_20419_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_20417_backing_aligned_1,\n                                        int64_t paths_16674, int64_t res_16723,\n                                        unsigned char cond_16737, __global\n                                        unsigned char *mem_19521, __global\n                                        unsigned char *mem_19775, __global\n                                        unsigned char *mainzicounter_mem_20407,\n                                        __global\n                                        unsigned char *group_res_arr_mem_20409,\n                                        int64_t num_threads_20411)\n{\n    #define segred_num_groups_19751 (mainzisegred_num_groups_19750)\n    #define segred_group_sizze_19753 (mainzisegred_group_sizze_19752)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_20419_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_20419_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_20417_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_20417_backing_aligned_1;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_20412;\n    int32_t local_tid_20413;\n    int64_t group_sizze_20416;\n    int32_t wave",
                   "_sizze_20415;\n    int32_t group_tid_20414;\n    \n    global_tid_20412 = get_global_id(0);\n    local_tid_20413 = get_local_id(0);\n    group_sizze_20416 = get_local_size(0);\n    wave_sizze_20415 = LOCKSTEP_WIDTH;\n    group_tid_20414 = get_group_id(0);\n    \n    int32_t phys_tid_19757;\n    \n    phys_tid_19757 = global_tid_20412;\n    \n    __local char *sync_arr_mem_20417;\n    \n    sync_arr_mem_20417 = (__local char *) sync_arr_mem_20417_backing_0;\n    \n    __local char *red_arr_mem_20419;\n    \n    red_arr_mem_20419 = (__local char *) red_arr_mem_20419_backing_1;\n    \n    int64_t dummy_19755;\n    \n    dummy_19755 = 0;\n    \n    int64_t gtid_19756;\n    \n    gtid_19756 = 0;\n    \n    int64_t x_acc_20421;\n    int64_t chunk_sizze_20422;\n    \n    chunk_sizze_20422 = smin64(sdiv_up64(paths_16674,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_19753 *\n                                         segred_num_groups_19751))),\n                               sdiv_up64(paths_16674 -\n                                         sext_i32_i64(phys_tid_19757),\n                                         num_threads_20411));\n    \n    int64_t x_19758;\n    int64_t y_19759;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_20421 = 0;\n    }\n    for (int64_t i_20426 = 0; i_20426 < chunk_sizze_20422; i_20426++) {\n        gtid_19756 = sext_i32_i64(phys_tid_19757) + num_threads_20411 * i_20426;\n        // apply map function\n        {\n            int64_t num_segments_19762;\n            \n            if (cond_16737) {\n                int64_t i_19763 = sub64(res_16723, 1);\n                bool x_19764 = sle64(0, i_19763);\n                bool y_19765 = slt64(i_19763, res_16723);\n                bool bounds_check_19766 = x_19764 && y_19765;\n                bool index_certs_19767;\n                \n                if (!bounds_check_19766) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 9) ==\n                     ",
                   "       -1) {\n                            global_failure_args[0] = i_19763;\n                            global_failure_args[1] = res_16723;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int64_t res_19768 = ((__global int64_t *) mem_19521)[i_19763 *\n                                                                     paths_16674 +\n                                                                     gtid_19756];\n                \n                num_segments_19762 = res_19768;\n            } else {\n                num_segments_19762 = 0;\n            }\n            \n            int64_t bytes_19769 = 4 * num_segments_19762;\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_19758 = x_acc_20421;\n            }\n            // load new values\n            {\n                y_19759 = bytes_19769;\n            }\n            // apply reduction operator\n            {\n                int64_t zz_19760 = smax64(x_19758, y_19759);\n                \n                // store in accumulator\n                {\n                    x_acc_20421 = zz_19760;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_19758 = x_acc_20421;\n        ((__local int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413)] =\n            x_19758;\n    }\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_20427;\n    int32_t skip_waves_20428;\n    \n    skip_waves_20428 = 1;\n    \n    int64_t x_20423;\n    int64_t y_20424;\n    \n    offset_20427 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_20413, sext_i64_i32(segred_group_sizze_19753))) {\n            x_20423 = ((__lo",
                   "cal\n                        int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413 +\n                                                      offset_20427)];\n        }\n    }\n    offset_20427 = 1;\n    while (slt32(offset_20427, wave_sizze_20415)) {\n        if (slt32(local_tid_20413 + offset_20427,\n                  sext_i64_i32(segred_group_sizze_19753)) && ((local_tid_20413 -\n                                                               squot32(local_tid_20413,\n                                                                       wave_sizze_20415) *\n                                                               wave_sizze_20415) &\n                                                              (2 *\n                                                               offset_20427 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                y_20424 = ((volatile __local\n                            int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413 +\n                                                          offset_20427)];\n            }\n            // apply reduction operation\n            {\n                int64_t zz_20425 = smax64(x_20423, y_20424);\n                \n                x_20423 = zz_20425;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413)] =\n                    x_20423;\n            }\n        }\n        offset_20427 *= 2;\n    }\n    while (slt32(skip_waves_20428,\n                 squot32(sext_i64_i32(segred_group_sizze_19753) +\n                         wave_sizze_20415 - 1, wave_sizze_20415))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_20427 = skip_waves_20428 * wave_sizze_20415;\n        if (slt32(local_tid_20413 + offset_20427,\n                  sext_i64_i32(segred_group_sizze_19753)) && ((local_tid_20413 -\n                             ",
                   "                                  squot32(local_tid_20413,\n                                                                       wave_sizze_20415) *\n                                                               wave_sizze_20415) ==\n                                                              0 &&\n                                                              (squot32(local_tid_20413,\n                                                                       wave_sizze_20415) &\n                                                               (2 *\n                                                                skip_waves_20428 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                y_20424 = ((__local\n                            int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413 +\n                                                          offset_20427)];\n            }\n            // apply reduction operation\n            {\n                int64_t zz_20425 = smax64(x_20423, y_20424);\n                \n                x_20423 = zz_20425;\n            }\n            // write result of operation\n            {\n                ((__local\n                  int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413)] =\n                    x_20423;\n            }\n        }\n        skip_waves_20428 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_20413) == 0) {\n            x_acc_20421 = x_20423;\n        }\n    }\n    \n    int32_t old_counter_20429;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_20413 == 0) {\n            ((__global\n              int64_t *) group_res_arr_mem_20409)[sext_i32_i64(group_tid_20414) *\n                                                  segred_group_sizze_19753] =\n                x_acc_20421;\n            mem_fence_global();\n           ",
                   " old_counter_20429 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20407)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_20417)[0] = old_counter_20429 ==\n                segred_num_groups_19751 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_20430;\n    \n    is_last_group_20430 = ((__local bool *) sync_arr_mem_20417)[0];\n    if (is_last_group_20430) {\n        if (local_tid_20413 == 0) {\n            old_counter_20429 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20407)[0],\n                                                      (int) (0 -\n                                                             segred_num_groups_19751));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_20431 = sdiv_up64(segred_num_groups_19751,\n                                                      segred_group_sizze_19753);\n            \n            x_19758 = 0;\n            for (int64_t i_20432 = 0; i_20432 < read_per_thread_20431;\n                 i_20432++) {\n                int64_t group_res_id_20433 = sext_i32_i64(local_tid_20413) *\n                        read_per_thread_20431 + i_20432;\n                int64_t index_of_group_res_20434 = group_res_id_20433;\n                \n                if (slt64(group_res_id_20433, segred_num_groups_19751)) {\n                    y_19759 = ((__global\n                                int64_t *) group_res_arr_mem_20409)[index_of_group_res_20434 *\n                                                                    segred_group_sizze_19753];\n                    \n                    int64_t zz_19760;\n                    \n                    zz_19760 = smax64(x_19758, y_19759);\n                    x_19758 = zz_19760;\n                }\n       ",
                   "     }\n        }\n        ((__local int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413)] =\n            x_19758;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_20435;\n            int32_t skip_waves_20436;\n            \n            skip_waves_20436 = 1;\n            \n            int64_t x_20423;\n            int64_t y_20424;\n            \n            offset_20435 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_20413,\n                          sext_i64_i32(segred_group_sizze_19753))) {\n                    x_20423 = ((__local\n                                int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413 +\n                                                              offset_20435)];\n                }\n            }\n            offset_20435 = 1;\n            while (slt32(offset_20435, wave_sizze_20415)) {\n                if (slt32(local_tid_20413 + offset_20435,\n                          sext_i64_i32(segred_group_sizze_19753)) &&\n                    ((local_tid_20413 - squot32(local_tid_20413,\n                                                wave_sizze_20415) *\n                      wave_sizze_20415) & (2 * offset_20435 - 1)) == 0) {\n                    // read array element\n                    {\n                        y_20424 = ((volatile __local\n                                    int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413 +\n                                                                  offset_20435)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zz_20425 = smax64(x_20423, y_20424);\n                        \n                        x_20423 = zz_20425;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          int64_t *) red_a",
                   "rr_mem_20419)[sext_i32_i64(local_tid_20413)] =\n                            x_20423;\n                    }\n                }\n                offset_20435 *= 2;\n            }\n            while (slt32(skip_waves_20436,\n                         squot32(sext_i64_i32(segred_group_sizze_19753) +\n                                 wave_sizze_20415 - 1, wave_sizze_20415))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_20435 = skip_waves_20436 * wave_sizze_20415;\n                if (slt32(local_tid_20413 + offset_20435,\n                          sext_i64_i32(segred_group_sizze_19753)) &&\n                    ((local_tid_20413 - squot32(local_tid_20413,\n                                                wave_sizze_20415) *\n                      wave_sizze_20415) == 0 && (squot32(local_tid_20413,\n                                                         wave_sizze_20415) &\n                                                 (2 * skip_waves_20436 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        y_20424 = ((__local\n                                    int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413 +\n                                                                  offset_20435)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zz_20425 = smax64(x_20423, y_20424);\n                        \n                        x_20423 = zz_20425;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          int64_t *) red_arr_mem_20419)[sext_i32_i64(local_tid_20413)] =\n                            x_20423;\n                    }\n                }\n                skip_waves_20436 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_20413 == 0) {\n                    ((_",
                   "_global int64_t *) mem_19775)[0] = x_20423;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_num_groups_19751\n    #undef segred_group_sizze_19753\n}\n__kernel void mainzisegred_small_18977(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *red_arr_mem_20502_backing_aligned_0,\n                                       int64_t paths_16674, int64_t steps_16675,\n                                       int64_t num_groups_19070, __global\n                                       unsigned char *mem_19562, __global\n                                       unsigned char *mem_19565,\n                                       int64_t segment_sizze_nonzzero_20495)\n{\n    #define segred_group_sizze_19069 (mainzisegred_group_sizze_18971)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_20502_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_20502_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20497;\n    int32_t local_tid_20498;\n    int64_t group_sizze_20501;\n    int32_t wave_sizze_20500;\n    int32_t group_tid_20499;\n    \n    global_tid_20497 = get_global_id(0);\n    local_tid_20498 = get_local_id(0);\n    group_sizze_20501 = get_local_size(0);\n    wave_sizze_20500 = LOCKSTEP_WIDTH;\n    group_tid_20499 = get_group_id(0);\n    \n    int32_t phys_tid_18977;\n    \n    phys_tid_18977 = global_tid_20497;\n    \n    __local char *red_arr_mem_20502;\n    \n    red_arr_mem_20502 = (__local char *) red_arr_mem_20502_backing_0;\n    \n    int32_t phys_group_id_20504;\n    \n    phys_group_id_20504 = get_group_id(0);\n    for (int32_t i_20505 = 0; i_20505 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(steps_16675,\n                                          squot64(segred_group_sizze_19069,\n               ",
                   "                                   segment_sizze_nonzzero_20495))) -\n                   phys_group_id_20504, sext_i64_i32(num_groups_19070));\n         i_20505++) {\n        int32_t virt_group_id_20506 = phys_group_id_20504 + i_20505 *\n                sext_i64_i32(num_groups_19070);\n        int64_t gtid_18968 = squot64(sext_i32_i64(local_tid_20498),\n                                     segment_sizze_nonzzero_20495) +\n                sext_i32_i64(virt_group_id_20506) *\n                squot64(segred_group_sizze_19069, segment_sizze_nonzzero_20495);\n        int64_t gtid_18976 = srem64(sext_i32_i64(local_tid_20498), paths_16674);\n        \n        // apply map function if in bounds\n        {\n            if (slt64(0, paths_16674) && (slt64(gtid_18968, steps_16675) &&\n                                          slt64(sext_i32_i64(local_tid_20498),\n                                                paths_16674 *\n                                                squot64(segred_group_sizze_19069,\n                                                        segment_sizze_nonzzero_20495)))) {\n                float x_19077 = ((__global float *) mem_19562)[gtid_18968 *\n                                                               paths_16674 +\n                                                               gtid_18976];\n                \n                // save map-out results\n                { }\n                // save results to be reduced\n                {\n                    ((__local\n                      float *) red_arr_mem_20502)[sext_i32_i64(local_tid_20498)] =\n                        x_19077;\n                }\n            } else {\n                ((__local\n                  float *) red_arr_mem_20502)[sext_i32_i64(local_tid_20498)] =\n                    0.0F;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64(0, paths_16674)) {\n            // perform segmented scan to imitate reduction\n            {\n                float x_19073;\n                float x_19",
                   "074;\n                float x_20507;\n                float x_20508;\n                bool ltid_in_bounds_20510;\n                \n                ltid_in_bounds_20510 = slt64(sext_i32_i64(local_tid_20498),\n                                             paths_16674 *\n                                             squot64(segred_group_sizze_19069,\n                                                     segment_sizze_nonzzero_20495));\n                \n                int32_t skip_threads_20511;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_20510) {\n                        x_19074 = ((volatile __local\n                                    float *) red_arr_mem_20502)[sext_i32_i64(local_tid_20498)];\n                        if ((local_tid_20498 - squot32(local_tid_20498, 32) *\n                             32) == 0) {\n                            x_19073 = x_19074;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_20511 = 1;\n                    while (slt32(skip_threads_20511, 32)) {\n                        if (sle32(skip_threads_20511, local_tid_20498 -\n                                  squot32(local_tid_20498, 32) * 32) &&\n                            ltid_in_bounds_20510) {\n                            // read operands\n                            {\n                                x_19073 = ((volatile __local\n                                            float *) red_arr_mem_20502)[sext_i32_i64(local_tid_20498) -\n                                                                        sext_i32_i64(skip_threads_20511)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_20512 =\n                                     slt64(srem64(sext_i32_i64(local_tid_20498),\n                            ",
                   "                      paths_16674),\n                                           sext_i32_i64(local_tid_20498) -\n                                           sext_i32_i64(local_tid_20498 -\n                                           skip_threads_20511));\n                                \n                                if (inactive_20512) {\n                                    x_19073 = x_19074;\n                                }\n                                if (!inactive_20512) {\n                                    float res_19075 = x_19073 + x_19074;\n                                    \n                                    x_19073 = res_19075;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_20500, skip_threads_20511)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_20511, local_tid_20498 -\n                                  squot32(local_tid_20498, 32) * 32) &&\n                            ltid_in_bounds_20510) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_20502)[sext_i32_i64(local_tid_20498)] =\n                                    x_19073;\n                                x_19074 = x_19073;\n                            }\n                        }\n                        if (sle32(wave_sizze_20500, skip_threads_20511)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_20511 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_20498 - squot32(local_tid_20498, 32) * 32) ==\n                        31 && ltid_in_bounds_20510) {\n            ",
                   "            ((volatile __local\n                          float *) red_arr_mem_20502)[sext_i32_i64(squot32(local_tid_20498,\n                                                                           32))] =\n                            x_19073;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_20513;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_20498, 32) == 0 &&\n                            ltid_in_bounds_20510) {\n                            x_20508 = ((volatile __local\n                                        float *) red_arr_mem_20502)[sext_i32_i64(local_tid_20498)];\n                            if ((local_tid_20498 - squot32(local_tid_20498,\n                                                           32) * 32) == 0) {\n                                x_20507 = x_20508;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_20513 = 1;\n                        while (slt32(skip_threads_20513, 32)) {\n                            if (sle32(skip_threads_20513, local_tid_20498 -\n                                      squot32(local_tid_20498, 32) * 32) &&\n                                (squot32(local_tid_20498, 32) == 0 &&\n                                 ltid_in_bounds_20510)) {\n                                // read operands\n                                {\n                                    x_20507 = ((volatile __local\n                                                float *) red_arr_mem_20502)[sext_i32_i64(local_tid_20498) -\n                                                                            sext_i32_i64(skip_threads_20513)];\n       ",
                   "                         }\n                                // perform operation\n                                {\n                                    bool inactive_20514 =\n                                         slt64(srem64(sext_i32_i64(local_tid_20498 *\n                                                      32 + 32 - 1),\n                                                      paths_16674),\n                                               sext_i32_i64(local_tid_20498 *\n                                               32 + 32 - 1) -\n                                               sext_i32_i64((local_tid_20498 -\n                                                             skip_threads_20513) *\n                                               32 + 32 - 1));\n                                    \n                                    if (inactive_20514) {\n                                        x_20507 = x_20508;\n                                    }\n                                    if (!inactive_20514) {\n                                        float res_20509 = x_20507 + x_20508;\n                                        \n                                        x_20507 = res_20509;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_20500, skip_threads_20513)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_20513, local_tid_20498 -\n                                      squot32(local_tid_20498, 32) * 32) &&\n                                (squot32(local_tid_20498, 32) == 0 &&\n                                 ltid_in_bounds_20510)) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      float *) red_arr_mem_20502)[sext_i32_i64(local_tid_20498)] =\n                        ",
                   "                x_20507;\n                                    x_20508 = x_20507;\n                                }\n                            }\n                            if (sle32(wave_sizze_20500, skip_threads_20513)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_20513 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_20498, 32) == 0 ||\n                          !ltid_in_bounds_20510)) {\n                        // read operands\n                        {\n                            x_19074 = x_19073;\n                            x_19073 = ((__local\n                                        float *) red_arr_mem_20502)[sext_i32_i64(squot32(local_tid_20498,\n                                                                                         32)) -\n                                                                    1];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_20515 =\n                                 slt64(srem64(sext_i32_i64(local_tid_20498),\n                                              paths_16674),\n                                       sext_i32_i64(local_tid_20498) -\n                                       sext_i32_i64(squot32(local_tid_20498,\n                                                            32) * 32 - 1));\n                            \n                            if (inactive_20515) {\n                                x_19073 = x_19074;\n                            }\n                            if (!inactive_20515) {\n                                float res_19075 = x_19073 + x_19074;\n                                \n                                x_19073 = res_19075;\n                ",
                   "            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              float *) red_arr_mem_20502)[sext_i32_i64(local_tid_20498)] =\n                                x_19073;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_20498, 32) == 0) {\n                        ((__local\n                          float *) red_arr_mem_20502)[sext_i32_i64(local_tid_20498)] =\n                            x_19074;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_group_id_20506) *\n                      squot64(segred_group_sizze_19069,\n                              segment_sizze_nonzzero_20495) +\n                      sext_i32_i64(local_tid_20498), steps_16675) &&\n                slt64(sext_i32_i64(local_tid_20498),\n                      squot64(segred_group_sizze_19069,\n                              segment_sizze_nonzzero_20495))) {\n                ((__global\n                  float *) mem_19565)[sext_i32_i64(virt_group_id_20506) *\n                                      squot64(segred_group_sizze_19069,\n                                              segment_sizze_nonzzero_20495) +\n                                      sext_i32_i64(local_tid_20498)] = ((__local\n                                                                         float *) red_arr_mem_20502)[(sext_i32_i64(local_tid_20498) +\n                                                                                                      1) *\n                                                                                                     segment_sizze_nonzze",
                   "ro_20495 -\n                                                                                                     1];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_19069\n}\n__kernel void mainzisegred_small_20069(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *red_arr_mem_20077_backing_aligned_0,\n                                       int64_t paths_16674, int64_t res_16723,\n                                       int64_t num_groups_18547, __global\n                                       unsigned char *mem_19277,\n                                       int32_t num_subhistos_19971, __global\n                                       unsigned char *res_r_subhistos_mem_19972,\n                                       int64_t segment_sizze_nonzzero_20070)\n{\n    #define seghist_group_sizze_18546 (mainziseghist_group_sizze_18208)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_20077_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_20077_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20072;\n    int32_t local_tid_20073;\n    int64_t group_sizze_20076;\n    int32_t wave_sizze_20075;\n    int32_t group_tid_20074;\n    \n    global_tid_20072 = get_global_id(0);\n    local_tid_20073 = get_local_id(0);\n    group_sizze_20076 = get_local_size(0);\n    wave_sizze_20075 = LOCKSTEP_WIDTH;\n    group_tid_20074 = get_group_id(0);\n    \n    int32_t flat_gtid_20069;\n    \n    flat_gtid_20069 = global_tid_20072;\n    \n    __local char *red_arr_mem_20077;\n    \n    red_arr_mem_20077 = (__local char *) red_arr_mem_20077_backing_0;\n    \n    int32_t phys_group_id_20079;\n    \n    phys_group_id_20079 =",
                   " get_group_id(0);\n    for (int32_t i_20080 = 0; i_20080 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(paths_16674 * res_16723,\n                                          squot64(seghist_group_sizze_18546,\n                                                  segment_sizze_nonzzero_20070))) -\n                   phys_group_id_20079, sext_i64_i32(num_groups_18547));\n         i_20080++) {\n        int32_t virt_group_id_20081 = phys_group_id_20079 + i_20080 *\n                sext_i64_i32(num_groups_18547);\n        int64_t gtid_18205 = squot64(squot64(sext_i32_i64(local_tid_20073),\n                                             segment_sizze_nonzzero_20070) +\n                                     sext_i32_i64(virt_group_id_20081) *\n                                     squot64(seghist_group_sizze_18546,\n                                             segment_sizze_nonzzero_20070),\n                                     res_16723);\n        int64_t bucket_id_20067 = squot64(sext_i32_i64(local_tid_20073),\n                                          segment_sizze_nonzzero_20070) +\n                sext_i32_i64(virt_group_id_20081) *\n                squot64(seghist_group_sizze_18546,\n                        segment_sizze_nonzzero_20070) -\n                squot64(squot64(sext_i32_i64(local_tid_20073),\n                                segment_sizze_nonzzero_20070) +\n                        sext_i32_i64(virt_group_id_20081) *\n                        squot64(seghist_group_sizze_18546,\n                                segment_sizze_nonzzero_20070), res_16723) *\n                res_16723;\n        int64_t subhistogram_id_20068 = srem64(sext_i32_i64(local_tid_20073),\n                                               num_subhistos_19971);\n        \n        // apply map function if in bounds\n        {\n            if (slt64(0, num_subhistos_19971) && ((slt64(gtid_18205,\n                                                         paths_16674) &&\n                                                   slt64(bucket_id_20067",
                   ",\n                                                         res_16723)) &&\n                                                  slt64(sext_i32_i64(local_tid_20073),\n                                                        num_subhistos_19971 *\n                                                        squot64(seghist_group_sizze_18546,\n                                                                segment_sizze_nonzzero_20070)))) {\n                // save results to be reduced\n                {\n                    ((__local\n                      int64_t *) red_arr_mem_20077)[sext_i32_i64(local_tid_20073)] =\n                        ((__global\n                          int64_t *) res_r_subhistos_mem_19972)[gtid_18205 *\n                                                                (res_16723 *\n                                                                 num_subhistos_19971) +\n                                                                subhistogram_id_20068 *\n                                                                res_16723 +\n                                                                bucket_id_20067];\n                }\n            } else {\n                ((__local\n                  int64_t *) red_arr_mem_20077)[sext_i32_i64(local_tid_20073)] =\n                    0;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64(0, num_subhistos_19971)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t x_18550;\n                int64_t x_18551;\n                int64_t x_20082;\n                int64_t x_20083;\n                bool ltid_in_bounds_20085;\n                \n                ltid_in_bounds_20085 = slt64(sext_i32_i64(local_tid_20073),\n                                             num_subhistos_19971 *\n                                             squot64(seghist_group_sizze_18546,\n                                                     segment_sizze_nonzzero_20070));\n                \n   ",
                   "             int32_t skip_threads_20086;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_20085) {\n                        x_18551 = ((volatile __local\n                                    int64_t *) red_arr_mem_20077)[sext_i32_i64(local_tid_20073)];\n                        if ((local_tid_20073 - squot32(local_tid_20073, 32) *\n                             32) == 0) {\n                            x_18550 = x_18551;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_20086 = 1;\n                    while (slt32(skip_threads_20086, 32)) {\n                        if (sle32(skip_threads_20086, local_tid_20073 -\n                                  squot32(local_tid_20073, 32) * 32) &&\n                            ltid_in_bounds_20085) {\n                            // read operands\n                            {\n                                x_18550 = ((volatile __local\n                                            int64_t *) red_arr_mem_20077)[sext_i32_i64(local_tid_20073) -\n                                                                          sext_i32_i64(skip_threads_20086)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_20087 =\n                                     slt64(srem64(sext_i32_i64(local_tid_20073),\n                                                  num_subhistos_19971),\n                                           sext_i32_i64(local_tid_20073) -\n                                           sext_i32_i64(local_tid_20073 -\n                                           skip_threads_20086));\n                                \n                                if (inactive_20087) {\n                                    x_18550 = x_18551;\n                                }\n      ",
                   "                          if (!inactive_20087) {\n                                    int64_t res_18552 = smax64(x_18550,\n                                                               x_18551);\n                                    \n                                    x_18550 = res_18552;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_20075, skip_threads_20086)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_20086, local_tid_20073 -\n                                  squot32(local_tid_20073, 32) * 32) &&\n                            ltid_in_bounds_20085) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) red_arr_mem_20077)[sext_i32_i64(local_tid_20073)] =\n                                    x_18550;\n                                x_18551 = x_18550;\n                            }\n                        }\n                        if (sle32(wave_sizze_20075, skip_threads_20086)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_20086 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_20073 - squot32(local_tid_20073, 32) * 32) ==\n                        31 && ltid_in_bounds_20085) {\n                        ((volatile __local\n                          int64_t *) red_arr_mem_20077)[sext_i32_i64(squot32(local_tid_20073,\n                                                                             32))] =\n                            x_18550;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan t",
                   "he first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_20088;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_20073, 32) == 0 &&\n                            ltid_in_bounds_20085) {\n                            x_20083 = ((volatile __local\n                                        int64_t *) red_arr_mem_20077)[sext_i32_i64(local_tid_20073)];\n                            if ((local_tid_20073 - squot32(local_tid_20073,\n                                                           32) * 32) == 0) {\n                                x_20082 = x_20083;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_20088 = 1;\n                        while (slt32(skip_threads_20088, 32)) {\n                            if (sle32(skip_threads_20088, local_tid_20073 -\n                                      squot32(local_tid_20073, 32) * 32) &&\n                                (squot32(local_tid_20073, 32) == 0 &&\n                                 ltid_in_bounds_20085)) {\n                                // read operands\n                                {\n                                    x_20082 = ((volatile __local\n                                                int64_t *) red_arr_mem_20077)[sext_i32_i64(local_tid_20073) -\n                                                                              sext_i32_i64(skip_threads_20088)];\n                                }\n                                // perform operation\n                                {\n                                    bool inactive_20089 =\n                                         slt64(srem64(sext_i32_i64(local_tid_20073 *\n                                                      32 + 32 - 1),\n                       ",
                   "                               num_subhistos_19971),\n                                               sext_i32_i64(local_tid_20073 *\n                                               32 + 32 - 1) -\n                                               sext_i32_i64((local_tid_20073 -\n                                                             skip_threads_20088) *\n                                               32 + 32 - 1));\n                                    \n                                    if (inactive_20089) {\n                                        x_20082 = x_20083;\n                                    }\n                                    if (!inactive_20089) {\n                                        int64_t res_20084 = smax64(x_20082,\n                                                                   x_20083);\n                                        \n                                        x_20082 = res_20084;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_20075, skip_threads_20088)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_20088, local_tid_20073 -\n                                      squot32(local_tid_20073, 32) * 32) &&\n                                (squot32(local_tid_20073, 32) == 0 &&\n                                 ltid_in_bounds_20085)) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      int64_t *) red_arr_mem_20077)[sext_i32_i64(local_tid_20073)] =\n                                        x_20082;\n                                    x_20083 = x_20082;\n                                }\n                            }\n                            if (sle32(wave_sizze_20075, skip_threads_20088)) {\n                                barrier",
                   "(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_20088 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_20073, 32) == 0 ||\n                          !ltid_in_bounds_20085)) {\n                        // read operands\n                        {\n                            x_18551 = x_18550;\n                            x_18550 = ((__local\n                                        int64_t *) red_arr_mem_20077)[sext_i32_i64(squot32(local_tid_20073,\n                                                                                           32)) -\n                                                                      1];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_20090 =\n                                 slt64(srem64(sext_i32_i64(local_tid_20073),\n                                              num_subhistos_19971),\n                                       sext_i32_i64(local_tid_20073) -\n                                       sext_i32_i64(squot32(local_tid_20073,\n                                                            32) * 32 - 1));\n                            \n                            if (inactive_20090) {\n                                x_18550 = x_18551;\n                            }\n                            if (!inactive_20090) {\n                                int64_t res_18552 = smax64(x_18550, x_18551);\n                                \n                                x_18550 = res_18552;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              int64_t *) red_arr_mem_20077)[sext_i32_i64(local_tid_20073)",
                   "] =\n                                x_18550;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_20073, 32) == 0) {\n                        ((__local\n                          int64_t *) red_arr_mem_20077)[sext_i32_i64(local_tid_20073)] =\n                            x_18551;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_group_id_20081) *\n                      squot64(seghist_group_sizze_18546,\n                              segment_sizze_nonzzero_20070) +\n                      sext_i32_i64(local_tid_20073), paths_16674 * res_16723) &&\n                slt64(sext_i32_i64(local_tid_20073),\n                      squot64(seghist_group_sizze_18546,\n                              segment_sizze_nonzzero_20070))) {\n                ((__global\n                  int64_t *) mem_19277)[squot64(sext_i32_i64(virt_group_id_20081) *\n                                                squot64(seghist_group_sizze_18546,\n                                                        segment_sizze_nonzzero_20070) +\n                                                sext_i32_i64(local_tid_20073),\n                                                res_16723) * res_16723 +\n                                        (sext_i32_i64(virt_group_id_20081) *\n                                         squot64(seghist_group_sizze_18546,\n                                                 segment_sizze_nonzzero_20070) +\n                                         sext_i32_i64(local_tid_20073) -\n                                         squot64(sext_i32_i64(virt_group_id_20081) *\n                                                 squot64(seghist_group_sizze_18546,\n     ",
                   "                                                    segment_sizze_nonzzero_20070) +\n                                                 sext_i32_i64(local_tid_20073),\n                                                 res_16723) * res_16723)] =\n                    ((__local\n                      int64_t *) red_arr_mem_20077)[(sext_i32_i64(local_tid_20073) +\n                                                     1) *\n                                                    segment_sizze_nonzzero_20070 -\n                                                    1];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef seghist_group_sizze_18546\n}\n",
                   NULL};
static const char *size_names[] = {"builtin#replicate_i64.group_size_19879",
                                   "main.L2_size_20041",
                                   "main.group_size_19998",
                                   "main.group_size_20052",
                                   "main.group_size_20405",
                                   "main.seghist_group_size_18208",
                                   "main.seghist_num_groups_18210",
                                   "main.segmap_group_size_17117",
                                   "main.segmap_group_size_17867",
                                   "main.segmap_group_size_17896",
                                   "main.segmap_group_size_18255",
                                   "main.segmap_group_size_18354",
                                   "main.segmap_group_size_18417",
                                   "main.segmap_group_size_18880",
                                   "main.segmap_group_size_18944",
                                   "main.segmap_num_groups_17119",
                                   "main.segmap_num_groups_17898",
                                   "main.segmap_num_groups_18257",
                                   "main.segred_group_size_17047",
                                   "main.segred_group_size_18826",
                                   "main.segred_group_size_18971",
                                   "main.segred_group_size_19023",
                                   "main.segred_group_size_19601",
                                   "main.segred_group_size_19752",
                                   "main.segred_num_groups_17049",
                                   "main.segred_num_groups_18828",
                                   "main.segred_num_groups_18973",
                                   "main.segred_num_groups_19025",
                                   "main.segred_num_groups_19599",
                                   "main.segred_num_groups_19750",
                                   "main.segscan_group_size_17039",
                                   "main.segscan_group_size_17928",
                                   "main.segscan_group_size_18036",
                                   "main.segscan_group_size_18144",
                                   "main.segscan_group_size_18187",
                                   "main.segscan_num_groups_17041",
                                   "main.segscan_num_groups_17930",
                                   "main.segscan_num_groups_18038",
                                   "main.segscan_num_groups_18146",
                                   "main.segscan_num_groups_18189",
                                   "main.suff_outer_par_0",
                                   "main.suff_outer_par_8",
                                   "main.suff_outer_redomap_7"};
static const char *size_vars[] = {"builtinzhreplicate_i64zigroup_sizze_19879",
                                  "mainziL2_sizze_20041",
                                  "mainzigroup_sizze_19998",
                                  "mainzigroup_sizze_20052",
                                  "mainzigroup_sizze_20405",
                                  "mainziseghist_group_sizze_18208",
                                  "mainziseghist_num_groups_18210",
                                  "mainzisegmap_group_sizze_17117",
                                  "mainzisegmap_group_sizze_17867",
                                  "mainzisegmap_group_sizze_17896",
                                  "mainzisegmap_group_sizze_18255",
                                  "mainzisegmap_group_sizze_18354",
                                  "mainzisegmap_group_sizze_18417",
                                  "mainzisegmap_group_sizze_18880",
                                  "mainzisegmap_group_sizze_18944",
                                  "mainzisegmap_num_groups_17119",
                                  "mainzisegmap_num_groups_17898",
                                  "mainzisegmap_num_groups_18257",
                                  "mainzisegred_group_sizze_17047",
                                  "mainzisegred_group_sizze_18826",
                                  "mainzisegred_group_sizze_18971",
                                  "mainzisegred_group_sizze_19023",
                                  "mainzisegred_group_sizze_19601",
                                  "mainzisegred_group_sizze_19752",
                                  "mainzisegred_num_groups_17049",
                                  "mainzisegred_num_groups_18828",
                                  "mainzisegred_num_groups_18973",
                                  "mainzisegred_num_groups_19025",
                                  "mainzisegred_num_groups_19599",
                                  "mainzisegred_num_groups_19750",
                                  "mainzisegscan_group_sizze_17039",
                                  "mainzisegscan_group_sizze_17928",
                                  "mainzisegscan_group_sizze_18036",
                                  "mainzisegscan_group_sizze_18144",
                                  "mainzisegscan_group_sizze_18187",
                                  "mainzisegscan_num_groups_17041",
                                  "mainzisegscan_num_groups_17930",
                                  "mainzisegscan_num_groups_18038",
                                  "mainzisegscan_num_groups_18146",
                                  "mainzisegscan_num_groups_18189",
                                  "mainzisuff_outer_par_0",
                                  "mainzisuff_outer_par_8",
                                  "mainzisuff_outer_redomap_7"};
static const char *size_classes[] = {"group_size", "L2_for_histogram",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "num_groups", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "num_groups", "num_groups",
                                     "num_groups", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "num_groups", "num_groups",
                                     "num_groups", "num_groups", "num_groups",
                                     "num_groups", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "num_groups", "num_groups", "num_groups",
                                     "num_groups", "num_groups", "threshold ()",
                                     "threshold (!main.suff_outer_redomap_7)",
                                     "threshold ()"};
int futhark_get_num_sizes(void)
{
    return 43;
}
const char *futhark_get_size_name(int i)
{
    return size_names[i];
}
const char *futhark_get_size_class(int i)
{
    return size_classes[i];
}
struct sizes {
    size_t builtinzhreplicate_i64zigroup_sizze_19879;
    size_t mainziL2_sizze_20041;
    size_t mainzigroup_sizze_19998;
    size_t mainzigroup_sizze_20052;
    size_t mainzigroup_sizze_20405;
    size_t mainziseghist_group_sizze_18208;
    size_t mainziseghist_num_groups_18210;
    size_t mainzisegmap_group_sizze_17117;
    size_t mainzisegmap_group_sizze_17867;
    size_t mainzisegmap_group_sizze_17896;
    size_t mainzisegmap_group_sizze_18255;
    size_t mainzisegmap_group_sizze_18354;
    size_t mainzisegmap_group_sizze_18417;
    size_t mainzisegmap_group_sizze_18880;
    size_t mainzisegmap_group_sizze_18944;
    size_t mainzisegmap_num_groups_17119;
    size_t mainzisegmap_num_groups_17898;
    size_t mainzisegmap_num_groups_18257;
    size_t mainzisegred_group_sizze_17047;
    size_t mainzisegred_group_sizze_18826;
    size_t mainzisegred_group_sizze_18971;
    size_t mainzisegred_group_sizze_19023;
    size_t mainzisegred_group_sizze_19601;
    size_t mainzisegred_group_sizze_19752;
    size_t mainzisegred_num_groups_17049;
    size_t mainzisegred_num_groups_18828;
    size_t mainzisegred_num_groups_18973;
    size_t mainzisegred_num_groups_19025;
    size_t mainzisegred_num_groups_19599;
    size_t mainzisegred_num_groups_19750;
    size_t mainzisegscan_group_sizze_17039;
    size_t mainzisegscan_group_sizze_17928;
    size_t mainzisegscan_group_sizze_18036;
    size_t mainzisegscan_group_sizze_18144;
    size_t mainzisegscan_group_sizze_18187;
    size_t mainzisegscan_num_groups_17041;
    size_t mainzisegscan_num_groups_17930;
    size_t mainzisegscan_num_groups_18038;
    size_t mainzisegscan_num_groups_18146;
    size_t mainzisegscan_num_groups_18189;
    size_t mainzisuff_outer_par_0;
    size_t mainzisuff_outer_par_8;
    size_t mainzisuff_outer_redomap_7;
} ;
struct futhark_context_config {
    struct opencl_config opencl;
    size_t sizes[43];
    int num_build_opts;
    const char **build_opts;
} ;
struct futhark_context_config *futhark_context_config_new(void)
{
    struct futhark_context_config *cfg =
                                  (struct futhark_context_config *) malloc(sizeof(struct futhark_context_config));
    
    if (cfg == NULL)
        return NULL;
    cfg->num_build_opts = 0;
    cfg->build_opts = (const char **) malloc(sizeof(const char *));
    cfg->build_opts[0] = NULL;
    cfg->sizes[0] = 0;
    cfg->sizes[1] = 4194304;
    cfg->sizes[2] = 0;
    cfg->sizes[3] = 0;
    cfg->sizes[4] = 0;
    cfg->sizes[5] = 0;
    cfg->sizes[6] = 0;
    cfg->sizes[7] = 0;
    cfg->sizes[8] = 0;
    cfg->sizes[9] = 0;
    cfg->sizes[10] = 0;
    cfg->sizes[11] = 0;
    cfg->sizes[12] = 0;
    cfg->sizes[13] = 0;
    cfg->sizes[14] = 0;
    cfg->sizes[15] = 0;
    cfg->sizes[16] = 0;
    cfg->sizes[17] = 0;
    cfg->sizes[18] = 0;
    cfg->sizes[19] = 0;
    cfg->sizes[20] = 0;
    cfg->sizes[21] = 0;
    cfg->sizes[22] = 0;
    cfg->sizes[23] = 0;
    cfg->sizes[24] = 0;
    cfg->sizes[25] = 0;
    cfg->sizes[26] = 0;
    cfg->sizes[27] = 0;
    cfg->sizes[28] = 0;
    cfg->sizes[29] = 0;
    cfg->sizes[30] = 0;
    cfg->sizes[31] = 0;
    cfg->sizes[32] = 0;
    cfg->sizes[33] = 0;
    cfg->sizes[34] = 0;
    cfg->sizes[35] = 0;
    cfg->sizes[36] = 0;
    cfg->sizes[37] = 0;
    cfg->sizes[38] = 0;
    cfg->sizes[39] = 0;
    cfg->sizes[40] = 0;
    cfg->sizes[41] = 0;
    cfg->sizes[42] = 0;
    opencl_config_init(&cfg->opencl, 43, size_names, size_vars, cfg->sizes,
                       size_classes);
    return cfg;
}
void futhark_context_config_free(struct futhark_context_config *cfg)
{
    free(cfg->build_opts);
    free(cfg);
}
void futhark_context_config_add_build_option(struct futhark_context_config *cfg,
                                             const char *opt)
{
    cfg->build_opts[cfg->num_build_opts] = opt;
    cfg->num_build_opts++;
    cfg->build_opts = (const char **) realloc(cfg->build_opts,
                                              (cfg->num_build_opts + 1) *
                                              sizeof(const char *));
    cfg->build_opts[cfg->num_build_opts] = NULL;
}
void futhark_context_config_set_debugging(struct futhark_context_config *cfg,
                                          int flag)
{
    cfg->opencl.profiling = cfg->opencl.logging = cfg->opencl.debugging = flag;
}
void futhark_context_config_set_profiling(struct futhark_context_config *cfg,
                                          int flag)
{
    cfg->opencl.profiling = flag;
}
void futhark_context_config_set_logging(struct futhark_context_config *cfg,
                                        int flag)
{
    cfg->opencl.logging = flag;
}
void futhark_context_config_set_device(struct futhark_context_config *cfg, const
                                       char *s)
{
    set_preferred_device(&cfg->opencl, s);
}
void futhark_context_config_set_platform(struct futhark_context_config *cfg,
                                         const char *s)
{
    set_preferred_platform(&cfg->opencl, s);
}
void futhark_context_config_select_device_interactively(struct futhark_context_config *cfg)
{
    select_device_interactively(&cfg->opencl);
}
void futhark_context_config_list_devices(struct futhark_context_config *cfg)
{
    list_devices(&cfg->opencl);
}
void futhark_context_config_dump_program_to(struct futhark_context_config *cfg,
                                            const char *path)
{
    cfg->opencl.dump_program_to = path;
}
void futhark_context_config_load_program_from(struct futhark_context_config *cfg,
                                              const char *path)
{
    cfg->opencl.load_program_from = path;
}
void futhark_context_config_dump_binary_to(struct futhark_context_config *cfg,
                                           const char *path)
{
    cfg->opencl.dump_binary_to = path;
}
void futhark_context_config_load_binary_from(struct futhark_context_config *cfg,
                                             const char *path)
{
    cfg->opencl.load_binary_from = path;
}
void futhark_context_config_set_default_group_size(struct futhark_context_config *cfg,
                                                   int size)
{
    cfg->opencl.default_group_size = size;
    cfg->opencl.default_group_size_changed = 1;
}
void futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg,
                                                   int num)
{
    cfg->opencl.default_num_groups = num;
}
void futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg,
                                                  int size)
{
    cfg->opencl.default_tile_size = size;
    cfg->opencl.default_tile_size_changed = 1;
}
void futhark_context_config_set_default_threshold(struct futhark_context_config *cfg,
                                                  int size)
{
    cfg->opencl.default_threshold = size;
}
int futhark_context_config_set_size(struct futhark_context_config *cfg, const
                                    char *size_name, size_t size_value)
{
    for (int i = 0; i < 43; i++) {
        if (strcmp(size_name, size_names[i]) == 0) {
            cfg->sizes[i] = size_value;
            return 0;
        }
    }
    if (strcmp(size_name, "default_group_size") == 0) {
        cfg->opencl.default_group_size = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_num_groups") == 0) {
        cfg->opencl.default_num_groups = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_threshold") == 0) {
        cfg->opencl.default_threshold = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_tile_size") == 0) {
        cfg->opencl.default_tile_size = size_value;
        return 0;
    }
    return 1;
}
struct futhark_context {
    int detail_memory;
    int debugging;
    int profiling;
    int profiling_paused;
    int logging;
    lock_t lock;
    char *error;
    int64_t peak_mem_usage_device;
    int64_t cur_mem_usage_device;
    int64_t peak_mem_usage_default;
    int64_t cur_mem_usage_default;
    struct {
        int dummy;
    } constants;
    struct memblock_device mainzicounter_mem_19840;
    struct memblock_device mainzicounter_mem_19887;
    struct memblock_device mainzihist_locks_mem_20054;
    struct memblock_device mainzicounter_mem_20098;
    struct memblock_device mainzicounter_mem_20407;
    struct memblock_device mainzicounter_mem_20458;
    struct memblock_device mainzicounter_mem_20523;
    struct memblock_device mainzicounter_mem_20561;
    int total_runs;
    long total_runtime;
    cl_kernel builtinzhreplicate_i64zireplicate_19876;
    cl_kernel gpu_map_transpose_f32;
    cl_kernel gpu_map_transpose_f32_low_height;
    cl_kernel gpu_map_transpose_f32_low_width;
    cl_kernel gpu_map_transpose_f32_small;
    cl_kernel gpu_map_transpose_i64;
    cl_kernel gpu_map_transpose_i64_low_height;
    cl_kernel gpu_map_transpose_i64_low_width;
    cl_kernel gpu_map_transpose_i64_small;
    cl_kernel mainzicopy_19995;
    cl_kernel mainzicopy_20049;
    cl_kernel mainzicopy_20402;
    cl_kernel mainziscan_stage1_17045;
    cl_kernel mainziscan_stage1_17934;
    cl_kernel mainziscan_stage1_18042;
    cl_kernel mainziscan_stage1_18150;
    cl_kernel mainziscan_stage1_18193;
    cl_kernel mainziscan_stage2_17045;
    cl_kernel mainziscan_stage2_17934;
    cl_kernel mainziscan_stage2_18042;
    cl_kernel mainziscan_stage2_18150;
    cl_kernel mainziscan_stage2_18193;
    cl_kernel mainziscan_stage3_17045;
    cl_kernel mainziscan_stage3_17934;
    cl_kernel mainziscan_stage3_18042;
    cl_kernel mainziscan_stage3_18150;
    cl_kernel mainziscan_stage3_18193;
    cl_kernel mainziseghist_global_18214;
    cl_kernel mainziseghist_local_18214;
    cl_kernel mainzisegmap_17115;
    cl_kernel mainzisegmap_17864;
    cl_kernel mainzisegmap_17894;
    cl_kernel mainzisegmap_18253;
    cl_kernel mainzisegmap_18351;
    cl_kernel mainzisegmap_18415;
    cl_kernel mainzisegmap_18878;
    cl_kernel mainzisegmap_18942;
    cl_kernel mainzisegred_large_18977;
    cl_kernel mainzisegred_large_20069;
    cl_kernel mainzisegred_nonseg_17056;
    cl_kernel mainzisegred_nonseg_18835;
    cl_kernel mainzisegred_nonseg_19031;
    cl_kernel mainzisegred_nonseg_19606;
    cl_kernel mainzisegred_nonseg_19757;
    cl_kernel mainzisegred_small_18977;
    cl_kernel mainzisegred_small_20069;
    int64_t copy_dev_to_dev_total_runtime;
    int copy_dev_to_dev_runs;
    int64_t copy_dev_to_host_total_runtime;
    int copy_dev_to_host_runs;
    int64_t copy_host_to_dev_total_runtime;
    int copy_host_to_dev_runs;
    int64_t copy_scalar_to_dev_total_runtime;
    int copy_scalar_to_dev_runs;
    int64_t copy_scalar_from_dev_total_runtime;
    int copy_scalar_from_dev_runs;
    int64_t builtinzhreplicate_i64zireplicate_19876_total_runtime;
    int builtinzhreplicate_i64zireplicate_19876_runs;
    int64_t gpu_map_transpose_f32_total_runtime;
    int gpu_map_transpose_f32_runs;
    int64_t gpu_map_transpose_f32_low_height_total_runtime;
    int gpu_map_transpose_f32_low_height_runs;
    int64_t gpu_map_transpose_f32_low_width_total_runtime;
    int gpu_map_transpose_f32_low_width_runs;
    int64_t gpu_map_transpose_f32_small_total_runtime;
    int gpu_map_transpose_f32_small_runs;
    int64_t gpu_map_transpose_i64_total_runtime;
    int gpu_map_transpose_i64_runs;
    int64_t gpu_map_transpose_i64_low_height_total_runtime;
    int gpu_map_transpose_i64_low_height_runs;
    int64_t gpu_map_transpose_i64_low_width_total_runtime;
    int gpu_map_transpose_i64_low_width_runs;
    int64_t gpu_map_transpose_i64_small_total_runtime;
    int gpu_map_transpose_i64_small_runs;
    int64_t mainzicopy_19995_total_runtime;
    int mainzicopy_19995_runs;
    int64_t mainzicopy_20049_total_runtime;
    int mainzicopy_20049_runs;
    int64_t mainzicopy_20402_total_runtime;
    int mainzicopy_20402_runs;
    int64_t mainziscan_stage1_17045_total_runtime;
    int mainziscan_stage1_17045_runs;
    int64_t mainziscan_stage1_17934_total_runtime;
    int mainziscan_stage1_17934_runs;
    int64_t mainziscan_stage1_18042_total_runtime;
    int mainziscan_stage1_18042_runs;
    int64_t mainziscan_stage1_18150_total_runtime;
    int mainziscan_stage1_18150_runs;
    int64_t mainziscan_stage1_18193_total_runtime;
    int mainziscan_stage1_18193_runs;
    int64_t mainziscan_stage2_17045_total_runtime;
    int mainziscan_stage2_17045_runs;
    int64_t mainziscan_stage2_17934_total_runtime;
    int mainziscan_stage2_17934_runs;
    int64_t mainziscan_stage2_18042_total_runtime;
    int mainziscan_stage2_18042_runs;
    int64_t mainziscan_stage2_18150_total_runtime;
    int mainziscan_stage2_18150_runs;
    int64_t mainziscan_stage2_18193_total_runtime;
    int mainziscan_stage2_18193_runs;
    int64_t mainziscan_stage3_17045_total_runtime;
    int mainziscan_stage3_17045_runs;
    int64_t mainziscan_stage3_17934_total_runtime;
    int mainziscan_stage3_17934_runs;
    int64_t mainziscan_stage3_18042_total_runtime;
    int mainziscan_stage3_18042_runs;
    int64_t mainziscan_stage3_18150_total_runtime;
    int mainziscan_stage3_18150_runs;
    int64_t mainziscan_stage3_18193_total_runtime;
    int mainziscan_stage3_18193_runs;
    int64_t mainziseghist_global_18214_total_runtime;
    int mainziseghist_global_18214_runs;
    int64_t mainziseghist_local_18214_total_runtime;
    int mainziseghist_local_18214_runs;
    int64_t mainzisegmap_17115_total_runtime;
    int mainzisegmap_17115_runs;
    int64_t mainzisegmap_17864_total_runtime;
    int mainzisegmap_17864_runs;
    int64_t mainzisegmap_17894_total_runtime;
    int mainzisegmap_17894_runs;
    int64_t mainzisegmap_18253_total_runtime;
    int mainzisegmap_18253_runs;
    int64_t mainzisegmap_18351_total_runtime;
    int mainzisegmap_18351_runs;
    int64_t mainzisegmap_18415_total_runtime;
    int mainzisegmap_18415_runs;
    int64_t mainzisegmap_18878_total_runtime;
    int mainzisegmap_18878_runs;
    int64_t mainzisegmap_18942_total_runtime;
    int mainzisegmap_18942_runs;
    int64_t mainzisegred_large_18977_total_runtime;
    int mainzisegred_large_18977_runs;
    int64_t mainzisegred_large_20069_total_runtime;
    int mainzisegred_large_20069_runs;
    int64_t mainzisegred_nonseg_17056_total_runtime;
    int mainzisegred_nonseg_17056_runs;
    int64_t mainzisegred_nonseg_18835_total_runtime;
    int mainzisegred_nonseg_18835_runs;
    int64_t mainzisegred_nonseg_19031_total_runtime;
    int mainzisegred_nonseg_19031_runs;
    int64_t mainzisegred_nonseg_19606_total_runtime;
    int mainzisegred_nonseg_19606_runs;
    int64_t mainzisegred_nonseg_19757_total_runtime;
    int mainzisegred_nonseg_19757_runs;
    int64_t mainzisegred_small_18977_total_runtime;
    int mainzisegred_small_18977_runs;
    int64_t mainzisegred_small_20069_total_runtime;
    int mainzisegred_small_20069_runs;
    cl_mem global_failure;
    cl_mem global_failure_args;
    struct opencl_context opencl;
    struct sizes sizes;
    cl_int failure_is_an_option;
} ;
void post_opencl_setup(struct opencl_context *ctx,
                       struct opencl_device_option *option)
{
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name,
                                            "NVIDIA CUDA") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_GPU) == CL_DEVICE_TYPE_GPU) {
        ctx->lockstep_width = 32;
    }
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name,
                                            "AMD Accelerated Parallel Processing") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->lockstep_width = 32;
    }
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->lockstep_width = 1;
    }
    if ((ctx->cfg.default_num_groups == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_GPU) == CL_DEVICE_TYPE_GPU) {
        size_t MAX_COMPUTE_UNITS_val = 0;
        
        clGetDeviceInfo(ctx->device, CL_DEVICE_MAX_COMPUTE_UNITS,
                        sizeof(MAX_COMPUTE_UNITS_val), &MAX_COMPUTE_UNITS_val,
                        NULL);
        ctx->cfg.default_num_groups = 4 * MAX_COMPUTE_UNITS_val;
    }
    if ((ctx->cfg.default_group_size == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_GPU) == CL_DEVICE_TYPE_GPU) {
        ctx->cfg.default_group_size = 256;
    }
    if ((ctx->cfg.default_tile_size == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->cfg.default_tile_size = 32;
    }
    if ((ctx->cfg.default_threshold == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->cfg.default_threshold = 32768;
    }
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_CPU) ==
        CL_DEVICE_TYPE_CPU) {
        ctx->lockstep_width = 1;
    }
    if ((ctx->cfg.default_num_groups == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_CPU) == CL_DEVICE_TYPE_CPU) {
        size_t MAX_COMPUTE_UNITS_val = 0;
        
        clGetDeviceInfo(ctx->device, CL_DEVICE_MAX_COMPUTE_UNITS,
                        sizeof(MAX_COMPUTE_UNITS_val), &MAX_COMPUTE_UNITS_val,
                        NULL);
        ctx->cfg.default_num_groups = MAX_COMPUTE_UNITS_val;
    }
    if ((ctx->cfg.default_group_size == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_CPU) == CL_DEVICE_TYPE_CPU) {
        ctx->cfg.default_group_size = 32;
    }
    if ((ctx->cfg.default_tile_size == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_CPU) ==
        CL_DEVICE_TYPE_CPU) {
        ctx->cfg.default_tile_size = 4;
    }
    if ((ctx->cfg.default_threshold == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_CPU) ==
        CL_DEVICE_TYPE_CPU) {
        size_t MAX_COMPUTE_UNITS_val = 0;
        
        clGetDeviceInfo(ctx->device, CL_DEVICE_MAX_COMPUTE_UNITS,
                        sizeof(MAX_COMPUTE_UNITS_val), &MAX_COMPUTE_UNITS_val,
                        NULL);
        ctx->cfg.default_threshold = MAX_COMPUTE_UNITS_val;
    }
}
static void init_context_early(struct futhark_context_config *cfg,
                               struct futhark_context *ctx)
{
    ctx->opencl.cfg = cfg->opencl;
    ctx->detail_memory = cfg->opencl.debugging;
    ctx->debugging = cfg->opencl.debugging;
    ctx->profiling = cfg->opencl.profiling;
    ctx->profiling_paused = 0;
    ctx->logging = cfg->opencl.logging;
    ctx->error = NULL;
    ctx->opencl.profiling_records_capacity = 200;
    ctx->opencl.profiling_records_used = 0;
    ctx->opencl.profiling_records =
        malloc(ctx->opencl.profiling_records_capacity *
        sizeof(struct profiling_record));
    create_lock(&ctx->lock);
    ctx->failure_is_an_option = 0;
    ctx->peak_mem_usage_device = 0;
    ctx->cur_mem_usage_device = 0;
    ctx->peak_mem_usage_default = 0;
    ctx->cur_mem_usage_default = 0;
    ctx->total_runs = 0;
    ctx->total_runtime = 0;
    ctx->copy_dev_to_dev_total_runtime = 0;
    ctx->copy_dev_to_dev_runs = 0;
    ctx->copy_dev_to_host_total_runtime = 0;
    ctx->copy_dev_to_host_runs = 0;
    ctx->copy_host_to_dev_total_runtime = 0;
    ctx->copy_host_to_dev_runs = 0;
    ctx->copy_scalar_to_dev_total_runtime = 0;
    ctx->copy_scalar_to_dev_runs = 0;
    ctx->copy_scalar_from_dev_total_runtime = 0;
    ctx->copy_scalar_from_dev_runs = 0;
    ctx->builtinzhreplicate_i64zireplicate_19876_total_runtime = 0;
    ctx->builtinzhreplicate_i64zireplicate_19876_runs = 0;
    ctx->gpu_map_transpose_f32_total_runtime = 0;
    ctx->gpu_map_transpose_f32_runs = 0;
    ctx->gpu_map_transpose_f32_low_height_total_runtime = 0;
    ctx->gpu_map_transpose_f32_low_height_runs = 0;
    ctx->gpu_map_transpose_f32_low_width_total_runtime = 0;
    ctx->gpu_map_transpose_f32_low_width_runs = 0;
    ctx->gpu_map_transpose_f32_small_total_runtime = 0;
    ctx->gpu_map_transpose_f32_small_runs = 0;
    ctx->gpu_map_transpose_i64_total_runtime = 0;
    ctx->gpu_map_transpose_i64_runs = 0;
    ctx->gpu_map_transpose_i64_low_height_total_runtime = 0;
    ctx->gpu_map_transpose_i64_low_height_runs = 0;
    ctx->gpu_map_transpose_i64_low_width_total_runtime = 0;
    ctx->gpu_map_transpose_i64_low_width_runs = 0;
    ctx->gpu_map_transpose_i64_small_total_runtime = 0;
    ctx->gpu_map_transpose_i64_small_runs = 0;
    ctx->mainzicopy_19995_total_runtime = 0;
    ctx->mainzicopy_19995_runs = 0;
    ctx->mainzicopy_20049_total_runtime = 0;
    ctx->mainzicopy_20049_runs = 0;
    ctx->mainzicopy_20402_total_runtime = 0;
    ctx->mainzicopy_20402_runs = 0;
    ctx->mainziscan_stage1_17045_total_runtime = 0;
    ctx->mainziscan_stage1_17045_runs = 0;
    ctx->mainziscan_stage1_17934_total_runtime = 0;
    ctx->mainziscan_stage1_17934_runs = 0;
    ctx->mainziscan_stage1_18042_total_runtime = 0;
    ctx->mainziscan_stage1_18042_runs = 0;
    ctx->mainziscan_stage1_18150_total_runtime = 0;
    ctx->mainziscan_stage1_18150_runs = 0;
    ctx->mainziscan_stage1_18193_total_runtime = 0;
    ctx->mainziscan_stage1_18193_runs = 0;
    ctx->mainziscan_stage2_17045_total_runtime = 0;
    ctx->mainziscan_stage2_17045_runs = 0;
    ctx->mainziscan_stage2_17934_total_runtime = 0;
    ctx->mainziscan_stage2_17934_runs = 0;
    ctx->mainziscan_stage2_18042_total_runtime = 0;
    ctx->mainziscan_stage2_18042_runs = 0;
    ctx->mainziscan_stage2_18150_total_runtime = 0;
    ctx->mainziscan_stage2_18150_runs = 0;
    ctx->mainziscan_stage2_18193_total_runtime = 0;
    ctx->mainziscan_stage2_18193_runs = 0;
    ctx->mainziscan_stage3_17045_total_runtime = 0;
    ctx->mainziscan_stage3_17045_runs = 0;
    ctx->mainziscan_stage3_17934_total_runtime = 0;
    ctx->mainziscan_stage3_17934_runs = 0;
    ctx->mainziscan_stage3_18042_total_runtime = 0;
    ctx->mainziscan_stage3_18042_runs = 0;
    ctx->mainziscan_stage3_18150_total_runtime = 0;
    ctx->mainziscan_stage3_18150_runs = 0;
    ctx->mainziscan_stage3_18193_total_runtime = 0;
    ctx->mainziscan_stage3_18193_runs = 0;
    ctx->mainziseghist_global_18214_total_runtime = 0;
    ctx->mainziseghist_global_18214_runs = 0;
    ctx->mainziseghist_local_18214_total_runtime = 0;
    ctx->mainziseghist_local_18214_runs = 0;
    ctx->mainzisegmap_17115_total_runtime = 0;
    ctx->mainzisegmap_17115_runs = 0;
    ctx->mainzisegmap_17864_total_runtime = 0;
    ctx->mainzisegmap_17864_runs = 0;
    ctx->mainzisegmap_17894_total_runtime = 0;
    ctx->mainzisegmap_17894_runs = 0;
    ctx->mainzisegmap_18253_total_runtime = 0;
    ctx->mainzisegmap_18253_runs = 0;
    ctx->mainzisegmap_18351_total_runtime = 0;
    ctx->mainzisegmap_18351_runs = 0;
    ctx->mainzisegmap_18415_total_runtime = 0;
    ctx->mainzisegmap_18415_runs = 0;
    ctx->mainzisegmap_18878_total_runtime = 0;
    ctx->mainzisegmap_18878_runs = 0;
    ctx->mainzisegmap_18942_total_runtime = 0;
    ctx->mainzisegmap_18942_runs = 0;
    ctx->mainzisegred_large_18977_total_runtime = 0;
    ctx->mainzisegred_large_18977_runs = 0;
    ctx->mainzisegred_large_20069_total_runtime = 0;
    ctx->mainzisegred_large_20069_runs = 0;
    ctx->mainzisegred_nonseg_17056_total_runtime = 0;
    ctx->mainzisegred_nonseg_17056_runs = 0;
    ctx->mainzisegred_nonseg_18835_total_runtime = 0;
    ctx->mainzisegred_nonseg_18835_runs = 0;
    ctx->mainzisegred_nonseg_19031_total_runtime = 0;
    ctx->mainzisegred_nonseg_19031_runs = 0;
    ctx->mainzisegred_nonseg_19606_total_runtime = 0;
    ctx->mainzisegred_nonseg_19606_runs = 0;
    ctx->mainzisegred_nonseg_19757_total_runtime = 0;
    ctx->mainzisegred_nonseg_19757_runs = 0;
    ctx->mainzisegred_small_18977_total_runtime = 0;
    ctx->mainzisegred_small_18977_runs = 0;
    ctx->mainzisegred_small_20069_total_runtime = 0;
    ctx->mainzisegred_small_20069_runs = 0;
}
static int init_context_late(struct futhark_context_config *cfg,
                             struct futhark_context *ctx, cl_program prog)
{
    cl_int error;
    cl_int no_error = -1;
    
    ctx->global_failure = clCreateBuffer(ctx->opencl.ctx, CL_MEM_READ_WRITE |
                                         CL_MEM_COPY_HOST_PTR, sizeof(cl_int),
                                         &no_error, &error);
    OPENCL_SUCCEED_OR_RETURN(error);
    // The +1 is to avoid zero-byte allocations.
    ctx->global_failure_args = clCreateBuffer(ctx->opencl.ctx,
                                              CL_MEM_READ_WRITE,
                                              sizeof(int64_t) * (2 + 1), NULL,
                                              &error);
    OPENCL_SUCCEED_OR_RETURN(error);
    {
        ctx->builtinzhreplicate_i64zireplicate_19876 = clCreateKernel(prog,
                                                                      "builtinzhreplicate_i64zireplicate_19876",
                                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "builtin#replicate_i64.replicate_19876");
    }
    {
        ctx->gpu_map_transpose_f32 = clCreateKernel(prog,
                                                    "gpu_map_transpose_f32",
                                                    &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "gpu_map_transpose_f32");
    }
    {
        ctx->gpu_map_transpose_f32_low_height = clCreateKernel(prog,
                                                               "gpu_map_transpose_f32_low_height",
                                                               &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_f32_low_height");
    }
    {
        ctx->gpu_map_transpose_f32_low_width = clCreateKernel(prog,
                                                              "gpu_map_transpose_f32_low_width",
                                                              &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_f32_low_width");
    }
    {
        ctx->gpu_map_transpose_f32_small = clCreateKernel(prog,
                                                          "gpu_map_transpose_f32_small",
                                                          &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_f32_small");
    }
    {
        ctx->gpu_map_transpose_i64 = clCreateKernel(prog,
                                                    "gpu_map_transpose_i64",
                                                    &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "gpu_map_transpose_i64");
    }
    {
        ctx->gpu_map_transpose_i64_low_height = clCreateKernel(prog,
                                                               "gpu_map_transpose_i64_low_height",
                                                               &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_i64_low_height");
    }
    {
        ctx->gpu_map_transpose_i64_low_width = clCreateKernel(prog,
                                                              "gpu_map_transpose_i64_low_width",
                                                              &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_i64_low_width");
    }
    {
        ctx->gpu_map_transpose_i64_small = clCreateKernel(prog,
                                                          "gpu_map_transpose_i64_small",
                                                          &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_i64_small");
    }
    {
        ctx->mainzicopy_19995 = clCreateKernel(prog, "mainzicopy_19995",
                                               &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.copy_19995");
    }
    {
        ctx->mainzicopy_20049 = clCreateKernel(prog, "mainzicopy_20049",
                                               &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.copy_20049");
    }
    {
        ctx->mainzicopy_20402 = clCreateKernel(prog, "mainzicopy_20402",
                                               &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.copy_20402");
    }
    {
        ctx->mainziscan_stage1_17045 = clCreateKernel(prog,
                                                      "mainziscan_stage1_17045",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_17045, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_17045");
    }
    {
        ctx->mainziscan_stage1_17934 = clCreateKernel(prog,
                                                      "mainziscan_stage1_17934",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_17934, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_17934");
    }
    {
        ctx->mainziscan_stage1_18042 = clCreateKernel(prog,
                                                      "mainziscan_stage1_18042",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_18042, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_18042, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_18042");
    }
    {
        ctx->mainziscan_stage1_18150 = clCreateKernel(prog,
                                                      "mainziscan_stage1_18150",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_18150, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_18150");
    }
    {
        ctx->mainziscan_stage1_18193 = clCreateKernel(prog,
                                                      "mainziscan_stage1_18193",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_18193, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_18193");
    }
    {
        ctx->mainziscan_stage2_17045 = clCreateKernel(prog,
                                                      "mainziscan_stage2_17045",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_17045, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_17045");
    }
    {
        ctx->mainziscan_stage2_17934 = clCreateKernel(prog,
                                                      "mainziscan_stage2_17934",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_17934, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_17934");
    }
    {
        ctx->mainziscan_stage2_18042 = clCreateKernel(prog,
                                                      "mainziscan_stage2_18042",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_18042, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_18042");
    }
    {
        ctx->mainziscan_stage2_18150 = clCreateKernel(prog,
                                                      "mainziscan_stage2_18150",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_18150, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_18150");
    }
    {
        ctx->mainziscan_stage2_18193 = clCreateKernel(prog,
                                                      "mainziscan_stage2_18193",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_18193, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_18193");
    }
    {
        ctx->mainziscan_stage3_17045 = clCreateKernel(prog,
                                                      "mainziscan_stage3_17045",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_17045, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_17045");
    }
    {
        ctx->mainziscan_stage3_17934 = clCreateKernel(prog,
                                                      "mainziscan_stage3_17934",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_17934, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_17934");
    }
    {
        ctx->mainziscan_stage3_18042 = clCreateKernel(prog,
                                                      "mainziscan_stage3_18042",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_18042, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_18042");
    }
    {
        ctx->mainziscan_stage3_18150 = clCreateKernel(prog,
                                                      "mainziscan_stage3_18150",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_18150, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_18150");
    }
    {
        ctx->mainziscan_stage3_18193 = clCreateKernel(prog,
                                                      "mainziscan_stage3_18193",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_18193, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_18193");
    }
    {
        ctx->mainziseghist_global_18214 = clCreateKernel(prog,
                                                         "mainziseghist_global_18214",
                                                         &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziseghist_global_18214, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "main.seghist_global_18214");
    }
    {
        ctx->mainziseghist_local_18214 = clCreateKernel(prog,
                                                        "mainziseghist_local_18214",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziseghist_local_18214, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.seghist_local_18214");
    }
    {
        ctx->mainzisegmap_17115 = clCreateKernel(prog, "mainzisegmap_17115",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_17115, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_17115, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_17115");
    }
    {
        ctx->mainzisegmap_17864 = clCreateKernel(prog, "mainzisegmap_17864",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_17864, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_17864");
    }
    {
        ctx->mainzisegmap_17894 = clCreateKernel(prog, "mainzisegmap_17894",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_17894, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_17894, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_17894");
    }
    {
        ctx->mainzisegmap_18253 = clCreateKernel(prog, "mainzisegmap_18253",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_18253, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_18253, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_18253");
    }
    {
        ctx->mainzisegmap_18351 = clCreateKernel(prog, "mainzisegmap_18351",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_18351, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_18351");
    }
    {
        ctx->mainzisegmap_18415 = clCreateKernel(prog, "mainzisegmap_18415",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_18415, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_18415");
    }
    {
        ctx->mainzisegmap_18878 = clCreateKernel(prog, "mainzisegmap_18878",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_18878, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_18878");
    }
    {
        ctx->mainzisegmap_18942 = clCreateKernel(prog, "mainzisegmap_18942",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_18942, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_18942");
    }
    {
        ctx->mainzisegred_large_18977 = clCreateKernel(prog,
                                                       "mainzisegred_large_18977",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_large_18977, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_large_18977");
    }
    {
        ctx->mainzisegred_large_20069 = clCreateKernel(prog,
                                                       "mainzisegred_large_20069",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_large_20069, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_large_20069");
    }
    {
        ctx->mainzisegred_nonseg_17056 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_17056",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_17056");
    }
    {
        ctx->mainzisegred_nonseg_18835 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_18835",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_18835, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_18835");
    }
    {
        ctx->mainzisegred_nonseg_19031 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_19031",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_19031, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_19031");
    }
    {
        ctx->mainzisegred_nonseg_19606 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_19606",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_19606, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_19606, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_19606");
    }
    {
        ctx->mainzisegred_nonseg_19757 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_19757",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_19757, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_19757, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_19757");
    }
    {
        ctx->mainzisegred_small_18977 = clCreateKernel(prog,
                                                       "mainzisegred_small_18977",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_small_18977, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_small_18977");
    }
    {
        ctx->mainzisegred_small_20069 = clCreateKernel(prog,
                                                       "mainzisegred_small_20069",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_small_20069, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_small_20069");
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_19840.references = NULL;
        ctx->mainzicounter_mem_19840.size = 0;
        ctx->mainzicounter_mem_19840.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_19840.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_20655,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_19887.references = NULL;
        ctx->mainzicounter_mem_19887.size = 0;
        ctx->mainzicounter_mem_19887.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_19887.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_20662,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzihist_locks_mem_20054.references = NULL;
        ctx->mainzihist_locks_mem_20054.size = 0;
        ctx->mainzihist_locks_mem_20054.mem = clCreateBuffer(ctx->opencl.ctx,
                                                             CL_MEM_READ_WRITE,
                                                             (100151 >
                                                              0 ? 100151 : 1) *
                                                             sizeof(int32_t),
                                                             NULL, &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (100151 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzihist_locks_mem_20054.mem,
                                                          CL_TRUE, 0, 100151 *
                                                          sizeof(int32_t),
                                                          mainzihist_locks_mem_realtype_20704,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_20098.references = NULL;
        ctx->mainzicounter_mem_20098.size = 0;
        ctx->mainzicounter_mem_20098.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10240 >
                                                           0 ? 10240 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10240 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_20098.mem,
                                                          CL_TRUE, 0, 10240 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_20715,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_20407.references = NULL;
        ctx->mainzicounter_mem_20407.size = 0;
        ctx->mainzicounter_mem_20407.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_20407.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_20786,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_20458.references = NULL;
        ctx->mainzicounter_mem_20458.size = 0;
        ctx->mainzicounter_mem_20458.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_20458.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_20803,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_20523.references = NULL;
        ctx->mainzicounter_mem_20523.size = 0;
        ctx->mainzicounter_mem_20523.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10240 >
                                                           0 ? 10240 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10240 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_20523.mem,
                                                          CL_TRUE, 0, 10240 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_20820,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_20561.references = NULL;
        ctx->mainzicounter_mem_20561.size = 0;
        ctx->mainzicounter_mem_20561.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_20561.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_20831,
                                                          0, NULL, NULL));
    }
    ctx->sizes.builtinzhreplicate_i64zigroup_sizze_19879 = cfg->sizes[0];
    ctx->sizes.mainziL2_sizze_20041 = cfg->sizes[1];
    ctx->sizes.mainzigroup_sizze_19998 = cfg->sizes[2];
    ctx->sizes.mainzigroup_sizze_20052 = cfg->sizes[3];
    ctx->sizes.mainzigroup_sizze_20405 = cfg->sizes[4];
    ctx->sizes.mainziseghist_group_sizze_18208 = cfg->sizes[5];
    ctx->sizes.mainziseghist_num_groups_18210 = cfg->sizes[6];
    ctx->sizes.mainzisegmap_group_sizze_17117 = cfg->sizes[7];
    ctx->sizes.mainzisegmap_group_sizze_17867 = cfg->sizes[8];
    ctx->sizes.mainzisegmap_group_sizze_17896 = cfg->sizes[9];
    ctx->sizes.mainzisegmap_group_sizze_18255 = cfg->sizes[10];
    ctx->sizes.mainzisegmap_group_sizze_18354 = cfg->sizes[11];
    ctx->sizes.mainzisegmap_group_sizze_18417 = cfg->sizes[12];
    ctx->sizes.mainzisegmap_group_sizze_18880 = cfg->sizes[13];
    ctx->sizes.mainzisegmap_group_sizze_18944 = cfg->sizes[14];
    ctx->sizes.mainzisegmap_num_groups_17119 = cfg->sizes[15];
    ctx->sizes.mainzisegmap_num_groups_17898 = cfg->sizes[16];
    ctx->sizes.mainzisegmap_num_groups_18257 = cfg->sizes[17];
    ctx->sizes.mainzisegred_group_sizze_17047 = cfg->sizes[18];
    ctx->sizes.mainzisegred_group_sizze_18826 = cfg->sizes[19];
    ctx->sizes.mainzisegred_group_sizze_18971 = cfg->sizes[20];
    ctx->sizes.mainzisegred_group_sizze_19023 = cfg->sizes[21];
    ctx->sizes.mainzisegred_group_sizze_19601 = cfg->sizes[22];
    ctx->sizes.mainzisegred_group_sizze_19752 = cfg->sizes[23];
    ctx->sizes.mainzisegred_num_groups_17049 = cfg->sizes[24];
    ctx->sizes.mainzisegred_num_groups_18828 = cfg->sizes[25];
    ctx->sizes.mainzisegred_num_groups_18973 = cfg->sizes[26];
    ctx->sizes.mainzisegred_num_groups_19025 = cfg->sizes[27];
    ctx->sizes.mainzisegred_num_groups_19599 = cfg->sizes[28];
    ctx->sizes.mainzisegred_num_groups_19750 = cfg->sizes[29];
    ctx->sizes.mainzisegscan_group_sizze_17039 = cfg->sizes[30];
    ctx->sizes.mainzisegscan_group_sizze_17928 = cfg->sizes[31];
    ctx->sizes.mainzisegscan_group_sizze_18036 = cfg->sizes[32];
    ctx->sizes.mainzisegscan_group_sizze_18144 = cfg->sizes[33];
    ctx->sizes.mainzisegscan_group_sizze_18187 = cfg->sizes[34];
    ctx->sizes.mainzisegscan_num_groups_17041 = cfg->sizes[35];
    ctx->sizes.mainzisegscan_num_groups_17930 = cfg->sizes[36];
    ctx->sizes.mainzisegscan_num_groups_18038 = cfg->sizes[37];
    ctx->sizes.mainzisegscan_num_groups_18146 = cfg->sizes[38];
    ctx->sizes.mainzisegscan_num_groups_18189 = cfg->sizes[39];
    ctx->sizes.mainzisuff_outer_par_0 = cfg->sizes[40];
    ctx->sizes.mainzisuff_outer_par_8 = cfg->sizes[41];
    ctx->sizes.mainzisuff_outer_redomap_7 = cfg->sizes[42];
    init_constants(ctx);
    // Clear the free list of any deallocations that occurred while initialising constants.
    OPENCL_SUCCEED_OR_RETURN(opencl_free_all(&ctx->opencl));
    // The program will be properly freed after all the kernels have also been freed.
    OPENCL_SUCCEED_OR_RETURN(clReleaseProgram(prog));
    return futhark_context_sync(ctx);
}
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg)
{
    struct futhark_context *ctx =
                           (struct futhark_context *) malloc(sizeof(struct futhark_context));
    
    if (ctx == NULL)
        return NULL;
    
    int required_types = 0;
    
    init_context_early(cfg, ctx);
    
    cl_program prog = setup_opencl(&ctx->opencl, opencl_program, required_types,
                                   cfg->build_opts);
    
    init_context_late(cfg, ctx, prog);
    return ctx;
}
struct futhark_context *futhark_context_new_with_command_queue(struct futhark_context_config *cfg,
                                                               cl_command_queue queue)
{
    struct futhark_context *ctx =
                           (struct futhark_context *) malloc(sizeof(struct futhark_context));
    
    if (ctx == NULL)
        return NULL;
    
    int required_types = 0;
    
    init_context_early(cfg, ctx);
    
    cl_program prog = setup_opencl_with_command_queue(&ctx->opencl, queue,
                                                      opencl_program,
                                                      required_types,
                                                      cfg->build_opts);
    
    init_context_late(cfg, ctx, prog);
    return ctx;
}
void futhark_context_free(struct futhark_context *ctx)
{
    free_constants(ctx);
    free_lock(&ctx->lock);
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->builtinzhreplicate_i64zireplicate_19876));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32_low_height));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32_low_width));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32_small));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_i64));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_i64_low_height));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_i64_low_width));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_i64_small));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzicopy_19995));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzicopy_20049));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzicopy_20402));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_17045));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_17934));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_18042));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_18150));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_18193));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_17045));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_17934));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_18042));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_18150));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_18193));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_17045));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_17934));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_18042));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_18150));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_18193));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziseghist_global_18214));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziseghist_local_18214));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_17115));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_17864));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_17894));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_18253));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_18351));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_18415));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_18878));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_18942));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_large_18977));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_large_20069));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_17056));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_18835));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_19031));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_19606));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_19757));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_small_18977));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_small_20069));
    teardown_opencl(&ctx->opencl);
    free(ctx);
}
int futhark_context_sync(struct futhark_context *ctx)
{
    cl_int failure_idx = -1;
    
    if (ctx->failure_is_an_option) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     ctx->global_failure,
                                                     CL_FALSE, 0,
                                                     sizeof(cl_int),
                                                     &failure_idx, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        ctx->failure_is_an_option = 0;
    }
    OPENCL_SUCCEED_OR_RETURN(clFinish(ctx->opencl.queue));
    if (failure_idx >= 0) {
        cl_int no_failure = -1;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                      ctx->global_failure,
                                                      CL_TRUE, 0,
                                                      sizeof(cl_int),
                                                      &no_failure, 0, NULL,
                                                      NULL));
        
        int64_t args[2 + 1];
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     ctx->global_failure_args,
                                                     CL_TRUE, 0, sizeof(args),
                                                     &args, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_host_runs,
                                                                                               &ctx->copy_dev_to_host_total_runtime)));
        switch (failure_idx) {
            
          case 0:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  /prelude/array.fut:18:29-34\n   #1  lib/github.com/diku-dk/segmented/segmented.fut:29:36-59\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:91:6-36\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #4  cva.fut:130:37-88\n   #5  cva.fut:129:21-131:66\n   #6  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 1:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:84:112-119\n   #1  cva.fut:123:32-62\n   #2  cva.fut:123:22-69\n   #3  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 2:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:84:58-120\n   #1  cva.fut:123:32-62\n   #2  cva.fut:123:22-69\n   #3  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 3:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  lib/github.com/diku-dk/segmented/segmented.fut:90:30-35\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:90:12-49\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:130:37-88\n   #6  cva.fut:129:21-131:66\n   #7  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 4:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  /prelude/array.fut:18:29-34\n   #1  lib/github.com/diku-dk/segmented/segmented.fut:29:36-59\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:91:6-36\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #4  cva.fut:130:37-88\n   #5  cva.fut:129:21-131:66\n   #6  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 5:
            {
                ctx->error =
                    msgprintf("Value of (core language) shape (%lld) cannot match shape of type `[%lld]b`.\n-> #0  lib/github.com/diku-dk/segmented/segmented.fut:103:6-45\n   #1  cva.fut:130:37-88\n   #2  cva.fut:129:21-131:66\n   #3  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 6:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:84:112-119\n   #1  cva.fut:123:32-62\n   #2  cva.fut:123:22-69\n   #3  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 7:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:84:58-120\n   #1  cva.fut:123:32-62\n   #2  cva.fut:123:22-69\n   #3  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 8:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  lib/github.com/diku-dk/segmented/segmented.fut:90:30-35\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:90:12-49\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:130:37-88\n   #6  cva.fut:129:21-131:66\n   #7  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 9:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  /prelude/array.fut:18:29-34\n   #1  lib/github.com/diku-dk/segmented/segmented.fut:29:36-59\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:91:6-36\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #4  cva.fut:130:37-88\n   #5  cva.fut:129:21-131:66\n   #6  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 10:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  /prelude/array.fut:18:29-34\n   #1  lib/github.com/diku-dk/segmented/segmented.fut:29:36-59\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:91:6-36\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #4  cva.fut:130:37-88\n   #5  cva.fut:129:21-131:66\n   #6  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
            
          case 11:
            {
                ctx->error =
                    msgprintf("Value of (core language) shape (%lld) cannot match shape of type `[%lld]b`.\n-> #0  lib/github.com/diku-dk/segmented/segmented.fut:103:6-45\n   #1  cva.fut:130:37-88\n   #2  cva.fut:129:21-131:66\n   #3  cva.fut:105:1-138:18\n",
                              args[0], args[1]);
                break;
            }
        }
        return 1;
    }
    return 0;
}
int futhark_context_clear_caches(struct futhark_context *ctx)
{
    ctx->error = OPENCL_SUCCEED_NONFATAL(opencl_free_all(&ctx->opencl));
    return ctx->error != NULL;
}
cl_command_queue futhark_context_get_command_queue(struct futhark_context *ctx)
{
    return ctx->opencl.queue;
}
static int memblock_unref_device(struct futhark_context *ctx,
                                 struct memblock_device *block, const
                                 char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(stderr,
                    "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n",
                    desc, block->desc, "space 'device'", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_device -= block->size;
            OPENCL_SUCCEED_OR_RETURN(opencl_free(&ctx->opencl, block->mem,
                                                 desc));
            free(block->references);
            if (ctx->detail_memory)
                fprintf(stderr,
                        "%lld bytes freed (now allocated: %lld bytes)\n",
                        (long long) block->size,
                        (long long) ctx->cur_mem_usage_device);
        }
        block->references = NULL;
    }
    return 0;
}
static int memblock_alloc_device(struct futhark_context *ctx,
                                 struct memblock_device *block, int64_t size,
                                 const char *desc)
{
    if (size < 0)
        futhark_panic(1,
                      "Negative allocation of %lld bytes attempted for %s in %s.\n",
                      (long long) size, desc, "space 'device'",
                      ctx->cur_mem_usage_device);
    
    int ret = memblock_unref_device(ctx, block, desc);
    
    ctx->cur_mem_usage_device += size;
    if (ctx->detail_memory)
        fprintf(stderr,
                "Allocating %lld bytes for %s in %s (then allocated: %lld bytes)",
                (long long) size, desc, "space 'device'",
                (long long) ctx->cur_mem_usage_device);
    if (ctx->cur_mem_usage_device > ctx->peak_mem_usage_device) {
        ctx->peak_mem_usage_device = ctx->cur_mem_usage_device;
        if (ctx->detail_memory)
            fprintf(stderr, " (new peak).\n");
    } else if (ctx->detail_memory)
        fprintf(stderr, ".\n");
    OPENCL_SUCCEED_OR_RETURN(opencl_alloc(&ctx->opencl, size, desc,
                                          &block->mem));
    block->references = (int *) malloc(sizeof(int));
    *block->references = 1;
    block->size = size;
    block->desc = desc;
    return ret;
}
static int memblock_set_device(struct futhark_context *ctx,
                               struct memblock_device *lhs,
                               struct memblock_device *rhs, const
                               char *lhs_desc)
{
    int ret = memblock_unref_device(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
static int memblock_unref(struct futhark_context *ctx, struct memblock *block,
                          const char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(stderr,
                    "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n",
                    desc, block->desc, "default space", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_default -= block->size;
            free(block->mem);
            free(block->references);
            if (ctx->detail_memory)
                fprintf(stderr,
                        "%lld bytes freed (now allocated: %lld bytes)\n",
                        (long long) block->size,
                        (long long) ctx->cur_mem_usage_default);
        }
        block->references = NULL;
    }
    return 0;
}
static int memblock_alloc(struct futhark_context *ctx, struct memblock *block,
                          int64_t size, const char *desc)
{
    if (size < 0)
        futhark_panic(1,
                      "Negative allocation of %lld bytes attempted for %s in %s.\n",
                      (long long) size, desc, "default space",
                      ctx->cur_mem_usage_default);
    
    int ret = memblock_unref(ctx, block, desc);
    
    ctx->cur_mem_usage_default += size;
    if (ctx->detail_memory)
        fprintf(stderr,
                "Allocating %lld bytes for %s in %s (then allocated: %lld bytes)",
                (long long) size, desc, "default space",
                (long long) ctx->cur_mem_usage_default);
    if (ctx->cur_mem_usage_default > ctx->peak_mem_usage_default) {
        ctx->peak_mem_usage_default = ctx->cur_mem_usage_default;
        if (ctx->detail_memory)
            fprintf(stderr, " (new peak).\n");
    } else if (ctx->detail_memory)
        fprintf(stderr, ".\n");
    block->mem = (char *) malloc(size);
    block->references = (int *) malloc(sizeof(int));
    *block->references = 1;
    block->size = size;
    block->desc = desc;
    return ret;
}
static int memblock_set(struct futhark_context *ctx, struct memblock *lhs,
                        struct memblock *rhs, const char *lhs_desc)
{
    int ret = memblock_unref(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
char *futhark_context_report(struct futhark_context *ctx)
{
    struct str_builder builder;
    
    str_builder_init(&builder);
    if (ctx->detail_memory || ctx->profiling) {
        str_builder(&builder,
                    "Peak memory usage for space 'device': %lld bytes.\n",
                    (long long) ctx->peak_mem_usage_device);
        { }
    }
    if (ctx->profiling) {
        OPENCL_SUCCEED_FATAL(opencl_tally_profiling_records(&ctx->opencl));
        str_builder(&builder,
                    "copy_dev_to_dev                       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_dev_to_dev_runs,
                    (long) ctx->copy_dev_to_dev_total_runtime /
                    (ctx->copy_dev_to_dev_runs !=
                     0 ? ctx->copy_dev_to_dev_runs : 1),
                    (long) ctx->copy_dev_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_dev_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_dev_to_dev_runs;
        str_builder(&builder,
                    "copy_dev_to_host                      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_dev_to_host_runs,
                    (long) ctx->copy_dev_to_host_total_runtime /
                    (ctx->copy_dev_to_host_runs !=
                     0 ? ctx->copy_dev_to_host_runs : 1),
                    (long) ctx->copy_dev_to_host_total_runtime);
        ctx->total_runtime += ctx->copy_dev_to_host_total_runtime;
        ctx->total_runs += ctx->copy_dev_to_host_runs;
        str_builder(&builder,
                    "copy_host_to_dev                      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_host_to_dev_runs,
                    (long) ctx->copy_host_to_dev_total_runtime /
                    (ctx->copy_host_to_dev_runs !=
                     0 ? ctx->copy_host_to_dev_runs : 1),
                    (long) ctx->copy_host_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_host_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_host_to_dev_runs;
        str_builder(&builder,
                    "copy_scalar_to_dev                    ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_scalar_to_dev_runs,
                    (long) ctx->copy_scalar_to_dev_total_runtime /
                    (ctx->copy_scalar_to_dev_runs !=
                     0 ? ctx->copy_scalar_to_dev_runs : 1),
                    (long) ctx->copy_scalar_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_scalar_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_scalar_to_dev_runs;
        str_builder(&builder,
                    "copy_scalar_from_dev                  ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_scalar_from_dev_runs,
                    (long) ctx->copy_scalar_from_dev_total_runtime /
                    (ctx->copy_scalar_from_dev_runs !=
                     0 ? ctx->copy_scalar_from_dev_runs : 1),
                    (long) ctx->copy_scalar_from_dev_total_runtime);
        ctx->total_runtime += ctx->copy_scalar_from_dev_total_runtime;
        ctx->total_runs += ctx->copy_scalar_from_dev_runs;
        str_builder(&builder,
                    "builtin#replicate_i64.replicate_19876 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->builtinzhreplicate_i64zireplicate_19876_runs,
                    (long) ctx->builtinzhreplicate_i64zireplicate_19876_total_runtime /
                    (ctx->builtinzhreplicate_i64zireplicate_19876_runs !=
                     0 ? ctx->builtinzhreplicate_i64zireplicate_19876_runs : 1),
                    (long) ctx->builtinzhreplicate_i64zireplicate_19876_total_runtime);
        ctx->total_runtime +=
            ctx->builtinzhreplicate_i64zireplicate_19876_total_runtime;
        ctx->total_runs += ctx->builtinzhreplicate_i64zireplicate_19876_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32                 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_runs,
                    (long) ctx->gpu_map_transpose_f32_total_runtime /
                    (ctx->gpu_map_transpose_f32_runs !=
                     0 ? ctx->gpu_map_transpose_f32_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_f32_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_low_height      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_low_height_runs,
                    (long) ctx->gpu_map_transpose_f32_low_height_total_runtime /
                    (ctx->gpu_map_transpose_f32_low_height_runs !=
                     0 ? ctx->gpu_map_transpose_f32_low_height_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_low_height_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_f32_low_height_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_low_height_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_low_width       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_low_width_runs,
                    (long) ctx->gpu_map_transpose_f32_low_width_total_runtime /
                    (ctx->gpu_map_transpose_f32_low_width_runs !=
                     0 ? ctx->gpu_map_transpose_f32_low_width_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_low_width_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_f32_low_width_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_low_width_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_small           ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_small_runs,
                    (long) ctx->gpu_map_transpose_f32_small_total_runtime /
                    (ctx->gpu_map_transpose_f32_small_runs !=
                     0 ? ctx->gpu_map_transpose_f32_small_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_small_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_f32_small_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_small_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i64                 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i64_runs,
                    (long) ctx->gpu_map_transpose_i64_total_runtime /
                    (ctx->gpu_map_transpose_i64_runs !=
                     0 ? ctx->gpu_map_transpose_i64_runs : 1),
                    (long) ctx->gpu_map_transpose_i64_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_i64_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i64_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i64_low_height      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i64_low_height_runs,
                    (long) ctx->gpu_map_transpose_i64_low_height_total_runtime /
                    (ctx->gpu_map_transpose_i64_low_height_runs !=
                     0 ? ctx->gpu_map_transpose_i64_low_height_runs : 1),
                    (long) ctx->gpu_map_transpose_i64_low_height_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_i64_low_height_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i64_low_height_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i64_low_width       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i64_low_width_runs,
                    (long) ctx->gpu_map_transpose_i64_low_width_total_runtime /
                    (ctx->gpu_map_transpose_i64_low_width_runs !=
                     0 ? ctx->gpu_map_transpose_i64_low_width_runs : 1),
                    (long) ctx->gpu_map_transpose_i64_low_width_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_i64_low_width_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i64_low_width_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i64_small           ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i64_small_runs,
                    (long) ctx->gpu_map_transpose_i64_small_total_runtime /
                    (ctx->gpu_map_transpose_i64_small_runs !=
                     0 ? ctx->gpu_map_transpose_i64_small_runs : 1),
                    (long) ctx->gpu_map_transpose_i64_small_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_i64_small_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i64_small_runs;
        str_builder(&builder,
                    "main.copy_19995                       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzicopy_19995_runs,
                    (long) ctx->mainzicopy_19995_total_runtime /
                    (ctx->mainzicopy_19995_runs !=
                     0 ? ctx->mainzicopy_19995_runs : 1),
                    (long) ctx->mainzicopy_19995_total_runtime);
        ctx->total_runtime += ctx->mainzicopy_19995_total_runtime;
        ctx->total_runs += ctx->mainzicopy_19995_runs;
        str_builder(&builder,
                    "main.copy_20049                       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzicopy_20049_runs,
                    (long) ctx->mainzicopy_20049_total_runtime /
                    (ctx->mainzicopy_20049_runs !=
                     0 ? ctx->mainzicopy_20049_runs : 1),
                    (long) ctx->mainzicopy_20049_total_runtime);
        ctx->total_runtime += ctx->mainzicopy_20049_total_runtime;
        ctx->total_runs += ctx->mainzicopy_20049_runs;
        str_builder(&builder,
                    "main.copy_20402                       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzicopy_20402_runs,
                    (long) ctx->mainzicopy_20402_total_runtime /
                    (ctx->mainzicopy_20402_runs !=
                     0 ? ctx->mainzicopy_20402_runs : 1),
                    (long) ctx->mainzicopy_20402_total_runtime);
        ctx->total_runtime += ctx->mainzicopy_20402_total_runtime;
        ctx->total_runs += ctx->mainzicopy_20402_runs;
        str_builder(&builder,
                    "main.scan_stage1_17045                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_17045_runs,
                    (long) ctx->mainziscan_stage1_17045_total_runtime /
                    (ctx->mainziscan_stage1_17045_runs !=
                     0 ? ctx->mainziscan_stage1_17045_runs : 1),
                    (long) ctx->mainziscan_stage1_17045_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_17045_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_17045_runs;
        str_builder(&builder,
                    "main.scan_stage1_17934                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_17934_runs,
                    (long) ctx->mainziscan_stage1_17934_total_runtime /
                    (ctx->mainziscan_stage1_17934_runs !=
                     0 ? ctx->mainziscan_stage1_17934_runs : 1),
                    (long) ctx->mainziscan_stage1_17934_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_17934_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_17934_runs;
        str_builder(&builder,
                    "main.scan_stage1_18042                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_18042_runs,
                    (long) ctx->mainziscan_stage1_18042_total_runtime /
                    (ctx->mainziscan_stage1_18042_runs !=
                     0 ? ctx->mainziscan_stage1_18042_runs : 1),
                    (long) ctx->mainziscan_stage1_18042_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_18042_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_18042_runs;
        str_builder(&builder,
                    "main.scan_stage1_18150                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_18150_runs,
                    (long) ctx->mainziscan_stage1_18150_total_runtime /
                    (ctx->mainziscan_stage1_18150_runs !=
                     0 ? ctx->mainziscan_stage1_18150_runs : 1),
                    (long) ctx->mainziscan_stage1_18150_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_18150_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_18150_runs;
        str_builder(&builder,
                    "main.scan_stage1_18193                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_18193_runs,
                    (long) ctx->mainziscan_stage1_18193_total_runtime /
                    (ctx->mainziscan_stage1_18193_runs !=
                     0 ? ctx->mainziscan_stage1_18193_runs : 1),
                    (long) ctx->mainziscan_stage1_18193_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_18193_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_18193_runs;
        str_builder(&builder,
                    "main.scan_stage2_17045                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_17045_runs,
                    (long) ctx->mainziscan_stage2_17045_total_runtime /
                    (ctx->mainziscan_stage2_17045_runs !=
                     0 ? ctx->mainziscan_stage2_17045_runs : 1),
                    (long) ctx->mainziscan_stage2_17045_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_17045_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_17045_runs;
        str_builder(&builder,
                    "main.scan_stage2_17934                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_17934_runs,
                    (long) ctx->mainziscan_stage2_17934_total_runtime /
                    (ctx->mainziscan_stage2_17934_runs !=
                     0 ? ctx->mainziscan_stage2_17934_runs : 1),
                    (long) ctx->mainziscan_stage2_17934_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_17934_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_17934_runs;
        str_builder(&builder,
                    "main.scan_stage2_18042                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_18042_runs,
                    (long) ctx->mainziscan_stage2_18042_total_runtime /
                    (ctx->mainziscan_stage2_18042_runs !=
                     0 ? ctx->mainziscan_stage2_18042_runs : 1),
                    (long) ctx->mainziscan_stage2_18042_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_18042_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_18042_runs;
        str_builder(&builder,
                    "main.scan_stage2_18150                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_18150_runs,
                    (long) ctx->mainziscan_stage2_18150_total_runtime /
                    (ctx->mainziscan_stage2_18150_runs !=
                     0 ? ctx->mainziscan_stage2_18150_runs : 1),
                    (long) ctx->mainziscan_stage2_18150_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_18150_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_18150_runs;
        str_builder(&builder,
                    "main.scan_stage2_18193                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_18193_runs,
                    (long) ctx->mainziscan_stage2_18193_total_runtime /
                    (ctx->mainziscan_stage2_18193_runs !=
                     0 ? ctx->mainziscan_stage2_18193_runs : 1),
                    (long) ctx->mainziscan_stage2_18193_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_18193_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_18193_runs;
        str_builder(&builder,
                    "main.scan_stage3_17045                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_17045_runs,
                    (long) ctx->mainziscan_stage3_17045_total_runtime /
                    (ctx->mainziscan_stage3_17045_runs !=
                     0 ? ctx->mainziscan_stage3_17045_runs : 1),
                    (long) ctx->mainziscan_stage3_17045_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_17045_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_17045_runs;
        str_builder(&builder,
                    "main.scan_stage3_17934                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_17934_runs,
                    (long) ctx->mainziscan_stage3_17934_total_runtime /
                    (ctx->mainziscan_stage3_17934_runs !=
                     0 ? ctx->mainziscan_stage3_17934_runs : 1),
                    (long) ctx->mainziscan_stage3_17934_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_17934_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_17934_runs;
        str_builder(&builder,
                    "main.scan_stage3_18042                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_18042_runs,
                    (long) ctx->mainziscan_stage3_18042_total_runtime /
                    (ctx->mainziscan_stage3_18042_runs !=
                     0 ? ctx->mainziscan_stage3_18042_runs : 1),
                    (long) ctx->mainziscan_stage3_18042_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_18042_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_18042_runs;
        str_builder(&builder,
                    "main.scan_stage3_18150                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_18150_runs,
                    (long) ctx->mainziscan_stage3_18150_total_runtime /
                    (ctx->mainziscan_stage3_18150_runs !=
                     0 ? ctx->mainziscan_stage3_18150_runs : 1),
                    (long) ctx->mainziscan_stage3_18150_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_18150_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_18150_runs;
        str_builder(&builder,
                    "main.scan_stage3_18193                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_18193_runs,
                    (long) ctx->mainziscan_stage3_18193_total_runtime /
                    (ctx->mainziscan_stage3_18193_runs !=
                     0 ? ctx->mainziscan_stage3_18193_runs : 1),
                    (long) ctx->mainziscan_stage3_18193_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_18193_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_18193_runs;
        str_builder(&builder,
                    "main.seghist_global_18214             ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziseghist_global_18214_runs,
                    (long) ctx->mainziseghist_global_18214_total_runtime /
                    (ctx->mainziseghist_global_18214_runs !=
                     0 ? ctx->mainziseghist_global_18214_runs : 1),
                    (long) ctx->mainziseghist_global_18214_total_runtime);
        ctx->total_runtime += ctx->mainziseghist_global_18214_total_runtime;
        ctx->total_runs += ctx->mainziseghist_global_18214_runs;
        str_builder(&builder,
                    "main.seghist_local_18214              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziseghist_local_18214_runs,
                    (long) ctx->mainziseghist_local_18214_total_runtime /
                    (ctx->mainziseghist_local_18214_runs !=
                     0 ? ctx->mainziseghist_local_18214_runs : 1),
                    (long) ctx->mainziseghist_local_18214_total_runtime);
        ctx->total_runtime += ctx->mainziseghist_local_18214_total_runtime;
        ctx->total_runs += ctx->mainziseghist_local_18214_runs;
        str_builder(&builder,
                    "main.segmap_17115                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_17115_runs,
                    (long) ctx->mainzisegmap_17115_total_runtime /
                    (ctx->mainzisegmap_17115_runs !=
                     0 ? ctx->mainzisegmap_17115_runs : 1),
                    (long) ctx->mainzisegmap_17115_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_17115_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_17115_runs;
        str_builder(&builder,
                    "main.segmap_17864                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_17864_runs,
                    (long) ctx->mainzisegmap_17864_total_runtime /
                    (ctx->mainzisegmap_17864_runs !=
                     0 ? ctx->mainzisegmap_17864_runs : 1),
                    (long) ctx->mainzisegmap_17864_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_17864_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_17864_runs;
        str_builder(&builder,
                    "main.segmap_17894                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_17894_runs,
                    (long) ctx->mainzisegmap_17894_total_runtime /
                    (ctx->mainzisegmap_17894_runs !=
                     0 ? ctx->mainzisegmap_17894_runs : 1),
                    (long) ctx->mainzisegmap_17894_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_17894_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_17894_runs;
        str_builder(&builder,
                    "main.segmap_18253                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_18253_runs,
                    (long) ctx->mainzisegmap_18253_total_runtime /
                    (ctx->mainzisegmap_18253_runs !=
                     0 ? ctx->mainzisegmap_18253_runs : 1),
                    (long) ctx->mainzisegmap_18253_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_18253_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_18253_runs;
        str_builder(&builder,
                    "main.segmap_18351                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_18351_runs,
                    (long) ctx->mainzisegmap_18351_total_runtime /
                    (ctx->mainzisegmap_18351_runs !=
                     0 ? ctx->mainzisegmap_18351_runs : 1),
                    (long) ctx->mainzisegmap_18351_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_18351_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_18351_runs;
        str_builder(&builder,
                    "main.segmap_18415                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_18415_runs,
                    (long) ctx->mainzisegmap_18415_total_runtime /
                    (ctx->mainzisegmap_18415_runs !=
                     0 ? ctx->mainzisegmap_18415_runs : 1),
                    (long) ctx->mainzisegmap_18415_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_18415_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_18415_runs;
        str_builder(&builder,
                    "main.segmap_18878                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_18878_runs,
                    (long) ctx->mainzisegmap_18878_total_runtime /
                    (ctx->mainzisegmap_18878_runs !=
                     0 ? ctx->mainzisegmap_18878_runs : 1),
                    (long) ctx->mainzisegmap_18878_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_18878_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_18878_runs;
        str_builder(&builder,
                    "main.segmap_18942                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_18942_runs,
                    (long) ctx->mainzisegmap_18942_total_runtime /
                    (ctx->mainzisegmap_18942_runs !=
                     0 ? ctx->mainzisegmap_18942_runs : 1),
                    (long) ctx->mainzisegmap_18942_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_18942_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_18942_runs;
        str_builder(&builder,
                    "main.segred_large_18977               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_large_18977_runs,
                    (long) ctx->mainzisegred_large_18977_total_runtime /
                    (ctx->mainzisegred_large_18977_runs !=
                     0 ? ctx->mainzisegred_large_18977_runs : 1),
                    (long) ctx->mainzisegred_large_18977_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_large_18977_total_runtime;
        ctx->total_runs += ctx->mainzisegred_large_18977_runs;
        str_builder(&builder,
                    "main.segred_large_20069               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_large_20069_runs,
                    (long) ctx->mainzisegred_large_20069_total_runtime /
                    (ctx->mainzisegred_large_20069_runs !=
                     0 ? ctx->mainzisegred_large_20069_runs : 1),
                    (long) ctx->mainzisegred_large_20069_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_large_20069_total_runtime;
        ctx->total_runs += ctx->mainzisegred_large_20069_runs;
        str_builder(&builder,
                    "main.segred_nonseg_17056              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_17056_runs,
                    (long) ctx->mainzisegred_nonseg_17056_total_runtime /
                    (ctx->mainzisegred_nonseg_17056_runs !=
                     0 ? ctx->mainzisegred_nonseg_17056_runs : 1),
                    (long) ctx->mainzisegred_nonseg_17056_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_17056_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_17056_runs;
        str_builder(&builder,
                    "main.segred_nonseg_18835              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_18835_runs,
                    (long) ctx->mainzisegred_nonseg_18835_total_runtime /
                    (ctx->mainzisegred_nonseg_18835_runs !=
                     0 ? ctx->mainzisegred_nonseg_18835_runs : 1),
                    (long) ctx->mainzisegred_nonseg_18835_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_18835_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_18835_runs;
        str_builder(&builder,
                    "main.segred_nonseg_19031              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_19031_runs,
                    (long) ctx->mainzisegred_nonseg_19031_total_runtime /
                    (ctx->mainzisegred_nonseg_19031_runs !=
                     0 ? ctx->mainzisegred_nonseg_19031_runs : 1),
                    (long) ctx->mainzisegred_nonseg_19031_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_19031_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_19031_runs;
        str_builder(&builder,
                    "main.segred_nonseg_19606              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_19606_runs,
                    (long) ctx->mainzisegred_nonseg_19606_total_runtime /
                    (ctx->mainzisegred_nonseg_19606_runs !=
                     0 ? ctx->mainzisegred_nonseg_19606_runs : 1),
                    (long) ctx->mainzisegred_nonseg_19606_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_19606_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_19606_runs;
        str_builder(&builder,
                    "main.segred_nonseg_19757              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_19757_runs,
                    (long) ctx->mainzisegred_nonseg_19757_total_runtime /
                    (ctx->mainzisegred_nonseg_19757_runs !=
                     0 ? ctx->mainzisegred_nonseg_19757_runs : 1),
                    (long) ctx->mainzisegred_nonseg_19757_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_19757_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_19757_runs;
        str_builder(&builder,
                    "main.segred_small_18977               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_small_18977_runs,
                    (long) ctx->mainzisegred_small_18977_total_runtime /
                    (ctx->mainzisegred_small_18977_runs !=
                     0 ? ctx->mainzisegred_small_18977_runs : 1),
                    (long) ctx->mainzisegred_small_18977_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_small_18977_total_runtime;
        ctx->total_runs += ctx->mainzisegred_small_18977_runs;
        str_builder(&builder,
                    "main.segred_small_20069               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_small_20069_runs,
                    (long) ctx->mainzisegred_small_20069_total_runtime /
                    (ctx->mainzisegred_small_20069_runs !=
                     0 ? ctx->mainzisegred_small_20069_runs : 1),
                    (long) ctx->mainzisegred_small_20069_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_small_20069_total_runtime;
        ctx->total_runs += ctx->mainzisegred_small_20069_runs;
        str_builder(&builder, "%d operations with cumulative runtime: %6ldus\n",
                    ctx->total_runs, ctx->total_runtime);
    }
    return builder.str;
}
char *futhark_context_get_error(struct futhark_context *ctx)
{
    char *error = ctx->error;
    
    ctx->error = NULL;
    return error;
}
void futhark_context_pause_profiling(struct futhark_context *ctx)
{
    ctx->profiling_paused = 1;
}
void futhark_context_unpause_profiling(struct futhark_context *ctx)
{
    ctx->profiling_paused = 0;
}
static int futrts_builtinzhgpu_map_transpose_f32(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6);
static int futrts_builtinzhgpu_map_transpose_i64(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6);
static int futrts_builtinzhreplicate_i64(struct futhark_context *ctx,
                                         struct memblock_device mem_19872,
                                         int32_t num_elems_19873,
                                         int64_t val_19874);
static int futrts_main(struct futhark_context *ctx, float *out_scalar_out_20637,
                       struct memblock_device *out_mem_p_20638,
                       int64_t *out_out_arrsizze_20639, int64_t paths_16674,
                       int64_t steps_16675, float swap_term_16676,
                       int64_t payments_16677, float notional_16678,
                       float a_16679, float b_16680, float sigma_16681,
                       float r0_16682);
int init_constants(struct futhark_context *ctx)
{
    (void) ctx;
    
    int err = 0;
    
    
  cleanup:
    return err;
}
int free_constants(struct futhark_context *ctx)
{
    (void) ctx;
    return 0;
}
static int futrts_builtinzhgpu_map_transpose_f32(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6)
{
    (void) ctx;
    
    int err = 0;
    
    if (!(num_arrays_4 == 0 || (x_elems_5 == 0 || y_elems_6 == 0))) {
        int32_t muly_8 = squot32(16, x_elems_5);
        int32_t mulx_7 = squot32(16, y_elems_6);
        
        if (num_arrays_4 == 1 && (x_elems_5 == 1 || y_elems_6 == 1)) {
            if (sext_i32_i64(x_elems_5 * y_elems_6 * (int32_t) sizeof(float)) >
                0) {
                OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                             srcmem_2.mem,
                                                             destmem_0.mem,
                                                             sext_i32_i64(srcoffset_3),
                                                             sext_i32_i64(destoffset_1),
                                                             sext_i32_i64(x_elems_5 *
                                                             y_elems_6 *
                                                             (int32_t) sizeof(float)),
                                                             0, NULL,
                                                             ctx->profiling_paused ||
                                                             !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                       &ctx->copy_dev_to_dev_runs,
                                                                                                       &ctx->copy_dev_to_dev_total_runtime)));
                if (ctx->debugging)
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            }
        } else {
            if (sle32(x_elems_5, 8) && slt32(16, y_elems_6)) {
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        0, 1088, NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        1, sizeof(destoffset_1),
                                                        &destoffset_1));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        2, sizeof(srcoffset_3),
                                                        &srcoffset_3));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        3, sizeof(num_arrays_4),
                                                        &num_arrays_4));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        4, sizeof(x_elems_5),
                                                        &x_elems_5));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        5, sizeof(y_elems_6),
                                                        &y_elems_6));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        6, sizeof(mulx_7),
                                                        &mulx_7));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        7, sizeof(muly_8),
                                                        &muly_8));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        8,
                                                        sizeof(destmem_0.mem),
                                                        &destmem_0.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        9, sizeof(srcmem_2.mem),
                                                        &srcmem_2.mem));
                if (1 * ((size_t) sdiv_up32(x_elems_5, 16) * (size_t) 16) *
                    ((size_t) sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16) *
                     (size_t) 16) * ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                    const size_t global_work_sizze_20592[3] =
                                 {(size_t) sdiv_up32(x_elems_5, 16) *
                                  (size_t) 16,
                                  (size_t) sdiv_up32(sdiv_up32(y_elems_6,
                                                               muly_8), 16) *
                                  (size_t) 16, (size_t) num_arrays_4 *
                                  (size_t) 1};
                    const size_t local_work_sizze_20596[3] = {16, 16, 1};
                    int64_t time_start_20593 = 0, time_end_20594 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "gpu_map_transpose_f32_low_width");
                        fprintf(stderr, "%zu", global_work_sizze_20592[0]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", global_work_sizze_20592[1]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", global_work_sizze_20592[2]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_20596[0]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", local_work_sizze_20596[1]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", local_work_sizze_20596[2]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) (0 + 1088));
                        time_start_20593 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->gpu_map_transpose_f32_low_width,
                                                                    3, NULL,
                                                                    global_work_sizze_20592,
                                                                    local_work_sizze_20596,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->gpu_map_transpose_f32_low_width_runs,
                                                                                                              &ctx->gpu_map_transpose_f32_low_width_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_20594 = get_wall_time();
                        
                        long time_diff_20595 = time_end_20594 -
                             time_start_20593;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "gpu_map_transpose_f32_low_width",
                                time_diff_20595);
                    }
                }
            } else {
                if (sle32(y_elems_6, 8) && slt32(16, x_elems_5)) {
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            0, 1088, NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            1,
                                                            sizeof(destoffset_1),
                                                            &destoffset_1));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            2,
                                                            sizeof(srcoffset_3),
                                                            &srcoffset_3));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            3,
                                                            sizeof(num_arrays_4),
                                                            &num_arrays_4));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            4,
                                                            sizeof(x_elems_5),
                                                            &x_elems_5));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            5,
                                                            sizeof(y_elems_6),
                                                            &y_elems_6));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            6, sizeof(mulx_7),
                                                            &mulx_7));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            7, sizeof(muly_8),
                                                            &muly_8));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            8,
                                                            sizeof(destmem_0.mem),
                                                            &destmem_0.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            9,
                                                            sizeof(srcmem_2.mem),
                                                            &srcmem_2.mem));
                    if (1 * ((size_t) sdiv_up32(sdiv_up32(x_elems_5, mulx_7),
                                                16) * (size_t) 16) *
                        ((size_t) sdiv_up32(y_elems_6, 16) * (size_t) 16) *
                        ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                        const size_t global_work_sizze_20597[3] =
                                     {(size_t) sdiv_up32(sdiv_up32(x_elems_5,
                                                                   mulx_7),
                                                         16) * (size_t) 16,
                                      (size_t) sdiv_up32(y_elems_6, 16) *
                                      (size_t) 16, (size_t) num_arrays_4 *
                                      (size_t) 1};
                        const size_t local_work_sizze_20601[3] = {16, 16, 1};
                        int64_t time_start_20598 = 0, time_end_20599 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "gpu_map_transpose_f32_low_height");
                            fprintf(stderr, "%zu", global_work_sizze_20597[0]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", global_work_sizze_20597[1]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", global_work_sizze_20597[2]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_20601[0]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", local_work_sizze_20601[1]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", local_work_sizze_20601[2]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + 1088));
                            time_start_20598 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->gpu_map_transpose_f32_low_height,
                                                                        3, NULL,
                                                                        global_work_sizze_20597,
                                                                        local_work_sizze_20601,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->gpu_map_transpose_f32_low_height_runs,
                                                                                                                  &ctx->gpu_map_transpose_f32_low_height_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_20599 = get_wall_time();
                            
                            long time_diff_20600 = time_end_20599 -
                                 time_start_20598;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "gpu_map_transpose_f32_low_height",
                                    time_diff_20600);
                        }
                    }
                } else {
                    if (sle32(x_elems_5, 8) && sle32(y_elems_6, 8)) {
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                0, 1, NULL));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                1,
                                                                sizeof(destoffset_1),
                                                                &destoffset_1));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                2,
                                                                sizeof(srcoffset_3),
                                                                &srcoffset_3));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                3,
                                                                sizeof(num_arrays_4),
                                                                &num_arrays_4));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                4,
                                                                sizeof(x_elems_5),
                                                                &x_elems_5));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                5,
                                                                sizeof(y_elems_6),
                                                                &y_elems_6));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                6,
                                                                sizeof(mulx_7),
                                                                &mulx_7));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                7,
                                                                sizeof(muly_8),
                                                                &muly_8));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                8,
                                                                sizeof(destmem_0.mem),
                                                                &destmem_0.mem));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                9,
                                                                sizeof(srcmem_2.mem),
                                                                &srcmem_2.mem));
                        if (1 * ((size_t) sdiv_up32(num_arrays_4 * x_elems_5 *
                                                    y_elems_6, 256) *
                                 (size_t) 256) != 0) {
                            const size_t global_work_sizze_20602[1] =
                                         {(size_t) sdiv_up32(num_arrays_4 *
                                                             x_elems_5 *
                                                             y_elems_6, 256) *
                                         (size_t) 256};
                            const size_t local_work_sizze_20606[1] = {256};
                            int64_t time_start_20603 = 0, time_end_20604 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr,
                                        "Launching %s with global work size [",
                                        "gpu_map_transpose_f32_small");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_20602[0]);
                                fprintf(stderr, "] and local work size [");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_20606[0]);
                                fprintf(stderr,
                                        "]; local memory parameters sum to %d bytes.\n",
                                        (int) (0 + 1));
                                time_start_20603 = get_wall_time();
                            }
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                            ctx->gpu_map_transpose_f32_small,
                                                                            1,
                                                                            NULL,
                                                                            global_work_sizze_20602,
                                                                            local_work_sizze_20606,
                                                                            0,
                                                                            NULL,
                                                                            ctx->profiling_paused ||
                                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                      &ctx->gpu_map_transpose_f32_small_runs,
                                                                                                                      &ctx->gpu_map_transpose_f32_small_total_runtime)));
                            if (ctx->debugging) {
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                                time_end_20604 = get_wall_time();
                                
                                long time_diff_20605 = time_end_20604 -
                                     time_start_20603;
                                
                                fprintf(stderr, "kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_f32_small",
                                        time_diff_20605);
                            }
                        }
                    } else {
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                0, 4224, NULL));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                1,
                                                                sizeof(destoffset_1),
                                                                &destoffset_1));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                2,
                                                                sizeof(srcoffset_3),
                                                                &srcoffset_3));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                3,
                                                                sizeof(num_arrays_4),
                                                                &num_arrays_4));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                4,
                                                                sizeof(x_elems_5),
                                                                &x_elems_5));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                5,
                                                                sizeof(y_elems_6),
                                                                &y_elems_6));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                6,
                                                                sizeof(mulx_7),
                                                                &mulx_7));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                7,
                                                                sizeof(muly_8),
                                                                &muly_8));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                8,
                                                                sizeof(destmem_0.mem),
                                                                &destmem_0.mem));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                9,
                                                                sizeof(srcmem_2.mem),
                                                                &srcmem_2.mem));
                        if (1 * ((size_t) sdiv_up32(x_elems_5, 32) *
                                 (size_t) 32) * ((size_t) sdiv_up32(y_elems_6,
                                                                    32) *
                                                 (size_t) 8) *
                            ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                            const size_t global_work_sizze_20607[3] =
                                         {(size_t) sdiv_up32(x_elems_5, 32) *
                                          (size_t) 32,
                                          (size_t) sdiv_up32(y_elems_6, 32) *
                                          (size_t) 8, (size_t) num_arrays_4 *
                                          (size_t) 1};
                            const size_t local_work_sizze_20611[3] = {32, 8, 1};
                            int64_t time_start_20608 = 0, time_end_20609 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr,
                                        "Launching %s with global work size [",
                                        "gpu_map_transpose_f32");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_20607[0]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_20607[1]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_20607[2]);
                                fprintf(stderr, "] and local work size [");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_20611[0]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_20611[1]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_20611[2]);
                                fprintf(stderr,
                                        "]; local memory parameters sum to %d bytes.\n",
                                        (int) (0 + 4224));
                                time_start_20608 = get_wall_time();
                            }
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                            ctx->gpu_map_transpose_f32,
                                                                            3,
                                                                            NULL,
                                                                            global_work_sizze_20607,
                                                                            local_work_sizze_20611,
                                                                            0,
                                                                            NULL,
                                                                            ctx->profiling_paused ||
                                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                      &ctx->gpu_map_transpose_f32_runs,
                                                                                                                      &ctx->gpu_map_transpose_f32_total_runtime)));
                            if (ctx->debugging) {
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                                time_end_20609 = get_wall_time();
                                
                                long time_diff_20610 = time_end_20609 -
                                     time_start_20608;
                                
                                fprintf(stderr, "kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_f32",
                                        time_diff_20610);
                            }
                        }
                    }
                }
            }
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhgpu_map_transpose_i64(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6)
{
    (void) ctx;
    
    int err = 0;
    
    if (!(num_arrays_4 == 0 || (x_elems_5 == 0 || y_elems_6 == 0))) {
        int32_t muly_8 = squot32(16, x_elems_5);
        int32_t mulx_7 = squot32(16, y_elems_6);
        
        if (num_arrays_4 == 1 && (x_elems_5 == 1 || y_elems_6 == 1)) {
            if (sext_i32_i64(x_elems_5 * y_elems_6 *
                (int32_t) sizeof(int64_t)) > 0) {
                OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                             srcmem_2.mem,
                                                             destmem_0.mem,
                                                             sext_i32_i64(srcoffset_3),
                                                             sext_i32_i64(destoffset_1),
                                                             sext_i32_i64(x_elems_5 *
                                                             y_elems_6 *
                                                             (int32_t) sizeof(int64_t)),
                                                             0, NULL,
                                                             ctx->profiling_paused ||
                                                             !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                       &ctx->copy_dev_to_dev_runs,
                                                                                                       &ctx->copy_dev_to_dev_total_runtime)));
                if (ctx->debugging)
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            }
        } else {
            if (sle32(x_elems_5, 8) && slt32(16, y_elems_6)) {
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_width,
                                                        0, 2176, NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_width,
                                                        1, sizeof(destoffset_1),
                                                        &destoffset_1));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_width,
                                                        2, sizeof(srcoffset_3),
                                                        &srcoffset_3));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_width,
                                                        3, sizeof(num_arrays_4),
                                                        &num_arrays_4));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_width,
                                                        4, sizeof(x_elems_5),
                                                        &x_elems_5));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_width,
                                                        5, sizeof(y_elems_6),
                                                        &y_elems_6));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_width,
                                                        6, sizeof(mulx_7),
                                                        &mulx_7));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_width,
                                                        7, sizeof(muly_8),
                                                        &muly_8));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_width,
                                                        8,
                                                        sizeof(destmem_0.mem),
                                                        &destmem_0.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_width,
                                                        9, sizeof(srcmem_2.mem),
                                                        &srcmem_2.mem));
                if (1 * ((size_t) sdiv_up32(x_elems_5, 16) * (size_t) 16) *
                    ((size_t) sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16) *
                     (size_t) 16) * ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                    const size_t global_work_sizze_20612[3] =
                                 {(size_t) sdiv_up32(x_elems_5, 16) *
                                  (size_t) 16,
                                  (size_t) sdiv_up32(sdiv_up32(y_elems_6,
                                                               muly_8), 16) *
                                  (size_t) 16, (size_t) num_arrays_4 *
                                  (size_t) 1};
                    const size_t local_work_sizze_20616[3] = {16, 16, 1};
                    int64_t time_start_20613 = 0, time_end_20614 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "gpu_map_transpose_i64_low_width");
                        fprintf(stderr, "%zu", global_work_sizze_20612[0]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", global_work_sizze_20612[1]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", global_work_sizze_20612[2]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_20616[0]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", local_work_sizze_20616[1]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", local_work_sizze_20616[2]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) (0 + 2176));
                        time_start_20613 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->gpu_map_transpose_i64_low_width,
                                                                    3, NULL,
                                                                    global_work_sizze_20612,
                                                                    local_work_sizze_20616,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->gpu_map_transpose_i64_low_width_runs,
                                                                                                              &ctx->gpu_map_transpose_i64_low_width_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_20614 = get_wall_time();
                        
                        long time_diff_20615 = time_end_20614 -
                             time_start_20613;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "gpu_map_transpose_i64_low_width",
                                time_diff_20615);
                    }
                }
            } else {
                if (sle32(y_elems_6, 8) && slt32(16, x_elems_5)) {
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_height,
                                                            0, 2176, NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_height,
                                                            1,
                                                            sizeof(destoffset_1),
                                                            &destoffset_1));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_height,
                                                            2,
                                                            sizeof(srcoffset_3),
                                                            &srcoffset_3));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_height,
                                                            3,
                                                            sizeof(num_arrays_4),
                                                            &num_arrays_4));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_height,
                                                            4,
                                                            sizeof(x_elems_5),
                                                            &x_elems_5));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_height,
                                                            5,
                                                            sizeof(y_elems_6),
                                                            &y_elems_6));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_height,
                                                            6, sizeof(mulx_7),
                                                            &mulx_7));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_height,
                                                            7, sizeof(muly_8),
                                                            &muly_8));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_height,
                                                            8,
                                                            sizeof(destmem_0.mem),
                                                            &destmem_0.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_low_height,
                                                            9,
                                                            sizeof(srcmem_2.mem),
                                                            &srcmem_2.mem));
                    if (1 * ((size_t) sdiv_up32(sdiv_up32(x_elems_5, mulx_7),
                                                16) * (size_t) 16) *
                        ((size_t) sdiv_up32(y_elems_6, 16) * (size_t) 16) *
                        ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                        const size_t global_work_sizze_20617[3] =
                                     {(size_t) sdiv_up32(sdiv_up32(x_elems_5,
                                                                   mulx_7),
                                                         16) * (size_t) 16,
                                      (size_t) sdiv_up32(y_elems_6, 16) *
                                      (size_t) 16, (size_t) num_arrays_4 *
                                      (size_t) 1};
                        const size_t local_work_sizze_20621[3] = {16, 16, 1};
                        int64_t time_start_20618 = 0, time_end_20619 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "gpu_map_transpose_i64_low_height");
                            fprintf(stderr, "%zu", global_work_sizze_20617[0]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", global_work_sizze_20617[1]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", global_work_sizze_20617[2]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_20621[0]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", local_work_sizze_20621[1]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", local_work_sizze_20621[2]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + 2176));
                            time_start_20618 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->gpu_map_transpose_i64_low_height,
                                                                        3, NULL,
                                                                        global_work_sizze_20617,
                                                                        local_work_sizze_20621,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->gpu_map_transpose_i64_low_height_runs,
                                                                                                                  &ctx->gpu_map_transpose_i64_low_height_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_20619 = get_wall_time();
                            
                            long time_diff_20620 = time_end_20619 -
                                 time_start_20618;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "gpu_map_transpose_i64_low_height",
                                    time_diff_20620);
                        }
                    }
                } else {
                    if (sle32(x_elems_5, 8) && sle32(y_elems_6, 8)) {
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_small,
                                                                0, 1, NULL));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_small,
                                                                1,
                                                                sizeof(destoffset_1),
                                                                &destoffset_1));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_small,
                                                                2,
                                                                sizeof(srcoffset_3),
                                                                &srcoffset_3));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_small,
                                                                3,
                                                                sizeof(num_arrays_4),
                                                                &num_arrays_4));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_small,
                                                                4,
                                                                sizeof(x_elems_5),
                                                                &x_elems_5));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_small,
                                                                5,
                                                                sizeof(y_elems_6),
                                                                &y_elems_6));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_small,
                                                                6,
                                                                sizeof(mulx_7),
                                                                &mulx_7));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_small,
                                                                7,
                                                                sizeof(muly_8),
                                                                &muly_8));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_small,
                                                                8,
                                                                sizeof(destmem_0.mem),
                                                                &destmem_0.mem));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64_small,
                                                                9,
                                                                sizeof(srcmem_2.mem),
                                                                &srcmem_2.mem));
                        if (1 * ((size_t) sdiv_up32(num_arrays_4 * x_elems_5 *
                                                    y_elems_6, 256) *
                                 (size_t) 256) != 0) {
                            const size_t global_work_sizze_20622[1] =
                                         {(size_t) sdiv_up32(num_arrays_4 *
                                                             x_elems_5 *
                                                             y_elems_6, 256) *
                                         (size_t) 256};
                            const size_t local_work_sizze_20626[1] = {256};
                            int64_t time_start_20623 = 0, time_end_20624 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr,
                                        "Launching %s with global work size [",
                                        "gpu_map_transpose_i64_small");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_20622[0]);
                                fprintf(stderr, "] and local work size [");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_20626[0]);
                                fprintf(stderr,
                                        "]; local memory parameters sum to %d bytes.\n",
                                        (int) (0 + 1));
                                time_start_20623 = get_wall_time();
                            }
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                            ctx->gpu_map_transpose_i64_small,
                                                                            1,
                                                                            NULL,
                                                                            global_work_sizze_20622,
                                                                            local_work_sizze_20626,
                                                                            0,
                                                                            NULL,
                                                                            ctx->profiling_paused ||
                                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                      &ctx->gpu_map_transpose_i64_small_runs,
                                                                                                                      &ctx->gpu_map_transpose_i64_small_total_runtime)));
                            if (ctx->debugging) {
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                                time_end_20624 = get_wall_time();
                                
                                long time_diff_20625 = time_end_20624 -
                                     time_start_20623;
                                
                                fprintf(stderr, "kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_i64_small",
                                        time_diff_20625);
                            }
                        }
                    } else {
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64,
                                                                0, 8448, NULL));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64,
                                                                1,
                                                                sizeof(destoffset_1),
                                                                &destoffset_1));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64,
                                                                2,
                                                                sizeof(srcoffset_3),
                                                                &srcoffset_3));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64,
                                                                3,
                                                                sizeof(num_arrays_4),
                                                                &num_arrays_4));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64,
                                                                4,
                                                                sizeof(x_elems_5),
                                                                &x_elems_5));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64,
                                                                5,
                                                                sizeof(y_elems_6),
                                                                &y_elems_6));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64,
                                                                6,
                                                                sizeof(mulx_7),
                                                                &mulx_7));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64,
                                                                7,
                                                                sizeof(muly_8),
                                                                &muly_8));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64,
                                                                8,
                                                                sizeof(destmem_0.mem),
                                                                &destmem_0.mem));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_i64,
                                                                9,
                                                                sizeof(srcmem_2.mem),
                                                                &srcmem_2.mem));
                        if (1 * ((size_t) sdiv_up32(x_elems_5, 32) *
                                 (size_t) 32) * ((size_t) sdiv_up32(y_elems_6,
                                                                    32) *
                                                 (size_t) 8) *
                            ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                            const size_t global_work_sizze_20627[3] =
                                         {(size_t) sdiv_up32(x_elems_5, 32) *
                                          (size_t) 32,
                                          (size_t) sdiv_up32(y_elems_6, 32) *
                                          (size_t) 8, (size_t) num_arrays_4 *
                                          (size_t) 1};
                            const size_t local_work_sizze_20631[3] = {32, 8, 1};
                            int64_t time_start_20628 = 0, time_end_20629 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr,
                                        "Launching %s with global work size [",
                                        "gpu_map_transpose_i64");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_20627[0]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_20627[1]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_20627[2]);
                                fprintf(stderr, "] and local work size [");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_20631[0]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_20631[1]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_20631[2]);
                                fprintf(stderr,
                                        "]; local memory parameters sum to %d bytes.\n",
                                        (int) (0 + 8448));
                                time_start_20628 = get_wall_time();
                            }
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                            ctx->gpu_map_transpose_i64,
                                                                            3,
                                                                            NULL,
                                                                            global_work_sizze_20627,
                                                                            local_work_sizze_20631,
                                                                            0,
                                                                            NULL,
                                                                            ctx->profiling_paused ||
                                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                      &ctx->gpu_map_transpose_i64_runs,
                                                                                                                      &ctx->gpu_map_transpose_i64_total_runtime)));
                            if (ctx->debugging) {
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                                time_end_20629 = get_wall_time();
                                
                                long time_diff_20630 = time_end_20629 -
                                     time_start_20628;
                                
                                fprintf(stderr, "kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_i64",
                                        time_diff_20630);
                            }
                        }
                    }
                }
            }
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhreplicate_i64(struct futhark_context *ctx,
                                         struct memblock_device mem_19872,
                                         int32_t num_elems_19873,
                                         int64_t val_19874)
{
    (void) ctx;
    
    int err = 0;
    int64_t group_sizze_19879;
    
    group_sizze_19879 = ctx->sizes.builtinzhreplicate_i64zigroup_sizze_19879;
    
    int64_t num_groups_19880;
    
    num_groups_19880 = sdiv_up64(num_elems_19873, group_sizze_19879);
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_i64zireplicate_19876,
                                            0, sizeof(mem_19872.mem),
                                            &mem_19872.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_i64zireplicate_19876,
                                            1, sizeof(num_elems_19873),
                                            &num_elems_19873));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_i64zireplicate_19876,
                                            2, sizeof(val_19874), &val_19874));
    if (1 * ((size_t) num_groups_19880 * (size_t) group_sizze_19879) != 0) {
        const size_t global_work_sizze_20632[1] = {(size_t) num_groups_19880 *
                     (size_t) group_sizze_19879};
        const size_t local_work_sizze_20636[1] = {group_sizze_19879};
        int64_t time_start_20633 = 0, time_end_20634 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "builtin#replicate_i64.replicate_19876");
            fprintf(stderr, "%zu", global_work_sizze_20632[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_20636[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_20633 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->builtinzhreplicate_i64zireplicate_19876,
                                                        1, NULL,
                                                        global_work_sizze_20632,
                                                        local_work_sizze_20636,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->builtinzhreplicate_i64zireplicate_19876_runs,
                                                                                                  &ctx->builtinzhreplicate_i64zireplicate_19876_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_20634 = get_wall_time();
            
            long time_diff_20635 = time_end_20634 - time_start_20633;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n",
                    "builtin#replicate_i64.replicate_19876", time_diff_20635);
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_main(struct futhark_context *ctx, float *out_scalar_out_20637,
                       struct memblock_device *out_mem_p_20638,
                       int64_t *out_out_arrsizze_20639, int64_t paths_16674,
                       int64_t steps_16675, float swap_term_16676,
                       int64_t payments_16677, float notional_16678,
                       float a_16679, float b_16680, float sigma_16681,
                       float r0_16682)
{
    (void) ctx;
    
    int err = 0;
    float scalar_out_19785;
    struct memblock_device out_mem_19786;
    
    out_mem_19786.references = NULL;
    
    int64_t out_arrsizze_19787;
    float res_16683 = sitofp_i64_f32(payments_16677);
    float x_16684 = swap_term_16676 * res_16683;
    float res_16685 = sitofp_i64_f32(steps_16675);
    float dt_16686 = x_16684 / res_16685;
    float sims_per_year_16687 = res_16685 / x_16684;
    bool bounds_invalid_upwards_16688 = slt64(steps_16675, 1);
    bool valid_16689 = !bounds_invalid_upwards_16688;
    bool range_valid_c_16690;
    
    if (!valid_16689) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 1, "..", 2, "...", steps_16675,
                               " is invalid.",
                               "-> #0  cva.fut:75:56-67\n   #1  cva.fut:112:17-40\n   #2  cva.fut:105:1-138:18\n");
        if (memblock_unref_device(ctx, &out_mem_19786, "out_mem_19786") != 0)
            return 1;
        return 1;
    }
    
    bool bounds_invalid_upwards_16696 = slt64(paths_16674, 0);
    bool valid_16697 = !bounds_invalid_upwards_16696;
    bool range_valid_c_16698;
    
    if (!valid_16697) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", paths_16674,
                               " is invalid.",
                               "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:126:11-16\n   #2  lib/github.com/diku-dk/cpprandom/random.fut:174:8-56\n   #3  cva.fut:113:19-49\n   #4  cva.fut:105:1-138:18\n");
        if (memblock_unref_device(ctx, &out_mem_19786, "out_mem_19786") != 0)
            return 1;
        return 1;
    }
    
    int64_t upper_bound_16701 = sub64(steps_16675, 1);
    float res_16702;
    
    res_16702 = futrts_sqrt32(dt_16686);
    
    int64_t segscan_group_sizze_17040;
    
    segscan_group_sizze_17040 = ctx->sizes.mainzisegscan_group_sizze_17039;
    
    int64_t num_groups_17042;
    int32_t max_num_groups_19788;
    
    max_num_groups_19788 = ctx->sizes.mainzisegscan_num_groups_17041;
    num_groups_17042 = sext_i64_i32(smax64(1, smin64(sdiv_up64(steps_16675,
                                                               sext_i32_i64(segscan_group_sizze_17040)),
                                                     sext_i32_i64(max_num_groups_19788))));
    
    int64_t bytes_19264 = 8 * steps_16675;
    struct memblock_device mem_19265;
    
    mem_19265.references = NULL;
    if (memblock_alloc_device(ctx, &mem_19265, bytes_19264, "mem_19265")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_19267;
    
    mem_19267.references = NULL;
    if (memblock_alloc_device(ctx, &mem_19267, bytes_19264, "mem_19267")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_19268 = 4 * steps_16675;
    struct memblock_device mem_19269;
    
    mem_19269.references = NULL;
    if (memblock_alloc_device(ctx, &mem_19269, bytes_19268, "mem_19269")) {
        err = 1;
        goto cleanup;
    }
    if (slt64(0, steps_16675)) {
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegScan");
        
        int64_t stage1_max_num_groups_19789;
        
        stage1_max_num_groups_19789 = ctx->opencl.max_group_size;
        
        int64_t stage1_num_groups_19790;
        
        stage1_num_groups_19790 = smin64(stage1_max_num_groups_19789,
                                         num_groups_17042);
        
        int32_t num_threads_19791;
        
        num_threads_19791 = sext_i64_i32(stage1_num_groups_19790 *
            segscan_group_sizze_17040);
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17045, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(int64_t) *
                                                       segscan_group_sizze_17040),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17045, 2,
                                                sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17045, 3,
                                                sizeof(swap_term_16676),
                                                &swap_term_16676));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17045, 4,
                                                sizeof(payments_16677),
                                                &payments_16677));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17045, 5,
                                                sizeof(sims_per_year_16687),
                                                &sims_per_year_16687));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17045, 6,
                                                sizeof(mem_19265.mem),
                                                &mem_19265.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17045, 7,
                                                sizeof(mem_19267.mem),
                                                &mem_19267.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17045, 8,
                                                sizeof(mem_19269.mem),
                                                &mem_19269.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17045, 9,
                                                sizeof(num_threads_19791),
                                                &num_threads_19791));
        if (1 * ((size_t) stage1_num_groups_19790 *
                 (size_t) segscan_group_sizze_17040) != 0) {
            const size_t global_work_sizze_20640[1] =
                         {(size_t) stage1_num_groups_19790 *
                         (size_t) segscan_group_sizze_17040};
            const size_t local_work_sizze_20644[1] =
                         {segscan_group_sizze_17040};
            int64_t time_start_20641 = 0, time_end_20642 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage1_17045");
                fprintf(stderr, "%zu", global_work_sizze_20640[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20644[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                          segscan_group_sizze_17040)));
                time_start_20641 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage1_17045,
                                                            1, NULL,
                                                            global_work_sizze_20640,
                                                            local_work_sizze_20644,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage1_17045_runs,
                                                                                                      &ctx->mainziscan_stage1_17045_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20642 = get_wall_time();
                
                long time_diff_20643 = time_end_20642 - time_start_20641;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage1_17045", time_diff_20643);
            }
        }
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "elems_per_group",
                    (long long) (segscan_group_sizze_17040 *
                                 sdiv_up64(steps_16675,
                                           sext_i32_i64(num_threads_19791))),
                    '\n');
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17045, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(int64_t) *
                                                       stage1_num_groups_19790),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17045, 2,
                                                sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17045, 3,
                                                sizeof(mem_19265.mem),
                                                &mem_19265.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17045, 4,
                                                sizeof(stage1_num_groups_19790),
                                                &stage1_num_groups_19790));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17045, 5,
                                                sizeof(num_threads_19791),
                                                &num_threads_19791));
        if (1 * ((size_t) 1 * (size_t) stage1_num_groups_19790) != 0) {
            const size_t global_work_sizze_20645[1] = {(size_t) 1 *
                         (size_t) stage1_num_groups_19790};
            const size_t local_work_sizze_20649[1] = {stage1_num_groups_19790};
            int64_t time_start_20646 = 0, time_end_20647 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage2_17045");
                fprintf(stderr, "%zu", global_work_sizze_20645[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20649[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                          stage1_num_groups_19790)));
                time_start_20646 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage2_17045,
                                                            1, NULL,
                                                            global_work_sizze_20645,
                                                            local_work_sizze_20649,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage2_17045_runs,
                                                                                                      &ctx->mainziscan_stage2_17045_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20647 = get_wall_time();
                
                long time_diff_20648 = time_end_20647 - time_start_20646;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage2_17045", time_diff_20648);
            }
        }
        
        int32_t required_groups_19827;
        
        required_groups_19827 = sext_i64_i32(sdiv_up64(steps_16675,
                                                       segscan_group_sizze_17040));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17045, 1,
                                                sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17045, 2,
                                                sizeof(num_groups_17042),
                                                &num_groups_17042));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17045, 3,
                                                sizeof(mem_19265.mem),
                                                &mem_19265.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17045, 4,
                                                sizeof(num_threads_19791),
                                                &num_threads_19791));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17045, 5,
                                                sizeof(required_groups_19827),
                                                &required_groups_19827));
        if (1 * ((size_t) num_groups_17042 *
                 (size_t) segscan_group_sizze_17040) != 0) {
            const size_t global_work_sizze_20650[1] =
                         {(size_t) num_groups_17042 *
                         (size_t) segscan_group_sizze_17040};
            const size_t local_work_sizze_20654[1] =
                         {segscan_group_sizze_17040};
            int64_t time_start_20651 = 0, time_end_20652 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage3_17045");
                fprintf(stderr, "%zu", global_work_sizze_20650[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20654[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_20651 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage3_17045,
                                                            1, NULL,
                                                            global_work_sizze_20650,
                                                            local_work_sizze_20654,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage3_17045_runs,
                                                                                                      &ctx->mainziscan_stage3_17045_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20652 = get_wall_time();
                
                long time_diff_20653 = time_end_20652 - time_start_20651;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage3_17045", time_diff_20653);
            }
        }
    }
    
    int64_t segred_group_sizze_17048;
    
    segred_group_sizze_17048 = ctx->sizes.mainzisegred_group_sizze_17047;
    
    int64_t num_groups_17050;
    int32_t max_num_groups_19839;
    
    max_num_groups_19839 = ctx->sizes.mainzisegred_num_groups_17049;
    num_groups_17050 = sext_i64_i32(smax64(1, smin64(sdiv_up64(steps_16675,
                                                               sext_i32_i64(segred_group_sizze_17048)),
                                                     sext_i32_i64(max_num_groups_19839))));
    
    struct memblock_device mem_19272;
    
    mem_19272.references = NULL;
    if (memblock_alloc_device(ctx, &mem_19272, 8, "mem_19272")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_19274;
    
    mem_19274.references = NULL;
    if (memblock_alloc_device(ctx, &mem_19274, bytes_19264, "mem_19274")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mainzicounter_mem_19840 =
                           ctx->mainzicounter_mem_19840;
    struct memblock_device group_res_arr_mem_19842;
    
    group_res_arr_mem_19842.references = NULL;
    if (memblock_alloc_device(ctx, &group_res_arr_mem_19842,
                              (int32_t) sizeof(int64_t) *
                              (segred_group_sizze_17048 * num_groups_17050),
                              "group_res_arr_mem_19842")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_threads_19844;
    
    num_threads_19844 = num_groups_17050 * segred_group_sizze_17048;
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegRed");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 1,
                                            (int32_t) sizeof(int64_t) *
                                            segred_group_sizze_17048, NULL));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 2,
                                            (int32_t) sizeof(bool), NULL));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 3,
                                            sizeof(steps_16675), &steps_16675));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 4,
                                            sizeof(num_groups_17050),
                                            &num_groups_17050));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 5,
                                            sizeof(mem_19265.mem),
                                            &mem_19265.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 6,
                                            sizeof(mem_19267.mem),
                                            &mem_19267.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 7,
                                            sizeof(mem_19272.mem),
                                            &mem_19272.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 8,
                                            sizeof(mem_19274.mem),
                                            &mem_19274.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 9,
                                            sizeof(mainzicounter_mem_19840.mem),
                                            &mainzicounter_mem_19840.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 10,
                                            sizeof(group_res_arr_mem_19842.mem),
                                            &group_res_arr_mem_19842.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_17056, 11,
                                            sizeof(num_threads_19844),
                                            &num_threads_19844));
    if (1 * ((size_t) num_groups_17050 * (size_t) segred_group_sizze_17048) !=
        0) {
        const size_t global_work_sizze_20656[1] = {(size_t) num_groups_17050 *
                     (size_t) segred_group_sizze_17048};
        const size_t local_work_sizze_20660[1] = {segred_group_sizze_17048};
        int64_t time_start_20657 = 0, time_end_20658 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "main.segred_nonseg_17056");
            fprintf(stderr, "%zu", global_work_sizze_20656[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_20660[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) (0 + (int32_t) sizeof(int64_t) *
                           segred_group_sizze_17048 + (int32_t) sizeof(bool)));
            time_start_20657 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->mainzisegred_nonseg_17056,
                                                        1, NULL,
                                                        global_work_sizze_20656,
                                                        local_work_sizze_20660,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->mainzisegred_nonseg_17056_runs,
                                                                                                  &ctx->mainzisegred_nonseg_17056_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_20658 = get_wall_time();
            
            long time_diff_20659 = time_end_20658 - time_start_20657;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n",
                    "main.segred_nonseg_17056", time_diff_20659);
        }
    }
    if (memblock_unref_device(ctx, &mem_19265, "mem_19265") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_19267, "mem_19267") != 0)
        return 1;
    
    int64_t read_res_20661;
    
    OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                 mem_19272.mem,
                                                 ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                 0 * sizeof(int64_t),
                                                 sizeof(int64_t),
                                                 &read_res_20661, 0, NULL,
                                                 ctx->profiling_paused ||
                                                 !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                           &ctx->copy_scalar_from_dev_runs,
                                                                                           &ctx->copy_scalar_from_dev_total_runtime)));
    if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
        return 1;
    
    int64_t res_16723 = read_res_20661;
    
    if (memblock_unref_device(ctx, &mem_19272, "mem_19272") != 0)
        return 1;
    
    bool bounds_invalid_upwards_16733 = slt64(res_16723, 0);
    bool valid_16734 = !bounds_invalid_upwards_16733;
    bool range_valid_c_16735;
    
    if (!valid_16734) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", res_16723,
                               " is invalid.",
                               "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:70:18-23\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:48:30-60\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:87:14-32\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:130:37-88\n   #6  cva.fut:129:21-131:66\n   #7  cva.fut:105:1-138:18\n");
        if (memblock_unref_device(ctx, &group_res_arr_mem_19842,
                                  "group_res_arr_mem_19842") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19274, "mem_19274") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19272, "mem_19272") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19269, "mem_19269") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19267, "mem_19267") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19265, "mem_19265") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_19786, "out_mem_19786") != 0)
            return 1;
        return 1;
    }
    
    bool cond_16737 = slt64(0, res_16723);
    bool suff_outer_par_17058;
    
    suff_outer_par_17058 = ctx->sizes.mainzisuff_outer_par_0 <= paths_16674;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_outer_par_0",
                paths_16674);
    
    int64_t segmap_group_sizze_17361;
    
    segmap_group_sizze_17361 = ctx->sizes.mainzisegmap_group_sizze_17117;
    
    int64_t num_groups_17362;
    int32_t max_num_groups_19870;
    
    max_num_groups_19870 = ctx->sizes.mainzisegmap_num_groups_17119;
    num_groups_17362 = sext_i64_i32(smax64(1, smin64(sdiv_up64(paths_16674,
                                                               sext_i32_i64(segmap_group_sizze_17361)),
                                                     sext_i32_i64(max_num_groups_19870))));
    
    int64_t segmap_group_sizze_18434;
    
    segmap_group_sizze_18434 = ctx->sizes.mainzisegmap_group_sizze_18417;
    
    int64_t nest_sizze_18458 = paths_16674 * steps_16675;
    int64_t segmap_group_sizze_18459;
    
    segmap_group_sizze_18459 = ctx->sizes.mainzisegmap_group_sizze_18354;
    
    int64_t segmap_group_sizze_18504;
    
    segmap_group_sizze_18504 = ctx->sizes.mainzisegmap_group_sizze_18255;
    
    int64_t num_groups_18505;
    int32_t max_num_groups_19871;
    
    max_num_groups_19871 = ctx->sizes.mainzisegmap_num_groups_18257;
    num_groups_18505 = sext_i64_i32(smax64(1, smin64(sdiv_up64(paths_16674,
                                                               sext_i32_i64(segmap_group_sizze_18504)),
                                                     sext_i32_i64(max_num_groups_19871))));
    
    int64_t binop_x_19276 = paths_16674 * res_16723;
    int64_t bytes_19275 = 8 * binop_x_19276;
    struct memblock_device mem_19277;
    
    mem_19277.references = NULL;
    if (memblock_alloc_device(ctx, &mem_19277, bytes_19275, "mem_19277")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_19277, paths_16674 * res_16723,
                                      0) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t seghist_group_sizze_18546;
    
    seghist_group_sizze_18546 = ctx->sizes.mainziseghist_group_sizze_18208;
    
    int64_t num_groups_18547;
    int32_t max_num_groups_19881;
    
    max_num_groups_19881 = ctx->sizes.mainziseghist_num_groups_18210;
    num_groups_18547 = sext_i64_i32(smax64(1, smin64(sdiv_up64(nest_sizze_18458,
                                                               sext_i32_i64(seghist_group_sizze_18546)),
                                                     sext_i32_i64(max_num_groups_19881))));
    
    int64_t segscan_group_sizze_18557;
    
    segscan_group_sizze_18557 = ctx->sizes.mainzisegscan_group_sizze_18187;
    
    int64_t num_groups_18558;
    int32_t max_num_groups_19882;
    
    max_num_groups_19882 = ctx->sizes.mainzisegscan_num_groups_18189;
    num_groups_18558 = sext_i64_i32(smax64(1, smin64(sdiv_up64(binop_x_19276,
                                                               sext_i32_i64(segscan_group_sizze_18557)),
                                                     sext_i32_i64(max_num_groups_19882))));
    
    int64_t segscan_group_sizze_18588;
    
    segscan_group_sizze_18588 = ctx->sizes.mainzisegscan_group_sizze_18144;
    
    int64_t num_groups_18589;
    int32_t max_num_groups_19883;
    
    max_num_groups_19883 = ctx->sizes.mainzisegscan_num_groups_18146;
    num_groups_18589 = sext_i64_i32(smax64(1, smin64(sdiv_up64(binop_x_19276,
                                                               sext_i32_i64(segscan_group_sizze_18588)),
                                                     sext_i32_i64(max_num_groups_19883))));
    
    int64_t segscan_group_sizze_18629;
    
    segscan_group_sizze_18629 = ctx->sizes.mainzisegscan_group_sizze_18036;
    
    int64_t num_groups_18630;
    int32_t max_num_groups_19884;
    
    max_num_groups_19884 = ctx->sizes.mainzisegscan_num_groups_18038;
    num_groups_18630 = sext_i64_i32(smax64(1, smin64(sdiv_up64(binop_x_19276,
                                                               sext_i32_i64(segscan_group_sizze_18629)),
                                                     sext_i32_i64(max_num_groups_19884))));
    
    int64_t segscan_group_sizze_18767;
    
    segscan_group_sizze_18767 = ctx->sizes.mainzisegscan_group_sizze_17928;
    
    int64_t num_groups_18768;
    int32_t max_num_groups_19885;
    
    max_num_groups_19885 = ctx->sizes.mainzisegscan_num_groups_17930;
    num_groups_18768 = sext_i64_i32(smax64(1, smin64(sdiv_up64(binop_x_19276,
                                                               sext_i32_i64(segscan_group_sizze_18767)),
                                                     sext_i32_i64(max_num_groups_19885))));
    
    int64_t segmap_group_sizze_18778;
    
    segmap_group_sizze_18778 = ctx->sizes.mainzisegmap_group_sizze_17896;
    
    int64_t num_groups_18779;
    int32_t max_num_groups_19886;
    
    max_num_groups_19886 = ctx->sizes.mainzisegmap_num_groups_17898;
    num_groups_18779 = sext_i64_i32(smax64(1, smin64(sdiv_up64(paths_16674,
                                                               sext_i32_i64(segmap_group_sizze_18778)),
                                                     sext_i32_i64(max_num_groups_19886))));
    
    int64_t segmap_group_sizze_18815;
    
    segmap_group_sizze_18815 = ctx->sizes.mainzisegmap_group_sizze_17867;
    
    int64_t bytes_19405 = 4 * nest_sizze_18458;
    int64_t bytes_19307 = 8 * res_16723;
    int64_t bytes_19335 = 4 * res_16723;
    int64_t bytes_19459 = 4 * paths_16674;
    int64_t bytes_19507 = 4 * binop_x_19276;
    int64_t num_threads_19582 = segmap_group_sizze_17361 * num_groups_17362;
    int64_t total_sizze_19583 = bytes_19268 * num_threads_19582;
    int64_t total_sizze_19584 = bytes_19268 * num_threads_19582;
    int64_t total_sizze_19585 = bytes_19307 * num_threads_19582;
    int64_t total_sizze_19586 = bytes_19307 * num_threads_19582;
    int64_t total_sizze_19587 = bytes_19335 * num_threads_19582;
    int64_t total_sizze_19588 = res_16723 * num_threads_19582;
    int64_t total_sizze_19589 = bytes_19307 * num_threads_19582;
    int64_t total_sizze_19590 = bytes_19268 * num_threads_19582;
    int64_t segred_num_groups_19600;
    
    segred_num_groups_19600 = ctx->sizes.mainzisegred_num_groups_19599;
    
    int64_t segred_group_sizze_19602;
    
    segred_group_sizze_19602 = ctx->sizes.mainzisegred_group_sizze_19601;
    
    int64_t bytes_19669 = 8 * res_16723;
    int64_t bytes_19683 = 8 * res_16723;
    int64_t bytes_19711 = 8 * res_16723;
    int64_t num_threads_19727 = segred_num_groups_19600 *
            segred_group_sizze_19602;
    int64_t total_sizze_19728 = bytes_19669 * num_threads_19727;
    int64_t total_sizze_19729 = bytes_19683 * num_threads_19727;
    int64_t total_sizze_19730 = res_16723 * num_threads_19727;
    int64_t total_sizze_19731 = bytes_19711 * num_threads_19727;
    int64_t num_threads_19734 = segmap_group_sizze_18504 * num_groups_18505;
    int64_t total_sizze_19735 = bytes_19268 * num_threads_19734;
    int64_t num_threads_19741 = segmap_group_sizze_18778 * num_groups_18779;
    int64_t segred_num_groups_19751;
    
    segred_num_groups_19751 = ctx->sizes.mainzisegred_num_groups_19750;
    
    int64_t segred_group_sizze_19753;
    
    segred_group_sizze_19753 = ctx->sizes.mainzisegred_group_sizze_19752;
    
    struct memblock_device res_mem_19549;
    
    res_mem_19549.references = NULL;
    
    int32_t local_memory_capacity_20454;
    
    local_memory_capacity_20454 = ctx->opencl.max_local_memory;
    if ((sle64((int32_t) sizeof(bool) + (int32_t) sizeof(int64_t) *
               segred_group_sizze_19602,
               sext_i32_i64(local_memory_capacity_20454)) && sle64(0,
                                                                   sext_i32_i64(local_memory_capacity_20454))) &&
        suff_outer_par_17058) {
        struct memblock_device mem_19407;
        
        mem_19407.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19407, bytes_19405, "mem_19407")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19280;
        
        mem_19280.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19280, total_sizze_19583,
                                  "mem_19280")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19294;
        
        mem_19294.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19294, total_sizze_19584,
                                  "mem_19294")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19308;
        
        mem_19308.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19308, total_sizze_19585,
                                  "mem_19308")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19322;
        
        mem_19322.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19322, total_sizze_19586,
                                  "mem_19322")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19336;
        
        mem_19336.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19336, total_sizze_19587,
                                  "mem_19336")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19338;
        
        mem_19338.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19338, total_sizze_19588,
                                  "mem_19338")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19364;
        
        mem_19364.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19364, total_sizze_19589,
                                  "mem_19364")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19392;
        
        mem_19392.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19392, total_sizze_19590,
                                  "mem_19392")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19726;
        
        mem_19726.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19726, 8, "mem_19726")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19670;
        
        mem_19670.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19670, total_sizze_19728,
                                  "mem_19670")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19684;
        
        mem_19684.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19684, total_sizze_19729,
                                  "mem_19684")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19698;
        
        mem_19698.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19698, total_sizze_19730,
                                  "mem_19698")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19712;
        
        mem_19712.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19712, total_sizze_19731,
                                  "mem_19712")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mainzicounter_mem_19887 =
                               ctx->mainzicounter_mem_19887;
        struct memblock_device group_res_arr_mem_19889;
        
        group_res_arr_mem_19889.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_19889,
                                  (int32_t) sizeof(int64_t) *
                                  (segred_group_sizze_19602 *
                                   segred_num_groups_19600),
                                  "group_res_arr_mem_19889")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_19891;
        
        num_threads_19891 = segred_num_groups_19600 * segred_group_sizze_19602;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                3, (int32_t) sizeof(int64_t) *
                                                segred_group_sizze_19602,
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                4, (int32_t) sizeof(bool),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                5, sizeof(paths_16674),
                                                &paths_16674));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                6, sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                7, sizeof(res_16723),
                                                &res_16723));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                8, sizeof(cond_16737),
                                                &cond_16737));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                9, sizeof(mem_19274.mem),
                                                &mem_19274.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                10, sizeof(mem_19670.mem),
                                                &mem_19670.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                11, sizeof(mem_19684.mem),
                                                &mem_19684.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                12, sizeof(mem_19698.mem),
                                                &mem_19698.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                13, sizeof(mem_19712.mem),
                                                &mem_19712.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                14, sizeof(mem_19726.mem),
                                                &mem_19726.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                15,
                                                sizeof(mainzicounter_mem_19887.mem),
                                                &mainzicounter_mem_19887.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                16,
                                                sizeof(group_res_arr_mem_19889.mem),
                                                &group_res_arr_mem_19889.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19606,
                                                17, sizeof(num_threads_19891),
                                                &num_threads_19891));
        if (1 * ((size_t) segred_num_groups_19600 *
                 (size_t) segred_group_sizze_19602) != 0) {
            const size_t global_work_sizze_20663[1] =
                         {(size_t) segred_num_groups_19600 *
                         (size_t) segred_group_sizze_19602};
            const size_t local_work_sizze_20667[1] = {segred_group_sizze_19602};
            int64_t time_start_20664 = 0, time_end_20665 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segred_nonseg_19606");
                fprintf(stderr, "%zu", global_work_sizze_20663[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20667[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + (int32_t) sizeof(int64_t) *
                               segred_group_sizze_19602 +
                               (int32_t) sizeof(bool)));
                time_start_20664 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegred_nonseg_19606,
                                                            1, NULL,
                                                            global_work_sizze_20663,
                                                            local_work_sizze_20667,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegred_nonseg_19606_runs,
                                                                                                      &ctx->mainzisegred_nonseg_19606_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20665 = get_wall_time();
                
                long time_diff_20666 = time_end_20665 - time_start_20664;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segred_nonseg_19606", time_diff_20666);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_unref_device(ctx, &mem_19670, "mem_19670") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19684, "mem_19684") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19698, "mem_19698") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19712, "mem_19712") != 0)
            return 1;
        
        int64_t read_res_20668;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_19726.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0 * sizeof(int64_t),
                                                     sizeof(int64_t),
                                                     &read_res_20668, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        int64_t max_per_thread_19596 = read_res_20668;
        
        if (memblock_unref_device(ctx, &mem_19726, "mem_19726") != 0)
            return 1;
        
        int64_t sizze_sum_19665 = num_threads_19582 * max_per_thread_19596;
        struct memblock_device mem_19378;
        
        mem_19378.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19378, sizze_sum_19665,
                                  "mem_19378")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 3,
                                                sizeof(paths_16674),
                                                &paths_16674));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 4,
                                                sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 5,
                                                sizeof(swap_term_16676),
                                                &swap_term_16676));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 6,
                                                sizeof(payments_16677),
                                                &payments_16677));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 7,
                                                sizeof(notional_16678),
                                                &notional_16678));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 8,
                                                sizeof(a_16679), &a_16679));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 9,
                                                sizeof(b_16680), &b_16680));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 10,
                                                sizeof(sigma_16681),
                                                &sigma_16681));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 11,
                                                sizeof(r0_16682), &r0_16682));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 12,
                                                sizeof(dt_16686), &dt_16686));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 13,
                                                sizeof(sims_per_year_16687),
                                                &sims_per_year_16687));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 14,
                                                sizeof(upper_bound_16701),
                                                &upper_bound_16701));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 15,
                                                sizeof(res_16702), &res_16702));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 16,
                                                sizeof(res_16723), &res_16723));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 17,
                                                sizeof(cond_16737),
                                                &cond_16737));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 18,
                                                sizeof(num_groups_17362),
                                                &num_groups_17362));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 19,
                                                sizeof(mem_19274.mem),
                                                &mem_19274.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 20,
                                                sizeof(mem_19280.mem),
                                                &mem_19280.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 21,
                                                sizeof(mem_19294.mem),
                                                &mem_19294.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 22,
                                                sizeof(mem_19308.mem),
                                                &mem_19308.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 23,
                                                sizeof(mem_19322.mem),
                                                &mem_19322.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 24,
                                                sizeof(mem_19336.mem),
                                                &mem_19336.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 25,
                                                sizeof(mem_19338.mem),
                                                &mem_19338.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 26,
                                                sizeof(mem_19364.mem),
                                                &mem_19364.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 27,
                                                sizeof(mem_19378.mem),
                                                &mem_19378.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 28,
                                                sizeof(mem_19392.mem),
                                                &mem_19392.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 29,
                                                sizeof(mem_19407.mem),
                                                &mem_19407.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17115, 30,
                                                sizeof(num_threads_19582),
                                                &num_threads_19582));
        if (1 * ((size_t) num_groups_17362 *
                 (size_t) segmap_group_sizze_17361) != 0) {
            const size_t global_work_sizze_20669[1] =
                         {(size_t) num_groups_17362 *
                         (size_t) segmap_group_sizze_17361};
            const size_t local_work_sizze_20673[1] = {segmap_group_sizze_17361};
            int64_t time_start_20670 = 0, time_end_20671 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_17115");
                fprintf(stderr, "%zu", global_work_sizze_20669[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20673[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_20670 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_17115,
                                                            1, NULL,
                                                            global_work_sizze_20669,
                                                            local_work_sizze_20673,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_17115_runs,
                                                                                                      &ctx->mainzisegmap_17115_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20671 = get_wall_time();
                
                long time_diff_20672 = time_end_20671 - time_start_20670;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_17115", time_diff_20672);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_unref_device(ctx, &mem_19280, "mem_19280") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19294, "mem_19294") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19308, "mem_19308") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19322, "mem_19322") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19336, "mem_19336") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19338, "mem_19338") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19364, "mem_19364") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19378, "mem_19378") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19392, "mem_19392") != 0)
            return 1;
        
        struct memblock_device mem_19547;
        
        mem_19547.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19547, bytes_19405, "mem_19547")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_19547, 0, mem_19407,
                                                  0, 1, paths_16674,
                                                  steps_16675) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_unref_device(ctx, &mem_19407, "mem_19407") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_19549, &mem_19547, "mem_19547") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19547, "mem_19547") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19378, "mem_19378") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_19889,
                                  "group_res_arr_mem_19889") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19712, "mem_19712") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19698, "mem_19698") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19684, "mem_19684") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19670, "mem_19670") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19726, "mem_19726") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19392, "mem_19392") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19364, "mem_19364") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19338, "mem_19338") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19336, "mem_19336") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19322, "mem_19322") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19308, "mem_19308") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19294, "mem_19294") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19280, "mem_19280") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19407, "mem_19407") != 0)
            return 1;
    } else {
        int64_t segmap_usable_groups_18435 = sdiv_up64(paths_16674,
                                                       segmap_group_sizze_18434);
        struct memblock_device mem_19460;
        
        mem_19460.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19460, bytes_19459, "mem_19460")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18415, 1,
                                                sizeof(paths_16674),
                                                &paths_16674));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18415, 2,
                                                sizeof(mem_19460.mem),
                                                &mem_19460.mem));
        if (1 * ((size_t) segmap_usable_groups_18435 *
                 (size_t) segmap_group_sizze_18434) != 0) {
            const size_t global_work_sizze_20674[1] =
                         {(size_t) segmap_usable_groups_18435 *
                         (size_t) segmap_group_sizze_18434};
            const size_t local_work_sizze_20678[1] = {segmap_group_sizze_18434};
            int64_t time_start_20675 = 0, time_end_20676 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_18415");
                fprintf(stderr, "%zu", global_work_sizze_20674[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20678[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_20675 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_18415,
                                                            1, NULL,
                                                            global_work_sizze_20674,
                                                            local_work_sizze_20678,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_18415_runs,
                                                                                                      &ctx->mainzisegmap_18415_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20676 = get_wall_time();
                
                long time_diff_20677 = time_end_20676 - time_start_20675;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_18415", time_diff_20677);
            }
        }
        
        int64_t segmap_usable_groups_18460 = sdiv_up64(nest_sizze_18458,
                                                       segmap_group_sizze_18459);
        struct memblock_device mem_19464;
        
        mem_19464.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19464, bytes_19405, "mem_19464")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18351, 1,
                                                sizeof(paths_16674),
                                                &paths_16674));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18351, 2,
                                                sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18351, 3,
                                                sizeof(mem_19460.mem),
                                                &mem_19460.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18351, 4,
                                                sizeof(mem_19464.mem),
                                                &mem_19464.mem));
        if (1 * ((size_t) segmap_usable_groups_18460 *
                 (size_t) segmap_group_sizze_18459) != 0) {
            const size_t global_work_sizze_20679[1] =
                         {(size_t) segmap_usable_groups_18460 *
                         (size_t) segmap_group_sizze_18459};
            const size_t local_work_sizze_20683[1] = {segmap_group_sizze_18459};
            int64_t time_start_20680 = 0, time_end_20681 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_18351");
                fprintf(stderr, "%zu", global_work_sizze_20679[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20683[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_20680 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_18351,
                                                            1, NULL,
                                                            global_work_sizze_20679,
                                                            local_work_sizze_20683,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_18351_runs,
                                                                                                      &ctx->mainzisegmap_18351_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20681 = get_wall_time();
                
                long time_diff_20682 = time_end_20681 - time_start_20680;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_18351", time_diff_20682);
            }
        }
        if (memblock_unref_device(ctx, &mem_19460, "mem_19460") != 0)
            return 1;
        
        struct memblock_device mem_19467;
        
        mem_19467.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19467, bytes_19405, "mem_19467")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_19467, 0, mem_19464,
                                                  0, 1, steps_16675,
                                                  paths_16674) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_unref_device(ctx, &mem_19464, "mem_19464") != 0)
            return 1;
        
        struct memblock_device mem_19485;
        
        mem_19485.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19485, bytes_19405, "mem_19485")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19470;
        
        mem_19470.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19470, total_sizze_19735,
                                  "mem_19470")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 3,
                                                sizeof(paths_16674),
                                                &paths_16674));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 4,
                                                sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 5,
                                                sizeof(a_16679), &a_16679));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 6,
                                                sizeof(b_16680), &b_16680));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 7,
                                                sizeof(sigma_16681),
                                                &sigma_16681));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 8,
                                                sizeof(r0_16682), &r0_16682));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 9,
                                                sizeof(dt_16686), &dt_16686));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 10,
                                                sizeof(upper_bound_16701),
                                                &upper_bound_16701));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 11,
                                                sizeof(res_16702), &res_16702));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 12,
                                                sizeof(num_groups_18505),
                                                &num_groups_18505));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 13,
                                                sizeof(mem_19467.mem),
                                                &mem_19467.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 14,
                                                sizeof(mem_19470.mem),
                                                &mem_19470.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18253, 15,
                                                sizeof(mem_19485.mem),
                                                &mem_19485.mem));
        if (1 * ((size_t) num_groups_18505 *
                 (size_t) segmap_group_sizze_18504) != 0) {
            const size_t global_work_sizze_20684[1] =
                         {(size_t) num_groups_18505 *
                         (size_t) segmap_group_sizze_18504};
            const size_t local_work_sizze_20688[1] = {segmap_group_sizze_18504};
            int64_t time_start_20685 = 0, time_end_20686 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_18253");
                fprintf(stderr, "%zu", global_work_sizze_20684[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20688[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_20685 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_18253,
                                                            1, NULL,
                                                            global_work_sizze_20684,
                                                            local_work_sizze_20688,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_18253_runs,
                                                                                                      &ctx->mainzisegmap_18253_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20686 = get_wall_time();
                
                long time_diff_20687 = time_end_20686 - time_start_20685;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_18253", time_diff_20687);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_unref_device(ctx, &mem_19467, "mem_19467") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19470, "mem_19470") != 0)
            return 1;
        
        int32_t num_subhistos_19971;
        struct memblock_device res_r_subhistos_mem_19972;
        
        res_r_subhistos_mem_19972.references = NULL;
        
        int64_t h_19974;
        
        h_19974 = (int32_t) sizeof(int64_t) * res_16723;
        
        int64_t seg_h_19975;
        
        seg_h_19975 = (int32_t) sizeof(int64_t) * res_16723 * paths_16674;
        if (!(seg_h_19975 == 0)) {
            int64_t hist_H_19976 = res_16723;
            int64_t hist_el_sizze_19977 = sdiv_up64(h_19974, hist_H_19976) + 4;
            int64_t hist_N_19978 = steps_16675;
            int64_t hist_RF_19979 = 1;
            
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegHist");
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Number of threads (T)",
                        (long long) sext_i64_i32(num_groups_18547 *
                        seghist_group_sizze_18546), '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Desired group size (B)",
                        (long long) seghist_group_sizze_18546, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Histogram size (H)",
                        (long long) hist_H_19976, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Input elements per histogram (N)",
                        (long long) hist_N_19978, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Number of segments",
                        (long long) paths_16674, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Histogram element size (el_size)",
                        (long long) hist_el_sizze_19977, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Race factor (RF)",
                        (long long) hist_RF_19979, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Memory per set of subhistograms per segment",
                        (long long) h_19974, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Memory per set of subhistograms times segments",
                        (long long) seg_h_19975, '\n');
            
            int32_t hist_L_19980;
            
            hist_L_19980 = ctx->opencl.max_local_memory;
            
            int32_t max_group_sizze_19981;
            
            max_group_sizze_19981 = ctx->opencl.max_group_size;
            
            int64_t num_groups_19982;
            
            num_groups_19982 =
                sdiv_up64(sext_i32_i64(sext_i64_i32(num_groups_18547 *
                          seghist_group_sizze_18546)), max_group_sizze_19981);
            
            double hist_m_prime_19983;
            
            hist_m_prime_19983 =
                sitofp_i64_f64(smin64(sext_i32_i64(squot32(hist_L_19980,
                                                           hist_el_sizze_19977)),
                                      sdiv_up64(hist_N_19978,
                                                num_groups_19982))) /
                sitofp_i64_f64(hist_H_19976);
            
            int64_t hist_M0_19984;
            
            hist_M0_19984 = smax64(1, smin64(fptosi_f64_i64(hist_m_prime_19983),
                                             max_group_sizze_19981));
            
            int64_t hist_Nout_19985;
            
            hist_Nout_19985 = paths_16674;
            
            int64_t hist_Nin_19986;
            
            hist_Nin_19986 = steps_16675;
            
            int32_t hist_T_hist_min_19987;
            
            hist_T_hist_min_19987 =
                sext_i64_i32(sdiv_up64(smin64(hist_Nin_19986 * hist_Nout_19985,
                                              sext_i32_i64(sext_i64_i32(num_groups_18547 *
                                              seghist_group_sizze_18546))),
                                       hist_Nout_19985));
            
            int64_t work_asymp_M_max_19988;
            
            work_asymp_M_max_19988 = squot64(hist_Nin_19986,
                                             sext_i32_i64(sdiv_up32(hist_T_hist_min_19987,
                                                                    sext_i64_i32(max_group_sizze_19981))) *
                                             hist_H_19976);
            
            int32_t hist_M_19989;
            
            hist_M_19989 = sext_i64_i32(smin64(hist_M0_19984,
                                               work_asymp_M_max_19988));
            
            int64_t hist_C_19990;
            
            hist_C_19990 = sdiv_up64(max_group_sizze_19981,
                                     sext_i32_i64(smax32(1, hist_M_19989)));
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local hist_M0",
                        (long long) hist_M0_19984, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local work asymp M max",
                        (long long) work_asymp_M_max_19988, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local C",
                        (long long) hist_C_19990, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local B",
                        (long long) max_group_sizze_19981, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local M",
                        (long long) hist_M_19989, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local memory needed",
                        (long long) (hist_H_19976 * hist_el_sizze_19977 *
                                     sext_i32_i64(hist_M_19989)), '\n');
            
            int64_t local_mem_needed_19991;
            
            local_mem_needed_19991 = hist_el_sizze_19977 *
                sext_i32_i64(hist_M_19989);
            
            int32_t hist_S_19992;
            
            hist_S_19992 = sext_i64_i32(sdiv_up64(hist_H_19976 *
                                                  local_mem_needed_19991,
                                                  hist_L_19980));
            
            int64_t groups_per_segment_19993;
            
            groups_per_segment_19993 = sdiv_up64(num_groups_19982,
                                                 hist_Nout_19985);
            if (sle64(hist_H_19976, hist_Nin_19986) &&
                (sle64(local_mem_needed_19991, hist_L_19980) &&
                 (sle32(hist_S_19992, 6) && (sle64(hist_C_19990,
                                                   max_group_sizze_19981) &&
                                             slt32(0, hist_M_19989))))) {
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "## Using local memory");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Histogram size (H)",
                            (long long) hist_H_19976, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Multiplication degree (M)",
                            (long long) hist_M_19989, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Cooperation level (C)",
                            (long long) hist_C_19990, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Number of chunks (S)",
                            (long long) hist_S_19992, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Groups per segment",
                            (long long) groups_per_segment_19993, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c",
                            "Number of local subhistograms per group",
                            (long long) hist_M_19989, '\n');
                
                int64_t num_segments_19994;
                
                num_segments_19994 = paths_16674;
                num_subhistos_19971 = groups_per_segment_19993 *
                    num_segments_19994;
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c",
                            "Number of subhistograms in global memory",
                            (long long) num_subhistos_19971, '\n');
                if (num_subhistos_19971 == 1) {
                    if (memblock_set_device(ctx, &res_r_subhistos_mem_19972,
                                            &mem_19277, "mem_19277") != 0)
                        return 1;
                } else {
                    if (memblock_alloc_device(ctx, &res_r_subhistos_mem_19972,
                                              sext_i32_i64(num_subhistos_19971) *
                                              paths_16674 * res_16723 *
                                              (int32_t) sizeof(int64_t),
                                              "res_r_subhistos_mem_19972")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (futrts_builtinzhreplicate_i64(ctx,
                                                      res_r_subhistos_mem_19972,
                                                      paths_16674 *
                                                      num_subhistos_19971 *
                                                      res_16723, 0) != 0) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    int64_t group_sizze_19998;
                    
                    group_sizze_19998 = ctx->sizes.mainzigroup_sizze_19998;
                    
                    int64_t num_groups_19999;
                    
                    num_groups_19999 = sdiv_up64(paths_16674 * res_16723,
                                                 group_sizze_19998);
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_19995,
                                                            0,
                                                            sizeof(paths_16674),
                                                            &paths_16674));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_19995,
                                                            1,
                                                            sizeof(res_16723),
                                                            &res_16723));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_19995,
                                                            2,
                                                            sizeof(mem_19277.mem),
                                                            &mem_19277.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_19995,
                                                            3,
                                                            sizeof(num_subhistos_19971),
                                                            &num_subhistos_19971));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_19995,
                                                            4,
                                                            sizeof(res_r_subhistos_mem_19972.mem),
                                                            &res_r_subhistos_mem_19972.mem));
                    if (1 * ((size_t) num_groups_19999 *
                             (size_t) group_sizze_19998) != 0) {
                        const size_t global_work_sizze_20689[1] =
                                     {(size_t) num_groups_19999 *
                                     (size_t) group_sizze_19998};
                        const size_t local_work_sizze_20693[1] =
                                     {group_sizze_19998};
                        int64_t time_start_20690 = 0, time_end_20691 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.copy_19995");
                            fprintf(stderr, "%zu", global_work_sizze_20689[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_20693[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) 0);
                            time_start_20690 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainzicopy_19995,
                                                                        1, NULL,
                                                                        global_work_sizze_20689,
                                                                        local_work_sizze_20693,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainzicopy_19995_runs,
                                                                                                                  &ctx->mainzicopy_19995_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_20691 = get_wall_time();
                            
                            long time_diff_20692 = time_end_20691 -
                                 time_start_20690;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.copy_19995", time_diff_20692);
                        }
                    }
                }
                for (int32_t chk_i_20000 = 0; chk_i_20000 < hist_S_19992;
                     chk_i_20000++) {
                    int64_t num_segments_20001 = paths_16674;
                    int64_t hist_H_chk_20002 = sdiv_up64(res_16723,
                                                         sext_i32_i64(hist_S_19992));
                    int64_t histo_sizze_20003 = hist_H_chk_20002;
                    int32_t init_per_thread_20004 =
                            sext_i64_i32(sdiv_up64(sext_i32_i64(hist_M_19989) *
                                                   histo_sizze_20003,
                                                   max_group_sizze_19981));
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            1,
                                                            (int32_t) sizeof(int32_t) *
                                                            (hist_M_19989 *
                                                             hist_H_chk_20002),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            2,
                                                            (int32_t) sizeof(int64_t) *
                                                            (hist_M_19989 *
                                                             hist_H_chk_20002),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            3,
                                                            sizeof(steps_16675),
                                                            &steps_16675));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            4,
                                                            sizeof(res_16723),
                                                            &res_16723));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            5,
                                                            sizeof(mem_19274.mem),
                                                            &mem_19274.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            6,
                                                            sizeof(num_subhistos_19971),
                                                            &num_subhistos_19971));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            7,
                                                            sizeof(res_r_subhistos_mem_19972.mem),
                                                            &res_r_subhistos_mem_19972.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            8,
                                                            sizeof(max_group_sizze_19981),
                                                            &max_group_sizze_19981));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            9,
                                                            sizeof(num_groups_19982),
                                                            &num_groups_19982));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            10,
                                                            sizeof(hist_M_19989),
                                                            &hist_M_19989));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            11,
                                                            sizeof(groups_per_segment_19993),
                                                            &groups_per_segment_19993));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            12,
                                                            sizeof(chk_i_20000),
                                                            &chk_i_20000));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            13,
                                                            sizeof(num_segments_20001),
                                                            &num_segments_20001));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            14,
                                                            sizeof(hist_H_chk_20002),
                                                            &hist_H_chk_20002));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            15,
                                                            sizeof(histo_sizze_20003),
                                                            &histo_sizze_20003));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_18214,
                                                            16,
                                                            sizeof(init_per_thread_20004),
                                                            &init_per_thread_20004));
                    if (1 * ((size_t) num_groups_19982 *
                             (size_t) max_group_sizze_19981) != 0) {
                        const size_t global_work_sizze_20694[1] =
                                     {(size_t) num_groups_19982 *
                                     (size_t) max_group_sizze_19981};
                        const size_t local_work_sizze_20698[1] =
                                     {max_group_sizze_19981};
                        int64_t time_start_20695 = 0, time_end_20696 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.seghist_local_18214");
                            fprintf(stderr, "%zu", global_work_sizze_20694[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_20698[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(int32_t) *
                                           (hist_M_19989 * hist_H_chk_20002) +
                                           (int32_t) sizeof(int64_t) *
                                           (hist_M_19989 * hist_H_chk_20002)));
                            time_start_20695 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainziseghist_local_18214,
                                                                        1, NULL,
                                                                        global_work_sizze_20694,
                                                                        local_work_sizze_20698,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainziseghist_local_18214_runs,
                                                                                                                  &ctx->mainziseghist_local_18214_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_20696 = get_wall_time();
                            
                            long time_diff_20697 = time_end_20696 -
                                 time_start_20695;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.seghist_local_18214",
                                    time_diff_20697);
                        }
                    }
                }
            } else {
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "## Using global memory");
                
                int64_t hist_H_20036;
                
                hist_H_20036 = res_16723;
                
                double hist_RF_20037;
                
                hist_RF_20037 = (0.0 + sitofp_i32_f64(1)) / 1.0;
                
                int32_t hist_el_sizze_20038;
                
                hist_el_sizze_20038 =
                    squot32(sext_i64_i32((int32_t) sizeof(int32_t) +
                            (int32_t) sizeof(int64_t)), 2);
                
                double hist_C_max_20039;
                
                hist_C_max_20039 =
                    fmin64(sitofp_i32_f64(sext_i64_i32(num_groups_18547 *
                           seghist_group_sizze_18546)),
                           sitofp_i32_f64(hist_H_20036) / 2.0);
                
                int32_t hist_M_min_20040;
                
                hist_M_min_20040 = smax32(1,
                                          sext_i64_i32(fptosi_f64_i64(sitofp_i32_f64(sext_i64_i32(num_groups_18547 *
                                          seghist_group_sizze_18546)) /
                                          hist_C_max_20039)));
                
                int32_t L2_sizze_20041;
                
                L2_sizze_20041 = ctx->sizes.mainziL2_sizze_20041;
                
                double hist_RACE_exp_20042;
                
                hist_RACE_exp_20042 = fmax64(1.0, 0.75 * hist_RF_20037 / (64.0 /
                                                                          sitofp_i32_f64(hist_el_sizze_20038)));
                
                int32_t hist_S_20043;
                
                if (slt64(steps_16675, hist_H_20036)) {
                    hist_S_20043 = 1;
                } else {
                    hist_S_20043 =
                        sext_i64_i32(sdiv_up64(sext_i32_i64(hist_M_min_20040) *
                                               hist_H_20036 *
                                               sext_i32_i64(hist_el_sizze_20038),
                                               fptosi_f64_i64(0.4 *
                                               sitofp_i32_f64(L2_sizze_20041) *
                                               hist_RACE_exp_20042)));
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s: %f%c",
                            "Race expansion factor (RACE^exp)",
                            (double) hist_RACE_exp_20042, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Number of chunks (S)",
                            (long long) hist_S_20043, '\n');
                
                int64_t hist_H_chk_20044;
                
                hist_H_chk_20044 = sdiv_up64(res_16723,
                                             sext_i32_i64(hist_S_20043));
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Chunk size (H_chk)",
                            (long long) hist_H_chk_20044, '\n');
                
                double hist_k_max_20045;
                
                hist_k_max_20045 = fmin64(0.4 *
                                          (sitofp_i32_f64(L2_sizze_20041) /
                                           sitofp_i32_f64(sext_i64_i32((int32_t) sizeof(int32_t) +
                                           (int32_t) sizeof(int64_t)))) *
                                          hist_RACE_exp_20042,
                                          sitofp_i32_f64(steps_16675)) /
                    sitofp_i32_f64(sext_i64_i32(num_groups_18547 *
                    seghist_group_sizze_18546));
                
                int64_t hist_u_20046;
                
                hist_u_20046 = 1;
                
                double hist_C_20047;
                
                hist_C_20047 =
                    fmin64(sitofp_i32_f64(sext_i64_i32(num_groups_18547 *
                           seghist_group_sizze_18546)),
                           sitofp_i32_f64(hist_u_20046 * hist_H_chk_20044) /
                           hist_k_max_20045);
                
                int32_t hist_M_20048;
                
                hist_M_20048 = smax32(hist_M_min_20040,
                                      sext_i64_i32(fptosi_f64_i64(sitofp_i32_f64(sext_i64_i32(num_groups_18547 *
                                      seghist_group_sizze_18546)) /
                                      hist_C_20047)));
                if (ctx->debugging)
                    fprintf(stderr, "%s: %f%c",
                            "Elements/thread in L2 cache (k_max)",
                            (double) hist_k_max_20045, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Multiplication degree (M)",
                            (long long) hist_M_20048, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %f%c", "Cooperation level (C)",
                            (double) hist_C_20047, '\n');
                num_subhistos_19971 = sext_i32_i64(hist_M_20048);
                if (hist_M_20048 == 1) {
                    if (memblock_set_device(ctx, &res_r_subhistos_mem_19972,
                                            &mem_19277, "mem_19277") != 0)
                        return 1;
                } else {
                    if (num_subhistos_19971 == 1) {
                        if (memblock_set_device(ctx, &res_r_subhistos_mem_19972,
                                                &mem_19277, "mem_19277") != 0)
                            return 1;
                    } else {
                        if (memblock_alloc_device(ctx,
                                                  &res_r_subhistos_mem_19972,
                                                  sext_i32_i64(num_subhistos_19971) *
                                                  paths_16674 * res_16723 *
                                                  (int32_t) sizeof(int64_t),
                                                  "res_r_subhistos_mem_19972")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (futrts_builtinzhreplicate_i64(ctx,
                                                          res_r_subhistos_mem_19972,
                                                          paths_16674 *
                                                          num_subhistos_19971 *
                                                          res_16723, 0) != 0) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        int64_t group_sizze_20052;
                        
                        group_sizze_20052 = ctx->sizes.mainzigroup_sizze_20052;
                        
                        int64_t num_groups_20053;
                        
                        num_groups_20053 = sdiv_up64(paths_16674 * res_16723,
                                                     group_sizze_20052);
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_20049,
                                                                0,
                                                                sizeof(paths_16674),
                                                                &paths_16674));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_20049,
                                                                1,
                                                                sizeof(res_16723),
                                                                &res_16723));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_20049,
                                                                2,
                                                                sizeof(mem_19277.mem),
                                                                &mem_19277.mem));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_20049,
                                                                3,
                                                                sizeof(num_subhistos_19971),
                                                                &num_subhistos_19971));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_20049,
                                                                4,
                                                                sizeof(res_r_subhistos_mem_19972.mem),
                                                                &res_r_subhistos_mem_19972.mem));
                        if (1 * ((size_t) num_groups_20053 *
                                 (size_t) group_sizze_20052) != 0) {
                            const size_t global_work_sizze_20699[1] =
                                         {(size_t) num_groups_20053 *
                                         (size_t) group_sizze_20052};
                            const size_t local_work_sizze_20703[1] =
                                         {group_sizze_20052};
                            int64_t time_start_20700 = 0, time_end_20701 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr,
                                        "Launching %s with global work size [",
                                        "main.copy_20049");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_20699[0]);
                                fprintf(stderr, "] and local work size [");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_20703[0]);
                                fprintf(stderr,
                                        "]; local memory parameters sum to %d bytes.\n",
                                        (int) 0);
                                time_start_20700 = get_wall_time();
                            }
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                            ctx->mainzicopy_20049,
                                                                            1,
                                                                            NULL,
                                                                            global_work_sizze_20699,
                                                                            local_work_sizze_20703,
                                                                            0,
                                                                            NULL,
                                                                            ctx->profiling_paused ||
                                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                      &ctx->mainzicopy_20049_runs,
                                                                                                                      &ctx->mainzicopy_20049_total_runtime)));
                            if (ctx->debugging) {
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                                time_end_20701 = get_wall_time();
                                
                                long time_diff_20702 = time_end_20701 -
                                     time_start_20700;
                                
                                fprintf(stderr, "kernel %s runtime: %ldus\n",
                                        "main.copy_20049", time_diff_20702);
                            }
                        }
                    }
                }
                
                struct memblock_device mainzihist_locks_mem_20054 =
                                       ctx->mainzihist_locks_mem_20054;
                
                for (int32_t chk_i_20056 = 0; chk_i_20056 < hist_S_20043;
                     chk_i_20056++) {
                    int64_t hist_H_chk_20057 = sdiv_up64(res_16723,
                                                         sext_i32_i64(hist_S_20043));
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_18214,
                                                            1,
                                                            sizeof(paths_16674),
                                                            &paths_16674));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_18214,
                                                            2,
                                                            sizeof(steps_16675),
                                                            &steps_16675));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_18214,
                                                            3,
                                                            sizeof(res_16723),
                                                            &res_16723));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_18214,
                                                            4,
                                                            sizeof(num_groups_18547),
                                                            &num_groups_18547));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_18214,
                                                            5,
                                                            sizeof(mem_19274.mem),
                                                            &mem_19274.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_18214,
                                                            6,
                                                            sizeof(num_subhistos_19971),
                                                            &num_subhistos_19971));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_18214,
                                                            7,
                                                            sizeof(res_r_subhistos_mem_19972.mem),
                                                            &res_r_subhistos_mem_19972.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_18214,
                                                            8,
                                                            sizeof(mainzihist_locks_mem_20054.mem),
                                                            &mainzihist_locks_mem_20054.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_18214,
                                                            9,
                                                            sizeof(chk_i_20056),
                                                            &chk_i_20056));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_18214,
                                                            10,
                                                            sizeof(hist_H_chk_20057),
                                                            &hist_H_chk_20057));
                    if (1 * ((size_t) num_groups_18547 *
                             (size_t) seghist_group_sizze_18546) != 0) {
                        const size_t global_work_sizze_20705[1] =
                                     {(size_t) num_groups_18547 *
                                     (size_t) seghist_group_sizze_18546};
                        const size_t local_work_sizze_20709[1] =
                                     {seghist_group_sizze_18546};
                        int64_t time_start_20706 = 0, time_end_20707 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.seghist_global_18214");
                            fprintf(stderr, "%zu", global_work_sizze_20705[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_20709[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) 0);
                            time_start_20706 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainziseghist_global_18214,
                                                                        1, NULL,
                                                                        global_work_sizze_20705,
                                                                        local_work_sizze_20709,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainziseghist_global_18214_runs,
                                                                                                                  &ctx->mainziseghist_global_18214_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_20707 = get_wall_time();
                            
                            long time_diff_20708 = time_end_20707 -
                                 time_start_20706;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.seghist_global_18214",
                                    time_diff_20708);
                        }
                    }
                }
            }
            if (num_subhistos_19971 == 1) {
                if (memblock_set_device(ctx, &mem_19277,
                                        &res_r_subhistos_mem_19972,
                                        "res_r_subhistos_mem_19972") != 0)
                    return 1;
            } else {
                if (slt64(num_subhistos_19971 * 2, seghist_group_sizze_18546)) {
                    int64_t segment_sizze_nonzzero_20070 = smax64(1,
                                                                  num_subhistos_19971);
                    int64_t num_threads_20071 = num_groups_18547 *
                            seghist_group_sizze_18546;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-small");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) (paths_16674 * res_16723), '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) num_subhistos_19971, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segments_per_group",
                                (long long) squot64(seghist_group_sizze_18546,
                                                    segment_sizze_nonzzero_20070),
                                '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "required_groups",
                                (long long) sext_i64_i32(sdiv_up64(paths_16674 *
                                                                   res_16723,
                                                                   squot64(seghist_group_sizze_18546,
                                                                           segment_sizze_nonzzero_20070))),
                                '\n');
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20069,
                                                            1,
                                                            (int32_t) sizeof(int64_t) *
                                                            seghist_group_sizze_18546,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20069,
                                                            2,
                                                            sizeof(paths_16674),
                                                            &paths_16674));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20069,
                                                            3,
                                                            sizeof(res_16723),
                                                            &res_16723));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20069,
                                                            4,
                                                            sizeof(num_groups_18547),
                                                            &num_groups_18547));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20069,
                                                            5,
                                                            sizeof(mem_19277.mem),
                                                            &mem_19277.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20069,
                                                            6,
                                                            sizeof(num_subhistos_19971),
                                                            &num_subhistos_19971));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20069,
                                                            7,
                                                            sizeof(res_r_subhistos_mem_19972.mem),
                                                            &res_r_subhistos_mem_19972.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20069,
                                                            8,
                                                            sizeof(segment_sizze_nonzzero_20070),
                                                            &segment_sizze_nonzzero_20070));
                    if (1 * ((size_t) num_groups_18547 *
                             (size_t) seghist_group_sizze_18546) != 0) {
                        const size_t global_work_sizze_20710[1] =
                                     {(size_t) num_groups_18547 *
                                     (size_t) seghist_group_sizze_18546};
                        const size_t local_work_sizze_20714[1] =
                                     {seghist_group_sizze_18546};
                        int64_t time_start_20711 = 0, time_end_20712 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.segred_small_20069");
                            fprintf(stderr, "%zu", global_work_sizze_20710[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_20714[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(int64_t) *
                                           seghist_group_sizze_18546));
                            time_start_20711 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainzisegred_small_20069,
                                                                        1, NULL,
                                                                        global_work_sizze_20710,
                                                                        local_work_sizze_20714,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainzisegred_small_20069_runs,
                                                                                                                  &ctx->mainzisegred_small_20069_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_20712 = get_wall_time();
                            
                            long time_diff_20713 = time_end_20712 -
                                 time_start_20711;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.segred_small_20069", time_diff_20713);
                        }
                    }
                } else {
                    int64_t groups_per_segment_20091 =
                            sdiv_up64(num_groups_18547, smax64(1, paths_16674 *
                                                               res_16723));
                    int64_t elements_per_thread_20092 =
                            sdiv_up64(num_subhistos_19971,
                                      seghist_group_sizze_18546 *
                                      groups_per_segment_20091);
                    int64_t virt_num_groups_20093 = groups_per_segment_20091 *
                            (paths_16674 * res_16723);
                    int64_t num_threads_20094 = num_groups_18547 *
                            seghist_group_sizze_18546;
                    int64_t threads_per_segment_20095 =
                            groups_per_segment_20091 *
                            seghist_group_sizze_18546;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-large");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) (paths_16674 * res_16723), '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) num_subhistos_19971, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                                (long long) virt_num_groups_20093, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_groups",
                                (long long) num_groups_18547, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "group_size",
                                (long long) seghist_group_sizze_18546, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                                (long long) elements_per_thread_20092, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                                (long long) groups_per_segment_20091, '\n');
                    
                    struct memblock_device group_res_arr_mem_20096;
                    
                    group_res_arr_mem_20096.references = NULL;
                    if (memblock_alloc_device(ctx, &group_res_arr_mem_20096,
                                              (int32_t) sizeof(int64_t) *
                                              (seghist_group_sizze_18546 *
                                               virt_num_groups_20093),
                                              "group_res_arr_mem_20096")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    struct memblock_device mainzicounter_mem_20098 =
                                           ctx->mainzicounter_mem_20098;
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            1,
                                                            (int32_t) sizeof(bool),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            2,
                                                            (int32_t) sizeof(int64_t) *
                                                            seghist_group_sizze_18546,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            3,
                                                            sizeof(res_16723),
                                                            &res_16723));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            4,
                                                            sizeof(num_groups_18547),
                                                            &num_groups_18547));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            5,
                                                            sizeof(mem_19277.mem),
                                                            &mem_19277.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            6,
                                                            sizeof(num_subhistos_19971),
                                                            &num_subhistos_19971));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            7,
                                                            sizeof(res_r_subhistos_mem_19972.mem),
                                                            &res_r_subhistos_mem_19972.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            8,
                                                            sizeof(groups_per_segment_20091),
                                                            &groups_per_segment_20091));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            9,
                                                            sizeof(elements_per_thread_20092),
                                                            &elements_per_thread_20092));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            10,
                                                            sizeof(virt_num_groups_20093),
                                                            &virt_num_groups_20093));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            11,
                                                            sizeof(threads_per_segment_20095),
                                                            &threads_per_segment_20095));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            12,
                                                            sizeof(group_res_arr_mem_20096.mem),
                                                            &group_res_arr_mem_20096.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20069,
                                                            13,
                                                            sizeof(mainzicounter_mem_20098.mem),
                                                            &mainzicounter_mem_20098.mem));
                    if (1 * ((size_t) num_groups_18547 *
                             (size_t) seghist_group_sizze_18546) != 0) {
                        const size_t global_work_sizze_20716[1] =
                                     {(size_t) num_groups_18547 *
                                     (size_t) seghist_group_sizze_18546};
                        const size_t local_work_sizze_20720[1] =
                                     {seghist_group_sizze_18546};
                        int64_t time_start_20717 = 0, time_end_20718 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.segred_large_20069");
                            fprintf(stderr, "%zu", global_work_sizze_20716[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_20720[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(bool) +
                                           (int32_t) sizeof(int64_t) *
                                           seghist_group_sizze_18546));
                            time_start_20717 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainzisegred_large_20069,
                                                                        1, NULL,
                                                                        global_work_sizze_20716,
                                                                        local_work_sizze_20720,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainzisegred_large_20069_runs,
                                                                                                                  &ctx->mainzisegred_large_20069_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_20718 = get_wall_time();
                            
                            long time_diff_20719 = time_end_20718 -
                                 time_start_20717;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.segred_large_20069", time_diff_20719);
                        }
                    }
                    if (memblock_unref_device(ctx, &group_res_arr_mem_20096,
                                              "group_res_arr_mem_20096") != 0)
                        return 1;
                }
            }
        }
        
        struct memblock_device mem_19489;
        
        mem_19489.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19489, binop_x_19276,
                                  "mem_19489")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19492;
        
        mem_19492.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19492, bytes_19275, "mem_19492")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, paths_16674 * res_16723)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_20130;
            
            stage1_max_num_groups_20130 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_20131;
            
            stage1_num_groups_20131 = smin64(stage1_max_num_groups_20130,
                                             num_groups_18558);
            
            int32_t num_threads_20132;
            
            num_threads_20132 = sext_i64_i32(stage1_num_groups_20131 *
                segscan_group_sizze_18557);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18193,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_18557),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18193,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              segscan_group_sizze_18557),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18193,
                                                    3, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18193,
                                                    4, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18193,
                                                    5, sizeof(mem_19277.mem),
                                                    &mem_19277.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18193,
                                                    6, sizeof(mem_19489.mem),
                                                    &mem_19489.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18193,
                                                    7, sizeof(mem_19492.mem),
                                                    &mem_19492.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18193,
                                                    8,
                                                    sizeof(num_threads_20132),
                                                    &num_threads_20132));
            if (1 * ((size_t) stage1_num_groups_20131 *
                     (size_t) segscan_group_sizze_18557) != 0) {
                const size_t global_work_sizze_20721[1] =
                             {(size_t) stage1_num_groups_20131 *
                             (size_t) segscan_group_sizze_18557};
                const size_t local_work_sizze_20725[1] =
                             {segscan_group_sizze_18557};
                int64_t time_start_20722 = 0, time_end_20723 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage1_18193");
                    fprintf(stderr, "%zu", global_work_sizze_20721[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20725[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_18557) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          segscan_group_sizze_18557)));
                    time_start_20722 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage1_18193,
                                                                1, NULL,
                                                                global_work_sizze_20721,
                                                                local_work_sizze_20725,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage1_18193_runs,
                                                                                                          &ctx->mainziscan_stage1_18193_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20723 = get_wall_time();
                    
                    long time_diff_20724 = time_end_20723 - time_start_20722;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage1_18193", time_diff_20724);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_18557 *
                                     sdiv_up64(paths_16674 * res_16723,
                                               sext_i32_i64(num_threads_20132))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18193,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_20131),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18193,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              stage1_num_groups_20131),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18193,
                                                    3, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18193,
                                                    4, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18193,
                                                    5, sizeof(mem_19489.mem),
                                                    &mem_19489.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18193,
                                                    6, sizeof(mem_19492.mem),
                                                    &mem_19492.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18193,
                                                    7,
                                                    sizeof(stage1_num_groups_20131),
                                                    &stage1_num_groups_20131));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18193,
                                                    8,
                                                    sizeof(num_threads_20132),
                                                    &num_threads_20132));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_20131) != 0) {
                const size_t global_work_sizze_20726[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_20131};
                const size_t local_work_sizze_20730[1] =
                             {stage1_num_groups_20131};
                int64_t time_start_20727 = 0, time_end_20728 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage2_18193");
                    fprintf(stderr, "%zu", global_work_sizze_20726[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20730[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_20131) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          stage1_num_groups_20131)));
                    time_start_20727 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage2_18193,
                                                                1, NULL,
                                                                global_work_sizze_20726,
                                                                local_work_sizze_20730,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage2_18193_runs,
                                                                                                          &ctx->mainziscan_stage2_18193_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20728 = get_wall_time();
                    
                    long time_diff_20729 = time_end_20728 - time_start_20727;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage2_18193", time_diff_20729);
                }
            }
            
            int32_t required_groups_20190;
            
            required_groups_20190 = sext_i64_i32(sdiv_up64(paths_16674 *
                                                           res_16723,
                                                           segscan_group_sizze_18557));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18193,
                                                    1, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18193,
                                                    2, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18193,
                                                    3, sizeof(num_groups_18558),
                                                    &num_groups_18558));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18193,
                                                    4, sizeof(mem_19489.mem),
                                                    &mem_19489.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18193,
                                                    5, sizeof(mem_19492.mem),
                                                    &mem_19492.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18193,
                                                    6,
                                                    sizeof(num_threads_20132),
                                                    &num_threads_20132));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18193,
                                                    7,
                                                    sizeof(required_groups_20190),
                                                    &required_groups_20190));
            if (1 * ((size_t) num_groups_18558 *
                     (size_t) segscan_group_sizze_18557) != 0) {
                const size_t global_work_sizze_20731[1] =
                             {(size_t) num_groups_18558 *
                             (size_t) segscan_group_sizze_18557};
                const size_t local_work_sizze_20735[1] =
                             {segscan_group_sizze_18557};
                int64_t time_start_20732 = 0, time_end_20733 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage3_18193");
                    fprintf(stderr, "%zu", global_work_sizze_20731[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20735[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_20732 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage3_18193,
                                                                1, NULL,
                                                                global_work_sizze_20731,
                                                                local_work_sizze_20735,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage3_18193_runs,
                                                                                                          &ctx->mainziscan_stage3_18193_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20733 = get_wall_time();
                    
                    long time_diff_20734 = time_end_20733 - time_start_20732;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage3_18193", time_diff_20734);
                }
            }
        }
        if (memblock_unref_device(ctx, &mem_19489, "mem_19489") != 0)
            return 1;
        
        struct memblock_device mem_19495;
        
        mem_19495.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19495, binop_x_19276,
                                  "mem_19495")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19498;
        
        mem_19498.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19498, bytes_19275, "mem_19498")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19500;
        
        mem_19500.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19500, binop_x_19276,
                                  "mem_19500")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, paths_16674 * res_16723)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_20202;
            
            stage1_max_num_groups_20202 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_20203;
            
            stage1_num_groups_20203 = smin64(stage1_max_num_groups_20202,
                                             num_groups_18589);
            
            int32_t num_threads_20204;
            
            num_threads_20204 = sext_i64_i32(stage1_num_groups_20203 *
                segscan_group_sizze_18588);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18150,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_18588),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18150,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              segscan_group_sizze_18588),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18150,
                                                    3, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18150,
                                                    4, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18150,
                                                    5, sizeof(mem_19492.mem),
                                                    &mem_19492.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18150,
                                                    6, sizeof(mem_19495.mem),
                                                    &mem_19495.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18150,
                                                    7, sizeof(mem_19498.mem),
                                                    &mem_19498.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18150,
                                                    8, sizeof(mem_19500.mem),
                                                    &mem_19500.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18150,
                                                    9,
                                                    sizeof(num_threads_20204),
                                                    &num_threads_20204));
            if (1 * ((size_t) stage1_num_groups_20203 *
                     (size_t) segscan_group_sizze_18588) != 0) {
                const size_t global_work_sizze_20736[1] =
                             {(size_t) stage1_num_groups_20203 *
                             (size_t) segscan_group_sizze_18588};
                const size_t local_work_sizze_20740[1] =
                             {segscan_group_sizze_18588};
                int64_t time_start_20737 = 0, time_end_20738 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage1_18150");
                    fprintf(stderr, "%zu", global_work_sizze_20736[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20740[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_18588) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          segscan_group_sizze_18588)));
                    time_start_20737 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage1_18150,
                                                                1, NULL,
                                                                global_work_sizze_20736,
                                                                local_work_sizze_20740,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage1_18150_runs,
                                                                                                          &ctx->mainziscan_stage1_18150_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20738 = get_wall_time();
                    
                    long time_diff_20739 = time_end_20738 - time_start_20737;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage1_18150", time_diff_20739);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_18588 *
                                     sdiv_up64(paths_16674 * res_16723,
                                               sext_i32_i64(num_threads_20204))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18150,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_20203),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18150,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              stage1_num_groups_20203),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18150,
                                                    3, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18150,
                                                    4, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18150,
                                                    5, sizeof(mem_19495.mem),
                                                    &mem_19495.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18150,
                                                    6, sizeof(mem_19498.mem),
                                                    &mem_19498.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18150,
                                                    7,
                                                    sizeof(stage1_num_groups_20203),
                                                    &stage1_num_groups_20203));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18150,
                                                    8,
                                                    sizeof(num_threads_20204),
                                                    &num_threads_20204));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_20203) != 0) {
                const size_t global_work_sizze_20741[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_20203};
                const size_t local_work_sizze_20745[1] =
                             {stage1_num_groups_20203};
                int64_t time_start_20742 = 0, time_end_20743 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage2_18150");
                    fprintf(stderr, "%zu", global_work_sizze_20741[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20745[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_20203) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          stage1_num_groups_20203)));
                    time_start_20742 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage2_18150,
                                                                1, NULL,
                                                                global_work_sizze_20741,
                                                                local_work_sizze_20745,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage2_18150_runs,
                                                                                                          &ctx->mainziscan_stage2_18150_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20743 = get_wall_time();
                    
                    long time_diff_20744 = time_end_20743 - time_start_20742;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage2_18150", time_diff_20744);
                }
            }
            
            int32_t required_groups_20262;
            
            required_groups_20262 = sext_i64_i32(sdiv_up64(paths_16674 *
                                                           res_16723,
                                                           segscan_group_sizze_18588));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18150,
                                                    1, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18150,
                                                    2, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18150,
                                                    3, sizeof(num_groups_18589),
                                                    &num_groups_18589));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18150,
                                                    4, sizeof(mem_19495.mem),
                                                    &mem_19495.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18150,
                                                    5, sizeof(mem_19498.mem),
                                                    &mem_19498.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18150,
                                                    6,
                                                    sizeof(num_threads_20204),
                                                    &num_threads_20204));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18150,
                                                    7,
                                                    sizeof(required_groups_20262),
                                                    &required_groups_20262));
            if (1 * ((size_t) num_groups_18589 *
                     (size_t) segscan_group_sizze_18588) != 0) {
                const size_t global_work_sizze_20746[1] =
                             {(size_t) num_groups_18589 *
                             (size_t) segscan_group_sizze_18588};
                const size_t local_work_sizze_20750[1] =
                             {segscan_group_sizze_18588};
                int64_t time_start_20747 = 0, time_end_20748 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage3_18150");
                    fprintf(stderr, "%zu", global_work_sizze_20746[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20750[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_20747 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage3_18150,
                                                                1, NULL,
                                                                global_work_sizze_20746,
                                                                local_work_sizze_20750,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage3_18150_runs,
                                                                                                          &ctx->mainziscan_stage3_18150_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20748 = get_wall_time();
                    
                    long time_diff_20749 = time_end_20748 - time_start_20747;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage3_18150", time_diff_20749);
                }
            }
        }
        if (memblock_unref_device(ctx, &mem_19495, "mem_19495") != 0)
            return 1;
        
        struct memblock_device mem_19503;
        
        mem_19503.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19503, bytes_19405, "mem_19503")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_19503, 0, mem_19485,
                                                  0, 1, paths_16674,
                                                  steps_16675) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_unref_device(ctx, &mem_19485, "mem_19485") != 0)
            return 1;
        
        struct memblock_device mem_19506;
        
        mem_19506.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19506, binop_x_19276,
                                  "mem_19506")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19509;
        
        mem_19509.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19509, bytes_19507, "mem_19509")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, paths_16674 * res_16723)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_20274;
            
            stage1_max_num_groups_20274 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_20275;
            
            stage1_num_groups_20275 = smin64(stage1_max_num_groups_20274,
                                             num_groups_18630);
            
            int32_t num_threads_20276;
            
            num_threads_20276 = sext_i64_i32(stage1_num_groups_20275 *
                segscan_group_sizze_18629);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    1,
                                                    sizeof(ctx->failure_is_an_option),
                                                    &ctx->failure_is_an_option));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    3, smax64(1,
                                                              (int32_t) sizeof(float) *
                                                              segscan_group_sizze_18629),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    4, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              segscan_group_sizze_18629),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    5, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    6, sizeof(steps_16675),
                                                    &steps_16675));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    7, sizeof(swap_term_16676),
                                                    &swap_term_16676));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    8, sizeof(payments_16677),
                                                    &payments_16677));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    9, sizeof(notional_16678),
                                                    &notional_16678));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    10, sizeof(a_16679),
                                                    &a_16679));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    11, sizeof(b_16680),
                                                    &b_16680));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    12, sizeof(sigma_16681),
                                                    &sigma_16681));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    13,
                                                    sizeof(sims_per_year_16687),
                                                    &sims_per_year_16687));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    14, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    15, sizeof(mem_19492.mem),
                                                    &mem_19492.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    16, sizeof(mem_19498.mem),
                                                    &mem_19498.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    17, sizeof(mem_19500.mem),
                                                    &mem_19500.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    18, sizeof(mem_19503.mem),
                                                    &mem_19503.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    19, sizeof(mem_19506.mem),
                                                    &mem_19506.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    20, sizeof(mem_19509.mem),
                                                    &mem_19509.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_18042,
                                                    21,
                                                    sizeof(num_threads_20276),
                                                    &num_threads_20276));
            if (1 * ((size_t) stage1_num_groups_20275 *
                     (size_t) segscan_group_sizze_18629) != 0) {
                const size_t global_work_sizze_20751[1] =
                             {(size_t) stage1_num_groups_20275 *
                             (size_t) segscan_group_sizze_18629};
                const size_t local_work_sizze_20755[1] =
                             {segscan_group_sizze_18629};
                int64_t time_start_20752 = 0, time_end_20753 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage1_18042");
                    fprintf(stderr, "%zu", global_work_sizze_20751[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20755[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(float) *
                                              segscan_group_sizze_18629) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          segscan_group_sizze_18629)));
                    time_start_20752 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage1_18042,
                                                                1, NULL,
                                                                global_work_sizze_20751,
                                                                local_work_sizze_20755,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage1_18042_runs,
                                                                                                          &ctx->mainziscan_stage1_18042_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20753 = get_wall_time();
                    
                    long time_diff_20754 = time_end_20753 - time_start_20752;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage1_18042", time_diff_20754);
                }
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_18629 *
                                     sdiv_up64(paths_16674 * res_16723,
                                               sext_i32_i64(num_threads_20276))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18042,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(float) *
                                                              stage1_num_groups_20275),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18042,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              stage1_num_groups_20275),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18042,
                                                    3, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18042,
                                                    4, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18042,
                                                    5, sizeof(mem_19506.mem),
                                                    &mem_19506.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18042,
                                                    6, sizeof(mem_19509.mem),
                                                    &mem_19509.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18042,
                                                    7,
                                                    sizeof(stage1_num_groups_20275),
                                                    &stage1_num_groups_20275));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_18042,
                                                    8,
                                                    sizeof(num_threads_20276),
                                                    &num_threads_20276));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_20275) != 0) {
                const size_t global_work_sizze_20756[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_20275};
                const size_t local_work_sizze_20760[1] =
                             {stage1_num_groups_20275};
                int64_t time_start_20757 = 0, time_end_20758 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage2_18042");
                    fprintf(stderr, "%zu", global_work_sizze_20756[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20760[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(float) *
                                              stage1_num_groups_20275) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          stage1_num_groups_20275)));
                    time_start_20757 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage2_18042,
                                                                1, NULL,
                                                                global_work_sizze_20756,
                                                                local_work_sizze_20760,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage2_18042_runs,
                                                                                                          &ctx->mainziscan_stage2_18042_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20758 = get_wall_time();
                    
                    long time_diff_20759 = time_end_20758 - time_start_20757;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage2_18042", time_diff_20759);
                }
            }
            
            int32_t required_groups_20334;
            
            required_groups_20334 = sext_i64_i32(sdiv_up64(paths_16674 *
                                                           res_16723,
                                                           segscan_group_sizze_18629));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18042,
                                                    1, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18042,
                                                    2, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18042,
                                                    3, sizeof(num_groups_18630),
                                                    &num_groups_18630));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18042,
                                                    4, sizeof(mem_19506.mem),
                                                    &mem_19506.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18042,
                                                    5, sizeof(mem_19509.mem),
                                                    &mem_19509.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18042,
                                                    6,
                                                    sizeof(num_threads_20276),
                                                    &num_threads_20276));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_18042,
                                                    7,
                                                    sizeof(required_groups_20334),
                                                    &required_groups_20334));
            if (1 * ((size_t) num_groups_18630 *
                     (size_t) segscan_group_sizze_18629) != 0) {
                const size_t global_work_sizze_20761[1] =
                             {(size_t) num_groups_18630 *
                             (size_t) segscan_group_sizze_18629};
                const size_t local_work_sizze_20765[1] =
                             {segscan_group_sizze_18629};
                int64_t time_start_20762 = 0, time_end_20763 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage3_18042");
                    fprintf(stderr, "%zu", global_work_sizze_20761[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20765[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_20762 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage3_18042,
                                                                1, NULL,
                                                                global_work_sizze_20761,
                                                                local_work_sizze_20765,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage3_18042_runs,
                                                                                                          &ctx->mainziscan_stage3_18042_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20763 = get_wall_time();
                    
                    long time_diff_20764 = time_end_20763 - time_start_20762;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage3_18042", time_diff_20764);
                }
            }
        }
        if (memblock_unref_device(ctx, &mem_19492, "mem_19492") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19498, "mem_19498") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19503, "mem_19503") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19506, "mem_19506") != 0)
            return 1;
        
        struct memblock_device mem_19513;
        
        mem_19513.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19513, bytes_19275, "mem_19513")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, paths_16674 * res_16723)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_20346;
            
            stage1_max_num_groups_20346 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_20347;
            
            stage1_num_groups_20347 = smin64(stage1_max_num_groups_20346,
                                             num_groups_18768);
            
            int32_t num_threads_20348;
            
            num_threads_20348 = sext_i64_i32(stage1_num_groups_20347 *
                segscan_group_sizze_18767);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17934,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_18767),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17934,
                                                    2, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17934,
                                                    3, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17934,
                                                    4, sizeof(mem_19500.mem),
                                                    &mem_19500.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17934,
                                                    5, sizeof(mem_19513.mem),
                                                    &mem_19513.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_17934,
                                                    6,
                                                    sizeof(num_threads_20348),
                                                    &num_threads_20348));
            if (1 * ((size_t) stage1_num_groups_20347 *
                     (size_t) segscan_group_sizze_18767) != 0) {
                const size_t global_work_sizze_20766[1] =
                             {(size_t) stage1_num_groups_20347 *
                             (size_t) segscan_group_sizze_18767};
                const size_t local_work_sizze_20770[1] =
                             {segscan_group_sizze_18767};
                int64_t time_start_20767 = 0, time_end_20768 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage1_17934");
                    fprintf(stderr, "%zu", global_work_sizze_20766[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20770[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_18767)));
                    time_start_20767 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage1_17934,
                                                                1, NULL,
                                                                global_work_sizze_20766,
                                                                local_work_sizze_20770,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage1_17934_runs,
                                                                                                          &ctx->mainziscan_stage1_17934_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20768 = get_wall_time();
                    
                    long time_diff_20769 = time_end_20768 - time_start_20767;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage1_17934", time_diff_20769);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_18767 *
                                     sdiv_up64(paths_16674 * res_16723,
                                               sext_i32_i64(num_threads_20348))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17934,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_20347),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17934,
                                                    2, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17934,
                                                    3, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17934,
                                                    4, sizeof(mem_19513.mem),
                                                    &mem_19513.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17934,
                                                    5,
                                                    sizeof(stage1_num_groups_20347),
                                                    &stage1_num_groups_20347));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_17934,
                                                    6,
                                                    sizeof(num_threads_20348),
                                                    &num_threads_20348));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_20347) != 0) {
                const size_t global_work_sizze_20771[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_20347};
                const size_t local_work_sizze_20775[1] =
                             {stage1_num_groups_20347};
                int64_t time_start_20772 = 0, time_end_20773 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage2_17934");
                    fprintf(stderr, "%zu", global_work_sizze_20771[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20775[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_20347)));
                    time_start_20772 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage2_17934,
                                                                1, NULL,
                                                                global_work_sizze_20771,
                                                                local_work_sizze_20775,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage2_17934_runs,
                                                                                                          &ctx->mainziscan_stage2_17934_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20773 = get_wall_time();
                    
                    long time_diff_20774 = time_end_20773 - time_start_20772;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage2_17934", time_diff_20774);
                }
            }
            
            int32_t required_groups_20390;
            
            required_groups_20390 = sext_i64_i32(sdiv_up64(paths_16674 *
                                                           res_16723,
                                                           segscan_group_sizze_18767));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17934,
                                                    1, sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17934,
                                                    2, sizeof(res_16723),
                                                    &res_16723));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17934,
                                                    3, sizeof(num_groups_18768),
                                                    &num_groups_18768));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17934,
                                                    4, sizeof(mem_19513.mem),
                                                    &mem_19513.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17934,
                                                    5,
                                                    sizeof(num_threads_20348),
                                                    &num_threads_20348));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_17934,
                                                    6,
                                                    sizeof(required_groups_20390),
                                                    &required_groups_20390));
            if (1 * ((size_t) num_groups_18768 *
                     (size_t) segscan_group_sizze_18767) != 0) {
                const size_t global_work_sizze_20776[1] =
                             {(size_t) num_groups_18768 *
                             (size_t) segscan_group_sizze_18767};
                const size_t local_work_sizze_20780[1] =
                             {segscan_group_sizze_18767};
                int64_t time_start_20777 = 0, time_end_20778 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage3_17934");
                    fprintf(stderr, "%zu", global_work_sizze_20776[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20780[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_20777 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage3_17934,
                                                                1, NULL,
                                                                global_work_sizze_20776,
                                                                local_work_sizze_20780,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage3_17934_runs,
                                                                                                          &ctx->mainziscan_stage3_17934_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20778 = get_wall_time();
                    
                    long time_diff_20779 = time_end_20778 - time_start_20777;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage3_17934", time_diff_20779);
                }
            }
        }
        
        struct memblock_device mem_19516;
        
        mem_19516.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19516, bytes_19507, "mem_19516")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_19516, 0, mem_19509,
                                                  0, 1, res_16723,
                                                  paths_16674) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_unref_device(ctx, &mem_19509, "mem_19509") != 0)
            return 1;
        
        struct memblock_device mem_19518;
        
        mem_19518.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19518, binop_x_19276,
                                  "mem_19518")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t group_sizze_20405;
        
        group_sizze_20405 = ctx->sizes.mainzigroup_sizze_20405;
        
        int64_t num_groups_20406;
        
        num_groups_20406 = sdiv_up64(paths_16674 * res_16723,
                                     group_sizze_20405);
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_20402, 0,
                                                sizeof(paths_16674),
                                                &paths_16674));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_20402, 1,
                                                sizeof(res_16723), &res_16723));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_20402, 2,
                                                sizeof(mem_19500.mem),
                                                &mem_19500.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_20402, 3,
                                                sizeof(mem_19518.mem),
                                                &mem_19518.mem));
        if (1 * ((size_t) num_groups_20406 * (size_t) group_sizze_20405) != 0) {
            const size_t global_work_sizze_20781[1] =
                         {(size_t) num_groups_20406 *
                         (size_t) group_sizze_20405};
            const size_t local_work_sizze_20785[1] = {group_sizze_20405};
            int64_t time_start_20782 = 0, time_end_20783 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.copy_20402");
                fprintf(stderr, "%zu", global_work_sizze_20781[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20785[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_20782 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzicopy_20402,
                                                            1, NULL,
                                                            global_work_sizze_20781,
                                                            local_work_sizze_20785,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzicopy_20402_runs,
                                                                                                      &ctx->mainzicopy_20402_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20783 = get_wall_time();
                
                long time_diff_20784 = time_end_20783 - time_start_20782;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n", "main.copy_20402",
                        time_diff_20784);
            }
        }
        if (memblock_unref_device(ctx, &mem_19500, "mem_19500") != 0)
            return 1;
        
        struct memblock_device mem_19521;
        
        mem_19521.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19521, bytes_19275, "mem_19521")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_i64(ctx, mem_19521, 0, mem_19513,
                                                  0, 1, res_16723,
                                                  paths_16674) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_unref_device(ctx, &mem_19513, "mem_19513") != 0)
            return 1;
        
        struct memblock_device mem_19539;
        
        mem_19539.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19539, bytes_19405, "mem_19539")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19775;
        
        mem_19775.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19775, 8, "mem_19775")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mainzicounter_mem_20407 =
                               ctx->mainzicounter_mem_20407;
        struct memblock_device group_res_arr_mem_20409;
        
        group_res_arr_mem_20409.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_20409,
                                  (int32_t) sizeof(int64_t) *
                                  (segred_group_sizze_19753 *
                                   segred_num_groups_19751),
                                  "group_res_arr_mem_20409")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_20411;
        
        num_threads_20411 = segred_num_groups_19751 * segred_group_sizze_19753;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                3, (int32_t) sizeof(int64_t) *
                                                segred_group_sizze_19753,
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                4, (int32_t) sizeof(bool),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                5, sizeof(paths_16674),
                                                &paths_16674));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                6, sizeof(res_16723),
                                                &res_16723));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                7, sizeof(cond_16737),
                                                &cond_16737));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                8, sizeof(mem_19521.mem),
                                                &mem_19521.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                9, sizeof(mem_19775.mem),
                                                &mem_19775.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                10,
                                                sizeof(mainzicounter_mem_20407.mem),
                                                &mainzicounter_mem_20407.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                11,
                                                sizeof(group_res_arr_mem_20409.mem),
                                                &group_res_arr_mem_20409.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19757,
                                                12, sizeof(num_threads_20411),
                                                &num_threads_20411));
        if (1 * ((size_t) segred_num_groups_19751 *
                 (size_t) segred_group_sizze_19753) != 0) {
            const size_t global_work_sizze_20787[1] =
                         {(size_t) segred_num_groups_19751 *
                         (size_t) segred_group_sizze_19753};
            const size_t local_work_sizze_20791[1] = {segred_group_sizze_19753};
            int64_t time_start_20788 = 0, time_end_20789 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segred_nonseg_19757");
                fprintf(stderr, "%zu", global_work_sizze_20787[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20791[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + (int32_t) sizeof(int64_t) *
                               segred_group_sizze_19753 +
                               (int32_t) sizeof(bool)));
                time_start_20788 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegred_nonseg_19757,
                                                            1, NULL,
                                                            global_work_sizze_20787,
                                                            local_work_sizze_20791,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegred_nonseg_19757_runs,
                                                                                                      &ctx->mainzisegred_nonseg_19757_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20789 = get_wall_time();
                
                long time_diff_20790 = time_end_20789 - time_start_20788;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segred_nonseg_19757", time_diff_20790);
            }
        }
        ctx->failure_is_an_option = 1;
        
        int64_t read_res_20792;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_19775.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0 * sizeof(int64_t),
                                                     sizeof(int64_t),
                                                     &read_res_20792, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        int64_t max_per_thread_19747 = read_res_20792;
        
        if (memblock_unref_device(ctx, &mem_19775, "mem_19775") != 0)
            return 1;
        
        int64_t sizze_sum_19770 = num_threads_19741 * max_per_thread_19747;
        struct memblock_device mem_19524;
        
        mem_19524.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19524, sizze_sum_19770,
                                  "mem_19524")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 3,
                                                sizeof(paths_16674),
                                                &paths_16674));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 4,
                                                sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 5,
                                                sizeof(res_16723), &res_16723));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 6,
                                                sizeof(cond_16737),
                                                &cond_16737));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 7,
                                                sizeof(num_groups_18779),
                                                &num_groups_18779));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 8,
                                                sizeof(mem_19516.mem),
                                                &mem_19516.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 9,
                                                sizeof(mem_19518.mem),
                                                &mem_19518.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 10,
                                                sizeof(mem_19521.mem),
                                                &mem_19521.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 11,
                                                sizeof(mem_19524.mem),
                                                &mem_19524.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 12,
                                                sizeof(mem_19539.mem),
                                                &mem_19539.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17894, 13,
                                                sizeof(num_threads_19741),
                                                &num_threads_19741));
        if (1 * ((size_t) num_groups_18779 *
                 (size_t) segmap_group_sizze_18778) != 0) {
            const size_t global_work_sizze_20793[1] =
                         {(size_t) num_groups_18779 *
                         (size_t) segmap_group_sizze_18778};
            const size_t local_work_sizze_20797[1] = {segmap_group_sizze_18778};
            int64_t time_start_20794 = 0, time_end_20795 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_17894");
                fprintf(stderr, "%zu", global_work_sizze_20793[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20797[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_20794 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_17894,
                                                            1, NULL,
                                                            global_work_sizze_20793,
                                                            local_work_sizze_20797,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_17894_runs,
                                                                                                      &ctx->mainzisegmap_17894_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20795 = get_wall_time();
                
                long time_diff_20796 = time_end_20795 - time_start_20794;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_17894", time_diff_20796);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_unref_device(ctx, &mem_19516, "mem_19516") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19518, "mem_19518") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19521, "mem_19521") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19524, "mem_19524") != 0)
            return 1;
        
        int64_t segmap_usable_groups_18816 = sdiv_up64(nest_sizze_18458,
                                                       segmap_group_sizze_18815);
        struct memblock_device mem_19543;
        
        mem_19543.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19543, bytes_19405, "mem_19543")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17864, 1,
                                                sizeof(paths_16674),
                                                &paths_16674));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17864, 2,
                                                sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17864, 3,
                                                sizeof(mem_19539.mem),
                                                &mem_19539.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_17864, 4,
                                                sizeof(mem_19543.mem),
                                                &mem_19543.mem));
        if (1 * ((size_t) segmap_usable_groups_18816 *
                 (size_t) segmap_group_sizze_18815) != 0) {
            const size_t global_work_sizze_20798[1] =
                         {(size_t) segmap_usable_groups_18816 *
                         (size_t) segmap_group_sizze_18815};
            const size_t local_work_sizze_20802[1] = {segmap_group_sizze_18815};
            int64_t time_start_20799 = 0, time_end_20800 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_17864");
                fprintf(stderr, "%zu", global_work_sizze_20798[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20802[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_20799 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_17864,
                                                            1, NULL,
                                                            global_work_sizze_20798,
                                                            local_work_sizze_20802,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_17864_runs,
                                                                                                      &ctx->mainzisegmap_17864_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20800 = get_wall_time();
                
                long time_diff_20801 = time_end_20800 - time_start_20799;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_17864", time_diff_20801);
            }
        }
        if (memblock_unref_device(ctx, &mem_19539, "mem_19539") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_19549, &mem_19543, "mem_19543") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19543, "mem_19543") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19524, "mem_19524") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20409,
                                  "group_res_arr_mem_20409") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19775, "mem_19775") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19539, "mem_19539") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19521, "mem_19521") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19518, "mem_19518") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19516, "mem_19516") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19513, "mem_19513") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19509, "mem_19509") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19506, "mem_19506") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19503, "mem_19503") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19500, "mem_19500") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19498, "mem_19498") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19495, "mem_19495") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19492, "mem_19492") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19489, "mem_19489") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_r_subhistos_mem_19972,
                                  "res_r_subhistos_mem_19972") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19470, "mem_19470") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19485, "mem_19485") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19467, "mem_19467") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19464, "mem_19464") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19460, "mem_19460") != 0)
            return 1;
    }
    if (memblock_unref_device(ctx, &mem_19274, "mem_19274") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_19277, "mem_19277") != 0)
        return 1;
    
    float res_16997 = sitofp_i64_f32(paths_16674);
    float x_16998 = fpow32(a_16679, 2.0F);
    float x_16999 = b_16680 * x_16998;
    float x_17000 = fpow32(sigma_16681, 2.0F);
    float y_17001 = x_17000 / 2.0F;
    float y_17002 = x_16999 - y_17001;
    float y_17003 = 4.0F * a_16679;
    bool suff_outer_redomap_18824;
    
    suff_outer_redomap_18824 = ctx->sizes.mainzisuff_outer_redomap_7 <=
        steps_16675;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_outer_redomap_7",
                steps_16675);
    
    int64_t segred_group_sizze_18837;
    
    segred_group_sizze_18837 = ctx->sizes.mainzisegred_group_sizze_18826;
    
    int64_t num_groups_18838;
    int32_t max_num_groups_20455;
    
    max_num_groups_20455 = ctx->sizes.mainzisegred_num_groups_18828;
    num_groups_18838 = sext_i64_i32(smax64(1, smin64(sdiv_up64(steps_16675,
                                                               sext_i32_i64(segred_group_sizze_18837)),
                                                     sext_i32_i64(max_num_groups_20455))));
    
    bool suff_outer_par_19033;
    
    suff_outer_par_19033 = ctx->sizes.mainzisuff_outer_par_8 <= steps_16675;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_outer_par_8",
                steps_16675);
    
    int64_t segmap_group_sizze_19037;
    
    segmap_group_sizze_19037 = ctx->sizes.mainzisegmap_group_sizze_18880;
    
    int64_t segred_group_sizze_19069;
    
    segred_group_sizze_19069 = ctx->sizes.mainzisegred_group_sizze_18971;
    
    int64_t num_groups_19070;
    int32_t max_num_groups_20456;
    
    max_num_groups_20456 = ctx->sizes.mainzisegred_num_groups_18973;
    num_groups_19070 = sext_i64_i32(smax64(1, smin64(sdiv_up64(nest_sizze_18458,
                                                               sext_i32_i64(segred_group_sizze_19069)),
                                                     sext_i32_i64(max_num_groups_20456))));
    
    int64_t segmap_group_sizze_19079;
    
    segmap_group_sizze_19079 = ctx->sizes.mainzisegmap_group_sizze_18944;
    
    int64_t segred_group_sizze_19107;
    
    segred_group_sizze_19107 = ctx->sizes.mainzisegred_group_sizze_19023;
    
    int64_t num_groups_19108;
    int32_t max_num_groups_20457;
    
    max_num_groups_20457 = ctx->sizes.mainzisegred_num_groups_19025;
    num_groups_19108 = sext_i64_i32(smax64(1, smin64(sdiv_up64(steps_16675,
                                                               sext_i32_i64(segred_group_sizze_19107)),
                                                     sext_i32_i64(max_num_groups_20457))));
    
    struct memblock_device res_mem_19579;
    
    res_mem_19579.references = NULL;
    
    float res_17005;
    int32_t local_memory_capacity_20591;
    
    local_memory_capacity_20591 = ctx->opencl.max_local_memory;
    if (sle64((int32_t) sizeof(bool) + (int32_t) sizeof(float) *
              segred_group_sizze_18837,
              sext_i32_i64(local_memory_capacity_20591)) &&
        suff_outer_redomap_18824) {
        struct memblock_device mem_19552;
        
        mem_19552.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19552, 4, "mem_19552")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_19554;
        
        mem_19554.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19554, bytes_19268, "mem_19554")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mainzicounter_mem_20458 =
                               ctx->mainzicounter_mem_20458;
        struct memblock_device group_res_arr_mem_20460;
        
        group_res_arr_mem_20460.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_20460,
                                  (int32_t) sizeof(float) *
                                  (segred_group_sizze_18837 * num_groups_18838),
                                  "group_res_arr_mem_20460")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_20462;
        
        num_threads_20462 = num_groups_18838 * segred_group_sizze_18837;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                1, (int32_t) sizeof(float) *
                                                segred_group_sizze_18837,
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                2, (int32_t) sizeof(bool),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                3, sizeof(paths_16674),
                                                &paths_16674));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                4, sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                5, sizeof(a_16679), &a_16679));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                6, sizeof(res_16997),
                                                &res_16997));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                7, sizeof(x_16998), &x_16998));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                8, sizeof(x_17000), &x_17000));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                9, sizeof(y_17002), &y_17002));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                10, sizeof(y_17003), &y_17003));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                11, sizeof(num_groups_18838),
                                                &num_groups_18838));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                12, sizeof(mem_19269.mem),
                                                &mem_19269.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                13, sizeof(res_mem_19549.mem),
                                                &res_mem_19549.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                14, sizeof(mem_19552.mem),
                                                &mem_19552.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                15, sizeof(mem_19554.mem),
                                                &mem_19554.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                16,
                                                sizeof(mainzicounter_mem_20458.mem),
                                                &mainzicounter_mem_20458.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                17,
                                                sizeof(group_res_arr_mem_20460.mem),
                                                &group_res_arr_mem_20460.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18835,
                                                18, sizeof(num_threads_20462),
                                                &num_threads_20462));
        if (1 * ((size_t) num_groups_18838 *
                 (size_t) segred_group_sizze_18837) != 0) {
            const size_t global_work_sizze_20804[1] =
                         {(size_t) num_groups_18838 *
                         (size_t) segred_group_sizze_18837};
            const size_t local_work_sizze_20808[1] = {segred_group_sizze_18837};
            int64_t time_start_20805 = 0, time_end_20806 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segred_nonseg_18835");
                fprintf(stderr, "%zu", global_work_sizze_20804[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20808[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + (int32_t) sizeof(float) *
                               segred_group_sizze_18837 +
                               (int32_t) sizeof(bool)));
                time_start_20805 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegred_nonseg_18835,
                                                            1, NULL,
                                                            global_work_sizze_20804,
                                                            local_work_sizze_20808,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegred_nonseg_18835_runs,
                                                                                                      &ctx->mainzisegred_nonseg_18835_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20806 = get_wall_time();
                
                long time_diff_20807 = time_end_20806 - time_start_20805;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segred_nonseg_18835", time_diff_20807);
            }
        }
        
        float read_res_20809;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_19552.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0 * sizeof(float),
                                                     sizeof(float),
                                                     &read_res_20809, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        float res_18871 = read_res_20809;
        
        if (memblock_unref_device(ctx, &mem_19552, "mem_19552") != 0)
            return 1;
        
        struct memblock_device mem_19577;
        
        mem_19577.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19577, bytes_19268, "mem_19577")) {
            err = 1;
            goto cleanup;
        }
        if (steps_16675 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         mem_19554.mem,
                                                         mem_19577.mem, 0, 0,
                                                         steps_16675 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        if (memblock_unref_device(ctx, &mem_19554, "mem_19554") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_19579, &mem_19577, "mem_19577") !=
            0)
            return 1;
        res_17005 = res_18871;
        if (memblock_unref_device(ctx, &mem_19577, "mem_19577") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20460,
                                  "group_res_arr_mem_20460") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19554, "mem_19554") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19552, "mem_19552") != 0)
            return 1;
    } else {
        struct memblock_device res_map_acc_mem_19571;
        
        res_map_acc_mem_19571.references = NULL;
        
        struct memblock_device res_mem_19572;
        
        res_mem_19572.references = NULL;
        
        int32_t local_memory_capacity_20560;
        
        local_memory_capacity_20560 = ctx->opencl.max_local_memory;
        if (sle64(0, sext_i32_i64(local_memory_capacity_20560)) &&
            suff_outer_par_19033) {
            int64_t segmap_usable_groups_19038 = sdiv_up64(steps_16675,
                                                           segmap_group_sizze_19037);
            struct memblock_device mem_19557;
            
            mem_19557.references = NULL;
            if (memblock_alloc_device(ctx, &mem_19557, bytes_19268,
                                      "mem_19557")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_19559;
            
            mem_19559.references = NULL;
            if (memblock_alloc_device(ctx, &mem_19559, bytes_19268,
                                      "mem_19559")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 1,
                                                    sizeof(paths_16674),
                                                    &paths_16674));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 2,
                                                    sizeof(steps_16675),
                                                    &steps_16675));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 3,
                                                    sizeof(a_16679), &a_16679));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 4,
                                                    sizeof(res_16997),
                                                    &res_16997));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 5,
                                                    sizeof(x_16998), &x_16998));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 6,
                                                    sizeof(x_17000), &x_17000));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 7,
                                                    sizeof(y_17002), &y_17002));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 8,
                                                    sizeof(y_17003), &y_17003));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 9,
                                                    sizeof(mem_19269.mem),
                                                    &mem_19269.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 10,
                                                    sizeof(res_mem_19549.mem),
                                                    &res_mem_19549.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 11,
                                                    sizeof(mem_19557.mem),
                                                    &mem_19557.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18878, 12,
                                                    sizeof(mem_19559.mem),
                                                    &mem_19559.mem));
            if (1 * ((size_t) segmap_usable_groups_19038 *
                     (size_t) segmap_group_sizze_19037) != 0) {
                const size_t global_work_sizze_20810[1] =
                             {(size_t) segmap_usable_groups_19038 *
                             (size_t) segmap_group_sizze_19037};
                const size_t local_work_sizze_20814[1] =
                             {segmap_group_sizze_19037};
                int64_t time_start_20811 = 0, time_end_20812 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.segmap_18878");
                    fprintf(stderr, "%zu", global_work_sizze_20810[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20814[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_20811 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainzisegmap_18878,
                                                                1, NULL,
                                                                global_work_sizze_20810,
                                                                local_work_sizze_20814,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainzisegmap_18878_runs,
                                                                                                          &ctx->mainzisegmap_18878_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20812 = get_wall_time();
                    
                    long time_diff_20813 = time_end_20812 - time_start_20811;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.segmap_18878", time_diff_20813);
                }
            }
            if (memblock_set_device(ctx, &res_map_acc_mem_19571, &mem_19557,
                                    "mem_19557") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_19572, &mem_19559,
                                    "mem_19559") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_19559, "mem_19559") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_19557, "mem_19557") != 0)
                return 1;
        } else {
            struct memblock_device mem_19562;
            
            mem_19562.references = NULL;
            if (memblock_alloc_device(ctx, &mem_19562, bytes_19405,
                                      "mem_19562")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_19562, 0,
                                                      res_mem_19549, 0, 1,
                                                      steps_16675,
                                                      paths_16674) != 0) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_19565;
            
            mem_19565.references = NULL;
            if (memblock_alloc_device(ctx, &mem_19565, bytes_19268,
                                      "mem_19565")) {
                err = 1;
                goto cleanup;
            }
            if (slt64(paths_16674 * 2, segred_group_sizze_19069)) {
                int64_t segment_sizze_nonzzero_20495 = smax64(1, paths_16674);
                int64_t num_threads_20496 = num_groups_19070 *
                        segred_group_sizze_19069;
                
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegRed-small");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_segments",
                            (long long) steps_16675, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segment_size",
                            (long long) paths_16674, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segments_per_group",
                            (long long) squot64(segred_group_sizze_19069,
                                                segment_sizze_nonzzero_20495),
                            '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "required_groups",
                            (long long) sext_i64_i32(sdiv_up64(steps_16675,
                                                               squot64(segred_group_sizze_19069,
                                                                       segment_sizze_nonzzero_20495))),
                            '\n');
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_18977,
                                                        1,
                                                        (int32_t) sizeof(float) *
                                                        segred_group_sizze_19069,
                                                        NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_18977,
                                                        2, sizeof(paths_16674),
                                                        &paths_16674));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_18977,
                                                        3, sizeof(steps_16675),
                                                        &steps_16675));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_18977,
                                                        4,
                                                        sizeof(num_groups_19070),
                                                        &num_groups_19070));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_18977,
                                                        5,
                                                        sizeof(mem_19562.mem),
                                                        &mem_19562.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_18977,
                                                        6,
                                                        sizeof(mem_19565.mem),
                                                        &mem_19565.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_18977,
                                                        7,
                                                        sizeof(segment_sizze_nonzzero_20495),
                                                        &segment_sizze_nonzzero_20495));
                if (1 * ((size_t) num_groups_19070 *
                         (size_t) segred_group_sizze_19069) != 0) {
                    const size_t global_work_sizze_20815[1] =
                                 {(size_t) num_groups_19070 *
                                 (size_t) segred_group_sizze_19069};
                    const size_t local_work_sizze_20819[1] =
                                 {segred_group_sizze_19069};
                    int64_t time_start_20816 = 0, time_end_20817 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "main.segred_small_18977");
                        fprintf(stderr, "%zu", global_work_sizze_20815[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_20819[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) (0 + (int32_t) sizeof(float) *
                                       segred_group_sizze_19069));
                        time_start_20816 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->mainzisegred_small_18977,
                                                                    1, NULL,
                                                                    global_work_sizze_20815,
                                                                    local_work_sizze_20819,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->mainzisegred_small_18977_runs,
                                                                                                              &ctx->mainzisegred_small_18977_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_20817 = get_wall_time();
                        
                        long time_diff_20818 = time_end_20817 -
                             time_start_20816;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "main.segred_small_18977", time_diff_20818);
                    }
                }
            } else {
                int64_t groups_per_segment_20516 = sdiv_up64(num_groups_19070,
                                                             smax64(1,
                                                                    steps_16675));
                int64_t elements_per_thread_20517 = sdiv_up64(paths_16674,
                                                              segred_group_sizze_19069 *
                                                              groups_per_segment_20516);
                int64_t virt_num_groups_20518 = groups_per_segment_20516 *
                        steps_16675;
                int64_t num_threads_20519 = num_groups_19070 *
                        segred_group_sizze_19069;
                int64_t threads_per_segment_20520 = groups_per_segment_20516 *
                        segred_group_sizze_19069;
                
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegRed-large");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_segments",
                            (long long) steps_16675, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segment_size",
                            (long long) paths_16674, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                            (long long) virt_num_groups_20518, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_groups",
                            (long long) num_groups_19070, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "group_size",
                            (long long) segred_group_sizze_19069, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                            (long long) elements_per_thread_20517, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                            (long long) groups_per_segment_20516, '\n');
                
                struct memblock_device group_res_arr_mem_20521;
                
                group_res_arr_mem_20521.references = NULL;
                if (memblock_alloc_device(ctx, &group_res_arr_mem_20521,
                                          (int32_t) sizeof(float) *
                                          (segred_group_sizze_19069 *
                                           virt_num_groups_20518),
                                          "group_res_arr_mem_20521")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mainzicounter_mem_20523 =
                                       ctx->mainzicounter_mem_20523;
                
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        1,
                                                        (int32_t) sizeof(bool),
                                                        NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        2,
                                                        (int32_t) sizeof(float) *
                                                        segred_group_sizze_19069,
                                                        NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        3, sizeof(paths_16674),
                                                        &paths_16674));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        4,
                                                        sizeof(num_groups_19070),
                                                        &num_groups_19070));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        5,
                                                        sizeof(mem_19562.mem),
                                                        &mem_19562.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        6,
                                                        sizeof(mem_19565.mem),
                                                        &mem_19565.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        7,
                                                        sizeof(groups_per_segment_20516),
                                                        &groups_per_segment_20516));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        8,
                                                        sizeof(elements_per_thread_20517),
                                                        &elements_per_thread_20517));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        9,
                                                        sizeof(virt_num_groups_20518),
                                                        &virt_num_groups_20518));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        10,
                                                        sizeof(threads_per_segment_20520),
                                                        &threads_per_segment_20520));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        11,
                                                        sizeof(group_res_arr_mem_20521.mem),
                                                        &group_res_arr_mem_20521.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_18977,
                                                        12,
                                                        sizeof(mainzicounter_mem_20523.mem),
                                                        &mainzicounter_mem_20523.mem));
                if (1 * ((size_t) num_groups_19070 *
                         (size_t) segred_group_sizze_19069) != 0) {
                    const size_t global_work_sizze_20821[1] =
                                 {(size_t) num_groups_19070 *
                                 (size_t) segred_group_sizze_19069};
                    const size_t local_work_sizze_20825[1] =
                                 {segred_group_sizze_19069};
                    int64_t time_start_20822 = 0, time_end_20823 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "main.segred_large_18977");
                        fprintf(stderr, "%zu", global_work_sizze_20821[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_20825[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) (0 + (int32_t) sizeof(bool) +
                                       (int32_t) sizeof(float) *
                                       segred_group_sizze_19069));
                        time_start_20822 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->mainzisegred_large_18977,
                                                                    1, NULL,
                                                                    global_work_sizze_20821,
                                                                    local_work_sizze_20825,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->mainzisegred_large_18977_runs,
                                                                                                              &ctx->mainzisegred_large_18977_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_20823 = get_wall_time();
                        
                        long time_diff_20824 = time_end_20823 -
                             time_start_20822;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "main.segred_large_18977", time_diff_20824);
                    }
                }
                if (memblock_unref_device(ctx, &group_res_arr_mem_20521,
                                          "group_res_arr_mem_20521") != 0)
                    return 1;
            }
            if (memblock_unref_device(ctx, &mem_19562, "mem_19562") != 0)
                return 1;
            
            int64_t segmap_usable_groups_19080 = sdiv_up64(steps_16675,
                                                           segmap_group_sizze_19079);
            struct memblock_device mem_19568;
            
            mem_19568.references = NULL;
            if (memblock_alloc_device(ctx, &mem_19568, bytes_19268,
                                      "mem_19568")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_19570;
            
            mem_19570.references = NULL;
            if (memblock_alloc_device(ctx, &mem_19570, bytes_19268,
                                      "mem_19570")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 1,
                                                    sizeof(steps_16675),
                                                    &steps_16675));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 2,
                                                    sizeof(a_16679), &a_16679));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 3,
                                                    sizeof(res_16997),
                                                    &res_16997));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 4,
                                                    sizeof(x_16998), &x_16998));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 5,
                                                    sizeof(x_17000), &x_17000));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 6,
                                                    sizeof(y_17002), &y_17002));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 7,
                                                    sizeof(y_17003), &y_17003));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 8,
                                                    sizeof(mem_19269.mem),
                                                    &mem_19269.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 9,
                                                    sizeof(mem_19565.mem),
                                                    &mem_19565.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 10,
                                                    sizeof(mem_19568.mem),
                                                    &mem_19568.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18942, 11,
                                                    sizeof(mem_19570.mem),
                                                    &mem_19570.mem));
            if (1 * ((size_t) segmap_usable_groups_19080 *
                     (size_t) segmap_group_sizze_19079) != 0) {
                const size_t global_work_sizze_20826[1] =
                             {(size_t) segmap_usable_groups_19080 *
                             (size_t) segmap_group_sizze_19079};
                const size_t local_work_sizze_20830[1] =
                             {segmap_group_sizze_19079};
                int64_t time_start_20827 = 0, time_end_20828 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.segmap_18942");
                    fprintf(stderr, "%zu", global_work_sizze_20826[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_20830[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_20827 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainzisegmap_18942,
                                                                1, NULL,
                                                                global_work_sizze_20826,
                                                                local_work_sizze_20830,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainzisegmap_18942_runs,
                                                                                                          &ctx->mainzisegmap_18942_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_20828 = get_wall_time();
                    
                    long time_diff_20829 = time_end_20828 - time_start_20827;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.segmap_18942", time_diff_20829);
                }
            }
            if (memblock_unref_device(ctx, &mem_19565, "mem_19565") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_map_acc_mem_19571, &mem_19568,
                                    "mem_19568") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_19572, &mem_19570,
                                    "mem_19570") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_19570, "mem_19570") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_19568, "mem_19568") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_19565, "mem_19565") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_19562, "mem_19562") != 0)
                return 1;
        }
        
        struct memblock_device mem_19575;
        
        mem_19575.references = NULL;
        if (memblock_alloc_device(ctx, &mem_19575, 4, "mem_19575")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mainzicounter_mem_20561 =
                               ctx->mainzicounter_mem_20561;
        struct memblock_device group_res_arr_mem_20563;
        
        group_res_arr_mem_20563.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_20563,
                                  (int32_t) sizeof(float) *
                                  (segred_group_sizze_19107 * num_groups_19108),
                                  "group_res_arr_mem_20563")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_20565;
        
        num_threads_20565 = num_groups_19108 * segred_group_sizze_19107;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19031,
                                                1, (int32_t) sizeof(float) *
                                                segred_group_sizze_19107,
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19031,
                                                2, (int32_t) sizeof(bool),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19031,
                                                3, sizeof(steps_16675),
                                                &steps_16675));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19031,
                                                4, sizeof(num_groups_19108),
                                                &num_groups_19108));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19031,
                                                5,
                                                sizeof(res_map_acc_mem_19571.mem),
                                                &res_map_acc_mem_19571.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19031,
                                                6, sizeof(mem_19575.mem),
                                                &mem_19575.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19031,
                                                7,
                                                sizeof(mainzicounter_mem_20561.mem),
                                                &mainzicounter_mem_20561.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19031,
                                                8,
                                                sizeof(group_res_arr_mem_20563.mem),
                                                &group_res_arr_mem_20563.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19031,
                                                9, sizeof(num_threads_20565),
                                                &num_threads_20565));
        if (1 * ((size_t) num_groups_19108 *
                 (size_t) segred_group_sizze_19107) != 0) {
            const size_t global_work_sizze_20832[1] =
                         {(size_t) num_groups_19108 *
                         (size_t) segred_group_sizze_19107};
            const size_t local_work_sizze_20836[1] = {segred_group_sizze_19107};
            int64_t time_start_20833 = 0, time_end_20834 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segred_nonseg_19031");
                fprintf(stderr, "%zu", global_work_sizze_20832[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_20836[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + (int32_t) sizeof(float) *
                               segred_group_sizze_19107 +
                               (int32_t) sizeof(bool)));
                time_start_20833 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegred_nonseg_19031,
                                                            1, NULL,
                                                            global_work_sizze_20832,
                                                            local_work_sizze_20836,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegred_nonseg_19031_runs,
                                                                                                      &ctx->mainzisegred_nonseg_19031_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_20834 = get_wall_time();
                
                long time_diff_20835 = time_end_20834 - time_start_20833;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segred_nonseg_19031", time_diff_20835);
            }
        }
        if (memblock_unref_device(ctx, &res_map_acc_mem_19571,
                                  "res_map_acc_mem_19571") != 0)
            return 1;
        
        float read_res_20837;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_19575.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0 * sizeof(float),
                                                     sizeof(float),
                                                     &read_res_20837, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        float res_19115 = read_res_20837;
        
        if (memblock_unref_device(ctx, &mem_19575, "mem_19575") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_19579, &res_mem_19572,
                                "res_mem_19572") != 0)
            return 1;
        res_17005 = res_19115;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20563,
                                  "group_res_arr_mem_20563") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_19575, "mem_19575") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_19572, "res_mem_19572") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_map_acc_mem_19571,
                                  "res_map_acc_mem_19571") != 0)
            return 1;
    }
    if (memblock_unref_device(ctx, &mem_19269, "mem_19269") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_19549, "res_mem_19549") != 0)
        return 1;
    
    float CVA_17036 = 6.0e-3F * res_17005;
    
    out_arrsizze_19787 = steps_16675;
    if (memblock_set_device(ctx, &out_mem_19786, &res_mem_19579,
                            "res_mem_19579") != 0)
        return 1;
    scalar_out_19785 = CVA_17036;
    *out_scalar_out_20637 = scalar_out_19785;
    (*out_mem_p_20638).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_20638, &out_mem_19786,
                            "out_mem_19786") != 0)
        return 1;
    *out_out_arrsizze_20639 = out_arrsizze_19787;
    if (memblock_unref_device(ctx, &res_mem_19579, "res_mem_19579") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_19549, "res_mem_19549") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_19277, "mem_19277") != 0)
        return 1;
    if (memblock_unref_device(ctx, &group_res_arr_mem_19842,
                              "group_res_arr_mem_19842") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_19274, "mem_19274") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_19272, "mem_19272") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_19269, "mem_19269") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_19267, "mem_19267") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_19265, "mem_19265") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_19786, "out_mem_19786") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
struct futhark_f32_1d {
    struct memblock_device mem;
    int64_t shape[1];
} ;
struct futhark_f32_1d *futhark_new_f32_1d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0)
{
    struct futhark_f32_1d *bad = NULL;
    struct futhark_f32_1d *arr =
                          (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(float),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * sizeof(float) > 0)
        OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                      arr->mem.mem, CL_TRUE, 0,
                                                      (size_t) dim0 *
                                                      sizeof(float), data + 0,
                                                      0, NULL,
                                                      ctx->profiling_paused ||
                                                      !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                &ctx->copy_dev_to_host_runs,
                                                                                                &ctx->copy_dev_to_host_total_runtime)));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_f32_1d *futhark_new_raw_f32_1d(struct futhark_context *ctx, const
                                              cl_mem data, int offset,
                                              int64_t dim0)
{
    struct futhark_f32_1d *bad = NULL;
    struct futhark_f32_1d *arr =
                          (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(float),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * sizeof(float) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue, data,
                                                     arr->mem.mem, offset, 0,
                                                     (size_t) dim0 *
                                                     sizeof(float), 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
        if (ctx->debugging)
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
    }
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f32_1d(struct futhark_context *ctx, struct futhark_f32_1d *arr)
{
    lock_lock(&ctx->lock);
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f32_1d(struct futhark_context *ctx,
                          struct futhark_f32_1d *arr, float *data)
{
    lock_lock(&ctx->lock);
    if ((size_t) arr->shape[0] * sizeof(float) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     arr->mem.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0, (size_t) arr->shape[0] *
                                                     sizeof(float), data + 0, 0,
                                                     NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_host_to_dev_runs,
                                                                                               &ctx->copy_host_to_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
    }
    lock_unlock(&ctx->lock);
    return 0;
}
cl_mem futhark_values_raw_f32_1d(struct futhark_context *ctx,
                                 struct futhark_f32_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f32_1d(struct futhark_context *ctx,
                                    struct futhark_f32_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
int futhark_entry_main(struct futhark_context *ctx, float *out0,
                       struct futhark_f32_1d **out1, const int64_t in0, const
                       int64_t in1, const float in2, const int64_t in3, const
                       float in4, const float in5, const float in6, const
                       float in7, const float in8)
{
    int64_t paths_16674;
    int64_t steps_16675;
    float swap_term_16676;
    int64_t payments_16677;
    float notional_16678;
    float a_16679;
    float b_16680;
    float sigma_16681;
    float r0_16682;
    float scalar_out_19785;
    struct memblock_device out_mem_19786;
    
    out_mem_19786.references = NULL;
    
    int64_t out_arrsizze_19787;
    
    lock_lock(&ctx->lock);
    paths_16674 = in0;
    steps_16675 = in1;
    swap_term_16676 = in2;
    payments_16677 = in3;
    notional_16678 = in4;
    a_16679 = in5;
    b_16680 = in6;
    sigma_16681 = in7;
    r0_16682 = in8;
    
    int ret = futrts_main(ctx, &scalar_out_19785, &out_mem_19786,
                          &out_arrsizze_19787, paths_16674, steps_16675,
                          swap_term_16676, payments_16677, notional_16678,
                          a_16679, b_16680, sigma_16681, r0_16682);
    
    if (ret == 0) {
        *out0 = scalar_out_19785;
        assert((*out1 =
                (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d))) !=
            NULL);
        (*out1)->mem = out_mem_19786;
        (*out1)->shape[0] = out_arrsizze_19787;
    }
    lock_unlock(&ctx->lock);
    return ret;
}
