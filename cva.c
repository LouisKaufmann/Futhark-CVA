#ifdef __GNUC__
#pragma GCC diagnostic ignored "-Wunused-function"
#pragma GCC diagnostic ignored "-Wunused-variable"
#pragma GCC diagnostic ignored "-Wparentheses"
#pragma GCC diagnostic ignored "-Wunused-label"
#endif
#ifdef __clang__
#pragma clang diagnostic ignored "-Wunused-function"
#pragma clang diagnostic ignored "-Wunused-variable"
#pragma clang diagnostic ignored "-Wparentheses"
#pragma clang diagnostic ignored "-Wunused-label"
#endif
// Headers

#define _GNU_SOURCE
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#define CL_TARGET_OPENCL_VERSION 120
#define CL_USE_DEPRECATED_OPENCL_1_2_APIS
#ifdef __APPLE__
#define CL_SILENCE_DEPRECATION
#include <OpenCL/cl.h>
#else
#include <CL/cl.h>
#endif


// Initialisation

int futhark_get_num_sizes(void);
const char *futhark_get_size_name(int);
const char *futhark_get_size_class(int);
struct futhark_context_config ;
struct futhark_context_config *futhark_context_config_new(void);
void futhark_context_config_free(struct futhark_context_config *cfg);
void futhark_context_config_add_build_option(struct futhark_context_config *cfg,
                                             const char *opt);
void futhark_context_config_set_debugging(struct futhark_context_config *cfg,
                                          int flag);
void futhark_context_config_set_profiling(struct futhark_context_config *cfg,
                                          int flag);
void futhark_context_config_set_logging(struct futhark_context_config *cfg,
                                        int flag);
void futhark_context_config_set_device(struct futhark_context_config *cfg, const
                                       char *s);
void futhark_context_config_set_platform(struct futhark_context_config *cfg,
                                         const char *s);
void
futhark_context_config_select_device_interactively(struct futhark_context_config *cfg);
void futhark_context_config_list_devices(struct futhark_context_config *cfg);
void futhark_context_config_dump_program_to(struct futhark_context_config *cfg,
                                            const char *path);
void
futhark_context_config_load_program_from(struct futhark_context_config *cfg,
                                         const char *path);
void futhark_context_config_dump_binary_to(struct futhark_context_config *cfg,
                                           const char *path);
void futhark_context_config_load_binary_from(struct futhark_context_config *cfg,
                                             const char *path);
void
futhark_context_config_set_default_group_size(struct futhark_context_config *cfg,
                                              int size);
void
futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg,
                                              int num);
void
futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg,
                                             int num);
void
futhark_context_config_set_default_threshold(struct futhark_context_config *cfg,
                                             int num);
int futhark_context_config_set_size(struct futhark_context_config *cfg, const
                                    char *size_name, size_t size_value);
struct futhark_context ;
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg);
struct futhark_context
*futhark_context_new_with_command_queue(struct futhark_context_config *cfg,
                                        cl_command_queue queue);
void futhark_context_free(struct futhark_context *ctx);
cl_command_queue futhark_context_get_command_queue(struct futhark_context *ctx);

// Arrays

struct futhark_f32_1d ;
struct futhark_f32_1d *futhark_new_f32_1d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0);
struct futhark_f32_1d *futhark_new_raw_f32_1d(struct futhark_context *ctx, const
                                              cl_mem data, int offset,
                                              int64_t dim0);
int futhark_free_f32_1d(struct futhark_context *ctx,
                        struct futhark_f32_1d *arr);
int futhark_values_f32_1d(struct futhark_context *ctx,
                          struct futhark_f32_1d *arr, float *data);
cl_mem futhark_values_raw_f32_1d(struct futhark_context *ctx,
                                 struct futhark_f32_1d *arr);
const int64_t *futhark_shape_f32_1d(struct futhark_context *ctx,
                                    struct futhark_f32_1d *arr);
struct futhark_i64_1d ;
struct futhark_i64_1d *futhark_new_i64_1d(struct futhark_context *ctx, const
                                          int64_t *data, int64_t dim0);
struct futhark_i64_1d *futhark_new_raw_i64_1d(struct futhark_context *ctx, const
                                              cl_mem data, int offset,
                                              int64_t dim0);
int futhark_free_i64_1d(struct futhark_context *ctx,
                        struct futhark_i64_1d *arr);
int futhark_values_i64_1d(struct futhark_context *ctx,
                          struct futhark_i64_1d *arr, int64_t *data);
cl_mem futhark_values_raw_i64_1d(struct futhark_context *ctx,
                                 struct futhark_i64_1d *arr);
const int64_t *futhark_shape_i64_1d(struct futhark_context *ctx,
                                    struct futhark_i64_1d *arr);

// Opaque values


// Entry points

int futhark_entry_main(struct futhark_context *ctx, float *out0,
                       struct futhark_f32_1d **out1, const int64_t in0, const
                       int64_t in1, const struct futhark_f32_1d *in2, const
                       struct futhark_i64_1d *in3, const
                       struct futhark_f32_1d *in4, const float in5, const
                       float in6, const float in7, const float in8);

// Miscellaneous

int futhark_context_sync(struct futhark_context *ctx);
int futhark_context_clear_caches(struct futhark_context *ctx);
char *futhark_context_report(struct futhark_context *ctx);
char *futhark_context_get_error(struct futhark_context *ctx);
void futhark_context_pause_profiling(struct futhark_context *ctx);
void futhark_context_unpause_profiling(struct futhark_context *ctx);
#define FUTHARK_BACKEND_opencl
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <math.h>
#include <stdint.h>
#undef NDEBUG
#include <assert.h>
#include <stdarg.h>
// Start of util.h.
//
// Various helper functions that are useful in all generated C code.

#include <errno.h>
#include <string.h>

static const char *fut_progname = "(embedded Futhark)";

static void futhark_panic(int eval, const char *fmt, ...) {
  va_list ap;
  va_start(ap, fmt);
  fprintf(stderr, "%s: ", fut_progname);
  vfprintf(stderr, fmt, ap);
  va_end(ap);
  exit(eval);
}

// For generating arbitrary-sized error messages.  It is the callers
// responsibility to free the buffer at some point.
static char* msgprintf(const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = 1 + (size_t)vsnprintf(NULL, 0, s, vl);
  char *buffer = (char*) malloc(needed);
  va_start(vl, s); // Must re-init.
  vsnprintf(buffer, needed, s, vl);
  return buffer;
}


static inline void check_err(int errval, int sets_errno, const char *fun, int line,
                            const char *msg, ...)
{
  if (errval) {
    char str[256];
    char errnum[10];
    sprintf(errnum, "%d", errval);
    sprintf(str, "ERROR: %s in %s() at line %d with error code %s\n", msg, fun, line,
            sets_errno ? strerror(errno) : errnum);
    fprintf(stderr, "%s", str);
    exit(errval);
  }
}

#define CHECK_ERR(err, msg...) check_err(err, 0, __func__, __LINE__, msg)
#define CHECK_ERRNO(err, msg...) check_err(err, 1, __func__, __LINE__, msg)

// Read a file into a NUL-terminated string; returns NULL on error.
static void* slurp_file(const char *filename, size_t *size) {
  unsigned char *s;
  FILE *f = fopen(filename, "rb"); // To avoid Windows messing with linebreaks.
  if (f == NULL) return NULL;
  fseek(f, 0, SEEK_END);
  size_t src_size = ftell(f);
  fseek(f, 0, SEEK_SET);
  s = (unsigned char*) malloc(src_size + 1);
  if (fread(s, 1, src_size, f) != src_size) {
    free(s);
    s = NULL;
  } else {
    s[src_size] = '\0';
  }
  fclose(f);

  if (size) {
    *size = src_size;
  }

  return s;
}

// Dump 'n' bytes from 'buf' into the file at the designated location.
// Returns 0 on success.
static int dump_file(const char *file, const void *buf, size_t n) {
  FILE *f = fopen(file, "w");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(buf, sizeof(char), n, f) != n) {
    return 1;
  }

  if (fclose(f) != 0) {
    return 1;
  }

  return 0;
}

struct str_builder {
  char *str;
  size_t capacity; // Size of buffer.
  size_t used; // Bytes used, *not* including final zero.
};

static void str_builder_init(struct str_builder *b) {
  b->capacity = 10;
  b->used = 0;
  b->str = malloc(b->capacity);
  b->str[0] = 0;
}

static void str_builder(struct str_builder *b, const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = (size_t)vsnprintf(NULL, 0, s, vl);

  while (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }

  va_start(vl, s); // Must re-init.
  vsnprintf(b->str+b->used, b->capacity-b->used, s, vl);
  b->used += needed;
}

// End of util.h.

// Start of timing.h.

// The function get_wall_time() returns the wall time in microseconds
// (with an unspecified offset).

#ifdef _WIN32

#include <windows.h>

static int64_t get_wall_time(void) {
  LARGE_INTEGER time,freq;
  assert(QueryPerformanceFrequency(&freq));
  assert(QueryPerformanceCounter(&time));
  return ((double)time.QuadPart / freq.QuadPart) * 1000000;
}

#else
// Assuming POSIX

#include <time.h>
#include <sys/time.h>

static int64_t get_wall_time(void) {
  struct timeval time;
  assert(gettimeofday(&time,NULL) == 0);
  return time.tv_sec * 1000000 + time.tv_usec;
}

static int64_t get_wall_time_ns(void) {
  struct timespec time;
  assert(clock_gettime(CLOCK_REALTIME, &time) == 0);
  return time.tv_sec * 1000000000 + time.tv_nsec;
}


static inline uint64_t rdtsc() {
  unsigned int hi, lo;
  __asm__ __volatile__("rdtsc" : "=a"(lo), "=d"(hi));
  return  ((uint64_t) lo) | (((uint64_t) hi) << 32);
}

static inline void rdtsc_wait(uint64_t n) {
  const uint64_t start = rdtsc();
  while (rdtsc() < (start + n)) {
    __asm__("PAUSE");
  }
}
static inline void spin_for(uint64_t nb_cycles) {
  rdtsc_wait(nb_cycles);
}


#endif

// End of timing.h.

#include <string.h>
#include <inttypes.h>
#include <errno.h>
#include <ctype.h>
#include <errno.h>
#include <getopt.h>
// Start of values.h.

//// Text I/O

typedef int (*writer)(FILE*, const void*);
typedef int (*bin_reader)(void*);
typedef int (*str_reader)(const char *, void*);

struct array_reader {
  char* elems;
  int64_t n_elems_space;
  int64_t elem_size;
  int64_t n_elems_used;
  int64_t *shape;
  str_reader elem_reader;
};

static void skipspaces() {
  int c;
  do {
    c = getchar();
  } while (isspace(c));

  if (c != EOF) {
    ungetc(c, stdin);
  }
}

static int constituent(char c) {
  return isalnum(c) || c == '.' || c == '-' || c == '+' || c == '_';
}

// Produces an empty token only on EOF.
static void next_token(char *buf, int bufsize) {
 start:
  skipspaces();

  int i = 0;
  while (i < bufsize) {
    int c = getchar();
    buf[i] = (char)c;

    if (c == EOF) {
      buf[i] = 0;
      return;
    } else if (c == '-' && i == 1 && buf[0] == '-') {
      // Line comment, so skip to end of line and start over.
      for (; c != '\n' && c != EOF; c = getchar());
      goto start;
    } else if (!constituent((char)c)) {
      if (i == 0) {
        // We permit single-character tokens that are not
        // constituents; this lets things like ']' and ',' be
        // tokens.
        buf[i+1] = 0;
        return;
      } else {
        ungetc(c, stdin);
        buf[i] = 0;
        return;
      }
    }

    i++;
  }

  buf[bufsize-1] = 0;
}

static int next_token_is(char *buf, int bufsize, const char* expected) {
  next_token(buf, bufsize);
  return strcmp(buf, expected) == 0;
}

static void remove_underscores(char *buf) {
  char *w = buf;

  for (char *r = buf; *r; r++) {
    if (*r != '_') {
      *w++ = *r;
    }
  }

  *w++ = 0;
}

static int read_str_elem(char *buf, struct array_reader *reader) {
  int ret;
  if (reader->n_elems_used == reader->n_elems_space) {
    reader->n_elems_space *= 2;
    reader->elems = (char*) realloc(reader->elems,
                                    (size_t)(reader->n_elems_space * reader->elem_size));
  }

  ret = reader->elem_reader(buf, reader->elems + reader->n_elems_used * reader->elem_size);

  if (ret == 0) {
    reader->n_elems_used++;
  }

  return ret;
}

static int read_str_array_elems(char *buf, int bufsize,
                                struct array_reader *reader, int64_t dims) {
  int ret;
  int first = 1;
  char *knows_dimsize = (char*) calloc((size_t)dims, sizeof(char));
  int cur_dim = dims-1;
  int64_t *elems_read_in_dim = (int64_t*) calloc((size_t)dims, sizeof(int64_t));

  while (1) {
    next_token(buf, bufsize);

    if (strcmp(buf, "]") == 0) {
      if (knows_dimsize[cur_dim]) {
        if (reader->shape[cur_dim] != elems_read_in_dim[cur_dim]) {
          ret = 1;
          break;
        }
      } else {
        knows_dimsize[cur_dim] = 1;
        reader->shape[cur_dim] = elems_read_in_dim[cur_dim];
      }
      if (cur_dim == 0) {
        ret = 0;
        break;
      } else {
        cur_dim--;
        elems_read_in_dim[cur_dim]++;
      }
    } else if (strcmp(buf, ",") == 0) {
      next_token(buf, bufsize);
      if (strcmp(buf, "[") == 0) {
        if (cur_dim == dims - 1) {
          ret = 1;
          break;
        }
        first = 1;
        cur_dim++;
        elems_read_in_dim[cur_dim] = 0;
      } else if (cur_dim == dims - 1) {
        ret = read_str_elem(buf, reader);
        if (ret != 0) {
          break;
        }
        elems_read_in_dim[cur_dim]++;
      } else {
        ret = 1;
        break;
      }
    } else if (strlen(buf) == 0) {
      // EOF
      ret = 1;
      break;
    } else if (first) {
      if (strcmp(buf, "[") == 0) {
        if (cur_dim == dims - 1) {
          ret = 1;
          break;
        }
        cur_dim++;
        elems_read_in_dim[cur_dim] = 0;
      } else {
        ret = read_str_elem(buf, reader);
        if (ret != 0) {
          break;
        }
        elems_read_in_dim[cur_dim]++;
        first = 0;
      }
    } else {
      ret = 1;
      break;
    }
  }

  free(knows_dimsize);
  free(elems_read_in_dim);
  return ret;
}

static int read_str_empty_array(char *buf, int bufsize,
                                const char *type_name, int64_t *shape, int64_t dims) {
  if (strlen(buf) == 0) {
    // EOF
    return 1;
  }

  if (strcmp(buf, "empty") != 0) {
    return 1;
  }

  if (!next_token_is(buf, bufsize, "(")) {
    return 1;
  }

  for (int i = 0; i < dims; i++) {
    if (!next_token_is(buf, bufsize, "[")) {
      return 1;
    }

    next_token(buf, bufsize);

    if (sscanf(buf, "%"SCNu64, (uint64_t*)&shape[i]) != 1) {
      return 1;
    }

    if (!next_token_is(buf, bufsize, "]")) {
      return 1;
    }
  }

  if (!next_token_is(buf, bufsize, type_name)) {
    return 1;
  }


  if (!next_token_is(buf, bufsize, ")")) {
    return 1;
  }

  // Check whether the array really is empty.
  for (int i = 0; i < dims; i++) {
    if (shape[i] == 0) {
      return 0;
    }
  }

  // Not an empty array!
  return 1;
}

static int read_str_array(int64_t elem_size, str_reader elem_reader,
                          const char *type_name,
                          void **data, int64_t *shape, int64_t dims) {
  int ret;
  struct array_reader reader;
  char buf[100];

  int dims_seen;
  for (dims_seen = 0; dims_seen < dims; dims_seen++) {
    if (!next_token_is(buf, sizeof(buf), "[")) {
      break;
    }
  }

  if (dims_seen == 0) {
    return read_str_empty_array(buf, sizeof(buf), type_name, shape, dims);
  }

  if (dims_seen != dims) {
    return 1;
  }

  reader.shape = shape;
  reader.n_elems_used = 0;
  reader.elem_size = elem_size;
  reader.n_elems_space = 16;
  reader.elems = (char*) realloc(*data, (size_t)(elem_size*reader.n_elems_space));
  reader.elem_reader = elem_reader;

  ret = read_str_array_elems(buf, sizeof(buf), &reader, dims);

  *data = reader.elems;

  return ret;
}

#define READ_STR(MACRO, PTR, SUFFIX)                                   \
  remove_underscores(buf);                                              \
  int j;                                                                \
  if (sscanf(buf, "%"MACRO"%n", (PTR*)dest, &j) == 1) {                 \
    return !(strcmp(buf+j, "") == 0 || strcmp(buf+j, SUFFIX) == 0);     \
  } else {                                                              \
    return 1;                                                           \
  }

static int read_str_i8(char *buf, void* dest) {
  // Some platforms (WINDOWS) does not support scanf %hhd or its
  // cousin, %SCNi8.  Read into int first to avoid corrupting
  // memory.
  //
  // https://gcc.gnu.org/bugzilla/show_bug.cgi?id=63417
  remove_underscores(buf);
  int j, x;
  if (sscanf(buf, "%i%n", &x, &j) == 1) {
    *(int8_t*)dest = (int8_t)x;
    return !(strcmp(buf+j, "") == 0 || strcmp(buf+j, "i8") == 0);
  } else {
    return 1;
  }
}

static int read_str_u8(char *buf, void* dest) {
  // Some platforms (WINDOWS) does not support scanf %hhd or its
  // cousin, %SCNu8.  Read into int first to avoid corrupting
  // memory.
  //
  // https://gcc.gnu.org/bugzilla/show_bug.cgi?id=63417
  remove_underscores(buf);
  int j, x;
  if (sscanf(buf, "%i%n", &x, &j) == 1) {
    *(uint8_t*)dest = (uint8_t)x;
    return !(strcmp(buf+j, "") == 0 || strcmp(buf+j, "u8") == 0);
  } else {
    return 1;
  }
}

static int read_str_i16(char *buf, void* dest) {
  READ_STR(SCNi16, int16_t, "i16");
}

static int read_str_u16(char *buf, void* dest) {
  READ_STR(SCNi16, int16_t, "u16");
}

static int read_str_i32(char *buf, void* dest) {
  READ_STR(SCNi32, int32_t, "i32");
}

static int read_str_u32(char *buf, void* dest) {
  READ_STR(SCNi32, int32_t, "u32");
}

static int read_str_i64(char *buf, void* dest) {
  READ_STR(SCNi64, int64_t, "i64");
}

static int read_str_u64(char *buf, void* dest) {
  // FIXME: This is not correct, as SCNu64 only permits decimal
  // literals.  However, SCNi64 does not handle very large numbers
  // correctly (it's really for signed numbers, so that's fair).
  READ_STR(SCNu64, uint64_t, "u64");
}

static int read_str_f32(char *buf, void* dest) {
  remove_underscores(buf);
  if (strcmp(buf, "f32.nan") == 0) {
    *(float*)dest = NAN;
    return 0;
  } else if (strcmp(buf, "f32.inf") == 0) {
    *(float*)dest = INFINITY;
    return 0;
  } else if (strcmp(buf, "-f32.inf") == 0) {
    *(float*)dest = -INFINITY;
    return 0;
  } else {
    READ_STR("f", float, "f32");
  }
}

static int read_str_f64(char *buf, void* dest) {
  remove_underscores(buf);
  if (strcmp(buf, "f64.nan") == 0) {
    *(double*)dest = NAN;
    return 0;
  } else if (strcmp(buf, "f64.inf") == 0) {
    *(double*)dest = INFINITY;
    return 0;
  } else if (strcmp(buf, "-f64.inf") == 0) {
    *(double*)dest = -INFINITY;
    return 0;
  } else {
    READ_STR("lf", double, "f64");
  }
}

static int read_str_bool(char *buf, void* dest) {
  if (strcmp(buf, "true") == 0) {
    *(char*)dest = 1;
    return 0;
  } else if (strcmp(buf, "false") == 0) {
    *(char*)dest = 0;
    return 0;
  } else {
    return 1;
  }
}

static int write_str_i8(FILE *out, int8_t *src) {
  return fprintf(out, "%hhdi8", *src);
}

static int write_str_u8(FILE *out, uint8_t *src) {
  return fprintf(out, "%hhuu8", *src);
}

static int write_str_i16(FILE *out, int16_t *src) {
  return fprintf(out, "%hdi16", *src);
}

static int write_str_u16(FILE *out, uint16_t *src) {
  return fprintf(out, "%huu16", *src);
}

static int write_str_i32(FILE *out, int32_t *src) {
  return fprintf(out, "%di32", *src);
}

static int write_str_u32(FILE *out, uint32_t *src) {
  return fprintf(out, "%uu32", *src);
}

static int write_str_i64(FILE *out, int64_t *src) {
  return fprintf(out, "%"PRIi64"i64", *src);
}

static int write_str_u64(FILE *out, uint64_t *src) {
  return fprintf(out, "%"PRIu64"u64", *src);
}

static int write_str_f32(FILE *out, float *src) {
  float x = *src;
  if (isnan(x)) {
    return fprintf(out, "f32.nan");
  } else if (isinf(x) && x >= 0) {
    return fprintf(out, "f32.inf");
  } else if (isinf(x)) {
    return fprintf(out, "-f32.inf");
  } else {
    return fprintf(out, "%.6ff32", x);
  }
}

static int write_str_f64(FILE *out, double *src) {
  double x = *src;
  if (isnan(x)) {
    return fprintf(out, "f64.nan");
  } else if (isinf(x) && x >= 0) {
    return fprintf(out, "f64.inf");
  } else if (isinf(x)) {
    return fprintf(out, "-f64.inf");
  } else {
    return fprintf(out, "%.6ff64", *src);
  }
}

static int write_str_bool(FILE *out, void *src) {
  return fprintf(out, *(char*)src ? "true" : "false");
}

//// Binary I/O

#define BINARY_FORMAT_VERSION 2
#define IS_BIG_ENDIAN (!*(unsigned char *)&(uint16_t){1})

static void flip_bytes(int elem_size, unsigned char *elem) {
  for (int j=0; j<elem_size/2; j++) {
    unsigned char head = elem[j];
    int tail_index = elem_size-1-j;
    elem[j] = elem[tail_index];
    elem[tail_index] = head;
  }
}

// On Windows we need to explicitly set the file mode to not mangle
// newline characters.  On *nix there is no difference.
#ifdef _WIN32
#include <io.h>
#include <fcntl.h>
static void set_binary_mode(FILE *f) {
  setmode(fileno(f), O_BINARY);
}
#else
static void set_binary_mode(FILE *f) {
  (void)f;
}
#endif

static int read_byte(void* dest) {
  int num_elems_read = fread(dest, 1, 1, stdin);
  return num_elems_read == 1 ? 0 : 1;
}

//// Types

struct primtype_info_t {
  const char binname[4]; // Used for parsing binary data.
  const char* type_name; // Same name as in Futhark.
  const int64_t size; // in bytes
  const writer write_str; // Write in text format.
  const str_reader read_str; // Read in text format.
};

static const struct primtype_info_t i8_info =
  {.binname = "  i8", .type_name = "i8",   .size = 1,
   .write_str = (writer)write_str_i8, .read_str = (str_reader)read_str_i8};
static const struct primtype_info_t i16_info =
  {.binname = " i16", .type_name = "i16",  .size = 2,
   .write_str = (writer)write_str_i16, .read_str = (str_reader)read_str_i16};
static const struct primtype_info_t i32_info =
  {.binname = " i32", .type_name = "i32",  .size = 4,
   .write_str = (writer)write_str_i32, .read_str = (str_reader)read_str_i32};
static const struct primtype_info_t i64_info =
  {.binname = " i64", .type_name = "i64",  .size = 8,
   .write_str = (writer)write_str_i64, .read_str = (str_reader)read_str_i64};
static const struct primtype_info_t u8_info =
  {.binname = "  u8", .type_name = "u8",   .size = 1,
   .write_str = (writer)write_str_u8, .read_str = (str_reader)read_str_u8};
static const struct primtype_info_t u16_info =
  {.binname = " u16", .type_name = "u16",  .size = 2,
   .write_str = (writer)write_str_u16, .read_str = (str_reader)read_str_u16};
static const struct primtype_info_t u32_info =
  {.binname = " u32", .type_name = "u32",  .size = 4,
   .write_str = (writer)write_str_u32, .read_str = (str_reader)read_str_u32};
static const struct primtype_info_t u64_info =
  {.binname = " u64", .type_name = "u64",  .size = 8,
   .write_str = (writer)write_str_u64, .read_str = (str_reader)read_str_u64};
static const struct primtype_info_t f32_info =
  {.binname = " f32", .type_name = "f32",  .size = 4,
   .write_str = (writer)write_str_f32, .read_str = (str_reader)read_str_f32};
static const struct primtype_info_t f64_info =
  {.binname = " f64", .type_name = "f64",  .size = 8,
   .write_str = (writer)write_str_f64, .read_str = (str_reader)read_str_f64};
static const struct primtype_info_t bool_info =
  {.binname = "bool", .type_name = "bool", .size = 1,
   .write_str = (writer)write_str_bool, .read_str = (str_reader)read_str_bool};

static const struct primtype_info_t* primtypes[] = {
  &i8_info, &i16_info, &i32_info, &i64_info,
  &u8_info, &u16_info, &u32_info, &u64_info,
  &f32_info, &f64_info,
  &bool_info,
  NULL // NULL-terminated
};

// General value interface.  All endian business taken care of at
// lower layers.

static int read_is_binary() {
  skipspaces();
  int c = getchar();
  if (c == 'b') {
    int8_t bin_version;
    int ret = read_byte(&bin_version);

    if (ret != 0) { futhark_panic(1, "binary-input: could not read version.\n"); }

    if (bin_version != BINARY_FORMAT_VERSION) {
      futhark_panic(1, "binary-input: File uses version %i, but I only understand version %i.\n",
            bin_version, BINARY_FORMAT_VERSION);
    }

    return 1;
  }
  ungetc(c, stdin);
  return 0;
}

static const struct primtype_info_t* read_bin_read_type_enum() {
  char read_binname[4];

  int num_matched = scanf("%4c", read_binname);
  if (num_matched != 1) { futhark_panic(1, "binary-input: Couldn't read element type.\n"); }

  const struct primtype_info_t **type = primtypes;

  for (; *type != NULL; type++) {
    // I compare the 4 characters manually instead of using strncmp because
    // this allows any value to be used, also NULL bytes
    if (memcmp(read_binname, (*type)->binname, 4) == 0) {
      return *type;
    }
  }
  futhark_panic(1, "binary-input: Did not recognize the type '%s'.\n", read_binname);
  return NULL;
}

static void read_bin_ensure_scalar(const struct primtype_info_t *expected_type) {
  int8_t bin_dims;
  int ret = read_byte(&bin_dims);
  if (ret != 0) { futhark_panic(1, "binary-input: Couldn't get dims.\n"); }

  if (bin_dims != 0) {
    futhark_panic(1, "binary-input: Expected scalar (0 dimensions), but got array with %i dimensions.\n",
          bin_dims);
  }

  const struct primtype_info_t *bin_type = read_bin_read_type_enum();
  if (bin_type != expected_type) {
    futhark_panic(1, "binary-input: Expected scalar of type %s but got scalar of type %s.\n",
          expected_type->type_name,
          bin_type->type_name);
  }
}

//// High-level interface

static int read_bin_array(const struct primtype_info_t *expected_type, void **data, int64_t *shape, int64_t dims) {
  int ret;

  int8_t bin_dims;
  ret = read_byte(&bin_dims);
  if (ret != 0) { futhark_panic(1, "binary-input: Couldn't get dims.\n"); }

  if (bin_dims != dims) {
    futhark_panic(1, "binary-input: Expected %i dimensions, but got array with %i dimensions.\n",
          dims, bin_dims);
  }

  const struct primtype_info_t *bin_primtype = read_bin_read_type_enum();
  if (expected_type != bin_primtype) {
    futhark_panic(1, "binary-input: Expected %iD-array with element type '%s' but got %iD-array with element type '%s'.\n",
          dims, expected_type->type_name, dims, bin_primtype->type_name);
  }

  int64_t elem_count = 1;
  for (int i=0; i<dims; i++) {
    int64_t bin_shape;
    ret = fread(&bin_shape, sizeof(bin_shape), 1, stdin);
    if (ret != 1) {
      futhark_panic(1, "binary-input: Couldn't read size for dimension %i of array.\n", i);
    }
    if (IS_BIG_ENDIAN) {
      flip_bytes(sizeof(bin_shape), (unsigned char*) &bin_shape);
    }
    elem_count *= bin_shape;
    shape[i] = bin_shape;
  }

  int64_t elem_size = expected_type->size;
  void* tmp = realloc(*data, (size_t)(elem_count * elem_size));
  if (tmp == NULL) {
    futhark_panic(1, "binary-input: Failed to allocate array of size %i.\n",
          elem_count * elem_size);
  }
  *data = tmp;

  int64_t num_elems_read = (int64_t)fread(*data, (size_t)elem_size, (size_t)elem_count, stdin);
  if (num_elems_read != elem_count) {
    futhark_panic(1, "binary-input: tried to read %i elements of an array, but only got %i elements.\n",
          elem_count, num_elems_read);
  }

  // If we're on big endian platform we must change all multibyte elements
  // from using little endian to big endian
  if (IS_BIG_ENDIAN && elem_size != 1) {
    flip_bytes(elem_size, (unsigned char*) *data);
  }

  return 0;
}

static int read_array(const struct primtype_info_t *expected_type, void **data, int64_t *shape, int64_t dims) {
  if (!read_is_binary()) {
    return read_str_array(expected_type->size, (str_reader)expected_type->read_str, expected_type->type_name, data, shape, dims);
  } else {
    return read_bin_array(expected_type, data, shape, dims);
  }
}

static int end_of_input() {
  skipspaces();
  char token[2];
  next_token(token, sizeof(token));
  if (strcmp(token, "") == 0) {
    return 0;
  } else {
    return 1;
  }
}

static int write_str_array(FILE *out,
                           const struct primtype_info_t *elem_type,
                           const unsigned char *data,
                           const int64_t *shape,
                           int8_t rank) {
  if (rank==0) {
    elem_type->write_str(out, (void*)data);
  } else {
    int64_t len = (int64_t)shape[0];
    int64_t slice_size = 1;

    int64_t elem_size = elem_type->size;
    for (int8_t i = 1; i < rank; i++) {
      slice_size *= shape[i];
    }

    if (len*slice_size == 0) {
      printf("empty(");
      for (int64_t i = 0; i < rank; i++) {
        printf("[%"PRIi64"]", shape[i]);
      }
      printf("%s", elem_type->type_name);
      printf(")");
    } else if (rank==1) {
      putchar('[');
      for (int64_t i = 0; i < len; i++) {
        elem_type->write_str(out, (void*) (data + i * elem_size));
        if (i != len-1) {
          printf(", ");
        }
      }
      putchar(']');
    } else {
      putchar('[');
      for (int64_t i = 0; i < len; i++) {
        write_str_array(out, elem_type, data + i * slice_size * elem_size, shape+1, rank-1);
        if (i != len-1) {
          printf(", ");
        }
      }
      putchar(']');
    }
  }
  return 0;
}

static int write_bin_array(FILE *out,
                           const struct primtype_info_t *elem_type,
                           const unsigned char *data,
                           const int64_t *shape,
                           int8_t rank) {
  int64_t num_elems = 1;
  for (int64_t i = 0; i < rank; i++) {
    num_elems *= shape[i];
  }

  fputc('b', out);
  fputc((char)BINARY_FORMAT_VERSION, out);
  fwrite(&rank, sizeof(int8_t), 1, out);
  fputs(elem_type->binname, out);
  if (shape != NULL) {
    fwrite(shape, sizeof(int64_t), (size_t)rank, out);
  }

  if (IS_BIG_ENDIAN) {
    for (int64_t i = 0; i < num_elems; i++) {
      const unsigned char *elem = data+i*elem_type->size;
      for (int64_t j = 0; j < elem_type->size; j++) {
        fwrite(&elem[elem_type->size-j], 1, 1, out);
      }
    }
  } else {
    fwrite(data, (size_t)elem_type->size, (size_t)num_elems, out);
  }

  return 0;
}

static int write_array(FILE *out, int write_binary,
                       const struct primtype_info_t *elem_type,
                       const void *data,
                       const int64_t *shape,
                       const int8_t rank) {
  if (write_binary) {
    return write_bin_array(out, elem_type, data, shape, rank);
  } else {
    return write_str_array(out, elem_type, data, shape, rank);
  }
}

static int read_scalar(const struct primtype_info_t *expected_type, void *dest) {
  if (!read_is_binary()) {
    char buf[100];
    next_token(buf, sizeof(buf));
    return expected_type->read_str(buf, dest);
  } else {
    read_bin_ensure_scalar(expected_type);
    int64_t elem_size = expected_type->size;
    int num_elems_read = fread(dest, (size_t)elem_size, 1, stdin);
    if (IS_BIG_ENDIAN) {
      flip_bytes(elem_size, (unsigned char*) dest);
    }
    return num_elems_read == 1 ? 0 : 1;
  }
}

static int write_scalar(FILE *out, int write_binary, const struct primtype_info_t *type, void *src) {
  if (write_binary) {
    return write_bin_array(out, type, src, NULL, 0);
  } else {
    return type->write_str(out, src);
  }
}

// End of values.h.

#define __private
static int binary_output = 0;
static FILE *runtime_file;
static int perform_warmup = 0;
static int num_runs = 1;
static const char *entry_point = "main";
// Start of tuning.h.

static char* load_tuning_file(const char *fname,
                              void *cfg,
                              int (*set_size)(void*, const char*, size_t)) {
  const int max_line_len = 1024;
  char* line = (char*) malloc(max_line_len);

  FILE *f = fopen(fname, "r");

  if (f == NULL) {
    snprintf(line, max_line_len, "Cannot open file: %s", strerror(errno));
    return line;
  }

  int lineno = 0;
  while (fgets(line, max_line_len, f) != NULL) {
    lineno++;
    char *eql = strstr(line, "=");
    if (eql) {
      *eql = 0;
      int value = atoi(eql+1);
      if (set_size(cfg, line, value) != 0) {
        strncpy(eql+1, line, max_line_len-strlen(line)-1);
        snprintf(line, max_line_len, "Unknown name '%s' on line %d.", eql+1, lineno);
        return line;
      }
    } else {
      snprintf(line, max_line_len, "Invalid line %d (must be of form 'name=int').",
               lineno);
      return line;
    }
  }

  free(line);

  return NULL;
}

// End of tuning.h.

int parse_options(struct futhark_context_config *cfg, int argc,
                  char *const argv[])
{
    int ch;
    static struct option long_options[] = {{"write-runtime-to",
                                            required_argument, NULL, 1},
                                           {"runs", required_argument, NULL, 2},
                                           {"debugging", no_argument, NULL, 3},
                                           {"log", no_argument, NULL, 4},
                                           {"entry-point", required_argument,
                                            NULL, 5}, {"binary-output",
                                                       no_argument, NULL, 6},
                                           {"help", no_argument, NULL, 7},
                                           {"device", required_argument, NULL,
                                            8}, {"default-group-size",
                                                 required_argument, NULL, 9},
                                           {"default-num-groups",
                                            required_argument, NULL, 10},
                                           {"default-tile-size",
                                            required_argument, NULL, 11},
                                           {"default-threshold",
                                            required_argument, NULL, 12},
                                           {"print-sizes", no_argument, NULL,
                                            13}, {"size", required_argument,
                                                  NULL, 14}, {"tuning",
                                                              required_argument,
                                                              NULL, 15},
                                           {"platform", required_argument, NULL,
                                            16}, {"dump-opencl",
                                                  required_argument, NULL, 17},
                                           {"load-opencl", required_argument,
                                            NULL, 18}, {"dump-opencl-binary",
                                                        required_argument, NULL,
                                                        19},
                                           {"load-opencl-binary",
                                            required_argument, NULL, 20},
                                           {"build-option", required_argument,
                                            NULL, 21}, {"profile", no_argument,
                                                        NULL, 22},
                                           {"list-devices", no_argument, NULL,
                                            23}, {0, 0, 0, 0}};
    static char *option_descriptions =
                "  -t/--write-runtime-to FILE Print the time taken to execute the program to the indicated file, an integral number of microseconds.\n  -r/--runs INT              Perform NUM runs of the program.\n  -D/--debugging             Perform possibly expensive internal correctness checks and verbose logging.\n  -L/--log                   Print various low-overhead logging information to stderr while running.\n  -e/--entry-point NAME      The entry point to run. Defaults to main.\n  -b/--binary-output         Print the program result in the binary output format.\n  -h/--help                  Print help information and exit.\n  -d/--device NAME           Use the first OpenCL device whose name contains the given string.\n  --default-group-size INT   The default size of OpenCL workgroups that are launched.\n  --default-num-groups INT   The default number of OpenCL workgroups that are launched.\n  --default-tile-size INT    The default tile size used when performing two-dimensional tiling.\n  --default-threshold INT    The default parallelism threshold.\n  --print-sizes              Print all sizes that can be set with -size or --tuning.\n  --size ASSIGNMENT          Set a configurable run-time parameter to the given value.\n  --tuning FILE              Read size=value assignments from the given file.\n  -p/--platform NAME         Use the first OpenCL platform whose name contains the given string.\n  --dump-opencl FILE         Dump the embedded OpenCL program to the indicated file.\n  --load-opencl FILE         Instead of using the embedded OpenCL program, load it from the indicated file.\n  --dump-opencl-binary FILE  Dump the compiled version of the embedded OpenCL program to the indicated file.\n  --load-opencl-binary FILE  Load an OpenCL binary from the indicated file.\n  --build-option OPT         Add an additional build option to the string passed to clBuildProgram().\n  -P/--profile               Gather profiling data while executing and print out a summary at the end.\n  --list-devices             List all OpenCL devices and platforms available on the system.\n";
    
    while ((ch = getopt_long(argc, argv, ":t:r:DLe:bhd:p:P", long_options,
                             NULL)) != -1) {
        if (ch == 1 || ch == 't') {
            runtime_file = fopen(optarg, "w");
            if (runtime_file == NULL)
                futhark_panic(1, "Cannot open %s: %s\n", optarg,
                              strerror(errno));
        }
        if (ch == 2 || ch == 'r') {
            num_runs = atoi(optarg);
            perform_warmup = 1;
            if (num_runs <= 0)
                futhark_panic(1, "Need a positive number of runs, not %s\n",
                              optarg);
        }
        if (ch == 3 || ch == 'D')
            futhark_context_config_set_debugging(cfg, 1);
        if (ch == 4 || ch == 'L')
            futhark_context_config_set_logging(cfg, 1);
        if (ch == 5 || ch == 'e') {
            if (entry_point != NULL)
                entry_point = optarg;
        }
        if (ch == 6 || ch == 'b')
            binary_output = 1;
        if (ch == 7 || ch == 'h') {
            printf("Usage: %s [OPTION]...\nOptions:\n\n%s\nFor more information, consult the Futhark User's Guide or the man pages.\n",
                   fut_progname, option_descriptions);
            exit(0);
        }
        if (ch == 8 || ch == 'd')
            futhark_context_config_set_device(cfg, optarg);
        if (ch == 9)
            futhark_context_config_set_default_group_size(cfg, atoi(optarg));
        if (ch == 10)
            futhark_context_config_set_default_num_groups(cfg, atoi(optarg));
        if (ch == 11)
            futhark_context_config_set_default_tile_size(cfg, atoi(optarg));
        if (ch == 12)
            futhark_context_config_set_default_threshold(cfg, atoi(optarg));
        if (ch == 13) {
            int n = futhark_get_num_sizes();
            
            for (int i = 0; i < n; i++)
                printf("%s (%s)\n", futhark_get_size_name(i),
                       futhark_get_size_class(i));
            exit(0);
        }
        if (ch == 14) {
            char *name = optarg;
            char *equals = strstr(optarg, "=");
            char *value_str = equals != NULL ? equals + 1 : optarg;
            int value = atoi(value_str);
            
            if (equals != NULL) {
                *equals = 0;
                if (futhark_context_config_set_size(cfg, name, value) != 0)
                    futhark_panic(1, "Unknown size: %s\n", name);
            } else
                futhark_panic(1, "Invalid argument for size option: %s\n",
                              optarg);
        }
        if (ch == 15) {
            char *ret = load_tuning_file(optarg, cfg, (int (*)(void *, const
                                                               char *,
                                                               size_t)) futhark_context_config_set_size);
            
            if (ret != NULL)
                futhark_panic(1, "When loading tuning from '%s': %s\n", optarg,
                              ret);
        }
        if (ch == 16 || ch == 'p')
            futhark_context_config_set_platform(cfg, optarg);
        if (ch == 17) {
            futhark_context_config_dump_program_to(cfg, optarg);
            entry_point = NULL;
        }
        if (ch == 18)
            futhark_context_config_load_program_from(cfg, optarg);
        if (ch == 19) {
            futhark_context_config_dump_binary_to(cfg, optarg);
            entry_point = NULL;
        }
        if (ch == 20)
            futhark_context_config_load_binary_from(cfg, optarg);
        if (ch == 21)
            futhark_context_config_add_build_option(cfg, optarg);
        if (ch == 22 || ch == 'P')
            futhark_context_config_set_profiling(cfg, 1);
        if (ch == 23) {
            futhark_context_config_list_devices(cfg);
            entry_point = NULL;
        }
        if (ch == ':')
            futhark_panic(-1, "Missing argument for option %s\n", argv[optind -
                                                                       1]);
        if (ch == '?') {
            fprintf(stderr, "Usage: %s: %s\n", fut_progname,
                    "  -t/--write-runtime-to FILE Print the time taken to execute the program to the indicated file, an integral number of microseconds.\n  -r/--runs INT              Perform NUM runs of the program.\n  -D/--debugging             Perform possibly expensive internal correctness checks and verbose logging.\n  -L/--log                   Print various low-overhead logging information to stderr while running.\n  -e/--entry-point NAME      The entry point to run. Defaults to main.\n  -b/--binary-output         Print the program result in the binary output format.\n  -h/--help                  Print help information and exit.\n  -d/--device NAME           Use the first OpenCL device whose name contains the given string.\n  --default-group-size INT   The default size of OpenCL workgroups that are launched.\n  --default-num-groups INT   The default number of OpenCL workgroups that are launched.\n  --default-tile-size INT    The default tile size used when performing two-dimensional tiling.\n  --default-threshold INT    The default parallelism threshold.\n  --print-sizes              Print all sizes that can be set with -size or --tuning.\n  --size ASSIGNMENT          Set a configurable run-time parameter to the given value.\n  --tuning FILE              Read size=value assignments from the given file.\n  -p/--platform NAME         Use the first OpenCL platform whose name contains the given string.\n  --dump-opencl FILE         Dump the embedded OpenCL program to the indicated file.\n  --load-opencl FILE         Instead of using the embedded OpenCL program, load it from the indicated file.\n  --dump-opencl-binary FILE  Dump the compiled version of the embedded OpenCL program to the indicated file.\n  --load-opencl-binary FILE  Load an OpenCL binary from the indicated file.\n  --build-option OPT         Add an additional build option to the string passed to clBuildProgram().\n  -P/--profile               Gather profiling data while executing and print out a summary at the end.\n  --list-devices             List all OpenCL devices and platforms available on the system.\n");
            futhark_panic(1, "Unknown option: %s\n", argv[optind - 1]);
        }
    }
    return optind;
}
static void futrts_cli_entry_main(struct futhark_context *ctx)
{
    int64_t t_start, t_end;
    int time_runs = 0, profile_run = 0;
    
    // We do not want to profile all the initialisation.
    futhark_context_pause_profiling(ctx);
    // Declare and read input.
    set_binary_mode(stdin);
    
    int64_t read_value_21605;
    
    if (read_scalar(&i64_info, &read_value_21605) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      0, i64_info.type_name, strerror(errno));
    
    int64_t read_value_21606;
    
    if (read_scalar(&i64_info, &read_value_21606) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      1, i64_info.type_name, strerror(errno));
    
    struct futhark_f32_1d *read_value_21607;
    int64_t read_shape_21608[1];
    float *read_arr_21609 = NULL;
    
    errno = 0;
    if (read_array(&f32_info, (void **) &read_arr_21609, read_shape_21608, 1) !=
        0)
        futhark_panic(1, "Cannot read input #%d of type %s%s (errno: %s).\n", 2,
                      "[]", f32_info.type_name, strerror(errno));
    
    struct futhark_i64_1d *read_value_21610;
    int64_t read_shape_21611[1];
    int64_t *read_arr_21612 = NULL;
    
    errno = 0;
    if (read_array(&i64_info, (void **) &read_arr_21612, read_shape_21611, 1) !=
        0)
        futhark_panic(1, "Cannot read input #%d of type %s%s (errno: %s).\n", 3,
                      "[]", i64_info.type_name, strerror(errno));
    
    struct futhark_f32_1d *read_value_21613;
    int64_t read_shape_21614[1];
    float *read_arr_21615 = NULL;
    
    errno = 0;
    if (read_array(&f32_info, (void **) &read_arr_21615, read_shape_21614, 1) !=
        0)
        futhark_panic(1, "Cannot read input #%d of type %s%s (errno: %s).\n", 4,
                      "[]", f32_info.type_name, strerror(errno));
    
    float read_value_21616;
    
    if (read_scalar(&f32_info, &read_value_21616) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      5, f32_info.type_name, strerror(errno));
    
    float read_value_21617;
    
    if (read_scalar(&f32_info, &read_value_21617) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      6, f32_info.type_name, strerror(errno));
    
    float read_value_21618;
    
    if (read_scalar(&f32_info, &read_value_21618) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      7, f32_info.type_name, strerror(errno));
    
    float read_value_21619;
    
    if (read_scalar(&f32_info, &read_value_21619) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      8, f32_info.type_name, strerror(errno));
    if (end_of_input() != 0)
        futhark_panic(1, "Expected EOF on stdin after reading input for %s.\n",
                      "\"main\"");
    
    float result_21620;
    struct futhark_f32_1d *result_21621;
    
    if (perform_warmup) {
        int r;
        
        ;
        ;
        assert((read_value_21607 = futhark_new_f32_1d(ctx, read_arr_21609,
                                                      read_shape_21608[0])) !=
            0);
        assert((read_value_21610 = futhark_new_i64_1d(ctx, read_arr_21612,
                                                      read_shape_21611[0])) !=
            0);
        assert((read_value_21613 = futhark_new_f32_1d(ctx, read_arr_21615,
                                                      read_shape_21614[0])) !=
            0);
        ;
        ;
        ;
        ;
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        // Only profile last run.
        if (profile_run)
            futhark_context_unpause_profiling(ctx);
        t_start = get_wall_time();
        r = futhark_entry_main(ctx, &result_21620, &result_21621,
                               read_value_21605, read_value_21606,
                               read_value_21607, read_value_21610,
                               read_value_21613, read_value_21616,
                               read_value_21617, read_value_21618,
                               read_value_21619);
        if (r != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        if (profile_run)
            futhark_context_pause_profiling(ctx);
        t_end = get_wall_time();
        
        long elapsed_usec = t_end - t_start;
        
        if (time_runs && runtime_file != NULL) {
            fprintf(runtime_file, "%lld\n", (long long) elapsed_usec);
            fflush(runtime_file);
        }
        ;
        ;
        assert(futhark_free_f32_1d(ctx, read_value_21607) == 0);
        assert(futhark_free_i64_1d(ctx, read_value_21610) == 0);
        assert(futhark_free_f32_1d(ctx, read_value_21613) == 0);
        ;
        ;
        ;
        ;
        ;
        assert(futhark_free_f32_1d(ctx, result_21621) == 0);
    }
    time_runs = 1;
    // Proper run.
    for (int run = 0; run < num_runs; run++) {
        // Only profile last run.
        profile_run = run == num_runs - 1;
        
        int r;
        
        ;
        ;
        assert((read_value_21607 = futhark_new_f32_1d(ctx, read_arr_21609,
                                                      read_shape_21608[0])) !=
            0);
        assert((read_value_21610 = futhark_new_i64_1d(ctx, read_arr_21612,
                                                      read_shape_21611[0])) !=
            0);
        assert((read_value_21613 = futhark_new_f32_1d(ctx, read_arr_21615,
                                                      read_shape_21614[0])) !=
            0);
        ;
        ;
        ;
        ;
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        // Only profile last run.
        if (profile_run)
            futhark_context_unpause_profiling(ctx);
        t_start = get_wall_time();
        r = futhark_entry_main(ctx, &result_21620, &result_21621,
                               read_value_21605, read_value_21606,
                               read_value_21607, read_value_21610,
                               read_value_21613, read_value_21616,
                               read_value_21617, read_value_21618,
                               read_value_21619);
        if (r != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        if (profile_run)
            futhark_context_pause_profiling(ctx);
        t_end = get_wall_time();
        
        long elapsed_usec = t_end - t_start;
        
        if (time_runs && runtime_file != NULL) {
            fprintf(runtime_file, "%lld\n", (long long) elapsed_usec);
            fflush(runtime_file);
        }
        ;
        ;
        assert(futhark_free_f32_1d(ctx, read_value_21607) == 0);
        assert(futhark_free_i64_1d(ctx, read_value_21610) == 0);
        assert(futhark_free_f32_1d(ctx, read_value_21613) == 0);
        ;
        ;
        ;
        ;
        if (run < num_runs - 1) {
            ;
            assert(futhark_free_f32_1d(ctx, result_21621) == 0);
        }
    }
    ;
    ;
    free(read_arr_21609);
    free(read_arr_21612);
    free(read_arr_21615);
    ;
    ;
    ;
    ;
    if (binary_output)
        set_binary_mode(stdout);
    write_scalar(stdout, binary_output, &f32_info, &result_21620);
    printf("\n");
    {
        float *arr = calloc(sizeof(float), futhark_shape_f32_1d(ctx,
                                                                result_21621)[0]);
        
        assert(arr != NULL);
        assert(futhark_values_f32_1d(ctx, result_21621, arr) == 0);
        write_array(stdout, binary_output, &f32_info, arr,
                    futhark_shape_f32_1d(ctx, result_21621), 1);
        free(arr);
    }
    printf("\n");
    ;
    assert(futhark_free_f32_1d(ctx, result_21621) == 0);
}
typedef void entry_point_fun(struct futhark_context *);
struct entry_point_entry {
    const char *name;
    entry_point_fun *fun;
} ;
int main(int argc, char **argv)
{
    fut_progname = argv[0];
    
    struct entry_point_entry entry_points[] = {{.name ="main", .fun =
                                                futrts_cli_entry_main}};
    struct futhark_context_config *cfg = futhark_context_config_new();
    
    assert(cfg != NULL);
    
    int parsed_options = parse_options(cfg, argc, argv);
    
    argc -= parsed_options;
    argv += parsed_options;
    if (argc != 0)
        futhark_panic(1, "Excess non-option: %s\n", argv[0]);
    
    struct futhark_context *ctx = futhark_context_new(cfg);
    
    assert(ctx != NULL);
    
    char *error = futhark_context_get_error(ctx);
    
    if (error != NULL)
        futhark_panic(1, "%s", error);
    if (entry_point != NULL) {
        int num_entry_points = sizeof(entry_points) / sizeof(entry_points[0]);
        entry_point_fun *entry_point_fun = NULL;
        
        for (int i = 0; i < num_entry_points; i++) {
            if (strcmp(entry_points[i].name, entry_point) == 0) {
                entry_point_fun = entry_points[i].fun;
                break;
            }
        }
        if (entry_point_fun == NULL) {
            fprintf(stderr,
                    "No entry point '%s'.  Select another with --entry-point.  Options are:\n",
                    entry_point);
            for (int i = 0; i < num_entry_points; i++)
                fprintf(stderr, "%s\n", entry_points[i].name);
            return 1;
        }
        entry_point_fun(ctx);
        if (runtime_file != NULL)
            fclose(runtime_file);
        
        char *report = futhark_context_report(ctx);
        
        fputs(report, stderr);
        free(report);
    }
    futhark_context_free(ctx);
    futhark_context_config_free(cfg);
    return 0;
}
#ifdef _MSC_VER
#define inline __inline
#endif
#include <string.h>
#include <inttypes.h>
#include <ctype.h>
#include <errno.h>
#include <assert.h>
#define CL_TARGET_OPENCL_VERSION 120
#define CL_USE_DEPRECATED_OPENCL_1_2_APIS
#ifdef __APPLE__
#define CL_SILENCE_DEPRECATION
#include <OpenCL/cl.h>
#else
#include <CL/cl.h>
#endif

// Start of lock.h.

// A very simple cross-platform implementation of locks.  Uses
// pthreads on Unix and some Windows thing there.  Futhark's
// host-level code is not multithreaded, but user code may be, so we
// need some mechanism for ensuring atomic access to API functions.
// This is that mechanism.  It is not exposed to user code at all, so
// we do not have to worry about name collisions.

#ifdef _WIN32

typedef HANDLE lock_t;

static void create_lock(lock_t *lock) {
  *lock = CreateMutex(NULL,  // Default security attributes.
                      FALSE, // Initially unlocked.
                      NULL); // Unnamed.
}

static void lock_lock(lock_t *lock) {
  assert(WaitForSingleObject(*lock, INFINITE) == WAIT_OBJECT_0);
}

static void lock_unlock(lock_t *lock) {
  assert(ReleaseMutex(*lock));
}

static void free_lock(lock_t *lock) {
  CloseHandle(*lock);
}

#else
// Assuming POSIX

#include <pthread.h>

typedef pthread_mutex_t lock_t;

static void create_lock(lock_t *lock) {
  int r = pthread_mutex_init(lock, NULL);
  assert(r == 0);
}

static void lock_lock(lock_t *lock) {
  int r = pthread_mutex_lock(lock);
  assert(r == 0);
}

static void lock_unlock(lock_t *lock) {
  int r = pthread_mutex_unlock(lock);
  assert(r == 0);
}

static void free_lock(lock_t *lock) {
  // Nothing to do for pthreads.
  (void)lock;
}

#endif

// End of lock.h.

static inline uint8_t add8(uint8_t x, uint8_t y)
{
    return x + y;
}
static inline uint16_t add16(uint16_t x, uint16_t y)
{
    return x + y;
}
static inline uint32_t add32(uint32_t x, uint32_t y)
{
    return x + y;
}
static inline uint64_t add64(uint64_t x, uint64_t y)
{
    return x + y;
}
static inline uint8_t sub8(uint8_t x, uint8_t y)
{
    return x - y;
}
static inline uint16_t sub16(uint16_t x, uint16_t y)
{
    return x - y;
}
static inline uint32_t sub32(uint32_t x, uint32_t y)
{
    return x - y;
}
static inline uint64_t sub64(uint64_t x, uint64_t y)
{
    return x - y;
}
static inline uint8_t mul8(uint8_t x, uint8_t y)
{
    return x * y;
}
static inline uint16_t mul16(uint16_t x, uint16_t y)
{
    return x * y;
}
static inline uint32_t mul32(uint32_t x, uint32_t y)
{
    return x * y;
}
static inline uint64_t mul64(uint64_t x, uint64_t y)
{
    return x * y;
}
static inline uint8_t udiv8(uint8_t x, uint8_t y)
{
    return x / y;
}
static inline uint16_t udiv16(uint16_t x, uint16_t y)
{
    return x / y;
}
static inline uint32_t udiv32(uint32_t x, uint32_t y)
{
    return x / y;
}
static inline uint64_t udiv64(uint64_t x, uint64_t y)
{
    return x / y;
}
static inline uint8_t udiv_up8(uint8_t x, uint8_t y)
{
    return (x + y - 1) / y;
}
static inline uint16_t udiv_up16(uint16_t x, uint16_t y)
{
    return (x + y - 1) / y;
}
static inline uint32_t udiv_up32(uint32_t x, uint32_t y)
{
    return (x + y - 1) / y;
}
static inline uint64_t udiv_up64(uint64_t x, uint64_t y)
{
    return (x + y - 1) / y;
}
static inline uint8_t umod8(uint8_t x, uint8_t y)
{
    return x % y;
}
static inline uint16_t umod16(uint16_t x, uint16_t y)
{
    return x % y;
}
static inline uint32_t umod32(uint32_t x, uint32_t y)
{
    return x % y;
}
static inline uint64_t umod64(uint64_t x, uint64_t y)
{
    return x % y;
}
static inline uint8_t udiv_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint16_t udiv_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint32_t udiv_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint64_t udiv_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint8_t udiv_up_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint16_t udiv_up_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint32_t udiv_up_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint64_t udiv_up_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint8_t umod_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint16_t umod_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint32_t umod_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint64_t umod_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int8_t sdiv8(int8_t x, int8_t y)
{
    int8_t q = x / y;
    int8_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int16_t sdiv16(int16_t x, int16_t y)
{
    int16_t q = x / y;
    int16_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int32_t sdiv32(int32_t x, int32_t y)
{
    int32_t q = x / y;
    int32_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int64_t sdiv64(int64_t x, int64_t y)
{
    int64_t q = x / y;
    int64_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int8_t sdiv_up8(int8_t x, int8_t y)
{
    return sdiv8(x + y - 1, y);
}
static inline int16_t sdiv_up16(int16_t x, int16_t y)
{
    return sdiv16(x + y - 1, y);
}
static inline int32_t sdiv_up32(int32_t x, int32_t y)
{
    return sdiv32(x + y - 1, y);
}
static inline int64_t sdiv_up64(int64_t x, int64_t y)
{
    return sdiv64(x + y - 1, y);
}
static inline int8_t smod8(int8_t x, int8_t y)
{
    int8_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int16_t smod16(int16_t x, int16_t y)
{
    int16_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int32_t smod32(int32_t x, int32_t y)
{
    int32_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int64_t smod64(int64_t x, int64_t y)
{
    int64_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int8_t sdiv_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : sdiv8(x, y);
}
static inline int16_t sdiv_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : sdiv16(x, y);
}
static inline int32_t sdiv_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : sdiv32(x, y);
}
static inline int64_t sdiv_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : sdiv64(x, y);
}
static inline int8_t sdiv_up_safe8(int8_t x, int8_t y)
{
    return sdiv_safe8(x + y - 1, y);
}
static inline int16_t sdiv_up_safe16(int16_t x, int16_t y)
{
    return sdiv_safe16(x + y - 1, y);
}
static inline int32_t sdiv_up_safe32(int32_t x, int32_t y)
{
    return sdiv_safe32(x + y - 1, y);
}
static inline int64_t sdiv_up_safe64(int64_t x, int64_t y)
{
    return sdiv_safe64(x + y - 1, y);
}
static inline int8_t smod_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : smod8(x, y);
}
static inline int16_t smod_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : smod16(x, y);
}
static inline int32_t smod_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : smod32(x, y);
}
static inline int64_t smod_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : smod64(x, y);
}
static inline int8_t squot8(int8_t x, int8_t y)
{
    return x / y;
}
static inline int16_t squot16(int16_t x, int16_t y)
{
    return x / y;
}
static inline int32_t squot32(int32_t x, int32_t y)
{
    return x / y;
}
static inline int64_t squot64(int64_t x, int64_t y)
{
    return x / y;
}
static inline int8_t srem8(int8_t x, int8_t y)
{
    return x % y;
}
static inline int16_t srem16(int16_t x, int16_t y)
{
    return x % y;
}
static inline int32_t srem32(int32_t x, int32_t y)
{
    return x % y;
}
static inline int64_t srem64(int64_t x, int64_t y)
{
    return x % y;
}
static inline int8_t squot_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int16_t squot_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int32_t squot_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int64_t squot_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int8_t srem_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int16_t srem_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int32_t srem_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int64_t srem_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int8_t smin8(int8_t x, int8_t y)
{
    return x < y ? x : y;
}
static inline int16_t smin16(int16_t x, int16_t y)
{
    return x < y ? x : y;
}
static inline int32_t smin32(int32_t x, int32_t y)
{
    return x < y ? x : y;
}
static inline int64_t smin64(int64_t x, int64_t y)
{
    return x < y ? x : y;
}
static inline uint8_t umin8(uint8_t x, uint8_t y)
{
    return x < y ? x : y;
}
static inline uint16_t umin16(uint16_t x, uint16_t y)
{
    return x < y ? x : y;
}
static inline uint32_t umin32(uint32_t x, uint32_t y)
{
    return x < y ? x : y;
}
static inline uint64_t umin64(uint64_t x, uint64_t y)
{
    return x < y ? x : y;
}
static inline int8_t smax8(int8_t x, int8_t y)
{
    return x < y ? y : x;
}
static inline int16_t smax16(int16_t x, int16_t y)
{
    return x < y ? y : x;
}
static inline int32_t smax32(int32_t x, int32_t y)
{
    return x < y ? y : x;
}
static inline int64_t smax64(int64_t x, int64_t y)
{
    return x < y ? y : x;
}
static inline uint8_t umax8(uint8_t x, uint8_t y)
{
    return x < y ? y : x;
}
static inline uint16_t umax16(uint16_t x, uint16_t y)
{
    return x < y ? y : x;
}
static inline uint32_t umax32(uint32_t x, uint32_t y)
{
    return x < y ? y : x;
}
static inline uint64_t umax64(uint64_t x, uint64_t y)
{
    return x < y ? y : x;
}
static inline uint8_t shl8(uint8_t x, uint8_t y)
{
    return x << y;
}
static inline uint16_t shl16(uint16_t x, uint16_t y)
{
    return x << y;
}
static inline uint32_t shl32(uint32_t x, uint32_t y)
{
    return x << y;
}
static inline uint64_t shl64(uint64_t x, uint64_t y)
{
    return x << y;
}
static inline uint8_t lshr8(uint8_t x, uint8_t y)
{
    return x >> y;
}
static inline uint16_t lshr16(uint16_t x, uint16_t y)
{
    return x >> y;
}
static inline uint32_t lshr32(uint32_t x, uint32_t y)
{
    return x >> y;
}
static inline uint64_t lshr64(uint64_t x, uint64_t y)
{
    return x >> y;
}
static inline int8_t ashr8(int8_t x, int8_t y)
{
    return x >> y;
}
static inline int16_t ashr16(int16_t x, int16_t y)
{
    return x >> y;
}
static inline int32_t ashr32(int32_t x, int32_t y)
{
    return x >> y;
}
static inline int64_t ashr64(int64_t x, int64_t y)
{
    return x >> y;
}
static inline uint8_t and8(uint8_t x, uint8_t y)
{
    return x & y;
}
static inline uint16_t and16(uint16_t x, uint16_t y)
{
    return x & y;
}
static inline uint32_t and32(uint32_t x, uint32_t y)
{
    return x & y;
}
static inline uint64_t and64(uint64_t x, uint64_t y)
{
    return x & y;
}
static inline uint8_t or8(uint8_t x, uint8_t y)
{
    return x | y;
}
static inline uint16_t or16(uint16_t x, uint16_t y)
{
    return x | y;
}
static inline uint32_t or32(uint32_t x, uint32_t y)
{
    return x | y;
}
static inline uint64_t or64(uint64_t x, uint64_t y)
{
    return x | y;
}
static inline uint8_t xor8(uint8_t x, uint8_t y)
{
    return x ^ y;
}
static inline uint16_t xor16(uint16_t x, uint16_t y)
{
    return x ^ y;
}
static inline uint32_t xor32(uint32_t x, uint32_t y)
{
    return x ^ y;
}
static inline uint64_t xor64(uint64_t x, uint64_t y)
{
    return x ^ y;
}
static inline bool ult8(uint8_t x, uint8_t y)
{
    return x < y;
}
static inline bool ult16(uint16_t x, uint16_t y)
{
    return x < y;
}
static inline bool ult32(uint32_t x, uint32_t y)
{
    return x < y;
}
static inline bool ult64(uint64_t x, uint64_t y)
{
    return x < y;
}
static inline bool ule8(uint8_t x, uint8_t y)
{
    return x <= y;
}
static inline bool ule16(uint16_t x, uint16_t y)
{
    return x <= y;
}
static inline bool ule32(uint32_t x, uint32_t y)
{
    return x <= y;
}
static inline bool ule64(uint64_t x, uint64_t y)
{
    return x <= y;
}
static inline bool slt8(int8_t x, int8_t y)
{
    return x < y;
}
static inline bool slt16(int16_t x, int16_t y)
{
    return x < y;
}
static inline bool slt32(int32_t x, int32_t y)
{
    return x < y;
}
static inline bool slt64(int64_t x, int64_t y)
{
    return x < y;
}
static inline bool sle8(int8_t x, int8_t y)
{
    return x <= y;
}
static inline bool sle16(int16_t x, int16_t y)
{
    return x <= y;
}
static inline bool sle32(int32_t x, int32_t y)
{
    return x <= y;
}
static inline bool sle64(int64_t x, int64_t y)
{
    return x <= y;
}
static inline int8_t pow8(int8_t x, int8_t y)
{
    int8_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int16_t pow16(int16_t x, int16_t y)
{
    int16_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int32_t pow32(int32_t x, int32_t y)
{
    int32_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int64_t pow64(int64_t x, int64_t y)
{
    int64_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline bool itob_i8_bool(int8_t x)
{
    return x;
}
static inline bool itob_i16_bool(int16_t x)
{
    return x;
}
static inline bool itob_i32_bool(int32_t x)
{
    return x;
}
static inline bool itob_i64_bool(int64_t x)
{
    return x;
}
static inline int8_t btoi_bool_i8(bool x)
{
    return x;
}
static inline int16_t btoi_bool_i16(bool x)
{
    return x;
}
static inline int32_t btoi_bool_i32(bool x)
{
    return x;
}
static inline int64_t btoi_bool_i64(bool x)
{
    return x;
}
#define sext_i8_i8(x) ((int8_t) (int8_t) x)
#define sext_i8_i16(x) ((int16_t) (int8_t) x)
#define sext_i8_i32(x) ((int32_t) (int8_t) x)
#define sext_i8_i64(x) ((int64_t) (int8_t) x)
#define sext_i16_i8(x) ((int8_t) (int16_t) x)
#define sext_i16_i16(x) ((int16_t) (int16_t) x)
#define sext_i16_i32(x) ((int32_t) (int16_t) x)
#define sext_i16_i64(x) ((int64_t) (int16_t) x)
#define sext_i32_i8(x) ((int8_t) (int32_t) x)
#define sext_i32_i16(x) ((int16_t) (int32_t) x)
#define sext_i32_i32(x) ((int32_t) (int32_t) x)
#define sext_i32_i64(x) ((int64_t) (int32_t) x)
#define sext_i64_i8(x) ((int8_t) (int64_t) x)
#define sext_i64_i16(x) ((int16_t) (int64_t) x)
#define sext_i64_i32(x) ((int32_t) (int64_t) x)
#define sext_i64_i64(x) ((int64_t) (int64_t) x)
#define zext_i8_i8(x) ((int8_t) (uint8_t) x)
#define zext_i8_i16(x) ((int16_t) (uint8_t) x)
#define zext_i8_i32(x) ((int32_t) (uint8_t) x)
#define zext_i8_i64(x) ((int64_t) (uint8_t) x)
#define zext_i16_i8(x) ((int8_t) (uint16_t) x)
#define zext_i16_i16(x) ((int16_t) (uint16_t) x)
#define zext_i16_i32(x) ((int32_t) (uint16_t) x)
#define zext_i16_i64(x) ((int64_t) (uint16_t) x)
#define zext_i32_i8(x) ((int8_t) (uint32_t) x)
#define zext_i32_i16(x) ((int16_t) (uint32_t) x)
#define zext_i32_i32(x) ((int32_t) (uint32_t) x)
#define zext_i32_i64(x) ((int64_t) (uint32_t) x)
#define zext_i64_i8(x) ((int8_t) (uint64_t) x)
#define zext_i64_i16(x) ((int16_t) (uint64_t) x)
#define zext_i64_i32(x) ((int32_t) (uint64_t) x)
#define zext_i64_i64(x) ((int64_t) (uint64_t) x)
#if defined(__OPENCL_VERSION__)
static int32_t futrts_popc8(int8_t x)
{
    return popcount(x);
}
static int32_t futrts_popc16(int16_t x)
{
    return popcount(x);
}
static int32_t futrts_popc32(int32_t x)
{
    return popcount(x);
}
static int32_t futrts_popc64(int64_t x)
{
    return popcount(x);
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_popc8(int8_t x)
{
    return __popc(zext_i8_i32(x));
}
static int32_t futrts_popc16(int16_t x)
{
    return __popc(zext_i16_i32(x));
}
static int32_t futrts_popc32(int32_t x)
{
    return __popc(x);
}
static int32_t futrts_popc64(int64_t x)
{
    return __popcll(x);
}
#else
static int32_t futrts_popc8(int8_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc16(int16_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc32(int32_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc64(int64_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
#endif
#if defined(__OPENCL_VERSION__)
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    return mul_hi(a, b);
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    return mul_hi(a, b);
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    return mul_hi(a, b);
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    return mul_hi(a, b);
}
#elif defined(__CUDA_ARCH__)
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    uint16_t aa = a;
    uint16_t bb = b;
    
    return aa * bb >> 8;
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    uint32_t aa = a;
    uint32_t bb = b;
    
    return aa * bb >> 16;
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    return mulhi(a, b);
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    return mul64hi(a, b);
}
#else
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    uint16_t aa = a;
    uint16_t bb = b;
    
    return aa * bb >> 8;
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    uint32_t aa = a;
    uint32_t bb = b;
    
    return aa * bb >> 16;
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    uint64_t aa = a;
    uint64_t bb = b;
    
    return aa * bb >> 32;
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    __uint128_t aa = a;
    __uint128_t bb = b;
    
    return aa * bb >> 64;
}
#endif
#if defined(__OPENCL_VERSION__)
static uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)
{
    return mad_hi(a, b, c);
}
static uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)
{
    return mad_hi(a, b, c);
}
static uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)
{
    return mad_hi(a, b, c);
}
static uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)
{
    return mad_hi(a, b, c);
}
#else
static uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)
{
    return futrts_mul_hi8(a, b) + c;
}
static uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)
{
    return futrts_mul_hi16(a, b) + c;
}
static uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)
{
    return futrts_mul_hi32(a, b) + c;
}
static uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)
{
    return futrts_mul_hi64(a, b) + c;
}
#endif
#if defined(__OPENCL_VERSION__)
static int32_t futrts_clzz8(int8_t x)
{
    return clz(x);
}
static int32_t futrts_clzz16(int16_t x)
{
    return clz(x);
}
static int32_t futrts_clzz32(int32_t x)
{
    return clz(x);
}
static int32_t futrts_clzz64(int64_t x)
{
    return clz(x);
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_clzz8(int8_t x)
{
    return __clz(zext_i8_i32(x)) - 24;
}
static int32_t futrts_clzz16(int16_t x)
{
    return __clz(zext_i16_i32(x)) - 16;
}
static int32_t futrts_clzz32(int32_t x)
{
    return __clz(x);
}
static int32_t futrts_clzz64(int64_t x)
{
    return __clzll(x);
}
#else
static int32_t futrts_clzz8(int8_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz16(int16_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz32(int32_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz64(int64_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
#endif
#if defined(__OPENCL_VERSION__)
static int32_t futrts_ctzz8(int8_t x)
{
    int i = 0;
    
    for (; i < 8 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz16(int16_t x)
{
    int i = 0;
    
    for (; i < 16 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz32(int32_t x)
{
    int i = 0;
    
    for (; i < 32 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz64(int64_t x)
{
    int i = 0;
    
    for (; i < 64 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_ctzz8(int8_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 8 : y - 1;
}
static int32_t futrts_ctzz16(int16_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 16 : y - 1;
}
static int32_t futrts_ctzz32(int32_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 32 : y - 1;
}
static int32_t futrts_ctzz64(int64_t x)
{
    int y = __ffsll(x);
    
    return y == 0 ? 64 : y - 1;
}
#else
static int32_t futrts_ctzz8(int8_t x)
{
    return x == 0 ? 8 : __builtin_ctz((uint32_t) x);
}
static int32_t futrts_ctzz16(int16_t x)
{
    return x == 0 ? 16 : __builtin_ctz((uint32_t) x);
}
static int32_t futrts_ctzz32(int32_t x)
{
    return x == 0 ? 32 : __builtin_ctz(x);
}
static int32_t futrts_ctzz64(int64_t x)
{
    return x == 0 ? 64 : __builtin_ctzl(x);
}
#endif
static inline float fdiv32(float x, float y)
{
    return x / y;
}
static inline float fadd32(float x, float y)
{
    return x + y;
}
static inline float fsub32(float x, float y)
{
    return x - y;
}
static inline float fmul32(float x, float y)
{
    return x * y;
}
static inline float fmin32(float x, float y)
{
    return fmin(x, y);
}
static inline float fmax32(float x, float y)
{
    return fmax(x, y);
}
static inline float fpow32(float x, float y)
{
    return pow(x, y);
}
static inline bool cmplt32(float x, float y)
{
    return x < y;
}
static inline bool cmple32(float x, float y)
{
    return x <= y;
}
static inline float sitofp_i8_f32(int8_t x)
{
    return (float) x;
}
static inline float sitofp_i16_f32(int16_t x)
{
    return (float) x;
}
static inline float sitofp_i32_f32(int32_t x)
{
    return (float) x;
}
static inline float sitofp_i64_f32(int64_t x)
{
    return (float) x;
}
static inline float uitofp_i8_f32(uint8_t x)
{
    return (float) x;
}
static inline float uitofp_i16_f32(uint16_t x)
{
    return (float) x;
}
static inline float uitofp_i32_f32(uint32_t x)
{
    return (float) x;
}
static inline float uitofp_i64_f32(uint64_t x)
{
    return (float) x;
}
static inline int8_t fptosi_f32_i8(float x)
{
    return (int8_t) x;
}
static inline int16_t fptosi_f32_i16(float x)
{
    return (int16_t) x;
}
static inline int32_t fptosi_f32_i32(float x)
{
    return (int32_t) x;
}
static inline int64_t fptosi_f32_i64(float x)
{
    return (int64_t) x;
}
static inline uint8_t fptoui_f32_i8(float x)
{
    return (uint8_t) x;
}
static inline uint16_t fptoui_f32_i16(float x)
{
    return (uint16_t) x;
}
static inline uint32_t fptoui_f32_i32(float x)
{
    return (uint32_t) x;
}
static inline uint64_t fptoui_f32_i64(float x)
{
    return (uint64_t) x;
}
static inline double fdiv64(double x, double y)
{
    return x / y;
}
static inline double fadd64(double x, double y)
{
    return x + y;
}
static inline double fsub64(double x, double y)
{
    return x - y;
}
static inline double fmul64(double x, double y)
{
    return x * y;
}
static inline double fmin64(double x, double y)
{
    return fmin(x, y);
}
static inline double fmax64(double x, double y)
{
    return fmax(x, y);
}
static inline double fpow64(double x, double y)
{
    return pow(x, y);
}
static inline bool cmplt64(double x, double y)
{
    return x < y;
}
static inline bool cmple64(double x, double y)
{
    return x <= y;
}
static inline double sitofp_i8_f64(int8_t x)
{
    return (double) x;
}
static inline double sitofp_i16_f64(int16_t x)
{
    return (double) x;
}
static inline double sitofp_i32_f64(int32_t x)
{
    return (double) x;
}
static inline double sitofp_i64_f64(int64_t x)
{
    return (double) x;
}
static inline double uitofp_i8_f64(uint8_t x)
{
    return (double) x;
}
static inline double uitofp_i16_f64(uint16_t x)
{
    return (double) x;
}
static inline double uitofp_i32_f64(uint32_t x)
{
    return (double) x;
}
static inline double uitofp_i64_f64(uint64_t x)
{
    return (double) x;
}
static inline int8_t fptosi_f64_i8(double x)
{
    return (int8_t) x;
}
static inline int16_t fptosi_f64_i16(double x)
{
    return (int16_t) x;
}
static inline int32_t fptosi_f64_i32(double x)
{
    return (int32_t) x;
}
static inline int64_t fptosi_f64_i64(double x)
{
    return (int64_t) x;
}
static inline uint8_t fptoui_f64_i8(double x)
{
    return (uint8_t) x;
}
static inline uint16_t fptoui_f64_i16(double x)
{
    return (uint16_t) x;
}
static inline uint32_t fptoui_f64_i32(double x)
{
    return (uint32_t) x;
}
static inline uint64_t fptoui_f64_i64(double x)
{
    return (uint64_t) x;
}
static inline float fpconv_f32_f32(float x)
{
    return (float) x;
}
static inline double fpconv_f32_f64(float x)
{
    return (double) x;
}
static inline float fpconv_f64_f32(double x)
{
    return (float) x;
}
static inline double fpconv_f64_f64(double x)
{
    return (double) x;
}
static inline float futrts_log32(float x)
{
    return log(x);
}
static inline float futrts_log2_32(float x)
{
    return log2(x);
}
static inline float futrts_log10_32(float x)
{
    return log10(x);
}
static inline float futrts_sqrt32(float x)
{
    return sqrt(x);
}
static inline float futrts_exp32(float x)
{
    return exp(x);
}
static inline float futrts_cos32(float x)
{
    return cos(x);
}
static inline float futrts_sin32(float x)
{
    return sin(x);
}
static inline float futrts_tan32(float x)
{
    return tan(x);
}
static inline float futrts_acos32(float x)
{
    return acos(x);
}
static inline float futrts_asin32(float x)
{
    return asin(x);
}
static inline float futrts_atan32(float x)
{
    return atan(x);
}
static inline float futrts_cosh32(float x)
{
    return cosh(x);
}
static inline float futrts_sinh32(float x)
{
    return sinh(x);
}
static inline float futrts_tanh32(float x)
{
    return tanh(x);
}
static inline float futrts_acosh32(float x)
{
    return acosh(x);
}
static inline float futrts_asinh32(float x)
{
    return asinh(x);
}
static inline float futrts_atanh32(float x)
{
    return atanh(x);
}
static inline float futrts_atan2_32(float x, float y)
{
    return atan2(x, y);
}
static inline float futrts_gamma32(float x)
{
    return tgamma(x);
}
static inline float futrts_lgamma32(float x)
{
    return lgamma(x);
}
static inline bool futrts_isnan32(float x)
{
    return isnan(x);
}
static inline bool futrts_isinf32(float x)
{
    return isinf(x);
}
static inline int32_t futrts_to_bits32(float x)
{
    union {
        float f;
        int32_t t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline float futrts_from_bits32(int32_t x)
{
    union {
        int32_t f;
        float t;
    } p;
    
    p.f = x;
    return p.t;
}
#ifdef __OPENCL_VERSION__
static inline float fmod32(float x, float y)
{
    return fmod(x, y);
}
static inline float futrts_round32(float x)
{
    return rint(x);
}
static inline float futrts_floor32(float x)
{
    return floor(x);
}
static inline float futrts_ceil32(float x)
{
    return ceil(x);
}
static inline float futrts_lerp32(float v0, float v1, float t)
{
    return mix(v0, v1, t);
}
static inline float futrts_mad32(float a, float b, float c)
{
    return mad(a, b, c);
}
static inline float futrts_fma32(float a, float b, float c)
{
    return fma(a, b, c);
}
#else
static inline float fmod32(float x, float y)
{
    return fmodf(x, y);
}
static inline float futrts_round32(float x)
{
    return rintf(x);
}
static inline float futrts_floor32(float x)
{
    return floorf(x);
}
static inline float futrts_ceil32(float x)
{
    return ceilf(x);
}
static inline float futrts_lerp32(float v0, float v1, float t)
{
    return v0 + (v1 - v0) * t;
}
static inline float futrts_mad32(float a, float b, float c)
{
    return a * b + c;
}
static inline float futrts_fma32(float a, float b, float c)
{
    return fmaf(a, b, c);
}
#endif
static inline double futrts_log64(double x)
{
    return log(x);
}
static inline double futrts_log2_64(double x)
{
    return log2(x);
}
static inline double futrts_log10_64(double x)
{
    return log10(x);
}
static inline double futrts_sqrt64(double x)
{
    return sqrt(x);
}
static inline double futrts_exp64(double x)
{
    return exp(x);
}
static inline double futrts_cos64(double x)
{
    return cos(x);
}
static inline double futrts_sin64(double x)
{
    return sin(x);
}
static inline double futrts_tan64(double x)
{
    return tan(x);
}
static inline double futrts_acos64(double x)
{
    return acos(x);
}
static inline double futrts_asin64(double x)
{
    return asin(x);
}
static inline double futrts_atan64(double x)
{
    return atan(x);
}
static inline double futrts_cosh64(double x)
{
    return cosh(x);
}
static inline double futrts_sinh64(double x)
{
    return sinh(x);
}
static inline double futrts_tanh64(double x)
{
    return tanh(x);
}
static inline double futrts_acosh64(double x)
{
    return acosh(x);
}
static inline double futrts_asinh64(double x)
{
    return asinh(x);
}
static inline double futrts_atanh64(double x)
{
    return atanh(x);
}
static inline double futrts_atan2_64(double x, double y)
{
    return atan2(x, y);
}
static inline double futrts_gamma64(double x)
{
    return tgamma(x);
}
static inline double futrts_lgamma64(double x)
{
    return lgamma(x);
}
static inline double futrts_fma64(double a, double b, double c)
{
    return fma(a, b, c);
}
static inline double futrts_round64(double x)
{
    return rint(x);
}
static inline double futrts_ceil64(double x)
{
    return ceil(x);
}
static inline double futrts_floor64(double x)
{
    return floor(x);
}
static inline bool futrts_isnan64(double x)
{
    return isnan(x);
}
static inline bool futrts_isinf64(double x)
{
    return isinf(x);
}
static inline int64_t futrts_to_bits64(double x)
{
    union {
        double f;
        int64_t t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline double futrts_from_bits64(int64_t x)
{
    union {
        int64_t f;
        double t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline double fmod64(double x, double y)
{
    return fmod(x, y);
}
#ifdef __OPENCL_VERSION__
static inline double futrts_lerp64(double v0, double v1, double t)
{
    return mix(v0, v1, t);
}
static inline double futrts_mad64(double a, double b, double c)
{
    return mad(a, b, c);
}
#else
static inline double futrts_lerp64(double v0, double v1, double t)
{
    return v0 + (v1 - v0) * t;
}
static inline double futrts_mad64(double a, double b, double c)
{
    return a * b + c;
}
#endif
int init_constants(struct futhark_context *);
int free_constants(struct futhark_context *);
static int32_t mainzicounter_mem_realtype_21384[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzicounter_mem_realtype_21391[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzicounter_mem_realtype_21403[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzicounter_mem_realtype_21460[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzihist_locks_mem_realtype_21472[100151];
static int32_t mainzicounter_mem_realtype_21483[10240];
static int32_t mainzicounter_mem_realtype_21560[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzicounter_mem_realtype_21587[10240];
static int32_t mainzicounter_mem_realtype_21598[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
struct memblock_device {
    int *references;
    cl_mem mem;
    int64_t size;
    const char *desc;
} ;
struct memblock {
    int *references;
    char *mem;
    int64_t size;
    const char *desc;
} ;
typedef cl_mem fl_mem_t;
// Start of free_list.h.

// An entry in the free list.  May be invalid, to avoid having to
// deallocate entries as soon as they are removed.  There is also a
// tag, to help with memory reuse.
struct free_list_entry {
  size_t size;
  fl_mem_t mem;
  const char *tag;
  unsigned char valid;
};

struct free_list {
  struct free_list_entry *entries;        // Pointer to entries.
  int capacity;                           // Number of entries.
  int used;                               // Number of valid entries.
};

static void free_list_init(struct free_list *l) {
  l->capacity = 30; // Picked arbitrarily.
  l->used = 0;
  l->entries = (struct free_list_entry*) malloc(sizeof(struct free_list_entry) * l->capacity);
  for (int i = 0; i < l->capacity; i++) {
    l->entries[i].valid = 0;
  }
}

// Remove invalid entries from the free list.
static void free_list_pack(struct free_list *l) {
  int p = 0;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[p] = l->entries[i];
      p++;
    }
  }

  // Now p is the number of used elements.  We don't want it to go
  // less than the default capacity (although in practice it's OK as
  // long as it doesn't become 1).
  if (p < 30) {
    p = 30;
  }
  l->entries = realloc(l->entries, p * sizeof(struct free_list_entry));
  l->capacity = p;
}

static void free_list_destroy(struct free_list *l) {
  assert(l->used == 0);
  free(l->entries);
}

static int free_list_find_invalid(struct free_list *l) {
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (!l->entries[i].valid) {
      break;
    }
  }
  return i;
}

static void free_list_insert(struct free_list *l, size_t size, fl_mem_t mem, const char *tag) {
  int i = free_list_find_invalid(l);

  if (i == l->capacity) {
    // List is full; so we have to grow it.
    int new_capacity = l->capacity * 2 * sizeof(struct free_list_entry);
    l->entries = realloc(l->entries, new_capacity);
    for (int j = 0; j < l->capacity; j++) {
      l->entries[j+l->capacity].valid = 0;
    }
    l->capacity *= 2;
  }

  // Now 'i' points to the first invalid entry.
  l->entries[i].valid = 1;
  l->entries[i].size = size;
  l->entries[i].mem = mem;
  l->entries[i].tag = tag;

  l->used++;
}

// Find and remove a memory block of the indicated tag, or if that
// does not exist, another memory block with exactly the desired size.
// Returns 0 on success.
static int free_list_find(struct free_list *l, size_t size,
                          size_t *size_out, fl_mem_t *mem_out) {
  int size_match = -1;
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid &&
        size <= l->entries[i].size &&
        (size_match < 0 || l->entries[i].size < l->entries[size_match].size)) {
      // If this entry is valid, has sufficient size, and is smaller than the
      // best entry found so far, use this entry.
      size_match = i;
    }
  }

  if (size_match >= 0) {
    l->entries[size_match].valid = 0;
    *size_out = l->entries[size_match].size;
    *mem_out = l->entries[size_match].mem;
    l->used--;
    return 0;
  } else {
    return 1;
  }
}

// Remove the first block in the free list.  Returns 0 if a block was
// removed, and nonzero if the free list was already empty.
static int free_list_first(struct free_list *l, fl_mem_t *mem_out) {
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[i].valid = 0;
      *mem_out = l->entries[i].mem;
      l->used--;
      return 0;
    }
  }

  return 1;
}

// End of free_list.h.

// Start of opencl.h.

#define OPENCL_SUCCEED_FATAL(e) opencl_succeed_fatal(e, #e, __FILE__, __LINE__)
#define OPENCL_SUCCEED_NONFATAL(e) opencl_succeed_nonfatal(e, #e, __FILE__, __LINE__)
// Take care not to override an existing error.
#define OPENCL_SUCCEED_OR_RETURN(e) {             \
    char *serror = OPENCL_SUCCEED_NONFATAL(e);    \
    if (serror) {                                 \
      if (!ctx->error) {                          \
        ctx->error = serror;                      \
        return bad;                               \
      } else {                                    \
        free(serror);                             \
      }                                           \
    }                                             \
  }

// OPENCL_SUCCEED_OR_RETURN returns the value of the variable 'bad' in
// scope.  By default, it will be this one.  Create a local variable
// of some other type if needed.  This is a bit of a hack, but it
// saves effort in the code generator.
static const int bad = 1;

struct opencl_config {
  int debugging;
  int profiling;
  int logging;
  int preferred_device_num;
  const char *preferred_platform;
  const char *preferred_device;
  int ignore_blacklist;

  const char* dump_program_to;
  const char* load_program_from;
  const char* dump_binary_to;
  const char* load_binary_from;

  size_t default_group_size;
  size_t default_num_groups;
  size_t default_tile_size;
  size_t default_threshold;

  int default_group_size_changed;
  int default_tile_size_changed;

  int num_sizes;
  const char **size_names;
  const char **size_vars;
  size_t *size_values;
  const char **size_classes;
};

static void opencl_config_init(struct opencl_config *cfg,
                               int num_sizes,
                               const char *size_names[],
                               const char *size_vars[],
                               size_t *size_values,
                               const char *size_classes[]) {
  cfg->debugging = 0;
  cfg->logging = 0;
  cfg->profiling = 0;
  cfg->preferred_device_num = 0;
  cfg->preferred_platform = "";
  cfg->preferred_device = "";
  cfg->ignore_blacklist = 0;
  cfg->dump_program_to = NULL;
  cfg->load_program_from = NULL;
  cfg->dump_binary_to = NULL;
  cfg->load_binary_from = NULL;

  // The following are dummy sizes that mean the concrete defaults
  // will be set during initialisation via hardware-inspection-based
  // heuristics.
  cfg->default_group_size = 0;
  cfg->default_num_groups = 0;
  cfg->default_tile_size = 0;
  cfg->default_threshold = 0;

  cfg->default_group_size_changed = 0;
  cfg->default_tile_size_changed = 0;

  cfg->num_sizes = num_sizes;
  cfg->size_names = size_names;
  cfg->size_vars = size_vars;
  cfg->size_values = size_values;
  cfg->size_classes = size_classes;
}

// A record of something that happened.
struct profiling_record {
  cl_event *event;
  int *runs;
  int64_t *runtime;
};

struct opencl_context {
  cl_device_id device;
  cl_context ctx;
  cl_command_queue queue;

  struct opencl_config cfg;

  struct free_list free_list;

  size_t max_group_size;
  size_t max_num_groups;
  size_t max_tile_size;
  size_t max_threshold;
  size_t max_local_memory;

  size_t lockstep_width;

  struct profiling_record *profiling_records;
  int profiling_records_capacity;
  int profiling_records_used;
};

struct opencl_device_option {
  cl_platform_id platform;
  cl_device_id device;
  cl_device_type device_type;
  char *platform_name;
  char *device_name;
};

// This function must be defined by the user.  It is invoked by
// setup_opencl() after the platform and device has been found, but
// before the program is loaded.  Its intended use is to tune
// constants based on the selected platform and device.
static void post_opencl_setup(struct opencl_context*, struct opencl_device_option*);

static char *strclone(const char *str) {
  size_t size = strlen(str) + 1;
  char *copy = (char*) malloc(size);
  if (copy == NULL) {
    return NULL;
  }

  memcpy(copy, str, size);
  return copy;
}

static const char* opencl_error_string(cl_int err)
{
    switch (err) {
        case CL_SUCCESS:                            return "Success!";
        case CL_DEVICE_NOT_FOUND:                   return "Device not found.";
        case CL_DEVICE_NOT_AVAILABLE:               return "Device not available";
        case CL_COMPILER_NOT_AVAILABLE:             return "Compiler not available";
        case CL_MEM_OBJECT_ALLOCATION_FAILURE:      return "Memory object allocation failure";
        case CL_OUT_OF_RESOURCES:                   return "Out of resources";
        case CL_OUT_OF_HOST_MEMORY:                 return "Out of host memory";
        case CL_PROFILING_INFO_NOT_AVAILABLE:       return "Profiling information not available";
        case CL_MEM_COPY_OVERLAP:                   return "Memory copy overlap";
        case CL_IMAGE_FORMAT_MISMATCH:              return "Image format mismatch";
        case CL_IMAGE_FORMAT_NOT_SUPPORTED:         return "Image format not supported";
        case CL_BUILD_PROGRAM_FAILURE:              return "Program build failure";
        case CL_MAP_FAILURE:                        return "Map failure";
        case CL_INVALID_VALUE:                      return "Invalid value";
        case CL_INVALID_DEVICE_TYPE:                return "Invalid device type";
        case CL_INVALID_PLATFORM:                   return "Invalid platform";
        case CL_INVALID_DEVICE:                     return "Invalid device";
        case CL_INVALID_CONTEXT:                    return "Invalid context";
        case CL_INVALID_QUEUE_PROPERTIES:           return "Invalid queue properties";
        case CL_INVALID_COMMAND_QUEUE:              return "Invalid command queue";
        case CL_INVALID_HOST_PTR:                   return "Invalid host pointer";
        case CL_INVALID_MEM_OBJECT:                 return "Invalid memory object";
        case CL_INVALID_IMAGE_FORMAT_DESCRIPTOR:    return "Invalid image format descriptor";
        case CL_INVALID_IMAGE_SIZE:                 return "Invalid image size";
        case CL_INVALID_SAMPLER:                    return "Invalid sampler";
        case CL_INVALID_BINARY:                     return "Invalid binary";
        case CL_INVALID_BUILD_OPTIONS:              return "Invalid build options";
        case CL_INVALID_PROGRAM:                    return "Invalid program";
        case CL_INVALID_PROGRAM_EXECUTABLE:         return "Invalid program executable";
        case CL_INVALID_KERNEL_NAME:                return "Invalid kernel name";
        case CL_INVALID_KERNEL_DEFINITION:          return "Invalid kernel definition";
        case CL_INVALID_KERNEL:                     return "Invalid kernel";
        case CL_INVALID_ARG_INDEX:                  return "Invalid argument index";
        case CL_INVALID_ARG_VALUE:                  return "Invalid argument value";
        case CL_INVALID_ARG_SIZE:                   return "Invalid argument size";
        case CL_INVALID_KERNEL_ARGS:                return "Invalid kernel arguments";
        case CL_INVALID_WORK_DIMENSION:             return "Invalid work dimension";
        case CL_INVALID_WORK_GROUP_SIZE:            return "Invalid work group size";
        case CL_INVALID_WORK_ITEM_SIZE:             return "Invalid work item size";
        case CL_INVALID_GLOBAL_OFFSET:              return "Invalid global offset";
        case CL_INVALID_EVENT_WAIT_LIST:            return "Invalid event wait list";
        case CL_INVALID_EVENT:                      return "Invalid event";
        case CL_INVALID_OPERATION:                  return "Invalid operation";
        case CL_INVALID_GL_OBJECT:                  return "Invalid OpenGL object";
        case CL_INVALID_BUFFER_SIZE:                return "Invalid buffer size";
        case CL_INVALID_MIP_LEVEL:                  return "Invalid mip-map level";
        default:                                    return "Unknown";
    }
}

static void opencl_succeed_fatal(unsigned int ret,
                                 const char *call,
                                 const char *file,
                                 int line) {
  if (ret != CL_SUCCESS) {
    futhark_panic(-1, "%s:%d: OpenCL call\n  %s\nfailed with error code %d (%s)\n",
          file, line, call, ret, opencl_error_string(ret));
  }
}

static char* opencl_succeed_nonfatal(unsigned int ret,
                                     const char *call,
                                     const char *file,
                                     int line) {
  if (ret != CL_SUCCESS) {
    return msgprintf("%s:%d: OpenCL call\n  %s\nfailed with error code %d (%s)\n",
                     file, line, call, ret, opencl_error_string(ret));
  } else {
    return NULL;
  }
}

static void set_preferred_platform(struct opencl_config *cfg, const char *s) {
  cfg->preferred_platform = s;
  cfg->ignore_blacklist = 1;
}

static void set_preferred_device(struct opencl_config *cfg, const char *s) {
  int x = 0;
  if (*s == '#') {
    s++;
    while (isdigit(*s)) {
      x = x * 10 + (*s++)-'0';
    }
    // Skip trailing spaces.
    while (isspace(*s)) {
      s++;
    }
  }
  cfg->preferred_device = s;
  cfg->preferred_device_num = x;
  cfg->ignore_blacklist = 1;
}

static char* opencl_platform_info(cl_platform_id platform,
                                  cl_platform_info param) {
  size_t req_bytes;
  char *info;

  OPENCL_SUCCEED_FATAL(clGetPlatformInfo(platform, param, 0, NULL, &req_bytes));

  info = (char*) malloc(req_bytes);

  OPENCL_SUCCEED_FATAL(clGetPlatformInfo(platform, param, req_bytes, info, NULL));

  return info;
}

static char* opencl_device_info(cl_device_id device,
                                cl_device_info param) {
  size_t req_bytes;
  char *info;

  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device, param, 0, NULL, &req_bytes));

  info = (char*) malloc(req_bytes);

  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device, param, req_bytes, info, NULL));

  return info;
}

static void opencl_all_device_options(struct opencl_device_option **devices_out,
                                      size_t *num_devices_out) {
  size_t num_devices = 0, num_devices_added = 0;

  cl_platform_id *all_platforms;
  cl_uint *platform_num_devices;

  cl_uint num_platforms;

  // Find the number of platforms.
  OPENCL_SUCCEED_FATAL(clGetPlatformIDs(0, NULL, &num_platforms));

  // Make room for them.
  all_platforms = calloc(num_platforms, sizeof(cl_platform_id));
  platform_num_devices = calloc(num_platforms, sizeof(cl_uint));

  // Fetch all the platforms.
  OPENCL_SUCCEED_FATAL(clGetPlatformIDs(num_platforms, all_platforms, NULL));

  // Count the number of devices for each platform, as well as the
  // total number of devices.
  for (cl_uint i = 0; i < num_platforms; i++) {
    if (clGetDeviceIDs(all_platforms[i], CL_DEVICE_TYPE_ALL,
                       0, NULL, &platform_num_devices[i]) == CL_SUCCESS) {
      num_devices += platform_num_devices[i];
    } else {
      platform_num_devices[i] = 0;
    }
  }

  // Make room for all the device options.
  struct opencl_device_option *devices =
    calloc(num_devices, sizeof(struct opencl_device_option));

  // Loop through the platforms, getting information about their devices.
  for (cl_uint i = 0; i < num_platforms; i++) {
    cl_platform_id platform = all_platforms[i];
    cl_uint num_platform_devices = platform_num_devices[i];

    if (num_platform_devices == 0) {
      continue;
    }

    char *platform_name = opencl_platform_info(platform, CL_PLATFORM_NAME);
    cl_device_id *platform_devices =
      calloc(num_platform_devices, sizeof(cl_device_id));

    // Fetch all the devices.
    OPENCL_SUCCEED_FATAL(clGetDeviceIDs(platform, CL_DEVICE_TYPE_ALL,
                                  num_platform_devices, platform_devices, NULL));

    // Loop through the devices, adding them to the devices array.
    for (cl_uint i = 0; i < num_platform_devices; i++) {
      char *device_name = opencl_device_info(platform_devices[i], CL_DEVICE_NAME);
      devices[num_devices_added].platform = platform;
      devices[num_devices_added].device = platform_devices[i];
      OPENCL_SUCCEED_FATAL(clGetDeviceInfo(platform_devices[i], CL_DEVICE_TYPE,
                                     sizeof(cl_device_type),
                                     &devices[num_devices_added].device_type,
                                     NULL));
      // We don't want the structs to share memory, so copy the platform name.
      // Each device name is already unique.
      devices[num_devices_added].platform_name = strclone(platform_name);
      devices[num_devices_added].device_name = device_name;
      num_devices_added++;
    }
    free(platform_devices);
    free(platform_name);
  }
  free(all_platforms);
  free(platform_num_devices);

  *devices_out = devices;
  *num_devices_out = num_devices;
}

// Returns 0 on success.
static int list_devices(struct opencl_config *cfg) {
  struct opencl_device_option *devices;
  size_t num_devices;

  opencl_all_device_options(&devices, &num_devices);

  const char *cur_platform = "";
  for (size_t i = 0; i < num_devices; i++) {
    struct opencl_device_option device = devices[i];
    if (strcmp(cur_platform, device.platform_name) != 0) {
      printf("Platform: %s\n", device.platform_name);
      cur_platform = device.platform_name;
    }
    printf("[%d]: %s\n", (int)i, device.device_name);
  }

  // Free all the platform and device names.
  for (size_t j = 0; j < num_devices; j++) {
    free(devices[j].platform_name);
    free(devices[j].device_name);
  }
  free(devices);

  return 0;
}

// Returns 0 on success.
static int select_device_interactively(struct opencl_config *cfg) {
  struct opencl_device_option *devices;
  size_t num_devices;
  int ret = 1;

  opencl_all_device_options(&devices, &num_devices);

  printf("Choose OpenCL device:\n");
  const char *cur_platform = "";
  for (size_t i = 0; i < num_devices; i++) {
    struct opencl_device_option device = devices[i];
    if (strcmp(cur_platform, device.platform_name) != 0) {
      printf("Platform: %s\n", device.platform_name);
      cur_platform = device.platform_name;
    }
    printf("[%d] %s\n", (int)i, device.device_name);
  }

  int selection;
  printf("Choice: ");
  if (scanf("%d", &selection) == 1) {
    ret = 0;
    cfg->preferred_platform = "";
    cfg->preferred_device = "";
    cfg->preferred_device_num = selection;
    cfg->ignore_blacklist = 1;
  }

  // Free all the platform and device names.
  for (size_t j = 0; j < num_devices; j++) {
    free(devices[j].platform_name);
    free(devices[j].device_name);
  }
  free(devices);

  return ret;
}

static int is_blacklisted(const char *platform_name, const char *device_name,
                          const struct opencl_config *cfg) {
  if (strcmp(cfg->preferred_platform, "") != 0 ||
      strcmp(cfg->preferred_device, "") != 0) {
    return 0;
  } else if (strstr(platform_name, "Apple") != NULL &&
             strstr(device_name, "Intel(R) Core(TM)") != NULL) {
    return 1;
  } else {
    return 0;
  }
}

static struct opencl_device_option get_preferred_device(const struct opencl_config *cfg) {
  struct opencl_device_option *devices;
  size_t num_devices;

  opencl_all_device_options(&devices, &num_devices);

  int num_device_matches = 0;

  for (size_t i = 0; i < num_devices; i++) {
    struct opencl_device_option device = devices[i];
    if (strstr(device.platform_name, cfg->preferred_platform) != NULL &&
        strstr(device.device_name, cfg->preferred_device) != NULL &&
        (cfg->ignore_blacklist ||
         !is_blacklisted(device.platform_name, device.device_name, cfg)) &&
        num_device_matches++ == cfg->preferred_device_num) {
      // Free all the platform and device names, except the ones we have chosen.
      for (size_t j = 0; j < num_devices; j++) {
        if (j != i) {
          free(devices[j].platform_name);
          free(devices[j].device_name);
        }
      }
      free(devices);
      return device;
    }
  }

  futhark_panic(1, "Could not find acceptable OpenCL device.\n");
  exit(1); // Never reached
}

static void describe_device_option(struct opencl_device_option device) {
  fprintf(stderr, "Using platform: %s\n", device.platform_name);
  fprintf(stderr, "Using device: %s\n", device.device_name);
}

static cl_build_status build_opencl_program(cl_program program, cl_device_id device, const char* options) {
  cl_int clBuildProgram_error = clBuildProgram(program, 1, &device, options, NULL, NULL);

  // Avoid termination due to CL_BUILD_PROGRAM_FAILURE
  if (clBuildProgram_error != CL_SUCCESS &&
      clBuildProgram_error != CL_BUILD_PROGRAM_FAILURE) {
    OPENCL_SUCCEED_FATAL(clBuildProgram_error);
  }

  cl_build_status build_status;
  OPENCL_SUCCEED_FATAL(clGetProgramBuildInfo(program,
                                             device,
                                             CL_PROGRAM_BUILD_STATUS,
                                             sizeof(cl_build_status),
                                             &build_status,
                                             NULL));

  if (build_status != CL_SUCCESS) {
    char *build_log;
    size_t ret_val_size;
    OPENCL_SUCCEED_FATAL(clGetProgramBuildInfo(program, device, CL_PROGRAM_BUILD_LOG, 0, NULL, &ret_val_size));

    build_log = (char*) malloc(ret_val_size+1);
    OPENCL_SUCCEED_FATAL(clGetProgramBuildInfo(program, device, CL_PROGRAM_BUILD_LOG, ret_val_size, build_log, NULL));

    // The spec technically does not say whether the build log is zero-terminated, so let's be careful.
    build_log[ret_val_size] = '\0';

    fprintf(stderr, "Build log:\n%s\n", build_log);

    free(build_log);
  }

  return build_status;
}

// Fields in a bitmask indicating which types we must be sure are
// available.
enum opencl_required_type { OPENCL_F64 = 1 };

// We take as input several strings representing the program, because
// C does not guarantee that the compiler supports particularly large
// literals.  Notably, Visual C has a limit of 2048 characters.  The
// array must be NULL-terminated.
static cl_program setup_opencl_with_command_queue(struct opencl_context *ctx,
                                                  cl_command_queue queue,
                                                  const char *srcs[],
                                                  int required_types,
                                                  const char *extra_build_opts[]) {
  int error;

  free_list_init(&ctx->free_list);
  ctx->queue = queue;

  OPENCL_SUCCEED_FATAL(clGetCommandQueueInfo(ctx->queue, CL_QUEUE_CONTEXT, sizeof(cl_context), &ctx->ctx, NULL));

  // Fill out the device info.  This is redundant work if we are
  // called from setup_opencl() (which is the common case), but I
  // doubt it matters much.
  struct opencl_device_option device_option;
  OPENCL_SUCCEED_FATAL(clGetCommandQueueInfo(ctx->queue, CL_QUEUE_DEVICE,
                                       sizeof(cl_device_id),
                                       &device_option.device,
                                       NULL));
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_PLATFORM,
                                 sizeof(cl_platform_id),
                                 &device_option.platform,
                                 NULL));
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_TYPE,
                                 sizeof(cl_device_type),
                                 &device_option.device_type,
                                 NULL));
  device_option.platform_name = opencl_platform_info(device_option.platform, CL_PLATFORM_NAME);
  device_option.device_name = opencl_device_info(device_option.device, CL_DEVICE_NAME);

  ctx->device = device_option.device;

  if (required_types & OPENCL_F64) {
    cl_uint supported;
    OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_PREFERRED_VECTOR_WIDTH_DOUBLE,
                                   sizeof(cl_uint), &supported, NULL));
    if (!supported) {
      futhark_panic(1, "Program uses double-precision floats, but this is not supported on the chosen device: %s\n",
            device_option.device_name);
    }
  }

  size_t max_group_size;
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_MAX_WORK_GROUP_SIZE,
                                 sizeof(size_t), &max_group_size, NULL));

  size_t max_tile_size = sqrt(max_group_size);

  cl_ulong max_local_memory;
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_LOCAL_MEM_SIZE,
                                       sizeof(size_t), &max_local_memory, NULL));

  // Futhark reserves 4 bytes for bookkeeping information.
  max_local_memory -= 4;

  // The OpenCL implementation may reserve some local memory bytes for
  // various purposes.  In principle, we should use
  // clGetKernelWorkGroupInfo() to figure out for each kernel how much
  // is actually available, but our current code generator design
  // makes this infeasible.  Instead, we have this nasty hack where we
  // arbitrarily subtract some bytes, based on empirical measurements
  // (but which might be arbitrarily wrong).  Fortunately, we rarely
  // try to really push the local memory usage.
  if (strstr(device_option.platform_name, "NVIDIA CUDA") != NULL) {
    max_local_memory -= 12;
  } else if (strstr(device_option.platform_name, "AMD") != NULL) {
    max_local_memory -= 16;
  }

  // Make sure this function is defined.
  post_opencl_setup(ctx, &device_option);

  if (max_group_size < ctx->cfg.default_group_size) {
    if (ctx->cfg.default_group_size_changed) {
      fprintf(stderr, "Note: Device limits default group size to %zu (down from %zu).\n",
              max_group_size, ctx->cfg.default_group_size);
    }
    ctx->cfg.default_group_size = max_group_size;
  }

  if (max_tile_size < ctx->cfg.default_tile_size) {
    if (ctx->cfg.default_tile_size_changed) {
      fprintf(stderr, "Note: Device limits default tile size to %zu (down from %zu).\n",
              max_tile_size, ctx->cfg.default_tile_size);
    }
    ctx->cfg.default_tile_size = max_tile_size;
  }

  ctx->max_group_size = max_group_size;
  ctx->max_tile_size = max_tile_size; // No limit.
  ctx->max_threshold = ctx->max_num_groups = 0; // No limit.
  ctx->max_local_memory = max_local_memory;

  // Now we go through all the sizes, clamp them to the valid range,
  // or set them to the default.
  for (int i = 0; i < ctx->cfg.num_sizes; i++) {
    const char *size_class = ctx->cfg.size_classes[i];
    size_t *size_value = &ctx->cfg.size_values[i];
    const char* size_name = ctx->cfg.size_names[i];
    size_t max_value = 0, default_value = 0;
    if (strstr(size_class, "group_size") == size_class) {
      max_value = max_group_size;
      default_value = ctx->cfg.default_group_size;
    } else if (strstr(size_class, "num_groups") == size_class) {
      max_value = max_group_size; // Futhark assumes this constraint.
      default_value = ctx->cfg.default_num_groups;
      // XXX: as a quick and dirty hack, use twice as many threads for
      // histograms by default.  We really should just be smarter
      // about sizes somehow.
      if (strstr(size_name, ".seghist_") != NULL) {
        default_value *= 2;
      }
    } else if (strstr(size_class, "tile_size") == size_class) {
      max_value = sqrt(max_group_size);
      default_value = ctx->cfg.default_tile_size;
    } else if (strstr(size_class, "threshold") == size_class) {
      // Threshold can be as large as it takes.
      default_value = ctx->cfg.default_threshold;
    } else {
      // Bespoke sizes have no limit or default.
    }
    if (*size_value == 0) {
      *size_value = default_value;
    } else if (max_value > 0 && *size_value > max_value) {
      fprintf(stderr, "Note: Device limits %s to %d (down from %d)\n",
              size_name, (int)max_value, (int)*size_value);
      *size_value = max_value;
    }
  }

  if (ctx->lockstep_width == 0) {
    ctx->lockstep_width = 1;
  }

  if (ctx->cfg.logging) {
    fprintf(stderr, "Lockstep width: %d\n", (int)ctx->lockstep_width);
    fprintf(stderr, "Default group size: %d\n", (int)ctx->cfg.default_group_size);
    fprintf(stderr, "Default number of groups: %d\n", (int)ctx->cfg.default_num_groups);
  }

  char *fut_opencl_src = NULL;
  cl_program prog;
  error = CL_SUCCESS;

  if (ctx->cfg.load_binary_from == NULL) {
    size_t src_size = 0;

    // Maybe we have to read OpenCL source from somewhere else (used for debugging).
    if (ctx->cfg.load_program_from != NULL) {
      fut_opencl_src = slurp_file(ctx->cfg.load_program_from, NULL);
      assert(fut_opencl_src != NULL);
    } else {
      // Construct the OpenCL source concatenating all the fragments.
      for (const char **src = srcs; src && *src; src++) {
        src_size += strlen(*src);
      }

      fut_opencl_src = (char*) malloc(src_size + 1);

      size_t n, i;
      for (i = 0, n = 0; srcs && srcs[i]; i++) {
        strncpy(fut_opencl_src+n, srcs[i], src_size-n);
        n += strlen(srcs[i]);
      }
      fut_opencl_src[src_size] = 0;
    }

    if (ctx->cfg.dump_program_to != NULL) {
      if (ctx->cfg.debugging) {
        fprintf(stderr, "Dumping OpenCL source to %s...\n", ctx->cfg.dump_program_to);
      }

      dump_file(ctx->cfg.dump_program_to, fut_opencl_src, strlen(fut_opencl_src));
    }

    if (ctx->cfg.debugging) {
      fprintf(stderr, "Creating OpenCL program...\n");
    }

    const char* src_ptr[] = {fut_opencl_src};
    prog = clCreateProgramWithSource(ctx->ctx, 1, src_ptr, &src_size, &error);
    OPENCL_SUCCEED_FATAL(error);
  } else {
    if (ctx->cfg.debugging) {
      fprintf(stderr, "Loading OpenCL binary from %s...\n", ctx->cfg.load_binary_from);
    }
    size_t binary_size;
    unsigned char *fut_opencl_bin =
      (unsigned char*) slurp_file(ctx->cfg.load_binary_from, &binary_size);
    assert(fut_opencl_bin != NULL);
    const unsigned char *binaries[1] = { fut_opencl_bin };
    cl_int status = 0;

    prog = clCreateProgramWithBinary(ctx->ctx, 1, &device_option.device,
                                     &binary_size, binaries,
                                     &status, &error);

    OPENCL_SUCCEED_FATAL(status);
    OPENCL_SUCCEED_FATAL(error);
  }

  int compile_opts_size = 1024;

  for (int i = 0; i < ctx->cfg.num_sizes; i++) {
    compile_opts_size += strlen(ctx->cfg.size_names[i]) + 20;
  }

  for (int i = 0; extra_build_opts[i] != NULL; i++) {
    compile_opts_size += strlen(extra_build_opts[i] + 1);
  }

  char *compile_opts = (char*) malloc(compile_opts_size);

  int w = snprintf(compile_opts, compile_opts_size,
                   "-DLOCKSTEP_WIDTH=%d ",
                   (int)ctx->lockstep_width);

  for (int i = 0; i < ctx->cfg.num_sizes; i++) {
    w += snprintf(compile_opts+w, compile_opts_size-w,
                  "-D%s=%d ",
                  ctx->cfg.size_vars[i],
                  (int)ctx->cfg.size_values[i]);
  }

  for (int i = 0; extra_build_opts[i] != NULL; i++) {
    w += snprintf(compile_opts+w, compile_opts_size-w,
                  "%s ", extra_build_opts[i]);
  }

  if (ctx->cfg.debugging) {
    fprintf(stderr, "OpenCL compiler options: %s\n", compile_opts);
    fprintf(stderr, "Building OpenCL program...\n");
  }
  OPENCL_SUCCEED_FATAL(build_opencl_program(prog, device_option.device, compile_opts));

  free(compile_opts);
  free(fut_opencl_src);

  if (ctx->cfg.dump_binary_to != NULL) {
    if (ctx->cfg.debugging) {
      fprintf(stderr, "Dumping OpenCL binary to %s...\n", ctx->cfg.dump_binary_to);
    }

    size_t binary_size;
    OPENCL_SUCCEED_FATAL(clGetProgramInfo(prog, CL_PROGRAM_BINARY_SIZES,
                                          sizeof(size_t), &binary_size, NULL));
    unsigned char *binary = (unsigned char*) malloc(binary_size);
    unsigned char *binaries[1] = { binary };
    OPENCL_SUCCEED_FATAL(clGetProgramInfo(prog, CL_PROGRAM_BINARIES,
                                          sizeof(unsigned char*), binaries, NULL));

    dump_file(ctx->cfg.dump_binary_to, binary, binary_size);
  }

  return prog;
}

static cl_program setup_opencl(struct opencl_context *ctx,
                               const char *srcs[],
                               int required_types,
                               const char *extra_build_opts[]) {

  ctx->lockstep_width = 0; // Real value set later.

  struct opencl_device_option device_option = get_preferred_device(&ctx->cfg);

  if (ctx->cfg.logging) {
    describe_device_option(device_option);
  }

  // Note that NVIDIA's OpenCL requires the platform property
  cl_context_properties properties[] = {
    CL_CONTEXT_PLATFORM,
    (cl_context_properties)device_option.platform,
    0
  };

  cl_int clCreateContext_error;
  ctx->ctx = clCreateContext(properties, 1, &device_option.device, NULL, NULL, &clCreateContext_error);
  OPENCL_SUCCEED_FATAL(clCreateContext_error);

  cl_int clCreateCommandQueue_error;
  cl_command_queue queue =
    clCreateCommandQueue(ctx->ctx,
                         device_option.device,
                         ctx->cfg.profiling ? CL_QUEUE_PROFILING_ENABLE : 0,
                         &clCreateCommandQueue_error);
  OPENCL_SUCCEED_FATAL(clCreateCommandQueue_error);

  return setup_opencl_with_command_queue(ctx, queue, srcs, required_types, extra_build_opts);
}

// Count up the runtime all the profiling_records that occured during execution.
// Also clears the buffer of profiling_records.
static cl_int opencl_tally_profiling_records(struct opencl_context *ctx) {
  cl_int err;
  for (int i = 0; i < ctx->profiling_records_used; i++) {
    struct profiling_record record = ctx->profiling_records[i];

    cl_ulong start_t, end_t;

    if ((err = clGetEventProfilingInfo(*record.event,
                                       CL_PROFILING_COMMAND_START,
                                       sizeof(start_t),
                                       &start_t,
                                       NULL)) != CL_SUCCESS) {
      return err;
    }

    if ((err = clGetEventProfilingInfo(*record.event,
                                       CL_PROFILING_COMMAND_END,
                                       sizeof(end_t),
                                       &end_t,
                                       NULL)) != CL_SUCCESS) {
      return err;
    }

    // OpenCL provides nanosecond resolution, but we want
    // microseconds.
    *record.runs += 1;
    *record.runtime += (end_t - start_t)/1000;

    if ((err = clReleaseEvent(*record.event)) != CL_SUCCESS) {
      return err;
    }
    free(record.event);
  }

  ctx->profiling_records_used = 0;

  return CL_SUCCESS;
}

// If profiling, produce an event associated with a profiling record.
static cl_event* opencl_get_event(struct opencl_context *ctx, int *runs, int64_t *runtime) {
    if (ctx->profiling_records_used == ctx->profiling_records_capacity) {
      ctx->profiling_records_capacity *= 2;
      ctx->profiling_records =
        realloc(ctx->profiling_records,
                ctx->profiling_records_capacity *
                sizeof(struct profiling_record));
    }
    cl_event *event = malloc(sizeof(cl_event));
    ctx->profiling_records[ctx->profiling_records_used].event = event;
    ctx->profiling_records[ctx->profiling_records_used].runs = runs;
    ctx->profiling_records[ctx->profiling_records_used].runtime = runtime;
    ctx->profiling_records_used++;
    return event;
}

// Allocate memory from driver. The problem is that OpenCL may perform
// lazy allocation, so we cannot know whether an allocation succeeded
// until the first time we try to use it.  Hence we immediately
// perform a write to see if the allocation succeeded.  This is slow,
// but the assumption is that this operation will be rare (most things
// will go through the free list).
static int opencl_alloc_actual(struct opencl_context *ctx, size_t size, cl_mem *mem_out) {
  int error;
  *mem_out = clCreateBuffer(ctx->ctx, CL_MEM_READ_WRITE, size, NULL, &error);

  if (error != CL_SUCCESS) {
    return error;
  }

  int x = 2;
  error = clEnqueueWriteBuffer(ctx->queue, *mem_out, 1, 0, sizeof(x), &x, 0, NULL, NULL);

  // No need to wait for completion here. clWaitForEvents() cannot
  // return mem object allocation failures. This implies that the
  // buffer is faulted onto the device on enqueue. (Observation by
  // Andreas Kloeckner.)

  return error;
}

static int opencl_alloc(struct opencl_context *ctx, size_t min_size, const char *tag, cl_mem *mem_out) {
  (void)tag;
  if (min_size < sizeof(int)) {
    min_size = sizeof(int);
  }

  size_t size;

  if (free_list_find(&ctx->free_list, min_size, &size, mem_out) == 0) {
    // Successfully found a free block.  Is it big enough?
    //
    // FIXME: we might also want to check whether the block is *too
    // big*, to avoid internal fragmentation.  However, this can
    // sharply impact performance on programs where arrays change size
    // frequently.  Fortunately, such allocations are usually fairly
    // short-lived, as they are necessarily within a loop, so the risk
    // of internal fragmentation resulting in an OOM situation is
    // limited.  However, it would be preferable if we could go back
    // and *shrink* oversize allocations when we encounter an OOM
    // condition.  That is technically feasible, since we do not
    // expose OpenCL pointer values directly to the application, but
    // instead rely on a level of indirection.
    if (size >= min_size) {
      if (ctx->cfg.debugging) {
        fprintf(stderr, "No need to allocate: Found a block in the free list.\n");
      }

      return CL_SUCCESS;
    } else {
      if (ctx->cfg.debugging) {
        fprintf(stderr, "Found a free block, but it was too small.\n");
      }

      // Not just right - free it.
      int error = clReleaseMemObject(*mem_out);
      if (error != CL_SUCCESS) {
        return error;
      }
    }
  }

  // We have to allocate a new block from the driver.  If the
  // allocation does not succeed, then we might be in an out-of-memory
  // situation.  We now start freeing things from the free list until
  // we think we have freed enough that the allocation will succeed.
  // Since we don't know how far the allocation is from fitting, we
  // have to check after every deallocation.  This might be pretty
  // expensive.  Let's hope that this case is hit rarely.

  if (ctx->cfg.debugging) {
    fprintf(stderr, "Actually allocating the desired block.\n");
  }

  int error = opencl_alloc_actual(ctx, min_size, mem_out);

  while (error == CL_MEM_OBJECT_ALLOCATION_FAILURE) {
    if (ctx->cfg.debugging) {
      fprintf(stderr, "Out of OpenCL memory: releasing entry from the free list...\n");
    }
    cl_mem mem;
    if (free_list_first(&ctx->free_list, &mem) == 0) {
      error = clReleaseMemObject(mem);
      if (error != CL_SUCCESS) {
        return error;
      }
    } else {
      break;
    }
    error = opencl_alloc_actual(ctx, min_size, mem_out);
  }

  return error;
}

static int opencl_free(struct opencl_context *ctx, cl_mem mem, const char *tag) {
  size_t size;
  cl_mem existing_mem;

  // If there is already a block with this tag, then remove it.
  if (free_list_find(&ctx->free_list, -1, &size, &existing_mem) == 0) {
    int error = clReleaseMemObject(existing_mem);
    if (error != CL_SUCCESS) {
      return error;
    }
  }

  int error = clGetMemObjectInfo(mem, CL_MEM_SIZE, sizeof(size_t), &size, NULL);

  if (error == CL_SUCCESS) {
    free_list_insert(&ctx->free_list, size, mem, tag);
  }

  return error;
}

static int opencl_free_all(struct opencl_context *ctx) {
  cl_mem mem;
  free_list_pack(&ctx->free_list);
  while (free_list_first(&ctx->free_list, &mem) == 0) {
    int error = clReleaseMemObject(mem);
    if (error != CL_SUCCESS) {
      return error;
    }
  }

  return CL_SUCCESS;
}

// Free everything that belongs to 'ctx', but do not free 'ctx'
// itself.
static void teardown_opencl(struct opencl_context *ctx) {
  (void)opencl_tally_profiling_records(ctx);
  free(ctx->profiling_records);
  (void)opencl_free_all(ctx);
  (void)clReleaseCommandQueue(ctx->queue);
  (void)clReleaseContext(ctx->ctx);
}

// End of opencl.h.

static const char *opencl_program[] =
                  {"#ifdef cl_clang_storage_class_specifiers\n#pragma OPENCL EXTENSION cl_clang_storage_class_specifiers : enable\n#endif\n#pragma OPENCL EXTENSION cl_khr_byte_addressable_store : enable\n__kernel void dummy_kernel(__global unsigned char *dummy, int n)\n{\n    const int thread_gid = get_global_id(0);\n    \n    if (thread_gid >= n)\n        return;\n}\ntypedef char int8_t;\ntypedef short int16_t;\ntypedef int int32_t;\ntypedef long int64_t;\ntypedef uchar uint8_t;\ntypedef ushort uint16_t;\ntypedef uint uint32_t;\ntypedef ulong uint64_t;\n#ifdef cl_nv_pragma_unroll\nstatic inline void mem_fence_global()\n{\n    asm(\"membar.gl;\");\n}\n#else\nstatic inline void mem_fence_global()\n{\n    mem_fence(CLK_LOCAL_MEM_FENCE | CLK_GLOBAL_MEM_FENCE);\n}\n#endif\nstatic inline void mem_fence_local()\n{\n    mem_fence(CLK_LOCAL_MEM_FENCE);\n}\nstatic inline uint8_t add8(uint8_t x, uint8_t y)\n{\n    return x + y;\n}\nstatic inline uint16_t add16(uint16_t x, uint16_t y)\n{\n    return x + y;\n}\nstatic inline uint32_t add32(uint32_t x, uint32_t y)\n{\n    return x + y;\n}\nstatic inline uint64_t add64(uint64_t x, uint64_t y)\n{\n    return x + y;\n}\nstatic inline uint8_t sub8(uint8_t x, uint8_t y)\n{\n    return x - y;\n}\nstatic inline uint16_t sub16(uint16_t x, uint16_t y)\n{\n    return x - y;\n}\nstatic inline uint32_t sub32(uint32_t x, uint32_t y)\n{\n    return x - y;\n}\nstatic inline uint64_t sub64(uint64_t x, uint64_t y)\n{\n    return x - y;\n}\nstatic inline uint8_t mul8(uint8_t x, uint8_t y)\n{\n    return x * y;\n}\nstatic inline uint16_t mul16(uint16_t x, uint16_t y)\n{\n    return x * y;\n}\nstatic inline uint32_t mul32(uint32_t x, uint32_t y)\n{\n    return x * y;\n}\nstatic inline uint64_t mul64(uint64_t x, uint64_t y)\n{\n    return x * y;\n}\nstatic inline uint8_t udiv8(uint8_t x, uint8_t y)\n{\n    return x / y;\n}\nstatic inline uint16_t udiv16(uint16_t x, uint16_t y)\n{\n    return x / y;\n}\nstatic inline uint32_t udiv32(uint32_t x, uint32_t y)\n{\n    return x / y;\n}\nstatic inline uint64_t udiv64(uint64_t x, uint64_t y)\n{\n    return x / y;\n}\nstatic ",
                   "inline uint8_t udiv_up8(uint8_t x, uint8_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint16_t udiv_up16(uint16_t x, uint16_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint32_t udiv_up32(uint32_t x, uint32_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint64_t udiv_up64(uint64_t x, uint64_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint8_t umod8(uint8_t x, uint8_t y)\n{\n    return x % y;\n}\nstatic inline uint16_t umod16(uint16_t x, uint16_t y)\n{\n    return x % y;\n}\nstatic inline uint32_t umod32(uint32_t x, uint32_t y)\n{\n    return x % y;\n}\nstatic inline uint64_t umod64(uint64_t x, uint64_t y)\n{\n    return x % y;\n}\nstatic inline uint8_t udiv_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint16_t udiv_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint32_t udiv_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint64_t udiv_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint8_t udiv_up_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint16_t udiv_up_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint32_t udiv_up_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint64_t udiv_up_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint8_t umod_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint16_t umod_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint32_t umod_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint64_t umod_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int8_t sdiv8(int8_t x, int8_t y)\n{\n    int8_t q = x / y;\n    int8_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int16_t sdiv16(int16",
                   "_t x, int16_t y)\n{\n    int16_t q = x / y;\n    int16_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int32_t sdiv32(int32_t x, int32_t y)\n{\n    int32_t q = x / y;\n    int32_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int64_t sdiv64(int64_t x, int64_t y)\n{\n    int64_t q = x / y;\n    int64_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int8_t sdiv_up8(int8_t x, int8_t y)\n{\n    return sdiv8(x + y - 1, y);\n}\nstatic inline int16_t sdiv_up16(int16_t x, int16_t y)\n{\n    return sdiv16(x + y - 1, y);\n}\nstatic inline int32_t sdiv_up32(int32_t x, int32_t y)\n{\n    return sdiv32(x + y - 1, y);\n}\nstatic inline int64_t sdiv_up64(int64_t x, int64_t y)\n{\n    return sdiv64(x + y - 1, y);\n}\nstatic inline int8_t smod8(int8_t x, int8_t y)\n{\n    int8_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int16_t smod16(int16_t x, int16_t y)\n{\n    int16_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int32_t smod32(int32_t x, int32_t y)\n{\n    int32_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int64_t smod64(int64_t x, int64_t y)\n{\n    int64_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int8_t sdiv_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : sdiv8(x, y);\n}\nstatic inline int16_t sdiv_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : sdiv16(x, y);\n}\nstatic inline int32_t sdiv_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : sdiv32(x, y);\n}\nstatic inline int64_t sdiv_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : sdiv64(x, y);\n}\nstatic inline int8_t sdiv_up_safe8(int8_t x, int8_t y)\n{\n    return sdiv_safe8(x + y - 1, y);\n}\nstatic inline int16_t sdiv_up_safe16(int16_t x, int16_t y)\n{\n    return sdiv_safe16(x + y - 1, y",
                   ");\n}\nstatic inline int32_t sdiv_up_safe32(int32_t x, int32_t y)\n{\n    return sdiv_safe32(x + y - 1, y);\n}\nstatic inline int64_t sdiv_up_safe64(int64_t x, int64_t y)\n{\n    return sdiv_safe64(x + y - 1, y);\n}\nstatic inline int8_t smod_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : smod8(x, y);\n}\nstatic inline int16_t smod_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : smod16(x, y);\n}\nstatic inline int32_t smod_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : smod32(x, y);\n}\nstatic inline int64_t smod_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : smod64(x, y);\n}\nstatic inline int8_t squot8(int8_t x, int8_t y)\n{\n    return x / y;\n}\nstatic inline int16_t squot16(int16_t x, int16_t y)\n{\n    return x / y;\n}\nstatic inline int32_t squot32(int32_t x, int32_t y)\n{\n    return x / y;\n}\nstatic inline int64_t squot64(int64_t x, int64_t y)\n{\n    return x / y;\n}\nstatic inline int8_t srem8(int8_t x, int8_t y)\n{\n    return x % y;\n}\nstatic inline int16_t srem16(int16_t x, int16_t y)\n{\n    return x % y;\n}\nstatic inline int32_t srem32(int32_t x, int32_t y)\n{\n    return x % y;\n}\nstatic inline int64_t srem64(int64_t x, int64_t y)\n{\n    return x % y;\n}\nstatic inline int8_t squot_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int16_t squot_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int32_t squot_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int64_t squot_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int8_t srem_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int16_t srem_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int32_t srem_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int64_t srem_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int8_t smin8(int8_t x, int8_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int16_t smi",
                   "n16(int16_t x, int16_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int32_t smin32(int32_t x, int32_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int64_t smin64(int64_t x, int64_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint8_t umin8(uint8_t x, uint8_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint16_t umin16(uint16_t x, uint16_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint32_t umin32(uint32_t x, uint32_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint64_t umin64(uint64_t x, uint64_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int8_t smax8(int8_t x, int8_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int16_t smax16(int16_t x, int16_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int32_t smax32(int32_t x, int32_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int64_t smax64(int64_t x, int64_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint8_t umax8(uint8_t x, uint8_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint16_t umax16(uint16_t x, uint16_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint32_t umax32(uint32_t x, uint32_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint64_t umax64(uint64_t x, uint64_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint8_t shl8(uint8_t x, uint8_t y)\n{\n    return x << y;\n}\nstatic inline uint16_t shl16(uint16_t x, uint16_t y)\n{\n    return x << y;\n}\nstatic inline uint32_t shl32(uint32_t x, uint32_t y)\n{\n    return x << y;\n}\nstatic inline uint64_t shl64(uint64_t x, uint64_t y)\n{\n    return x << y;\n}\nstatic inline uint8_t lshr8(uint8_t x, uint8_t y)\n{\n    return x >> y;\n}\nstatic inline uint16_t lshr16(uint16_t x, uint16_t y)\n{\n    return x >> y;\n}\nstatic inline uint32_t lshr32(uint32_t x, uint32_t y)\n{\n    return x >> y;\n}\nstatic inline uint64_t lshr64(uint64_t x, uint64_t y)\n{\n    return x >> y;\n}\nstatic inline int8_t ashr8(int8_t x, int8_t y)\n{\n    return x >> y;\n}\nstatic inline int16_t ashr16(int16_t x, int16_t y)\n{\n    return x >> y;\n}\nstatic inline int32_t ashr32(int32_t x, int32_t y)",
                   "\n{\n    return x >> y;\n}\nstatic inline int64_t ashr64(int64_t x, int64_t y)\n{\n    return x >> y;\n}\nstatic inline uint8_t and8(uint8_t x, uint8_t y)\n{\n    return x & y;\n}\nstatic inline uint16_t and16(uint16_t x, uint16_t y)\n{\n    return x & y;\n}\nstatic inline uint32_t and32(uint32_t x, uint32_t y)\n{\n    return x & y;\n}\nstatic inline uint64_t and64(uint64_t x, uint64_t y)\n{\n    return x & y;\n}\nstatic inline uint8_t or8(uint8_t x, uint8_t y)\n{\n    return x | y;\n}\nstatic inline uint16_t or16(uint16_t x, uint16_t y)\n{\n    return x | y;\n}\nstatic inline uint32_t or32(uint32_t x, uint32_t y)\n{\n    return x | y;\n}\nstatic inline uint64_t or64(uint64_t x, uint64_t y)\n{\n    return x | y;\n}\nstatic inline uint8_t xor8(uint8_t x, uint8_t y)\n{\n    return x ^ y;\n}\nstatic inline uint16_t xor16(uint16_t x, uint16_t y)\n{\n    return x ^ y;\n}\nstatic inline uint32_t xor32(uint32_t x, uint32_t y)\n{\n    return x ^ y;\n}\nstatic inline uint64_t xor64(uint64_t x, uint64_t y)\n{\n    return x ^ y;\n}\nstatic inline bool ult8(uint8_t x, uint8_t y)\n{\n    return x < y;\n}\nstatic inline bool ult16(uint16_t x, uint16_t y)\n{\n    return x < y;\n}\nstatic inline bool ult32(uint32_t x, uint32_t y)\n{\n    return x < y;\n}\nstatic inline bool ult64(uint64_t x, uint64_t y)\n{\n    return x < y;\n}\nstatic inline bool ule8(uint8_t x, uint8_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule16(uint16_t x, uint16_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule32(uint32_t x, uint32_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule64(uint64_t x, uint64_t y)\n{\n    return x <= y;\n}\nstatic inline bool slt8(int8_t x, int8_t y)\n{\n    return x < y;\n}\nstatic inline bool slt16(int16_t x, int16_t y)\n{\n    return x < y;\n}\nstatic inline bool slt32(int32_t x, int32_t y)\n{\n    return x < y;\n}\nstatic inline bool slt64(int64_t x, int64_t y)\n{\n    return x < y;\n}\nstatic inline bool sle8(int8_t x, int8_t y)\n{\n    return x <= y;\n}\nstatic inline bool sle16(int16_t x, int16_t y)\n{\n    return x <= y;\n}\nstatic inline bool sle32(int32_t x, int32_",
                   "t y)\n{\n    return x <= y;\n}\nstatic inline bool sle64(int64_t x, int64_t y)\n{\n    return x <= y;\n}\nstatic inline int8_t pow8(int8_t x, int8_t y)\n{\n    int8_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int16_t pow16(int16_t x, int16_t y)\n{\n    int16_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int32_t pow32(int32_t x, int32_t y)\n{\n    int32_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int64_t pow64(int64_t x, int64_t y)\n{\n    int64_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline bool itob_i8_bool(int8_t x)\n{\n    return x;\n}\nstatic inline bool itob_i16_bool(int16_t x)\n{\n    return x;\n}\nstatic inline bool itob_i32_bool(int32_t x)\n{\n    return x;\n}\nstatic inline bool itob_i64_bool(int64_t x)\n{\n    return x;\n}\nstatic inline int8_t btoi_bool_i8(bool x)\n{\n    return x;\n}\nstatic inline int16_t btoi_bool_i16(bool x)\n{\n    return x;\n}\nstatic inline int32_t btoi_bool_i32(bool x)\n{\n    return x;\n}\nstatic inline int64_t btoi_bool_i64(bool x)\n{\n    return x;\n}\n#define sext_i8_i8(x) ((int8_t) (int8_t) x)\n#define sext_i8_i16(x) ((int16_t) (int8_t) x)\n#define sext_i8_i32(x) ((int32_t) (int8_t) x)\n#define sext_i8_i64(x) ((int64_t) (int8_t) x)\n#define sext_i16_i8(x) ((int8_t) (int16_t) x)\n#define sext_i16_i16(x) ((int16_t) (int16_t) x)\n#define sext_i16_i32(x) ((int32_t) (int16_t) x)\n#define sext_i16_i64(x) ((int64_t) (int16_t) x)\n#define sext_i32_i8(x) ((int8_t) (int32_t) x)\n#define sext_i32_i16(x) ((int16_t) (int32_t) x)\n#define sext_i32_i32(x) ((int32_t) (int32_t) x)\n#define sext_i32_i64(x) ((int64_t) (int32_t) x)\n#defi",
                   "ne sext_i64_i8(x) ((int8_t) (int64_t) x)\n#define sext_i64_i16(x) ((int16_t) (int64_t) x)\n#define sext_i64_i32(x) ((int32_t) (int64_t) x)\n#define sext_i64_i64(x) ((int64_t) (int64_t) x)\n#define zext_i8_i8(x) ((int8_t) (uint8_t) x)\n#define zext_i8_i16(x) ((int16_t) (uint8_t) x)\n#define zext_i8_i32(x) ((int32_t) (uint8_t) x)\n#define zext_i8_i64(x) ((int64_t) (uint8_t) x)\n#define zext_i16_i8(x) ((int8_t) (uint16_t) x)\n#define zext_i16_i16(x) ((int16_t) (uint16_t) x)\n#define zext_i16_i32(x) ((int32_t) (uint16_t) x)\n#define zext_i16_i64(x) ((int64_t) (uint16_t) x)\n#define zext_i32_i8(x) ((int8_t) (uint32_t) x)\n#define zext_i32_i16(x) ((int16_t) (uint32_t) x)\n#define zext_i32_i32(x) ((int32_t) (uint32_t) x)\n#define zext_i32_i64(x) ((int64_t) (uint32_t) x)\n#define zext_i64_i8(x) ((int8_t) (uint64_t) x)\n#define zext_i64_i16(x) ((int16_t) (uint64_t) x)\n#define zext_i64_i32(x) ((int32_t) (uint64_t) x)\n#define zext_i64_i64(x) ((int64_t) (uint64_t) x)\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_popc8(int8_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    return popcount(x);\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_popc8(int8_t x)\n{\n    return __popc(zext_i8_i32(x));\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    return __popc(zext_i16_i32(x));\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    return __popc(x);\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    return __popcll(x);\n}\n#else\nstatic int32_t futrts_popc8(int8_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    int c = 0;\n    \n    for ",
                   "(; x; ++c)\n        x &= x - 1;\n    return c;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    return mul_hi(a, b);\n}\n#elif defined(__CUDA_ARCH__)\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    uint16_t aa = a;\n    uint16_t bb = b;\n    \n    return aa * bb >> 8;\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    uint32_t aa = a;\n    uint32_t bb = b;\n    \n    return aa * bb >> 16;\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    return mulhi(a, b);\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    return mul64hi(a, b);\n}\n#else\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    uint16_t aa = a;\n    uint16_t bb = b;\n    \n    return aa * bb >> 8;\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    uint32_t aa = a;\n    uint32_t bb = b;\n    \n    return aa * bb >> 16;\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    uint64_t aa = a;\n    uint64_t bb = b;\n    \n    return aa * bb >> 32;\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    __uint128_t aa = a;\n    __uint128_t bb = b;\n    \n    return aa * bb >> 64;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)\n{\n    return mad_hi(a, b, c);\n}\n#else\nstatic uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)\n{\n    return futrts_mul_hi8(a, b) + c;\n}\nstatic uint16_t futrts_mad_hi16(uin",
                   "t16_t a, uint16_t b, uint16_t c)\n{\n    return futrts_mul_hi16(a, b) + c;\n}\nstatic uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)\n{\n    return futrts_mul_hi32(a, b) + c;\n}\nstatic uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)\n{\n    return futrts_mul_hi64(a, b) + c;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    return clz(x);\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    return __clz(zext_i8_i32(x)) - 24;\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    return __clz(zext_i16_i32(x)) - 16;\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    return __clz(x);\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    return __clzll(x);\n}\n#else\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    int i = 0;\n    \n    for (; i < 8 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz16(int16_t ",
                   "x)\n{\n    int i = 0;\n    \n    for (; i < 16 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    int i = 0;\n    \n    for (; i < 32 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    int i = 0;\n    \n    for (; i < 64 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 8 : y - 1;\n}\nstatic int32_t futrts_ctzz16(int16_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 16 : y - 1;\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 32 : y - 1;\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    int y = __ffsll(x);\n    \n    return y == 0 ? 64 : y - 1;\n}\n#else\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    return x == 0 ? 8 : __builtin_ctz((uint32_t) x);\n}\nstatic int32_t futrts_ctzz16(int16_t x)\n{\n    return x == 0 ? 16 : __builtin_ctz((uint32_t) x);\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    return x == 0 ? 32 : __builtin_ctz(x);\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    return x == 0 ? 64 : __builtin_ctzl(x);\n}\n#endif\nstatic inline float fdiv32(float x, float y)\n{\n    return x / y;\n}\nstatic inline float fadd32(float x, float y)\n{\n    return x + y;\n}\nstatic inline float fsub32(float x, float y)\n{\n    return x - y;\n}\nstatic inline float fmul32(float x, float y)\n{\n    return x * y;\n}\nstatic inline float fmin32(float x, float y)\n{\n    return fmin(x, y);\n}\nstatic inline float fmax32(float x, float y)\n{\n    return fmax(x, y);\n}\nstatic inline float fpow32(float x, float y)\n{\n    return pow(x, y);\n}\nstatic inline bool cmplt32(float x, float y)\n{\n    return x < y;\n}\nstatic inline bool cmple32(float x, float y)\n{\n    return x <= y;\n}\nstatic inline float sitofp_i8_f32(int8_t x)\n{\n    return (float) x;\n}\nstatic inline float sitofp_i16_f32(int16_t x)\n{\n    return (float) x;\n}\nstatic inline float sitofp_i32_f32(int32_t x)",
                   "\n{\n    return (float) x;\n}\nstatic inline float sitofp_i64_f32(int64_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i8_f32(uint8_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i16_f32(uint16_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i32_f32(uint32_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i64_f32(uint64_t x)\n{\n    return (float) x;\n}\nstatic inline int8_t fptosi_f32_i8(float x)\n{\n    return (int8_t) x;\n}\nstatic inline int16_t fptosi_f32_i16(float x)\n{\n    return (int16_t) x;\n}\nstatic inline int32_t fptosi_f32_i32(float x)\n{\n    return (int32_t) x;\n}\nstatic inline int64_t fptosi_f32_i64(float x)\n{\n    return (int64_t) x;\n}\nstatic inline uint8_t fptoui_f32_i8(float x)\n{\n    return (uint8_t) x;\n}\nstatic inline uint16_t fptoui_f32_i16(float x)\n{\n    return (uint16_t) x;\n}\nstatic inline uint32_t fptoui_f32_i32(float x)\n{\n    return (uint32_t) x;\n}\nstatic inline uint64_t fptoui_f32_i64(float x)\n{\n    return (uint64_t) x;\n}\nstatic inline float futrts_log32(float x)\n{\n    return log(x);\n}\nstatic inline float futrts_log2_32(float x)\n{\n    return log2(x);\n}\nstatic inline float futrts_log10_32(float x)\n{\n    return log10(x);\n}\nstatic inline float futrts_sqrt32(float x)\n{\n    return sqrt(x);\n}\nstatic inline float futrts_exp32(float x)\n{\n    return exp(x);\n}\nstatic inline float futrts_cos32(float x)\n{\n    return cos(x);\n}\nstatic inline float futrts_sin32(float x)\n{\n    return sin(x);\n}\nstatic inline float futrts_tan32(float x)\n{\n    return tan(x);\n}\nstatic inline float futrts_acos32(float x)\n{\n    return acos(x);\n}\nstatic inline float futrts_asin32(float x)\n{\n    return asin(x);\n}\nstatic inline float futrts_atan32(float x)\n{\n    return atan(x);\n}\nstatic inline float futrts_cosh32(float x)\n{\n    return cosh(x);\n}\nstatic inline float futrts_sinh32(float x)\n{\n    return sinh(x);\n}\nstatic inline float futrts_tanh32(float x)\n{\n    return tanh(x);\n}\nstatic inline float futrts_acosh32(float x)\n{\n    return acosh(x);\n}\nstatic inline fl",
                   "oat futrts_asinh32(float x)\n{\n    return asinh(x);\n}\nstatic inline float futrts_atanh32(float x)\n{\n    return atanh(x);\n}\nstatic inline float futrts_atan2_32(float x, float y)\n{\n    return atan2(x, y);\n}\nstatic inline float futrts_gamma32(float x)\n{\n    return tgamma(x);\n}\nstatic inline float futrts_lgamma32(float x)\n{\n    return lgamma(x);\n}\nstatic inline bool futrts_isnan32(float x)\n{\n    return isnan(x);\n}\nstatic inline bool futrts_isinf32(float x)\n{\n    return isinf(x);\n}\nstatic inline int32_t futrts_to_bits32(float x)\n{\n    union {\n        float f;\n        int32_t t;\n    } p;\n    \n    p.f = x;\n    return p.t;\n}\nstatic inline float futrts_from_bits32(int32_t x)\n{\n    union {\n        int32_t f;\n        float t;\n    } p;\n    \n    p.f = x;\n    return p.t;\n}\n#ifdef __OPENCL_VERSION__\nstatic inline float fmod32(float x, float y)\n{\n    return fmod(x, y);\n}\nstatic inline float futrts_round32(float x)\n{\n    return rint(x);\n}\nstatic inline float futrts_floor32(float x)\n{\n    return floor(x);\n}\nstatic inline float futrts_ceil32(float x)\n{\n    return ceil(x);\n}\nstatic inline float futrts_lerp32(float v0, float v1, float t)\n{\n    return mix(v0, v1, t);\n}\nstatic inline float futrts_mad32(float a, float b, float c)\n{\n    return mad(a, b, c);\n}\nstatic inline float futrts_fma32(float a, float b, float c)\n{\n    return fma(a, b, c);\n}\n#else\nstatic inline float fmod32(float x, float y)\n{\n    return fmodf(x, y);\n}\nstatic inline float futrts_round32(float x)\n{\n    return rintf(x);\n}\nstatic inline float futrts_floor32(float x)\n{\n    return floorf(x);\n}\nstatic inline float futrts_ceil32(float x)\n{\n    return ceilf(x);\n}\nstatic inline float futrts_lerp32(float v0, float v1, float t)\n{\n    return v0 + (v1 - v0) * t;\n}\nstatic inline float futrts_mad32(float a, float b, float c)\n{\n    return a * b + c;\n}\nstatic inline float futrts_fma32(float a, float b, float c)\n{\n    return fmaf(a, b, c);\n}\n#endif\n// Start of atomics.h\n\ninline int32_t atomic_add_i32_global(volatile __global int32_t *p, ",
                   "int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((int32_t*)p, x);\n#else\n  return atomic_add(p, x);\n#endif\n}\n\ninline int32_t atomic_add_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((int32_t*)p, x);\n#else\n  return atomic_add(p, x);\n#endif\n}\n\ninline float atomic_fadd_f32_global(volatile __global float *p, float x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((float*)p, x);\n#else\n  union { int32_t i; float f; } old;\n  union { int32_t i; float f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg((volatile __global int32_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\ninline float atomic_fadd_f32_local(volatile __local float *p, float x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((float*)p, x);\n#else\n  union { int32_t i; float f; } old;\n  union { int32_t i; float f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg((volatile __local int32_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\ninline int32_t atomic_smax_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline int32_t atomic_smax_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline int32_t atomic_smin_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline int32_t atomic_smin_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline uint32_t atomic_umax_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p",
                   ", x);\n#endif\n}\n\ninline uint32_t atomic_umax_i32_local(volatile __local uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline uint32_t atomic_umin_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline uint32_t atomic_umin_i32_local(volatile __local uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline int32_t atomic_and_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\ninline int32_t atomic_and_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\ninline int32_t atomic_or_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\ninline int32_t atomic_or_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\ninline int32_t atomic_xor_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xor_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xchg_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xchg_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t",
                   " atomic_cmpxchg_i32_global(volatile __global int32_t *p,\n                                         int32_t cmp, int32_t val) {\n#ifdef FUTHARK_CUDA\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\ninline int32_t atomic_cmpxchg_i32_local(volatile __local int32_t *p,\n                                         int32_t cmp, int32_t val) {\n#ifdef FUTHARK_CUDA\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\n// End of atomics.h\n\n\n\n\n__kernel void builtinzhreplicate_f32zireplicate_21178(__global\n                                                      unsigned char *mem_21174,\n                                                      int32_t num_elems_21175,\n                                                      float val_21176)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t replicate_gtid_21178;\n    int32_t replicate_ltid_21179;\n    int32_t replicate_gid_21180;\n    \n    replicate_gtid_21178 = get_global_id(0);\n    replicate_ltid_21179 = get_local_id(0);\n    replicate_gid_21180 = get_group_id(0);\n    if (slt64(replicate_gtid_21178, num_elems_21175)) {\n        ((__global float *) mem_21174)[sext_i32_i64(replicate_gtid_21178)] =\n            val_21176;\n    }\n    \n  error_0:\n    return;\n}\n__kernel void builtinzhreplicate_i64zireplicate_20769(__global\n                                                      unsigned char *mem_20765,\n                                                      int32_t num_elems_20766,\n                                                      int64_t val_20767)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t replicate_gtid_20769;\n    int32_t replicate_ltid_20770;\n    int32_t replicate_gid_20771;\n    \n    replicate_gtid_20769 = get_global_id(0);\n    replicate_ltid_20770 = get_local_id(0);\n    replicate_gid_20771 = get_group_id(0);\n    if (slt64(replicate_gtid_20769, nu",
                   "m_elems_20766)) {\n        ((__global int64_t *) mem_20765)[sext_i32_i64(replicate_gtid_20769)] =\n            val_20767;\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32(__local volatile\n                                    int64_t *block_9_backing_aligned_0,\n                                    int32_t destoffset_1, int32_t srcoffset_3,\n                                    int32_t num_arrays_4, int32_t x_elems_5,\n                                    int32_t y_elems_6, int32_t mulx_7,\n                                    int32_t muly_8, __global\n                                    unsigned char *destmem_0, __global\n                                    unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_global_id_0_37;\n    int32_t y_index_32 = get_group_id_1_41 * 32 + get_local_id_1_39;\n    \n    if (slt32(x_index_31, x_elems_5)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32",
                   "_t index_in_35 = (y_index_32 + j_43 * 8) * x_elems_5 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, y_elems_6)) {\n                ((__local float *) block_9)[sext_i32_i64((get_local_id_1_39 +\n                                                          j_43 * 8) * 33 +\n                                            get_local_id_0_38)] = ((__global\n                                                                    float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                       index_in_35)];\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 32 + get_local_id_0_38;\n    y_index_32 = get_group_id_0_40 * 32 + get_local_id_1_39;\n    if (slt32(x_index_31, y_elems_6)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_out_36 = (y_index_32 + j_43 * 8) * y_elems_6 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, x_elems_5)) {\n                ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                               index_out_36)] = ((__local\n                                                                  float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                    33 +\n                                                                                    get_local_id_1_39 +\n                                                                                    j_43 *\n                                                                                    8)];\n            }\n        }\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_low_height(__local volatile\n                                               int64_t *block_9_backing_aligned_0,\n                                               int32_t destoffset_1,\n                   ",
                   "                            int32_t srcoffset_3,\n                                               int32_t num_arrays_4,\n                                               int32_t x_elems_5,\n                                               int32_t y_elems_6,\n                                               int32_t mulx_7, int32_t muly_8,\n                                               __global\n                                               unsigned char *destmem_0,\n                                               __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_0_38 +\n            srem32(get_local_id_1_39, mulx_7) * 16;\n    int32_t y_index_32 = get_group_id_1_41 * 16 + squot32(get_local_id_1_39,\n                                                          mulx_7);\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(",
                   "y_index_32, y_elems_6)) {\n        ((__local float *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                    get_local_id_0_38)] = ((__global\n                                                            float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                               index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 + squot32(get_local_id_0_38, mulx_7);\n    y_index_32 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_1_39 +\n        srem32(get_local_id_0_38, mulx_7) * 16;\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__local\n                                                          float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                            17 +\n                                                                            get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_low_width(__local volatile\n                                              int64_t *block_9_backing_aligned_0,\n                                              int32_t destoffset_1,\n                                              int32_t srcoffset_3,\n                                              int32_t num_arrays_4,\n                                              int32_t x_elems_5,\n                                              int32_t y_elems_6, int32_t mulx_7,\n                                              int32_t muly_8, __global\n                                              unsigned char *destmem_0, __global\n                                              unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    co",
                   "nst int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 + squot32(get_local_id_0_38,\n                                                          muly_8);\n    int32_t y_index_32 = get_group_id_1_41 * 16 * muly_8 + get_local_id_1_39 +\n            srem32(get_local_id_0_38, muly_8) * 16;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local float *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                    get_local_id_0_38)] = ((__global\n                                                            float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                               index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 * muly_8 + get_local_id_0_38 +\n        srem32(get_local_id_1_39, muly_8) * 16;\n    y_index_32 = get_group_id_0_40 * 16 + squot32(get_local_id_1_39, muly_8",
                   ");\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__local\n                                                          float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                            17 +\n                                                                            get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_small(__local volatile\n                                          int64_t *block_9_backing_aligned_0,\n                                          int32_t destoffset_1,\n                                          int32_t srcoffset_3,\n                                          int32_t num_arrays_4,\n                                          int32_t x_elems_5, int32_t y_elems_6,\n                                          int32_t mulx_7, int32_t muly_8,\n                                          __global unsigned char *destmem_0,\n                                          __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    ",
                   "\n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = squot32(get_global_id_0_37, y_elems_6 *\n                                          x_elems_5) * (y_elems_6 * x_elems_5);\n    int32_t x_index_31 = squot32(srem32(get_global_id_0_37, y_elems_6 *\n                                        x_elems_5), y_elems_6);\n    int32_t y_index_32 = srem32(get_global_id_0_37, y_elems_6);\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    int32_t index_out_36 = x_index_31 * y_elems_6 + y_index_32;\n    \n    if (slt32(get_global_id_0_37, x_elems_5 * y_elems_6 * num_arrays_4)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__global\n                                                          float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                             index_in_35)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void mainzicopy_21191(int64_t n_17882, int64_t paths_17885,\n                               int64_t steps_17886, __global\n                               unsigned char *mem_20386, __global\n                               unsigned char *mem_20391)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_21191;\n    int32_t copy_ltid_21192;\n    int32_t copy_gid_21193;\n    \n    copy_gtid_21191 = get_global_id(0);\n    copy_ltid_21192 = get_local_id(0);\n    copy_gid_21193 = get_group_id(0);\n    if (slt64(sext_i32_i64(copy_gtid_21191), steps_17886 * paths_17885 *\n              n_17882)) {\n        ((__global float *) mem_20391)[squot64(sext_i32_i64(copy_gtid_21191),\n                                               paths_17885 * n_17882) *\n                          ",
                   "             (n_17882 * paths_17885) +\n                                       squot64(sext_i32_i64(copy_gtid_21191) -\n                                               squot64(sext_i32_i64(copy_gtid_21191),\n                                                       paths_17885 * n_17882) *\n                                               (paths_17885 * n_17882),\n                                               n_17882) * n_17882 +\n                                       (sext_i32_i64(copy_gtid_21191) -\n                                        squot64(sext_i32_i64(copy_gtid_21191),\n                                                paths_17885 * n_17882) *\n                                        (paths_17885 * n_17882) -\n                                        squot64(sext_i32_i64(copy_gtid_21191) -\n                                                squot64(sext_i32_i64(copy_gtid_21191),\n                                                        paths_17885 * n_17882) *\n                                                (paths_17885 * n_17882),\n                                                n_17882) * n_17882)] =\n            ((__global\n              float *) mem_20386)[squot64(sext_i32_i64(copy_gtid_21191) -\n                                          squot64(sext_i32_i64(copy_gtid_21191),\n                                                  paths_17885 * n_17882) *\n                                          (paths_17885 * n_17882), n_17882) *\n                                  (n_17882 * steps_17886) +\n                                  squot64(sext_i32_i64(copy_gtid_21191),\n                                          paths_17885 * n_17882) * n_17882 +\n                                  (sext_i32_i64(copy_gtid_21191) -\n                                   squot64(sext_i32_i64(copy_gtid_21191),\n                                           paths_17885 * n_17882) *\n                                   (paths_17885 * n_17882) -\n                                   squot64(sext_i32_i64(copy_gtid_21191) -\n        ",
                   "                                   squot64(sext_i32_i64(copy_gtid_21191),\n                                                   paths_17885 * n_17882) *\n                                           (paths_17885 * n_17882), n_17882) *\n                                   n_17882)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void mainzicopy_21228(int64_t n_17882, int64_t paths_17885,\n                               int64_t steps_17886, __global\n                               unsigned char *mem_20386, __global\n                               unsigned char *mem_20404)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_21228;\n    int32_t copy_ltid_21229;\n    int32_t copy_gid_21230;\n    \n    copy_gtid_21228 = get_global_id(0);\n    copy_ltid_21229 = get_local_id(0);\n    copy_gid_21230 = get_group_id(0);\n    if (slt64(sext_i32_i64(copy_gtid_21228), steps_17886 * paths_17885 *\n              n_17882)) {\n        ((__global float *) mem_20404)[squot64(sext_i32_i64(copy_gtid_21228),\n                                               paths_17885 * n_17882) *\n                                       (n_17882 * paths_17885) +\n                                       squot64(sext_i32_i64(copy_gtid_21228) -\n                                               squot64(sext_i32_i64(copy_gtid_21228),\n                                                       paths_17885 * n_17882) *\n                                               (paths_17885 * n_17882),\n                                               n_17882) * n_17882 +\n                                       (sext_i32_i64(copy_gtid_21228) -\n                                        squot64(sext_i32_i64(copy_gtid_21228),\n                                                paths_17885 * n_17882) *\n                                        (paths_17885 * n_17882) -\n                                        squot64(sext_i32_i64(copy_gtid_21228) -\n                                                squot64(sext_i32_i6",
                   "4(copy_gtid_21228),\n                                                        paths_17885 * n_17882) *\n                                                (paths_17885 * n_17882),\n                                                n_17882) * n_17882)] =\n            ((__global\n              float *) mem_20386)[squot64(sext_i32_i64(copy_gtid_21228) -\n                                          squot64(sext_i32_i64(copy_gtid_21228),\n                                                  paths_17885 * n_17882) *\n                                          (paths_17885 * n_17882), n_17882) *\n                                  (n_17882 * steps_17886) +\n                                  squot64(sext_i32_i64(copy_gtid_21228),\n                                          paths_17885 * n_17882) * n_17882 +\n                                  (sext_i32_i64(copy_gtid_21228) -\n                                   squot64(sext_i32_i64(copy_gtid_21228),\n                                           paths_17885 * n_17882) *\n                                   (paths_17885 * n_17882) -\n                                   squot64(sext_i32_i64(copy_gtid_21228) -\n                                           squot64(sext_i32_i64(copy_gtid_21228),\n                                                   paths_17885 * n_17882) *\n                                           (paths_17885 * n_17882), n_17882) *\n                                   n_17882)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void mainziscan_stage1_19505(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20692_backing_aligned_0,\n                                      int64_t n_17882, int64_t steps_17886,\n                                      int64_t one_intra_par_min_18814, __global\n                                      unsigned char *res_mem_20278, __global\n                                      unsigned char *res_mem_20279,\n                                      int",
                   "64_t binop_x_20308, __global\n                                      unsigned char *res_mem_20353, __global\n                                      unsigned char *mem_20356, __global\n                                      unsigned char *mem_20358,\n                                      int32_t num_threads_20686)\n{\n    #define segscan_group_sizze_19500 (mainzisegscan_group_sizze_19499)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20692_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20692_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20687;\n    int32_t local_tid_20688;\n    int64_t group_sizze_20691;\n    int32_t wave_sizze_20690;\n    int32_t group_tid_20689;\n    \n    global_tid_20687 = get_global_id(0);\n    local_tid_20688 = get_local_id(0);\n    group_sizze_20691 = get_local_size(0);\n    wave_sizze_20690 = LOCKSTEP_WIDTH;\n    group_tid_20689 = get_group_id(0);\n    \n    int32_t phys_tid_19505;\n    \n    phys_tid_19505 = global_tid_20687;\n    \n    __local char *scan_arr_mem_20692;\n    \n    scan_arr_mem_20692 = (__local char *) scan_arr_mem_20692_backing_0;\n    \n    int64_t x_18085;\n    int64_t x_18086;\n    \n    x_18085 = 0;\n    for (int64_t j_20694 = 0; j_20694 < sdiv_up64(binop_x_20308,\n                                                  sext_i32_i64(num_threads_20686));\n         j_20694++) {\n        int64_t chunk_offset_20695 = segscan_group_sizze_19500 * j_20694 +\n                sext_i32_i64(group_tid_20689) * (segscan_group_sizze_19500 *\n                                                 sdiv_up64(binop_x_20308,\n                                                           sext_i32_i64(num_threads_20686)));\n        int64_t flat_idx_20696 = chunk_offset_20695 +\n                sext_i32_i64(local_tid_20688);\n        int64_t gtid_19504 = flat_idx_20696;\n        \n        // threa",
                   "ds in bounds read input\n        {\n            if (slt64(gtid_19504, binop_x_20308)) {\n                int64_t binop_x_20072 = squot64(gtid_19504,\n                                                one_intra_par_min_18814);\n                int64_t binop_y_20074 = one_intra_par_min_18814 * binop_x_20072;\n                int64_t binop_x_20075 = gtid_19504 - binop_y_20074;\n                int64_t binop_x_20081 = squot64(binop_x_20075, n_17882);\n                int64_t binop_y_20082 = n_17882 * binop_x_20081;\n                int64_t new_index_20083 = binop_x_20075 - binop_y_20082;\n                int64_t x_18088 = ((__global\n                                    int64_t *) res_mem_20278)[new_index_20083];\n                float x_18089 = ((__global\n                                  float *) res_mem_20279)[new_index_20083];\n                float x_18090 = ((__global\n                                  float *) res_mem_20353)[binop_x_20072 *\n                                                          (n_17882 *\n                                                           steps_17886) +\n                                                          binop_x_20081 *\n                                                          n_17882 +\n                                                          new_index_20083];\n                float x_18091 = x_18090 / x_18089;\n                float ceil_arg_18092 = x_18091 - 1.0F;\n                float res_18093;\n                \n                res_18093 = futrts_ceil32(ceil_arg_18092);\n                \n                int64_t res_18094 = fptosi_f32_i64(res_18093);\n                int64_t max_arg_18095 = sub64(x_18088, res_18094);\n                int64_t res_18096 = smax64(0, max_arg_18095);\n                bool cond_18097 = res_18096 == 0;\n                int64_t res_18098;\n                \n                if (cond_18097) {\n                    res_18098 = 1;\n                } else {\n                    res_18098 = res_18096;\n                }\n                /",
                   "/ write to-scan values to parameters\n                {\n                    x_18086 = res_18098;\n                }\n                // write mapped values results to global memory\n                {\n                    ((__global int64_t *) mem_20358)[gtid_19504] = res_18098;\n                }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_19504, binop_x_20308)) {\n                    x_18086 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                int64_t res_18087 = add64(x_18085, x_18086);\n                \n                ((__local\n                  int64_t *) scan_arr_mem_20692)[sext_i32_i64(local_tid_20688)] =\n                    res_18087;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int64_t x_20697;\n            int64_t x_20698;\n            int64_t x_20700;\n            int64_t x_20701;\n            bool ltid_in_bounds_20703;\n            \n            ltid_in_bounds_20703 = slt64(sext_i32_i64(local_tid_20688),\n                                         segscan_group_sizze_19500);\n            \n            int32_t skip_threads_20704;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_20703) {\n                    x_20698 = ((volatile __local\n                                int64_t *) scan_arr_mem_20692)[sext_i32_i64(local_tid_20688)];\n                    if ((local_tid_20688 - squot32(local_tid_20688, 32) * 32) ==\n                        0) {\n                        x_20697 = x_20698;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_20704 = 1;\n                while (slt32(skip_threads_20704, 32)) {\n                    if (sle32(skip_threads_20704, local",
                   "_tid_20688 -\n                              squot32(local_tid_20688, 32) * 32) &&\n                        ltid_in_bounds_20703) {\n                        // read operands\n                        {\n                            x_20697 = ((volatile __local\n                                        int64_t *) scan_arr_mem_20692)[sext_i32_i64(local_tid_20688) -\n                                                                       sext_i32_i64(skip_threads_20704)];\n                        }\n                        // perform operation\n                        {\n                            int64_t res_20699 = add64(x_20697, x_20698);\n                            \n                            x_20697 = res_20699;\n                        }\n                    }\n                    if (sle32(wave_sizze_20690, skip_threads_20704)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_20704, local_tid_20688 -\n                              squot32(local_tid_20688, 32) * 32) &&\n                        ltid_in_bounds_20703) {\n                        // write result\n                        {\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_20692)[sext_i32_i64(local_tid_20688)] =\n                                x_20697;\n                            x_20698 = x_20697;\n                        }\n                    }\n                    if (sle32(wave_sizze_20690, skip_threads_20704)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_20704 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_20688 - squot32(local_tid_20688, 32) * 32) ==\n                    31 && ltid_in_bounds_20703) {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_2069",
                   "2)[sext_i32_i64(squot32(local_tid_20688,\n                                                                          32))] =\n                        x_20697;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_20705;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_20688, 32) == 0 &&\n                        ltid_in_bounds_20703) {\n                        x_20701 = ((volatile __local\n                                    int64_t *) scan_arr_mem_20692)[sext_i32_i64(local_tid_20688)];\n                        if ((local_tid_20688 - squot32(local_tid_20688, 32) *\n                             32) == 0) {\n                            x_20700 = x_20701;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_20705 = 1;\n                    while (slt32(skip_threads_20705, 32)) {\n                        if (sle32(skip_threads_20705, local_tid_20688 -\n                                  squot32(local_tid_20688, 32) * 32) &&\n                            (squot32(local_tid_20688, 32) == 0 &&\n                             ltid_in_bounds_20703)) {\n                            // read operands\n                            {\n                                x_20700 = ((volatile __local\n                                            int64_t *) scan_arr_mem_20692)[sext_i32_i64(local_tid_20688) -\n                                                                           sext_i32_i64(skip_threads_20705)];\n                            }\n                            // perform operation\n                            {\n                                int64_t res_20702 = add64(x_20700, x_20701);\n                                \n                    ",
                   "            x_20700 = res_20702;\n                            }\n                        }\n                        if (sle32(wave_sizze_20690, skip_threads_20705)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_20705, local_tid_20688 -\n                                  squot32(local_tid_20688, 32) * 32) &&\n                            (squot32(local_tid_20688, 32) == 0 &&\n                             ltid_in_bounds_20703)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_20692)[sext_i32_i64(local_tid_20688)] =\n                                    x_20700;\n                                x_20701 = x_20700;\n                            }\n                        }\n                        if (sle32(wave_sizze_20690, skip_threads_20705)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_20705 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_20688, 32) == 0 ||\n                      !ltid_in_bounds_20703)) {\n                    // read operands\n                    {\n                        x_20698 = x_20697;\n                        x_20697 = ((__local\n                                    int64_t *) scan_arr_mem_20692)[sext_i32_i64(squot32(local_tid_20688,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_20699 = add64(x_20697, x_20698);\n                        \n                        x_20697 = r",
                   "es_20699;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          int64_t *) scan_arr_mem_20692)[sext_i32_i64(local_tid_20688)] =\n                            x_20697;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_20688, 32) == 0) {\n                    ((__local\n                      int64_t *) scan_arr_mem_20692)[sext_i32_i64(local_tid_20688)] =\n                        x_20698;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_19504, binop_x_20308)) {\n                    ((__global int64_t *) mem_20356)[gtid_19504] = ((__local\n                                                                     int64_t *) scan_arr_mem_20692)[sext_i32_i64(local_tid_20688)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_20706 = 0;\n                bool should_load_carry_20707 = local_tid_20688 == 0 &&\n                     !crosses_segment_20706;\n                \n                if (should_load_carry_20707) {\n                    x_18085 = ((__local\n                                int64_t *) scan_arr_mem_20692)[segscan_group_sizze_19500 -\n                                                               1];\n                }\n                if (!should_load_carry_20707) {\n                    x_18085 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_19500\n}\n__kernel void mainziscan_stage1_19538(__global int *global_failure,\n                                      __local",
                   " volatile\n                                      int64_t *scan_arr_mem_20933_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20931_backing_aligned_1,\n                                      int64_t res_18101, __global\n                                      unsigned char *mem_20363, __global\n                                      unsigned char *mem_20367, __global\n                                      unsigned char *mem_20369,\n                                      int32_t num_threads_20925)\n{\n    #define segscan_group_sizze_19533 (mainzisegscan_group_sizze_19532)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20933_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_20933_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_20931_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20931_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20926;\n    int32_t local_tid_20927;\n    int64_t group_sizze_20930;\n    int32_t wave_sizze_20929;\n    int32_t group_tid_20928;\n    \n    global_tid_20926 = get_global_id(0);\n    local_tid_20927 = get_local_id(0);\n    group_sizze_20930 = get_local_size(0);\n    wave_sizze_20929 = LOCKSTEP_WIDTH;\n    group_tid_20928 = get_group_id(0);\n    \n    int32_t phys_tid_19538;\n    \n    phys_tid_19538 = global_tid_20926;\n    \n    __local char *scan_arr_mem_20931;\n    __local char *scan_arr_mem_20933;\n    \n    scan_arr_mem_20931 = (__local char *) scan_arr_mem_20931_backing_0;\n    scan_arr_mem_20933 = (__local char *) scan_arr_mem_20933_backing_1;\n    \n    bool x_18120;\n    int64_t x_18121;\n    bool x_18122;\n    int64_t x_18123;\n    \n    x_18120 = 0;\n    x_18121 = 0;\n    for (int64_t j_20935 = 0; j_20935 < sdiv_up",
                   "64(res_18101,\n                                                  sext_i32_i64(num_threads_20925));\n         j_20935++) {\n        int64_t chunk_offset_20936 = segscan_group_sizze_19533 * j_20935 +\n                sext_i32_i64(group_tid_20928) * (segscan_group_sizze_19533 *\n                                                 sdiv_up64(res_18101,\n                                                           sext_i32_i64(num_threads_20925)));\n        int64_t flat_idx_20937 = chunk_offset_20936 +\n                sext_i32_i64(local_tid_20927);\n        int64_t gtid_19537 = flat_idx_20937;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_19537, res_18101)) {\n                int64_t x_18127 = ((__global int64_t *) mem_20363)[gtid_19537];\n                bool res_18128 = slt64(0, x_18127);\n                \n                // write to-scan values to parameters\n                {\n                    x_18122 = res_18128;\n                    x_18123 = x_18127;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_19537, res_18101)) {\n                    x_18122 = 0;\n                    x_18123 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                bool res_18124 = x_18120 || x_18122;\n                int64_t res_18125;\n                \n                if (x_18122) {\n                    res_18125 = x_18123;\n                } else {\n                    int64_t res_18126 = add64(x_18121, x_18123);\n                    \n                    res_18125 = res_18126;\n                }\n                ((__local\n                  bool *) scan_arr_mem_20931)[sext_i32_i64(local_tid_20927)] =\n                    res_18124;\n                ((__local",
                   "\n                  int64_t *) scan_arr_mem_20933)[sext_i32_i64(local_tid_20927)] =\n                    res_18125;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_20938;\n            int64_t x_20939;\n            bool x_20940;\n            int64_t x_20941;\n            bool x_20945;\n            int64_t x_20946;\n            bool x_20947;\n            int64_t x_20948;\n            bool ltid_in_bounds_20952;\n            \n            ltid_in_bounds_20952 = slt64(sext_i32_i64(local_tid_20927),\n                                         segscan_group_sizze_19533);\n            \n            int32_t skip_threads_20953;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_20952) {\n                    x_20940 = ((volatile __local\n                                bool *) scan_arr_mem_20931)[sext_i32_i64(local_tid_20927)];\n                    x_20941 = ((volatile __local\n                                int64_t *) scan_arr_mem_20933)[sext_i32_i64(local_tid_20927)];\n                    if ((local_tid_20927 - squot32(local_tid_20927, 32) * 32) ==\n                        0) {\n                        x_20938 = x_20940;\n                        x_20939 = x_20941;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_20953 = 1;\n                while (slt32(skip_threads_20953, 32)) {\n                    if (sle32(skip_threads_20953, local_tid_20927 -\n                              squot32(local_tid_20927, 32) * 32) &&\n                        ltid_in_bounds_20952) {\n                        // read operands\n                        {\n                            x_20938 = ((volatile __local\n                                        bool *) scan_arr_mem_20931)[sext_i32_i64(local_tid_20927) -\n                                                                    sext_i32_i64(skip_threads_20953)];\n                    ",
                   "        x_20939 = ((volatile __local\n                                        int64_t *) scan_arr_mem_20933)[sext_i32_i64(local_tid_20927) -\n                                                                       sext_i32_i64(skip_threads_20953)];\n                        }\n                        // perform operation\n                        {\n                            bool res_20942 = x_20938 || x_20940;\n                            int64_t res_20943;\n                            \n                            if (x_20940) {\n                                res_20943 = x_20941;\n                            } else {\n                                int64_t res_20944 = add64(x_20939, x_20941);\n                                \n                                res_20943 = res_20944;\n                            }\n                            x_20938 = res_20942;\n                            x_20939 = res_20943;\n                        }\n                    }\n                    if (sle32(wave_sizze_20929, skip_threads_20953)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_20953, local_tid_20927 -\n                              squot32(local_tid_20927, 32) * 32) &&\n                        ltid_in_bounds_20952) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_20931)[sext_i32_i64(local_tid_20927)] =\n                                x_20938;\n                            x_20940 = x_20938;\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_20933)[sext_i32_i64(local_tid_20927)] =\n                                x_20939;\n                            x_20941 = x_20939;\n                        }\n                    }\n                    if (sle32(wave_sizze_20929, skip_threads_20953)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                 ",
                   "   }\n                    skip_threads_20953 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_20927 - squot32(local_tid_20927, 32) * 32) ==\n                    31 && ltid_in_bounds_20952) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_20931)[sext_i32_i64(squot32(local_tid_20927,\n                                                                       32))] =\n                        x_20938;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_20933)[sext_i32_i64(squot32(local_tid_20927,\n                                                                          32))] =\n                        x_20939;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_20954;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_20927, 32) == 0 &&\n                        ltid_in_bounds_20952) {\n                        x_20947 = ((volatile __local\n                                    bool *) scan_arr_mem_20931)[sext_i32_i64(local_tid_20927)];\n                        x_20948 = ((volatile __local\n                                    int64_t *) scan_arr_mem_20933)[sext_i32_i64(local_tid_20927)];\n                        if ((local_tid_20927 - squot32(local_tid_20927, 32) *\n                             32) == 0) {\n                            x_20945 = x_20947;\n                            x_20946 = x_20948;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_20954 = 1;\n                    while (slt32(skip_threads_20954, 32",
                   ")) {\n                        if (sle32(skip_threads_20954, local_tid_20927 -\n                                  squot32(local_tid_20927, 32) * 32) &&\n                            (squot32(local_tid_20927, 32) == 0 &&\n                             ltid_in_bounds_20952)) {\n                            // read operands\n                            {\n                                x_20945 = ((volatile __local\n                                            bool *) scan_arr_mem_20931)[sext_i32_i64(local_tid_20927) -\n                                                                        sext_i32_i64(skip_threads_20954)];\n                                x_20946 = ((volatile __local\n                                            int64_t *) scan_arr_mem_20933)[sext_i32_i64(local_tid_20927) -\n                                                                           sext_i32_i64(skip_threads_20954)];\n                            }\n                            // perform operation\n                            {\n                                bool res_20949 = x_20945 || x_20947;\n                                int64_t res_20950;\n                                \n                                if (x_20947) {\n                                    res_20950 = x_20948;\n                                } else {\n                                    int64_t res_20951 = add64(x_20946, x_20948);\n                                    \n                                    res_20950 = res_20951;\n                                }\n                                x_20945 = res_20949;\n                                x_20946 = res_20950;\n                            }\n                        }\n                        if (sle32(wave_sizze_20929, skip_threads_20954)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_20954, local_tid_20927 -\n                                  squot32(local_tid_20927, 32) * 32) &&\n                       ",
                   "     (squot32(local_tid_20927, 32) == 0 &&\n                             ltid_in_bounds_20952)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_20931)[sext_i32_i64(local_tid_20927)] =\n                                    x_20945;\n                                x_20947 = x_20945;\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_20933)[sext_i32_i64(local_tid_20927)] =\n                                    x_20946;\n                                x_20948 = x_20946;\n                            }\n                        }\n                        if (sle32(wave_sizze_20929, skip_threads_20954)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_20954 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_20927, 32) == 0 ||\n                      !ltid_in_bounds_20952)) {\n                    // read operands\n                    {\n                        x_20940 = x_20938;\n                        x_20941 = x_20939;\n                        x_20938 = ((__local\n                                    bool *) scan_arr_mem_20931)[sext_i32_i64(squot32(local_tid_20927,\n                                                                                     32)) -\n                                                                1];\n                        x_20939 = ((__local\n                                    int64_t *) scan_arr_mem_20933)[sext_i32_i64(squot32(local_tid_20927,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                ",
                   "    // perform operation\n                    {\n                        bool res_20942 = x_20938 || x_20940;\n                        int64_t res_20943;\n                        \n                        if (x_20940) {\n                            res_20943 = x_20941;\n                        } else {\n                            int64_t res_20944 = add64(x_20939, x_20941);\n                            \n                            res_20943 = res_20944;\n                        }\n                        x_20938 = res_20942;\n                        x_20939 = res_20943;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_20931)[sext_i32_i64(local_tid_20927)] =\n                            x_20938;\n                        ((__local\n                          int64_t *) scan_arr_mem_20933)[sext_i32_i64(local_tid_20927)] =\n                            x_20939;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_20927, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_20931)[sext_i32_i64(local_tid_20927)] =\n                        x_20940;\n                    ((__local\n                      int64_t *) scan_arr_mem_20933)[sext_i32_i64(local_tid_20927)] =\n                        x_20941;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_19537, res_18101)) {\n                    ((__global bool *) mem_20367)[gtid_19537] = ((__local\n                                                                  bool *) scan_arr_mem_20931)[sext_i32_i64(local_tid_20927)];\n                    ((__global int64_t *) mem_20369)[gtid_19537] = ((__local\n                                     ",
                   "                                int64_t *) scan_arr_mem_20933)[sext_i32_i64(local_tid_20927)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_20955 = 0;\n                bool should_load_carry_20956 = local_tid_20927 == 0 &&\n                     !crosses_segment_20955;\n                \n                if (should_load_carry_20956) {\n                    x_18120 = ((__local\n                                bool *) scan_arr_mem_20931)[segscan_group_sizze_19533 -\n                                                            1];\n                    x_18121 = ((__local\n                                int64_t *) scan_arr_mem_20933)[segscan_group_sizze_19533 -\n                                                               1];\n                }\n                if (!should_load_carry_20956) {\n                    x_18120 = 0;\n                    x_18121 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_19533\n}\n__kernel void mainziscan_stage1_19546(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_21000_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20998_backing_aligned_1,\n                                      int64_t res_18101, __global\n                                      unsigned char *mem_20369, __global\n                                      unsigned char *mem_20372, __global\n                                      unsigned char *mem_20374, __global\n                                      unsigned char *mem_20376,\n                                      int32_t num_threads_20992)\n{\n    #define segscan_group_sizze_19541 (mainzisegscan_group_sizze_195",
                   "40)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_21000_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_21000_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_20998_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20998_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20993;\n    int32_t local_tid_20994;\n    int64_t group_sizze_20997;\n    int32_t wave_sizze_20996;\n    int32_t group_tid_20995;\n    \n    global_tid_20993 = get_global_id(0);\n    local_tid_20994 = get_local_id(0);\n    group_sizze_20997 = get_local_size(0);\n    wave_sizze_20996 = LOCKSTEP_WIDTH;\n    group_tid_20995 = get_group_id(0);\n    \n    int32_t phys_tid_19546;\n    \n    phys_tid_19546 = global_tid_20993;\n    \n    __local char *scan_arr_mem_20998;\n    __local char *scan_arr_mem_21000;\n    \n    scan_arr_mem_20998 = (__local char *) scan_arr_mem_20998_backing_0;\n    scan_arr_mem_21000 = (__local char *) scan_arr_mem_21000_backing_1;\n    \n    bool x_18160;\n    int64_t x_18161;\n    bool x_18162;\n    int64_t x_18163;\n    \n    x_18160 = 0;\n    x_18161 = 0;\n    for (int64_t j_21002 = 0; j_21002 < sdiv_up64(res_18101,\n                                                  sext_i32_i64(num_threads_20992));\n         j_21002++) {\n        int64_t chunk_offset_21003 = segscan_group_sizze_19541 * j_21002 +\n                sext_i32_i64(group_tid_20995) * (segscan_group_sizze_19541 *\n                                                 sdiv_up64(res_18101,\n                                                           sext_i32_i64(num_threads_20992)));\n        int64_t flat_idx_21004 = chunk_offset_21003 +\n                sext_i32_i64(local_tid_20994);\n        int64_t gtid_19545 = flat_idx_21004;\n        \n        // threads in bounds read input\n        {\n     ",
                   "       if (slt64(gtid_19545, res_18101)) {\n                int64_t x_18167 = ((__global int64_t *) mem_20369)[gtid_19545];\n                int64_t i_p_o_20132 = add64(-1, gtid_19545);\n                int64_t rot_i_20133 = smod64(i_p_o_20132, res_18101);\n                int64_t x_18168 = ((__global int64_t *) mem_20369)[rot_i_20133];\n                bool res_18170 = x_18167 == x_18168;\n                bool res_18171 = !res_18170;\n                \n                // write to-scan values to parameters\n                {\n                    x_18162 = res_18171;\n                    x_18163 = 1;\n                }\n                // write mapped values results to global memory\n                {\n                    ((__global bool *) mem_20376)[gtid_19545] = res_18171;\n                }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_19545, res_18101)) {\n                    x_18162 = 0;\n                    x_18163 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                bool res_18164 = x_18160 || x_18162;\n                int64_t res_18165;\n                \n                if (x_18162) {\n                    res_18165 = x_18163;\n                } else {\n                    int64_t res_18166 = add64(x_18161, x_18163);\n                    \n                    res_18165 = res_18166;\n                }\n                ((__local\n                  bool *) scan_arr_mem_20998)[sext_i32_i64(local_tid_20994)] =\n                    res_18164;\n                ((__local\n                  int64_t *) scan_arr_mem_21000)[sext_i32_i64(local_tid_20994)] =\n                    res_18165;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_21005;\n            int64_t x_21006;\n            bool x_21007;\n            int64_t x_21008;\n          ",
                   "  bool x_21012;\n            int64_t x_21013;\n            bool x_21014;\n            int64_t x_21015;\n            bool ltid_in_bounds_21019;\n            \n            ltid_in_bounds_21019 = slt64(sext_i32_i64(local_tid_20994),\n                                         segscan_group_sizze_19541);\n            \n            int32_t skip_threads_21020;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_21019) {\n                    x_21007 = ((volatile __local\n                                bool *) scan_arr_mem_20998)[sext_i32_i64(local_tid_20994)];\n                    x_21008 = ((volatile __local\n                                int64_t *) scan_arr_mem_21000)[sext_i32_i64(local_tid_20994)];\n                    if ((local_tid_20994 - squot32(local_tid_20994, 32) * 32) ==\n                        0) {\n                        x_21005 = x_21007;\n                        x_21006 = x_21008;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_21020 = 1;\n                while (slt32(skip_threads_21020, 32)) {\n                    if (sle32(skip_threads_21020, local_tid_20994 -\n                              squot32(local_tid_20994, 32) * 32) &&\n                        ltid_in_bounds_21019) {\n                        // read operands\n                        {\n                            x_21005 = ((volatile __local\n                                        bool *) scan_arr_mem_20998)[sext_i32_i64(local_tid_20994) -\n                                                                    sext_i32_i64(skip_threads_21020)];\n                            x_21006 = ((volatile __local\n                                        int64_t *) scan_arr_mem_21000)[sext_i32_i64(local_tid_20994) -\n                                                                       sext_i32_i64(skip_threads_21020)];\n                        }\n                        // perf",
                   "orm operation\n                        {\n                            bool res_21009 = x_21005 || x_21007;\n                            int64_t res_21010;\n                            \n                            if (x_21007) {\n                                res_21010 = x_21008;\n                            } else {\n                                int64_t res_21011 = add64(x_21006, x_21008);\n                                \n                                res_21010 = res_21011;\n                            }\n                            x_21005 = res_21009;\n                            x_21006 = res_21010;\n                        }\n                    }\n                    if (sle32(wave_sizze_20996, skip_threads_21020)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_21020, local_tid_20994 -\n                              squot32(local_tid_20994, 32) * 32) &&\n                        ltid_in_bounds_21019) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_20998)[sext_i32_i64(local_tid_20994)] =\n                                x_21005;\n                            x_21007 = x_21005;\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_21000)[sext_i32_i64(local_tid_20994)] =\n                                x_21006;\n                            x_21008 = x_21006;\n                        }\n                    }\n                    if (sle32(wave_sizze_20996, skip_threads_21020)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_21020 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_20994 - squot32(local_tid_20994, 32) * 32) ==\n                ",
                   "    31 && ltid_in_bounds_21019) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_20998)[sext_i32_i64(squot32(local_tid_20994,\n                                                                       32))] =\n                        x_21005;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_21000)[sext_i32_i64(squot32(local_tid_20994,\n                                                                          32))] =\n                        x_21006;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_21021;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_20994, 32) == 0 &&\n                        ltid_in_bounds_21019) {\n                        x_21014 = ((volatile __local\n                                    bool *) scan_arr_mem_20998)[sext_i32_i64(local_tid_20994)];\n                        x_21015 = ((volatile __local\n                                    int64_t *) scan_arr_mem_21000)[sext_i32_i64(local_tid_20994)];\n                        if ((local_tid_20994 - squot32(local_tid_20994, 32) *\n                             32) == 0) {\n                            x_21012 = x_21014;\n                            x_21013 = x_21015;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_21021 = 1;\n                    while (slt32(skip_threads_21021, 32)) {\n                        if (sle32(skip_threads_21021, local_tid_20994 -\n                                  squot32(local_tid_20994, 32) * 32) &&\n                            (squot32(local_tid_20994, 32) == 0 &&\n                             ltid_in_bounds_21019)) {\n                            // rea",
                   "d operands\n                            {\n                                x_21012 = ((volatile __local\n                                            bool *) scan_arr_mem_20998)[sext_i32_i64(local_tid_20994) -\n                                                                        sext_i32_i64(skip_threads_21021)];\n                                x_21013 = ((volatile __local\n                                            int64_t *) scan_arr_mem_21000)[sext_i32_i64(local_tid_20994) -\n                                                                           sext_i32_i64(skip_threads_21021)];\n                            }\n                            // perform operation\n                            {\n                                bool res_21016 = x_21012 || x_21014;\n                                int64_t res_21017;\n                                \n                                if (x_21014) {\n                                    res_21017 = x_21015;\n                                } else {\n                                    int64_t res_21018 = add64(x_21013, x_21015);\n                                    \n                                    res_21017 = res_21018;\n                                }\n                                x_21012 = res_21016;\n                                x_21013 = res_21017;\n                            }\n                        }\n                        if (sle32(wave_sizze_20996, skip_threads_21021)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_21021, local_tid_20994 -\n                                  squot32(local_tid_20994, 32) * 32) &&\n                            (squot32(local_tid_20994, 32) == 0 &&\n                             ltid_in_bounds_21019)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_20998)[sext_i32_i64(local_",
                   "tid_20994)] =\n                                    x_21012;\n                                x_21014 = x_21012;\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_21000)[sext_i32_i64(local_tid_20994)] =\n                                    x_21013;\n                                x_21015 = x_21013;\n                            }\n                        }\n                        if (sle32(wave_sizze_20996, skip_threads_21021)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_21021 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_20994, 32) == 0 ||\n                      !ltid_in_bounds_21019)) {\n                    // read operands\n                    {\n                        x_21007 = x_21005;\n                        x_21008 = x_21006;\n                        x_21005 = ((__local\n                                    bool *) scan_arr_mem_20998)[sext_i32_i64(squot32(local_tid_20994,\n                                                                                     32)) -\n                                                                1];\n                        x_21006 = ((__local\n                                    int64_t *) scan_arr_mem_21000)[sext_i32_i64(squot32(local_tid_20994,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        bool res_21009 = x_21005 || x_21007;\n                        int64_t res_21010;\n                        \n                        if (x_21007) {\n                            res_21010 = x_21008;\n                        } else {\n      ",
                   "                      int64_t res_21011 = add64(x_21006, x_21008);\n                            \n                            res_21010 = res_21011;\n                        }\n                        x_21005 = res_21009;\n                        x_21006 = res_21010;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_20998)[sext_i32_i64(local_tid_20994)] =\n                            x_21005;\n                        ((__local\n                          int64_t *) scan_arr_mem_21000)[sext_i32_i64(local_tid_20994)] =\n                            x_21006;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_20994, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_20998)[sext_i32_i64(local_tid_20994)] =\n                        x_21007;\n                    ((__local\n                      int64_t *) scan_arr_mem_21000)[sext_i32_i64(local_tid_20994)] =\n                        x_21008;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_19545, res_18101)) {\n                    ((__global bool *) mem_20372)[gtid_19545] = ((__local\n                                                                  bool *) scan_arr_mem_20998)[sext_i32_i64(local_tid_20994)];\n                    ((__global int64_t *) mem_20374)[gtid_19545] = ((__local\n                                                                     int64_t *) scan_arr_mem_21000)[sext_i32_i64(local_tid_20994)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_21022",
                   " = 0;\n                bool should_load_carry_21023 = local_tid_20994 == 0 &&\n                     !crosses_segment_21022;\n                \n                if (should_load_carry_21023) {\n                    x_18160 = ((__local\n                                bool *) scan_arr_mem_20998)[segscan_group_sizze_19541 -\n                                                            1];\n                    x_18161 = ((__local\n                                int64_t *) scan_arr_mem_21000)[segscan_group_sizze_19541 -\n                                                               1];\n                }\n                if (!should_load_carry_21023) {\n                    x_18160 = 0;\n                    x_18161 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_19541\n}\n__kernel void mainziscan_stage1_19554(__global int *global_failure,\n                                      int failure_is_an_option, __global\n                                      int64_t *global_failure_args,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_21067_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_21065_backing_aligned_1,\n                                      int64_t n_17882, int64_t steps_17886,\n                                      float a_17890, float b_17891,\n                                      float sigma_17892, int64_t res_18101,\n                                      int64_t one_intra_par_min_18814, __global\n                                      unsigned char *res_mem_20276, __global\n                                      unsigned char *res_mem_20277, __global\n                                      unsigned char *res_mem_20278, __global\n                                      unsigned char *res_mem_20279,\n                                      int64_t b",
                   "inop_x_20308, __global\n                                      unsigned char *res_mem_20352, __global\n                                      unsigned char *res_mem_20353, __global\n                                      unsigned char *mem_20369, __global\n                                      unsigned char *mem_20374, __global\n                                      unsigned char *mem_20376, __global\n                                      unsigned char *mem_20379, __global\n                                      unsigned char *mem_20381,\n                                      int32_t num_threads_21059)\n{\n    #define segscan_group_sizze_19549 (mainzisegscan_group_sizze_19548)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_21067_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_21067_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_21065_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_21065_backing_aligned_1;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_21060;\n    int32_t local_tid_21061;\n    int64_t group_sizze_21064;\n    int32_t wave_sizze_21063;\n    int32_t group_tid_21062;\n    \n    global_tid_21060 = get_global_id(0);\n    local_tid_21061 = get_local_id(0);\n    group_sizze_21064 = get_local_size(0);\n    wave_sizze_21063 = LOCKSTEP_WIDTH;\n    group_tid_21062 = get_group_id(0);\n    \n    int32_t phys_tid_19554;\n    \n    phys_tid_19554 = global_tid_21060;\n    \n    __local char *scan_arr_mem_21065;\n    __local char *scan_arr_mem_21067;\n    \n    scan_arr_mem_21065 = (__local char *) scan_arr_mem_21065_backing_0;\n    scan_arr_mem_21067 = (__local",
                   " char *) scan_arr_mem_21067_backing_1;\n    \n    bool x_18186;\n    float x_18187;\n    bool x_18188;\n    float x_18189;\n    \n    x_18186 = 0;\n    x_18187 = 0.0F;\n    for (int64_t j_21069 = 0; j_21069 < sdiv_up64(res_18101,\n                                                  sext_i32_i64(num_threads_21059));\n         j_21069++) {\n        int64_t chunk_offset_21070 = segscan_group_sizze_19549 * j_21069 +\n                sext_i32_i64(group_tid_21062) * (segscan_group_sizze_19549 *\n                                                 sdiv_up64(res_18101,\n                                                           sext_i32_i64(num_threads_21059)));\n        int64_t flat_idx_21071 = chunk_offset_21070 +\n                sext_i32_i64(local_tid_21061);\n        int64_t gtid_19553 = flat_idx_21071;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_19553, res_18101)) {\n                int64_t x_18194 = ((__global int64_t *) mem_20374)[gtid_19553];\n                int64_t x_18195 = ((__global int64_t *) mem_20369)[gtid_19553];\n                bool x_18196 = ((__global bool *) mem_20376)[gtid_19553];\n                int64_t res_18199 = sub64(x_18194, 1);\n                bool x_18200 = sle64(0, x_18195);\n                bool y_18201 = slt64(x_18195, binop_x_20308);\n                bool bounds_check_18202 = x_18200 && y_18201;\n                bool index_certs_18203;\n                \n                if (!bounds_check_18202) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 10) ==\n                            -1) {\n                            global_failure_args[0] = x_18195;\n                            global_failure_args[1] = binop_x_20308;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int64_t new_index_18204 = squot64(x_18195,\n                  ",
                   "                                one_intra_par_min_18814);\n                int64_t binop_y_18205 = new_index_18204 *\n                        one_intra_par_min_18814;\n                int64_t binop_x_18206 = x_18195 - binop_y_18205;\n                int64_t new_index_18207 = squot64(binop_x_18206, n_17882);\n                int64_t binop_y_18208 = n_17882 * new_index_18207;\n                int64_t new_index_18209 = binop_x_18206 - binop_y_18208;\n                int64_t lifted_0_get_arg_18213 = ((__global\n                                                   int64_t *) res_mem_20278)[new_index_18209];\n                float lifted_0_get_arg_18214 = ((__global\n                                                 float *) res_mem_20279)[new_index_18209];\n                float lifted_0_get_arg_18215 = ((__global\n                                                 float *) res_mem_20353)[new_index_18204 *\n                                                                         (n_17882 *\n                                                                          steps_17886) +\n                                                                         new_index_18207 *\n                                                                         n_17882 +\n                                                                         new_index_18209];\n                float x_18216 = lifted_0_get_arg_18215 / lifted_0_get_arg_18214;\n                float ceil_arg_18217 = x_18216 - 1.0F;\n                float res_18218;\n                \n                res_18218 = futrts_ceil32(ceil_arg_18217);\n                \n                int64_t res_18219 = fptosi_f32_i64(res_18218);\n                int64_t max_arg_18220 = sub64(lifted_0_get_arg_18213,\n                                              res_18219);\n                int64_t res_18221 = smax64(0, max_arg_18220);\n                bool cond_18222 = res_18221 == 0;\n                float res_18223;\n                \n                if (cond_18222) {\n               ",
                   "     res_18223 = 0.0F;\n                } else {\n                    float lifted_0_get_arg_18210 = ((__global\n                                                     float *) res_mem_20352)[new_index_18204 *\n                                                                             (n_17882 *\n                                                                              steps_17886) +\n                                                                             new_index_18207 *\n                                                                             n_17882 +\n                                                                             new_index_18209];\n                    float lifted_0_get_arg_18211 = ((__global\n                                                     float *) res_mem_20276)[new_index_18209];\n                    float lifted_0_get_arg_18212 = ((__global\n                                                     float *) res_mem_20277)[new_index_18209];\n                    float res_18224;\n                    \n                    res_18224 = futrts_ceil32(x_18216);\n                    \n                    float start_18225 = lifted_0_get_arg_18214 * res_18224;\n                    float res_18226;\n                    \n                    res_18226 = futrts_ceil32(ceil_arg_18217);\n                    \n                    int64_t res_18227 = fptosi_f32_i64(res_18226);\n                    int64_t max_arg_18228 = sub64(lifted_0_get_arg_18213,\n                                                  res_18227);\n                    int64_t res_18229 = smax64(0, max_arg_18228);\n                    int64_t sizze_18230 = sub64(res_18229, 1);\n                    bool cond_18231 = res_18199 == 0;\n                    float res_18232;\n                    \n                    if (cond_18231) {\n                        res_18232 = 1.0F;\n                    } else {\n                        res_18232 = 0.0F;\n                    }\n                    \n                    bool cond_18",
                   "233 = slt64(0, res_18199);\n                    float res_18234;\n                    \n                    if (cond_18233) {\n                        float y_18235 = lifted_0_get_arg_18211 *\n                              lifted_0_get_arg_18214;\n                        float res_18236 = res_18232 - y_18235;\n                        \n                        res_18234 = res_18236;\n                    } else {\n                        res_18234 = res_18232;\n                    }\n                    \n                    bool cond_18237 = res_18199 == sizze_18230;\n                    float res_18238;\n                    \n                    if (cond_18237) {\n                        float res_18239 = res_18234 - 1.0F;\n                        \n                        res_18238 = res_18239;\n                    } else {\n                        res_18238 = res_18234;\n                    }\n                    \n                    float res_18240 = lifted_0_get_arg_18212 * res_18238;\n                    float res_18241 = sitofp_i64_f32(res_18199);\n                    float y_18242 = lifted_0_get_arg_18214 * res_18241;\n                    float bondprice_arg_18243 = start_18225 + y_18242;\n                    float y_18244 = bondprice_arg_18243 -\n                          lifted_0_get_arg_18215;\n                    float negate_arg_18245 = a_17890 * y_18244;\n                    float exp_arg_18246 = 0.0F - negate_arg_18245;\n                    float res_18247 = fpow32(2.7182817F, exp_arg_18246);\n                    float x_18248 = 1.0F - res_18247;\n                    float B_18249 = x_18248 / a_17890;\n                    float x_18250 = B_18249 - bondprice_arg_18243;\n                    float x_18251 = lifted_0_get_arg_18215 + x_18250;\n                    float x_18252 = fpow32(a_17890, 2.0F);\n                    float x_18253 = b_17891 * x_18252;\n                    float x_18254 = fpow32(sigma_17892, 2.0F);\n                    float y_18255 = x_18254 / 2.0F;\n                    floa",
                   "t y_18256 = x_18253 - y_18255;\n                    float x_18257 = x_18251 * y_18256;\n                    float A1_18258 = x_18257 / x_18252;\n                    float y_18259 = fpow32(B_18249, 2.0F);\n                    float x_18260 = x_18254 * y_18259;\n                    float y_18261 = 4.0F * a_17890;\n                    float A2_18262 = x_18260 / y_18261;\n                    float exp_arg_18263 = A1_18258 - A2_18262;\n                    float res_18264 = fpow32(2.7182817F, exp_arg_18263);\n                    float negate_arg_18265 = lifted_0_get_arg_18210 * B_18249;\n                    float exp_arg_18266 = 0.0F - negate_arg_18265;\n                    float res_18267 = fpow32(2.7182817F, exp_arg_18266);\n                    float res_18268 = res_18264 * res_18267;\n                    float res_18269 = res_18240 * res_18268;\n                    \n                    res_18223 = res_18269;\n                }\n                // write to-scan values to parameters\n                {\n                    x_18188 = x_18196;\n                    x_18189 = res_18223;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_19553, res_18101)) {\n                    x_18188 = 0;\n                    x_18189 = 0.0F;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                bool res_18190 = x_18186 || x_18188;\n                float res_18191;\n                \n                if (x_18188) {\n                    res_18191 = x_18189;\n                } else {\n                    float res_18192 = x_18187 + x_18189;\n                    \n                    res_18191 = res_18192;\n                }\n                ((__local\n                  bool *) scan_arr_mem_21065)[sext_i32_i6",
                   "4(local_tid_21061)] =\n                    res_18190;\n                ((__local\n                  float *) scan_arr_mem_21067)[sext_i32_i64(local_tid_21061)] =\n                    res_18191;\n            }\n            \n          error_0:\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_failure)\n                return;\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_21072;\n            float x_21073;\n            bool x_21074;\n            float x_21075;\n            bool x_21079;\n            float x_21080;\n            bool x_21081;\n            float x_21082;\n            bool ltid_in_bounds_21086;\n            \n            ltid_in_bounds_21086 = slt64(sext_i32_i64(local_tid_21061),\n                                         segscan_group_sizze_19549);\n            \n            int32_t skip_threads_21087;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_21086) {\n                    x_21074 = ((volatile __local\n                                bool *) scan_arr_mem_21065)[sext_i32_i64(local_tid_21061)];\n                    x_21075 = ((volatile __local\n                                float *) scan_arr_mem_21067)[sext_i32_i64(local_tid_21061)];\n                    if ((local_tid_21061 - squot32(local_tid_21061, 32) * 32) ==\n                        0) {\n                        x_21072 = x_21074;\n                        x_21073 = x_21075;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_21087 = 1;\n                while (slt32(skip_threads_21087, 32)) {\n                    if (sle32(skip_threads_21087, local_tid_21061 -\n                              squot32(local_tid_21061, 32) * 32) &&\n                        ltid_in_bounds_21086) {\n                        // read operands\n                        {\n                            x_21072 = ((volatile __local\n                            ",
                   "            bool *) scan_arr_mem_21065)[sext_i32_i64(local_tid_21061) -\n                                                                    sext_i32_i64(skip_threads_21087)];\n                            x_21073 = ((volatile __local\n                                        float *) scan_arr_mem_21067)[sext_i32_i64(local_tid_21061) -\n                                                                     sext_i32_i64(skip_threads_21087)];\n                        }\n                        // perform operation\n                        {\n                            bool res_21076 = x_21072 || x_21074;\n                            float res_21077;\n                            \n                            if (x_21074) {\n                                res_21077 = x_21075;\n                            } else {\n                                float res_21078 = x_21073 + x_21075;\n                                \n                                res_21077 = res_21078;\n                            }\n                            x_21072 = res_21076;\n                            x_21073 = res_21077;\n                        }\n                    }\n                    if (sle32(wave_sizze_21063, skip_threads_21087)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_21087, local_tid_21061 -\n                              squot32(local_tid_21061, 32) * 32) &&\n                        ltid_in_bounds_21086) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_21065)[sext_i32_i64(local_tid_21061)] =\n                                x_21072;\n                            x_21074 = x_21072;\n                            ((volatile __local\n                              float *) scan_arr_mem_21067)[sext_i32_i64(local_tid_21061)] =\n                                x_21073;\n                            x_21075 = x_21073;\n           ",
                   "             }\n                    }\n                    if (sle32(wave_sizze_21063, skip_threads_21087)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_21087 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_21061 - squot32(local_tid_21061, 32) * 32) ==\n                    31 && ltid_in_bounds_21086) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_21065)[sext_i32_i64(squot32(local_tid_21061,\n                                                                       32))] =\n                        x_21072;\n                    ((volatile __local\n                      float *) scan_arr_mem_21067)[sext_i32_i64(squot32(local_tid_21061,\n                                                                        32))] =\n                        x_21073;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_21088;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_21061, 32) == 0 &&\n                        ltid_in_bounds_21086) {\n                        x_21081 = ((volatile __local\n                                    bool *) scan_arr_mem_21065)[sext_i32_i64(local_tid_21061)];\n                        x_21082 = ((volatile __local\n                                    float *) scan_arr_mem_21067)[sext_i32_i64(local_tid_21061)];\n                        if ((local_tid_21061 - squot32(local_tid_21061, 32) *\n                             32) == 0) {\n                            x_21079 = x_21081;\n                            x_21080 = x_21082;\n                        }\n                    }\n                }\n        ",
                   "        // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_21088 = 1;\n                    while (slt32(skip_threads_21088, 32)) {\n                        if (sle32(skip_threads_21088, local_tid_21061 -\n                                  squot32(local_tid_21061, 32) * 32) &&\n                            (squot32(local_tid_21061, 32) == 0 &&\n                             ltid_in_bounds_21086)) {\n                            // read operands\n                            {\n                                x_21079 = ((volatile __local\n                                            bool *) scan_arr_mem_21065)[sext_i32_i64(local_tid_21061) -\n                                                                        sext_i32_i64(skip_threads_21088)];\n                                x_21080 = ((volatile __local\n                                            float *) scan_arr_mem_21067)[sext_i32_i64(local_tid_21061) -\n                                                                         sext_i32_i64(skip_threads_21088)];\n                            }\n                            // perform operation\n                            {\n                                bool res_21083 = x_21079 || x_21081;\n                                float res_21084;\n                                \n                                if (x_21081) {\n                                    res_21084 = x_21082;\n                                } else {\n                                    float res_21085 = x_21080 + x_21082;\n                                    \n                                    res_21084 = res_21085;\n                                }\n                                x_21079 = res_21083;\n                                x_21080 = res_21084;\n                            }\n                        }\n                        if (sle32(wave_sizze_21063, skip_threads_21088)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n        ",
                   "                if (sle32(skip_threads_21088, local_tid_21061 -\n                                  squot32(local_tid_21061, 32) * 32) &&\n                            (squot32(local_tid_21061, 32) == 0 &&\n                             ltid_in_bounds_21086)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_21065)[sext_i32_i64(local_tid_21061)] =\n                                    x_21079;\n                                x_21081 = x_21079;\n                                ((volatile __local\n                                  float *) scan_arr_mem_21067)[sext_i32_i64(local_tid_21061)] =\n                                    x_21080;\n                                x_21082 = x_21080;\n                            }\n                        }\n                        if (sle32(wave_sizze_21063, skip_threads_21088)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_21088 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_21061, 32) == 0 ||\n                      !ltid_in_bounds_21086)) {\n                    // read operands\n                    {\n                        x_21074 = x_21072;\n                        x_21075 = x_21073;\n                        x_21072 = ((__local\n                                    bool *) scan_arr_mem_21065)[sext_i32_i64(squot32(local_tid_21061,\n                                                                                     32)) -\n                                                                1];\n                        x_21073 = ((__local\n                                    float *) scan_arr_mem_21067)[sext_i32_i64(squot32(local_tid_21061,\n                                                 ",
                   "                                     32)) -\n                                                                 1];\n                    }\n                    // perform operation\n                    {\n                        bool res_21076 = x_21072 || x_21074;\n                        float res_21077;\n                        \n                        if (x_21074) {\n                            res_21077 = x_21075;\n                        } else {\n                            float res_21078 = x_21073 + x_21075;\n                            \n                            res_21077 = res_21078;\n                        }\n                        x_21072 = res_21076;\n                        x_21073 = res_21077;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_21065)[sext_i32_i64(local_tid_21061)] =\n                            x_21072;\n                        ((__local\n                          float *) scan_arr_mem_21067)[sext_i32_i64(local_tid_21061)] =\n                            x_21073;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_21061, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_21065)[sext_i32_i64(local_tid_21061)] =\n                        x_21074;\n                    ((__local\n                      float *) scan_arr_mem_21067)[sext_i32_i64(local_tid_21061)] =\n                        x_21075;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_19553, res_18101)) {\n                    ((__global bool *) mem_20379)[gtid_19553] = ((__local\n                                                                  bool *) scan_arr_mem_21065)[sext_i32_",
                   "i64(local_tid_21061)];\n                    ((__global float *) mem_20381)[gtid_19553] = ((__local\n                                                                   float *) scan_arr_mem_21067)[sext_i32_i64(local_tid_21061)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_21089 = 0;\n                bool should_load_carry_21090 = local_tid_21061 == 0 &&\n                     !crosses_segment_21089;\n                \n                if (should_load_carry_21090) {\n                    x_18186 = ((__local\n                                bool *) scan_arr_mem_21065)[segscan_group_sizze_19549 -\n                                                            1];\n                    x_18187 = ((__local\n                                float *) scan_arr_mem_21067)[segscan_group_sizze_19549 -\n                                                             1];\n                }\n                if (!should_load_carry_21090) {\n                    x_18186 = 0;\n                    x_18187 = 0.0F;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_19549\n}\n__kernel void mainziscan_stage1_19606(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_21132_backing_aligned_0,\n                                      int64_t res_18101, __global\n                                      unsigned char *mem_20376, __global\n                                      unsigned char *mem_20384,\n                                      int32_t num_threads_21126)\n{\n    #define segscan_group_sizze_19601 (mainzisegscan_group_sizze_19600)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_21132_ba",
                   "cking_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_21132_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21127;\n    int32_t local_tid_21128;\n    int64_t group_sizze_21131;\n    int32_t wave_sizze_21130;\n    int32_t group_tid_21129;\n    \n    global_tid_21127 = get_global_id(0);\n    local_tid_21128 = get_local_id(0);\n    group_sizze_21131 = get_local_size(0);\n    wave_sizze_21130 = LOCKSTEP_WIDTH;\n    group_tid_21129 = get_group_id(0);\n    \n    int32_t phys_tid_19606;\n    \n    phys_tid_19606 = global_tid_21127;\n    \n    __local char *scan_arr_mem_21132;\n    \n    scan_arr_mem_21132 = (__local char *) scan_arr_mem_21132_backing_0;\n    \n    int64_t x_18293;\n    int64_t x_18294;\n    \n    x_18293 = 0;\n    for (int64_t j_21134 = 0; j_21134 < sdiv_up64(res_18101,\n                                                  sext_i32_i64(num_threads_21126));\n         j_21134++) {\n        int64_t chunk_offset_21135 = segscan_group_sizze_19601 * j_21134 +\n                sext_i32_i64(group_tid_21129) * (segscan_group_sizze_19601 *\n                                                 sdiv_up64(res_18101,\n                                                           sext_i32_i64(num_threads_21126)));\n        int64_t flat_idx_21136 = chunk_offset_21135 +\n                sext_i32_i64(local_tid_21128);\n        int64_t gtid_19605 = flat_idx_21136;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_19605, res_18101)) {\n                int64_t i_p_o_20134 = add64(1, gtid_19605);\n                int64_t rot_i_20135 = smod64(i_p_o_20134, res_18101);\n                bool x_18296 = ((__global bool *) mem_20376)[rot_i_20135];\n                int64_t res_18297 = btoi_bool_i64(x_18296);\n                \n                // write to-scan values to parameters\n                {\n                    x_18294 = res_18297;\n                }\n                // write mapped values results ",
                   "to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_19605, res_18101)) {\n                    x_18294 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                int64_t res_18295 = add64(x_18293, x_18294);\n                \n                ((__local\n                  int64_t *) scan_arr_mem_21132)[sext_i32_i64(local_tid_21128)] =\n                    res_18295;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int64_t x_21137;\n            int64_t x_21138;\n            int64_t x_21140;\n            int64_t x_21141;\n            bool ltid_in_bounds_21143;\n            \n            ltid_in_bounds_21143 = slt64(sext_i32_i64(local_tid_21128),\n                                         segscan_group_sizze_19601);\n            \n            int32_t skip_threads_21144;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_21143) {\n                    x_21138 = ((volatile __local\n                                int64_t *) scan_arr_mem_21132)[sext_i32_i64(local_tid_21128)];\n                    if ((local_tid_21128 - squot32(local_tid_21128, 32) * 32) ==\n                        0) {\n                        x_21137 = x_21138;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_21144 = 1;\n                while (slt32(skip_threads_21144, 32)) {\n                    if (sle32(skip_threads_21144, local_tid_21128 -\n                              squot32(local_tid_21128, 32) * 32) &&\n                        ltid_in_bounds_21143) {\n                        // read operands\n                        {\n                            x_21137 = ((volatile __local\n      ",
                   "                                  int64_t *) scan_arr_mem_21132)[sext_i32_i64(local_tid_21128) -\n                                                                       sext_i32_i64(skip_threads_21144)];\n                        }\n                        // perform operation\n                        {\n                            int64_t res_21139 = add64(x_21137, x_21138);\n                            \n                            x_21137 = res_21139;\n                        }\n                    }\n                    if (sle32(wave_sizze_21130, skip_threads_21144)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_21144, local_tid_21128 -\n                              squot32(local_tid_21128, 32) * 32) &&\n                        ltid_in_bounds_21143) {\n                        // write result\n                        {\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_21132)[sext_i32_i64(local_tid_21128)] =\n                                x_21137;\n                            x_21138 = x_21137;\n                        }\n                    }\n                    if (sle32(wave_sizze_21130, skip_threads_21144)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_21144 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_21128 - squot32(local_tid_21128, 32) * 32) ==\n                    31 && ltid_in_bounds_21143) {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_21132)[sext_i32_i64(squot32(local_tid_21128,\n                                                                          32))] =\n                        x_21137;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first",
                   " block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_21145;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_21128, 32) == 0 &&\n                        ltid_in_bounds_21143) {\n                        x_21141 = ((volatile __local\n                                    int64_t *) scan_arr_mem_21132)[sext_i32_i64(local_tid_21128)];\n                        if ((local_tid_21128 - squot32(local_tid_21128, 32) *\n                             32) == 0) {\n                            x_21140 = x_21141;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_21145 = 1;\n                    while (slt32(skip_threads_21145, 32)) {\n                        if (sle32(skip_threads_21145, local_tid_21128 -\n                                  squot32(local_tid_21128, 32) * 32) &&\n                            (squot32(local_tid_21128, 32) == 0 &&\n                             ltid_in_bounds_21143)) {\n                            // read operands\n                            {\n                                x_21140 = ((volatile __local\n                                            int64_t *) scan_arr_mem_21132)[sext_i32_i64(local_tid_21128) -\n                                                                           sext_i32_i64(skip_threads_21145)];\n                            }\n                            // perform operation\n                            {\n                                int64_t res_21142 = add64(x_21140, x_21141);\n                                \n                                x_21140 = res_21142;\n                            }\n                        }\n                        if (sle32(wave_sizze_21130, skip_threads_21145)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n           ",
                   "             if (sle32(skip_threads_21145, local_tid_21128 -\n                                  squot32(local_tid_21128, 32) * 32) &&\n                            (squot32(local_tid_21128, 32) == 0 &&\n                             ltid_in_bounds_21143)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_21132)[sext_i32_i64(local_tid_21128)] =\n                                    x_21140;\n                                x_21141 = x_21140;\n                            }\n                        }\n                        if (sle32(wave_sizze_21130, skip_threads_21145)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_21145 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_21128, 32) == 0 ||\n                      !ltid_in_bounds_21143)) {\n                    // read operands\n                    {\n                        x_21138 = x_21137;\n                        x_21137 = ((__local\n                                    int64_t *) scan_arr_mem_21132)[sext_i32_i64(squot32(local_tid_21128,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_21139 = add64(x_21137, x_21138);\n                        \n                        x_21137 = res_21139;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          int64_t *) scan_arr_mem_21132)[sext_i32_i64(local_tid_21128)] =\n                            x_21137;\n  ",
                   "                  }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_21128, 32) == 0) {\n                    ((__local\n                      int64_t *) scan_arr_mem_21132)[sext_i32_i64(local_tid_21128)] =\n                        x_21138;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_19605, res_18101)) {\n                    ((__global int64_t *) mem_20384)[gtid_19605] = ((__local\n                                                                     int64_t *) scan_arr_mem_21132)[sext_i32_i64(local_tid_21128)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_21146 = 0;\n                bool should_load_carry_21147 = local_tid_21128 == 0 &&\n                     !crosses_segment_21146;\n                \n                if (should_load_carry_21147) {\n                    x_18293 = ((__local\n                                int64_t *) scan_arr_mem_21132)[segscan_group_sizze_19601 -\n                                                               1];\n                }\n                if (!should_load_carry_21147) {\n                    x_18293 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_19601\n}\n__kernel void mainziscan_stage2_19505(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20713_backing_aligned_0,\n                                      int64_t binop_x_20308, __global\n                                      unsigned char *mem_20356,\n                                  ",
                   "    int64_t stage1_num_groups_20685,\n                                      int32_t num_threads_20686)\n{\n    #define segscan_group_sizze_19500 (mainzisegscan_group_sizze_19499)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20713_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20713_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20708;\n    int32_t local_tid_20709;\n    int64_t group_sizze_20712;\n    int32_t wave_sizze_20711;\n    int32_t group_tid_20710;\n    \n    global_tid_20708 = get_global_id(0);\n    local_tid_20709 = get_local_id(0);\n    group_sizze_20712 = get_local_size(0);\n    wave_sizze_20711 = LOCKSTEP_WIDTH;\n    group_tid_20710 = get_group_id(0);\n    \n    int32_t phys_tid_19505;\n    \n    phys_tid_19505 = global_tid_20708;\n    \n    __local char *scan_arr_mem_20713;\n    \n    scan_arr_mem_20713 = (__local char *) scan_arr_mem_20713_backing_0;\n    \n    int64_t flat_idx_20715;\n    \n    flat_idx_20715 = (sext_i32_i64(local_tid_20709) + 1) *\n        (segscan_group_sizze_19500 * sdiv_up64(binop_x_20308,\n                                               sext_i32_i64(num_threads_20686))) -\n        1;\n    \n    int64_t gtid_19504;\n    \n    gtid_19504 = flat_idx_20715;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_19504, binop_x_20308)) {\n            ((__local\n              int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709)] =\n                ((__global int64_t *) mem_20356)[gtid_19504];\n        } else {\n            ((__local\n              int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int64_t x_18085;\n    int64_t x_18086;\n    int64_t x_20716;\n    int64_t x_20717;\n    bool ltid_in_bounds_20719;\n    \n    ltid_in_bounds_20719 = slt64(sext_i32",
                   "_i64(local_tid_20709),\n                                 stage1_num_groups_20685);\n    \n    int32_t skip_threads_20720;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_20719) {\n            x_18086 = ((volatile __local\n                        int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709)];\n            if ((local_tid_20709 - squot32(local_tid_20709, 32) * 32) == 0) {\n                x_18085 = x_18086;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_20720 = 1;\n        while (slt32(skip_threads_20720, 32)) {\n            if (sle32(skip_threads_20720, local_tid_20709 -\n                      squot32(local_tid_20709, 32) * 32) &&\n                ltid_in_bounds_20719) {\n                // read operands\n                {\n                    x_18085 = ((volatile __local\n                                int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709) -\n                                                               sext_i32_i64(skip_threads_20720)];\n                }\n                // perform operation\n                {\n                    int64_t res_18087 = add64(x_18085, x_18086);\n                    \n                    x_18085 = res_18087;\n                }\n            }\n            if (sle32(wave_sizze_20711, skip_threads_20720)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_20720, local_tid_20709 -\n                      squot32(local_tid_20709, 32) * 32) &&\n                ltid_in_bounds_20719) {\n                // write result\n                {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709)] =\n                        x_18085;\n                    x_18086 = x_18085;\n                }\n            }\n            if (sle32(wave_sizze_20711, skip_threads_20720)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_th",
                   "reads_20720 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_20709 - squot32(local_tid_20709, 32) * 32) == 31 &&\n            ltid_in_bounds_20719) {\n            ((volatile __local\n              int64_t *) scan_arr_mem_20713)[sext_i32_i64(squot32(local_tid_20709,\n                                                                  32))] =\n                x_18085;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_20721;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_20709, 32) == 0 && ltid_in_bounds_20719) {\n                x_20717 = ((volatile __local\n                            int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709)];\n                if ((local_tid_20709 - squot32(local_tid_20709, 32) * 32) ==\n                    0) {\n                    x_20716 = x_20717;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_20721 = 1;\n            while (slt32(skip_threads_20721, 32)) {\n                if (sle32(skip_threads_20721, local_tid_20709 -\n                          squot32(local_tid_20709, 32) * 32) &&\n                    (squot32(local_tid_20709, 32) == 0 &&\n                     ltid_in_bounds_20719)) {\n                    // read operands\n                    {\n                        x_20716 = ((volatile __local\n                                    int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709) -\n                                                                   sext_i32_i64(skip_threads_20721)];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_20718 = add64(x_20716, x_20717);\n                        \n                        x_2",
                   "0716 = res_20718;\n                    }\n                }\n                if (sle32(wave_sizze_20711, skip_threads_20721)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_20721, local_tid_20709 -\n                          squot32(local_tid_20709, 32) * 32) &&\n                    (squot32(local_tid_20709, 32) == 0 &&\n                     ltid_in_bounds_20719)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709)] =\n                            x_20716;\n                        x_20717 = x_20716;\n                    }\n                }\n                if (sle32(wave_sizze_20711, skip_threads_20721)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_20721 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_20709, 32) == 0 || !ltid_in_bounds_20719)) {\n            // read operands\n            {\n                x_18086 = x_18085;\n                x_18085 = ((__local\n                            int64_t *) scan_arr_mem_20713)[sext_i32_i64(squot32(local_tid_20709,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                int64_t res_18087 = add64(x_18085, x_18086);\n                \n                x_18085 = res_18087;\n            }\n            // write final result\n            {\n                ((__local\n                  int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709)] =\n                    x_18085;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_20709, 32)",
                   " == 0) {\n            ((__local\n              int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709)] =\n                x_18086;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_19504, binop_x_20308)) {\n            ((__global int64_t *) mem_20356)[gtid_19504] = ((__local\n                                                             int64_t *) scan_arr_mem_20713)[sext_i32_i64(local_tid_20709)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_19500\n}\n__kernel void mainziscan_stage2_19538(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20964_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_20962_backing_aligned_1,\n                                      int64_t res_18101, __global\n                                      unsigned char *mem_20367, __global\n                                      unsigned char *mem_20369,\n                                      int64_t stage1_num_groups_20924,\n                                      int32_t num_threads_20925)\n{\n    #define segscan_group_sizze_19533 (mainzisegscan_group_sizze_19532)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_20964_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_20964_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_20962_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_20962_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20957;\n    int32_t local_tid_20958;\n    int64_t group_sizze_20961;\n    int32_t wave_sizze_20960;\n    int32_t group_tid_20959;\n    \n    g",
                   "lobal_tid_20957 = get_global_id(0);\n    local_tid_20958 = get_local_id(0);\n    group_sizze_20961 = get_local_size(0);\n    wave_sizze_20960 = LOCKSTEP_WIDTH;\n    group_tid_20959 = get_group_id(0);\n    \n    int32_t phys_tid_19538;\n    \n    phys_tid_19538 = global_tid_20957;\n    \n    __local char *scan_arr_mem_20962;\n    __local char *scan_arr_mem_20964;\n    \n    scan_arr_mem_20962 = (__local char *) scan_arr_mem_20962_backing_0;\n    scan_arr_mem_20964 = (__local char *) scan_arr_mem_20964_backing_1;\n    \n    int64_t flat_idx_20966;\n    \n    flat_idx_20966 = (sext_i32_i64(local_tid_20958) + 1) *\n        (segscan_group_sizze_19533 * sdiv_up64(res_18101,\n                                               sext_i32_i64(num_threads_20925))) -\n        1;\n    \n    int64_t gtid_19537;\n    \n    gtid_19537 = flat_idx_20966;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_19537, res_18101)) {\n            ((__local\n              bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958)] =\n                ((__global bool *) mem_20367)[gtid_19537];\n            ((__local\n              int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958)] =\n                ((__global int64_t *) mem_20369)[gtid_19537];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958)] = 0;\n            ((__local\n              int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_18120;\n    int64_t x_18121;\n    bool x_18122;\n    int64_t x_18123;\n    bool x_20967;\n    int64_t x_20968;\n    bool x_20969;\n    int64_t x_20970;\n    bool ltid_in_bounds_20974;\n    \n    ltid_in_bounds_20974 = slt64(sext_i32_i64(local_tid_20958),\n                                 stage1_num_groups_20924);\n    \n    int32_t skip_threads_20975;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_20974) {\n            x_18122 = ((volatile __loc",
                   "al\n                        bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958)];\n            x_18123 = ((volatile __local\n                        int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958)];\n            if ((local_tid_20958 - squot32(local_tid_20958, 32) * 32) == 0) {\n                x_18120 = x_18122;\n                x_18121 = x_18123;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_20975 = 1;\n        while (slt32(skip_threads_20975, 32)) {\n            if (sle32(skip_threads_20975, local_tid_20958 -\n                      squot32(local_tid_20958, 32) * 32) &&\n                ltid_in_bounds_20974) {\n                // read operands\n                {\n                    x_18120 = ((volatile __local\n                                bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958) -\n                                                            sext_i32_i64(skip_threads_20975)];\n                    x_18121 = ((volatile __local\n                                int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958) -\n                                                               sext_i32_i64(skip_threads_20975)];\n                }\n                // perform operation\n                {\n                    bool res_18124 = x_18120 || x_18122;\n                    int64_t res_18125;\n                    \n                    if (x_18122) {\n                        res_18125 = x_18123;\n                    } else {\n                        int64_t res_18126 = add64(x_18121, x_18123);\n                        \n                        res_18125 = res_18126;\n                    }\n                    x_18120 = res_18124;\n                    x_18121 = res_18125;\n                }\n            }\n            if (sle32(wave_sizze_20960, skip_threads_20975)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_20975, local_tid_20958 -\n                     ",
                   " squot32(local_tid_20958, 32) * 32) &&\n                ltid_in_bounds_20974) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958)] =\n                        x_18120;\n                    x_18122 = x_18120;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958)] =\n                        x_18121;\n                    x_18123 = x_18121;\n                }\n            }\n            if (sle32(wave_sizze_20960, skip_threads_20975)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_20975 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_20958 - squot32(local_tid_20958, 32) * 32) == 31 &&\n            ltid_in_bounds_20974) {\n            ((volatile __local\n              bool *) scan_arr_mem_20962)[sext_i32_i64(squot32(local_tid_20958,\n                                                               32))] = x_18120;\n            ((volatile __local\n              int64_t *) scan_arr_mem_20964)[sext_i32_i64(squot32(local_tid_20958,\n                                                                  32))] =\n                x_18121;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_20976;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_20958, 32) == 0 && ltid_in_bounds_20974) {\n                x_20969 = ((volatile __local\n                            bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958)];\n                x_20970 = ((volatile __local\n                            int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958)];\n                if ((local_tid_20958 - squot32(local_tid_20958, 32) * ",
                   "32) ==\n                    0) {\n                    x_20967 = x_20969;\n                    x_20968 = x_20970;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_20976 = 1;\n            while (slt32(skip_threads_20976, 32)) {\n                if (sle32(skip_threads_20976, local_tid_20958 -\n                          squot32(local_tid_20958, 32) * 32) &&\n                    (squot32(local_tid_20958, 32) == 0 &&\n                     ltid_in_bounds_20974)) {\n                    // read operands\n                    {\n                        x_20967 = ((volatile __local\n                                    bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958) -\n                                                                sext_i32_i64(skip_threads_20976)];\n                        x_20968 = ((volatile __local\n                                    int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958) -\n                                                                   sext_i32_i64(skip_threads_20976)];\n                    }\n                    // perform operation\n                    {\n                        bool res_20971 = x_20967 || x_20969;\n                        int64_t res_20972;\n                        \n                        if (x_20969) {\n                            res_20972 = x_20970;\n                        } else {\n                            int64_t res_20973 = add64(x_20968, x_20970);\n                            \n                            res_20972 = res_20973;\n                        }\n                        x_20967 = res_20971;\n                        x_20968 = res_20972;\n                    }\n                }\n                if (sle32(wave_sizze_20960, skip_threads_20976)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_20976, local_tid_20958 -\n                          squot32(local_tid_20958, 32) * 3",
                   "2) &&\n                    (squot32(local_tid_20958, 32) == 0 &&\n                     ltid_in_bounds_20974)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958)] =\n                            x_20967;\n                        x_20969 = x_20967;\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958)] =\n                            x_20968;\n                        x_20970 = x_20968;\n                    }\n                }\n                if (sle32(wave_sizze_20960, skip_threads_20976)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_20976 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_20958, 32) == 0 || !ltid_in_bounds_20974)) {\n            // read operands\n            {\n                x_18122 = x_18120;\n                x_18123 = x_18121;\n                x_18120 = ((__local\n                            bool *) scan_arr_mem_20962)[sext_i32_i64(squot32(local_tid_20958,\n                                                                             32)) -\n                                                        1];\n                x_18121 = ((__local\n                            int64_t *) scan_arr_mem_20964)[sext_i32_i64(squot32(local_tid_20958,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                bool res_18124 = x_18120 || x_18122;\n                int64_t res_18125;\n                \n                if (x_18122) {\n                    res_18125 = x_18123;\n                } else {\n                    int64_t res_18126 = add64(x_18121, x_18123);",
                   "\n                    \n                    res_18125 = res_18126;\n                }\n                x_18120 = res_18124;\n                x_18121 = res_18125;\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958)] =\n                    x_18120;\n                ((__local\n                  int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958)] =\n                    x_18121;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_20958, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958)] =\n                x_18122;\n            ((__local\n              int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958)] =\n                x_18123;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_19537, res_18101)) {\n            ((__global bool *) mem_20367)[gtid_19537] = ((__local\n                                                          bool *) scan_arr_mem_20962)[sext_i32_i64(local_tid_20958)];\n            ((__global int64_t *) mem_20369)[gtid_19537] = ((__local\n                                                             int64_t *) scan_arr_mem_20964)[sext_i32_i64(local_tid_20958)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_19533\n}\n__kernel void mainziscan_stage2_19546(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_21031_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_21029_backing_aligned_1,\n                                      int64_t res_18101, __global\n                                      unsigned char *mem_20372, __global\n    ",
                   "                                  unsigned char *mem_20374,\n                                      int64_t stage1_num_groups_20991,\n                                      int32_t num_threads_20992)\n{\n    #define segscan_group_sizze_19541 (mainzisegscan_group_sizze_19540)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_21031_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_21031_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_21029_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_21029_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21024;\n    int32_t local_tid_21025;\n    int64_t group_sizze_21028;\n    int32_t wave_sizze_21027;\n    int32_t group_tid_21026;\n    \n    global_tid_21024 = get_global_id(0);\n    local_tid_21025 = get_local_id(0);\n    group_sizze_21028 = get_local_size(0);\n    wave_sizze_21027 = LOCKSTEP_WIDTH;\n    group_tid_21026 = get_group_id(0);\n    \n    int32_t phys_tid_19546;\n    \n    phys_tid_19546 = global_tid_21024;\n    \n    __local char *scan_arr_mem_21029;\n    __local char *scan_arr_mem_21031;\n    \n    scan_arr_mem_21029 = (__local char *) scan_arr_mem_21029_backing_0;\n    scan_arr_mem_21031 = (__local char *) scan_arr_mem_21031_backing_1;\n    \n    int64_t flat_idx_21033;\n    \n    flat_idx_21033 = (sext_i32_i64(local_tid_21025) + 1) *\n        (segscan_group_sizze_19541 * sdiv_up64(res_18101,\n                                               sext_i32_i64(num_threads_20992))) -\n        1;\n    \n    int64_t gtid_19545;\n    \n    gtid_19545 = flat_idx_21033;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_19545, res_18101)) {\n            ((__local\n              bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025)] =\n                ((__g",
                   "lobal bool *) mem_20372)[gtid_19545];\n            ((__local\n              int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025)] =\n                ((__global int64_t *) mem_20374)[gtid_19545];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025)] = 0;\n            ((__local\n              int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_18160;\n    int64_t x_18161;\n    bool x_18162;\n    int64_t x_18163;\n    bool x_21034;\n    int64_t x_21035;\n    bool x_21036;\n    int64_t x_21037;\n    bool ltid_in_bounds_21041;\n    \n    ltid_in_bounds_21041 = slt64(sext_i32_i64(local_tid_21025),\n                                 stage1_num_groups_20991);\n    \n    int32_t skip_threads_21042;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_21041) {\n            x_18162 = ((volatile __local\n                        bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025)];\n            x_18163 = ((volatile __local\n                        int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025)];\n            if ((local_tid_21025 - squot32(local_tid_21025, 32) * 32) == 0) {\n                x_18160 = x_18162;\n                x_18161 = x_18163;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_21042 = 1;\n        while (slt32(skip_threads_21042, 32)) {\n            if (sle32(skip_threads_21042, local_tid_21025 -\n                      squot32(local_tid_21025, 32) * 32) &&\n                ltid_in_bounds_21041) {\n                // read operands\n                {\n                    x_18160 = ((volatile __local\n                                bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025) -\n                                                            sext_i32_i64(skip_threads_21042)];\n                    x_18161 = ((volatile __local\n                         ",
                   "       int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025) -\n                                                               sext_i32_i64(skip_threads_21042)];\n                }\n                // perform operation\n                {\n                    bool res_18164 = x_18160 || x_18162;\n                    int64_t res_18165;\n                    \n                    if (x_18162) {\n                        res_18165 = x_18163;\n                    } else {\n                        int64_t res_18166 = add64(x_18161, x_18163);\n                        \n                        res_18165 = res_18166;\n                    }\n                    x_18160 = res_18164;\n                    x_18161 = res_18165;\n                }\n            }\n            if (sle32(wave_sizze_21027, skip_threads_21042)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_21042, local_tid_21025 -\n                      squot32(local_tid_21025, 32) * 32) &&\n                ltid_in_bounds_21041) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025)] =\n                        x_18160;\n                    x_18162 = x_18160;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025)] =\n                        x_18161;\n                    x_18163 = x_18161;\n                }\n            }\n            if (sle32(wave_sizze_21027, skip_threads_21042)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_21042 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_21025 - squot32(local_tid_21025, 32) * 32) == 31 &&\n            ltid_in_bounds_21041) {\n            ((volatile __local\n              bool *) scan_arr_mem_21029)[sext_i32_i64(squot32(local_tid_21025",
                   ",\n                                                               32))] = x_18160;\n            ((volatile __local\n              int64_t *) scan_arr_mem_21031)[sext_i32_i64(squot32(local_tid_21025,\n                                                                  32))] =\n                x_18161;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_21043;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_21025, 32) == 0 && ltid_in_bounds_21041) {\n                x_21036 = ((volatile __local\n                            bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025)];\n                x_21037 = ((volatile __local\n                            int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025)];\n                if ((local_tid_21025 - squot32(local_tid_21025, 32) * 32) ==\n                    0) {\n                    x_21034 = x_21036;\n                    x_21035 = x_21037;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_21043 = 1;\n            while (slt32(skip_threads_21043, 32)) {\n                if (sle32(skip_threads_21043, local_tid_21025 -\n                          squot32(local_tid_21025, 32) * 32) &&\n                    (squot32(local_tid_21025, 32) == 0 &&\n                     ltid_in_bounds_21041)) {\n                    // read operands\n                    {\n                        x_21034 = ((volatile __local\n                                    bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025) -\n                                                                sext_i32_i64(skip_threads_21043)];\n                        x_21035 = ((volatile __local\n                                    int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025) -\n                                                       ",
                   "            sext_i32_i64(skip_threads_21043)];\n                    }\n                    // perform operation\n                    {\n                        bool res_21038 = x_21034 || x_21036;\n                        int64_t res_21039;\n                        \n                        if (x_21036) {\n                            res_21039 = x_21037;\n                        } else {\n                            int64_t res_21040 = add64(x_21035, x_21037);\n                            \n                            res_21039 = res_21040;\n                        }\n                        x_21034 = res_21038;\n                        x_21035 = res_21039;\n                    }\n                }\n                if (sle32(wave_sizze_21027, skip_threads_21043)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_21043, local_tid_21025 -\n                          squot32(local_tid_21025, 32) * 32) &&\n                    (squot32(local_tid_21025, 32) == 0 &&\n                     ltid_in_bounds_21041)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025)] =\n                            x_21034;\n                        x_21036 = x_21034;\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025)] =\n                            x_21035;\n                        x_21037 = x_21035;\n                    }\n                }\n                if (sle32(wave_sizze_21027, skip_threads_21043)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_21043 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_21025, 32) == 0 || !ltid_in_bounds_21041)) {\n            // read operands\n            {\n      ",
                   "          x_18162 = x_18160;\n                x_18163 = x_18161;\n                x_18160 = ((__local\n                            bool *) scan_arr_mem_21029)[sext_i32_i64(squot32(local_tid_21025,\n                                                                             32)) -\n                                                        1];\n                x_18161 = ((__local\n                            int64_t *) scan_arr_mem_21031)[sext_i32_i64(squot32(local_tid_21025,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                bool res_18164 = x_18160 || x_18162;\n                int64_t res_18165;\n                \n                if (x_18162) {\n                    res_18165 = x_18163;\n                } else {\n                    int64_t res_18166 = add64(x_18161, x_18163);\n                    \n                    res_18165 = res_18166;\n                }\n                x_18160 = res_18164;\n                x_18161 = res_18165;\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025)] =\n                    x_18160;\n                ((__local\n                  int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025)] =\n                    x_18161;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_21025, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025)] =\n                x_18162;\n            ((__local\n              int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025)] =\n                x_18163;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_19545, res_18101)) {\n   ",
                   "         ((__global bool *) mem_20372)[gtid_19545] = ((__local\n                                                          bool *) scan_arr_mem_21029)[sext_i32_i64(local_tid_21025)];\n            ((__global int64_t *) mem_20374)[gtid_19545] = ((__local\n                                                             int64_t *) scan_arr_mem_21031)[sext_i32_i64(local_tid_21025)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_19541\n}\n__kernel void mainziscan_stage2_19554(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_21098_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_21096_backing_aligned_1,\n                                      int64_t res_18101, __global\n                                      unsigned char *mem_20379, __global\n                                      unsigned char *mem_20381,\n                                      int64_t stage1_num_groups_21058,\n                                      int32_t num_threads_21059)\n{\n    #define segscan_group_sizze_19549 (mainzisegscan_group_sizze_19548)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_21098_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_21098_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_21096_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_21096_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21091;\n    int32_t local_tid_21092;\n    int64_t group_sizze_21095;\n    int32_t wave_sizze_21094;\n    int32_t group_tid_21093;\n    \n    global_tid_21091 = get_global_id(0);\n    local_tid_21092 = get_local_id(0);\n    group_sizze_21095 = get_l",
                   "ocal_size(0);\n    wave_sizze_21094 = LOCKSTEP_WIDTH;\n    group_tid_21093 = get_group_id(0);\n    \n    int32_t phys_tid_19554;\n    \n    phys_tid_19554 = global_tid_21091;\n    \n    __local char *scan_arr_mem_21096;\n    __local char *scan_arr_mem_21098;\n    \n    scan_arr_mem_21096 = (__local char *) scan_arr_mem_21096_backing_0;\n    scan_arr_mem_21098 = (__local char *) scan_arr_mem_21098_backing_1;\n    \n    int64_t flat_idx_21100;\n    \n    flat_idx_21100 = (sext_i32_i64(local_tid_21092) + 1) *\n        (segscan_group_sizze_19549 * sdiv_up64(res_18101,\n                                               sext_i32_i64(num_threads_21059))) -\n        1;\n    \n    int64_t gtid_19553;\n    \n    gtid_19553 = flat_idx_21100;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_19553, res_18101)) {\n            ((__local\n              bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092)] =\n                ((__global bool *) mem_20379)[gtid_19553];\n            ((__local\n              float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092)] =\n                ((__global float *) mem_20381)[gtid_19553];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092)] = 0;\n            ((__local\n              float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092)] =\n                0.0F;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_18186;\n    float x_18187;\n    bool x_18188;\n    float x_18189;\n    bool x_21101;\n    float x_21102;\n    bool x_21103;\n    float x_21104;\n    bool ltid_in_bounds_21108;\n    \n    ltid_in_bounds_21108 = slt64(sext_i32_i64(local_tid_21092),\n                                 stage1_num_groups_21058);\n    \n    int32_t skip_threads_21109;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_21108) {\n            x_18188 = ((volatile __local\n                        bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092)];\n            ",
                   "x_18189 = ((volatile __local\n                        float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092)];\n            if ((local_tid_21092 - squot32(local_tid_21092, 32) * 32) == 0) {\n                x_18186 = x_18188;\n                x_18187 = x_18189;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_21109 = 1;\n        while (slt32(skip_threads_21109, 32)) {\n            if (sle32(skip_threads_21109, local_tid_21092 -\n                      squot32(local_tid_21092, 32) * 32) &&\n                ltid_in_bounds_21108) {\n                // read operands\n                {\n                    x_18186 = ((volatile __local\n                                bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092) -\n                                                            sext_i32_i64(skip_threads_21109)];\n                    x_18187 = ((volatile __local\n                                float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092) -\n                                                             sext_i32_i64(skip_threads_21109)];\n                }\n                // perform operation\n                {\n                    bool res_18190 = x_18186 || x_18188;\n                    float res_18191;\n                    \n                    if (x_18188) {\n                        res_18191 = x_18189;\n                    } else {\n                        float res_18192 = x_18187 + x_18189;\n                        \n                        res_18191 = res_18192;\n                    }\n                    x_18186 = res_18190;\n                    x_18187 = res_18191;\n                }\n            }\n            if (sle32(wave_sizze_21094, skip_threads_21109)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_21109, local_tid_21092 -\n                      squot32(local_tid_21092, 32) * 32) &&\n                ltid_in_bounds_21108) {\n                // write result\n    ",
                   "            {\n                    ((volatile __local\n                      bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092)] =\n                        x_18186;\n                    x_18188 = x_18186;\n                    ((volatile __local\n                      float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092)] =\n                        x_18187;\n                    x_18189 = x_18187;\n                }\n            }\n            if (sle32(wave_sizze_21094, skip_threads_21109)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_21109 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_21092 - squot32(local_tid_21092, 32) * 32) == 31 &&\n            ltid_in_bounds_21108) {\n            ((volatile __local\n              bool *) scan_arr_mem_21096)[sext_i32_i64(squot32(local_tid_21092,\n                                                               32))] = x_18186;\n            ((volatile __local\n              float *) scan_arr_mem_21098)[sext_i32_i64(squot32(local_tid_21092,\n                                                                32))] = x_18187;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_21110;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_21092, 32) == 0 && ltid_in_bounds_21108) {\n                x_21103 = ((volatile __local\n                            bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092)];\n                x_21104 = ((volatile __local\n                            float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092)];\n                if ((local_tid_21092 - squot32(local_tid_21092, 32) * 32) ==\n                    0) {\n                    x_21101 = x_21103;\n                    x_21102 = x_21104;\n                }\n           ",
                   " }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_21110 = 1;\n            while (slt32(skip_threads_21110, 32)) {\n                if (sle32(skip_threads_21110, local_tid_21092 -\n                          squot32(local_tid_21092, 32) * 32) &&\n                    (squot32(local_tid_21092, 32) == 0 &&\n                     ltid_in_bounds_21108)) {\n                    // read operands\n                    {\n                        x_21101 = ((volatile __local\n                                    bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092) -\n                                                                sext_i32_i64(skip_threads_21110)];\n                        x_21102 = ((volatile __local\n                                    float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092) -\n                                                                 sext_i32_i64(skip_threads_21110)];\n                    }\n                    // perform operation\n                    {\n                        bool res_21105 = x_21101 || x_21103;\n                        float res_21106;\n                        \n                        if (x_21103) {\n                            res_21106 = x_21104;\n                        } else {\n                            float res_21107 = x_21102 + x_21104;\n                            \n                            res_21106 = res_21107;\n                        }\n                        x_21101 = res_21105;\n                        x_21102 = res_21106;\n                    }\n                }\n                if (sle32(wave_sizze_21094, skip_threads_21110)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_21110, local_tid_21092 -\n                          squot32(local_tid_21092, 32) * 32) &&\n                    (squot32(local_tid_21092, 32) == 0 &&\n                     ltid_in_bounds_21108)) {\n                    // write result\n       ",
                   "             {\n                        ((volatile __local\n                          bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092)] =\n                            x_21101;\n                        x_21103 = x_21101;\n                        ((volatile __local\n                          float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092)] =\n                            x_21102;\n                        x_21104 = x_21102;\n                    }\n                }\n                if (sle32(wave_sizze_21094, skip_threads_21110)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_21110 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_21092, 32) == 0 || !ltid_in_bounds_21108)) {\n            // read operands\n            {\n                x_18188 = x_18186;\n                x_18189 = x_18187;\n                x_18186 = ((__local\n                            bool *) scan_arr_mem_21096)[sext_i32_i64(squot32(local_tid_21092,\n                                                                             32)) -\n                                                        1];\n                x_18187 = ((__local\n                            float *) scan_arr_mem_21098)[sext_i32_i64(squot32(local_tid_21092,\n                                                                              32)) -\n                                                         1];\n            }\n            // perform operation\n            {\n                bool res_18190 = x_18186 || x_18188;\n                float res_18191;\n                \n                if (x_18188) {\n                    res_18191 = x_18189;\n                } else {\n                    float res_18192 = x_18187 + x_18189;\n                    \n                    res_18191 = res_18192;\n                }\n                x_18186 = res_18190;\n                x_18187 = res_18191;\n            }\n",
                   "            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092)] =\n                    x_18186;\n                ((__local\n                  float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092)] =\n                    x_18187;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_21092, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092)] =\n                x_18188;\n            ((__local\n              float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092)] =\n                x_18189;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_19553, res_18101)) {\n            ((__global bool *) mem_20379)[gtid_19553] = ((__local\n                                                          bool *) scan_arr_mem_21096)[sext_i32_i64(local_tid_21092)];\n            ((__global float *) mem_20381)[gtid_19553] = ((__local\n                                                           float *) scan_arr_mem_21098)[sext_i32_i64(local_tid_21092)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_19549\n}\n__kernel void mainziscan_stage2_19606(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_21153_backing_aligned_0,\n                                      int64_t res_18101, __global\n                                      unsigned char *mem_20384,\n                                      int64_t stage1_num_groups_21125,\n                                      int32_t num_threads_21126)\n{\n    #define segscan_group_sizze_19601 (mainzisegscan_group_sizze_19600)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *re",
                   "strict scan_arr_mem_21153_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_21153_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21148;\n    int32_t local_tid_21149;\n    int64_t group_sizze_21152;\n    int32_t wave_sizze_21151;\n    int32_t group_tid_21150;\n    \n    global_tid_21148 = get_global_id(0);\n    local_tid_21149 = get_local_id(0);\n    group_sizze_21152 = get_local_size(0);\n    wave_sizze_21151 = LOCKSTEP_WIDTH;\n    group_tid_21150 = get_group_id(0);\n    \n    int32_t phys_tid_19606;\n    \n    phys_tid_19606 = global_tid_21148;\n    \n    __local char *scan_arr_mem_21153;\n    \n    scan_arr_mem_21153 = (__local char *) scan_arr_mem_21153_backing_0;\n    \n    int64_t flat_idx_21155;\n    \n    flat_idx_21155 = (sext_i32_i64(local_tid_21149) + 1) *\n        (segscan_group_sizze_19601 * sdiv_up64(res_18101,\n                                               sext_i32_i64(num_threads_21126))) -\n        1;\n    \n    int64_t gtid_19605;\n    \n    gtid_19605 = flat_idx_21155;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_19605, res_18101)) {\n            ((__local\n              int64_t *) scan_arr_mem_21153)[sext_i32_i64(local_tid_21149)] =\n                ((__global int64_t *) mem_20384)[gtid_19605];\n        } else {\n            ((__local\n              int64_t *) scan_arr_mem_21153)[sext_i32_i64(local_tid_21149)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int64_t x_18293;\n    int64_t x_18294;\n    int64_t x_21156;\n    int64_t x_21157;\n    bool ltid_in_bounds_21159;\n    \n    ltid_in_bounds_21159 = slt64(sext_i32_i64(local_tid_21149),\n                                 stage1_num_groups_21125);\n    \n    int32_t skip_threads_21160;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_21159) {\n            x_18294 = ((volatile __local\n                        int64_t *) scan_arr_mem_21153)[sext_i32_i",
                   "64(local_tid_21149)];\n            if ((local_tid_21149 - squot32(local_tid_21149, 32) * 32) == 0) {\n                x_18293 = x_18294;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_21160 = 1;\n        while (slt32(skip_threads_21160, 32)) {\n            if (sle32(skip_threads_21160, local_tid_21149 -\n                      squot32(local_tid_21149, 32) * 32) &&\n                ltid_in_bounds_21159) {\n                // read operands\n                {\n                    x_18293 = ((volatile __local\n                                int64_t *) scan_arr_mem_21153)[sext_i32_i64(local_tid_21149) -\n                                                               sext_i32_i64(skip_threads_21160)];\n                }\n                // perform operation\n                {\n                    int64_t res_18295 = add64(x_18293, x_18294);\n                    \n                    x_18293 = res_18295;\n                }\n            }\n            if (sle32(wave_sizze_21151, skip_threads_21160)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_21160, local_tid_21149 -\n                      squot32(local_tid_21149, 32) * 32) &&\n                ltid_in_bounds_21159) {\n                // write result\n                {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_21153)[sext_i32_i64(local_tid_21149)] =\n                        x_18293;\n                    x_18294 = x_18293;\n                }\n            }\n            if (sle32(wave_sizze_21151, skip_threads_21160)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_21160 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_21149 - squot32(local_tid_21149, 32) * 32) == 31 &&\n            ltid_in_bounds_21159) {\n            ((volatile __local\n              int64_t *) sca",
                   "n_arr_mem_21153)[sext_i32_i64(squot32(local_tid_21149,\n                                                                  32))] =\n                x_18293;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_21161;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_21149, 32) == 0 && ltid_in_bounds_21159) {\n                x_21157 = ((volatile __local\n                            int64_t *) scan_arr_mem_21153)[sext_i32_i64(local_tid_21149)];\n                if ((local_tid_21149 - squot32(local_tid_21149, 32) * 32) ==\n                    0) {\n                    x_21156 = x_21157;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_21161 = 1;\n            while (slt32(skip_threads_21161, 32)) {\n                if (sle32(skip_threads_21161, local_tid_21149 -\n                          squot32(local_tid_21149, 32) * 32) &&\n                    (squot32(local_tid_21149, 32) == 0 &&\n                     ltid_in_bounds_21159)) {\n                    // read operands\n                    {\n                        x_21156 = ((volatile __local\n                                    int64_t *) scan_arr_mem_21153)[sext_i32_i64(local_tid_21149) -\n                                                                   sext_i32_i64(skip_threads_21161)];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_21158 = add64(x_21156, x_21157);\n                        \n                        x_21156 = res_21158;\n                    }\n                }\n                if (sle32(wave_sizze_21151, skip_threads_21161)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_21161, local_tid_21149 -\n                          squot32(local_tid_21149, ",
                   "32) * 32) &&\n                    (squot32(local_tid_21149, 32) == 0 &&\n                     ltid_in_bounds_21159)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_21153)[sext_i32_i64(local_tid_21149)] =\n                            x_21156;\n                        x_21157 = x_21156;\n                    }\n                }\n                if (sle32(wave_sizze_21151, skip_threads_21161)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_21161 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_21149, 32) == 0 || !ltid_in_bounds_21159)) {\n            // read operands\n            {\n                x_18294 = x_18293;\n                x_18293 = ((__local\n                            int64_t *) scan_arr_mem_21153)[sext_i32_i64(squot32(local_tid_21149,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                int64_t res_18295 = add64(x_18293, x_18294);\n                \n                x_18293 = res_18295;\n            }\n            // write final result\n            {\n                ((__local\n                  int64_t *) scan_arr_mem_21153)[sext_i32_i64(local_tid_21149)] =\n                    x_18293;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_21149, 32) == 0) {\n            ((__local\n              int64_t *) scan_arr_mem_21153)[sext_i32_i64(local_tid_21149)] =\n                x_18294;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_19605, res_18101)) {\n            ((__global int6",
                   "4_t *) mem_20384)[gtid_19605] = ((__local\n                                                             int64_t *) scan_arr_mem_21153)[sext_i32_i64(local_tid_21149)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_19601\n}\n__kernel void mainziscan_stage3_19505(__global int *global_failure,\n                                      int64_t num_groups_19502,\n                                      int64_t binop_x_20308, __global\n                                      unsigned char *mem_20356,\n                                      int32_t num_threads_20686,\n                                      int32_t required_groups_20722)\n{\n    #define segscan_group_sizze_19500 (mainzisegscan_group_sizze_19499)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20723;\n    int32_t local_tid_20724;\n    int64_t group_sizze_20727;\n    int32_t wave_sizze_20726;\n    int32_t group_tid_20725;\n    \n    global_tid_20723 = get_global_id(0);\n    local_tid_20724 = get_local_id(0);\n    group_sizze_20727 = get_local_size(0);\n    wave_sizze_20726 = LOCKSTEP_WIDTH;\n    group_tid_20725 = get_group_id(0);\n    \n    int32_t phys_tid_19505;\n    \n    phys_tid_19505 = global_tid_20723;\n    \n    int32_t phys_group_id_20728;\n    \n    phys_group_id_20728 = get_group_id(0);\n    for (int32_t i_20729 = 0; i_20729 < sdiv_up32(required_groups_20722 -\n                                                  phys_group_id_20728,\n                                                  sext_i64_i32(num_groups_19502));\n         i_20729++) {\n        int32_t virt_group_id_20730 = phys_group_id_20728 + i_20729 *\n                sext_i64_i32(num_groups_19502);\n        int64_t flat_idx_20731 = sext_i32_i64(virt_group_id_20730) *\n                segscan_group_sizze_19500 + sext_i32_i64(local_tid_20724);\n        int64_t gtid_19504 = flat_idx_20731;\n        int64_t orig_group_20732 = squot64(flat_idx",
                   "_20731,\n                                           segscan_group_sizze_19500 *\n                                           sdiv_up64(binop_x_20308,\n                                                     sext_i32_i64(num_threads_20686)));\n        int64_t carry_in_flat_idx_20733 = orig_group_20732 *\n                (segscan_group_sizze_19500 * sdiv_up64(binop_x_20308,\n                                                       sext_i32_i64(num_threads_20686))) -\n                1;\n        \n        if (slt64(gtid_19504, binop_x_20308)) {\n            if (!(orig_group_20732 == 0 || flat_idx_20731 == (orig_group_20732 +\n                                                              1) *\n                  (segscan_group_sizze_19500 * sdiv_up64(binop_x_20308,\n                                                         sext_i32_i64(num_threads_20686))) -\n                  1)) {\n                int64_t x_18085;\n                int64_t x_18086;\n                \n                x_18085 = ((__global\n                            int64_t *) mem_20356)[carry_in_flat_idx_20733];\n                x_18086 = ((__global int64_t *) mem_20356)[gtid_19504];\n                \n                int64_t res_18087;\n                \n                res_18087 = add64(x_18085, x_18086);\n                x_18085 = res_18087;\n                ((__global int64_t *) mem_20356)[gtid_19504] = x_18085;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_19500\n}\n__kernel void mainziscan_stage3_19538(__global int *global_failure,\n                                      int64_t res_18101,\n                                      int64_t num_groups_19535, __global\n                                      unsigned char *mem_20367, __global\n                                      unsigned char *mem_20369,\n                                      int32_t num_threads_20925,\n                                      int32_t required_groups_20977)\n{\n  ",
                   "  #define segscan_group_sizze_19533 (mainzisegscan_group_sizze_19532)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20978;\n    int32_t local_tid_20979;\n    int64_t group_sizze_20982;\n    int32_t wave_sizze_20981;\n    int32_t group_tid_20980;\n    \n    global_tid_20978 = get_global_id(0);\n    local_tid_20979 = get_local_id(0);\n    group_sizze_20982 = get_local_size(0);\n    wave_sizze_20981 = LOCKSTEP_WIDTH;\n    group_tid_20980 = get_group_id(0);\n    \n    int32_t phys_tid_19538;\n    \n    phys_tid_19538 = global_tid_20978;\n    \n    int32_t phys_group_id_20983;\n    \n    phys_group_id_20983 = get_group_id(0);\n    for (int32_t i_20984 = 0; i_20984 < sdiv_up32(required_groups_20977 -\n                                                  phys_group_id_20983,\n                                                  sext_i64_i32(num_groups_19535));\n         i_20984++) {\n        int32_t virt_group_id_20985 = phys_group_id_20983 + i_20984 *\n                sext_i64_i32(num_groups_19535);\n        int64_t flat_idx_20986 = sext_i32_i64(virt_group_id_20985) *\n                segscan_group_sizze_19533 + sext_i32_i64(local_tid_20979);\n        int64_t gtid_19537 = flat_idx_20986;\n        int64_t orig_group_20987 = squot64(flat_idx_20986,\n                                           segscan_group_sizze_19533 *\n                                           sdiv_up64(res_18101,\n                                                     sext_i32_i64(num_threads_20925)));\n        int64_t carry_in_flat_idx_20988 = orig_group_20987 *\n                (segscan_group_sizze_19533 * sdiv_up64(res_18101,\n                                                       sext_i32_i64(num_threads_20925))) -\n                1;\n        \n        if (slt64(gtid_19537, res_18101)) {\n            if (!(orig_group_20987 == 0 || flat_idx_20986 == (orig_group_20987 +\n                                                   ",
                   "           1) *\n                  (segscan_group_sizze_19533 * sdiv_up64(res_18101,\n                                                         sext_i32_i64(num_threads_20925))) -\n                  1)) {\n                bool x_18120;\n                int64_t x_18121;\n                bool x_18122;\n                int64_t x_18123;\n                \n                x_18120 = ((__global\n                            bool *) mem_20367)[carry_in_flat_idx_20988];\n                x_18121 = ((__global\n                            int64_t *) mem_20369)[carry_in_flat_idx_20988];\n                x_18122 = ((__global bool *) mem_20367)[gtid_19537];\n                x_18123 = ((__global int64_t *) mem_20369)[gtid_19537];\n                \n                bool res_18124;\n                \n                res_18124 = x_18120 || x_18122;\n                \n                int64_t res_18125;\n                \n                if (x_18122) {\n                    res_18125 = x_18123;\n                } else {\n                    int64_t res_18126 = add64(x_18121, x_18123);\n                    \n                    res_18125 = res_18126;\n                }\n                x_18120 = res_18124;\n                x_18121 = res_18125;\n                ((__global bool *) mem_20367)[gtid_19537] = x_18120;\n                ((__global int64_t *) mem_20369)[gtid_19537] = x_18121;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_19533\n}\n__kernel void mainziscan_stage3_19546(__global int *global_failure,\n                                      int64_t res_18101,\n                                      int64_t num_groups_19543, __global\n                                      unsigned char *mem_20372, __global\n                                      unsigned char *mem_20374,\n                                      int32_t num_threads_20992,\n                                      int32_t required_groups_21044)\n{\n    #define segscan_g",
                   "roup_sizze_19541 (mainzisegscan_group_sizze_19540)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21045;\n    int32_t local_tid_21046;\n    int64_t group_sizze_21049;\n    int32_t wave_sizze_21048;\n    int32_t group_tid_21047;\n    \n    global_tid_21045 = get_global_id(0);\n    local_tid_21046 = get_local_id(0);\n    group_sizze_21049 = get_local_size(0);\n    wave_sizze_21048 = LOCKSTEP_WIDTH;\n    group_tid_21047 = get_group_id(0);\n    \n    int32_t phys_tid_19546;\n    \n    phys_tid_19546 = global_tid_21045;\n    \n    int32_t phys_group_id_21050;\n    \n    phys_group_id_21050 = get_group_id(0);\n    for (int32_t i_21051 = 0; i_21051 < sdiv_up32(required_groups_21044 -\n                                                  phys_group_id_21050,\n                                                  sext_i64_i32(num_groups_19543));\n         i_21051++) {\n        int32_t virt_group_id_21052 = phys_group_id_21050 + i_21051 *\n                sext_i64_i32(num_groups_19543);\n        int64_t flat_idx_21053 = sext_i32_i64(virt_group_id_21052) *\n                segscan_group_sizze_19541 + sext_i32_i64(local_tid_21046);\n        int64_t gtid_19545 = flat_idx_21053;\n        int64_t orig_group_21054 = squot64(flat_idx_21053,\n                                           segscan_group_sizze_19541 *\n                                           sdiv_up64(res_18101,\n                                                     sext_i32_i64(num_threads_20992)));\n        int64_t carry_in_flat_idx_21055 = orig_group_21054 *\n                (segscan_group_sizze_19541 * sdiv_up64(res_18101,\n                                                       sext_i32_i64(num_threads_20992))) -\n                1;\n        \n        if (slt64(gtid_19545, res_18101)) {\n            if (!(orig_group_21054 == 0 || flat_idx_21053 == (orig_group_21054 +\n                                                              1) *\n   ",
                   "               (segscan_group_sizze_19541 * sdiv_up64(res_18101,\n                                                         sext_i32_i64(num_threads_20992))) -\n                  1)) {\n                bool x_18160;\n                int64_t x_18161;\n                bool x_18162;\n                int64_t x_18163;\n                \n                x_18160 = ((__global\n                            bool *) mem_20372)[carry_in_flat_idx_21055];\n                x_18161 = ((__global\n                            int64_t *) mem_20374)[carry_in_flat_idx_21055];\n                x_18162 = ((__global bool *) mem_20372)[gtid_19545];\n                x_18163 = ((__global int64_t *) mem_20374)[gtid_19545];\n                \n                bool res_18164;\n                \n                res_18164 = x_18160 || x_18162;\n                \n                int64_t res_18165;\n                \n                if (x_18162) {\n                    res_18165 = x_18163;\n                } else {\n                    int64_t res_18166 = add64(x_18161, x_18163);\n                    \n                    res_18165 = res_18166;\n                }\n                x_18160 = res_18164;\n                x_18161 = res_18165;\n                ((__global bool *) mem_20372)[gtid_19545] = x_18160;\n                ((__global int64_t *) mem_20374)[gtid_19545] = x_18161;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_19541\n}\n__kernel void mainziscan_stage3_19554(__global int *global_failure,\n                                      int64_t res_18101,\n                                      int64_t num_groups_19551, __global\n                                      unsigned char *mem_20379, __global\n                                      unsigned char *mem_20381,\n                                      int32_t num_threads_21059,\n                                      int32_t required_groups_21111)\n{\n    #define segscan_group_sizze_19549 (m",
                   "ainzisegscan_group_sizze_19548)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21112;\n    int32_t local_tid_21113;\n    int64_t group_sizze_21116;\n    int32_t wave_sizze_21115;\n    int32_t group_tid_21114;\n    \n    global_tid_21112 = get_global_id(0);\n    local_tid_21113 = get_local_id(0);\n    group_sizze_21116 = get_local_size(0);\n    wave_sizze_21115 = LOCKSTEP_WIDTH;\n    group_tid_21114 = get_group_id(0);\n    \n    int32_t phys_tid_19554;\n    \n    phys_tid_19554 = global_tid_21112;\n    \n    int32_t phys_group_id_21117;\n    \n    phys_group_id_21117 = get_group_id(0);\n    for (int32_t i_21118 = 0; i_21118 < sdiv_up32(required_groups_21111 -\n                                                  phys_group_id_21117,\n                                                  sext_i64_i32(num_groups_19551));\n         i_21118++) {\n        int32_t virt_group_id_21119 = phys_group_id_21117 + i_21118 *\n                sext_i64_i32(num_groups_19551);\n        int64_t flat_idx_21120 = sext_i32_i64(virt_group_id_21119) *\n                segscan_group_sizze_19549 + sext_i32_i64(local_tid_21113);\n        int64_t gtid_19553 = flat_idx_21120;\n        int64_t orig_group_21121 = squot64(flat_idx_21120,\n                                           segscan_group_sizze_19549 *\n                                           sdiv_up64(res_18101,\n                                                     sext_i32_i64(num_threads_21059)));\n        int64_t carry_in_flat_idx_21122 = orig_group_21121 *\n                (segscan_group_sizze_19549 * sdiv_up64(res_18101,\n                                                       sext_i32_i64(num_threads_21059))) -\n                1;\n        \n        if (slt64(gtid_19553, res_18101)) {\n            if (!(orig_group_21121 == 0 || flat_idx_21120 == (orig_group_21121 +\n                                                              1) *\n                  (seg",
                   "scan_group_sizze_19549 * sdiv_up64(res_18101,\n                                                         sext_i32_i64(num_threads_21059))) -\n                  1)) {\n                bool x_18186;\n                float x_18187;\n                bool x_18188;\n                float x_18189;\n                \n                x_18186 = ((__global\n                            bool *) mem_20379)[carry_in_flat_idx_21122];\n                x_18187 = ((__global\n                            float *) mem_20381)[carry_in_flat_idx_21122];\n                x_18188 = ((__global bool *) mem_20379)[gtid_19553];\n                x_18189 = ((__global float *) mem_20381)[gtid_19553];\n                \n                bool res_18190;\n                \n                res_18190 = x_18186 || x_18188;\n                \n                float res_18191;\n                \n                if (x_18188) {\n                    res_18191 = x_18189;\n                } else {\n                    float res_18192 = x_18187 + x_18189;\n                    \n                    res_18191 = res_18192;\n                }\n                x_18186 = res_18190;\n                x_18187 = res_18191;\n                ((__global bool *) mem_20379)[gtid_19553] = x_18186;\n                ((__global float *) mem_20381)[gtid_19553] = x_18187;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_19549\n}\n__kernel void mainziscan_stage3_19606(__global int *global_failure,\n                                      int64_t res_18101,\n                                      int64_t num_groups_19603, __global\n                                      unsigned char *mem_20384,\n                                      int32_t num_threads_21126,\n                                      int32_t required_groups_21162)\n{\n    #define segscan_group_sizze_19601 (mainzisegscan_group_sizze_19600)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int b",
                   "lock_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21163;\n    int32_t local_tid_21164;\n    int64_t group_sizze_21167;\n    int32_t wave_sizze_21166;\n    int32_t group_tid_21165;\n    \n    global_tid_21163 = get_global_id(0);\n    local_tid_21164 = get_local_id(0);\n    group_sizze_21167 = get_local_size(0);\n    wave_sizze_21166 = LOCKSTEP_WIDTH;\n    group_tid_21165 = get_group_id(0);\n    \n    int32_t phys_tid_19606;\n    \n    phys_tid_19606 = global_tid_21163;\n    \n    int32_t phys_group_id_21168;\n    \n    phys_group_id_21168 = get_group_id(0);\n    for (int32_t i_21169 = 0; i_21169 < sdiv_up32(required_groups_21162 -\n                                                  phys_group_id_21168,\n                                                  sext_i64_i32(num_groups_19603));\n         i_21169++) {\n        int32_t virt_group_id_21170 = phys_group_id_21168 + i_21169 *\n                sext_i64_i32(num_groups_19603);\n        int64_t flat_idx_21171 = sext_i32_i64(virt_group_id_21170) *\n                segscan_group_sizze_19601 + sext_i32_i64(local_tid_21164);\n        int64_t gtid_19605 = flat_idx_21171;\n        int64_t orig_group_21172 = squot64(flat_idx_21171,\n                                           segscan_group_sizze_19601 *\n                                           sdiv_up64(res_18101,\n                                                     sext_i32_i64(num_threads_21126)));\n        int64_t carry_in_flat_idx_21173 = orig_group_21172 *\n                (segscan_group_sizze_19601 * sdiv_up64(res_18101,\n                                                       sext_i32_i64(num_threads_21126))) -\n                1;\n        \n        if (slt64(gtid_19605, res_18101)) {\n            if (!(orig_group_21172 == 0 || flat_idx_21171 == (orig_group_21172 +\n                                                              1) *\n                  (segscan_group_sizze_19601 * sdiv_up64(res_18101,\n                                                         sext_i32_",
                   "i64(num_threads_21126))) -\n                  1)) {\n                int64_t x_18293;\n                int64_t x_18294;\n                \n                x_18293 = ((__global\n                            int64_t *) mem_20384)[carry_in_flat_idx_21173];\n                x_18294 = ((__global int64_t *) mem_20384)[gtid_19605];\n                \n                int64_t res_18295;\n                \n                res_18295 = add64(x_18293, x_18294);\n                x_18293 = res_18295;\n                ((__global int64_t *) mem_20384)[gtid_19605] = x_18293;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_19601\n}\n__kernel void mainziseghist_global_19523(__global int *global_failure,\n                                         int64_t res_18101,\n                                         int64_t num_groups_19520,\n                                         int64_t binop_x_20308, __global\n                                         unsigned char *mem_20356,\n                                         int32_t num_subhistos_20775, __global\n                                         unsigned char *res_subhistos_mem_20776,\n                                         __global\n                                         unsigned char *mainzihist_locks_mem_20846,\n                                         int32_t chk_i_20848,\n                                         int64_t hist_H_chk_20849)\n{\n    #define seghist_group_sizze_19518 (mainziseghist_group_sizze_19517)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20850;\n    int32_t local_tid_20851;\n    int64_t group_sizze_20854;\n    int32_t wave_sizze_20853;\n    int32_t group_tid_20852;\n    \n    global_tid_20850 = get_global_id(0);\n    local_tid_20851 = get_local_id(0);\n    group_sizze_20854 = get_local_size(0);\n    wave_sizze_20853 = LOCKST",
                   "EP_WIDTH;\n    group_tid_20852 = get_group_id(0);\n    \n    int32_t phys_tid_19523;\n    \n    phys_tid_19523 = global_tid_20850;\n    \n    int32_t subhisto_ind_20855;\n    \n    subhisto_ind_20855 = squot32(global_tid_20850,\n                                 sdiv_up32(sext_i64_i32(seghist_group_sizze_19518 *\n                                           num_groups_19520),\n                                           num_subhistos_20775));\n    for (int64_t i_20856 = 0; i_20856 < sdiv_up64(binop_x_20308 -\n                                                  sext_i32_i64(global_tid_20850),\n                                                  sext_i32_i64(sext_i64_i32(seghist_group_sizze_19518 *\n                                                  num_groups_19520)));\n         i_20856++) {\n        int32_t gtid_19522 = sext_i64_i32(i_20856 *\n                sext_i32_i64(sext_i64_i32(seghist_group_sizze_19518 *\n                num_groups_19520)) + sext_i32_i64(global_tid_20850));\n        \n        if (slt64(i_20856 *\n                  sext_i32_i64(sext_i64_i32(seghist_group_sizze_19518 *\n                  num_groups_19520)) + sext_i32_i64(global_tid_20850),\n                  binop_x_20308)) {\n            int64_t i_p_o_20128 = add64(-1, gtid_19522);\n            int64_t rot_i_20129 = smod64(i_p_o_20128, binop_x_20308);\n            bool cond_19529 = gtid_19522 == 0;\n            int64_t res_19530;\n            \n            if (cond_19529) {\n                res_19530 = 0;\n            } else {\n                int64_t x_19528 = ((__global int64_t *) mem_20356)[rot_i_20129];\n                \n                res_19530 = x_19528;\n            }\n            // save map-out results\n            { }\n            // perform atomic updates\n            {\n                if (sle64(sext_i32_i64(chk_i_20848) * hist_H_chk_20849,\n                          res_19530) && (slt64(res_19530,\n                                               sext_i32_i64(chk_i_20848) *\n                                               hist_H_chk_",
                   "20849 +\n                                               hist_H_chk_20849) &&\n                                         slt64(res_19530, res_18101))) {\n                    int64_t x_19524;\n                    int64_t x_19525;\n                    \n                    x_19525 = gtid_19522;\n                    \n                    int32_t old_20857;\n                    volatile bool continue_20858;\n                    \n                    continue_20858 = 1;\n                    while (continue_20858) {\n                        old_20857 =\n                            atomic_cmpxchg_i32_global(&((volatile __global\n                                                         int *) mainzihist_locks_mem_20846)[srem64(sext_i32_i64(subhisto_ind_20855) *\n                                                                                                   res_18101 +\n                                                                                                   res_19530,\n                                                                                                   100151)],\n                                                      0, 1);\n                        if (old_20857 == 0) {\n                            int64_t x_19524;\n                            \n                            // bind lhs\n                            {\n                                x_19524 = ((volatile __global\n                                            int64_t *) res_subhistos_mem_20776)[sext_i32_i64(subhisto_ind_20855) *\n                                                                                res_18101 +\n                                                                                res_19530];\n                            }\n                            // execute operation\n                            {\n                                int64_t res_19526 = smax64(x_19524, x_19525);\n                                \n                                x_19524 = res_19526;\n                            }\n        ",
                   "                    // update global result\n                            {\n                                ((volatile __global\n                                  int64_t *) res_subhistos_mem_20776)[sext_i32_i64(subhisto_ind_20855) *\n                                                                      res_18101 +\n                                                                      res_19530] =\n                                    x_19524;\n                            }\n                            mem_fence_global();\n                            old_20857 =\n                                atomic_cmpxchg_i32_global(&((volatile __global\n                                                             int *) mainzihist_locks_mem_20846)[srem64(sext_i32_i64(subhisto_ind_20855) *\n                                                                                                       res_18101 +\n                                                                                                       res_19530,\n                                                                                                       100151)],\n                                                          1, 0);\n                            continue_20858 = 0;\n                        }\n                        mem_fence_global();\n                    }\n                }\n            }\n        }\n    }\n    \n  error_0:\n    return;\n    #undef seghist_group_sizze_19518\n}\n__kernel void mainziseghist_local_19523(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *locks_mem_20816_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *subhistogram_local_mem_20814_backing_aligned_1,\n                                        int64_t res_18101,\n                                        int64_t binop_x_20308, __global\n                                        unsigned char *mem_20356, ",
                   "__global\n                                        unsigned char *res_subhistos_mem_20776,\n                                        int32_t max_group_sizze_20785,\n                                        int64_t num_groups_20786,\n                                        int32_t hist_M_20792,\n                                        int32_t chk_i_20797,\n                                        int64_t num_segments_20798,\n                                        int64_t hist_H_chk_20799,\n                                        int64_t histo_sizze_20800,\n                                        int32_t init_per_thread_20801)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict locks_mem_20816_backing_1 =\n                          (__local volatile\n                           char *) locks_mem_20816_backing_aligned_0;\n    __local volatile char *restrict subhistogram_local_mem_20814_backing_0 =\n                          (__local volatile\n                           char *) subhistogram_local_mem_20814_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20802;\n    int32_t local_tid_20803;\n    int64_t group_sizze_20806;\n    int32_t wave_sizze_20805;\n    int32_t group_tid_20804;\n    \n    global_tid_20802 = get_global_id(0);\n    local_tid_20803 = get_local_id(0);\n    group_sizze_20806 = get_local_size(0);\n    wave_sizze_20805 = LOCKSTEP_WIDTH;\n    group_tid_20804 = get_group_id(0);\n    \n    int32_t phys_tid_19523;\n    \n    phys_tid_19523 = global_tid_20802;\n    \n    int32_t phys_group_id_20807;\n    \n    phys_group_id_20807 = get_group_id(0);\n    for (int32_t i_20808 = 0; i_20808 <\n         sdiv_up32(sext_i64_i32(num_groups_20786 * num_segments_20798) -\n                   phys_group_id_20807, sext_i64_i32(num_groups_20786));\n         i_20808++) {\n        int32_t virt_group_id_20809 = phys_group_id_20807 + i_20808 *\n                sext_i64_i32(num_groups_20786);\n     ",
                   "   int32_t flat_segment_id_20810 = squot32(virt_group_id_20809,\n                                                sext_i64_i32(num_groups_20786));\n        int32_t gid_in_segment_20811 = srem32(virt_group_id_20809,\n                                              sext_i64_i32(num_groups_20786));\n        int32_t pgtid_in_segment_20812 = gid_in_segment_20811 *\n                sext_i64_i32(max_group_sizze_20785) + local_tid_20803;\n        int32_t threads_per_segment_20813 = sext_i64_i32(num_groups_20786 *\n                max_group_sizze_20785);\n        __local char *subhistogram_local_mem_20814;\n        \n        subhistogram_local_mem_20814 = (__local\n                                        char *) subhistogram_local_mem_20814_backing_0;\n        \n        __local char *locks_mem_20816;\n        \n        locks_mem_20816 = (__local char *) locks_mem_20816_backing_1;\n        // All locks start out unlocked\n        {\n            for (int64_t i_20818 = 0; i_20818 < sdiv_up64(hist_M_20792 *\n                                                          hist_H_chk_20799 -\n                                                          sext_i32_i64(local_tid_20803),\n                                                          max_group_sizze_20785);\n                 i_20818++) {\n                ((__local int32_t *) locks_mem_20816)[squot64(i_20818 *\n                                                              max_group_sizze_20785 +\n                                                              sext_i32_i64(local_tid_20803),\n                                                              hist_H_chk_20799) *\n                                                      hist_H_chk_20799 +\n                                                      (i_20818 *\n                                                       max_group_sizze_20785 +\n                                                       sext_i32_i64(local_tid_20803) -\n                                                       squot64(i_20818 *\n                       ",
                   "                                        max_group_sizze_20785 +\n                                                               sext_i32_i64(local_tid_20803),\n                                                               hist_H_chk_20799) *\n                                                       hist_H_chk_20799)] = 0;\n            }\n        }\n        \n        int32_t thread_local_subhisto_i_20819;\n        \n        thread_local_subhisto_i_20819 = srem32(local_tid_20803, hist_M_20792);\n        // initialize histograms in local memory\n        {\n            for (int32_t local_i_20820 = 0; local_i_20820 <\n                 init_per_thread_20801; local_i_20820++) {\n                int32_t j_20821 = local_i_20820 *\n                        sext_i64_i32(max_group_sizze_20785) + local_tid_20803;\n                int32_t j_offset_20822 = hist_M_20792 *\n                        sext_i64_i32(histo_sizze_20800) * gid_in_segment_20811 +\n                        j_20821;\n                int32_t local_subhisto_i_20823 = squot32(j_20821,\n                                                         sext_i64_i32(histo_sizze_20800));\n                int32_t global_subhisto_i_20824 = squot32(j_offset_20822,\n                                                          sext_i64_i32(histo_sizze_20800));\n                \n                if (slt32(j_20821, hist_M_20792 *\n                          sext_i64_i32(histo_sizze_20800))) {\n                    // First subhistogram is initialised from global memory; others with neutral element.\n                    {\n                        if (global_subhisto_i_20824 == 0) {\n                            ((__local\n                              int64_t *) subhistogram_local_mem_20814)[sext_i32_i64(local_subhisto_i_20823) *\n                                                                       hist_H_chk_20799 +\n                                                                       sext_i32_i64(srem32(j_20821,\n                                                         ",
                   "                                  sext_i64_i32(histo_sizze_20800)))] =\n                                ((__global\n                                  int64_t *) res_subhistos_mem_20776)[sext_i32_i64(srem32(j_20821,\n                                                                                          sext_i64_i32(histo_sizze_20800))) +\n                                                                      sext_i32_i64(chk_i_20797) *\n                                                                      hist_H_chk_20799];\n                        } else {\n                            ((__local\n                              int64_t *) subhistogram_local_mem_20814)[sext_i32_i64(local_subhisto_i_20823) *\n                                                                       hist_H_chk_20799 +\n                                                                       sext_i32_i64(srem32(j_20821,\n                                                                                           sext_i64_i32(histo_sizze_20800)))] =\n                                0;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_20825 = 0; i_20825 <\n             sdiv_up32(sext_i64_i32(binop_x_20308) - pgtid_in_segment_20812,\n                       threads_per_segment_20813); i_20825++) {\n            int32_t gtid_19522 = i_20825 * threads_per_segment_20813 +\n                    pgtid_in_segment_20812;\n            int64_t i_p_o_20128 = add64(-1, gtid_19522);\n            int64_t rot_i_20129 = smod64(i_p_o_20128, binop_x_20308);\n            bool cond_19529 = gtid_19522 == 0;\n            int64_t res_19530;\n            \n            if (cond_19529) {\n                res_19530 = 0;\n            } else {\n                int64_t x_19528 = ((__global int64_t *) mem_20356)[rot_i_20129];\n                \n                res_19530 = x_19528;\n            }\n            if (chk_i_20797 == 0) {\n                // save map",
                   "-out results\n                { }\n            }\n            // perform atomic updates\n            {\n                if (slt64(res_19530, res_18101) &&\n                    (sle64(sext_i32_i64(chk_i_20797) * hist_H_chk_20799,\n                           res_19530) && slt64(res_19530,\n                                               sext_i32_i64(chk_i_20797) *\n                                               hist_H_chk_20799 +\n                                               hist_H_chk_20799))) {\n                    int64_t x_19524;\n                    int64_t x_19525;\n                    \n                    x_19525 = gtid_19522;\n                    \n                    int32_t old_20826;\n                    volatile bool continue_20827;\n                    \n                    continue_20827 = 1;\n                    while (continue_20827) {\n                        old_20826 = atomic_cmpxchg_i32_local(&((volatile __local\n                                                                int *) locks_mem_20816)[sext_i32_i64(thread_local_subhisto_i_20819) *\n                                                                                        hist_H_chk_20799 +\n                                                                                        (res_19530 -\n                                                                                         sext_i32_i64(chk_i_20797) *\n                                                                                         hist_H_chk_20799)],\n                                                             0, 1);\n                        if (old_20826 == 0) {\n                            int64_t x_19524;\n                            \n                            // bind lhs\n                            {\n                                x_19524 = ((volatile __local\n                                            int64_t *) subhistogram_local_mem_20814)[sext_i32_i64(thread_local_subhisto_i_20819) *\n                                                         ",
                   "                            hist_H_chk_20799 +\n                                                                                     (res_19530 -\n                                                                                      sext_i32_i64(chk_i_20797) *\n                                                                                      hist_H_chk_20799)];\n                            }\n                            // execute operation\n                            {\n                                int64_t res_19526 = smax64(x_19524, x_19525);\n                                \n                                x_19524 = res_19526;\n                            }\n                            // update global result\n                            {\n                                ((volatile __local\n                                  int64_t *) subhistogram_local_mem_20814)[sext_i32_i64(thread_local_subhisto_i_20819) *\n                                                                           hist_H_chk_20799 +\n                                                                           (res_19530 -\n                                                                            sext_i32_i64(chk_i_20797) *\n                                                                            hist_H_chk_20799)] =\n                                    x_19524;\n                            }\n                            mem_fence_local();\n                            old_20826 =\n                                atomic_cmpxchg_i32_local(&((volatile __local\n                                                            int *) locks_mem_20816)[sext_i32_i64(thread_local_subhisto_i_20819) *\n                                                                                    hist_H_chk_20799 +\n                                                                                    (res_19530 -\n                                                                                     sext_i32_i64(chk_i_20797) *\n             ",
                   "                                                                        hist_H_chk_20799)],\n                                                         1, 0);\n                            continue_20827 = 0;\n                        }\n                        mem_fence_local();\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Compact the multiple local memory subhistograms to result in global memory\n        {\n            int64_t trunc_H_20828 = smin64(hist_H_chk_20799, res_18101 -\n                                           sext_i32_i64(chk_i_20797) *\n                                           hist_H_chk_20799);\n            int32_t histo_sizze_20829 = sext_i64_i32(trunc_H_20828);\n            \n            for (int32_t local_i_20830 = 0; local_i_20830 <\n                 init_per_thread_20801; local_i_20830++) {\n                int32_t j_20831 = local_i_20830 *\n                        sext_i64_i32(max_group_sizze_20785) + local_tid_20803;\n                \n                if (slt32(j_20831, histo_sizze_20829)) {\n                    int64_t x_19524;\n                    int64_t x_19525;\n                    \n                    // Read values from subhistogram 0.\n                    {\n                        x_19524 = ((__local\n                                    int64_t *) subhistogram_local_mem_20814)[sext_i32_i64(j_20831)];\n                    }\n                    // Accumulate based on values in other subhistograms.\n                    {\n                        for (int32_t subhisto_id_20832 = 0; subhisto_id_20832 <\n                             hist_M_20792 - 1; subhisto_id_20832++) {\n                            x_19525 = ((__local\n                                        int64_t *) subhistogram_local_mem_20814)[(sext_i32_i64(subhisto_id_20832) +\n                                                                                  1) *\n                                                                                 h",
                   "ist_H_chk_20799 +\n                                                                                 sext_i32_i64(j_20831)];\n                            \n                            int64_t res_19526;\n                            \n                            res_19526 = smax64(x_19524, x_19525);\n                            x_19524 = res_19526;\n                        }\n                    }\n                    // Put final bucket value in global memory.\n                    {\n                        ((__global\n                          int64_t *) res_subhistos_mem_20776)[srem64(sext_i32_i64(virt_group_id_20809),\n                                                                     num_groups_20786) *\n                                                              res_18101 +\n                                                              (sext_i32_i64(j_20831) +\n                                                               sext_i32_i64(chk_i_20797) *\n                                                               hist_H_chk_20799)] =\n                            x_19524;\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\n__kernel void mainzisegmap_18400(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args, int64_t n_17882,\n                                 float a_17890, float r0_17893, float x_17910,\n                                 float x_17912, float y_17914, float y_17915,\n                                 __global unsigned char *swap_term_mem_20224,\n                                 __global unsigned char *payments_mem_20225,\n                                 __global unsigned char *mem_20238, __global\n                                 unsigned char *mem_20252,\n                                 int64_t num_threads_20444)\n{\n    #define segmap_group_sizze_18478 (ma",
                   "inzisegmap_group_sizze_18402)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20593;\n    int32_t local_tid_20594;\n    int64_t group_sizze_20597;\n    int32_t wave_sizze_20596;\n    int32_t group_tid_20595;\n    \n    global_tid_20593 = get_global_id(0);\n    local_tid_20594 = get_local_id(0);\n    group_sizze_20597 = get_local_size(0);\n    wave_sizze_20596 = LOCKSTEP_WIDTH;\n    group_tid_20595 = get_group_id(0);\n    \n    int32_t phys_tid_18400;\n    \n    phys_tid_18400 = global_tid_20593;\n    \n    int64_t gtid_18399;\n    \n    gtid_18399 = sext_i32_i64(group_tid_20595) * segmap_group_sizze_18478 +\n        sext_i32_i64(local_tid_20594);\n    if (slt64(gtid_18399, n_17882)) {\n        float res_18489 = ((__global float *) swap_term_mem_20224)[gtid_18399];\n        int64_t res_18490 = ((__global\n                              int64_t *) payments_mem_20225)[gtid_18399];\n        int64_t range_end_18492 = sub64(res_18490, 1);\n        bool bounds_invalid_upwards_18493 = slt64(range_end_18492, 0);\n        bool valid_18494 = !bounds_invalid_upwards_18493;\n        bool range_valid_c_18495;\n        \n        if (!valid_18494) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 0) == -1) {\n                    global_failure_args[0] = 0;\n                    global_failure_args[1] = 1;\n                    global_failure_args[2] = range_end_18492;\n                    ;\n                }\n                return;\n            }\n        }\n        for (int64_t i_20191 = 0; i_20191 < res_18490; i_20191++) {\n            float res_18499 = sitofp_i64_f32(i_20191);\n            float res_18500 = res_18489 * res_18499;\n            \n            ((__global float *) mem_20238)[phys_tid_18400 + i_20191 *\n                                           num_threads_20444] = res_18500;\n        }\n        \n        bool y_18501 = slt64(0, res_18490);\n        bool inde",
                   "x_certs_18502;\n        \n        if (!y_18501) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 1) == -1) {\n                    global_failure_args[0] = 0;\n                    global_failure_args[1] = res_18490;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        float binop_y_18503 = sitofp_i64_f32(range_end_18492);\n        float index_primexp_18504 = res_18489 * binop_y_18503;\n        float negate_arg_18505 = a_17890 * index_primexp_18504;\n        float exp_arg_18506 = 0.0F - negate_arg_18505;\n        float res_18507 = fpow32(2.7182817F, exp_arg_18506);\n        float x_18508 = 1.0F - res_18507;\n        float B_18509 = x_18508 / a_17890;\n        float x_18510 = B_18509 - index_primexp_18504;\n        float x_18511 = y_17914 * x_18510;\n        float A1_18512 = x_18511 / x_17910;\n        float y_18513 = fpow32(B_18509, 2.0F);\n        float x_18514 = x_17912 * y_18513;\n        float A2_18515 = x_18514 / y_17915;\n        float exp_arg_18516 = A1_18512 - A2_18515;\n        float res_18517 = fpow32(2.7182817F, exp_arg_18516);\n        float negate_arg_18518 = r0_17893 * B_18509;\n        float exp_arg_18519 = 0.0F - negate_arg_18518;\n        float res_18520 = fpow32(2.7182817F, exp_arg_18519);\n        float res_18521 = res_18517 * res_18520;\n        bool empty_slice_18522 = range_end_18492 == 0;\n        bool zzero_leq_i_p_m_t_s_18523 = sle64(0, range_end_18492);\n        bool i_p_m_t_s_leq_w_18524 = slt64(range_end_18492, res_18490);\n        bool i_lte_j_18525 = sle64(1, res_18490);\n        bool y_18526 = zzero_leq_i_p_m_t_s_18523 && i_p_m_t_s_leq_w_18524;\n        bool y_18527 = i_lte_j_18525 && y_18526;\n        bool ok_or_empty_18528 = empty_slice_18522 || y_18527;\n        bool index_certs_18529;\n        \n        if (!ok_or_empty_18528) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 2) == -1) {\n                    global_failure_args[0] = 1;\n               ",
                   "     global_failure_args[1] = res_18490;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        float res_18531;\n        float redout_20193 = 0.0F;\n        \n        for (int64_t i_20194 = 0; i_20194 < range_end_18492; i_20194++) {\n            int64_t slice_20215 = 1 + i_20194;\n            float x_18535 = ((__global float *) mem_20238)[phys_tid_18400 +\n                                                           slice_20215 *\n                                                           num_threads_20444];\n            float negate_arg_18536 = a_17890 * x_18535;\n            float exp_arg_18537 = 0.0F - negate_arg_18536;\n            float res_18538 = fpow32(2.7182817F, exp_arg_18537);\n            float x_18539 = 1.0F - res_18538;\n            float B_18540 = x_18539 / a_17890;\n            float x_18541 = B_18540 - x_18535;\n            float x_18542 = y_17914 * x_18541;\n            float A1_18543 = x_18542 / x_17910;\n            float y_18544 = fpow32(B_18540, 2.0F);\n            float x_18545 = x_17912 * y_18544;\n            float A2_18546 = x_18545 / y_17915;\n            float exp_arg_18547 = A1_18543 - A2_18546;\n            float res_18548 = fpow32(2.7182817F, exp_arg_18547);\n            float negate_arg_18549 = r0_17893 * B_18540;\n            float exp_arg_18550 = 0.0F - negate_arg_18549;\n            float res_18551 = fpow32(2.7182817F, exp_arg_18550);\n            float res_18552 = res_18548 * res_18551;\n            float res_18534 = res_18552 + redout_20193;\n            float redout_tmp_20599 = res_18534;\n            \n            redout_20193 = redout_tmp_20599;\n        }\n        res_18531 = redout_20193;\n        \n        float x_18553 = 1.0F - res_18521;\n        float y_18554 = res_18489 * res_18531;\n        float res_18555 = x_18553 / y_18554;\n        \n        ((__global float *) mem_20252)[gtid_18399] = res_18555;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_18478\n}\n__kernel void mainzisegmap_18576(__",
                   "global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args, int64_t n_17882,\n                                 float a_17890, float r0_17893, float x_17910,\n                                 float x_17912, float y_17914, float y_17915,\n                                 __global unsigned char *swap_term_mem_20224,\n                                 __global unsigned char *payments_mem_20225,\n                                 __global unsigned char *mem_20261, __global\n                                 unsigned char *mem_20275,\n                                 int64_t num_threads_20476)\n{\n    #define segmap_group_sizze_18654 (mainzisegmap_group_sizze_18578)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20630;\n    int32_t local_tid_20631;\n    int64_t group_sizze_20634;\n    int32_t wave_sizze_20633;\n    int32_t group_tid_20632;\n    \n    global_tid_20630 = get_global_id(0);\n    local_tid_20631 = get_local_id(0);\n    group_sizze_20634 = get_local_size(0);\n    wave_sizze_20633 = LOCKSTEP_WIDTH;\n    group_tid_20632 = get_group_id(0);\n    \n    int32_t phys_tid_18576;\n    \n    phys_tid_18576 = global_tid_20630;\n    \n    int64_t gtid_18575;\n    \n    gtid_18575 = sext_i32_i64(group_tid_20632) * segmap_group_sizze_18654 +\n        sext_i32_i64(local_tid_20631);\n    if (slt64(gtid_18575, n_17882)) {\n        float res_18665 = ((__global float *) swap_term_mem_20224)[gtid_18575];\n        int64_t res_18666 = ((__global\n                              int64_t *) payments_mem_20225)[gtid_18575];\n        int64_t range_end_18668 = sub64(res_18666, 1);\n        bool bounds_invalid_upwards_18669 = slt64(range_end_18668, 0);\n        bool valid_18670 = !bounds_invalid_upwards_18669;\n        bool range_valid_c_18671;\n        \n        if (!valid_18670) {\n            {\n            ",
                   "    if (atomic_cmpxchg_i32_global(global_failure, -1, 3) == -1) {\n                    global_failure_args[0] = 0;\n                    global_failure_args[1] = 1;\n                    global_failure_args[2] = range_end_18668;\n                    ;\n                }\n                return;\n            }\n        }\n        for (int64_t i_20197 = 0; i_20197 < res_18666; i_20197++) {\n            float res_18675 = sitofp_i64_f32(i_20197);\n            float res_18676 = res_18665 * res_18675;\n            \n            ((__global float *) mem_20261)[phys_tid_18576 + i_20197 *\n                                           num_threads_20476] = res_18676;\n        }\n        \n        bool y_18677 = slt64(0, res_18666);\n        bool index_certs_18678;\n        \n        if (!y_18677) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 4) == -1) {\n                    global_failure_args[0] = 0;\n                    global_failure_args[1] = res_18666;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        float binop_y_18679 = sitofp_i64_f32(range_end_18668);\n        float index_primexp_18680 = res_18665 * binop_y_18679;\n        float negate_arg_18681 = a_17890 * index_primexp_18680;\n        float exp_arg_18682 = 0.0F - negate_arg_18681;\n        float res_18683 = fpow32(2.7182817F, exp_arg_18682);\n        float x_18684 = 1.0F - res_18683;\n        float B_18685 = x_18684 / a_17890;\n        float x_18686 = B_18685 - index_primexp_18680;\n        float x_18687 = y_17914 * x_18686;\n        float A1_18688 = x_18687 / x_17910;\n        float y_18689 = fpow32(B_18685, 2.0F);\n        float x_18690 = x_17912 * y_18689;\n        float A2_18691 = x_18690 / y_17915;\n        float exp_arg_18692 = A1_18688 - A2_18691;\n        float res_18693 = fpow32(2.7182817F, exp_arg_18692);\n        float negate_arg_18694 = r0_17893 * B_18685;\n        float exp_arg_18695 = 0.0F - negate_arg_18694;\n        float res_18696 = fpow32(2.7182817F, e",
                   "xp_arg_18695);\n        float res_18697 = res_18693 * res_18696;\n        bool empty_slice_18698 = range_end_18668 == 0;\n        bool zzero_leq_i_p_m_t_s_18699 = sle64(0, range_end_18668);\n        bool i_p_m_t_s_leq_w_18700 = slt64(range_end_18668, res_18666);\n        bool i_lte_j_18701 = sle64(1, res_18666);\n        bool y_18702 = zzero_leq_i_p_m_t_s_18699 && i_p_m_t_s_leq_w_18700;\n        bool y_18703 = i_lte_j_18701 && y_18702;\n        bool ok_or_empty_18704 = empty_slice_18698 || y_18703;\n        bool index_certs_18705;\n        \n        if (!ok_or_empty_18704) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 5) == -1) {\n                    global_failure_args[0] = 1;\n                    global_failure_args[1] = res_18666;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        float res_18707;\n        float redout_20199 = 0.0F;\n        \n        for (int64_t i_20200 = 0; i_20200 < range_end_18668; i_20200++) {\n            int64_t slice_20218 = 1 + i_20200;\n            float x_18711 = ((__global float *) mem_20261)[phys_tid_18576 +\n                                                           slice_20218 *\n                                                           num_threads_20476];\n            float negate_arg_18712 = a_17890 * x_18711;\n            float exp_arg_18713 = 0.0F - negate_arg_18712;\n            float res_18714 = fpow32(2.7182817F, exp_arg_18713);\n            float x_18715 = 1.0F - res_18714;\n            float B_18716 = x_18715 / a_17890;\n            float x_18717 = B_18716 - x_18711;\n            float x_18718 = y_17914 * x_18717;\n            float A1_18719 = x_18718 / x_17910;\n            float y_18720 = fpow32(B_18716, 2.0F);\n            float x_18721 = x_17912 * y_18720;\n            float A2_18722 = x_18721 / y_17915;\n            float exp_arg_18723 = A1_18719 - A2_18722;\n            float res_18724 = fpow32(2.7182817F, exp_arg_18723);\n            float negate_arg_18725 = ",
                   "r0_17893 * B_18716;\n            float exp_arg_18726 = 0.0F - negate_arg_18725;\n            float res_18727 = fpow32(2.7182817F, exp_arg_18726);\n            float res_18728 = res_18724 * res_18727;\n            float res_18710 = res_18728 + redout_20199;\n            float redout_tmp_20636 = res_18710;\n            \n            redout_20199 = redout_tmp_20636;\n        }\n        res_18707 = redout_20199;\n        \n        float x_18729 = 1.0F - res_18697;\n        float y_18730 = res_18665 * res_18707;\n        float res_18731 = x_18729 / y_18730;\n        \n        ((__global float *) mem_20275)[gtid_18575] = res_18731;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_18654\n}\n__kernel void mainzisegmap_19078(__global int *global_failure, int64_t n_17882,\n                                 int64_t paths_17885, int64_t steps_17886,\n                                 float sims_per_year_17992, __global\n                                 unsigned char *mem_20351)\n{\n    #define segmap_group_sizze_19488 (mainzisegmap_group_sizze_19082)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20677;\n    int32_t local_tid_20678;\n    int64_t group_sizze_20681;\n    int32_t wave_sizze_20680;\n    int32_t group_tid_20679;\n    \n    global_tid_20677 = get_global_id(0);\n    local_tid_20678 = get_local_id(0);\n    group_sizze_20681 = get_local_size(0);\n    wave_sizze_20680 = LOCKSTEP_WIDTH;\n    group_tid_20679 = get_group_id(0);\n    \n    int32_t phys_tid_19078;\n    \n    phys_tid_19078 = global_tid_20677;\n    \n    int64_t gtid_19075;\n    \n    gtid_19075 = squot64(sext_i32_i64(group_tid_20679) *\n                         segmap_group_sizze_19488 +\n                         sext_i32_i64(local_tid_20678), steps_17886 * n_17882);\n    \n    int64_t gtid_19076;\n    \n    gtid_19076 = squot64(sext_i32_i64(group_tid_20679) *\n                         segmap_group_sizze_19488 +\n     ",
                   "                    sext_i32_i64(local_tid_20678) -\n                         squot64(sext_i32_i64(group_tid_20679) *\n                                 segmap_group_sizze_19488 +\n                                 sext_i32_i64(local_tid_20678), steps_17886 *\n                                 n_17882) * (steps_17886 * n_17882), n_17882);\n    \n    int64_t gtid_19077;\n    \n    gtid_19077 = sext_i32_i64(group_tid_20679) * segmap_group_sizze_19488 +\n        sext_i32_i64(local_tid_20678) - squot64(sext_i32_i64(group_tid_20679) *\n                                                segmap_group_sizze_19488 +\n                                                sext_i32_i64(local_tid_20678),\n                                                steps_17886 * n_17882) *\n        (steps_17886 * n_17882) - squot64(sext_i32_i64(group_tid_20679) *\n                                          segmap_group_sizze_19488 +\n                                          sext_i32_i64(local_tid_20678) -\n                                          squot64(sext_i32_i64(group_tid_20679) *\n                                                  segmap_group_sizze_19488 +\n                                                  sext_i32_i64(local_tid_20678),\n                                                  steps_17886 * n_17882) *\n                                          (steps_17886 * n_17882), n_17882) *\n        n_17882;\n    if ((slt64(gtid_19075, paths_17885) && slt64(gtid_19076, steps_17886)) &&\n        slt64(gtid_19077, n_17882)) {\n        int64_t convop_x_20060 = add64(1, gtid_19076);\n        float binop_x_20061 = sitofp_i64_f32(convop_x_20060);\n        float index_primexp_20062 = binop_x_20061 / sims_per_year_17992;\n        \n        ((__global float *) mem_20351)[gtid_19075 * (n_17882 * steps_17886) +\n                                       gtid_19076 * n_17882 + gtid_19077] =\n            index_primexp_20062;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_19488\n}\n__kernel void mainzisegmap_19116(__global int *g",
                   "lobal_failure, int64_t n_17882,\n                                 int64_t paths_17885, int64_t steps_17886,\n                                 __global unsigned char *mem_20341, __global\n                                 unsigned char *mem_20346)\n{\n    #define segmap_group_sizze_19470 (mainzisegmap_group_sizze_19120)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20672;\n    int32_t local_tid_20673;\n    int64_t group_sizze_20676;\n    int32_t wave_sizze_20675;\n    int32_t group_tid_20674;\n    \n    global_tid_20672 = get_global_id(0);\n    local_tid_20673 = get_local_id(0);\n    group_sizze_20676 = get_local_size(0);\n    wave_sizze_20675 = LOCKSTEP_WIDTH;\n    group_tid_20674 = get_group_id(0);\n    \n    int32_t phys_tid_19116;\n    \n    phys_tid_19116 = global_tid_20672;\n    \n    int64_t gtid_19113;\n    \n    gtid_19113 = squot64(sext_i32_i64(group_tid_20674) *\n                         segmap_group_sizze_19470 +\n                         sext_i32_i64(local_tid_20673), steps_17886 * n_17882);\n    \n    int64_t gtid_19114;\n    \n    gtid_19114 = squot64(sext_i32_i64(group_tid_20674) *\n                         segmap_group_sizze_19470 +\n                         sext_i32_i64(local_tid_20673) -\n                         squot64(sext_i32_i64(group_tid_20674) *\n                                 segmap_group_sizze_19470 +\n                                 sext_i32_i64(local_tid_20673), steps_17886 *\n                                 n_17882) * (steps_17886 * n_17882), n_17882);\n    \n    int64_t gtid_19115;\n    \n    gtid_19115 = sext_i32_i64(group_tid_20674) * segmap_group_sizze_19470 +\n        sext_i32_i64(local_tid_20673) - squot64(sext_i32_i64(group_tid_20674) *\n                                                segmap_group_sizze_19470 +\n                                                sext_i32_i64(local_tid_20673),\n                                                steps",
                   "_17886 * n_17882) *\n        (steps_17886 * n_17882) - squot64(sext_i32_i64(group_tid_20674) *\n                                          segmap_group_sizze_19470 +\n                                          sext_i32_i64(local_tid_20673) -\n                                          squot64(sext_i32_i64(group_tid_20674) *\n                                                  segmap_group_sizze_19470 +\n                                                  sext_i32_i64(local_tid_20673),\n                                                  steps_17886 * n_17882) *\n                                          (steps_17886 * n_17882), n_17882) *\n        n_17882;\n    if ((slt64(gtid_19113, paths_17885) && slt64(gtid_19114, steps_17886)) &&\n        slt64(gtid_19115, n_17882)) {\n        float x_19473 = ((__global float *) mem_20341)[gtid_19114 *\n                                                       paths_17885 +\n                                                       gtid_19113];\n        \n        ((__global float *) mem_20346)[gtid_19113 * (n_17882 * steps_17886) +\n                                       gtid_19114 * n_17882 + gtid_19115] =\n            x_19473;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_19470\n}\n__kernel void mainzisegmap_19173(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args,\n                                 int64_t paths_17885, int64_t steps_17886,\n                                 float a_17890, float b_17891,\n                                 float sigma_17892, float r0_17893,\n                                 float dt_17908, int64_t upper_bound_18006,\n                                 float res_18007, int64_t num_groups_19425,\n                                 __global unsigned char *mem_20323, __global\n                                 unsigned char *mem_20326, __global\n                                 unsigned char *mem_20341)\n{\n    #define segmap",
                   "_group_sizze_19424 (mainzisegmap_group_sizze_19175)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_20661;\n    int32_t local_tid_20662;\n    int64_t group_sizze_20665;\n    int32_t wave_sizze_20664;\n    int32_t group_tid_20663;\n    \n    global_tid_20661 = get_global_id(0);\n    local_tid_20662 = get_local_id(0);\n    group_sizze_20665 = get_local_size(0);\n    wave_sizze_20664 = LOCKSTEP_WIDTH;\n    group_tid_20663 = get_group_id(0);\n    \n    int32_t phys_tid_19173;\n    \n    phys_tid_19173 = global_tid_20661;\n    \n    int32_t phys_group_id_20666;\n    \n    phys_group_id_20666 = get_group_id(0);\n    for (int32_t i_20667 = 0; i_20667 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(paths_17885,\n                                          segmap_group_sizze_19424)) -\n                   phys_group_id_20666, sext_i64_i32(num_groups_19425));\n         i_20667++) {\n        int32_t virt_group_id_20668 = phys_group_id_20666 + i_20667 *\n                sext_i64_i32(num_groups_19425);\n        int64_t gtid_19172 = sext_i32_i64(virt_group_id_20668) *\n                segmap_group_sizze_19424 + sext_i32_i64(local_tid_20662);\n        \n        if (slt64(gtid_19172, paths_17885)) {\n            for (int64_t i_20669 = 0; i_20669 < steps_17886; i_20669++) {\n                ((__global float *) mem_20326)[phys_tid_19173 + i_20669 *\n                                               (num_groups_19425 *\n                                                segmap_group_sizze_19424)] =\n                    r0_17893;\n            }\n            for (int64_t i_19431 = 0; i_19431 < upper_bound_18006; i_19431++) {\n                bool y_19433 = slt64(i_19431, steps_17886);\n                bool index_certs_19434;\n    ",
                   "            \n                if (!y_19433) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 8) ==\n                            -1) {\n                            global_failure_args[0] = i_19431;\n                            global_failure_args[1] = steps_17886;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                float shortstep_arg_19435 = ((__global\n                                              float *) mem_20323)[i_19431 *\n                                                                  paths_17885 +\n                                                                  gtid_19172];\n                float shortstep_arg_19436 = ((__global\n                                              float *) mem_20326)[phys_tid_19173 +\n                                                                  i_19431 *\n                                                                  (num_groups_19425 *\n                                                                   segmap_group_sizze_19424)];\n                float y_19437 = b_17891 - shortstep_arg_19436;\n                float x_19438 = a_17890 * y_19437;\n                float x_19439 = dt_17908 * x_19438;\n                float x_19440 = res_18007 * shortstep_arg_19435;\n                float y_19441 = sigma_17892 * x_19440;\n                float delta_r_19442 = x_19439 + y_19441;\n                float res_19443 = shortstep_arg_19436 + delta_r_19442;\n                int64_t i_19444 = add64(1, i_19431);\n                bool x_19445 = sle64(0, i_19444);\n                bool y_19446 = slt64(i_19444, steps_17886);\n                bool bounds_check_19447 = x_19445 && y_19446;\n                bool index_certs_19448;\n                \n                if (!bounds_check_19447) {\n                    {\n                        if (atomic_cmpxchg_i32_g",
                   "lobal(global_failure, -1, 9) ==\n                            -1) {\n                            global_failure_args[0] = i_19444;\n                            global_failure_args[1] = steps_17886;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                ((__global float *) mem_20326)[phys_tid_19173 + i_19444 *\n                                               (num_groups_19425 *\n                                                segmap_group_sizze_19424)] =\n                    res_19443;\n            }\n            for (int64_t i_20671 = 0; i_20671 < steps_17886; i_20671++) {\n                ((__global float *) mem_20341)[i_20671 * paths_17885 +\n                                               gtid_19172] = ((__global\n                                                               float *) mem_20326)[phys_tid_19173 +\n                                                                                   i_20671 *\n                                                                                   (num_groups_19425 *\n                                                                                    segmap_group_sizze_19424)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_19424\n}\n__kernel void mainzisegmap_19271(__global int *global_failure,\n                                 int64_t paths_17885, int64_t steps_17886,\n                                 __global unsigned char *mem_20316, __global\n                                 unsigned char *mem_20320)\n{\n    #define segmap_group_sizze_19379 (mainzisegmap_group_sizze_19274)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20656;\n    int32_t local_tid_20657;\n    int64_t group_sizze_2",
                   "0660;\n    int32_t wave_sizze_20659;\n    int32_t group_tid_20658;\n    \n    global_tid_20656 = get_global_id(0);\n    local_tid_20657 = get_local_id(0);\n    group_sizze_20660 = get_local_size(0);\n    wave_sizze_20659 = LOCKSTEP_WIDTH;\n    group_tid_20658 = get_group_id(0);\n    \n    int32_t phys_tid_19271;\n    \n    phys_tid_19271 = global_tid_20656;\n    \n    int64_t gtid_19269;\n    \n    gtid_19269 = squot64(sext_i32_i64(group_tid_20658) *\n                         segmap_group_sizze_19379 +\n                         sext_i32_i64(local_tid_20657), steps_17886);\n    \n    int64_t gtid_19270;\n    \n    gtid_19270 = sext_i32_i64(group_tid_20658) * segmap_group_sizze_19379 +\n        sext_i32_i64(local_tid_20657) - squot64(sext_i32_i64(group_tid_20658) *\n                                                segmap_group_sizze_19379 +\n                                                sext_i32_i64(local_tid_20657),\n                                                steps_17886) * steps_17886;\n    if (slt64(gtid_19269, paths_17885) && slt64(gtid_19270, steps_17886)) {\n        int32_t unsign_arg_19382 = ((__global int32_t *) mem_20316)[gtid_19269];\n        int32_t res_19384 = sext_i64_i32(gtid_19270);\n        int32_t x_19385 = lshr32(res_19384, 16);\n        int32_t x_19386 = res_19384 ^ x_19385;\n        int32_t x_19387 = mul32(73244475, x_19386);\n        int32_t x_19388 = lshr32(x_19387, 16);\n        int32_t x_19389 = x_19387 ^ x_19388;\n        int32_t x_19390 = mul32(73244475, x_19389);\n        int32_t x_19391 = lshr32(x_19390, 16);\n        int32_t x_19392 = x_19390 ^ x_19391;\n        int32_t unsign_arg_19393 = unsign_arg_19382 ^ x_19392;\n        int32_t unsign_arg_19394 = mul32(48271, unsign_arg_19393);\n        int32_t unsign_arg_19395 = umod32(unsign_arg_19394, 2147483647);\n        int32_t unsign_arg_19396 = mul32(48271, unsign_arg_19395);\n        int32_t unsign_arg_19397 = umod32(unsign_arg_19396, 2147483647);\n        float res_19398 = uitofp_i32_f32(unsign_arg_19395);\n        float res_193",
                   "99 = res_19398 / 2.1474836e9F;\n        float res_19400 = uitofp_i32_f32(unsign_arg_19397);\n        float res_19401 = res_19400 / 2.1474836e9F;\n        float res_19402;\n        \n        res_19402 = futrts_log32(res_19399);\n        \n        float res_19403 = -2.0F * res_19402;\n        float res_19404;\n        \n        res_19404 = futrts_sqrt32(res_19403);\n        \n        float res_19405 = 6.2831855F * res_19401;\n        float res_19406;\n        \n        res_19406 = futrts_cos32(res_19405);\n        \n        float res_19407 = res_19404 * res_19406;\n        \n        ((__global float *) mem_20320)[gtid_19269 * steps_17886 + gtid_19270] =\n            res_19407;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_19379\n}\n__kernel void mainzisegmap_19335(__global int *global_failure,\n                                 int64_t paths_17885, __global\n                                 unsigned char *mem_20316)\n{\n    #define segmap_group_sizze_19354 (mainzisegmap_group_sizze_19337)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20651;\n    int32_t local_tid_20652;\n    int64_t group_sizze_20655;\n    int32_t wave_sizze_20654;\n    int32_t group_tid_20653;\n    \n    global_tid_20651 = get_global_id(0);\n    local_tid_20652 = get_local_id(0);\n    group_sizze_20655 = get_local_size(0);\n    wave_sizze_20654 = LOCKSTEP_WIDTH;\n    group_tid_20653 = get_group_id(0);\n    \n    int32_t phys_tid_19335;\n    \n    phys_tid_19335 = global_tid_20651;\n    \n    int64_t gtid_19334;\n    \n    gtid_19334 = sext_i32_i64(group_tid_20653) * segmap_group_sizze_19354 +\n        sext_i32_i64(local_tid_20652);\n    if (slt64(gtid_19334, paths_17885)) {\n        int32_t res_19358 = sext_i64_i32(gtid_19334);\n        int32_t x_19359 = lshr32(res_19358, 16);\n        int32_t x_19360 = res_19358 ^ x_19359;\n        int32_t x_19361 = mul32(73244475, x_19360);\n        int32_t x_19362 = lshr3",
                   "2(x_19361, 16);\n        int32_t x_19363 = x_19361 ^ x_19362;\n        int32_t x_19364 = mul32(73244475, x_19363);\n        int32_t x_19365 = lshr32(x_19364, 16);\n        int32_t x_19366 = x_19364 ^ x_19365;\n        int32_t unsign_arg_19367 = 777822902 ^ x_19366;\n        int32_t unsign_arg_19368 = mul32(48271, unsign_arg_19367);\n        int32_t unsign_arg_19369 = umod32(unsign_arg_19368, 2147483647);\n        \n        ((__global int32_t *) mem_20316)[gtid_19334] = unsign_arg_19369;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_19354\n}\n__kernel void mainzisegmap_19608(__global int *global_failure,\n                                 int64_t res_18101, int64_t num_segments_18299,\n                                 __global unsigned char *mem_20376, __global\n                                 unsigned char *mem_20381, __global\n                                 unsigned char *mem_20384, __global\n                                 unsigned char *mem_20386)\n{\n    #define segmap_group_sizze_19611 (mainzisegmap_group_sizze_19610)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21183;\n    int32_t local_tid_21184;\n    int64_t group_sizze_21187;\n    int32_t wave_sizze_21186;\n    int32_t group_tid_21185;\n    \n    global_tid_21183 = get_global_id(0);\n    local_tid_21184 = get_local_id(0);\n    group_sizze_21187 = get_local_size(0);\n    wave_sizze_21186 = LOCKSTEP_WIDTH;\n    group_tid_21185 = get_group_id(0);\n    \n    int32_t phys_tid_19608;\n    \n    phys_tid_19608 = global_tid_21183;\n    \n    int64_t write_i_19607;\n    \n    write_i_19607 = sext_i32_i64(group_tid_21185) * segmap_group_sizze_19611 +\n        sext_i32_i64(local_tid_21184);\n    if (slt64(write_i_19607, res_18101)) {\n        int64_t i_p_o_20136 = add64(1, write_i_19607);\n        int64_t rot_i_20137 = smod64(i_p_o_20136, res_18101);\n        bool x_18312 = ((__global bool *) mem_20376)[rot_i_2",
                   "0137];\n        float write_value_18313 = ((__global float *) mem_20381)[write_i_19607];\n        int64_t res_18314;\n        \n        if (x_18312) {\n            int64_t x_18311 = ((__global int64_t *) mem_20384)[write_i_19607];\n            int64_t res_18315 = sub64(x_18311, 1);\n            \n            res_18314 = res_18315;\n        } else {\n            res_18314 = -1;\n        }\n        if (sle64(0, res_18314) && slt64(res_18314, num_segments_18299)) {\n            ((__global float *) mem_20386)[res_18314] = write_value_18313;\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_19611\n}\n__kernel void mainzisegmap_19680(__global int *global_failure, int64_t n_17882,\n                                 int64_t paths_17885, int64_t steps_17886,\n                                 float a_17890, float x_17910, float x_17912,\n                                 float y_17914, float y_17915,\n                                 float sims_per_year_17992, float res_18320,\n                                 __global unsigned char *mem_20408, __global\n                                 unsigned char *mem_20411, __global\n                                 unsigned char *mem_20413)\n{\n    #define segmap_group_sizze_19911 (mainzisegmap_group_sizze_19682)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21233;\n    int32_t local_tid_21234;\n    int64_t group_sizze_21237;\n    int32_t wave_sizze_21236;\n    int32_t group_tid_21235;\n    \n    global_tid_21233 = get_global_id(0);\n    local_tid_21234 = get_local_id(0);\n    group_sizze_21237 = get_local_size(0);\n    wave_sizze_21236 = LOCKSTEP_WIDTH;\n    group_tid_21235 = get_group_id(0);\n    \n    int32_t phys_tid_19680;\n    \n    phys_tid_19680 = global_tid_21233;\n    \n    int64_t gtid_19679;\n    \n    gtid_19679 = sext_i32_i64(group_tid_21235) * segmap_group_sizze_19911 +\n        sext_i32_i64(local_tid_21234);\n    if ",
                   "(slt64(gtid_19679, steps_17886)) {\n        int64_t convop_x_20143 = add64(1, gtid_19679);\n        float binop_x_20144 = sitofp_i64_f32(convop_x_20143);\n        float index_primexp_20145 = binop_x_20144 / sims_per_year_17992;\n        float res_19917;\n        float redout_20205 = 0.0F;\n        \n        for (int64_t i_20206 = 0; i_20206 < paths_17885; i_20206++) {\n            float res_19922;\n            float redout_20207 = 0.0F;\n            \n            for (int64_t i_20208 = 0; i_20208 < n_17882; i_20208++) {\n                float x_19926 = ((__global float *) mem_20408)[i_20206 *\n                                                               (steps_17886 *\n                                                                n_17882) +\n                                                               i_20208 *\n                                                               steps_17886 +\n                                                               gtid_19679];\n                float res_19925 = x_19926 + redout_20207;\n                float redout_tmp_21239 = res_19925;\n                \n                redout_20207 = redout_tmp_21239;\n            }\n            res_19922 = redout_20207;\n            \n            float res_19927 = fmax32(0.0F, res_19922);\n            float res_19920 = res_19927 + redout_20205;\n            float redout_tmp_21238 = res_19920;\n            \n            redout_20205 = redout_tmp_21238;\n        }\n        res_19917 = redout_20205;\n        \n        float res_19928 = res_19917 / res_18320;\n        float negate_arg_19929 = a_17890 * index_primexp_20145;\n        float exp_arg_19930 = 0.0F - negate_arg_19929;\n        float res_19931 = fpow32(2.7182817F, exp_arg_19930);\n        float x_19932 = 1.0F - res_19931;\n        float B_19933 = x_19932 / a_17890;\n        float x_19934 = B_19933 - index_primexp_20145;\n        float x_19935 = y_17914 * x_19934;\n        float A1_19936 = x_19935 / x_17910;\n        float y_19937 = fpow32(B_19933, 2.0F);\n        float x_199",
                   "38 = x_17912 * y_19937;\n        float A2_19939 = x_19938 / y_17915;\n        float exp_arg_19940 = A1_19936 - A2_19939;\n        float res_19941 = fpow32(2.7182817F, exp_arg_19940);\n        float negate_arg_19942 = 5.0e-2F * B_19933;\n        float exp_arg_19943 = 0.0F - negate_arg_19942;\n        float res_19944 = fpow32(2.7182817F, exp_arg_19943);\n        float res_19945 = res_19941 * res_19944;\n        float res_19946 = res_19928 * res_19945;\n        \n        ((__global float *) mem_20411)[gtid_19679] = res_19946;\n        ((__global float *) mem_20413)[gtid_19679] = res_19928;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_19911\n}\n__kernel void mainzisegmap_19795(__global int *global_failure,\n                                 int64_t steps_17886, float a_17890,\n                                 float x_17910, float x_17912, float y_17914,\n                                 float y_17915, float sims_per_year_17992,\n                                 float res_18320, __global\n                                 unsigned char *mem_20426, __global\n                                 unsigned char *mem_20429, __global\n                                 unsigned char *mem_20431)\n{\n    #define segmap_group_sizze_20001 (mainzisegmap_group_sizze_19797)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21313;\n    int32_t local_tid_21314;\n    int64_t group_sizze_21317;\n    int32_t wave_sizze_21316;\n    int32_t group_tid_21315;\n    \n    global_tid_21313 = get_global_id(0);\n    local_tid_21314 = get_local_id(0);\n    group_sizze_21317 = get_local_size(0);\n    wave_sizze_21316 = LOCKSTEP_WIDTH;\n    group_tid_21315 = get_group_id(0);\n    \n    int32_t phys_tid_19795;\n    \n    phys_tid_19795 = global_tid_21313;\n    \n    int64_t gtid_19794;\n    \n    gtid_19794 = sext_i32_i64(group_tid_21315) * segmap_group_sizze_20001 +\n        sext_i32_i64(local_tid_21314);\n  ",
                   "  if (slt64(gtid_19794, steps_17886)) {\n        int64_t convop_x_20151 = add64(1, gtid_19794);\n        float binop_x_20152 = sitofp_i64_f32(convop_x_20151);\n        float index_primexp_20153 = binop_x_20152 / sims_per_year_17992;\n        float res_20006 = ((__global float *) mem_20426)[gtid_19794];\n        float res_20007 = res_20006 / res_18320;\n        float negate_arg_20008 = a_17890 * index_primexp_20153;\n        float exp_arg_20009 = 0.0F - negate_arg_20008;\n        float res_20010 = fpow32(2.7182817F, exp_arg_20009);\n        float x_20011 = 1.0F - res_20010;\n        float B_20012 = x_20011 / a_17890;\n        float x_20013 = B_20012 - index_primexp_20153;\n        float x_20014 = y_17914 * x_20013;\n        float A1_20015 = x_20014 / x_17910;\n        float y_20016 = fpow32(B_20012, 2.0F);\n        float x_20017 = x_17912 * y_20016;\n        float A2_20018 = x_20017 / y_17915;\n        float exp_arg_20019 = A1_20015 - A2_20018;\n        float res_20020 = fpow32(2.7182817F, exp_arg_20019);\n        float negate_arg_20021 = 5.0e-2F * B_20012;\n        float exp_arg_20022 = 0.0F - negate_arg_20021;\n        float res_20023 = fpow32(2.7182817F, exp_arg_20022);\n        float res_20024 = res_20020 * res_20023;\n        float res_20025 = res_20007 * res_20024;\n        \n        ((__global float *) mem_20429)[gtid_19794] = res_20025;\n        ((__global float *) mem_20431)[gtid_19794] = res_20007;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_20001\n}\n__kernel void mainzisegmap_intragroup_18817(__global int *global_failure,\n                                            int failure_is_an_option, __global\n                                            int64_t *global_failure_args,\n                                            __local volatile\n                                            int64_t *mem_20305_backing_aligned_0,\n                                            __local volatile\n                                            int64_t *mem_20301_backing_aligned_1,\n          ",
                   "                                  __local volatile\n                                            int64_t *mem_20285_backing_aligned_2,\n                                            __local volatile\n                                            int64_t *mem_20283_backing_aligned_3,\n                                            int64_t n_17882,\n                                            int64_t steps_17886, float a_17890,\n                                            float b_17891, float sigma_17892,\n                                            float r0_17893, float dt_17908,\n                                            float sims_per_year_17992,\n                                            int64_t upper_bound_18006,\n                                            float res_18007,\n                                            int64_t computed_group_sizze_18774,\n                                            __global unsigned char *mem_20309,\n                                            __global unsigned char *mem_20313)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict mem_20305_backing_3 = (__local volatile\n                                                           char *) mem_20305_backing_aligned_0;\n    __local volatile char *restrict mem_20301_backing_2 = (__local volatile\n                                                           char *) mem_20301_backing_aligned_1;\n    __local volatile char *restrict mem_20285_backing_1 = (__local volatile\n                                                           char *) mem_20285_backing_aligned_2;\n    __local volatile char *restrict mem_20283_backing_0 = (__local volatile\n                                                           char *) mem_20283_backing_aligned_3;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    b",
                   "arrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_20639;\n    int32_t local_tid_20640;\n    int64_t group_sizze_20643;\n    int32_t wave_sizze_20642;\n    int32_t group_tid_20641;\n    \n    global_tid_20639 = get_global_id(0);\n    local_tid_20640 = get_local_id(0);\n    group_sizze_20643 = get_local_size(0);\n    wave_sizze_20642 = LOCKSTEP_WIDTH;\n    group_tid_20641 = get_group_id(0);\n    \n    int32_t phys_tid_18817;\n    \n    phys_tid_18817 = group_tid_20641;\n    \n    int32_t ltid_pre_20644;\n    \n    ltid_pre_20644 = local_tid_20640;\n    \n    int32_t ltid_pre_20645;\n    \n    ltid_pre_20645 = squot32(local_tid_20640, sext_i64_i32(n_17882));\n    \n    int32_t ltid_pre_20646;\n    \n    ltid_pre_20646 = local_tid_20640 - squot32(local_tid_20640,\n                                               sext_i64_i32(n_17882)) *\n        sext_i64_i32(n_17882);\n    \n    int64_t gtid_18772;\n    \n    gtid_18772 = sext_i32_i64(group_tid_20641);\n    \n    int32_t res_18972;\n    \n    res_18972 = sext_i64_i32(gtid_18772);\n    \n    int32_t x_18973 = lshr32(res_18972, 16);\n    int32_t x_18974 = res_18972 ^ x_18973;\n    int32_t x_18975 = mul32(73244475, x_18974);\n    int32_t x_18976 = lshr32(x_18975, 16);\n    int32_t x_18977 = x_18975 ^ x_18976;\n    int32_t x_18978 = mul32(73244475, x_18977);\n    int32_t x_18979 = lshr32(x_18978, 16);\n    int32_t x_18980 = x_18978 ^ x_18979;\n    int32_t unsign_arg_18981 = 777822902 ^ x_18980;\n    int32_t unsign_arg_18982 = mul32(48271, unsign_arg_18981);\n    int32_t unsign_arg_18983 = umod32(unsign_arg_18982, 2147483647);\n    __local char *mem_20283;\n    \n    mem_20283 = (__local char *) mem_20283_backing_0;\n    \n    int64_t gtid_18775 = sext_i32_i64(ltid_pre_20644);\n    int32_t phys_tid_18776 = local_tid_20640;\n    \n    if (slt64(gtid_18775, steps_17886)) {\n        int32_t res_18986 = sext_i64_i32(gtid_18775);\n        int32_t x_18987 = lshr32(res_18986, 16);\n        int32_t x_18988 = res_18986 ^ x_18987;\n        int32_t x_18989 = mul32(73244475, x_18988);\n     ",
                   "   int32_t x_18990 = lshr32(x_18989, 16);\n        int32_t x_18991 = x_18989 ^ x_18990;\n        int32_t x_18992 = mul32(73244475, x_18991);\n        int32_t x_18993 = lshr32(x_18992, 16);\n        int32_t x_18994 = x_18992 ^ x_18993;\n        int32_t unsign_arg_18995 = unsign_arg_18983 ^ x_18994;\n        int32_t unsign_arg_18996 = mul32(48271, unsign_arg_18995);\n        int32_t unsign_arg_18997 = umod32(unsign_arg_18996, 2147483647);\n        int32_t unsign_arg_18998 = mul32(48271, unsign_arg_18997);\n        int32_t unsign_arg_18999 = umod32(unsign_arg_18998, 2147483647);\n        float res_19000 = uitofp_i32_f32(unsign_arg_18997);\n        float res_19001 = res_19000 / 2.1474836e9F;\n        float res_19002 = uitofp_i32_f32(unsign_arg_18999);\n        float res_19003 = res_19002 / 2.1474836e9F;\n        float res_19004;\n        \n        res_19004 = futrts_log32(res_19001);\n        \n        float res_19005 = -2.0F * res_19004;\n        float res_19006;\n        \n        res_19006 = futrts_sqrt32(res_19005);\n        \n        float res_19007 = 6.2831855F * res_19003;\n        float res_19008;\n        \n        res_19008 = futrts_cos32(res_19007);\n        \n        float res_19009 = res_19006 * res_19008;\n        \n        ((__local float *) mem_20283)[gtid_18775] = res_19009;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    __local char *mem_20285;\n    \n    mem_20285 = (__local char *) mem_20285_backing_1;\n    for (int64_t i_20647 = 0; i_20647 < sdiv_up64(steps_17886 -\n                                                  sext_i32_i64(local_tid_20640),\n                                                  computed_group_sizze_18774);\n         i_20647++) {\n        ((__local float *) mem_20285)[i_20647 * computed_group_sizze_18774 +\n                                      sext_i32_i64(local_tid_20640)] = r0_17893;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int64_t i_19012 = 0; i_19012 < upper_bound_18006; i_19012++) {\n        bool y_19014 = slt64(i_19012, steps_17886);\n        bool index_c",
                   "erts_19015;\n        \n        if (!y_19014) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 6) == -1) {\n                    global_failure_args[0] = i_19012;\n                    global_failure_args[1] = steps_17886;\n                    ;\n                }\n                local_failure = true;\n                goto error_1;\n            }\n        }\n        \n        float shortstep_arg_19016 = ((__local float *) mem_20283)[i_19012];\n        float shortstep_arg_19017 = ((__local float *) mem_20285)[i_19012];\n        float y_19018 = b_17891 - shortstep_arg_19017;\n        float x_19019 = a_17890 * y_19018;\n        float x_19020 = dt_17908 * x_19019;\n        float x_19021 = res_18007 * shortstep_arg_19016;\n        float y_19022 = sigma_17892 * x_19021;\n        float delta_r_19023 = x_19020 + y_19022;\n        float res_19024 = shortstep_arg_19017 + delta_r_19023;\n        int64_t i_19025 = add64(1, i_19012);\n        bool x_19026 = sle64(0, i_19025);\n        bool y_19027 = slt64(i_19025, steps_17886);\n        bool bounds_check_19028 = x_19026 && y_19027;\n        bool index_certs_19029;\n        \n        if (!bounds_check_19028) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 7) == -1) {\n                    global_failure_args[0] = i_19025;\n                    global_failure_args[1] = steps_17886;\n                    ;\n                }\n                local_failure = true;\n                goto error_1;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_tid_20640 == 0) {\n            ((__local float *) mem_20285)[i_19025] = res_19024;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n    }\n    \n    __local char *mem_20301;\n    \n    mem_20301 = (__local char *) mem_20301_backing_2;\n    \n    int64_t gtid_18809 = sext_i32_i64(ltid_pre_20645);\n    int64_t gtid_18810 = sext_i32_i64(ltid_pre_20646);\n    int32_t phys_tid_18811 = local_tid_20640;\n    \n    if (slt64(gtid_18809, steps_17886) && sl",
                   "t64(gtid_18810, n_17882)) {\n        float x_19032 = ((__local float *) mem_20285)[gtid_18809];\n        \n        ((__local float *) mem_20301)[gtid_18809 * n_17882 + gtid_18810] =\n            x_19032;\n    }\n    \n  error_1:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    __local char *mem_20305;\n    \n    mem_20305 = (__local char *) mem_20305_backing_3;\n    \n    int64_t gtid_18803 = sext_i32_i64(ltid_pre_20645);\n    int64_t gtid_18804 = sext_i32_i64(ltid_pre_20646);\n    int32_t phys_tid_18805 = local_tid_20640;\n    \n    if (slt64(gtid_18803, steps_17886) && slt64(gtid_18804, n_17882)) {\n        int64_t convop_x_20049 = add64(1, gtid_18803);\n        float binop_x_20050 = sitofp_i64_f32(convop_x_20049);\n        float index_primexp_20051 = binop_x_20050 / sims_per_year_17992;\n        \n        ((__local float *) mem_20305)[gtid_18803 * n_17882 + gtid_18804] =\n            index_primexp_20051;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int64_t i_20649 = 0; i_20649 < sdiv_up64(steps_17886 * n_17882 -\n                                                  sext_i32_i64(local_tid_20640),\n                                                  computed_group_sizze_18774);\n         i_20649++) {\n        ((__global float *) mem_20309)[gtid_18772 * (n_17882 * steps_17886) +\n                                       squot64(i_20649 *\n                                               computed_group_sizze_18774 +\n                                               sext_i32_i64(local_tid_20640),\n                                               n_17882) * n_17882 + (i_20649 *\n                                                                     computed_group_sizze_18774 +\n                                                                     sext_i32_i64(local_tid_20640) -\n                                                                     squot64(i_20649 *\n                                                                             comput",
                   "ed_group_sizze_18774 +\n                                                                             sext_i32_i64(local_tid_20640),\n                                                                             n_17882) *\n                                                                     n_17882)] =\n            ((__local float *) mem_20301)[squot64(i_20649 *\n                                                  computed_group_sizze_18774 +\n                                                  sext_i32_i64(local_tid_20640),\n                                                  n_17882) * n_17882 +\n                                          (i_20649 *\n                                           computed_group_sizze_18774 +\n                                           sext_i32_i64(local_tid_20640) -\n                                           squot64(i_20649 *\n                                                   computed_group_sizze_18774 +\n                                                   sext_i32_i64(local_tid_20640),\n                                                   n_17882) * n_17882)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int64_t i_20650 = 0; i_20650 < sdiv_up64(steps_17886 * n_17882 -\n                                                  sext_i32_i64(local_tid_20640),\n                                                  computed_group_sizze_18774);\n         i_20650++) {\n        ((__global float *) mem_20313)[gtid_18772 * (n_17882 * steps_17886) +\n                                       squot64(i_20650 *\n                                               computed_group_sizze_18774 +\n                                               sext_i32_i64(local_tid_20640),\n                                               n_17882) * n_17882 + (i_20650 *\n                                                                     computed_group_sizze_18774 +\n                                                                     sext_i32_i64(local_tid_20640) -\n                                                  ",
                   "                   squot64(i_20650 *\n                                                                             computed_group_sizze_18774 +\n                                                                             sext_i32_i64(local_tid_20640),\n                                                                             n_17882) *\n                                                                     n_17882)] =\n            ((__local float *) mem_20305)[squot64(i_20650 *\n                                                  computed_group_sizze_18774 +\n                                                  sext_i32_i64(local_tid_20640),\n                                                  n_17882) * n_17882 +\n                                          (i_20650 *\n                                           computed_group_sizze_18774 +\n                                           sext_i32_i64(local_tid_20640) -\n                                           squot64(i_20650 *\n                                                   computed_group_sizze_18774 +\n                                                   sext_i32_i64(local_tid_20640),\n                                                   n_17882) * n_17882)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n  error_3:\n    return;\n}\n__kernel void mainzisegmap_intragroup_19678(__global int *global_failure,\n                                            __local volatile\n                                            int64_t *red_arr_mem_21246_backing_aligned_0,\n                                            int64_t n_17882,\n                                            int64_t paths_17885, float a_17890,\n                                            float x_17910, float x_17912,\n                                            float y_17914, float y_17915,\n                                            float sims_per_year_17992,\n                                            float res_18320,\n                                            int64_t one_intra_par_min_18814,\n",
                   "                                            __global unsigned char *mem_20386,\n                                            __global unsigned char *mem_20417,\n                                            __global unsigned char *mem_20419)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_21246_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_21246_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21240;\n    int32_t local_tid_21241;\n    int64_t group_sizze_21244;\n    int32_t wave_sizze_21243;\n    int32_t group_tid_21242;\n    \n    global_tid_21240 = get_global_id(0);\n    local_tid_21241 = get_local_id(0);\n    group_sizze_21244 = get_local_size(0);\n    wave_sizze_21243 = LOCKSTEP_WIDTH;\n    group_tid_21242 = get_group_id(0);\n    \n    int32_t phys_tid_19678;\n    \n    phys_tid_19678 = group_tid_21242;\n    \n    int32_t ltid_pre_21245;\n    \n    ltid_pre_21245 = local_tid_21241;\n    \n    int64_t gtid_19673;\n    \n    gtid_19673 = sext_i32_i64(group_tid_21242);\n    \n    int64_t convop_x_20147;\n    \n    convop_x_20147 = add64(1, gtid_19673);\n    \n    float binop_x_20148 = sitofp_i64_f32(convop_x_20147);\n    float index_primexp_20149 = binop_x_20148 / sims_per_year_17992;\n    int64_t binop_y_20221 = n_17882 * gtid_19673;\n    float res_19953;\n    int64_t gtid_19676 = sext_i32_i64(ltid_pre_21245);\n    int32_t phys_tid_19677 = local_tid_21241;\n    __local char *red_arr_mem_21246;\n    \n    red_arr_mem_21246 = (__local char *) red_arr_mem_21246_backing_0;\n    if (slt64(gtid_19676, paths_17885)) {\n        int64_t binop_x_20220 = one_intra_par_min_18814 * gtid_19676;\n        int64_t binop_x_20222 = binop_x_20220 + binop_y_20221;\n        float res_19958;\n        float redout_20209 = 0.0F;\n        \n        for (int64_t i_20210 = 0; i_20210 < n_17882; i_20210++) {\n            int64_t new_index_20223 =",
                   " i_20210 + binop_x_20222;\n            float x_19962 = ((__global float *) mem_20386)[new_index_20223];\n            float res_19961 = x_19962 + redout_20209;\n            float redout_tmp_21248 = res_19961;\n            \n            redout_20209 = redout_tmp_21248;\n        }\n        res_19958 = redout_20209;\n        \n        float res_19963 = fmax32(0.0F, res_19958);\n        \n        ((__local float *) red_arr_mem_21246)[gtid_19676] = res_19963;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_21249;\n    int32_t skip_waves_21250;\n    \n    skip_waves_21250 = 1;\n    \n    float x_19954;\n    float x_19955;\n    \n    offset_21249 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_21241, sext_i64_i32(paths_17885))) {\n            x_19954 = ((__local\n                        float *) red_arr_mem_21246)[sext_i32_i64(local_tid_21241 +\n                                                    offset_21249)];\n        }\n    }\n    offset_21249 = 1;\n    while (slt32(offset_21249, wave_sizze_21243)) {\n        if (slt32(local_tid_21241 + offset_21249, sext_i64_i32(paths_17885)) &&\n            ((local_tid_21241 - squot32(local_tid_21241, wave_sizze_21243) *\n              wave_sizze_21243) & (2 * offset_21249 - 1)) == 0) {\n            // read array element\n            {\n                x_19955 = ((volatile __local\n                            float *) red_arr_mem_21246)[sext_i32_i64(local_tid_21241 +\n                                                        offset_21249)];\n            }\n            // apply reduction operation\n            {\n                float res_19956 = x_19954 + x_19955;\n                \n                x_19954 = res_19956;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_21246)[sext_i32_i64(local_tid_21241)] =\n                    x_19954;\n            }\n        }\n        offset_21249 *= 2;\n    }\n    while (slt32(skip_waves_21250",
                   ", squot32(sext_i64_i32(paths_17885) +\n                                           wave_sizze_21243 - 1,\n                                           wave_sizze_21243))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_21249 = skip_waves_21250 * wave_sizze_21243;\n        if (slt32(local_tid_21241 + offset_21249, sext_i64_i32(paths_17885)) &&\n            ((local_tid_21241 - squot32(local_tid_21241, wave_sizze_21243) *\n              wave_sizze_21243) == 0 && (squot32(local_tid_21241,\n                                                 wave_sizze_21243) & (2 *\n                                                                      skip_waves_21250 -\n                                                                      1)) ==\n             0)) {\n            // read array element\n            {\n                x_19955 = ((__local\n                            float *) red_arr_mem_21246)[sext_i32_i64(local_tid_21241 +\n                                                        offset_21249)];\n            }\n            // apply reduction operation\n            {\n                float res_19956 = x_19954 + x_19955;\n                \n                x_19954 = res_19956;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_21246)[sext_i32_i64(local_tid_21241)] =\n                    x_19954;\n            }\n        }\n        skip_waves_21250 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    res_19953 = ((__local float *) red_arr_mem_21246)[0];\n    \n    float res_19964 = res_19953 / res_18320;\n    float negate_arg_19965 = a_17890 * index_primexp_20149;\n    float exp_arg_19966 = 0.0F - negate_arg_19965;\n    float res_19967 = fpow32(2.7182817F, exp_arg_19966);\n    float x_19968 = 1.0F - res_19967;\n    float B_19969 = x_19968 / a_17890;\n    float x_19970 = B_19969 - index_primexp_20149;\n    float x_19971 = y_17914 * x_19970;\n    float A1_19972 = x_19971 / x_17910;\n    float y_19973 = fpow32(B_19969, 2.0F);\n    float",
                   " x_19974 = x_17912 * y_19973;\n    float A2_19975 = x_19974 / y_17915;\n    float exp_arg_19976 = A1_19972 - A2_19975;\n    float res_19977 = fpow32(2.7182817F, exp_arg_19976);\n    float negate_arg_19978 = 5.0e-2F * B_19969;\n    float exp_arg_19979 = 0.0F - negate_arg_19978;\n    float res_19980 = fpow32(2.7182817F, exp_arg_19979);\n    float res_19981 = res_19977 * res_19980;\n    float res_19982 = res_19964 * res_19981;\n    \n    if (local_tid_21241 == 0) {\n        ((__global float *) mem_20417)[gtid_19673] = res_19982;\n    }\n    if (local_tid_21241 == 0) {\n        ((__global float *) mem_20419)[gtid_19673] = res_19964;\n    }\n    \n  error_2:\n    return;\n}\n__kernel void mainzisegred_large_19830(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *sync_arr_mem_21289_backing_aligned_0,\n                                       __local volatile\n                                       int64_t *red_arr_mem_21287_backing_aligned_1,\n                                       int64_t n_17882, int64_t paths_17885,\n                                       int64_t steps_17886,\n                                       int64_t num_groups_19986, __global\n                                       unsigned char *mem_20423, __global\n                                       unsigned char *mem_20426,\n                                       int64_t groups_per_segment_21273,\n                                       int64_t elements_per_thread_21274,\n                                       int64_t virt_num_groups_21275,\n                                       int64_t threads_per_segment_21277,\n                                       __global\n                                       unsigned char *group_res_arr_mem_21278,\n                                       __global\n                                       unsigned char *mainzicounter_mem_21280)\n{\n    #define segred_group_sizze_19985 (mainzisegred_group_sizze_19824)\n    \n    const int blo",
                   "ck_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict sync_arr_mem_21289_backing_1 =\n                          (__local volatile\n                           char *) sync_arr_mem_21289_backing_aligned_0;\n    __local volatile char *restrict red_arr_mem_21287_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_21287_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21282;\n    int32_t local_tid_21283;\n    int64_t group_sizze_21286;\n    int32_t wave_sizze_21285;\n    int32_t group_tid_21284;\n    \n    global_tid_21282 = get_global_id(0);\n    local_tid_21283 = get_local_id(0);\n    group_sizze_21286 = get_local_size(0);\n    wave_sizze_21285 = LOCKSTEP_WIDTH;\n    group_tid_21284 = get_group_id(0);\n    \n    int32_t phys_tid_19830;\n    \n    phys_tid_19830 = global_tid_21282;\n    \n    __local char *red_arr_mem_21287;\n    \n    red_arr_mem_21287 = (__local char *) red_arr_mem_21287_backing_0;\n    \n    __local char *sync_arr_mem_21289;\n    \n    sync_arr_mem_21289 = (__local char *) sync_arr_mem_21289_backing_1;\n    \n    int32_t phys_group_id_21291;\n    \n    phys_group_id_21291 = get_group_id(0);\n    for (int32_t i_21292 = 0; i_21292 <\n         sdiv_up32(sext_i64_i32(virt_num_groups_21275) - phys_group_id_21291,\n                   sext_i64_i32(num_groups_19986)); i_21292++) {\n        int32_t virt_group_id_21293 = phys_group_id_21291 + i_21292 *\n                sext_i64_i32(num_groups_19986);\n        int32_t flat_segment_id_21294 = squot32(virt_group_id_21293,\n                                                sext_i64_i32(groups_per_segment_21273));\n        int64_t global_tid_21295 = srem64(sext_i32_i64(virt_group_id_21293) *\n                                          segred_group_sizze_19985 +\n                                          sext_i32_i64(local_tid_21283),\n                                          segred_group_sizze_19985 *\n  ",
                   "                                        groups_per_segment_21273);\n        int64_t gtid_19821 = sext_i32_i64(flat_segment_id_21294);\n        int64_t gtid_19829;\n        float x_acc_21296;\n        int64_t chunk_sizze_21297;\n        \n        chunk_sizze_21297 = smin64(elements_per_thread_21274,\n                                   sdiv_up64(paths_17885 -\n                                             sext_i32_i64(sext_i64_i32(global_tid_21295)),\n                                             threads_per_segment_21277));\n        \n        float x_19989;\n        float x_19990;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_21296 = 0.0F;\n        }\n        for (int64_t i_21301 = 0; i_21301 < chunk_sizze_21297; i_21301++) {\n            gtid_19829 = sext_i32_i64(sext_i64_i32(global_tid_21295)) +\n                threads_per_segment_21277 * i_21301;\n            // apply map function\n            {\n                float res_19994;\n                float redout_20211 = 0.0F;\n                \n                for (int64_t i_20212 = 0; i_20212 < n_17882; i_20212++) {\n                    float x_19998 = ((__global float *) mem_20423)[i_20212 *\n                                                                   (steps_17886 *\n                                                                    paths_17885) +\n                                                                   gtid_19829 *\n                                                                   steps_17886 +\n                                                                   gtid_19821];\n                    float res_19997 = x_19998 + redout_20211;\n                    float redout_tmp_21302 = res_19997;\n                    \n                    redout_20211 = redout_tmp_21302;\n                }\n                res_19994 = redout_20211;\n                \n                float res_19999 = fmax32(0.0F, res_19994);\n                \n                // save map-out results\n                { }\n               ",
                   " // load accumulator\n                {\n                    x_19989 = x_acc_21296;\n                }\n                // load new values\n                {\n                    x_19990 = res_19999;\n                }\n                // apply reduction operator\n                {\n                    float res_19991 = x_19989 + x_19990;\n                    \n                    // store in accumulator\n                    {\n                        x_acc_21296 = res_19991;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_19989 = x_acc_21296;\n            ((__local\n              float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283)] =\n                x_19989;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_21303;\n        int32_t skip_waves_21304;\n        \n        skip_waves_21304 = 1;\n        \n        float x_21298;\n        float x_21299;\n        \n        offset_21303 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_21283,\n                      sext_i64_i32(segred_group_sizze_19985))) {\n                x_21298 = ((__local\n                            float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283 +\n                                                        offset_21303)];\n            }\n        }\n        offset_21303 = 1;\n        while (slt32(offset_21303, wave_sizze_21285)) {\n            if (slt32(local_tid_21283 + offset_21303,\n                      sext_i64_i32(segred_group_sizze_19985)) &&\n                ((local_tid_21283 - squot32(local_tid_21283, wave_sizze_21285) *\n                  wave_sizze_21285) & (2 * offset_21303 - 1)) == 0) {\n                // read array element\n                {\n                    x_21299 = ((volatile __local\n                                float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283 +\n                                            ",
                   "                offset_21303)];\n                }\n                // apply reduction operation\n                {\n                    float res_21300 = x_21298 + x_21299;\n                    \n                    x_21298 = res_21300;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283)] =\n                        x_21298;\n                }\n            }\n            offset_21303 *= 2;\n        }\n        while (slt32(skip_waves_21304,\n                     squot32(sext_i64_i32(segred_group_sizze_19985) +\n                             wave_sizze_21285 - 1, wave_sizze_21285))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_21303 = skip_waves_21304 * wave_sizze_21285;\n            if (slt32(local_tid_21283 + offset_21303,\n                      sext_i64_i32(segred_group_sizze_19985)) &&\n                ((local_tid_21283 - squot32(local_tid_21283, wave_sizze_21285) *\n                  wave_sizze_21285) == 0 && (squot32(local_tid_21283,\n                                                     wave_sizze_21285) & (2 *\n                                                                          skip_waves_21304 -\n                                                                          1)) ==\n                 0)) {\n                // read array element\n                {\n                    x_21299 = ((__local\n                                float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283 +\n                                                            offset_21303)];\n                }\n                // apply reduction operation\n                {\n                    float res_21300 = x_21298 + x_21299;\n                    \n                    x_21298 = res_21300;\n                }\n                // write result of operation\n                {\n                    ((__local\n                      float *) red_arr_mem_21287)[se",
                   "xt_i32_i64(local_tid_21283)] =\n                        x_21298;\n                }\n            }\n            skip_waves_21304 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (sext_i32_i64(local_tid_21283) == 0) {\n                x_acc_21296 = x_21298;\n            }\n        }\n        if (groups_per_segment_21273 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_21283 == 0) {\n                    ((__global float *) mem_20426)[gtid_19821] = x_acc_21296;\n                }\n            }\n        } else {\n            int32_t old_counter_21305;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_21283 == 0) {\n                    ((__global\n                      float *) group_res_arr_mem_21278)[sext_i32_i64(virt_group_id_21293) *\n                                                        segred_group_sizze_19985] =\n                        x_acc_21296;\n                    mem_fence_global();\n                    old_counter_21305 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_21280)[sext_i32_i64(srem32(flat_segment_id_21294,\n                                                                                                     10240))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_21289)[0] =\n                        old_counter_21305 == groups_per_segment_21273 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            \n            bool is_last_group_21306;\n            \n            is_last_group_21306 = ((__local bool *) sync_arr_mem_21289)[0];\n            if (is_last_group_21306) {\n                if (local_tid_21283 == 0) {\n                   ",
                   " old_counter_21305 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_21280)[sext_i32_i64(srem32(flat_segment_id_21294,\n                                                                                                     10240))],\n                                              (int) (0 -\n                                                     groups_per_segment_21273));\n                }\n                // read in the per-group-results\n                {\n                    int64_t read_per_thread_21307 =\n                            sdiv_up64(groups_per_segment_21273,\n                                      segred_group_sizze_19985);\n                    \n                    x_19989 = 0.0F;\n                    for (int64_t i_21308 = 0; i_21308 < read_per_thread_21307;\n                         i_21308++) {\n                        int64_t group_res_id_21309 =\n                                sext_i32_i64(local_tid_21283) *\n                                read_per_thread_21307 + i_21308;\n                        int64_t index_of_group_res_21310 =\n                                sext_i32_i64(flat_segment_id_21294) *\n                                groups_per_segment_21273 + group_res_id_21309;\n                        \n                        if (slt64(group_res_id_21309,\n                                  groups_per_segment_21273)) {\n                            x_19990 = ((__global\n                                        float *) group_res_arr_mem_21278)[index_of_group_res_21310 *\n                                                                          segred_group_sizze_19985];\n                            \n                            float res_19991;\n                            \n                            res_19991 = x_19989 + x_19990;\n                            x_19989 = res_19991;\n                        }\n                    }\n                }\n                ((__local\n             ",
                   "     float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283)] =\n                    x_19989;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n                    int32_t offset_21311;\n                    int32_t skip_waves_21312;\n                    \n                    skip_waves_21312 = 1;\n                    \n                    float x_21298;\n                    float x_21299;\n                    \n                    offset_21311 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_21283,\n                                  sext_i64_i32(segred_group_sizze_19985))) {\n                            x_21298 = ((__local\n                                        float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283 +\n                                                                    offset_21311)];\n                        }\n                    }\n                    offset_21311 = 1;\n                    while (slt32(offset_21311, wave_sizze_21285)) {\n                        if (slt32(local_tid_21283 + offset_21311,\n                                  sext_i64_i32(segred_group_sizze_19985)) &&\n                            ((local_tid_21283 - squot32(local_tid_21283,\n                                                        wave_sizze_21285) *\n                              wave_sizze_21285) & (2 * offset_21311 - 1)) ==\n                            0) {\n                            // read array element\n                            {\n                                x_21299 = ((volatile __local\n                                            float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283 +\n                                                                        offset_21311)];\n                            }\n                            // apply reduction operation\n                            {\n                                floa",
                   "t res_21300 = x_21298 + x_21299;\n                                \n                                x_21298 = res_21300;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283)] =\n                                    x_21298;\n                            }\n                        }\n                        offset_21311 *= 2;\n                    }\n                    while (slt32(skip_waves_21312,\n                                 squot32(sext_i64_i32(segred_group_sizze_19985) +\n                                         wave_sizze_21285 - 1,\n                                         wave_sizze_21285))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_21311 = skip_waves_21312 * wave_sizze_21285;\n                        if (slt32(local_tid_21283 + offset_21311,\n                                  sext_i64_i32(segred_group_sizze_19985)) &&\n                            ((local_tid_21283 - squot32(local_tid_21283,\n                                                        wave_sizze_21285) *\n                              wave_sizze_21285) == 0 &&\n                             (squot32(local_tid_21283, wave_sizze_21285) & (2 *\n                                                                            skip_waves_21312 -\n                                                                            1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_21299 = ((__local\n                                            float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283 +\n                                                                        offset_21311)];\n                            }\n                            // apply reduction operation\n            ",
                   "                {\n                                float res_21300 = x_21298 + x_21299;\n                                \n                                x_21298 = res_21300;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  float *) red_arr_mem_21287)[sext_i32_i64(local_tid_21283)] =\n                                    x_21298;\n                            }\n                        }\n                        skip_waves_21312 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_21283 == 0) {\n                            ((__global float *) mem_20426)[gtid_19821] =\n                                x_21298;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_19985\n}\n__kernel void mainzisegred_large_20861(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *sync_arr_mem_20899_backing_aligned_0,\n                                       __local volatile\n                                       int64_t *red_arr_mem_20897_backing_aligned_1,\n                                       int64_t res_18101,\n                                       int64_t num_groups_19520, __global\n                                       unsigned char *mem_20363,\n                                       int32_t num_subhistos_20775, __global\n                                       unsigned char *res_subhistos_mem_20776,\n                                       int64_t groups_per_segment_20883,\n                                       int64_t elements_per_thread_20884,\n                                       int64_t virt_num_groups_20885,\n      ",
                   "                                 int64_t threads_per_segment_20887,\n                                       __global\n                                       unsigned char *group_res_arr_mem_20888,\n                                       __global\n                                       unsigned char *mainzicounter_mem_20890)\n{\n    #define seghist_group_sizze_19518 (mainziseghist_group_sizze_19517)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict sync_arr_mem_20899_backing_1 =\n                          (__local volatile\n                           char *) sync_arr_mem_20899_backing_aligned_0;\n    __local volatile char *restrict red_arr_mem_20897_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_20897_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20892;\n    int32_t local_tid_20893;\n    int64_t group_sizze_20896;\n    int32_t wave_sizze_20895;\n    int32_t group_tid_20894;\n    \n    global_tid_20892 = get_global_id(0);\n    local_tid_20893 = get_local_id(0);\n    group_sizze_20896 = get_local_size(0);\n    wave_sizze_20895 = LOCKSTEP_WIDTH;\n    group_tid_20894 = get_group_id(0);\n    \n    int32_t flat_gtid_20861;\n    \n    flat_gtid_20861 = global_tid_20892;\n    \n    __local char *red_arr_mem_20897;\n    \n    red_arr_mem_20897 = (__local char *) red_arr_mem_20897_backing_0;\n    \n    __local char *sync_arr_mem_20899;\n    \n    sync_arr_mem_20899 = (__local char *) sync_arr_mem_20899_backing_1;\n    \n    int32_t phys_group_id_20901;\n    \n    phys_group_id_20901 = get_group_id(0);\n    for (int32_t i_20902 = 0; i_20902 <\n         sdiv_up32(sext_i64_i32(virt_num_groups_20885) - phys_group_id_20901,\n                   sext_i64_i32(num_groups_19520)); i_20902++) {\n        int32_t virt_group_id_20903 = phys_group_id_20901 + i_20902 *\n                sext_i64_i32(num_groups_19520);\n        int32_t flat_segment_",
                   "id_20904 = squot32(virt_group_id_20903,\n                                                sext_i64_i32(groups_per_segment_20883));\n        int64_t global_tid_20905 = srem64(sext_i32_i64(virt_group_id_20903) *\n                                          seghist_group_sizze_19518 +\n                                          sext_i32_i64(local_tid_20893),\n                                          seghist_group_sizze_19518 *\n                                          groups_per_segment_20883);\n        int64_t bucket_id_20859 = sext_i32_i64(flat_segment_id_20904);\n        int64_t subhistogram_id_20860;\n        int64_t x_acc_20906;\n        int64_t chunk_sizze_20907;\n        \n        chunk_sizze_20907 = smin64(elements_per_thread_20884,\n                                   sdiv_up64(num_subhistos_20775 -\n                                             sext_i32_i64(sext_i64_i32(global_tid_20905)),\n                                             threads_per_segment_20887));\n        \n        int64_t x_19524;\n        int64_t x_19525;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_20906 = 0;\n        }\n        for (int64_t i_20911 = 0; i_20911 < chunk_sizze_20907; i_20911++) {\n            subhistogram_id_20860 =\n                sext_i32_i64(sext_i64_i32(global_tid_20905)) +\n                threads_per_segment_20887 * i_20911;\n            // apply map function\n            {\n                // load accumulator\n                {\n                    x_19524 = x_acc_20906;\n                }\n                // load new values\n                {\n                    x_19525 = ((__global\n                                int64_t *) res_subhistos_mem_20776)[subhistogram_id_20860 *\n                                                                    res_18101 +\n                                                                    bucket_id_20859];\n                }\n                // apply reduction operator\n                {\n                    int64_t res_19526 = smax64(",
                   "x_19524, x_19525);\n                    \n                    // store in accumulator\n                    {\n                        x_acc_20906 = res_19526;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_19524 = x_acc_20906;\n            ((__local\n              int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893)] =\n                x_19524;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_20912;\n        int32_t skip_waves_20913;\n        \n        skip_waves_20913 = 1;\n        \n        int64_t x_20908;\n        int64_t x_20909;\n        \n        offset_20912 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_20893,\n                      sext_i64_i32(seghist_group_sizze_19518))) {\n                x_20908 = ((__local\n                            int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893 +\n                                                          offset_20912)];\n            }\n        }\n        offset_20912 = 1;\n        while (slt32(offset_20912, wave_sizze_20895)) {\n            if (slt32(local_tid_20893 + offset_20912,\n                      sext_i64_i32(seghist_group_sizze_19518)) &&\n                ((local_tid_20893 - squot32(local_tid_20893, wave_sizze_20895) *\n                  wave_sizze_20895) & (2 * offset_20912 - 1)) == 0) {\n                // read array element\n                {\n                    x_20909 = ((volatile __local\n                                int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893 +\n                                                              offset_20912)];\n                }\n                // apply reduction operation\n                {\n                    int64_t res_20910 = smax64(x_20908, x_20909);\n                    \n                    x_20908 = res_20910;\n                }\n                // write result of op",
                   "eration\n                {\n                    ((volatile __local\n                      int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893)] =\n                        x_20908;\n                }\n            }\n            offset_20912 *= 2;\n        }\n        while (slt32(skip_waves_20913,\n                     squot32(sext_i64_i32(seghist_group_sizze_19518) +\n                             wave_sizze_20895 - 1, wave_sizze_20895))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_20912 = skip_waves_20913 * wave_sizze_20895;\n            if (slt32(local_tid_20893 + offset_20912,\n                      sext_i64_i32(seghist_group_sizze_19518)) &&\n                ((local_tid_20893 - squot32(local_tid_20893, wave_sizze_20895) *\n                  wave_sizze_20895) == 0 && (squot32(local_tid_20893,\n                                                     wave_sizze_20895) & (2 *\n                                                                          skip_waves_20913 -\n                                                                          1)) ==\n                 0)) {\n                // read array element\n                {\n                    x_20909 = ((__local\n                                int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893 +\n                                                              offset_20912)];\n                }\n                // apply reduction operation\n                {\n                    int64_t res_20910 = smax64(x_20908, x_20909);\n                    \n                    x_20908 = res_20910;\n                }\n                // write result of operation\n                {\n                    ((__local\n                      int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893)] =\n                        x_20908;\n                }\n            }\n            skip_waves_20913 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (sext_i3",
                   "2_i64(local_tid_20893) == 0) {\n                x_acc_20906 = x_20908;\n            }\n        }\n        if (groups_per_segment_20883 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_20893 == 0) {\n                    ((__global int64_t *) mem_20363)[bucket_id_20859] =\n                        x_acc_20906;\n                }\n            }\n        } else {\n            int32_t old_counter_20914;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_20893 == 0) {\n                    ((__global\n                      int64_t *) group_res_arr_mem_20888)[sext_i32_i64(virt_group_id_20903) *\n                                                          seghist_group_sizze_19518] =\n                        x_acc_20906;\n                    mem_fence_global();\n                    old_counter_20914 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_20890)[sext_i32_i64(srem32(flat_segment_id_20904,\n                                                                                                     10240))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_20899)[0] =\n                        old_counter_20914 == groups_per_segment_20883 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            \n            bool is_last_group_20915;\n            \n            is_last_group_20915 = ((__local bool *) sync_arr_mem_20899)[0];\n            if (is_last_group_20915) {\n                if (local_tid_20893 == 0) {\n                    old_counter_20914 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_20890)[sext_i32_i64(srem32(flat_segment_id_20904,\n                    ",
                   "                                                                                 10240))],\n                                              (int) (0 -\n                                                     groups_per_segment_20883));\n                }\n                // read in the per-group-results\n                {\n                    int64_t read_per_thread_20916 =\n                            sdiv_up64(groups_per_segment_20883,\n                                      seghist_group_sizze_19518);\n                    \n                    x_19524 = 0;\n                    for (int64_t i_20917 = 0; i_20917 < read_per_thread_20916;\n                         i_20917++) {\n                        int64_t group_res_id_20918 =\n                                sext_i32_i64(local_tid_20893) *\n                                read_per_thread_20916 + i_20917;\n                        int64_t index_of_group_res_20919 =\n                                sext_i32_i64(flat_segment_id_20904) *\n                                groups_per_segment_20883 + group_res_id_20918;\n                        \n                        if (slt64(group_res_id_20918,\n                                  groups_per_segment_20883)) {\n                            x_19525 = ((__global\n                                        int64_t *) group_res_arr_mem_20888)[index_of_group_res_20919 *\n                                                                            seghist_group_sizze_19518];\n                            \n                            int64_t res_19526;\n                            \n                            res_19526 = smax64(x_19524, x_19525);\n                            x_19524 = res_19526;\n                        }\n                    }\n                }\n                ((__local\n                  int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893)] =\n                    x_19524;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n           ",
                   "         int32_t offset_20920;\n                    int32_t skip_waves_20921;\n                    \n                    skip_waves_20921 = 1;\n                    \n                    int64_t x_20908;\n                    int64_t x_20909;\n                    \n                    offset_20920 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_20893,\n                                  sext_i64_i32(seghist_group_sizze_19518))) {\n                            x_20908 = ((__local\n                                        int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893 +\n                                                                      offset_20920)];\n                        }\n                    }\n                    offset_20920 = 1;\n                    while (slt32(offset_20920, wave_sizze_20895)) {\n                        if (slt32(local_tid_20893 + offset_20920,\n                                  sext_i64_i32(seghist_group_sizze_19518)) &&\n                            ((local_tid_20893 - squot32(local_tid_20893,\n                                                        wave_sizze_20895) *\n                              wave_sizze_20895) & (2 * offset_20920 - 1)) ==\n                            0) {\n                            // read array element\n                            {\n                                x_20909 = ((volatile __local\n                                            int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893 +\n                                                                          offset_20920)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t res_20910 = smax64(x_20908, x_20909);\n                                \n                                x_20908 = res_20910;\n                            }\n                            // write result of",
                   " operation\n                            {\n                                ((volatile __local\n                                  int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893)] =\n                                    x_20908;\n                            }\n                        }\n                        offset_20920 *= 2;\n                    }\n                    while (slt32(skip_waves_20921,\n                                 squot32(sext_i64_i32(seghist_group_sizze_19518) +\n                                         wave_sizze_20895 - 1,\n                                         wave_sizze_20895))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_20920 = skip_waves_20921 * wave_sizze_20895;\n                        if (slt32(local_tid_20893 + offset_20920,\n                                  sext_i64_i32(seghist_group_sizze_19518)) &&\n                            ((local_tid_20893 - squot32(local_tid_20893,\n                                                        wave_sizze_20895) *\n                              wave_sizze_20895) == 0 &&\n                             (squot32(local_tid_20893, wave_sizze_20895) & (2 *\n                                                                            skip_waves_20921 -\n                                                                            1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_20909 = ((__local\n                                            int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893 +\n                                                                          offset_20920)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t res_20910 = smax64(x_20908, x_20909);\n                                \n                                x_20908 = res_20910;\n     ",
                   "                       }\n                            // write result of operation\n                            {\n                                ((__local\n                                  int64_t *) red_arr_mem_20897)[sext_i32_i64(local_tid_20893)] =\n                                    x_20908;\n                            }\n                        }\n                        skip_waves_20921 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_20893 == 0) {\n                            ((__global int64_t *) mem_20363)[bucket_id_20859] =\n                                x_20908;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef seghist_group_sizze_19518\n}\n__kernel void mainzisegred_nonseg_18386(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_20545_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_20543_backing_aligned_1,\n                                        int64_t n_17882,\n                                        int64_t num_groups_18381, __global\n                                        unsigned char *swap_term_mem_20224,\n                                        __global\n                                        unsigned char *payments_mem_20225,\n                                        __global unsigned char *mem_20229,\n                                        __global\n                                        unsigned char *mainzicounter_mem_20533,\n                                        __global\n                                        unsigned char *group_res_arr_mem_20535,\n                                        int64_t num_threads_20537)\n{\n    #",
                   "define segred_group_sizze_18379 (mainzisegred_group_sizze_18378)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_20545_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_20545_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_20543_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_20543_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20538;\n    int32_t local_tid_20539;\n    int64_t group_sizze_20542;\n    int32_t wave_sizze_20541;\n    int32_t group_tid_20540;\n    \n    global_tid_20538 = get_global_id(0);\n    local_tid_20539 = get_local_id(0);\n    group_sizze_20542 = get_local_size(0);\n    wave_sizze_20541 = LOCKSTEP_WIDTH;\n    group_tid_20540 = get_group_id(0);\n    \n    int32_t phys_tid_18386;\n    \n    phys_tid_18386 = global_tid_20538;\n    \n    __local char *sync_arr_mem_20543;\n    \n    sync_arr_mem_20543 = (__local char *) sync_arr_mem_20543_backing_0;\n    \n    __local char *red_arr_mem_20545;\n    \n    red_arr_mem_20545 = (__local char *) red_arr_mem_20545_backing_1;\n    \n    int64_t dummy_18384;\n    \n    dummy_18384 = 0;\n    \n    int64_t gtid_18385;\n    \n    gtid_18385 = 0;\n    \n    float x_acc_20547;\n    int64_t chunk_sizze_20548;\n    \n    chunk_sizze_20548 = smin64(sdiv_up64(n_17882,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_18379 *\n                                         num_groups_18381))),\n                               sdiv_up64(n_17882 - sext_i32_i64(phys_tid_18386),\n                                         num_threads_20537));\n    \n    float x_17900;\n    float x_17901;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_20547 = -INFINITY;\n    }\n    for (int64_t i_20552 = 0; i_20552 < chunk_sizze_20548; i_20552++) {\n        gtid_18385",
                   " = sext_i32_i64(phys_tid_18386) + num_threads_20537 * i_20552;\n        // apply map function\n        {\n            float x_17903 = ((__global\n                              float *) swap_term_mem_20224)[gtid_18385];\n            int64_t x_17904 = ((__global\n                                int64_t *) payments_mem_20225)[gtid_18385];\n            float res_17905 = sitofp_i64_f32(x_17904);\n            float res_17906 = x_17903 * res_17905;\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_17900 = x_acc_20547;\n            }\n            // load new values\n            {\n                x_17901 = res_17906;\n            }\n            // apply reduction operator\n            {\n                float res_17902 = fmax32(x_17900, x_17901);\n                \n                // store in accumulator\n                {\n                    x_acc_20547 = res_17902;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_17900 = x_acc_20547;\n        ((__local float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539)] =\n            x_17900;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_20553;\n    int32_t skip_waves_20554;\n    \n    skip_waves_20554 = 1;\n    \n    float x_20549;\n    float x_20550;\n    \n    offset_20553 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_20539, sext_i64_i32(segred_group_sizze_18379))) {\n            x_20549 = ((__local\n                        float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539 +\n                                                    offset_20553)];\n        }\n    }\n    offset_20553 = 1;\n    while (slt32(offset_20553, wave_sizze_20541)) {\n        if (slt32(local_tid_20539 + offset_20553,\n                  sext_i64_i32(segred_group_sizze_18379)) && ((local_tid_20539 -\n                                                               squot32(loc",
                   "al_tid_20539,\n                                                                       wave_sizze_20541) *\n                                                               wave_sizze_20541) &\n                                                              (2 *\n                                                               offset_20553 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_20550 = ((volatile __local\n                            float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539 +\n                                                        offset_20553)];\n            }\n            // apply reduction operation\n            {\n                float res_20551 = fmax32(x_20549, x_20550);\n                \n                x_20549 = res_20551;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539)] =\n                    x_20549;\n            }\n        }\n        offset_20553 *= 2;\n    }\n    while (slt32(skip_waves_20554,\n                 squot32(sext_i64_i32(segred_group_sizze_18379) +\n                         wave_sizze_20541 - 1, wave_sizze_20541))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_20553 = skip_waves_20554 * wave_sizze_20541;\n        if (slt32(local_tid_20539 + offset_20553,\n                  sext_i64_i32(segred_group_sizze_18379)) && ((local_tid_20539 -\n                                                               squot32(local_tid_20539,\n                                                                       wave_sizze_20541) *\n                                                               wave_sizze_20541) ==\n                                                              0 &&\n                                                              (squot32(local_tid_20539,\n                                                                       ",
                   "wave_sizze_20541) &\n                                                               (2 *\n                                                                skip_waves_20554 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_20550 = ((__local\n                            float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539 +\n                                                        offset_20553)];\n            }\n            // apply reduction operation\n            {\n                float res_20551 = fmax32(x_20549, x_20550);\n                \n                x_20549 = res_20551;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539)] =\n                    x_20549;\n            }\n        }\n        skip_waves_20554 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_20539) == 0) {\n            x_acc_20547 = x_20549;\n        }\n    }\n    \n    int32_t old_counter_20555;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_20539 == 0) {\n            ((__global\n              float *) group_res_arr_mem_20535)[sext_i32_i64(group_tid_20540) *\n                                                segred_group_sizze_18379] =\n                x_acc_20547;\n            mem_fence_global();\n            old_counter_20555 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20533)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_20543)[0] = old_counter_20555 ==\n                num_groups_18381 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_20556;\n    \n    is_last_group_2055",
                   "6 = ((__local bool *) sync_arr_mem_20543)[0];\n    if (is_last_group_20556) {\n        if (local_tid_20539 == 0) {\n            old_counter_20555 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20533)[0],\n                                                      (int) (0 -\n                                                             num_groups_18381));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_20557 = sdiv_up64(num_groups_18381,\n                                                      segred_group_sizze_18379);\n            \n            x_17900 = -INFINITY;\n            for (int64_t i_20558 = 0; i_20558 < read_per_thread_20557;\n                 i_20558++) {\n                int64_t group_res_id_20559 = sext_i32_i64(local_tid_20539) *\n                        read_per_thread_20557 + i_20558;\n                int64_t index_of_group_res_20560 = group_res_id_20559;\n                \n                if (slt64(group_res_id_20559, num_groups_18381)) {\n                    x_17901 = ((__global\n                                float *) group_res_arr_mem_20535)[index_of_group_res_20560 *\n                                                                  segred_group_sizze_18379];\n                    \n                    float res_17902;\n                    \n                    res_17902 = fmax32(x_17900, x_17901);\n                    x_17900 = res_17902;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539)] =\n            x_17900;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_20561;\n            int32_t skip_waves_20562;\n            \n            skip_waves_20562 = 1;\n            \n            float x_20549;\n            float x_20550;\n            \n            offset_20561 = 0;\n            // participating threads read initial accumulat",
                   "or\n            {\n                if (slt32(local_tid_20539,\n                          sext_i64_i32(segred_group_sizze_18379))) {\n                    x_20549 = ((__local\n                                float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539 +\n                                                            offset_20561)];\n                }\n            }\n            offset_20561 = 1;\n            while (slt32(offset_20561, wave_sizze_20541)) {\n                if (slt32(local_tid_20539 + offset_20561,\n                          sext_i64_i32(segred_group_sizze_18379)) &&\n                    ((local_tid_20539 - squot32(local_tid_20539,\n                                                wave_sizze_20541) *\n                      wave_sizze_20541) & (2 * offset_20561 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_20550 = ((volatile __local\n                                    float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539 +\n                                                                offset_20561)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_20551 = fmax32(x_20549, x_20550);\n                        \n                        x_20549 = res_20551;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539)] =\n                            x_20549;\n                    }\n                }\n                offset_20561 *= 2;\n            }\n            while (slt32(skip_waves_20562,\n                         squot32(sext_i64_i32(segred_group_sizze_18379) +\n                                 wave_sizze_20541 - 1, wave_sizze_20541))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_20561 = skip_waves_20562 * wave_sizze_20541;\n                if (slt32(lo",
                   "cal_tid_20539 + offset_20561,\n                          sext_i64_i32(segred_group_sizze_18379)) &&\n                    ((local_tid_20539 - squot32(local_tid_20539,\n                                                wave_sizze_20541) *\n                      wave_sizze_20541) == 0 && (squot32(local_tid_20539,\n                                                         wave_sizze_20541) &\n                                                 (2 * skip_waves_20562 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_20550 = ((__local\n                                    float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539 +\n                                                                offset_20561)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_20551 = fmax32(x_20549, x_20550);\n                        \n                        x_20549 = res_20551;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_20545)[sext_i32_i64(local_tid_20539)] =\n                            x_20549;\n                    }\n                }\n                skip_waves_20562 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_20539 == 0) {\n                    ((__global float *) mem_20229)[0] = x_20549;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_18379\n}\n__kernel void mainzisegred_nonseg_19515(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_20747_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_20745_backing_aligned_1,\n  ",
                   "                                      int64_t num_groups_19510,\n                                        int64_t binop_x_20308, __global\n                                        unsigned char *mem_20358, __global\n                                        unsigned char *mem_20361, __global\n                                        unsigned char *mainzicounter_mem_20735,\n                                        __global\n                                        unsigned char *group_res_arr_mem_20737,\n                                        int64_t num_threads_20739)\n{\n    #define segred_group_sizze_19508 (mainzisegred_group_sizze_19507)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_20747_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_20747_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_20745_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_20745_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20740;\n    int32_t local_tid_20741;\n    int64_t group_sizze_20744;\n    int32_t wave_sizze_20743;\n    int32_t group_tid_20742;\n    \n    global_tid_20740 = get_global_id(0);\n    local_tid_20741 = get_local_id(0);\n    group_sizze_20744 = get_local_size(0);\n    wave_sizze_20743 = LOCKSTEP_WIDTH;\n    group_tid_20742 = get_group_id(0);\n    \n    int32_t phys_tid_19515;\n    \n    phys_tid_19515 = global_tid_20740;\n    \n    __local char *sync_arr_mem_20745;\n    \n    sync_arr_mem_20745 = (__local char *) sync_arr_mem_20745_backing_0;\n    \n    __local char *red_arr_mem_20747;\n    \n    red_arr_mem_20747 = (__local char *) red_arr_mem_20747_backing_1;\n    \n    int64_t dummy_19513;\n    \n    dummy_19513 = 0;\n    \n    int64_t gtid_19514;\n    \n    gtid_19514 = 0;\n    \n    int64_t x_acc_20749;\n    int64_t chunk_sizze_20750;\n    \n    ",
                   "chunk_sizze_20750 = smin64(sdiv_up64(binop_x_20308,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_19508 *\n                                         num_groups_19510))),\n                               sdiv_up64(binop_x_20308 -\n                                         sext_i32_i64(phys_tid_19515),\n                                         num_threads_20739));\n    \n    int64_t x_18102;\n    int64_t x_18103;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_20749 = 0;\n    }\n    for (int64_t i_20754 = 0; i_20754 < chunk_sizze_20750; i_20754++) {\n        gtid_19514 = sext_i32_i64(phys_tid_19515) + num_threads_20739 * i_20754;\n        // apply map function\n        {\n            int64_t x_18105 = ((__global int64_t *) mem_20358)[gtid_19514];\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_18102 = x_acc_20749;\n            }\n            // load new values\n            {\n                x_18103 = x_18105;\n            }\n            // apply reduction operator\n            {\n                int64_t res_18104 = add64(x_18102, x_18103);\n                \n                // store in accumulator\n                {\n                    x_acc_20749 = res_18104;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_18102 = x_acc_20749;\n        ((__local int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741)] =\n            x_18102;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_20755;\n    int32_t skip_waves_20756;\n    \n    skip_waves_20756 = 1;\n    \n    int64_t x_20751;\n    int64_t x_20752;\n    \n    offset_20755 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_20741, sext_i64_i32(segred_group_sizze_19508))) {\n            x_20751 = ((__local\n                        int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_207",
                   "41 +\n                                                      offset_20755)];\n        }\n    }\n    offset_20755 = 1;\n    while (slt32(offset_20755, wave_sizze_20743)) {\n        if (slt32(local_tid_20741 + offset_20755,\n                  sext_i64_i32(segred_group_sizze_19508)) && ((local_tid_20741 -\n                                                               squot32(local_tid_20741,\n                                                                       wave_sizze_20743) *\n                                                               wave_sizze_20743) &\n                                                              (2 *\n                                                               offset_20755 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_20752 = ((volatile __local\n                            int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741 +\n                                                          offset_20755)];\n            }\n            // apply reduction operation\n            {\n                int64_t res_20753 = add64(x_20751, x_20752);\n                \n                x_20751 = res_20753;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741)] =\n                    x_20751;\n            }\n        }\n        offset_20755 *= 2;\n    }\n    while (slt32(skip_waves_20756,\n                 squot32(sext_i64_i32(segred_group_sizze_19508) +\n                         wave_sizze_20743 - 1, wave_sizze_20743))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_20755 = skip_waves_20756 * wave_sizze_20743;\n        if (slt32(local_tid_20741 + offset_20755,\n                  sext_i64_i32(segred_group_sizze_19508)) && ((local_tid_20741 -\n                                                               squot32(local_tid_20741,\n                        ",
                   "                                               wave_sizze_20743) *\n                                                               wave_sizze_20743) ==\n                                                              0 &&\n                                                              (squot32(local_tid_20741,\n                                                                       wave_sizze_20743) &\n                                                               (2 *\n                                                                skip_waves_20756 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_20752 = ((__local\n                            int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741 +\n                                                          offset_20755)];\n            }\n            // apply reduction operation\n            {\n                int64_t res_20753 = add64(x_20751, x_20752);\n                \n                x_20751 = res_20753;\n            }\n            // write result of operation\n            {\n                ((__local\n                  int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741)] =\n                    x_20751;\n            }\n        }\n        skip_waves_20756 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_20741) == 0) {\n            x_acc_20749 = x_20751;\n        }\n    }\n    \n    int32_t old_counter_20757;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_20741 == 0) {\n            ((__global\n              int64_t *) group_res_arr_mem_20737)[sext_i32_i64(group_tid_20742) *\n                                                  segred_group_sizze_19508] =\n                x_acc_20749;\n            mem_fence_global();\n            old_counter_20757 = atomic_add_i32_global(&((volatile __global\n                  ",
                   "                                       int *) mainzicounter_mem_20735)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_20745)[0] = old_counter_20757 ==\n                num_groups_19510 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_20758;\n    \n    is_last_group_20758 = ((__local bool *) sync_arr_mem_20745)[0];\n    if (is_last_group_20758) {\n        if (local_tid_20741 == 0) {\n            old_counter_20757 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20735)[0],\n                                                      (int) (0 -\n                                                             num_groups_19510));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_20759 = sdiv_up64(num_groups_19510,\n                                                      segred_group_sizze_19508);\n            \n            x_18102 = 0;\n            for (int64_t i_20760 = 0; i_20760 < read_per_thread_20759;\n                 i_20760++) {\n                int64_t group_res_id_20761 = sext_i32_i64(local_tid_20741) *\n                        read_per_thread_20759 + i_20760;\n                int64_t index_of_group_res_20762 = group_res_id_20761;\n                \n                if (slt64(group_res_id_20761, num_groups_19510)) {\n                    x_18103 = ((__global\n                                int64_t *) group_res_arr_mem_20737)[index_of_group_res_20762 *\n                                                                    segred_group_sizze_19508];\n                    \n                    int64_t res_18104;\n                    \n                    res_18104 = add64(x_18102, x_18103);\n                    x_18102 = res_18104;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741)] =\n          ",
                   "  x_18102;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_20763;\n            int32_t skip_waves_20764;\n            \n            skip_waves_20764 = 1;\n            \n            int64_t x_20751;\n            int64_t x_20752;\n            \n            offset_20763 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_20741,\n                          sext_i64_i32(segred_group_sizze_19508))) {\n                    x_20751 = ((__local\n                                int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741 +\n                                                              offset_20763)];\n                }\n            }\n            offset_20763 = 1;\n            while (slt32(offset_20763, wave_sizze_20743)) {\n                if (slt32(local_tid_20741 + offset_20763,\n                          sext_i64_i32(segred_group_sizze_19508)) &&\n                    ((local_tid_20741 - squot32(local_tid_20741,\n                                                wave_sizze_20743) *\n                      wave_sizze_20743) & (2 * offset_20763 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_20752 = ((volatile __local\n                                    int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741 +\n                                                                  offset_20763)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t res_20753 = add64(x_20751, x_20752);\n                        \n                        x_20751 = res_20753;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741)] =\n                            x_20751;\n                    }\n ",
                   "               }\n                offset_20763 *= 2;\n            }\n            while (slt32(skip_waves_20764,\n                         squot32(sext_i64_i32(segred_group_sizze_19508) +\n                                 wave_sizze_20743 - 1, wave_sizze_20743))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_20763 = skip_waves_20764 * wave_sizze_20743;\n                if (slt32(local_tid_20741 + offset_20763,\n                          sext_i64_i32(segred_group_sizze_19508)) &&\n                    ((local_tid_20741 - squot32(local_tid_20741,\n                                                wave_sizze_20743) *\n                      wave_sizze_20743) == 0 && (squot32(local_tid_20741,\n                                                         wave_sizze_20743) &\n                                                 (2 * skip_waves_20764 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_20752 = ((__local\n                                    int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741 +\n                                                                  offset_20763)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t res_20753 = add64(x_20751, x_20752);\n                        \n                        x_20751 = res_20753;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          int64_t *) red_arr_mem_20747)[sext_i32_i64(local_tid_20741)] =\n                            x_20751;\n                    }\n                }\n                skip_waves_20764 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_20741 == 0) {\n                    ((__global int64_t *) mem_20361)[0] = x_20751;\n                }\n            }\n        }\n    }\n    \n  error_1",
                   ":\n    return;\n    #undef segred_group_sizze_19508\n}\n__kernel void mainzisegred_nonseg_19625(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_21208_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_21206_backing_aligned_1,\n                                        int64_t n_17882, int64_t paths_17885,\n                                        int64_t steps_17886, float a_17890,\n                                        float x_17910, float x_17912,\n                                        float y_17914, float y_17915,\n                                        float sims_per_year_17992,\n                                        float res_18320,\n                                        int64_t num_groups_19628, __global\n                                        unsigned char *mem_20395, __global\n                                        unsigned char *mem_20398, __global\n                                        unsigned char *mem_20400, __global\n                                        unsigned char *mainzicounter_mem_21196,\n                                        __global\n                                        unsigned char *group_res_arr_mem_21198,\n                                        int64_t num_threads_21200)\n{\n    #define segred_group_sizze_19627 (mainzisegred_group_sizze_19616)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_21208_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_21208_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_21206_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_21206_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int3",
                   "2_t global_tid_21201;\n    int32_t local_tid_21202;\n    int64_t group_sizze_21205;\n    int32_t wave_sizze_21204;\n    int32_t group_tid_21203;\n    \n    global_tid_21201 = get_global_id(0);\n    local_tid_21202 = get_local_id(0);\n    group_sizze_21205 = get_local_size(0);\n    wave_sizze_21204 = LOCKSTEP_WIDTH;\n    group_tid_21203 = get_group_id(0);\n    \n    int32_t phys_tid_19625;\n    \n    phys_tid_19625 = global_tid_21201;\n    \n    __local char *sync_arr_mem_21206;\n    \n    sync_arr_mem_21206 = (__local char *) sync_arr_mem_21206_backing_0;\n    \n    __local char *red_arr_mem_21208;\n    \n    red_arr_mem_21208 = (__local char *) red_arr_mem_21208_backing_1;\n    \n    int64_t dummy_19623;\n    \n    dummy_19623 = 0;\n    \n    int64_t gtid_19624;\n    \n    gtid_19624 = 0;\n    \n    float x_acc_21210;\n    int64_t chunk_sizze_21211;\n    \n    chunk_sizze_21211 = smin64(sdiv_up64(steps_17886,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_19627 *\n                                         num_groups_19628))),\n                               sdiv_up64(steps_17886 -\n                                         sext_i32_i64(phys_tid_19625),\n                                         num_threads_21200));\n    \n    float x_19632;\n    float x_19633;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_21210 = 0.0F;\n    }\n    for (int64_t i_21215 = 0; i_21215 < chunk_sizze_21211; i_21215++) {\n        gtid_19624 = sext_i32_i64(phys_tid_19625) + num_threads_21200 * i_21215;\n        // apply map function\n        {\n            int64_t convop_x_20139 = add64(1, gtid_19624);\n            float binop_x_20140 = sitofp_i64_f32(convop_x_20139);\n            float index_primexp_20141 = binop_x_20140 / sims_per_year_17992;\n            float res_19637;\n            float redout_20201 = 0.0F;\n            \n            for (int64_t i_20202 = 0; i_20202 < paths_17885; i_20202++) {\n                float res_19642;\n                float redout_20203 = 0.0F;\n          ",
                   "      \n                for (int64_t i_20204 = 0; i_20204 < n_17882; i_20204++) {\n                    float x_19646 = ((__global float *) mem_20395)[i_20202 *\n                                                                   (steps_17886 *\n                                                                    n_17882) +\n                                                                   i_20204 *\n                                                                   steps_17886 +\n                                                                   gtid_19624];\n                    float res_19645 = x_19646 + redout_20203;\n                    float redout_tmp_21217 = res_19645;\n                    \n                    redout_20203 = redout_tmp_21217;\n                }\n                res_19642 = redout_20203;\n                \n                float res_19647 = fmax32(0.0F, res_19642);\n                float res_19640 = res_19647 + redout_20201;\n                float redout_tmp_21216 = res_19640;\n                \n                redout_20201 = redout_tmp_21216;\n            }\n            res_19637 = redout_20201;\n            \n            float res_19648 = res_19637 / res_18320;\n            float negate_arg_19649 = a_17890 * index_primexp_20141;\n            float exp_arg_19650 = 0.0F - negate_arg_19649;\n            float res_19651 = fpow32(2.7182817F, exp_arg_19650);\n            float x_19652 = 1.0F - res_19651;\n            float B_19653 = x_19652 / a_17890;\n            float x_19654 = B_19653 - index_primexp_20141;\n            float x_19655 = y_17914 * x_19654;\n            float A1_19656 = x_19655 / x_17910;\n            float y_19657 = fpow32(B_19653, 2.0F);\n            float x_19658 = x_17912 * y_19657;\n            float A2_19659 = x_19658 / y_17915;\n            float exp_arg_19660 = A1_19656 - A2_19659;\n            float res_19661 = fpow32(2.7182817F, exp_arg_19660);\n            float negate_arg_19662 = 5.0e-2F * B_19653;\n            float exp_arg_19663 = 0.0F - negate_arg_19662;",
                   "\n            float res_19664 = fpow32(2.7182817F, exp_arg_19663);\n            float res_19665 = res_19661 * res_19664;\n            float res_19666 = res_19648 * res_19665;\n            \n            // save map-out results\n            {\n                ((__global float *) mem_20400)[dummy_19623 * steps_17886 +\n                                               gtid_19624] = res_19648;\n            }\n            // load accumulator\n            {\n                x_19632 = x_acc_21210;\n            }\n            // load new values\n            {\n                x_19633 = res_19666;\n            }\n            // apply reduction operator\n            {\n                float res_19634 = x_19632 + x_19633;\n                \n                // store in accumulator\n                {\n                    x_acc_21210 = res_19634;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_19632 = x_acc_21210;\n        ((__local float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202)] =\n            x_19632;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_21218;\n    int32_t skip_waves_21219;\n    \n    skip_waves_21219 = 1;\n    \n    float x_21212;\n    float x_21213;\n    \n    offset_21218 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_21202, sext_i64_i32(segred_group_sizze_19627))) {\n            x_21212 = ((__local\n                        float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202 +\n                                                    offset_21218)];\n        }\n    }\n    offset_21218 = 1;\n    while (slt32(offset_21218, wave_sizze_21204)) {\n        if (slt32(local_tid_21202 + offset_21218,\n                  sext_i64_i32(segred_group_sizze_19627)) && ((local_tid_21202 -\n                                                               squot32(local_tid_21202,\n                                                                       wave_sizze_21204) *\n         ",
                   "                                                      wave_sizze_21204) &\n                                                              (2 *\n                                                               offset_21218 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_21213 = ((volatile __local\n                            float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202 +\n                                                        offset_21218)];\n            }\n            // apply reduction operation\n            {\n                float res_21214 = x_21212 + x_21213;\n                \n                x_21212 = res_21214;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202)] =\n                    x_21212;\n            }\n        }\n        offset_21218 *= 2;\n    }\n    while (slt32(skip_waves_21219,\n                 squot32(sext_i64_i32(segred_group_sizze_19627) +\n                         wave_sizze_21204 - 1, wave_sizze_21204))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_21218 = skip_waves_21219 * wave_sizze_21204;\n        if (slt32(local_tid_21202 + offset_21218,\n                  sext_i64_i32(segred_group_sizze_19627)) && ((local_tid_21202 -\n                                                               squot32(local_tid_21202,\n                                                                       wave_sizze_21204) *\n                                                               wave_sizze_21204) ==\n                                                              0 &&\n                                                              (squot32(local_tid_21202,\n                                                                       wave_sizze_21204) &\n                                                               (2 *\n                                 ",
                   "                               skip_waves_21219 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_21213 = ((__local\n                            float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202 +\n                                                        offset_21218)];\n            }\n            // apply reduction operation\n            {\n                float res_21214 = x_21212 + x_21213;\n                \n                x_21212 = res_21214;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202)] =\n                    x_21212;\n            }\n        }\n        skip_waves_21219 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_21202) == 0) {\n            x_acc_21210 = x_21212;\n        }\n    }\n    \n    int32_t old_counter_21220;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_21202 == 0) {\n            ((__global\n              float *) group_res_arr_mem_21198)[sext_i32_i64(group_tid_21203) *\n                                                segred_group_sizze_19627] =\n                x_acc_21210;\n            mem_fence_global();\n            old_counter_21220 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_21196)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_21206)[0] = old_counter_21220 ==\n                num_groups_19628 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_21221;\n    \n    is_last_group_21221 = ((__local bool *) sync_arr_mem_21206)[0];\n    if (is_last_group_21221) {\n        if (local_tid_21202 == 0) {\n            old",
                   "_counter_21220 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_21196)[0],\n                                                      (int) (0 -\n                                                             num_groups_19628));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_21222 = sdiv_up64(num_groups_19628,\n                                                      segred_group_sizze_19627);\n            \n            x_19632 = 0.0F;\n            for (int64_t i_21223 = 0; i_21223 < read_per_thread_21222;\n                 i_21223++) {\n                int64_t group_res_id_21224 = sext_i32_i64(local_tid_21202) *\n                        read_per_thread_21222 + i_21223;\n                int64_t index_of_group_res_21225 = group_res_id_21224;\n                \n                if (slt64(group_res_id_21224, num_groups_19628)) {\n                    x_19633 = ((__global\n                                float *) group_res_arr_mem_21198)[index_of_group_res_21225 *\n                                                                  segred_group_sizze_19627];\n                    \n                    float res_19634;\n                    \n                    res_19634 = x_19632 + x_19633;\n                    x_19632 = res_19634;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202)] =\n            x_19632;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_21226;\n            int32_t skip_waves_21227;\n            \n            skip_waves_21227 = 1;\n            \n            float x_21212;\n            float x_21213;\n            \n            offset_21226 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_21202,\n                          sext_i64_i32(segred_group_sizze_19627))) {\n           ",
                   "         x_21212 = ((__local\n                                float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202 +\n                                                            offset_21226)];\n                }\n            }\n            offset_21226 = 1;\n            while (slt32(offset_21226, wave_sizze_21204)) {\n                if (slt32(local_tid_21202 + offset_21226,\n                          sext_i64_i32(segred_group_sizze_19627)) &&\n                    ((local_tid_21202 - squot32(local_tid_21202,\n                                                wave_sizze_21204) *\n                      wave_sizze_21204) & (2 * offset_21226 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_21213 = ((volatile __local\n                                    float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202 +\n                                                                offset_21226)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_21214 = x_21212 + x_21213;\n                        \n                        x_21212 = res_21214;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202)] =\n                            x_21212;\n                    }\n                }\n                offset_21226 *= 2;\n            }\n            while (slt32(skip_waves_21227,\n                         squot32(sext_i64_i32(segred_group_sizze_19627) +\n                                 wave_sizze_21204 - 1, wave_sizze_21204))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_21226 = skip_waves_21227 * wave_sizze_21204;\n                if (slt32(local_tid_21202 + offset_21226,\n                          sext_i64_i32(segred_group_sizze_19627)) &&\n                    ((local_tid_21202 - squot32(",
                   "local_tid_21202,\n                                                wave_sizze_21204) *\n                      wave_sizze_21204) == 0 && (squot32(local_tid_21202,\n                                                         wave_sizze_21204) &\n                                                 (2 * skip_waves_21227 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_21213 = ((__local\n                                    float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202 +\n                                                                offset_21226)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_21214 = x_21212 + x_21213;\n                        \n                        x_21212 = res_21214;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_21208)[sext_i32_i64(local_tid_21202)] =\n                            x_21212;\n                    }\n                }\n                skip_waves_21227 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_21202 == 0) {\n                    ((__global float *) mem_20398)[0] = x_21212;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_19627\n}\n__kernel void mainzisegred_nonseg_19898(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_21332_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_21330_backing_aligned_1,\n                                        int64_t steps_17886,\n                                        int64_t num_groups_20030, __global\n                    ",
                   "                    unsigned char *res_map_acc_mem_20434,\n                                        __global unsigned char *mem_20438,\n                                        __global\n                                        unsigned char *mainzicounter_mem_21320,\n                                        __global\n                                        unsigned char *group_res_arr_mem_21322,\n                                        int64_t num_threads_21324)\n{\n    #define segred_group_sizze_20029 (mainzisegred_group_sizze_19890)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_21332_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_21332_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_21330_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_21330_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21325;\n    int32_t local_tid_21326;\n    int64_t group_sizze_21329;\n    int32_t wave_sizze_21328;\n    int32_t group_tid_21327;\n    \n    global_tid_21325 = get_global_id(0);\n    local_tid_21326 = get_local_id(0);\n    group_sizze_21329 = get_local_size(0);\n    wave_sizze_21328 = LOCKSTEP_WIDTH;\n    group_tid_21327 = get_group_id(0);\n    \n    int32_t phys_tid_19898;\n    \n    phys_tid_19898 = global_tid_21325;\n    \n    __local char *sync_arr_mem_21330;\n    \n    sync_arr_mem_21330 = (__local char *) sync_arr_mem_21330_backing_0;\n    \n    __local char *red_arr_mem_21332;\n    \n    red_arr_mem_21332 = (__local char *) red_arr_mem_21332_backing_1;\n    \n    int64_t dummy_19896;\n    \n    dummy_19896 = 0;\n    \n    int64_t gtid_19897;\n    \n    gtid_19897 = 0;\n    \n    float x_acc_21334;\n    int64_t chunk_sizze_21335;\n    \n    chunk_sizze_21335 = smin64(sdiv_up64(steps_17886,\n                                         sext_i32_i64(se",
                   "xt_i64_i32(segred_group_sizze_20029 *\n                                         num_groups_20030))),\n                               sdiv_up64(steps_17886 -\n                                         sext_i32_i64(phys_tid_19898),\n                                         num_threads_21324));\n    \n    float x_20033;\n    float x_20034;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_21334 = 0.0F;\n    }\n    for (int64_t i_21339 = 0; i_21339 < chunk_sizze_21335; i_21339++) {\n        gtid_19897 = sext_i32_i64(phys_tid_19898) + num_threads_21324 * i_21339;\n        // apply map function\n        {\n            float x_20036 = ((__global\n                              float *) res_map_acc_mem_20434)[gtid_19897];\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_20033 = x_acc_21334;\n            }\n            // load new values\n            {\n                x_20034 = x_20036;\n            }\n            // apply reduction operator\n            {\n                float res_20035 = x_20033 + x_20034;\n                \n                // store in accumulator\n                {\n                    x_acc_21334 = res_20035;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_20033 = x_acc_21334;\n        ((__local float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326)] =\n            x_20033;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_21340;\n    int32_t skip_waves_21341;\n    \n    skip_waves_21341 = 1;\n    \n    float x_21336;\n    float x_21337;\n    \n    offset_21340 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_21326, sext_i64_i32(segred_group_sizze_20029))) {\n            x_21336 = ((__local\n                        float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326 +\n                                                    offset_21340)];\n        }\n    }\n",
                   "    offset_21340 = 1;\n    while (slt32(offset_21340, wave_sizze_21328)) {\n        if (slt32(local_tid_21326 + offset_21340,\n                  sext_i64_i32(segred_group_sizze_20029)) && ((local_tid_21326 -\n                                                               squot32(local_tid_21326,\n                                                                       wave_sizze_21328) *\n                                                               wave_sizze_21328) &\n                                                              (2 *\n                                                               offset_21340 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_21337 = ((volatile __local\n                            float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326 +\n                                                        offset_21340)];\n            }\n            // apply reduction operation\n            {\n                float res_21338 = x_21336 + x_21337;\n                \n                x_21336 = res_21338;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326)] =\n                    x_21336;\n            }\n        }\n        offset_21340 *= 2;\n    }\n    while (slt32(skip_waves_21341,\n                 squot32(sext_i64_i32(segred_group_sizze_20029) +\n                         wave_sizze_21328 - 1, wave_sizze_21328))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_21340 = skip_waves_21341 * wave_sizze_21328;\n        if (slt32(local_tid_21326 + offset_21340,\n                  sext_i64_i32(segred_group_sizze_20029)) && ((local_tid_21326 -\n                                                               squot32(local_tid_21326,\n                                                                       wave_sizze_21328) *\n                                      ",
                   "                         wave_sizze_21328) ==\n                                                              0 &&\n                                                              (squot32(local_tid_21326,\n                                                                       wave_sizze_21328) &\n                                                               (2 *\n                                                                skip_waves_21341 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_21337 = ((__local\n                            float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326 +\n                                                        offset_21340)];\n            }\n            // apply reduction operation\n            {\n                float res_21338 = x_21336 + x_21337;\n                \n                x_21336 = res_21338;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326)] =\n                    x_21336;\n            }\n        }\n        skip_waves_21341 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_21326) == 0) {\n            x_acc_21334 = x_21336;\n        }\n    }\n    \n    int32_t old_counter_21342;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_21326 == 0) {\n            ((__global\n              float *) group_res_arr_mem_21322)[sext_i32_i64(group_tid_21327) *\n                                                segred_group_sizze_20029] =\n                x_acc_21334;\n            mem_fence_global();\n            old_counter_21342 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_21320)[0],\n                                                ",
                   "      (int) 1);\n            ((__local bool *) sync_arr_mem_21330)[0] = old_counter_21342 ==\n                num_groups_20030 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_21343;\n    \n    is_last_group_21343 = ((__local bool *) sync_arr_mem_21330)[0];\n    if (is_last_group_21343) {\n        if (local_tid_21326 == 0) {\n            old_counter_21342 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_21320)[0],\n                                                      (int) (0 -\n                                                             num_groups_20030));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_21344 = sdiv_up64(num_groups_20030,\n                                                      segred_group_sizze_20029);\n            \n            x_20033 = 0.0F;\n            for (int64_t i_21345 = 0; i_21345 < read_per_thread_21344;\n                 i_21345++) {\n                int64_t group_res_id_21346 = sext_i32_i64(local_tid_21326) *\n                        read_per_thread_21344 + i_21345;\n                int64_t index_of_group_res_21347 = group_res_id_21346;\n                \n                if (slt64(group_res_id_21346, num_groups_20030)) {\n                    x_20034 = ((__global\n                                float *) group_res_arr_mem_21322)[index_of_group_res_21347 *\n                                                                  segred_group_sizze_20029];\n                    \n                    float res_20035;\n                    \n                    res_20035 = x_20033 + x_20034;\n                    x_20033 = res_20035;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326)] =\n            x_20033;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_21348;\n ",
                   "           int32_t skip_waves_21349;\n            \n            skip_waves_21349 = 1;\n            \n            float x_21336;\n            float x_21337;\n            \n            offset_21348 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_21326,\n                          sext_i64_i32(segred_group_sizze_20029))) {\n                    x_21336 = ((__local\n                                float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326 +\n                                                            offset_21348)];\n                }\n            }\n            offset_21348 = 1;\n            while (slt32(offset_21348, wave_sizze_21328)) {\n                if (slt32(local_tid_21326 + offset_21348,\n                          sext_i64_i32(segred_group_sizze_20029)) &&\n                    ((local_tid_21326 - squot32(local_tid_21326,\n                                                wave_sizze_21328) *\n                      wave_sizze_21328) & (2 * offset_21348 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_21337 = ((volatile __local\n                                    float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326 +\n                                                                offset_21348)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_21338 = x_21336 + x_21337;\n                        \n                        x_21336 = res_21338;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326)] =\n                            x_21336;\n                    }\n                }\n                offset_21348 *= 2;\n            }\n            while (slt32(skip_waves_21349,\n                         squot32(sext_i64_i32(s",
                   "egred_group_sizze_20029) +\n                                 wave_sizze_21328 - 1, wave_sizze_21328))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_21348 = skip_waves_21349 * wave_sizze_21328;\n                if (slt32(local_tid_21326 + offset_21348,\n                          sext_i64_i32(segred_group_sizze_20029)) &&\n                    ((local_tid_21326 - squot32(local_tid_21326,\n                                                wave_sizze_21328) *\n                      wave_sizze_21328) == 0 && (squot32(local_tid_21326,\n                                                         wave_sizze_21328) &\n                                                 (2 * skip_waves_21349 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_21337 = ((__local\n                                    float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326 +\n                                                                offset_21348)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_21338 = x_21336 + x_21337;\n                        \n                        x_21336 = res_21338;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_21332)[sext_i32_i64(local_tid_21326)] =\n                            x_21336;\n                    }\n                }\n                skip_waves_21349 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_21326 == 0) {\n                    ((__global float *) mem_20438)[0] = x_21336;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_20029\n}\n__kernel void mainzisegred_nonseg_20460(__global int *global_failure,\n                                        __local vo",
                   "latile\n                                        int64_t *red_arr_mem_20575_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_20573_backing_aligned_1,\n                                        int64_t n_17882, __global\n                                        unsigned char *payments_mem_20225,\n                                        __global unsigned char *mem_20472,\n                                        __global\n                                        unsigned char *mainzicounter_mem_20563,\n                                        __global\n                                        unsigned char *group_res_arr_mem_20565,\n                                        int64_t num_threads_20567)\n{\n    #define segred_num_groups_20454 (mainzisegred_num_groups_20453)\n    #define segred_group_sizze_20456 (mainzisegred_group_sizze_20455)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_20575_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_20575_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_20573_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_20573_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20568;\n    int32_t local_tid_20569;\n    int64_t group_sizze_20572;\n    int32_t wave_sizze_20571;\n    int32_t group_tid_20570;\n    \n    global_tid_20568 = get_global_id(0);\n    local_tid_20569 = get_local_id(0);\n    group_sizze_20572 = get_local_size(0);\n    wave_sizze_20571 = LOCKSTEP_WIDTH;\n    group_tid_20570 = get_group_id(0);\n    \n    int32_t phys_tid_20460;\n    \n    phys_tid_20460 = global_tid_20568;\n    \n    __local char *sync_arr_mem_20573;\n    \n    sync_arr_mem_20573 = (__local char *) sync_arr_mem_20573_backing_0;\n    \n    __lo",
                   "cal char *red_arr_mem_20575;\n    \n    red_arr_mem_20575 = (__local char *) red_arr_mem_20575_backing_1;\n    \n    int64_t dummy_20458;\n    \n    dummy_20458 = 0;\n    \n    int64_t gtid_20459;\n    \n    gtid_20459 = 0;\n    \n    int64_t x_acc_20577;\n    int64_t chunk_sizze_20578;\n    \n    chunk_sizze_20578 = smin64(sdiv_up64(n_17882,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_20456 *\n                                         segred_num_groups_20454))),\n                               sdiv_up64(n_17882 - sext_i32_i64(phys_tid_20460),\n                                         num_threads_20567));\n    \n    int64_t x_20461;\n    int64_t y_20462;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_20577 = 0;\n    }\n    for (int64_t i_20582 = 0; i_20582 < chunk_sizze_20578; i_20582++) {\n        gtid_20459 = sext_i32_i64(phys_tid_20460) + num_threads_20567 * i_20582;\n        // apply map function\n        {\n            int64_t res_20465 = ((__global\n                                  int64_t *) payments_mem_20225)[gtid_20459];\n            int64_t bytes_20466 = 4 * res_20465;\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_20461 = x_acc_20577;\n            }\n            // load new values\n            {\n                y_20462 = bytes_20466;\n            }\n            // apply reduction operator\n            {\n                int64_t zz_20463 = smax64(x_20461, y_20462);\n                \n                // store in accumulator\n                {\n                    x_acc_20577 = zz_20463;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_20461 = x_acc_20577;\n        ((__local int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569)] =\n            x_20461;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_20583;\n    int32_t skip_waves_20584;\n    \n    skip_waves_",
                   "20584 = 1;\n    \n    int64_t x_20579;\n    int64_t y_20580;\n    \n    offset_20583 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_20569, sext_i64_i32(segred_group_sizze_20456))) {\n            x_20579 = ((__local\n                        int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569 +\n                                                      offset_20583)];\n        }\n    }\n    offset_20583 = 1;\n    while (slt32(offset_20583, wave_sizze_20571)) {\n        if (slt32(local_tid_20569 + offset_20583,\n                  sext_i64_i32(segred_group_sizze_20456)) && ((local_tid_20569 -\n                                                               squot32(local_tid_20569,\n                                                                       wave_sizze_20571) *\n                                                               wave_sizze_20571) &\n                                                              (2 *\n                                                               offset_20583 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                y_20580 = ((volatile __local\n                            int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569 +\n                                                          offset_20583)];\n            }\n            // apply reduction operation\n            {\n                int64_t zz_20581 = smax64(x_20579, y_20580);\n                \n                x_20579 = zz_20581;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569)] =\n                    x_20579;\n            }\n        }\n        offset_20583 *= 2;\n    }\n    while (slt32(skip_waves_20584,\n                 squot32(sext_i64_i32(segred_group_sizze_20456) +\n                         wave_sizze_20571 - 1, wave_sizze_20571))) {\n       ",
                   " barrier(CLK_LOCAL_MEM_FENCE);\n        offset_20583 = skip_waves_20584 * wave_sizze_20571;\n        if (slt32(local_tid_20569 + offset_20583,\n                  sext_i64_i32(segred_group_sizze_20456)) && ((local_tid_20569 -\n                                                               squot32(local_tid_20569,\n                                                                       wave_sizze_20571) *\n                                                               wave_sizze_20571) ==\n                                                              0 &&\n                                                              (squot32(local_tid_20569,\n                                                                       wave_sizze_20571) &\n                                                               (2 *\n                                                                skip_waves_20584 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                y_20580 = ((__local\n                            int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569 +\n                                                          offset_20583)];\n            }\n            // apply reduction operation\n            {\n                int64_t zz_20581 = smax64(x_20579, y_20580);\n                \n                x_20579 = zz_20581;\n            }\n            // write result of operation\n            {\n                ((__local\n                  int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569)] =\n                    x_20579;\n            }\n        }\n        skip_waves_20584 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_20569) == 0) {\n            x_acc_20577 = x_20579;\n        }\n    }\n    \n    int32_t old_counter_20585;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_20569 == 0) {\n    ",
                   "        ((__global\n              int64_t *) group_res_arr_mem_20565)[sext_i32_i64(group_tid_20570) *\n                                                  segred_group_sizze_20456] =\n                x_acc_20577;\n            mem_fence_global();\n            old_counter_20585 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20563)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_20573)[0] = old_counter_20585 ==\n                segred_num_groups_20454 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_20586;\n    \n    is_last_group_20586 = ((__local bool *) sync_arr_mem_20573)[0];\n    if (is_last_group_20586) {\n        if (local_tid_20569 == 0) {\n            old_counter_20585 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20563)[0],\n                                                      (int) (0 -\n                                                             segred_num_groups_20454));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_20587 = sdiv_up64(segred_num_groups_20454,\n                                                      segred_group_sizze_20456);\n            \n            x_20461 = 0;\n            for (int64_t i_20588 = 0; i_20588 < read_per_thread_20587;\n                 i_20588++) {\n                int64_t group_res_id_20589 = sext_i32_i64(local_tid_20569) *\n                        read_per_thread_20587 + i_20588;\n                int64_t index_of_group_res_20590 = group_res_id_20589;\n                \n                if (slt64(group_res_id_20589, segred_num_groups_20454)) {\n                    y_20462 = ((__global\n                                int64_t *) group_res_arr_mem_20565)[index_of_group_res_20590 *\n                                              ",
                   "                      segred_group_sizze_20456];\n                    \n                    int64_t zz_20463;\n                    \n                    zz_20463 = smax64(x_20461, y_20462);\n                    x_20461 = zz_20463;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569)] =\n            x_20461;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_20591;\n            int32_t skip_waves_20592;\n            \n            skip_waves_20592 = 1;\n            \n            int64_t x_20579;\n            int64_t y_20580;\n            \n            offset_20591 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_20569,\n                          sext_i64_i32(segred_group_sizze_20456))) {\n                    x_20579 = ((__local\n                                int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569 +\n                                                              offset_20591)];\n                }\n            }\n            offset_20591 = 1;\n            while (slt32(offset_20591, wave_sizze_20571)) {\n                if (slt32(local_tid_20569 + offset_20591,\n                          sext_i64_i32(segred_group_sizze_20456)) &&\n                    ((local_tid_20569 - squot32(local_tid_20569,\n                                                wave_sizze_20571) *\n                      wave_sizze_20571) & (2 * offset_20591 - 1)) == 0) {\n                    // read array element\n                    {\n                        y_20580 = ((volatile __local\n                                    int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569 +\n                                                                  offset_20591)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zz_20581 = smax64(x_20579, y_2058",
                   "0);\n                        \n                        x_20579 = zz_20581;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569)] =\n                            x_20579;\n                    }\n                }\n                offset_20591 *= 2;\n            }\n            while (slt32(skip_waves_20592,\n                         squot32(sext_i64_i32(segred_group_sizze_20456) +\n                                 wave_sizze_20571 - 1, wave_sizze_20571))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_20591 = skip_waves_20592 * wave_sizze_20571;\n                if (slt32(local_tid_20569 + offset_20591,\n                          sext_i64_i32(segred_group_sizze_20456)) &&\n                    ((local_tid_20569 - squot32(local_tid_20569,\n                                                wave_sizze_20571) *\n                      wave_sizze_20571) == 0 && (squot32(local_tid_20569,\n                                                         wave_sizze_20571) &\n                                                 (2 * skip_waves_20592 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        y_20580 = ((__local\n                                    int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569 +\n                                                                  offset_20591)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zz_20581 = smax64(x_20579, y_20580);\n                        \n                        x_20579 = zz_20581;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          int64_t *) red_arr_mem_20575)[sext_i32_i64(local_tid_20569)] =\n                ",
                   "            x_20579;\n                    }\n                }\n                skip_waves_20592 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_20569 == 0) {\n                    ((__global int64_t *) mem_20472)[0] = x_20579;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_num_groups_20454\n    #undef segred_group_sizze_20456\n}\n__kernel void mainzisegred_nonseg_20492(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_20612_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_20610_backing_aligned_1,\n                                        int64_t n_17882, __global\n                                        unsigned char *payments_mem_20225,\n                                        __global unsigned char *mem_20504,\n                                        __global\n                                        unsigned char *mainzicounter_mem_20600,\n                                        __global\n                                        unsigned char *group_res_arr_mem_20602,\n                                        int64_t num_threads_20604)\n{\n    #define segred_num_groups_20486 (mainzisegred_num_groups_20485)\n    #define segred_group_sizze_20488 (mainzisegred_group_sizze_20487)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_20612_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_20612_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_20610_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_20610_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n ",
                   "   int32_t global_tid_20605;\n    int32_t local_tid_20606;\n    int64_t group_sizze_20609;\n    int32_t wave_sizze_20608;\n    int32_t group_tid_20607;\n    \n    global_tid_20605 = get_global_id(0);\n    local_tid_20606 = get_local_id(0);\n    group_sizze_20609 = get_local_size(0);\n    wave_sizze_20608 = LOCKSTEP_WIDTH;\n    group_tid_20607 = get_group_id(0);\n    \n    int32_t phys_tid_20492;\n    \n    phys_tid_20492 = global_tid_20605;\n    \n    __local char *sync_arr_mem_20610;\n    \n    sync_arr_mem_20610 = (__local char *) sync_arr_mem_20610_backing_0;\n    \n    __local char *red_arr_mem_20612;\n    \n    red_arr_mem_20612 = (__local char *) red_arr_mem_20612_backing_1;\n    \n    int64_t dummy_20490;\n    \n    dummy_20490 = 0;\n    \n    int64_t gtid_20491;\n    \n    gtid_20491 = 0;\n    \n    int64_t x_acc_20614;\n    int64_t chunk_sizze_20615;\n    \n    chunk_sizze_20615 = smin64(sdiv_up64(n_17882,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_20488 *\n                                         segred_num_groups_20486))),\n                               sdiv_up64(n_17882 - sext_i32_i64(phys_tid_20492),\n                                         num_threads_20604));\n    \n    int64_t x_20493;\n    int64_t y_20494;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_20614 = 0;\n    }\n    for (int64_t i_20619 = 0; i_20619 < chunk_sizze_20615; i_20619++) {\n        gtid_20491 = sext_i32_i64(phys_tid_20492) + num_threads_20604 * i_20619;\n        // apply map function\n        {\n            int64_t res_20497 = ((__global\n                                  int64_t *) payments_mem_20225)[gtid_20491];\n            int64_t bytes_20498 = 4 * res_20497;\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_20493 = x_acc_20614;\n            }\n            // load new values\n            {\n                y_20494 = bytes_20498;\n            }\n            // apply reduction operator\n   ",
                   "         {\n                int64_t zz_20495 = smax64(x_20493, y_20494);\n                \n                // store in accumulator\n                {\n                    x_acc_20614 = zz_20495;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_20493 = x_acc_20614;\n        ((__local int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606)] =\n            x_20493;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_20620;\n    int32_t skip_waves_20621;\n    \n    skip_waves_20621 = 1;\n    \n    int64_t x_20616;\n    int64_t y_20617;\n    \n    offset_20620 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_20606, sext_i64_i32(segred_group_sizze_20488))) {\n            x_20616 = ((__local\n                        int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606 +\n                                                      offset_20620)];\n        }\n    }\n    offset_20620 = 1;\n    while (slt32(offset_20620, wave_sizze_20608)) {\n        if (slt32(local_tid_20606 + offset_20620,\n                  sext_i64_i32(segred_group_sizze_20488)) && ((local_tid_20606 -\n                                                               squot32(local_tid_20606,\n                                                                       wave_sizze_20608) *\n                                                               wave_sizze_20608) &\n                                                              (2 *\n                                                               offset_20620 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                y_20617 = ((volatile __local\n                            int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606 +\n                                                          offset_20620)];\n            }\n            // apply reduction operation\n            ",
                   "{\n                int64_t zz_20618 = smax64(x_20616, y_20617);\n                \n                x_20616 = zz_20618;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606)] =\n                    x_20616;\n            }\n        }\n        offset_20620 *= 2;\n    }\n    while (slt32(skip_waves_20621,\n                 squot32(sext_i64_i32(segred_group_sizze_20488) +\n                         wave_sizze_20608 - 1, wave_sizze_20608))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_20620 = skip_waves_20621 * wave_sizze_20608;\n        if (slt32(local_tid_20606 + offset_20620,\n                  sext_i64_i32(segred_group_sizze_20488)) && ((local_tid_20606 -\n                                                               squot32(local_tid_20606,\n                                                                       wave_sizze_20608) *\n                                                               wave_sizze_20608) ==\n                                                              0 &&\n                                                              (squot32(local_tid_20606,\n                                                                       wave_sizze_20608) &\n                                                               (2 *\n                                                                skip_waves_20621 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                y_20617 = ((__local\n                            int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606 +\n                                                          offset_20620)];\n            }\n            // apply reduction operation\n            {\n                int64_t zz_20618 = smax64(x_20616, y_20617);\n                \n                x_20616 = zz_20618;\n            }\n            // write result of op",
                   "eration\n            {\n                ((__local\n                  int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606)] =\n                    x_20616;\n            }\n        }\n        skip_waves_20621 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_20606) == 0) {\n            x_acc_20614 = x_20616;\n        }\n    }\n    \n    int32_t old_counter_20622;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_20606 == 0) {\n            ((__global\n              int64_t *) group_res_arr_mem_20602)[sext_i32_i64(group_tid_20607) *\n                                                  segred_group_sizze_20488] =\n                x_acc_20614;\n            mem_fence_global();\n            old_counter_20622 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20600)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_20610)[0] = old_counter_20622 ==\n                segred_num_groups_20486 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_20623;\n    \n    is_last_group_20623 = ((__local bool *) sync_arr_mem_20610)[0];\n    if (is_last_group_20623) {\n        if (local_tid_20606 == 0) {\n            old_counter_20622 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_20600)[0],\n                                                      (int) (0 -\n                                                             segred_num_groups_20486));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_20624 = sdiv_up64(segred_num_groups_20486,\n                                                      segred_group_sizze_20488);\n            \n            x_20493 = 0;\n            for",
                   " (int64_t i_20625 = 0; i_20625 < read_per_thread_20624;\n                 i_20625++) {\n                int64_t group_res_id_20626 = sext_i32_i64(local_tid_20606) *\n                        read_per_thread_20624 + i_20625;\n                int64_t index_of_group_res_20627 = group_res_id_20626;\n                \n                if (slt64(group_res_id_20626, segred_num_groups_20486)) {\n                    y_20494 = ((__global\n                                int64_t *) group_res_arr_mem_20602)[index_of_group_res_20627 *\n                                                                    segred_group_sizze_20488];\n                    \n                    int64_t zz_20495;\n                    \n                    zz_20495 = smax64(x_20493, y_20494);\n                    x_20493 = zz_20495;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606)] =\n            x_20493;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_20628;\n            int32_t skip_waves_20629;\n            \n            skip_waves_20629 = 1;\n            \n            int64_t x_20616;\n            int64_t y_20617;\n            \n            offset_20628 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_20606,\n                          sext_i64_i32(segred_group_sizze_20488))) {\n                    x_20616 = ((__local\n                                int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606 +\n                                                              offset_20628)];\n                }\n            }\n            offset_20628 = 1;\n            while (slt32(offset_20628, wave_sizze_20608)) {\n                if (slt32(local_tid_20606 + offset_20628,\n                          sext_i64_i32(segred_group_sizze_20488)) &&\n                    ((local_tid_20606 - squot32(local_tid_20606,\n                                ",
                   "                wave_sizze_20608) *\n                      wave_sizze_20608) & (2 * offset_20628 - 1)) == 0) {\n                    // read array element\n                    {\n                        y_20617 = ((volatile __local\n                                    int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606 +\n                                                                  offset_20628)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zz_20618 = smax64(x_20616, y_20617);\n                        \n                        x_20616 = zz_20618;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606)] =\n                            x_20616;\n                    }\n                }\n                offset_20628 *= 2;\n            }\n            while (slt32(skip_waves_20629,\n                         squot32(sext_i64_i32(segred_group_sizze_20488) +\n                                 wave_sizze_20608 - 1, wave_sizze_20608))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_20628 = skip_waves_20629 * wave_sizze_20608;\n                if (slt32(local_tid_20606 + offset_20628,\n                          sext_i64_i32(segred_group_sizze_20488)) &&\n                    ((local_tid_20606 - squot32(local_tid_20606,\n                                                wave_sizze_20608) *\n                      wave_sizze_20608) == 0 && (squot32(local_tid_20606,\n                                                         wave_sizze_20608) &\n                                                 (2 * skip_waves_20629 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        y_20617 = ((__local\n                                    int64_t *) red_arr_mem_20612)[sext_i32_i64",
                   "(local_tid_20606 +\n                                                                  offset_20628)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zz_20618 = smax64(x_20616, y_20617);\n                        \n                        x_20616 = zz_20618;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          int64_t *) red_arr_mem_20612)[sext_i32_i64(local_tid_20606)] =\n                            x_20616;\n                    }\n                }\n                skip_waves_20629 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_20606 == 0) {\n                    ((__global int64_t *) mem_20504)[0] = x_20616;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_num_groups_20486\n    #undef segred_group_sizze_20488\n}\n__kernel void mainzisegred_small_19830(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *red_arr_mem_21258_backing_aligned_0,\n                                       int64_t n_17882, int64_t paths_17885,\n                                       int64_t steps_17886,\n                                       int64_t num_groups_19986, __global\n                                       unsigned char *mem_20423, __global\n                                       unsigned char *mem_20426,\n                                       int64_t segment_sizze_nonzzero_21251)\n{\n    #define segred_group_sizze_19985 (mainzisegred_group_sizze_19824)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_21258_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_21258_backing_aligned_0;\n    \n ",
                   "   if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_21253;\n    int32_t local_tid_21254;\n    int64_t group_sizze_21257;\n    int32_t wave_sizze_21256;\n    int32_t group_tid_21255;\n    \n    global_tid_21253 = get_global_id(0);\n    local_tid_21254 = get_local_id(0);\n    group_sizze_21257 = get_local_size(0);\n    wave_sizze_21256 = LOCKSTEP_WIDTH;\n    group_tid_21255 = get_group_id(0);\n    \n    int32_t phys_tid_19830;\n    \n    phys_tid_19830 = global_tid_21253;\n    \n    __local char *red_arr_mem_21258;\n    \n    red_arr_mem_21258 = (__local char *) red_arr_mem_21258_backing_0;\n    \n    int32_t phys_group_id_21260;\n    \n    phys_group_id_21260 = get_group_id(0);\n    for (int32_t i_21261 = 0; i_21261 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(steps_17886,\n                                          squot64(segred_group_sizze_19985,\n                                                  segment_sizze_nonzzero_21251))) -\n                   phys_group_id_21260, sext_i64_i32(num_groups_19986));\n         i_21261++) {\n        int32_t virt_group_id_21262 = phys_group_id_21260 + i_21261 *\n                sext_i64_i32(num_groups_19986);\n        int64_t gtid_19821 = squot64(sext_i32_i64(local_tid_21254),\n                                     segment_sizze_nonzzero_21251) +\n                sext_i32_i64(virt_group_id_21262) *\n                squot64(segred_group_sizze_19985, segment_sizze_nonzzero_21251);\n        int64_t gtid_19829 = srem64(sext_i32_i64(local_tid_21254), paths_17885);\n        \n        // apply map function if in bounds\n        {\n            if (slt64(0, paths_17885) && (slt64(gtid_19821, steps_17886) &&\n                                          slt64(sext_i32_i64(local_tid_21254),\n                                                paths_17885 *\n                                                squot64(segred_group_sizze_19985,\n                                                        segment_sizze_nonzzero_21251)))) {\n                float res_19994;\n           ",
                   "     float redout_20211 = 0.0F;\n                \n                for (int64_t i_20212 = 0; i_20212 < n_17882; i_20212++) {\n                    float x_19998 = ((__global float *) mem_20423)[i_20212 *\n                                                                   (steps_17886 *\n                                                                    paths_17885) +\n                                                                   gtid_19829 *\n                                                                   steps_17886 +\n                                                                   gtid_19821];\n                    float res_19997 = x_19998 + redout_20211;\n                    float redout_tmp_21263 = res_19997;\n                    \n                    redout_20211 = redout_tmp_21263;\n                }\n                res_19994 = redout_20211;\n                \n                float res_19999 = fmax32(0.0F, res_19994);\n                \n                // save map-out results\n                { }\n                // save results to be reduced\n                {\n                    ((__local\n                      float *) red_arr_mem_21258)[sext_i32_i64(local_tid_21254)] =\n                        res_19999;\n                }\n            } else {\n                ((__local\n                  float *) red_arr_mem_21258)[sext_i32_i64(local_tid_21254)] =\n                    0.0F;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64(0, paths_17885)) {\n            // perform segmented scan to imitate reduction\n            {\n                float x_19989;\n                float x_19990;\n                float x_21264;\n                float x_21265;\n                bool ltid_in_bounds_21267;\n                \n                ltid_in_bounds_21267 = slt64(sext_i32_i64(local_tid_21254),\n                                             paths_17885 *\n                                             squot64(segred_group_sizze_19985,\n                                     ",
                   "                segment_sizze_nonzzero_21251));\n                \n                int32_t skip_threads_21268;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_21267) {\n                        x_19990 = ((volatile __local\n                                    float *) red_arr_mem_21258)[sext_i32_i64(local_tid_21254)];\n                        if ((local_tid_21254 - squot32(local_tid_21254, 32) *\n                             32) == 0) {\n                            x_19989 = x_19990;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_21268 = 1;\n                    while (slt32(skip_threads_21268, 32)) {\n                        if (sle32(skip_threads_21268, local_tid_21254 -\n                                  squot32(local_tid_21254, 32) * 32) &&\n                            ltid_in_bounds_21267) {\n                            // read operands\n                            {\n                                x_19989 = ((volatile __local\n                                            float *) red_arr_mem_21258)[sext_i32_i64(local_tid_21254) -\n                                                                        sext_i32_i64(skip_threads_21268)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_21269 =\n                                     slt64(srem64(sext_i32_i64(local_tid_21254),\n                                                  paths_17885),\n                                           sext_i32_i64(local_tid_21254) -\n                                           sext_i32_i64(local_tid_21254 -\n                                           skip_threads_21268));\n                                \n                                if (inactive_21269) {\n                                    x_199",
                   "89 = x_19990;\n                                }\n                                if (!inactive_21269) {\n                                    float res_19991 = x_19989 + x_19990;\n                                    \n                                    x_19989 = res_19991;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_21256, skip_threads_21268)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_21268, local_tid_21254 -\n                                  squot32(local_tid_21254, 32) * 32) &&\n                            ltid_in_bounds_21267) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_21258)[sext_i32_i64(local_tid_21254)] =\n                                    x_19989;\n                                x_19990 = x_19989;\n                            }\n                        }\n                        if (sle32(wave_sizze_21256, skip_threads_21268)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_21268 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_21254 - squot32(local_tid_21254, 32) * 32) ==\n                        31 && ltid_in_bounds_21267) {\n                        ((volatile __local\n                          float *) red_arr_mem_21258)[sext_i32_i64(squot32(local_tid_21254,\n                                                                           32))] =\n                            x_19989;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after wh",
                   "ich offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_21270;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_21254, 32) == 0 &&\n                            ltid_in_bounds_21267) {\n                            x_21265 = ((volatile __local\n                                        float *) red_arr_mem_21258)[sext_i32_i64(local_tid_21254)];\n                            if ((local_tid_21254 - squot32(local_tid_21254,\n                                                           32) * 32) == 0) {\n                                x_21264 = x_21265;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_21270 = 1;\n                        while (slt32(skip_threads_21270, 32)) {\n                            if (sle32(skip_threads_21270, local_tid_21254 -\n                                      squot32(local_tid_21254, 32) * 32) &&\n                                (squot32(local_tid_21254, 32) == 0 &&\n                                 ltid_in_bounds_21267)) {\n                                // read operands\n                                {\n                                    x_21264 = ((volatile __local\n                                                float *) red_arr_mem_21258)[sext_i32_i64(local_tid_21254) -\n                                                                            sext_i32_i64(skip_threads_21270)];\n                                }\n                                // perform operation\n                                {\n                                    bool inactive_21271 =\n                                         slt64(srem64(sext_i32_i64(local_tid_21254 *\n                                                      32 + 32 - 1),\n                                                     ",
                   " paths_17885),\n                                               sext_i32_i64(local_tid_21254 *\n                                               32 + 32 - 1) -\n                                               sext_i32_i64((local_tid_21254 -\n                                                             skip_threads_21270) *\n                                               32 + 32 - 1));\n                                    \n                                    if (inactive_21271) {\n                                        x_21264 = x_21265;\n                                    }\n                                    if (!inactive_21271) {\n                                        float res_21266 = x_21264 + x_21265;\n                                        \n                                        x_21264 = res_21266;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_21256, skip_threads_21270)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_21270, local_tid_21254 -\n                                      squot32(local_tid_21254, 32) * 32) &&\n                                (squot32(local_tid_21254, 32) == 0 &&\n                                 ltid_in_bounds_21267)) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      float *) red_arr_mem_21258)[sext_i32_i64(local_tid_21254)] =\n                                        x_21264;\n                                    x_21265 = x_21264;\n                                }\n                            }\n                            if (sle32(wave_sizze_21256, skip_threads_21270)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_21270 *= 2;\n          ",
                   "              }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_21254, 32) == 0 ||\n                          !ltid_in_bounds_21267)) {\n                        // read operands\n                        {\n                            x_19990 = x_19989;\n                            x_19989 = ((__local\n                                        float *) red_arr_mem_21258)[sext_i32_i64(squot32(local_tid_21254,\n                                                                                         32)) -\n                                                                    1];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_21272 =\n                                 slt64(srem64(sext_i32_i64(local_tid_21254),\n                                              paths_17885),\n                                       sext_i32_i64(local_tid_21254) -\n                                       sext_i32_i64(squot32(local_tid_21254,\n                                                            32) * 32 - 1));\n                            \n                            if (inactive_21272) {\n                                x_19989 = x_19990;\n                            }\n                            if (!inactive_21272) {\n                                float res_19991 = x_19989 + x_19990;\n                                \n                                x_19989 = res_19991;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              float *) red_arr_mem_21258)[sext_i32_i64(local_tid_21254)] =\n                                x_19989;\n                        }\n                    }\n                }\n                barrier(CLK_LO",
                   "CAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_21254, 32) == 0) {\n                        ((__local\n                          float *) red_arr_mem_21258)[sext_i32_i64(local_tid_21254)] =\n                            x_19990;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_group_id_21262) *\n                      squot64(segred_group_sizze_19985,\n                              segment_sizze_nonzzero_21251) +\n                      sext_i32_i64(local_tid_21254), steps_17886) &&\n                slt64(sext_i32_i64(local_tid_21254),\n                      squot64(segred_group_sizze_19985,\n                              segment_sizze_nonzzero_21251))) {\n                ((__global\n                  float *) mem_20426)[sext_i32_i64(virt_group_id_21262) *\n                                      squot64(segred_group_sizze_19985,\n                                              segment_sizze_nonzzero_21251) +\n                                      sext_i32_i64(local_tid_21254)] = ((__local\n                                                                         float *) red_arr_mem_21258)[(sext_i32_i64(local_tid_21254) +\n                                                                                                      1) *\n                                                                                                     segment_sizze_nonzzero_21251 -\n                                                                                                     1];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_19985\n}\n__kernel void mainzisegred_small_20861(__global int *global_failure",
                   ",\n                                       __local volatile\n                                       int64_t *red_arr_mem_20869_backing_aligned_0,\n                                       int64_t res_18101,\n                                       int64_t num_groups_19520, __global\n                                       unsigned char *mem_20363,\n                                       int32_t num_subhistos_20775, __global\n                                       unsigned char *res_subhistos_mem_20776,\n                                       int64_t segment_sizze_nonzzero_20862)\n{\n    #define seghist_group_sizze_19518 (mainziseghist_group_sizze_19517)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_20869_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_20869_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_20864;\n    int32_t local_tid_20865;\n    int64_t group_sizze_20868;\n    int32_t wave_sizze_20867;\n    int32_t group_tid_20866;\n    \n    global_tid_20864 = get_global_id(0);\n    local_tid_20865 = get_local_id(0);\n    group_sizze_20868 = get_local_size(0);\n    wave_sizze_20867 = LOCKSTEP_WIDTH;\n    group_tid_20866 = get_group_id(0);\n    \n    int32_t flat_gtid_20861;\n    \n    flat_gtid_20861 = global_tid_20864;\n    \n    __local char *red_arr_mem_20869;\n    \n    red_arr_mem_20869 = (__local char *) red_arr_mem_20869_backing_0;\n    \n    int32_t phys_group_id_20871;\n    \n    phys_group_id_20871 = get_group_id(0);\n    for (int32_t i_20872 = 0; i_20872 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(res_18101,\n                                          squot64(seghist_group_sizze_19518,\n                                                  segment_sizze_nonzzero_20862))) -\n                   phys_group_id_20871, sext_i64_i32(num_groups_19520));\n         i_20872++) {\n        int32_t virt_group_id_2087",
                   "3 = phys_group_id_20871 + i_20872 *\n                sext_i64_i32(num_groups_19520);\n        int64_t bucket_id_20859 = squot64(sext_i32_i64(local_tid_20865),\n                                          segment_sizze_nonzzero_20862) +\n                sext_i32_i64(virt_group_id_20873) *\n                squot64(seghist_group_sizze_19518,\n                        segment_sizze_nonzzero_20862);\n        int64_t subhistogram_id_20860 = srem64(sext_i32_i64(local_tid_20865),\n                                               num_subhistos_20775);\n        \n        // apply map function if in bounds\n        {\n            if (slt64(0, num_subhistos_20775) && (slt64(bucket_id_20859,\n                                                        res_18101) &&\n                                                  slt64(sext_i32_i64(local_tid_20865),\n                                                        num_subhistos_20775 *\n                                                        squot64(seghist_group_sizze_19518,\n                                                                segment_sizze_nonzzero_20862)))) {\n                // save results to be reduced\n                {\n                    ((__local\n                      int64_t *) red_arr_mem_20869)[sext_i32_i64(local_tid_20865)] =\n                        ((__global\n                          int64_t *) res_subhistos_mem_20776)[subhistogram_id_20860 *\n                                                              res_18101 +\n                                                              bucket_id_20859];\n                }\n            } else {\n                ((__local\n                  int64_t *) red_arr_mem_20869)[sext_i32_i64(local_tid_20865)] =\n                    0;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64(0, num_subhistos_20775)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t x_19524;\n                int64_t x_19525;\n                int64_t x_20874;\n  ",
                   "              int64_t x_20875;\n                bool ltid_in_bounds_20877;\n                \n                ltid_in_bounds_20877 = slt64(sext_i32_i64(local_tid_20865),\n                                             num_subhistos_20775 *\n                                             squot64(seghist_group_sizze_19518,\n                                                     segment_sizze_nonzzero_20862));\n                \n                int32_t skip_threads_20878;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_20877) {\n                        x_19525 = ((volatile __local\n                                    int64_t *) red_arr_mem_20869)[sext_i32_i64(local_tid_20865)];\n                        if ((local_tid_20865 - squot32(local_tid_20865, 32) *\n                             32) == 0) {\n                            x_19524 = x_19525;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_20878 = 1;\n                    while (slt32(skip_threads_20878, 32)) {\n                        if (sle32(skip_threads_20878, local_tid_20865 -\n                                  squot32(local_tid_20865, 32) * 32) &&\n                            ltid_in_bounds_20877) {\n                            // read operands\n                            {\n                                x_19524 = ((volatile __local\n                                            int64_t *) red_arr_mem_20869)[sext_i32_i64(local_tid_20865) -\n                                                                          sext_i32_i64(skip_threads_20878)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_20879 =\n                                     slt64(srem64(sext_i32_i64(local_tid_20865),\n                                                 ",
                   " num_subhistos_20775),\n                                           sext_i32_i64(local_tid_20865) -\n                                           sext_i32_i64(local_tid_20865 -\n                                           skip_threads_20878));\n                                \n                                if (inactive_20879) {\n                                    x_19524 = x_19525;\n                                }\n                                if (!inactive_20879) {\n                                    int64_t res_19526 = smax64(x_19524,\n                                                               x_19525);\n                                    \n                                    x_19524 = res_19526;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_20867, skip_threads_20878)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_20878, local_tid_20865 -\n                                  squot32(local_tid_20865, 32) * 32) &&\n                            ltid_in_bounds_20877) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) red_arr_mem_20869)[sext_i32_i64(local_tid_20865)] =\n                                    x_19524;\n                                x_19525 = x_19524;\n                            }\n                        }\n                        if (sle32(wave_sizze_20867, skip_threads_20878)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_20878 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_20865 - squot32(local_tid_20865, 32) * 32) ==\n     ",
                   "                   31 && ltid_in_bounds_20877) {\n                        ((volatile __local\n                          int64_t *) red_arr_mem_20869)[sext_i32_i64(squot32(local_tid_20865,\n                                                                             32))] =\n                            x_19524;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_20880;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_20865, 32) == 0 &&\n                            ltid_in_bounds_20877) {\n                            x_20875 = ((volatile __local\n                                        int64_t *) red_arr_mem_20869)[sext_i32_i64(local_tid_20865)];\n                            if ((local_tid_20865 - squot32(local_tid_20865,\n                                                           32) * 32) == 0) {\n                                x_20874 = x_20875;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_20880 = 1;\n                        while (slt32(skip_threads_20880, 32)) {\n                            if (sle32(skip_threads_20880, local_tid_20865 -\n                                      squot32(local_tid_20865, 32) * 32) &&\n                                (squot32(local_tid_20865, 32) == 0 &&\n                                 ltid_in_bounds_20877)) {\n                                // read operands\n                                {\n                                    x_20874 = ((volatile __local\n                                                int64_t *) red_arr_mem_20869)[sext_i32_i64(local_tid_20865) -\n                                                 ",
                   "                             sext_i32_i64(skip_threads_20880)];\n                                }\n                                // perform operation\n                                {\n                                    bool inactive_20881 =\n                                         slt64(srem64(sext_i32_i64(local_tid_20865 *\n                                                      32 + 32 - 1),\n                                                      num_subhistos_20775),\n                                               sext_i32_i64(local_tid_20865 *\n                                               32 + 32 - 1) -\n                                               sext_i32_i64((local_tid_20865 -\n                                                             skip_threads_20880) *\n                                               32 + 32 - 1));\n                                    \n                                    if (inactive_20881) {\n                                        x_20874 = x_20875;\n                                    }\n                                    if (!inactive_20881) {\n                                        int64_t res_20876 = smax64(x_20874,\n                                                                   x_20875);\n                                        \n                                        x_20874 = res_20876;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_20867, skip_threads_20880)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_20880, local_tid_20865 -\n                                      squot32(local_tid_20865, 32) * 32) &&\n                                (squot32(local_tid_20865, 32) == 0 &&\n                                 ltid_in_bounds_20877)) {\n                                // write result\n                                {\n                       ",
                   "             ((volatile __local\n                                      int64_t *) red_arr_mem_20869)[sext_i32_i64(local_tid_20865)] =\n                                        x_20874;\n                                    x_20875 = x_20874;\n                                }\n                            }\n                            if (sle32(wave_sizze_20867, skip_threads_20880)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_20880 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_20865, 32) == 0 ||\n                          !ltid_in_bounds_20877)) {\n                        // read operands\n                        {\n                            x_19525 = x_19524;\n                            x_19524 = ((__local\n                                        int64_t *) red_arr_mem_20869)[sext_i32_i64(squot32(local_tid_20865,\n                                                                                           32)) -\n                                                                      1];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_20882 =\n                                 slt64(srem64(sext_i32_i64(local_tid_20865),\n                                              num_subhistos_20775),\n                                       sext_i32_i64(local_tid_20865) -\n                                       sext_i32_i64(squot32(local_tid_20865,\n                                                            32) * 32 - 1));\n                            \n                            if (inactive_20882) {\n                                x_19524 = x_19525;\n                            }\n                            if (!inactive_20882) {\n",
                   "                                int64_t res_19526 = smax64(x_19524, x_19525);\n                                \n                                x_19524 = res_19526;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              int64_t *) red_arr_mem_20869)[sext_i32_i64(local_tid_20865)] =\n                                x_19524;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_20865, 32) == 0) {\n                        ((__local\n                          int64_t *) red_arr_mem_20869)[sext_i32_i64(local_tid_20865)] =\n                            x_19525;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_group_id_20873) *\n                      squot64(seghist_group_sizze_19518,\n                              segment_sizze_nonzzero_20862) +\n                      sext_i32_i64(local_tid_20865), res_18101) &&\n                slt64(sext_i32_i64(local_tid_20865),\n                      squot64(seghist_group_sizze_19518,\n                              segment_sizze_nonzzero_20862))) {\n                ((__global\n                  int64_t *) mem_20363)[sext_i32_i64(virt_group_id_20873) *\n                                        squot64(seghist_group_sizze_19518,\n                                                segment_sizze_nonzzero_20862) +\n                                        sext_i32_i64(local_tid_20865)] =\n                    ((__local\n                      int64_t *) red_arr_mem_20869)[(sext_i32_i64(local_tid_20865) +\n                                                     1) *\n      ",
                   "                                              segment_sizze_nonzzero_20862 -\n                                                    1];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef seghist_group_sizze_19518\n}\n",
                   NULL};
static const char *size_names[] = {"builtin#replicate_f32.group_size_21181",
                                   "builtin#replicate_i64.group_size_20772",
                                   "main.L2_size_20838",
                                   "main.group_size_21194",
                                   "main.group_size_21231",
                                   "main.seghist_group_size_19517",
                                   "main.seghist_num_groups_19519",
                                   "main.segmap_group_size_18402",
                                   "main.segmap_group_size_18578",
                                   "main.segmap_group_size_19082",
                                   "main.segmap_group_size_19120",
                                   "main.segmap_group_size_19175",
                                   "main.segmap_group_size_19274",
                                   "main.segmap_group_size_19337",
                                   "main.segmap_group_size_19610",
                                   "main.segmap_group_size_19682",
                                   "main.segmap_group_size_19797",
                                   "main.segmap_num_groups_19177",
                                   "main.segred_group_size_18378",
                                   "main.segred_group_size_19507",
                                   "main.segred_group_size_19616",
                                   "main.segred_group_size_19824",
                                   "main.segred_group_size_19890",
                                   "main.segred_group_size_20455",
                                   "main.segred_group_size_20487",
                                   "main.segred_num_groups_18380",
                                   "main.segred_num_groups_19509",
                                   "main.segred_num_groups_19618",
                                   "main.segred_num_groups_19826",
                                   "main.segred_num_groups_19892",
                                   "main.segred_num_groups_20453",
                                   "main.segred_num_groups_20485",
                                   "main.segscan_group_size_19499",
                                   "main.segscan_group_size_19532",
                                   "main.segscan_group_size_19540",
                                   "main.segscan_group_size_19548",
                                   "main.segscan_group_size_19600",
                                   "main.segscan_num_groups_19501",
                                   "main.segscan_num_groups_19534",
                                   "main.segscan_num_groups_19542",
                                   "main.segscan_num_groups_19550",
                                   "main.segscan_num_groups_19602",
                                   "main.suff_intra_par_12",
                                   "main.suff_intra_par_3",
                                   "main.suff_outer_par_0",
                                   "main.suff_outer_par_11",
                                   "main.suff_outer_redomap_10"};
static const char *size_vars[] = {"builtinzhreplicate_f32zigroup_sizze_21181",
                                  "builtinzhreplicate_i64zigroup_sizze_20772",
                                  "mainziL2_sizze_20838",
                                  "mainzigroup_sizze_21194",
                                  "mainzigroup_sizze_21231",
                                  "mainziseghist_group_sizze_19517",
                                  "mainziseghist_num_groups_19519",
                                  "mainzisegmap_group_sizze_18402",
                                  "mainzisegmap_group_sizze_18578",
                                  "mainzisegmap_group_sizze_19082",
                                  "mainzisegmap_group_sizze_19120",
                                  "mainzisegmap_group_sizze_19175",
                                  "mainzisegmap_group_sizze_19274",
                                  "mainzisegmap_group_sizze_19337",
                                  "mainzisegmap_group_sizze_19610",
                                  "mainzisegmap_group_sizze_19682",
                                  "mainzisegmap_group_sizze_19797",
                                  "mainzisegmap_num_groups_19177",
                                  "mainzisegred_group_sizze_18378",
                                  "mainzisegred_group_sizze_19507",
                                  "mainzisegred_group_sizze_19616",
                                  "mainzisegred_group_sizze_19824",
                                  "mainzisegred_group_sizze_19890",
                                  "mainzisegred_group_sizze_20455",
                                  "mainzisegred_group_sizze_20487",
                                  "mainzisegred_num_groups_18380",
                                  "mainzisegred_num_groups_19509",
                                  "mainzisegred_num_groups_19618",
                                  "mainzisegred_num_groups_19826",
                                  "mainzisegred_num_groups_19892",
                                  "mainzisegred_num_groups_20453",
                                  "mainzisegred_num_groups_20485",
                                  "mainzisegscan_group_sizze_19499",
                                  "mainzisegscan_group_sizze_19532",
                                  "mainzisegscan_group_sizze_19540",
                                  "mainzisegscan_group_sizze_19548",
                                  "mainzisegscan_group_sizze_19600",
                                  "mainzisegscan_num_groups_19501",
                                  "mainzisegscan_num_groups_19534",
                                  "mainzisegscan_num_groups_19542",
                                  "mainzisegscan_num_groups_19550",
                                  "mainzisegscan_num_groups_19602",
                                  "mainzisuff_intra_par_12",
                                  "mainzisuff_intra_par_3",
                                  "mainzisuff_outer_par_0",
                                  "mainzisuff_outer_par_11",
                                  "mainzisuff_outer_redomap_10"};
static const char *size_classes[] = {"group_size", "group_size",
                                     "L2_for_histogram", "group_size",
                                     "group_size", "group_size", "num_groups",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "num_groups", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "num_groups", "num_groups", "num_groups",
                                     "num_groups", "num_groups", "num_groups",
                                     "num_groups", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "num_groups", "num_groups", "num_groups",
                                     "num_groups", "num_groups",
                                     "threshold (!main.suff_outer_par_11 !main.suff_outer_redomap_10)",
                                     "threshold ()", "threshold ()",
                                     "threshold (!main.suff_outer_redomap_10)",
                                     "threshold ()"};
int futhark_get_num_sizes(void)
{
    return 47;
}
const char *futhark_get_size_name(int i)
{
    return size_names[i];
}
const char *futhark_get_size_class(int i)
{
    return size_classes[i];
}
struct sizes {
    size_t builtinzhreplicate_f32zigroup_sizze_21181;
    size_t builtinzhreplicate_i64zigroup_sizze_20772;
    size_t mainziL2_sizze_20838;
    size_t mainzigroup_sizze_21194;
    size_t mainzigroup_sizze_21231;
    size_t mainziseghist_group_sizze_19517;
    size_t mainziseghist_num_groups_19519;
    size_t mainzisegmap_group_sizze_18402;
    size_t mainzisegmap_group_sizze_18578;
    size_t mainzisegmap_group_sizze_19082;
    size_t mainzisegmap_group_sizze_19120;
    size_t mainzisegmap_group_sizze_19175;
    size_t mainzisegmap_group_sizze_19274;
    size_t mainzisegmap_group_sizze_19337;
    size_t mainzisegmap_group_sizze_19610;
    size_t mainzisegmap_group_sizze_19682;
    size_t mainzisegmap_group_sizze_19797;
    size_t mainzisegmap_num_groups_19177;
    size_t mainzisegred_group_sizze_18378;
    size_t mainzisegred_group_sizze_19507;
    size_t mainzisegred_group_sizze_19616;
    size_t mainzisegred_group_sizze_19824;
    size_t mainzisegred_group_sizze_19890;
    size_t mainzisegred_group_sizze_20455;
    size_t mainzisegred_group_sizze_20487;
    size_t mainzisegred_num_groups_18380;
    size_t mainzisegred_num_groups_19509;
    size_t mainzisegred_num_groups_19618;
    size_t mainzisegred_num_groups_19826;
    size_t mainzisegred_num_groups_19892;
    size_t mainzisegred_num_groups_20453;
    size_t mainzisegred_num_groups_20485;
    size_t mainzisegscan_group_sizze_19499;
    size_t mainzisegscan_group_sizze_19532;
    size_t mainzisegscan_group_sizze_19540;
    size_t mainzisegscan_group_sizze_19548;
    size_t mainzisegscan_group_sizze_19600;
    size_t mainzisegscan_num_groups_19501;
    size_t mainzisegscan_num_groups_19534;
    size_t mainzisegscan_num_groups_19542;
    size_t mainzisegscan_num_groups_19550;
    size_t mainzisegscan_num_groups_19602;
    size_t mainzisuff_intra_par_12;
    size_t mainzisuff_intra_par_3;
    size_t mainzisuff_outer_par_0;
    size_t mainzisuff_outer_par_11;
    size_t mainzisuff_outer_redomap_10;
} ;
struct futhark_context_config {
    struct opencl_config opencl;
    size_t sizes[47];
    int num_build_opts;
    const char **build_opts;
} ;
struct futhark_context_config *futhark_context_config_new(void)
{
    struct futhark_context_config *cfg =
                                  (struct futhark_context_config *) malloc(sizeof(struct futhark_context_config));
    
    if (cfg == NULL)
        return NULL;
    cfg->num_build_opts = 0;
    cfg->build_opts = (const char **) malloc(sizeof(const char *));
    cfg->build_opts[0] = NULL;
    cfg->sizes[0] = 0;
    cfg->sizes[1] = 0;
    cfg->sizes[2] = 4194304;
    cfg->sizes[3] = 0;
    cfg->sizes[4] = 0;
    cfg->sizes[5] = 0;
    cfg->sizes[6] = 0;
    cfg->sizes[7] = 0;
    cfg->sizes[8] = 0;
    cfg->sizes[9] = 0;
    cfg->sizes[10] = 0;
    cfg->sizes[11] = 0;
    cfg->sizes[12] = 0;
    cfg->sizes[13] = 0;
    cfg->sizes[14] = 0;
    cfg->sizes[15] = 0;
    cfg->sizes[16] = 0;
    cfg->sizes[17] = 0;
    cfg->sizes[18] = 0;
    cfg->sizes[19] = 0;
    cfg->sizes[20] = 0;
    cfg->sizes[21] = 0;
    cfg->sizes[22] = 0;
    cfg->sizes[23] = 0;
    cfg->sizes[24] = 0;
    cfg->sizes[25] = 0;
    cfg->sizes[26] = 0;
    cfg->sizes[27] = 0;
    cfg->sizes[28] = 0;
    cfg->sizes[29] = 0;
    cfg->sizes[30] = 0;
    cfg->sizes[31] = 0;
    cfg->sizes[32] = 0;
    cfg->sizes[33] = 0;
    cfg->sizes[34] = 0;
    cfg->sizes[35] = 0;
    cfg->sizes[36] = 0;
    cfg->sizes[37] = 0;
    cfg->sizes[38] = 0;
    cfg->sizes[39] = 0;
    cfg->sizes[40] = 0;
    cfg->sizes[41] = 0;
    cfg->sizes[42] = 32;
    cfg->sizes[43] = 32;
    cfg->sizes[44] = 0;
    cfg->sizes[45] = 0;
    cfg->sizes[46] = 0;
    opencl_config_init(&cfg->opencl, 47, size_names, size_vars, cfg->sizes,
                       size_classes);
    return cfg;
}
void futhark_context_config_free(struct futhark_context_config *cfg)
{
    free(cfg->build_opts);
    free(cfg);
}
void futhark_context_config_add_build_option(struct futhark_context_config *cfg,
                                             const char *opt)
{
    cfg->build_opts[cfg->num_build_opts] = opt;
    cfg->num_build_opts++;
    cfg->build_opts = (const char **) realloc(cfg->build_opts,
                                              (cfg->num_build_opts + 1) *
                                              sizeof(const char *));
    cfg->build_opts[cfg->num_build_opts] = NULL;
}
void futhark_context_config_set_debugging(struct futhark_context_config *cfg,
                                          int flag)
{
    cfg->opencl.profiling = cfg->opencl.logging = cfg->opencl.debugging = flag;
}
void futhark_context_config_set_profiling(struct futhark_context_config *cfg,
                                          int flag)
{
    cfg->opencl.profiling = flag;
}
void futhark_context_config_set_logging(struct futhark_context_config *cfg,
                                        int flag)
{
    cfg->opencl.logging = flag;
}
void futhark_context_config_set_device(struct futhark_context_config *cfg, const
                                       char *s)
{
    set_preferred_device(&cfg->opencl, s);
}
void futhark_context_config_set_platform(struct futhark_context_config *cfg,
                                         const char *s)
{
    set_preferred_platform(&cfg->opencl, s);
}
void futhark_context_config_select_device_interactively(struct futhark_context_config *cfg)
{
    select_device_interactively(&cfg->opencl);
}
void futhark_context_config_list_devices(struct futhark_context_config *cfg)
{
    list_devices(&cfg->opencl);
}
void futhark_context_config_dump_program_to(struct futhark_context_config *cfg,
                                            const char *path)
{
    cfg->opencl.dump_program_to = path;
}
void futhark_context_config_load_program_from(struct futhark_context_config *cfg,
                                              const char *path)
{
    cfg->opencl.load_program_from = path;
}
void futhark_context_config_dump_binary_to(struct futhark_context_config *cfg,
                                           const char *path)
{
    cfg->opencl.dump_binary_to = path;
}
void futhark_context_config_load_binary_from(struct futhark_context_config *cfg,
                                             const char *path)
{
    cfg->opencl.load_binary_from = path;
}
void futhark_context_config_set_default_group_size(struct futhark_context_config *cfg,
                                                   int size)
{
    cfg->opencl.default_group_size = size;
    cfg->opencl.default_group_size_changed = 1;
}
void futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg,
                                                   int num)
{
    cfg->opencl.default_num_groups = num;
}
void futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg,
                                                  int size)
{
    cfg->opencl.default_tile_size = size;
    cfg->opencl.default_tile_size_changed = 1;
}
void futhark_context_config_set_default_threshold(struct futhark_context_config *cfg,
                                                  int size)
{
    cfg->opencl.default_threshold = size;
}
int futhark_context_config_set_size(struct futhark_context_config *cfg, const
                                    char *size_name, size_t size_value)
{
    for (int i = 0; i < 47; i++) {
        if (strcmp(size_name, size_names[i]) == 0) {
            cfg->sizes[i] = size_value;
            return 0;
        }
    }
    if (strcmp(size_name, "default_group_size") == 0) {
        cfg->opencl.default_group_size = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_num_groups") == 0) {
        cfg->opencl.default_num_groups = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_threshold") == 0) {
        cfg->opencl.default_threshold = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_tile_size") == 0) {
        cfg->opencl.default_tile_size = size_value;
        return 0;
    }
    return 1;
}
struct futhark_context {
    int detail_memory;
    int debugging;
    int profiling;
    int profiling_paused;
    int logging;
    lock_t lock;
    char *error;
    int64_t peak_mem_usage_device;
    int64_t cur_mem_usage_device;
    int64_t peak_mem_usage_default;
    int64_t cur_mem_usage_default;
    struct {
        int dummy;
    } constants;
    struct memblock_device mainzicounter_mem_20533;
    struct memblock_device mainzicounter_mem_20563;
    struct memblock_device mainzicounter_mem_20600;
    struct memblock_device mainzicounter_mem_20735;
    struct memblock_device mainzihist_locks_mem_20846;
    struct memblock_device mainzicounter_mem_20890;
    struct memblock_device mainzicounter_mem_21196;
    struct memblock_device mainzicounter_mem_21280;
    struct memblock_device mainzicounter_mem_21320;
    int total_runs;
    long total_runtime;
    cl_kernel builtinzhreplicate_f32zireplicate_21178;
    cl_kernel builtinzhreplicate_i64zireplicate_20769;
    cl_kernel gpu_map_transpose_f32;
    cl_kernel gpu_map_transpose_f32_low_height;
    cl_kernel gpu_map_transpose_f32_low_width;
    cl_kernel gpu_map_transpose_f32_small;
    cl_kernel mainzicopy_21191;
    cl_kernel mainzicopy_21228;
    cl_kernel mainziscan_stage1_19505;
    cl_kernel mainziscan_stage1_19538;
    cl_kernel mainziscan_stage1_19546;
    cl_kernel mainziscan_stage1_19554;
    cl_kernel mainziscan_stage1_19606;
    cl_kernel mainziscan_stage2_19505;
    cl_kernel mainziscan_stage2_19538;
    cl_kernel mainziscan_stage2_19546;
    cl_kernel mainziscan_stage2_19554;
    cl_kernel mainziscan_stage2_19606;
    cl_kernel mainziscan_stage3_19505;
    cl_kernel mainziscan_stage3_19538;
    cl_kernel mainziscan_stage3_19546;
    cl_kernel mainziscan_stage3_19554;
    cl_kernel mainziscan_stage3_19606;
    cl_kernel mainziseghist_global_19523;
    cl_kernel mainziseghist_local_19523;
    cl_kernel mainzisegmap_18400;
    cl_kernel mainzisegmap_18576;
    cl_kernel mainzisegmap_19078;
    cl_kernel mainzisegmap_19116;
    cl_kernel mainzisegmap_19173;
    cl_kernel mainzisegmap_19271;
    cl_kernel mainzisegmap_19335;
    cl_kernel mainzisegmap_19608;
    cl_kernel mainzisegmap_19680;
    cl_kernel mainzisegmap_19795;
    cl_kernel mainzisegmap_intragroup_18817;
    cl_kernel mainzisegmap_intragroup_19678;
    cl_kernel mainzisegred_large_19830;
    cl_kernel mainzisegred_large_20861;
    cl_kernel mainzisegred_nonseg_18386;
    cl_kernel mainzisegred_nonseg_19515;
    cl_kernel mainzisegred_nonseg_19625;
    cl_kernel mainzisegred_nonseg_19898;
    cl_kernel mainzisegred_nonseg_20460;
    cl_kernel mainzisegred_nonseg_20492;
    cl_kernel mainzisegred_small_19830;
    cl_kernel mainzisegred_small_20861;
    int64_t copy_dev_to_dev_total_runtime;
    int copy_dev_to_dev_runs;
    int64_t copy_dev_to_host_total_runtime;
    int copy_dev_to_host_runs;
    int64_t copy_host_to_dev_total_runtime;
    int copy_host_to_dev_runs;
    int64_t copy_scalar_to_dev_total_runtime;
    int copy_scalar_to_dev_runs;
    int64_t copy_scalar_from_dev_total_runtime;
    int copy_scalar_from_dev_runs;
    int64_t builtinzhreplicate_f32zireplicate_21178_total_runtime;
    int builtinzhreplicate_f32zireplicate_21178_runs;
    int64_t builtinzhreplicate_i64zireplicate_20769_total_runtime;
    int builtinzhreplicate_i64zireplicate_20769_runs;
    int64_t gpu_map_transpose_f32_total_runtime;
    int gpu_map_transpose_f32_runs;
    int64_t gpu_map_transpose_f32_low_height_total_runtime;
    int gpu_map_transpose_f32_low_height_runs;
    int64_t gpu_map_transpose_f32_low_width_total_runtime;
    int gpu_map_transpose_f32_low_width_runs;
    int64_t gpu_map_transpose_f32_small_total_runtime;
    int gpu_map_transpose_f32_small_runs;
    int64_t mainzicopy_21191_total_runtime;
    int mainzicopy_21191_runs;
    int64_t mainzicopy_21228_total_runtime;
    int mainzicopy_21228_runs;
    int64_t mainziscan_stage1_19505_total_runtime;
    int mainziscan_stage1_19505_runs;
    int64_t mainziscan_stage1_19538_total_runtime;
    int mainziscan_stage1_19538_runs;
    int64_t mainziscan_stage1_19546_total_runtime;
    int mainziscan_stage1_19546_runs;
    int64_t mainziscan_stage1_19554_total_runtime;
    int mainziscan_stage1_19554_runs;
    int64_t mainziscan_stage1_19606_total_runtime;
    int mainziscan_stage1_19606_runs;
    int64_t mainziscan_stage2_19505_total_runtime;
    int mainziscan_stage2_19505_runs;
    int64_t mainziscan_stage2_19538_total_runtime;
    int mainziscan_stage2_19538_runs;
    int64_t mainziscan_stage2_19546_total_runtime;
    int mainziscan_stage2_19546_runs;
    int64_t mainziscan_stage2_19554_total_runtime;
    int mainziscan_stage2_19554_runs;
    int64_t mainziscan_stage2_19606_total_runtime;
    int mainziscan_stage2_19606_runs;
    int64_t mainziscan_stage3_19505_total_runtime;
    int mainziscan_stage3_19505_runs;
    int64_t mainziscan_stage3_19538_total_runtime;
    int mainziscan_stage3_19538_runs;
    int64_t mainziscan_stage3_19546_total_runtime;
    int mainziscan_stage3_19546_runs;
    int64_t mainziscan_stage3_19554_total_runtime;
    int mainziscan_stage3_19554_runs;
    int64_t mainziscan_stage3_19606_total_runtime;
    int mainziscan_stage3_19606_runs;
    int64_t mainziseghist_global_19523_total_runtime;
    int mainziseghist_global_19523_runs;
    int64_t mainziseghist_local_19523_total_runtime;
    int mainziseghist_local_19523_runs;
    int64_t mainzisegmap_18400_total_runtime;
    int mainzisegmap_18400_runs;
    int64_t mainzisegmap_18576_total_runtime;
    int mainzisegmap_18576_runs;
    int64_t mainzisegmap_19078_total_runtime;
    int mainzisegmap_19078_runs;
    int64_t mainzisegmap_19116_total_runtime;
    int mainzisegmap_19116_runs;
    int64_t mainzisegmap_19173_total_runtime;
    int mainzisegmap_19173_runs;
    int64_t mainzisegmap_19271_total_runtime;
    int mainzisegmap_19271_runs;
    int64_t mainzisegmap_19335_total_runtime;
    int mainzisegmap_19335_runs;
    int64_t mainzisegmap_19608_total_runtime;
    int mainzisegmap_19608_runs;
    int64_t mainzisegmap_19680_total_runtime;
    int mainzisegmap_19680_runs;
    int64_t mainzisegmap_19795_total_runtime;
    int mainzisegmap_19795_runs;
    int64_t mainzisegmap_intragroup_18817_total_runtime;
    int mainzisegmap_intragroup_18817_runs;
    int64_t mainzisegmap_intragroup_19678_total_runtime;
    int mainzisegmap_intragroup_19678_runs;
    int64_t mainzisegred_large_19830_total_runtime;
    int mainzisegred_large_19830_runs;
    int64_t mainzisegred_large_20861_total_runtime;
    int mainzisegred_large_20861_runs;
    int64_t mainzisegred_nonseg_18386_total_runtime;
    int mainzisegred_nonseg_18386_runs;
    int64_t mainzisegred_nonseg_19515_total_runtime;
    int mainzisegred_nonseg_19515_runs;
    int64_t mainzisegred_nonseg_19625_total_runtime;
    int mainzisegred_nonseg_19625_runs;
    int64_t mainzisegred_nonseg_19898_total_runtime;
    int mainzisegred_nonseg_19898_runs;
    int64_t mainzisegred_nonseg_20460_total_runtime;
    int mainzisegred_nonseg_20460_runs;
    int64_t mainzisegred_nonseg_20492_total_runtime;
    int mainzisegred_nonseg_20492_runs;
    int64_t mainzisegred_small_19830_total_runtime;
    int mainzisegred_small_19830_runs;
    int64_t mainzisegred_small_20861_total_runtime;
    int mainzisegred_small_20861_runs;
    cl_mem global_failure;
    cl_mem global_failure_args;
    struct opencl_context opencl;
    struct sizes sizes;
    cl_int failure_is_an_option;
} ;
void post_opencl_setup(struct opencl_context *ctx,
                       struct opencl_device_option *option)
{
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name,
                                            "NVIDIA CUDA") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_GPU) == CL_DEVICE_TYPE_GPU) {
        ctx->lockstep_width = 32;
    }
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name,
                                            "AMD Accelerated Parallel Processing") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->lockstep_width = 32;
    }
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->lockstep_width = 1;
    }
    if ((ctx->cfg.default_num_groups == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_GPU) == CL_DEVICE_TYPE_GPU) {
        size_t MAX_COMPUTE_UNITS_val = 0;
        
        clGetDeviceInfo(ctx->device, CL_DEVICE_MAX_COMPUTE_UNITS,
                        sizeof(MAX_COMPUTE_UNITS_val), &MAX_COMPUTE_UNITS_val,
                        NULL);
        ctx->cfg.default_num_groups = 4 * MAX_COMPUTE_UNITS_val;
    }
    if ((ctx->cfg.default_group_size == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_GPU) == CL_DEVICE_TYPE_GPU) {
        ctx->cfg.default_group_size = 256;
    }
    if ((ctx->cfg.default_tile_size == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->cfg.default_tile_size = 32;
    }
    if ((ctx->cfg.default_threshold == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->cfg.default_threshold = 32768;
    }
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_CPU) ==
        CL_DEVICE_TYPE_CPU) {
        ctx->lockstep_width = 1;
    }
    if ((ctx->cfg.default_num_groups == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_CPU) == CL_DEVICE_TYPE_CPU) {
        size_t MAX_COMPUTE_UNITS_val = 0;
        
        clGetDeviceInfo(ctx->device, CL_DEVICE_MAX_COMPUTE_UNITS,
                        sizeof(MAX_COMPUTE_UNITS_val), &MAX_COMPUTE_UNITS_val,
                        NULL);
        ctx->cfg.default_num_groups = MAX_COMPUTE_UNITS_val;
    }
    if ((ctx->cfg.default_group_size == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_CPU) == CL_DEVICE_TYPE_CPU) {
        ctx->cfg.default_group_size = 32;
    }
    if ((ctx->cfg.default_tile_size == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_CPU) ==
        CL_DEVICE_TYPE_CPU) {
        ctx->cfg.default_tile_size = 4;
    }
    if ((ctx->cfg.default_threshold == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_CPU) ==
        CL_DEVICE_TYPE_CPU) {
        size_t MAX_COMPUTE_UNITS_val = 0;
        
        clGetDeviceInfo(ctx->device, CL_DEVICE_MAX_COMPUTE_UNITS,
                        sizeof(MAX_COMPUTE_UNITS_val), &MAX_COMPUTE_UNITS_val,
                        NULL);
        ctx->cfg.default_threshold = MAX_COMPUTE_UNITS_val;
    }
}
static void init_context_early(struct futhark_context_config *cfg,
                               struct futhark_context *ctx)
{
    ctx->opencl.cfg = cfg->opencl;
    ctx->detail_memory = cfg->opencl.debugging;
    ctx->debugging = cfg->opencl.debugging;
    ctx->profiling = cfg->opencl.profiling;
    ctx->profiling_paused = 0;
    ctx->logging = cfg->opencl.logging;
    ctx->error = NULL;
    ctx->opencl.profiling_records_capacity = 200;
    ctx->opencl.profiling_records_used = 0;
    ctx->opencl.profiling_records =
        malloc(ctx->opencl.profiling_records_capacity *
        sizeof(struct profiling_record));
    create_lock(&ctx->lock);
    ctx->failure_is_an_option = 0;
    ctx->peak_mem_usage_device = 0;
    ctx->cur_mem_usage_device = 0;
    ctx->peak_mem_usage_default = 0;
    ctx->cur_mem_usage_default = 0;
    ctx->total_runs = 0;
    ctx->total_runtime = 0;
    ctx->copy_dev_to_dev_total_runtime = 0;
    ctx->copy_dev_to_dev_runs = 0;
    ctx->copy_dev_to_host_total_runtime = 0;
    ctx->copy_dev_to_host_runs = 0;
    ctx->copy_host_to_dev_total_runtime = 0;
    ctx->copy_host_to_dev_runs = 0;
    ctx->copy_scalar_to_dev_total_runtime = 0;
    ctx->copy_scalar_to_dev_runs = 0;
    ctx->copy_scalar_from_dev_total_runtime = 0;
    ctx->copy_scalar_from_dev_runs = 0;
    ctx->builtinzhreplicate_f32zireplicate_21178_total_runtime = 0;
    ctx->builtinzhreplicate_f32zireplicate_21178_runs = 0;
    ctx->builtinzhreplicate_i64zireplicate_20769_total_runtime = 0;
    ctx->builtinzhreplicate_i64zireplicate_20769_runs = 0;
    ctx->gpu_map_transpose_f32_total_runtime = 0;
    ctx->gpu_map_transpose_f32_runs = 0;
    ctx->gpu_map_transpose_f32_low_height_total_runtime = 0;
    ctx->gpu_map_transpose_f32_low_height_runs = 0;
    ctx->gpu_map_transpose_f32_low_width_total_runtime = 0;
    ctx->gpu_map_transpose_f32_low_width_runs = 0;
    ctx->gpu_map_transpose_f32_small_total_runtime = 0;
    ctx->gpu_map_transpose_f32_small_runs = 0;
    ctx->mainzicopy_21191_total_runtime = 0;
    ctx->mainzicopy_21191_runs = 0;
    ctx->mainzicopy_21228_total_runtime = 0;
    ctx->mainzicopy_21228_runs = 0;
    ctx->mainziscan_stage1_19505_total_runtime = 0;
    ctx->mainziscan_stage1_19505_runs = 0;
    ctx->mainziscan_stage1_19538_total_runtime = 0;
    ctx->mainziscan_stage1_19538_runs = 0;
    ctx->mainziscan_stage1_19546_total_runtime = 0;
    ctx->mainziscan_stage1_19546_runs = 0;
    ctx->mainziscan_stage1_19554_total_runtime = 0;
    ctx->mainziscan_stage1_19554_runs = 0;
    ctx->mainziscan_stage1_19606_total_runtime = 0;
    ctx->mainziscan_stage1_19606_runs = 0;
    ctx->mainziscan_stage2_19505_total_runtime = 0;
    ctx->mainziscan_stage2_19505_runs = 0;
    ctx->mainziscan_stage2_19538_total_runtime = 0;
    ctx->mainziscan_stage2_19538_runs = 0;
    ctx->mainziscan_stage2_19546_total_runtime = 0;
    ctx->mainziscan_stage2_19546_runs = 0;
    ctx->mainziscan_stage2_19554_total_runtime = 0;
    ctx->mainziscan_stage2_19554_runs = 0;
    ctx->mainziscan_stage2_19606_total_runtime = 0;
    ctx->mainziscan_stage2_19606_runs = 0;
    ctx->mainziscan_stage3_19505_total_runtime = 0;
    ctx->mainziscan_stage3_19505_runs = 0;
    ctx->mainziscan_stage3_19538_total_runtime = 0;
    ctx->mainziscan_stage3_19538_runs = 0;
    ctx->mainziscan_stage3_19546_total_runtime = 0;
    ctx->mainziscan_stage3_19546_runs = 0;
    ctx->mainziscan_stage3_19554_total_runtime = 0;
    ctx->mainziscan_stage3_19554_runs = 0;
    ctx->mainziscan_stage3_19606_total_runtime = 0;
    ctx->mainziscan_stage3_19606_runs = 0;
    ctx->mainziseghist_global_19523_total_runtime = 0;
    ctx->mainziseghist_global_19523_runs = 0;
    ctx->mainziseghist_local_19523_total_runtime = 0;
    ctx->mainziseghist_local_19523_runs = 0;
    ctx->mainzisegmap_18400_total_runtime = 0;
    ctx->mainzisegmap_18400_runs = 0;
    ctx->mainzisegmap_18576_total_runtime = 0;
    ctx->mainzisegmap_18576_runs = 0;
    ctx->mainzisegmap_19078_total_runtime = 0;
    ctx->mainzisegmap_19078_runs = 0;
    ctx->mainzisegmap_19116_total_runtime = 0;
    ctx->mainzisegmap_19116_runs = 0;
    ctx->mainzisegmap_19173_total_runtime = 0;
    ctx->mainzisegmap_19173_runs = 0;
    ctx->mainzisegmap_19271_total_runtime = 0;
    ctx->mainzisegmap_19271_runs = 0;
    ctx->mainzisegmap_19335_total_runtime = 0;
    ctx->mainzisegmap_19335_runs = 0;
    ctx->mainzisegmap_19608_total_runtime = 0;
    ctx->mainzisegmap_19608_runs = 0;
    ctx->mainzisegmap_19680_total_runtime = 0;
    ctx->mainzisegmap_19680_runs = 0;
    ctx->mainzisegmap_19795_total_runtime = 0;
    ctx->mainzisegmap_19795_runs = 0;
    ctx->mainzisegmap_intragroup_18817_total_runtime = 0;
    ctx->mainzisegmap_intragroup_18817_runs = 0;
    ctx->mainzisegmap_intragroup_19678_total_runtime = 0;
    ctx->mainzisegmap_intragroup_19678_runs = 0;
    ctx->mainzisegred_large_19830_total_runtime = 0;
    ctx->mainzisegred_large_19830_runs = 0;
    ctx->mainzisegred_large_20861_total_runtime = 0;
    ctx->mainzisegred_large_20861_runs = 0;
    ctx->mainzisegred_nonseg_18386_total_runtime = 0;
    ctx->mainzisegred_nonseg_18386_runs = 0;
    ctx->mainzisegred_nonseg_19515_total_runtime = 0;
    ctx->mainzisegred_nonseg_19515_runs = 0;
    ctx->mainzisegred_nonseg_19625_total_runtime = 0;
    ctx->mainzisegred_nonseg_19625_runs = 0;
    ctx->mainzisegred_nonseg_19898_total_runtime = 0;
    ctx->mainzisegred_nonseg_19898_runs = 0;
    ctx->mainzisegred_nonseg_20460_total_runtime = 0;
    ctx->mainzisegred_nonseg_20460_runs = 0;
    ctx->mainzisegred_nonseg_20492_total_runtime = 0;
    ctx->mainzisegred_nonseg_20492_runs = 0;
    ctx->mainzisegred_small_19830_total_runtime = 0;
    ctx->mainzisegred_small_19830_runs = 0;
    ctx->mainzisegred_small_20861_total_runtime = 0;
    ctx->mainzisegred_small_20861_runs = 0;
}
static int init_context_late(struct futhark_context_config *cfg,
                             struct futhark_context *ctx, cl_program prog)
{
    cl_int error;
    cl_int no_error = -1;
    
    ctx->global_failure = clCreateBuffer(ctx->opencl.ctx, CL_MEM_READ_WRITE |
                                         CL_MEM_COPY_HOST_PTR, sizeof(cl_int),
                                         &no_error, &error);
    OPENCL_SUCCEED_OR_RETURN(error);
    // The +1 is to avoid zero-byte allocations.
    ctx->global_failure_args = clCreateBuffer(ctx->opencl.ctx,
                                              CL_MEM_READ_WRITE,
                                              sizeof(int64_t) * (3 + 1), NULL,
                                              &error);
    OPENCL_SUCCEED_OR_RETURN(error);
    {
        ctx->builtinzhreplicate_f32zireplicate_21178 = clCreateKernel(prog,
                                                                      "builtinzhreplicate_f32zireplicate_21178",
                                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "builtin#replicate_f32.replicate_21178");
    }
    {
        ctx->builtinzhreplicate_i64zireplicate_20769 = clCreateKernel(prog,
                                                                      "builtinzhreplicate_i64zireplicate_20769",
                                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "builtin#replicate_i64.replicate_20769");
    }
    {
        ctx->gpu_map_transpose_f32 = clCreateKernel(prog,
                                                    "gpu_map_transpose_f32",
                                                    &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "gpu_map_transpose_f32");
    }
    {
        ctx->gpu_map_transpose_f32_low_height = clCreateKernel(prog,
                                                               "gpu_map_transpose_f32_low_height",
                                                               &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_f32_low_height");
    }
    {
        ctx->gpu_map_transpose_f32_low_width = clCreateKernel(prog,
                                                              "gpu_map_transpose_f32_low_width",
                                                              &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_f32_low_width");
    }
    {
        ctx->gpu_map_transpose_f32_small = clCreateKernel(prog,
                                                          "gpu_map_transpose_f32_small",
                                                          &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_f32_small");
    }
    {
        ctx->mainzicopy_21191 = clCreateKernel(prog, "mainzicopy_21191",
                                               &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.copy_21191");
    }
    {
        ctx->mainzicopy_21228 = clCreateKernel(prog, "mainzicopy_21228",
                                               &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.copy_21228");
    }
    {
        ctx->mainziscan_stage1_19505 = clCreateKernel(prog,
                                                      "mainziscan_stage1_19505",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_19505, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_19505");
    }
    {
        ctx->mainziscan_stage1_19538 = clCreateKernel(prog,
                                                      "mainziscan_stage1_19538",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_19538, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_19538");
    }
    {
        ctx->mainziscan_stage1_19546 = clCreateKernel(prog,
                                                      "mainziscan_stage1_19546",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_19546, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_19546");
    }
    {
        ctx->mainziscan_stage1_19554 = clCreateKernel(prog,
                                                      "mainziscan_stage1_19554",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_19554, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_19554, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_19554");
    }
    {
        ctx->mainziscan_stage1_19606 = clCreateKernel(prog,
                                                      "mainziscan_stage1_19606",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_19606, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_19606");
    }
    {
        ctx->mainziscan_stage2_19505 = clCreateKernel(prog,
                                                      "mainziscan_stage2_19505",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_19505, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_19505");
    }
    {
        ctx->mainziscan_stage2_19538 = clCreateKernel(prog,
                                                      "mainziscan_stage2_19538",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_19538, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_19538");
    }
    {
        ctx->mainziscan_stage2_19546 = clCreateKernel(prog,
                                                      "mainziscan_stage2_19546",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_19546, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_19546");
    }
    {
        ctx->mainziscan_stage2_19554 = clCreateKernel(prog,
                                                      "mainziscan_stage2_19554",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_19554, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_19554");
    }
    {
        ctx->mainziscan_stage2_19606 = clCreateKernel(prog,
                                                      "mainziscan_stage2_19606",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_19606, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_19606");
    }
    {
        ctx->mainziscan_stage3_19505 = clCreateKernel(prog,
                                                      "mainziscan_stage3_19505",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_19505, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_19505");
    }
    {
        ctx->mainziscan_stage3_19538 = clCreateKernel(prog,
                                                      "mainziscan_stage3_19538",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_19538, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_19538");
    }
    {
        ctx->mainziscan_stage3_19546 = clCreateKernel(prog,
                                                      "mainziscan_stage3_19546",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_19546, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_19546");
    }
    {
        ctx->mainziscan_stage3_19554 = clCreateKernel(prog,
                                                      "mainziscan_stage3_19554",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_19554, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_19554");
    }
    {
        ctx->mainziscan_stage3_19606 = clCreateKernel(prog,
                                                      "mainziscan_stage3_19606",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_19606, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_19606");
    }
    {
        ctx->mainziseghist_global_19523 = clCreateKernel(prog,
                                                         "mainziseghist_global_19523",
                                                         &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziseghist_global_19523, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "main.seghist_global_19523");
    }
    {
        ctx->mainziseghist_local_19523 = clCreateKernel(prog,
                                                        "mainziseghist_local_19523",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziseghist_local_19523, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.seghist_local_19523");
    }
    {
        ctx->mainzisegmap_18400 = clCreateKernel(prog, "mainzisegmap_18400",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_18400, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_18400, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_18400");
    }
    {
        ctx->mainzisegmap_18576 = clCreateKernel(prog, "mainzisegmap_18576",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_18576, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_18576, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_18576");
    }
    {
        ctx->mainzisegmap_19078 = clCreateKernel(prog, "mainzisegmap_19078",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_19078, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_19078");
    }
    {
        ctx->mainzisegmap_19116 = clCreateKernel(prog, "mainzisegmap_19116",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_19116, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_19116");
    }
    {
        ctx->mainzisegmap_19173 = clCreateKernel(prog, "mainzisegmap_19173",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_19173, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_19173, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_19173");
    }
    {
        ctx->mainzisegmap_19271 = clCreateKernel(prog, "mainzisegmap_19271",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_19271, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_19271");
    }
    {
        ctx->mainzisegmap_19335 = clCreateKernel(prog, "mainzisegmap_19335",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_19335, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_19335");
    }
    {
        ctx->mainzisegmap_19608 = clCreateKernel(prog, "mainzisegmap_19608",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_19608, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_19608");
    }
    {
        ctx->mainzisegmap_19680 = clCreateKernel(prog, "mainzisegmap_19680",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_19680, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_19680");
    }
    {
        ctx->mainzisegmap_19795 = clCreateKernel(prog, "mainzisegmap_19795",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_19795, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_19795");
    }
    {
        ctx->mainzisegmap_intragroup_18817 = clCreateKernel(prog,
                                                            "mainzisegmap_intragroup_18817",
                                                            &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                            0, sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                            2, sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "main.segmap_intragroup_18817");
    }
    {
        ctx->mainzisegmap_intragroup_19678 = clCreateKernel(prog,
                                                            "mainzisegmap_intragroup_19678",
                                                            &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                            0, sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "main.segmap_intragroup_19678");
    }
    {
        ctx->mainzisegred_large_19830 = clCreateKernel(prog,
                                                       "mainzisegred_large_19830",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_large_19830, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_large_19830");
    }
    {
        ctx->mainzisegred_large_20861 = clCreateKernel(prog,
                                                       "mainzisegred_large_20861",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_large_20861, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_large_20861");
    }
    {
        ctx->mainzisegred_nonseg_18386 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_18386",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_18386");
    }
    {
        ctx->mainzisegred_nonseg_19515 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_19515",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_19515, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_19515");
    }
    {
        ctx->mainzisegred_nonseg_19625 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_19625",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_19625, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_19625");
    }
    {
        ctx->mainzisegred_nonseg_19898 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_19898",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_19898, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_19898");
    }
    {
        ctx->mainzisegred_nonseg_20460 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_20460",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_20460, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_20460");
    }
    {
        ctx->mainzisegred_nonseg_20492 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_20492",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_20492, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_20492");
    }
    {
        ctx->mainzisegred_small_19830 = clCreateKernel(prog,
                                                       "mainzisegred_small_19830",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_small_19830, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_small_19830");
    }
    {
        ctx->mainzisegred_small_20861 = clCreateKernel(prog,
                                                       "mainzisegred_small_20861",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_small_20861, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_small_20861");
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_20533.references = NULL;
        ctx->mainzicounter_mem_20533.size = 0;
        ctx->mainzicounter_mem_20533.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_20533.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_21384,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_20563.references = NULL;
        ctx->mainzicounter_mem_20563.size = 0;
        ctx->mainzicounter_mem_20563.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_20563.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_21391,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_20600.references = NULL;
        ctx->mainzicounter_mem_20600.size = 0;
        ctx->mainzicounter_mem_20600.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_20600.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_21403,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_20735.references = NULL;
        ctx->mainzicounter_mem_20735.size = 0;
        ctx->mainzicounter_mem_20735.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_20735.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_21460,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzihist_locks_mem_20846.references = NULL;
        ctx->mainzihist_locks_mem_20846.size = 0;
        ctx->mainzihist_locks_mem_20846.mem = clCreateBuffer(ctx->opencl.ctx,
                                                             CL_MEM_READ_WRITE,
                                                             (100151 >
                                                              0 ? 100151 : 1) *
                                                             sizeof(int32_t),
                                                             NULL, &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (100151 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzihist_locks_mem_20846.mem,
                                                          CL_TRUE, 0, 100151 *
                                                          sizeof(int32_t),
                                                          mainzihist_locks_mem_realtype_21472,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_20890.references = NULL;
        ctx->mainzicounter_mem_20890.size = 0;
        ctx->mainzicounter_mem_20890.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10240 >
                                                           0 ? 10240 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10240 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_20890.mem,
                                                          CL_TRUE, 0, 10240 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_21483,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_21196.references = NULL;
        ctx->mainzicounter_mem_21196.size = 0;
        ctx->mainzicounter_mem_21196.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_21196.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_21560,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_21280.references = NULL;
        ctx->mainzicounter_mem_21280.size = 0;
        ctx->mainzicounter_mem_21280.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10240 >
                                                           0 ? 10240 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10240 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_21280.mem,
                                                          CL_TRUE, 0, 10240 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_21587,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_21320.references = NULL;
        ctx->mainzicounter_mem_21320.size = 0;
        ctx->mainzicounter_mem_21320.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_21320.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_21598,
                                                          0, NULL, NULL));
    }
    ctx->sizes.builtinzhreplicate_f32zigroup_sizze_21181 = cfg->sizes[0];
    ctx->sizes.builtinzhreplicate_i64zigroup_sizze_20772 = cfg->sizes[1];
    ctx->sizes.mainziL2_sizze_20838 = cfg->sizes[2];
    ctx->sizes.mainzigroup_sizze_21194 = cfg->sizes[3];
    ctx->sizes.mainzigroup_sizze_21231 = cfg->sizes[4];
    ctx->sizes.mainziseghist_group_sizze_19517 = cfg->sizes[5];
    ctx->sizes.mainziseghist_num_groups_19519 = cfg->sizes[6];
    ctx->sizes.mainzisegmap_group_sizze_18402 = cfg->sizes[7];
    ctx->sizes.mainzisegmap_group_sizze_18578 = cfg->sizes[8];
    ctx->sizes.mainzisegmap_group_sizze_19082 = cfg->sizes[9];
    ctx->sizes.mainzisegmap_group_sizze_19120 = cfg->sizes[10];
    ctx->sizes.mainzisegmap_group_sizze_19175 = cfg->sizes[11];
    ctx->sizes.mainzisegmap_group_sizze_19274 = cfg->sizes[12];
    ctx->sizes.mainzisegmap_group_sizze_19337 = cfg->sizes[13];
    ctx->sizes.mainzisegmap_group_sizze_19610 = cfg->sizes[14];
    ctx->sizes.mainzisegmap_group_sizze_19682 = cfg->sizes[15];
    ctx->sizes.mainzisegmap_group_sizze_19797 = cfg->sizes[16];
    ctx->sizes.mainzisegmap_num_groups_19177 = cfg->sizes[17];
    ctx->sizes.mainzisegred_group_sizze_18378 = cfg->sizes[18];
    ctx->sizes.mainzisegred_group_sizze_19507 = cfg->sizes[19];
    ctx->sizes.mainzisegred_group_sizze_19616 = cfg->sizes[20];
    ctx->sizes.mainzisegred_group_sizze_19824 = cfg->sizes[21];
    ctx->sizes.mainzisegred_group_sizze_19890 = cfg->sizes[22];
    ctx->sizes.mainzisegred_group_sizze_20455 = cfg->sizes[23];
    ctx->sizes.mainzisegred_group_sizze_20487 = cfg->sizes[24];
    ctx->sizes.mainzisegred_num_groups_18380 = cfg->sizes[25];
    ctx->sizes.mainzisegred_num_groups_19509 = cfg->sizes[26];
    ctx->sizes.mainzisegred_num_groups_19618 = cfg->sizes[27];
    ctx->sizes.mainzisegred_num_groups_19826 = cfg->sizes[28];
    ctx->sizes.mainzisegred_num_groups_19892 = cfg->sizes[29];
    ctx->sizes.mainzisegred_num_groups_20453 = cfg->sizes[30];
    ctx->sizes.mainzisegred_num_groups_20485 = cfg->sizes[31];
    ctx->sizes.mainzisegscan_group_sizze_19499 = cfg->sizes[32];
    ctx->sizes.mainzisegscan_group_sizze_19532 = cfg->sizes[33];
    ctx->sizes.mainzisegscan_group_sizze_19540 = cfg->sizes[34];
    ctx->sizes.mainzisegscan_group_sizze_19548 = cfg->sizes[35];
    ctx->sizes.mainzisegscan_group_sizze_19600 = cfg->sizes[36];
    ctx->sizes.mainzisegscan_num_groups_19501 = cfg->sizes[37];
    ctx->sizes.mainzisegscan_num_groups_19534 = cfg->sizes[38];
    ctx->sizes.mainzisegscan_num_groups_19542 = cfg->sizes[39];
    ctx->sizes.mainzisegscan_num_groups_19550 = cfg->sizes[40];
    ctx->sizes.mainzisegscan_num_groups_19602 = cfg->sizes[41];
    ctx->sizes.mainzisuff_intra_par_12 = cfg->sizes[42];
    ctx->sizes.mainzisuff_intra_par_3 = cfg->sizes[43];
    ctx->sizes.mainzisuff_outer_par_0 = cfg->sizes[44];
    ctx->sizes.mainzisuff_outer_par_11 = cfg->sizes[45];
    ctx->sizes.mainzisuff_outer_redomap_10 = cfg->sizes[46];
    init_constants(ctx);
    // Clear the free list of any deallocations that occurred while initialising constants.
    OPENCL_SUCCEED_OR_RETURN(opencl_free_all(&ctx->opencl));
    // The program will be properly freed after all the kernels have also been freed.
    OPENCL_SUCCEED_OR_RETURN(clReleaseProgram(prog));
    return futhark_context_sync(ctx);
}
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg)
{
    struct futhark_context *ctx =
                           (struct futhark_context *) malloc(sizeof(struct futhark_context));
    
    if (ctx == NULL)
        return NULL;
    
    int required_types = 0;
    
    init_context_early(cfg, ctx);
    
    cl_program prog = setup_opencl(&ctx->opencl, opencl_program, required_types,
                                   cfg->build_opts);
    
    init_context_late(cfg, ctx, prog);
    return ctx;
}
struct futhark_context *futhark_context_new_with_command_queue(struct futhark_context_config *cfg,
                                                               cl_command_queue queue)
{
    struct futhark_context *ctx =
                           (struct futhark_context *) malloc(sizeof(struct futhark_context));
    
    if (ctx == NULL)
        return NULL;
    
    int required_types = 0;
    
    init_context_early(cfg, ctx);
    
    cl_program prog = setup_opencl_with_command_queue(&ctx->opencl, queue,
                                                      opencl_program,
                                                      required_types,
                                                      cfg->build_opts);
    
    init_context_late(cfg, ctx, prog);
    return ctx;
}
void futhark_context_free(struct futhark_context *ctx)
{
    free_constants(ctx);
    free_lock(&ctx->lock);
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->builtinzhreplicate_f32zireplicate_21178));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->builtinzhreplicate_i64zireplicate_20769));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32_low_height));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32_low_width));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32_small));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzicopy_21191));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzicopy_21228));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_19505));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_19538));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_19546));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_19554));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_19606));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_19505));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_19538));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_19546));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_19554));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_19606));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_19505));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_19538));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_19546));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_19554));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_19606));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziseghist_global_19523));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziseghist_local_19523));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_18400));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_18576));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_19078));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_19116));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_19173));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_19271));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_19335));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_19608));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_19680));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_19795));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_intragroup_18817));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_intragroup_19678));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_large_19830));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_large_20861));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_18386));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_19515));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_19625));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_19898));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_20460));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_20492));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_small_19830));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_small_20861));
    teardown_opencl(&ctx->opencl);
    free(ctx);
}
int futhark_context_sync(struct futhark_context *ctx)
{
    cl_int failure_idx = -1;
    
    if (ctx->failure_is_an_option) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     ctx->global_failure,
                                                     CL_FALSE, 0,
                                                     sizeof(cl_int),
                                                     &failure_idx, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        ctx->failure_is_an_option = 0;
    }
    OPENCL_SUCCEED_OR_RETURN(clFinish(ctx->opencl.queue));
    if (failure_idx >= 0) {
        cl_int no_failure = -1;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                      ctx->global_failure,
                                                      CL_TRUE, 0,
                                                      sizeof(cl_int),
                                                      &no_failure, 0, NULL,
                                                      NULL));
        
        int64_t args[3 + 1];
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     ctx->global_failure_args,
                                                     CL_TRUE, 0, sizeof(args),
                                                     &args, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_host_runs,
                                                                                               &ctx->copy_dev_to_host_total_runtime)));
        switch (failure_idx) {
            
          case 0:
            {
                ctx->error =
                    msgprintf("Range %lld..%lld...%lld is invalid.\n-> #0  cva.fut:54:29-52\n   #1  cva.fut:102:25-65\n   #2  cva.fut:116:16-62\n   #3  cva.fut:112:17-116:85\n   #4  cva.fut:107:1-181:20\n",
                              args[0], args[1], args[2]);
                break;
            }
            
          case 1:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:103:47-70\n   #1  cva.fut:116:16-62\n   #2  cva.fut:112:17-116:85\n   #3  cva.fut:107:1-181:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 2:
            {
                ctx->error =
                    msgprintf("Index [%lld:] out of bounds for array of shape [%lld].\n-> #0  cva.fut:104:74-90\n   #1  cva.fut:116:16-62\n   #2  cva.fut:112:17-116:85\n   #3  cva.fut:107:1-181:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 3:
            {
                ctx->error =
                    msgprintf("Range %lld..%lld...%lld is invalid.\n-> #0  cva.fut:54:29-52\n   #1  cva.fut:102:25-65\n   #2  cva.fut:116:16-62\n   #3  cva.fut:112:17-116:85\n   #4  cva.fut:107:1-181:20\n",
                              args[0], args[1], args[2]);
                break;
            }
            
          case 4:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:103:47-70\n   #1  cva.fut:116:16-62\n   #2  cva.fut:112:17-116:85\n   #3  cva.fut:107:1-181:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 5:
            {
                ctx->error =
                    msgprintf("Index [%lld:] out of bounds for array of shape [%lld].\n-> #0  cva.fut:104:74-90\n   #1  cva.fut:116:16-62\n   #2  cva.fut:112:17-116:85\n   #3  cva.fut:107:1-181:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 6:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:71:97-104\n   #1  cva.fut:130:32-62\n   #2  cva.fut:130:22-69\n   #3  cva.fut:107:1-181:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 7:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:71:58-105\n   #1  cva.fut:130:32-62\n   #2  cva.fut:130:22-69\n   #3  cva.fut:107:1-181:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 8:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:71:97-104\n   #1  cva.fut:130:32-62\n   #2  cva.fut:130:22-69\n   #3  cva.fut:107:1-181:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 9:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:71:58-105\n   #1  cva.fut:130:32-62\n   #2  cva.fut:130:22-69\n   #3  cva.fut:107:1-181:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 10:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  lib/github.com/diku-dk/segmented/segmented.fut:90:30-35\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:90:12-49\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:154:18-77\n   #6  cva.fut:107:1-181:20\n",
                              args[0], args[1]);
                break;
            }
        }
        return 1;
    }
    return 0;
}
int futhark_context_clear_caches(struct futhark_context *ctx)
{
    ctx->error = OPENCL_SUCCEED_NONFATAL(opencl_free_all(&ctx->opencl));
    return ctx->error != NULL;
}
cl_command_queue futhark_context_get_command_queue(struct futhark_context *ctx)
{
    return ctx->opencl.queue;
}
static int memblock_unref_device(struct futhark_context *ctx,
                                 struct memblock_device *block, const
                                 char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(stderr,
                    "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n",
                    desc, block->desc, "space 'device'", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_device -= block->size;
            OPENCL_SUCCEED_OR_RETURN(opencl_free(&ctx->opencl, block->mem,
                                                 desc));
            free(block->references);
            if (ctx->detail_memory)
                fprintf(stderr,
                        "%lld bytes freed (now allocated: %lld bytes)\n",
                        (long long) block->size,
                        (long long) ctx->cur_mem_usage_device);
        }
        block->references = NULL;
    }
    return 0;
}
static int memblock_alloc_device(struct futhark_context *ctx,
                                 struct memblock_device *block, int64_t size,
                                 const char *desc)
{
    if (size < 0)
        futhark_panic(1,
                      "Negative allocation of %lld bytes attempted for %s in %s.\n",
                      (long long) size, desc, "space 'device'",
                      ctx->cur_mem_usage_device);
    
    int ret = memblock_unref_device(ctx, block, desc);
    
    ctx->cur_mem_usage_device += size;
    if (ctx->detail_memory)
        fprintf(stderr,
                "Allocating %lld bytes for %s in %s (then allocated: %lld bytes)",
                (long long) size, desc, "space 'device'",
                (long long) ctx->cur_mem_usage_device);
    if (ctx->cur_mem_usage_device > ctx->peak_mem_usage_device) {
        ctx->peak_mem_usage_device = ctx->cur_mem_usage_device;
        if (ctx->detail_memory)
            fprintf(stderr, " (new peak).\n");
    } else if (ctx->detail_memory)
        fprintf(stderr, ".\n");
    OPENCL_SUCCEED_OR_RETURN(opencl_alloc(&ctx->opencl, size, desc,
                                          &block->mem));
    block->references = (int *) malloc(sizeof(int));
    *block->references = 1;
    block->size = size;
    block->desc = desc;
    return ret;
}
static int memblock_set_device(struct futhark_context *ctx,
                               struct memblock_device *lhs,
                               struct memblock_device *rhs, const
                               char *lhs_desc)
{
    int ret = memblock_unref_device(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
static int memblock_unref(struct futhark_context *ctx, struct memblock *block,
                          const char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(stderr,
                    "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n",
                    desc, block->desc, "default space", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_default -= block->size;
            free(block->mem);
            free(block->references);
            if (ctx->detail_memory)
                fprintf(stderr,
                        "%lld bytes freed (now allocated: %lld bytes)\n",
                        (long long) block->size,
                        (long long) ctx->cur_mem_usage_default);
        }
        block->references = NULL;
    }
    return 0;
}
static int memblock_alloc(struct futhark_context *ctx, struct memblock *block,
                          int64_t size, const char *desc)
{
    if (size < 0)
        futhark_panic(1,
                      "Negative allocation of %lld bytes attempted for %s in %s.\n",
                      (long long) size, desc, "default space",
                      ctx->cur_mem_usage_default);
    
    int ret = memblock_unref(ctx, block, desc);
    
    ctx->cur_mem_usage_default += size;
    if (ctx->detail_memory)
        fprintf(stderr,
                "Allocating %lld bytes for %s in %s (then allocated: %lld bytes)",
                (long long) size, desc, "default space",
                (long long) ctx->cur_mem_usage_default);
    if (ctx->cur_mem_usage_default > ctx->peak_mem_usage_default) {
        ctx->peak_mem_usage_default = ctx->cur_mem_usage_default;
        if (ctx->detail_memory)
            fprintf(stderr, " (new peak).\n");
    } else if (ctx->detail_memory)
        fprintf(stderr, ".\n");
    block->mem = (char *) malloc(size);
    block->references = (int *) malloc(sizeof(int));
    *block->references = 1;
    block->size = size;
    block->desc = desc;
    return ret;
}
static int memblock_set(struct futhark_context *ctx, struct memblock *lhs,
                        struct memblock *rhs, const char *lhs_desc)
{
    int ret = memblock_unref(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
char *futhark_context_report(struct futhark_context *ctx)
{
    struct str_builder builder;
    
    str_builder_init(&builder);
    if (ctx->detail_memory || ctx->profiling) {
        str_builder(&builder,
                    "Peak memory usage for space 'device': %lld bytes.\n",
                    (long long) ctx->peak_mem_usage_device);
        { }
    }
    if (ctx->profiling) {
        OPENCL_SUCCEED_FATAL(opencl_tally_profiling_records(&ctx->opencl));
        str_builder(&builder,
                    "copy_dev_to_dev                       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_dev_to_dev_runs,
                    (long) ctx->copy_dev_to_dev_total_runtime /
                    (ctx->copy_dev_to_dev_runs !=
                     0 ? ctx->copy_dev_to_dev_runs : 1),
                    (long) ctx->copy_dev_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_dev_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_dev_to_dev_runs;
        str_builder(&builder,
                    "copy_dev_to_host                      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_dev_to_host_runs,
                    (long) ctx->copy_dev_to_host_total_runtime /
                    (ctx->copy_dev_to_host_runs !=
                     0 ? ctx->copy_dev_to_host_runs : 1),
                    (long) ctx->copy_dev_to_host_total_runtime);
        ctx->total_runtime += ctx->copy_dev_to_host_total_runtime;
        ctx->total_runs += ctx->copy_dev_to_host_runs;
        str_builder(&builder,
                    "copy_host_to_dev                      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_host_to_dev_runs,
                    (long) ctx->copy_host_to_dev_total_runtime /
                    (ctx->copy_host_to_dev_runs !=
                     0 ? ctx->copy_host_to_dev_runs : 1),
                    (long) ctx->copy_host_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_host_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_host_to_dev_runs;
        str_builder(&builder,
                    "copy_scalar_to_dev                    ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_scalar_to_dev_runs,
                    (long) ctx->copy_scalar_to_dev_total_runtime /
                    (ctx->copy_scalar_to_dev_runs !=
                     0 ? ctx->copy_scalar_to_dev_runs : 1),
                    (long) ctx->copy_scalar_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_scalar_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_scalar_to_dev_runs;
        str_builder(&builder,
                    "copy_scalar_from_dev                  ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_scalar_from_dev_runs,
                    (long) ctx->copy_scalar_from_dev_total_runtime /
                    (ctx->copy_scalar_from_dev_runs !=
                     0 ? ctx->copy_scalar_from_dev_runs : 1),
                    (long) ctx->copy_scalar_from_dev_total_runtime);
        ctx->total_runtime += ctx->copy_scalar_from_dev_total_runtime;
        ctx->total_runs += ctx->copy_scalar_from_dev_runs;
        str_builder(&builder,
                    "builtin#replicate_f32.replicate_21178 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->builtinzhreplicate_f32zireplicate_21178_runs,
                    (long) ctx->builtinzhreplicate_f32zireplicate_21178_total_runtime /
                    (ctx->builtinzhreplicate_f32zireplicate_21178_runs !=
                     0 ? ctx->builtinzhreplicate_f32zireplicate_21178_runs : 1),
                    (long) ctx->builtinzhreplicate_f32zireplicate_21178_total_runtime);
        ctx->total_runtime +=
            ctx->builtinzhreplicate_f32zireplicate_21178_total_runtime;
        ctx->total_runs += ctx->builtinzhreplicate_f32zireplicate_21178_runs;
        str_builder(&builder,
                    "builtin#replicate_i64.replicate_20769 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->builtinzhreplicate_i64zireplicate_20769_runs,
                    (long) ctx->builtinzhreplicate_i64zireplicate_20769_total_runtime /
                    (ctx->builtinzhreplicate_i64zireplicate_20769_runs !=
                     0 ? ctx->builtinzhreplicate_i64zireplicate_20769_runs : 1),
                    (long) ctx->builtinzhreplicate_i64zireplicate_20769_total_runtime);
        ctx->total_runtime +=
            ctx->builtinzhreplicate_i64zireplicate_20769_total_runtime;
        ctx->total_runs += ctx->builtinzhreplicate_i64zireplicate_20769_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32                 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_runs,
                    (long) ctx->gpu_map_transpose_f32_total_runtime /
                    (ctx->gpu_map_transpose_f32_runs !=
                     0 ? ctx->gpu_map_transpose_f32_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_f32_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_low_height      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_low_height_runs,
                    (long) ctx->gpu_map_transpose_f32_low_height_total_runtime /
                    (ctx->gpu_map_transpose_f32_low_height_runs !=
                     0 ? ctx->gpu_map_transpose_f32_low_height_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_low_height_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_f32_low_height_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_low_height_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_low_width       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_low_width_runs,
                    (long) ctx->gpu_map_transpose_f32_low_width_total_runtime /
                    (ctx->gpu_map_transpose_f32_low_width_runs !=
                     0 ? ctx->gpu_map_transpose_f32_low_width_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_low_width_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_f32_low_width_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_low_width_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_small           ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_small_runs,
                    (long) ctx->gpu_map_transpose_f32_small_total_runtime /
                    (ctx->gpu_map_transpose_f32_small_runs !=
                     0 ? ctx->gpu_map_transpose_f32_small_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_small_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_f32_small_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_small_runs;
        str_builder(&builder,
                    "main.copy_21191                       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzicopy_21191_runs,
                    (long) ctx->mainzicopy_21191_total_runtime /
                    (ctx->mainzicopy_21191_runs !=
                     0 ? ctx->mainzicopy_21191_runs : 1),
                    (long) ctx->mainzicopy_21191_total_runtime);
        ctx->total_runtime += ctx->mainzicopy_21191_total_runtime;
        ctx->total_runs += ctx->mainzicopy_21191_runs;
        str_builder(&builder,
                    "main.copy_21228                       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzicopy_21228_runs,
                    (long) ctx->mainzicopy_21228_total_runtime /
                    (ctx->mainzicopy_21228_runs !=
                     0 ? ctx->mainzicopy_21228_runs : 1),
                    (long) ctx->mainzicopy_21228_total_runtime);
        ctx->total_runtime += ctx->mainzicopy_21228_total_runtime;
        ctx->total_runs += ctx->mainzicopy_21228_runs;
        str_builder(&builder,
                    "main.scan_stage1_19505                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_19505_runs,
                    (long) ctx->mainziscan_stage1_19505_total_runtime /
                    (ctx->mainziscan_stage1_19505_runs !=
                     0 ? ctx->mainziscan_stage1_19505_runs : 1),
                    (long) ctx->mainziscan_stage1_19505_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_19505_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_19505_runs;
        str_builder(&builder,
                    "main.scan_stage1_19538                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_19538_runs,
                    (long) ctx->mainziscan_stage1_19538_total_runtime /
                    (ctx->mainziscan_stage1_19538_runs !=
                     0 ? ctx->mainziscan_stage1_19538_runs : 1),
                    (long) ctx->mainziscan_stage1_19538_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_19538_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_19538_runs;
        str_builder(&builder,
                    "main.scan_stage1_19546                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_19546_runs,
                    (long) ctx->mainziscan_stage1_19546_total_runtime /
                    (ctx->mainziscan_stage1_19546_runs !=
                     0 ? ctx->mainziscan_stage1_19546_runs : 1),
                    (long) ctx->mainziscan_stage1_19546_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_19546_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_19546_runs;
        str_builder(&builder,
                    "main.scan_stage1_19554                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_19554_runs,
                    (long) ctx->mainziscan_stage1_19554_total_runtime /
                    (ctx->mainziscan_stage1_19554_runs !=
                     0 ? ctx->mainziscan_stage1_19554_runs : 1),
                    (long) ctx->mainziscan_stage1_19554_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_19554_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_19554_runs;
        str_builder(&builder,
                    "main.scan_stage1_19606                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_19606_runs,
                    (long) ctx->mainziscan_stage1_19606_total_runtime /
                    (ctx->mainziscan_stage1_19606_runs !=
                     0 ? ctx->mainziscan_stage1_19606_runs : 1),
                    (long) ctx->mainziscan_stage1_19606_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_19606_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_19606_runs;
        str_builder(&builder,
                    "main.scan_stage2_19505                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_19505_runs,
                    (long) ctx->mainziscan_stage2_19505_total_runtime /
                    (ctx->mainziscan_stage2_19505_runs !=
                     0 ? ctx->mainziscan_stage2_19505_runs : 1),
                    (long) ctx->mainziscan_stage2_19505_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_19505_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_19505_runs;
        str_builder(&builder,
                    "main.scan_stage2_19538                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_19538_runs,
                    (long) ctx->mainziscan_stage2_19538_total_runtime /
                    (ctx->mainziscan_stage2_19538_runs !=
                     0 ? ctx->mainziscan_stage2_19538_runs : 1),
                    (long) ctx->mainziscan_stage2_19538_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_19538_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_19538_runs;
        str_builder(&builder,
                    "main.scan_stage2_19546                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_19546_runs,
                    (long) ctx->mainziscan_stage2_19546_total_runtime /
                    (ctx->mainziscan_stage2_19546_runs !=
                     0 ? ctx->mainziscan_stage2_19546_runs : 1),
                    (long) ctx->mainziscan_stage2_19546_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_19546_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_19546_runs;
        str_builder(&builder,
                    "main.scan_stage2_19554                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_19554_runs,
                    (long) ctx->mainziscan_stage2_19554_total_runtime /
                    (ctx->mainziscan_stage2_19554_runs !=
                     0 ? ctx->mainziscan_stage2_19554_runs : 1),
                    (long) ctx->mainziscan_stage2_19554_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_19554_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_19554_runs;
        str_builder(&builder,
                    "main.scan_stage2_19606                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_19606_runs,
                    (long) ctx->mainziscan_stage2_19606_total_runtime /
                    (ctx->mainziscan_stage2_19606_runs !=
                     0 ? ctx->mainziscan_stage2_19606_runs : 1),
                    (long) ctx->mainziscan_stage2_19606_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_19606_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_19606_runs;
        str_builder(&builder,
                    "main.scan_stage3_19505                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_19505_runs,
                    (long) ctx->mainziscan_stage3_19505_total_runtime /
                    (ctx->mainziscan_stage3_19505_runs !=
                     0 ? ctx->mainziscan_stage3_19505_runs : 1),
                    (long) ctx->mainziscan_stage3_19505_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_19505_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_19505_runs;
        str_builder(&builder,
                    "main.scan_stage3_19538                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_19538_runs,
                    (long) ctx->mainziscan_stage3_19538_total_runtime /
                    (ctx->mainziscan_stage3_19538_runs !=
                     0 ? ctx->mainziscan_stage3_19538_runs : 1),
                    (long) ctx->mainziscan_stage3_19538_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_19538_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_19538_runs;
        str_builder(&builder,
                    "main.scan_stage3_19546                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_19546_runs,
                    (long) ctx->mainziscan_stage3_19546_total_runtime /
                    (ctx->mainziscan_stage3_19546_runs !=
                     0 ? ctx->mainziscan_stage3_19546_runs : 1),
                    (long) ctx->mainziscan_stage3_19546_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_19546_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_19546_runs;
        str_builder(&builder,
                    "main.scan_stage3_19554                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_19554_runs,
                    (long) ctx->mainziscan_stage3_19554_total_runtime /
                    (ctx->mainziscan_stage3_19554_runs !=
                     0 ? ctx->mainziscan_stage3_19554_runs : 1),
                    (long) ctx->mainziscan_stage3_19554_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_19554_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_19554_runs;
        str_builder(&builder,
                    "main.scan_stage3_19606                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_19606_runs,
                    (long) ctx->mainziscan_stage3_19606_total_runtime /
                    (ctx->mainziscan_stage3_19606_runs !=
                     0 ? ctx->mainziscan_stage3_19606_runs : 1),
                    (long) ctx->mainziscan_stage3_19606_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_19606_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_19606_runs;
        str_builder(&builder,
                    "main.seghist_global_19523             ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziseghist_global_19523_runs,
                    (long) ctx->mainziseghist_global_19523_total_runtime /
                    (ctx->mainziseghist_global_19523_runs !=
                     0 ? ctx->mainziseghist_global_19523_runs : 1),
                    (long) ctx->mainziseghist_global_19523_total_runtime);
        ctx->total_runtime += ctx->mainziseghist_global_19523_total_runtime;
        ctx->total_runs += ctx->mainziseghist_global_19523_runs;
        str_builder(&builder,
                    "main.seghist_local_19523              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziseghist_local_19523_runs,
                    (long) ctx->mainziseghist_local_19523_total_runtime /
                    (ctx->mainziseghist_local_19523_runs !=
                     0 ? ctx->mainziseghist_local_19523_runs : 1),
                    (long) ctx->mainziseghist_local_19523_total_runtime);
        ctx->total_runtime += ctx->mainziseghist_local_19523_total_runtime;
        ctx->total_runs += ctx->mainziseghist_local_19523_runs;
        str_builder(&builder,
                    "main.segmap_18400                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_18400_runs,
                    (long) ctx->mainzisegmap_18400_total_runtime /
                    (ctx->mainzisegmap_18400_runs !=
                     0 ? ctx->mainzisegmap_18400_runs : 1),
                    (long) ctx->mainzisegmap_18400_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_18400_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_18400_runs;
        str_builder(&builder,
                    "main.segmap_18576                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_18576_runs,
                    (long) ctx->mainzisegmap_18576_total_runtime /
                    (ctx->mainzisegmap_18576_runs !=
                     0 ? ctx->mainzisegmap_18576_runs : 1),
                    (long) ctx->mainzisegmap_18576_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_18576_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_18576_runs;
        str_builder(&builder,
                    "main.segmap_19078                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_19078_runs,
                    (long) ctx->mainzisegmap_19078_total_runtime /
                    (ctx->mainzisegmap_19078_runs !=
                     0 ? ctx->mainzisegmap_19078_runs : 1),
                    (long) ctx->mainzisegmap_19078_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_19078_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_19078_runs;
        str_builder(&builder,
                    "main.segmap_19116                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_19116_runs,
                    (long) ctx->mainzisegmap_19116_total_runtime /
                    (ctx->mainzisegmap_19116_runs !=
                     0 ? ctx->mainzisegmap_19116_runs : 1),
                    (long) ctx->mainzisegmap_19116_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_19116_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_19116_runs;
        str_builder(&builder,
                    "main.segmap_19173                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_19173_runs,
                    (long) ctx->mainzisegmap_19173_total_runtime /
                    (ctx->mainzisegmap_19173_runs !=
                     0 ? ctx->mainzisegmap_19173_runs : 1),
                    (long) ctx->mainzisegmap_19173_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_19173_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_19173_runs;
        str_builder(&builder,
                    "main.segmap_19271                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_19271_runs,
                    (long) ctx->mainzisegmap_19271_total_runtime /
                    (ctx->mainzisegmap_19271_runs !=
                     0 ? ctx->mainzisegmap_19271_runs : 1),
                    (long) ctx->mainzisegmap_19271_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_19271_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_19271_runs;
        str_builder(&builder,
                    "main.segmap_19335                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_19335_runs,
                    (long) ctx->mainzisegmap_19335_total_runtime /
                    (ctx->mainzisegmap_19335_runs !=
                     0 ? ctx->mainzisegmap_19335_runs : 1),
                    (long) ctx->mainzisegmap_19335_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_19335_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_19335_runs;
        str_builder(&builder,
                    "main.segmap_19608                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_19608_runs,
                    (long) ctx->mainzisegmap_19608_total_runtime /
                    (ctx->mainzisegmap_19608_runs !=
                     0 ? ctx->mainzisegmap_19608_runs : 1),
                    (long) ctx->mainzisegmap_19608_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_19608_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_19608_runs;
        str_builder(&builder,
                    "main.segmap_19680                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_19680_runs,
                    (long) ctx->mainzisegmap_19680_total_runtime /
                    (ctx->mainzisegmap_19680_runs !=
                     0 ? ctx->mainzisegmap_19680_runs : 1),
                    (long) ctx->mainzisegmap_19680_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_19680_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_19680_runs;
        str_builder(&builder,
                    "main.segmap_19795                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_19795_runs,
                    (long) ctx->mainzisegmap_19795_total_runtime /
                    (ctx->mainzisegmap_19795_runs !=
                     0 ? ctx->mainzisegmap_19795_runs : 1),
                    (long) ctx->mainzisegmap_19795_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_19795_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_19795_runs;
        str_builder(&builder,
                    "main.segmap_intragroup_18817          ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_intragroup_18817_runs,
                    (long) ctx->mainzisegmap_intragroup_18817_total_runtime /
                    (ctx->mainzisegmap_intragroup_18817_runs !=
                     0 ? ctx->mainzisegmap_intragroup_18817_runs : 1),
                    (long) ctx->mainzisegmap_intragroup_18817_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_intragroup_18817_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_intragroup_18817_runs;
        str_builder(&builder,
                    "main.segmap_intragroup_19678          ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_intragroup_19678_runs,
                    (long) ctx->mainzisegmap_intragroup_19678_total_runtime /
                    (ctx->mainzisegmap_intragroup_19678_runs !=
                     0 ? ctx->mainzisegmap_intragroup_19678_runs : 1),
                    (long) ctx->mainzisegmap_intragroup_19678_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_intragroup_19678_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_intragroup_19678_runs;
        str_builder(&builder,
                    "main.segred_large_19830               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_large_19830_runs,
                    (long) ctx->mainzisegred_large_19830_total_runtime /
                    (ctx->mainzisegred_large_19830_runs !=
                     0 ? ctx->mainzisegred_large_19830_runs : 1),
                    (long) ctx->mainzisegred_large_19830_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_large_19830_total_runtime;
        ctx->total_runs += ctx->mainzisegred_large_19830_runs;
        str_builder(&builder,
                    "main.segred_large_20861               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_large_20861_runs,
                    (long) ctx->mainzisegred_large_20861_total_runtime /
                    (ctx->mainzisegred_large_20861_runs !=
                     0 ? ctx->mainzisegred_large_20861_runs : 1),
                    (long) ctx->mainzisegred_large_20861_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_large_20861_total_runtime;
        ctx->total_runs += ctx->mainzisegred_large_20861_runs;
        str_builder(&builder,
                    "main.segred_nonseg_18386              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_18386_runs,
                    (long) ctx->mainzisegred_nonseg_18386_total_runtime /
                    (ctx->mainzisegred_nonseg_18386_runs !=
                     0 ? ctx->mainzisegred_nonseg_18386_runs : 1),
                    (long) ctx->mainzisegred_nonseg_18386_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_18386_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_18386_runs;
        str_builder(&builder,
                    "main.segred_nonseg_19515              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_19515_runs,
                    (long) ctx->mainzisegred_nonseg_19515_total_runtime /
                    (ctx->mainzisegred_nonseg_19515_runs !=
                     0 ? ctx->mainzisegred_nonseg_19515_runs : 1),
                    (long) ctx->mainzisegred_nonseg_19515_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_19515_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_19515_runs;
        str_builder(&builder,
                    "main.segred_nonseg_19625              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_19625_runs,
                    (long) ctx->mainzisegred_nonseg_19625_total_runtime /
                    (ctx->mainzisegred_nonseg_19625_runs !=
                     0 ? ctx->mainzisegred_nonseg_19625_runs : 1),
                    (long) ctx->mainzisegred_nonseg_19625_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_19625_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_19625_runs;
        str_builder(&builder,
                    "main.segred_nonseg_19898              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_19898_runs,
                    (long) ctx->mainzisegred_nonseg_19898_total_runtime /
                    (ctx->mainzisegred_nonseg_19898_runs !=
                     0 ? ctx->mainzisegred_nonseg_19898_runs : 1),
                    (long) ctx->mainzisegred_nonseg_19898_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_19898_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_19898_runs;
        str_builder(&builder,
                    "main.segred_nonseg_20460              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_20460_runs,
                    (long) ctx->mainzisegred_nonseg_20460_total_runtime /
                    (ctx->mainzisegred_nonseg_20460_runs !=
                     0 ? ctx->mainzisegred_nonseg_20460_runs : 1),
                    (long) ctx->mainzisegred_nonseg_20460_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_20460_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_20460_runs;
        str_builder(&builder,
                    "main.segred_nonseg_20492              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_20492_runs,
                    (long) ctx->mainzisegred_nonseg_20492_total_runtime /
                    (ctx->mainzisegred_nonseg_20492_runs !=
                     0 ? ctx->mainzisegred_nonseg_20492_runs : 1),
                    (long) ctx->mainzisegred_nonseg_20492_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_20492_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_20492_runs;
        str_builder(&builder,
                    "main.segred_small_19830               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_small_19830_runs,
                    (long) ctx->mainzisegred_small_19830_total_runtime /
                    (ctx->mainzisegred_small_19830_runs !=
                     0 ? ctx->mainzisegred_small_19830_runs : 1),
                    (long) ctx->mainzisegred_small_19830_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_small_19830_total_runtime;
        ctx->total_runs += ctx->mainzisegred_small_19830_runs;
        str_builder(&builder,
                    "main.segred_small_20861               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_small_20861_runs,
                    (long) ctx->mainzisegred_small_20861_total_runtime /
                    (ctx->mainzisegred_small_20861_runs !=
                     0 ? ctx->mainzisegred_small_20861_runs : 1),
                    (long) ctx->mainzisegred_small_20861_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_small_20861_total_runtime;
        ctx->total_runs += ctx->mainzisegred_small_20861_runs;
        str_builder(&builder, "%d operations with cumulative runtime: %6ldus\n",
                    ctx->total_runs, ctx->total_runtime);
    }
    return builder.str;
}
char *futhark_context_get_error(struct futhark_context *ctx)
{
    char *error = ctx->error;
    
    ctx->error = NULL;
    return error;
}
void futhark_context_pause_profiling(struct futhark_context *ctx)
{
    ctx->profiling_paused = 1;
}
void futhark_context_unpause_profiling(struct futhark_context *ctx)
{
    ctx->profiling_paused = 0;
}
static int futrts_builtinzhgpu_map_transpose_f32(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6);
static int futrts_builtinzhreplicate_f32(struct futhark_context *ctx,
                                         struct memblock_device mem_21174,
                                         int32_t num_elems_21175,
                                         float val_21176);
static int futrts_builtinzhreplicate_i64(struct futhark_context *ctx,
                                         struct memblock_device mem_20765,
                                         int32_t num_elems_20766,
                                         int64_t val_20767);
static int futrts_main(struct futhark_context *ctx, float *out_scalar_out_21381,
                       struct memblock_device *out_mem_p_21382,
                       int64_t *out_out_arrsizze_21383,
                       struct memblock_device swap_term_mem_20224,
                       struct memblock_device payments_mem_20225,
                       struct memblock_device notional_mem_20226,
                       int64_t n_17882, int64_t n_17883, int64_t n_17884,
                       int64_t paths_17885, int64_t steps_17886, float a_17890,
                       float b_17891, float sigma_17892, float r0_17893);
int init_constants(struct futhark_context *ctx)
{
    (void) ctx;
    
    int err = 0;
    
    
  cleanup:
    return err;
}
int free_constants(struct futhark_context *ctx)
{
    (void) ctx;
    return 0;
}
static int futrts_builtinzhgpu_map_transpose_f32(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6)
{
    (void) ctx;
    
    int err = 0;
    
    if (!(num_arrays_4 == 0 || (x_elems_5 == 0 || y_elems_6 == 0))) {
        int32_t muly_8 = squot32(16, x_elems_5);
        int32_t mulx_7 = squot32(16, y_elems_6);
        
        if (num_arrays_4 == 1 && (x_elems_5 == 1 || y_elems_6 == 1)) {
            if (sext_i32_i64(x_elems_5 * y_elems_6 * (int32_t) sizeof(float)) >
                0) {
                OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                             srcmem_2.mem,
                                                             destmem_0.mem,
                                                             sext_i32_i64(srcoffset_3),
                                                             sext_i32_i64(destoffset_1),
                                                             sext_i32_i64(x_elems_5 *
                                                             y_elems_6 *
                                                             (int32_t) sizeof(float)),
                                                             0, NULL,
                                                             ctx->profiling_paused ||
                                                             !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                       &ctx->copy_dev_to_dev_runs,
                                                                                                       &ctx->copy_dev_to_dev_total_runtime)));
                if (ctx->debugging)
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            }
        } else {
            if (sle32(x_elems_5, 8) && slt32(16, y_elems_6)) {
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        0, 1088, NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        1, sizeof(destoffset_1),
                                                        &destoffset_1));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        2, sizeof(srcoffset_3),
                                                        &srcoffset_3));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        3, sizeof(num_arrays_4),
                                                        &num_arrays_4));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        4, sizeof(x_elems_5),
                                                        &x_elems_5));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        5, sizeof(y_elems_6),
                                                        &y_elems_6));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        6, sizeof(mulx_7),
                                                        &mulx_7));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        7, sizeof(muly_8),
                                                        &muly_8));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        8,
                                                        sizeof(destmem_0.mem),
                                                        &destmem_0.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        9, sizeof(srcmem_2.mem),
                                                        &srcmem_2.mem));
                if (1 * ((size_t) sdiv_up32(x_elems_5, 16) * (size_t) 16) *
                    ((size_t) sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16) *
                     (size_t) 16) * ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                    const size_t global_work_sizze_21351[3] =
                                 {(size_t) sdiv_up32(x_elems_5, 16) *
                                  (size_t) 16,
                                  (size_t) sdiv_up32(sdiv_up32(y_elems_6,
                                                               muly_8), 16) *
                                  (size_t) 16, (size_t) num_arrays_4 *
                                  (size_t) 1};
                    const size_t local_work_sizze_21355[3] = {16, 16, 1};
                    int64_t time_start_21352 = 0, time_end_21353 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "gpu_map_transpose_f32_low_width");
                        fprintf(stderr, "%zu", global_work_sizze_21351[0]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", global_work_sizze_21351[1]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", global_work_sizze_21351[2]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_21355[0]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", local_work_sizze_21355[1]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", local_work_sizze_21355[2]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) (0 + 1088));
                        time_start_21352 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->gpu_map_transpose_f32_low_width,
                                                                    3, NULL,
                                                                    global_work_sizze_21351,
                                                                    local_work_sizze_21355,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->gpu_map_transpose_f32_low_width_runs,
                                                                                                              &ctx->gpu_map_transpose_f32_low_width_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_21353 = get_wall_time();
                        
                        long time_diff_21354 = time_end_21353 -
                             time_start_21352;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "gpu_map_transpose_f32_low_width",
                                time_diff_21354);
                    }
                }
            } else {
                if (sle32(y_elems_6, 8) && slt32(16, x_elems_5)) {
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            0, 1088, NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            1,
                                                            sizeof(destoffset_1),
                                                            &destoffset_1));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            2,
                                                            sizeof(srcoffset_3),
                                                            &srcoffset_3));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            3,
                                                            sizeof(num_arrays_4),
                                                            &num_arrays_4));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            4,
                                                            sizeof(x_elems_5),
                                                            &x_elems_5));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            5,
                                                            sizeof(y_elems_6),
                                                            &y_elems_6));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            6, sizeof(mulx_7),
                                                            &mulx_7));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            7, sizeof(muly_8),
                                                            &muly_8));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            8,
                                                            sizeof(destmem_0.mem),
                                                            &destmem_0.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            9,
                                                            sizeof(srcmem_2.mem),
                                                            &srcmem_2.mem));
                    if (1 * ((size_t) sdiv_up32(sdiv_up32(x_elems_5, mulx_7),
                                                16) * (size_t) 16) *
                        ((size_t) sdiv_up32(y_elems_6, 16) * (size_t) 16) *
                        ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                        const size_t global_work_sizze_21356[3] =
                                     {(size_t) sdiv_up32(sdiv_up32(x_elems_5,
                                                                   mulx_7),
                                                         16) * (size_t) 16,
                                      (size_t) sdiv_up32(y_elems_6, 16) *
                                      (size_t) 16, (size_t) num_arrays_4 *
                                      (size_t) 1};
                        const size_t local_work_sizze_21360[3] = {16, 16, 1};
                        int64_t time_start_21357 = 0, time_end_21358 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "gpu_map_transpose_f32_low_height");
                            fprintf(stderr, "%zu", global_work_sizze_21356[0]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", global_work_sizze_21356[1]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", global_work_sizze_21356[2]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_21360[0]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", local_work_sizze_21360[1]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", local_work_sizze_21360[2]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + 1088));
                            time_start_21357 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->gpu_map_transpose_f32_low_height,
                                                                        3, NULL,
                                                                        global_work_sizze_21356,
                                                                        local_work_sizze_21360,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->gpu_map_transpose_f32_low_height_runs,
                                                                                                                  &ctx->gpu_map_transpose_f32_low_height_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_21358 = get_wall_time();
                            
                            long time_diff_21359 = time_end_21358 -
                                 time_start_21357;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "gpu_map_transpose_f32_low_height",
                                    time_diff_21359);
                        }
                    }
                } else {
                    if (sle32(x_elems_5, 8) && sle32(y_elems_6, 8)) {
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                0, 1, NULL));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                1,
                                                                sizeof(destoffset_1),
                                                                &destoffset_1));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                2,
                                                                sizeof(srcoffset_3),
                                                                &srcoffset_3));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                3,
                                                                sizeof(num_arrays_4),
                                                                &num_arrays_4));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                4,
                                                                sizeof(x_elems_5),
                                                                &x_elems_5));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                5,
                                                                sizeof(y_elems_6),
                                                                &y_elems_6));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                6,
                                                                sizeof(mulx_7),
                                                                &mulx_7));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                7,
                                                                sizeof(muly_8),
                                                                &muly_8));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                8,
                                                                sizeof(destmem_0.mem),
                                                                &destmem_0.mem));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                9,
                                                                sizeof(srcmem_2.mem),
                                                                &srcmem_2.mem));
                        if (1 * ((size_t) sdiv_up32(num_arrays_4 * x_elems_5 *
                                                    y_elems_6, 256) *
                                 (size_t) 256) != 0) {
                            const size_t global_work_sizze_21361[1] =
                                         {(size_t) sdiv_up32(num_arrays_4 *
                                                             x_elems_5 *
                                                             y_elems_6, 256) *
                                         (size_t) 256};
                            const size_t local_work_sizze_21365[1] = {256};
                            int64_t time_start_21362 = 0, time_end_21363 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr,
                                        "Launching %s with global work size [",
                                        "gpu_map_transpose_f32_small");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_21361[0]);
                                fprintf(stderr, "] and local work size [");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_21365[0]);
                                fprintf(stderr,
                                        "]; local memory parameters sum to %d bytes.\n",
                                        (int) (0 + 1));
                                time_start_21362 = get_wall_time();
                            }
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                            ctx->gpu_map_transpose_f32_small,
                                                                            1,
                                                                            NULL,
                                                                            global_work_sizze_21361,
                                                                            local_work_sizze_21365,
                                                                            0,
                                                                            NULL,
                                                                            ctx->profiling_paused ||
                                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                      &ctx->gpu_map_transpose_f32_small_runs,
                                                                                                                      &ctx->gpu_map_transpose_f32_small_total_runtime)));
                            if (ctx->debugging) {
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                                time_end_21363 = get_wall_time();
                                
                                long time_diff_21364 = time_end_21363 -
                                     time_start_21362;
                                
                                fprintf(stderr, "kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_f32_small",
                                        time_diff_21364);
                            }
                        }
                    } else {
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                0, 4224, NULL));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                1,
                                                                sizeof(destoffset_1),
                                                                &destoffset_1));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                2,
                                                                sizeof(srcoffset_3),
                                                                &srcoffset_3));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                3,
                                                                sizeof(num_arrays_4),
                                                                &num_arrays_4));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                4,
                                                                sizeof(x_elems_5),
                                                                &x_elems_5));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                5,
                                                                sizeof(y_elems_6),
                                                                &y_elems_6));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                6,
                                                                sizeof(mulx_7),
                                                                &mulx_7));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                7,
                                                                sizeof(muly_8),
                                                                &muly_8));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                8,
                                                                sizeof(destmem_0.mem),
                                                                &destmem_0.mem));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                9,
                                                                sizeof(srcmem_2.mem),
                                                                &srcmem_2.mem));
                        if (1 * ((size_t) sdiv_up32(x_elems_5, 32) *
                                 (size_t) 32) * ((size_t) sdiv_up32(y_elems_6,
                                                                    32) *
                                                 (size_t) 8) *
                            ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                            const size_t global_work_sizze_21366[3] =
                                         {(size_t) sdiv_up32(x_elems_5, 32) *
                                          (size_t) 32,
                                          (size_t) sdiv_up32(y_elems_6, 32) *
                                          (size_t) 8, (size_t) num_arrays_4 *
                                          (size_t) 1};
                            const size_t local_work_sizze_21370[3] = {32, 8, 1};
                            int64_t time_start_21367 = 0, time_end_21368 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr,
                                        "Launching %s with global work size [",
                                        "gpu_map_transpose_f32");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_21366[0]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_21366[1]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_21366[2]);
                                fprintf(stderr, "] and local work size [");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_21370[0]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_21370[1]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_21370[2]);
                                fprintf(stderr,
                                        "]; local memory parameters sum to %d bytes.\n",
                                        (int) (0 + 4224));
                                time_start_21367 = get_wall_time();
                            }
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                            ctx->gpu_map_transpose_f32,
                                                                            3,
                                                                            NULL,
                                                                            global_work_sizze_21366,
                                                                            local_work_sizze_21370,
                                                                            0,
                                                                            NULL,
                                                                            ctx->profiling_paused ||
                                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                      &ctx->gpu_map_transpose_f32_runs,
                                                                                                                      &ctx->gpu_map_transpose_f32_total_runtime)));
                            if (ctx->debugging) {
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                                time_end_21368 = get_wall_time();
                                
                                long time_diff_21369 = time_end_21368 -
                                     time_start_21367;
                                
                                fprintf(stderr, "kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_f32",
                                        time_diff_21369);
                            }
                        }
                    }
                }
            }
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhreplicate_f32(struct futhark_context *ctx,
                                         struct memblock_device mem_21174,
                                         int32_t num_elems_21175,
                                         float val_21176)
{
    (void) ctx;
    
    int err = 0;
    int64_t group_sizze_21181;
    
    group_sizze_21181 = ctx->sizes.builtinzhreplicate_f32zigroup_sizze_21181;
    
    int64_t num_groups_21182;
    
    num_groups_21182 = sdiv_up64(num_elems_21175, group_sizze_21181);
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_f32zireplicate_21178,
                                            0, sizeof(mem_21174.mem),
                                            &mem_21174.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_f32zireplicate_21178,
                                            1, sizeof(num_elems_21175),
                                            &num_elems_21175));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_f32zireplicate_21178,
                                            2, sizeof(val_21176), &val_21176));
    if (1 * ((size_t) num_groups_21182 * (size_t) group_sizze_21181) != 0) {
        const size_t global_work_sizze_21371[1] = {(size_t) num_groups_21182 *
                     (size_t) group_sizze_21181};
        const size_t local_work_sizze_21375[1] = {group_sizze_21181};
        int64_t time_start_21372 = 0, time_end_21373 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "builtin#replicate_f32.replicate_21178");
            fprintf(stderr, "%zu", global_work_sizze_21371[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_21375[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_21372 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->builtinzhreplicate_f32zireplicate_21178,
                                                        1, NULL,
                                                        global_work_sizze_21371,
                                                        local_work_sizze_21375,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->builtinzhreplicate_f32zireplicate_21178_runs,
                                                                                                  &ctx->builtinzhreplicate_f32zireplicate_21178_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_21373 = get_wall_time();
            
            long time_diff_21374 = time_end_21373 - time_start_21372;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n",
                    "builtin#replicate_f32.replicate_21178", time_diff_21374);
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhreplicate_i64(struct futhark_context *ctx,
                                         struct memblock_device mem_20765,
                                         int32_t num_elems_20766,
                                         int64_t val_20767)
{
    (void) ctx;
    
    int err = 0;
    int64_t group_sizze_20772;
    
    group_sizze_20772 = ctx->sizes.builtinzhreplicate_i64zigroup_sizze_20772;
    
    int64_t num_groups_20773;
    
    num_groups_20773 = sdiv_up64(num_elems_20766, group_sizze_20772);
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_i64zireplicate_20769,
                                            0, sizeof(mem_20765.mem),
                                            &mem_20765.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_i64zireplicate_20769,
                                            1, sizeof(num_elems_20766),
                                            &num_elems_20766));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_i64zireplicate_20769,
                                            2, sizeof(val_20767), &val_20767));
    if (1 * ((size_t) num_groups_20773 * (size_t) group_sizze_20772) != 0) {
        const size_t global_work_sizze_21376[1] = {(size_t) num_groups_20773 *
                     (size_t) group_sizze_20772};
        const size_t local_work_sizze_21380[1] = {group_sizze_20772};
        int64_t time_start_21377 = 0, time_end_21378 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "builtin#replicate_i64.replicate_20769");
            fprintf(stderr, "%zu", global_work_sizze_21376[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_21380[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_21377 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->builtinzhreplicate_i64zireplicate_20769,
                                                        1, NULL,
                                                        global_work_sizze_21376,
                                                        local_work_sizze_21380,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->builtinzhreplicate_i64zireplicate_20769_runs,
                                                                                                  &ctx->builtinzhreplicate_i64zireplicate_20769_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_21378 = get_wall_time();
            
            long time_diff_21379 = time_end_21378 - time_start_21377;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n",
                    "builtin#replicate_i64.replicate_20769", time_diff_21379);
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_main(struct futhark_context *ctx, float *out_scalar_out_21381,
                       struct memblock_device *out_mem_p_21382,
                       int64_t *out_out_arrsizze_21383,
                       struct memblock_device swap_term_mem_20224,
                       struct memblock_device payments_mem_20225,
                       struct memblock_device notional_mem_20226,
                       int64_t n_17882, int64_t n_17883, int64_t n_17884,
                       int64_t paths_17885, int64_t steps_17886, float a_17890,
                       float b_17891, float sigma_17892, float r0_17893)
{
    (void) ctx;
    
    int err = 0;
    float scalar_out_20529;
    struct memblock_device out_mem_20530;
    
    out_mem_20530.references = NULL;
    
    int64_t out_arrsizze_20531;
    bool dim_match_17894 = n_17882 == n_17883;
    bool empty_or_match_cert_17895;
    
    if (!dim_match_17894) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  cva.fut:107:1-181:20\n");
        if (memblock_unref_device(ctx, &out_mem_20530, "out_mem_20530") != 0)
            return 1;
        return 1;
    }
    
    int64_t segred_group_sizze_18379;
    
    segred_group_sizze_18379 = ctx->sizes.mainzisegred_group_sizze_18378;
    
    int64_t num_groups_18381;
    int32_t max_num_groups_20532;
    
    max_num_groups_20532 = ctx->sizes.mainzisegred_num_groups_18380;
    num_groups_18381 = sext_i64_i32(smax64(1, smin64(sdiv_up64(n_17882,
                                                               sext_i32_i64(segred_group_sizze_18379)),
                                                     sext_i32_i64(max_num_groups_20532))));
    
    struct memblock_device mem_20229;
    
    mem_20229.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20229, 4, "mem_20229")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mainzicounter_mem_20533 =
                           ctx->mainzicounter_mem_20533;
    struct memblock_device group_res_arr_mem_20535;
    
    group_res_arr_mem_20535.references = NULL;
    if (memblock_alloc_device(ctx, &group_res_arr_mem_20535,
                              (int32_t) sizeof(float) *
                              (segred_group_sizze_18379 * num_groups_18381),
                              "group_res_arr_mem_20535")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_threads_20537;
    
    num_threads_20537 = num_groups_18381 * segred_group_sizze_18379;
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegRed");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 1,
                                            (int32_t) sizeof(float) *
                                            segred_group_sizze_18379, NULL));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 2,
                                            (int32_t) sizeof(bool), NULL));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 3,
                                            sizeof(n_17882), &n_17882));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 4,
                                            sizeof(num_groups_18381),
                                            &num_groups_18381));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 5,
                                            sizeof(swap_term_mem_20224.mem),
                                            &swap_term_mem_20224.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 6,
                                            sizeof(payments_mem_20225.mem),
                                            &payments_mem_20225.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 7,
                                            sizeof(mem_20229.mem),
                                            &mem_20229.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 8,
                                            sizeof(mainzicounter_mem_20533.mem),
                                            &mainzicounter_mem_20533.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 9,
                                            sizeof(group_res_arr_mem_20535.mem),
                                            &group_res_arr_mem_20535.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_18386, 10,
                                            sizeof(num_threads_20537),
                                            &num_threads_20537));
    if (1 * ((size_t) num_groups_18381 * (size_t) segred_group_sizze_18379) !=
        0) {
        const size_t global_work_sizze_21385[1] = {(size_t) num_groups_18381 *
                     (size_t) segred_group_sizze_18379};
        const size_t local_work_sizze_21389[1] = {segred_group_sizze_18379};
        int64_t time_start_21386 = 0, time_end_21387 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "main.segred_nonseg_18386");
            fprintf(stderr, "%zu", global_work_sizze_21385[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_21389[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) (0 + (int32_t) sizeof(float) *
                           segred_group_sizze_18379 + (int32_t) sizeof(bool)));
            time_start_21386 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->mainzisegred_nonseg_18386,
                                                        1, NULL,
                                                        global_work_sizze_21385,
                                                        local_work_sizze_21389,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->mainzisegred_nonseg_18386_runs,
                                                                                                  &ctx->mainzisegred_nonseg_18386_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_21387 = get_wall_time();
            
            long time_diff_21388 = time_end_21387 - time_start_21386;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n",
                    "main.segred_nonseg_18386", time_diff_21388);
        }
    }
    
    float read_res_21390;
    
    OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                 mem_20229.mem,
                                                 ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                 0 * sizeof(float),
                                                 sizeof(float), &read_res_21390,
                                                 0, NULL,
                                                 ctx->profiling_paused ||
                                                 !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                           &ctx->copy_scalar_from_dev_runs,
                                                                                           &ctx->copy_scalar_from_dev_total_runtime)));
    if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
        return 1;
    
    float res_17899 = read_res_21390;
    
    if (memblock_unref_device(ctx, &mem_20229, "mem_20229") != 0)
        return 1;
    
    float res_17907 = sitofp_i64_f32(steps_17886);
    float dt_17908 = res_17899 / res_17907;
    float x_17910 = fpow32(a_17890, 2.0F);
    float x_17911 = b_17891 * x_17910;
    float x_17912 = fpow32(sigma_17892, 2.0F);
    float y_17913 = x_17912 / 2.0F;
    float y_17914 = x_17911 - y_17913;
    float y_17915 = 4.0F * a_17890;
    bool suff_outer_par_18388;
    
    suff_outer_par_18388 = ctx->sizes.mainzisuff_outer_par_0 <= n_17882;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_outer_par_0",
                n_17882);
    
    int64_t segmap_group_sizze_18478;
    
    segmap_group_sizze_18478 = ctx->sizes.mainzisegmap_group_sizze_18402;
    
    int64_t segmap_group_sizze_18654;
    
    segmap_group_sizze_18654 = ctx->sizes.mainzisegmap_group_sizze_18578;
    
    int64_t bytes_20230 = 4 * n_17882;
    int64_t bytes_20232 = 8 * n_17882;
    int64_t segred_num_groups_20454;
    
    segred_num_groups_20454 = ctx->sizes.mainzisegred_num_groups_20453;
    
    int64_t segred_group_sizze_20456;
    
    segred_group_sizze_20456 = ctx->sizes.mainzisegred_group_sizze_20455;
    
    int64_t segred_num_groups_20486;
    
    segred_num_groups_20486 = ctx->sizes.mainzisegred_num_groups_20485;
    
    int64_t segred_group_sizze_20488;
    
    segred_group_sizze_20488 = ctx->sizes.mainzisegred_group_sizze_20487;
    
    struct memblock_device res_mem_20276;
    
    res_mem_20276.references = NULL;
    
    struct memblock_device res_mem_20277;
    
    res_mem_20277.references = NULL;
    
    struct memblock_device res_mem_20278;
    
    res_mem_20278.references = NULL;
    
    struct memblock_device res_mem_20279;
    
    res_mem_20279.references = NULL;
    
    int32_t local_memory_capacity_20637;
    
    local_memory_capacity_20637 = ctx->opencl.max_local_memory;
    if ((sle64((int32_t) sizeof(bool) + (int32_t) sizeof(int64_t) *
               segred_group_sizze_20456,
               sext_i32_i64(local_memory_capacity_20637)) && sle64(0,
                                                                   sext_i32_i64(local_memory_capacity_20637))) &&
        suff_outer_par_18388) {
        int64_t segmap_usable_groups_18479 = sdiv_up64(n_17882,
                                                       segmap_group_sizze_18478);
        struct memblock_device mem_20231;
        
        mem_20231.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20231, bytes_20230, "mem_20231")) {
            err = 1;
            goto cleanup;
        }
        if (n_17882 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         swap_term_mem_20224.mem,
                                                         mem_20231.mem, 0, 0,
                                                         n_17882 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_20233;
        
        mem_20233.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20233, bytes_20232, "mem_20233")) {
            err = 1;
            goto cleanup;
        }
        if (n_17882 * (int32_t) sizeof(int64_t) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         payments_mem_20225.mem,
                                                         mem_20233.mem, 0, 0,
                                                         n_17882 *
                                                         (int32_t) sizeof(int64_t),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_20235;
        
        mem_20235.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20235, bytes_20230, "mem_20235")) {
            err = 1;
            goto cleanup;
        }
        if (n_17882 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         notional_mem_20226.mem,
                                                         mem_20235.mem, 0, 0,
                                                         n_17882 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_20252;
        
        mem_20252.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20252, bytes_20230, "mem_20252")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_20444 = segmap_group_sizze_18478 *
                segmap_usable_groups_18479;
        struct memblock_device mem_20472;
        
        mem_20472.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20472, 8, "mem_20472")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mainzicounter_mem_20563 =
                               ctx->mainzicounter_mem_20563;
        struct memblock_device group_res_arr_mem_20565;
        
        group_res_arr_mem_20565.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_20565,
                                  (int32_t) sizeof(int64_t) *
                                  (segred_group_sizze_20456 *
                                   segred_num_groups_20454),
                                  "group_res_arr_mem_20565")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_20567;
        
        num_threads_20567 = segred_num_groups_20454 * segred_group_sizze_20456;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20460,
                                                1, (int32_t) sizeof(int64_t) *
                                                segred_group_sizze_20456,
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20460,
                                                2, (int32_t) sizeof(bool),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20460,
                                                3, sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20460,
                                                4,
                                                sizeof(payments_mem_20225.mem),
                                                &payments_mem_20225.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20460,
                                                5, sizeof(mem_20472.mem),
                                                &mem_20472.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20460,
                                                6,
                                                sizeof(mainzicounter_mem_20563.mem),
                                                &mainzicounter_mem_20563.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20460,
                                                7,
                                                sizeof(group_res_arr_mem_20565.mem),
                                                &group_res_arr_mem_20565.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20460,
                                                8, sizeof(num_threads_20567),
                                                &num_threads_20567));
        if (1 * ((size_t) segred_num_groups_20454 *
                 (size_t) segred_group_sizze_20456) != 0) {
            const size_t global_work_sizze_21392[1] =
                         {(size_t) segred_num_groups_20454 *
                         (size_t) segred_group_sizze_20456};
            const size_t local_work_sizze_21396[1] = {segred_group_sizze_20456};
            int64_t time_start_21393 = 0, time_end_21394 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segred_nonseg_20460");
                fprintf(stderr, "%zu", global_work_sizze_21392[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21396[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + (int32_t) sizeof(int64_t) *
                               segred_group_sizze_20456 +
                               (int32_t) sizeof(bool)));
                time_start_21393 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegred_nonseg_20460,
                                                            1, NULL,
                                                            global_work_sizze_21392,
                                                            local_work_sizze_21396,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegred_nonseg_20460_runs,
                                                                                                      &ctx->mainzisegred_nonseg_20460_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21394 = get_wall_time();
                
                long time_diff_21395 = time_end_21394 - time_start_21393;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segred_nonseg_20460", time_diff_21395);
            }
        }
        
        int64_t read_res_21397;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_20472.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0 * sizeof(int64_t),
                                                     sizeof(int64_t),
                                                     &read_res_21397, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        int64_t max_per_thread_20450 = read_res_21397;
        
        if (memblock_unref_device(ctx, &mem_20472, "mem_20472") != 0)
            return 1;
        
        int64_t sizze_sum_20467 = num_threads_20444 * max_per_thread_20450;
        struct memblock_device mem_20238;
        
        mem_20238.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20238, sizze_sum_20467,
                                  "mem_20238")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 3,
                                                sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 4,
                                                sizeof(a_17890), &a_17890));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 5,
                                                sizeof(r0_17893), &r0_17893));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 6,
                                                sizeof(x_17910), &x_17910));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 7,
                                                sizeof(x_17912), &x_17912));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 8,
                                                sizeof(y_17914), &y_17914));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 9,
                                                sizeof(y_17915), &y_17915));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 10,
                                                sizeof(swap_term_mem_20224.mem),
                                                &swap_term_mem_20224.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 11,
                                                sizeof(payments_mem_20225.mem),
                                                &payments_mem_20225.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 12,
                                                sizeof(mem_20238.mem),
                                                &mem_20238.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 13,
                                                sizeof(mem_20252.mem),
                                                &mem_20252.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18400, 14,
                                                sizeof(num_threads_20444),
                                                &num_threads_20444));
        if (1 * ((size_t) segmap_usable_groups_18479 *
                 (size_t) segmap_group_sizze_18478) != 0) {
            const size_t global_work_sizze_21398[1] =
                         {(size_t) segmap_usable_groups_18479 *
                         (size_t) segmap_group_sizze_18478};
            const size_t local_work_sizze_21402[1] = {segmap_group_sizze_18478};
            int64_t time_start_21399 = 0, time_end_21400 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_18400");
                fprintf(stderr, "%zu", global_work_sizze_21398[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21402[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21399 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_18400,
                                                            1, NULL,
                                                            global_work_sizze_21398,
                                                            local_work_sizze_21402,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_18400_runs,
                                                                                                      &ctx->mainzisegmap_18400_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21400 = get_wall_time();
                
                long time_diff_21401 = time_end_21400 - time_start_21399;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_18400", time_diff_21401);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_unref_device(ctx, &mem_20238, "mem_20238") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20276, &mem_20252, "mem_20252") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20277, &mem_20235, "mem_20235") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20278, &mem_20233, "mem_20233") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20279, &mem_20231, "mem_20231") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20238, "mem_20238") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20565,
                                  "group_res_arr_mem_20565") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20472, "mem_20472") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20252, "mem_20252") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20235, "mem_20235") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20233, "mem_20233") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20231, "mem_20231") != 0)
            return 1;
    } else {
        int64_t segmap_usable_groups_18655 = sdiv_up64(n_17882,
                                                       segmap_group_sizze_18654);
        struct memblock_device mem_20254;
        
        mem_20254.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20254, bytes_20230, "mem_20254")) {
            err = 1;
            goto cleanup;
        }
        if (n_17882 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         swap_term_mem_20224.mem,
                                                         mem_20254.mem, 0, 0,
                                                         n_17882 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_20256;
        
        mem_20256.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20256, bytes_20232, "mem_20256")) {
            err = 1;
            goto cleanup;
        }
        if (n_17882 * (int32_t) sizeof(int64_t) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         payments_mem_20225.mem,
                                                         mem_20256.mem, 0, 0,
                                                         n_17882 *
                                                         (int32_t) sizeof(int64_t),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_20258;
        
        mem_20258.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20258, bytes_20230, "mem_20258")) {
            err = 1;
            goto cleanup;
        }
        if (n_17882 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         notional_mem_20226.mem,
                                                         mem_20258.mem, 0, 0,
                                                         n_17882 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_20275;
        
        mem_20275.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20275, bytes_20230, "mem_20275")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_20476 = segmap_group_sizze_18654 *
                segmap_usable_groups_18655;
        struct memblock_device mem_20504;
        
        mem_20504.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20504, 8, "mem_20504")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mainzicounter_mem_20600 =
                               ctx->mainzicounter_mem_20600;
        struct memblock_device group_res_arr_mem_20602;
        
        group_res_arr_mem_20602.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_20602,
                                  (int32_t) sizeof(int64_t) *
                                  (segred_group_sizze_20488 *
                                   segred_num_groups_20486),
                                  "group_res_arr_mem_20602")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_20604;
        
        num_threads_20604 = segred_num_groups_20486 * segred_group_sizze_20488;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20492,
                                                1, (int32_t) sizeof(int64_t) *
                                                segred_group_sizze_20488,
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20492,
                                                2, (int32_t) sizeof(bool),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20492,
                                                3, sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20492,
                                                4,
                                                sizeof(payments_mem_20225.mem),
                                                &payments_mem_20225.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20492,
                                                5, sizeof(mem_20504.mem),
                                                &mem_20504.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20492,
                                                6,
                                                sizeof(mainzicounter_mem_20600.mem),
                                                &mainzicounter_mem_20600.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20492,
                                                7,
                                                sizeof(group_res_arr_mem_20602.mem),
                                                &group_res_arr_mem_20602.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_20492,
                                                8, sizeof(num_threads_20604),
                                                &num_threads_20604));
        if (1 * ((size_t) segred_num_groups_20486 *
                 (size_t) segred_group_sizze_20488) != 0) {
            const size_t global_work_sizze_21404[1] =
                         {(size_t) segred_num_groups_20486 *
                         (size_t) segred_group_sizze_20488};
            const size_t local_work_sizze_21408[1] = {segred_group_sizze_20488};
            int64_t time_start_21405 = 0, time_end_21406 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segred_nonseg_20492");
                fprintf(stderr, "%zu", global_work_sizze_21404[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21408[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + (int32_t) sizeof(int64_t) *
                               segred_group_sizze_20488 +
                               (int32_t) sizeof(bool)));
                time_start_21405 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegred_nonseg_20492,
                                                            1, NULL,
                                                            global_work_sizze_21404,
                                                            local_work_sizze_21408,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegred_nonseg_20492_runs,
                                                                                                      &ctx->mainzisegred_nonseg_20492_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21406 = get_wall_time();
                
                long time_diff_21407 = time_end_21406 - time_start_21405;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segred_nonseg_20492", time_diff_21407);
            }
        }
        
        int64_t read_res_21409;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_20504.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0 * sizeof(int64_t),
                                                     sizeof(int64_t),
                                                     &read_res_21409, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        int64_t max_per_thread_20482 = read_res_21409;
        
        if (memblock_unref_device(ctx, &mem_20504, "mem_20504") != 0)
            return 1;
        
        int64_t sizze_sum_20499 = num_threads_20476 * max_per_thread_20482;
        struct memblock_device mem_20261;
        
        mem_20261.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20261, sizze_sum_20499,
                                  "mem_20261")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 3,
                                                sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 4,
                                                sizeof(a_17890), &a_17890));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 5,
                                                sizeof(r0_17893), &r0_17893));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 6,
                                                sizeof(x_17910), &x_17910));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 7,
                                                sizeof(x_17912), &x_17912));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 8,
                                                sizeof(y_17914), &y_17914));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 9,
                                                sizeof(y_17915), &y_17915));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 10,
                                                sizeof(swap_term_mem_20224.mem),
                                                &swap_term_mem_20224.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 11,
                                                sizeof(payments_mem_20225.mem),
                                                &payments_mem_20225.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 12,
                                                sizeof(mem_20261.mem),
                                                &mem_20261.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 13,
                                                sizeof(mem_20275.mem),
                                                &mem_20275.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_18576, 14,
                                                sizeof(num_threads_20476),
                                                &num_threads_20476));
        if (1 * ((size_t) segmap_usable_groups_18655 *
                 (size_t) segmap_group_sizze_18654) != 0) {
            const size_t global_work_sizze_21410[1] =
                         {(size_t) segmap_usable_groups_18655 *
                         (size_t) segmap_group_sizze_18654};
            const size_t local_work_sizze_21414[1] = {segmap_group_sizze_18654};
            int64_t time_start_21411 = 0, time_end_21412 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_18576");
                fprintf(stderr, "%zu", global_work_sizze_21410[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21414[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21411 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_18576,
                                                            1, NULL,
                                                            global_work_sizze_21410,
                                                            local_work_sizze_21414,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_18576_runs,
                                                                                                      &ctx->mainzisegmap_18576_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21412 = get_wall_time();
                
                long time_diff_21413 = time_end_21412 - time_start_21411;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_18576", time_diff_21413);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_unref_device(ctx, &mem_20261, "mem_20261") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20276, &mem_20275, "mem_20275") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20277, &mem_20258, "mem_20258") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20278, &mem_20256, "mem_20256") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20279, &mem_20254, "mem_20254") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20261, "mem_20261") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20602,
                                  "group_res_arr_mem_20602") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20504, "mem_20504") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20275, "mem_20275") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20258, "mem_20258") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20256, "mem_20256") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20254, "mem_20254") != 0)
            return 1;
    }
    
    float sims_per_year_17992 = res_17907 / res_17899;
    bool bounds_invalid_upwards_17993 = slt64(steps_17886, 1);
    bool valid_17994 = !bounds_invalid_upwards_17993;
    bool range_valid_c_17995;
    
    if (!valid_17994) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 1, "..", 2, "...", steps_17886,
                               " is invalid.",
                               "-> #0  cva.fut:60:56-67\n   #1  cva.fut:118:17-44\n   #2  cva.fut:107:1-181:20\n");
        if (memblock_unref_device(ctx, &res_mem_20279, "res_mem_20279") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20278, "res_mem_20278") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20277, "res_mem_20277") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20276, "res_mem_20276") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20535,
                                  "group_res_arr_mem_20535") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20229, "mem_20229") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_20530, "out_mem_20530") != 0)
            return 1;
        return 1;
    }
    
    bool bounds_invalid_upwards_18001 = slt64(paths_17885, 0);
    bool valid_18002 = !bounds_invalid_upwards_18001;
    bool range_valid_c_18003;
    
    if (!valid_18002) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", paths_17885,
                               " is invalid.",
                               "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:126:11-16\n   #2  lib/github.com/diku-dk/cpprandom/random.fut:174:8-56\n   #3  cva.fut:122:19-49\n   #4  cva.fut:107:1-181:20\n");
        if (memblock_unref_device(ctx, &res_mem_20279, "res_mem_20279") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20278, "res_mem_20278") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20277, "res_mem_20277") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20276, "res_mem_20276") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20535,
                                  "group_res_arr_mem_20535") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20229, "mem_20229") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_20530, "out_mem_20530") != 0)
            return 1;
        return 1;
    }
    
    int64_t upper_bound_18006 = sub64(steps_17886, 1);
    float res_18007;
    
    res_18007 = futrts_sqrt32(dt_17908);
    
    int64_t one_intra_par_min_18814 = n_17882 * steps_17886;
    int64_t intra_avail_par_18816 = smin64(steps_17886,
                                           one_intra_par_min_18814);
    int64_t computed_group_sizze_18774 = smax64(steps_17886,
                                                one_intra_par_min_18814);
    int64_t max_group_sizze_18966;
    
    max_group_sizze_18966 = ctx->opencl.max_group_size;
    
    bool fits_18967 = sle64(computed_group_sizze_18774, max_group_sizze_18966);
    bool suff_intra_par_18965;
    
    suff_intra_par_18965 = ctx->sizes.mainzisuff_intra_par_3 <=
        intra_avail_par_18816;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_intra_par_3",
                intra_avail_par_18816);
    
    bool intra_suff_and_fits_18968 = suff_intra_par_18965 && fits_18967;
    int64_t segmap_group_sizze_19354;
    
    segmap_group_sizze_19354 = ctx->sizes.mainzisegmap_group_sizze_19337;
    
    int64_t nest_sizze_19378 = paths_17885 * steps_17886;
    int64_t segmap_group_sizze_19379;
    
    segmap_group_sizze_19379 = ctx->sizes.mainzisegmap_group_sizze_19274;
    
    int64_t segmap_group_sizze_19424;
    
    segmap_group_sizze_19424 = ctx->sizes.mainzisegmap_group_sizze_19175;
    
    int64_t num_groups_19425;
    int32_t max_num_groups_20638;
    
    max_num_groups_20638 = ctx->sizes.mainzisegmap_num_groups_19177;
    num_groups_19425 = sext_i64_i32(smax64(1, smin64(sdiv_up64(paths_17885,
                                                               sext_i32_i64(segmap_group_sizze_19424)),
                                                     sext_i32_i64(max_num_groups_20638))));
    
    int64_t nest_sizze_19469 = paths_17885 * one_intra_par_min_18814;
    int64_t segmap_group_sizze_19470;
    
    segmap_group_sizze_19470 = ctx->sizes.mainzisegmap_group_sizze_19120;
    
    int64_t segmap_group_sizze_19488;
    
    segmap_group_sizze_19488 = ctx->sizes.mainzisegmap_group_sizze_19082;
    
    int64_t binop_x_20308 = n_17882 * nest_sizze_19378;
    int64_t bytes_20306 = 4 * binop_x_20308;
    int64_t bytes_20282 = 4 * steps_17886;
    int64_t bytes_20299 = 4 * one_intra_par_min_18814;
    int64_t bytes_20315 = 4 * paths_17885;
    int64_t bytes_20318 = 4 * nest_sizze_19378;
    int64_t num_threads_20511 = segmap_group_sizze_19424 * num_groups_19425;
    int64_t total_sizze_20512 = bytes_20282 * num_threads_20511;
    struct memblock_device res_mem_20352;
    
    res_mem_20352.references = NULL;
    
    struct memblock_device res_mem_20353;
    
    res_mem_20353.references = NULL;
    
    int32_t local_memory_capacity_20682;
    
    local_memory_capacity_20682 = ctx->opencl.max_local_memory;
    if (sle64(bytes_20282 + bytes_20282 + bytes_20299 + bytes_20299,
              sext_i32_i64(local_memory_capacity_20682)) &&
        intra_suff_and_fits_18968) {
        struct memblock_device mem_20309;
        
        mem_20309.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20309, bytes_20306, "mem_20309")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_20313;
        
        mem_20313.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20313, bytes_20306, "mem_20313")) {
            err = 1;
            goto cleanup;
        }
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                3, bytes_20299, NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                4, bytes_20299, NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                5, bytes_20282, NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                6, bytes_20282, NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                7, sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                8, sizeof(steps_17886),
                                                &steps_17886));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                9, sizeof(a_17890), &a_17890));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                10, sizeof(b_17891), &b_17891));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                11, sizeof(sigma_17892),
                                                &sigma_17892));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                12, sizeof(r0_17893),
                                                &r0_17893));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                13, sizeof(dt_17908),
                                                &dt_17908));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                14, sizeof(sims_per_year_17992),
                                                &sims_per_year_17992));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                15, sizeof(upper_bound_18006),
                                                &upper_bound_18006));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                16, sizeof(res_18007),
                                                &res_18007));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                17,
                                                sizeof(computed_group_sizze_18774),
                                                &computed_group_sizze_18774));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                18, sizeof(mem_20309.mem),
                                                &mem_20309.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_18817,
                                                19, sizeof(mem_20313.mem),
                                                &mem_20313.mem));
        if (1 * ((size_t) paths_17885 * (size_t) computed_group_sizze_18774) !=
            0) {
            const size_t global_work_sizze_21415[1] = {(size_t) paths_17885 *
                         (size_t) computed_group_sizze_18774};
            const size_t local_work_sizze_21419[1] =
                         {computed_group_sizze_18774};
            int64_t time_start_21416 = 0, time_end_21417 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_intragroup_18817");
                fprintf(stderr, "%zu", global_work_sizze_21415[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21419[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + bytes_20299 + bytes_20299 + bytes_20282 +
                               bytes_20282));
                time_start_21416 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_intragroup_18817,
                                                            1, NULL,
                                                            global_work_sizze_21415,
                                                            local_work_sizze_21419,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_intragroup_18817_runs,
                                                                                                      &ctx->mainzisegmap_intragroup_18817_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21417 = get_wall_time();
                
                long time_diff_21418 = time_end_21417 - time_start_21416;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_intragroup_18817", time_diff_21418);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_set_device(ctx, &res_mem_20352, &mem_20309, "mem_20309") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20353, &mem_20313, "mem_20313") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20313, "mem_20313") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20309, "mem_20309") != 0)
            return 1;
    } else {
        int64_t segmap_usable_groups_19355 = sdiv_up64(paths_17885,
                                                       segmap_group_sizze_19354);
        struct memblock_device mem_20316;
        
        mem_20316.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20316, bytes_20315, "mem_20316")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19335, 1,
                                                sizeof(paths_17885),
                                                &paths_17885));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19335, 2,
                                                sizeof(mem_20316.mem),
                                                &mem_20316.mem));
        if (1 * ((size_t) segmap_usable_groups_19355 *
                 (size_t) segmap_group_sizze_19354) != 0) {
            const size_t global_work_sizze_21420[1] =
                         {(size_t) segmap_usable_groups_19355 *
                         (size_t) segmap_group_sizze_19354};
            const size_t local_work_sizze_21424[1] = {segmap_group_sizze_19354};
            int64_t time_start_21421 = 0, time_end_21422 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_19335");
                fprintf(stderr, "%zu", global_work_sizze_21420[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21424[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21421 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_19335,
                                                            1, NULL,
                                                            global_work_sizze_21420,
                                                            local_work_sizze_21424,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_19335_runs,
                                                                                                      &ctx->mainzisegmap_19335_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21422 = get_wall_time();
                
                long time_diff_21423 = time_end_21422 - time_start_21421;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_19335", time_diff_21423);
            }
        }
        
        int64_t segmap_usable_groups_19380 = sdiv_up64(nest_sizze_19378,
                                                       segmap_group_sizze_19379);
        struct memblock_device mem_20320;
        
        mem_20320.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20320, bytes_20318, "mem_20320")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19271, 1,
                                                sizeof(paths_17885),
                                                &paths_17885));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19271, 2,
                                                sizeof(steps_17886),
                                                &steps_17886));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19271, 3,
                                                sizeof(mem_20316.mem),
                                                &mem_20316.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19271, 4,
                                                sizeof(mem_20320.mem),
                                                &mem_20320.mem));
        if (1 * ((size_t) segmap_usable_groups_19380 *
                 (size_t) segmap_group_sizze_19379) != 0) {
            const size_t global_work_sizze_21425[1] =
                         {(size_t) segmap_usable_groups_19380 *
                         (size_t) segmap_group_sizze_19379};
            const size_t local_work_sizze_21429[1] = {segmap_group_sizze_19379};
            int64_t time_start_21426 = 0, time_end_21427 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_19271");
                fprintf(stderr, "%zu", global_work_sizze_21425[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21429[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21426 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_19271,
                                                            1, NULL,
                                                            global_work_sizze_21425,
                                                            local_work_sizze_21429,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_19271_runs,
                                                                                                      &ctx->mainzisegmap_19271_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21427 = get_wall_time();
                
                long time_diff_21428 = time_end_21427 - time_start_21426;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_19271", time_diff_21428);
            }
        }
        if (memblock_unref_device(ctx, &mem_20316, "mem_20316") != 0)
            return 1;
        
        struct memblock_device mem_20323;
        
        mem_20323.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20323, bytes_20318, "mem_20323")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_20323, 0, mem_20320,
                                                  0, 1, steps_17886,
                                                  paths_17885) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_unref_device(ctx, &mem_20320, "mem_20320") != 0)
            return 1;
        
        struct memblock_device mem_20341;
        
        mem_20341.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20341, bytes_20318, "mem_20341")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_20326;
        
        mem_20326.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20326, total_sizze_20512,
                                  "mem_20326")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 3,
                                                sizeof(paths_17885),
                                                &paths_17885));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 4,
                                                sizeof(steps_17886),
                                                &steps_17886));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 5,
                                                sizeof(a_17890), &a_17890));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 6,
                                                sizeof(b_17891), &b_17891));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 7,
                                                sizeof(sigma_17892),
                                                &sigma_17892));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 8,
                                                sizeof(r0_17893), &r0_17893));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 9,
                                                sizeof(dt_17908), &dt_17908));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 10,
                                                sizeof(upper_bound_18006),
                                                &upper_bound_18006));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 11,
                                                sizeof(res_18007), &res_18007));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 12,
                                                sizeof(num_groups_19425),
                                                &num_groups_19425));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 13,
                                                sizeof(mem_20323.mem),
                                                &mem_20323.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 14,
                                                sizeof(mem_20326.mem),
                                                &mem_20326.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19173, 15,
                                                sizeof(mem_20341.mem),
                                                &mem_20341.mem));
        if (1 * ((size_t) num_groups_19425 *
                 (size_t) segmap_group_sizze_19424) != 0) {
            const size_t global_work_sizze_21430[1] =
                         {(size_t) num_groups_19425 *
                         (size_t) segmap_group_sizze_19424};
            const size_t local_work_sizze_21434[1] = {segmap_group_sizze_19424};
            int64_t time_start_21431 = 0, time_end_21432 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_19173");
                fprintf(stderr, "%zu", global_work_sizze_21430[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21434[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21431 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_19173,
                                                            1, NULL,
                                                            global_work_sizze_21430,
                                                            local_work_sizze_21434,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_19173_runs,
                                                                                                      &ctx->mainzisegmap_19173_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21432 = get_wall_time();
                
                long time_diff_21433 = time_end_21432 - time_start_21431;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_19173", time_diff_21433);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_unref_device(ctx, &mem_20323, "mem_20323") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20326, "mem_20326") != 0)
            return 1;
        
        int64_t segmap_usable_groups_19471 = sdiv_up64(nest_sizze_19469,
                                                       segmap_group_sizze_19470);
        struct memblock_device mem_20346;
        
        mem_20346.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20346, bytes_20306, "mem_20346")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19116, 1,
                                                sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19116, 2,
                                                sizeof(paths_17885),
                                                &paths_17885));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19116, 3,
                                                sizeof(steps_17886),
                                                &steps_17886));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19116, 4,
                                                sizeof(mem_20341.mem),
                                                &mem_20341.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19116, 5,
                                                sizeof(mem_20346.mem),
                                                &mem_20346.mem));
        if (1 * ((size_t) segmap_usable_groups_19471 *
                 (size_t) segmap_group_sizze_19470) != 0) {
            const size_t global_work_sizze_21435[1] =
                         {(size_t) segmap_usable_groups_19471 *
                         (size_t) segmap_group_sizze_19470};
            const size_t local_work_sizze_21439[1] = {segmap_group_sizze_19470};
            int64_t time_start_21436 = 0, time_end_21437 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_19116");
                fprintf(stderr, "%zu", global_work_sizze_21435[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21439[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21436 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_19116,
                                                            1, NULL,
                                                            global_work_sizze_21435,
                                                            local_work_sizze_21439,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_19116_runs,
                                                                                                      &ctx->mainzisegmap_19116_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21437 = get_wall_time();
                
                long time_diff_21438 = time_end_21437 - time_start_21436;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_19116", time_diff_21438);
            }
        }
        if (memblock_unref_device(ctx, &mem_20341, "mem_20341") != 0)
            return 1;
        
        int64_t segmap_usable_groups_19489 = sdiv_up64(nest_sizze_19469,
                                                       segmap_group_sizze_19488);
        struct memblock_device mem_20351;
        
        mem_20351.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20351, bytes_20306, "mem_20351")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19078, 1,
                                                sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19078, 2,
                                                sizeof(paths_17885),
                                                &paths_17885));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19078, 3,
                                                sizeof(steps_17886),
                                                &steps_17886));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19078, 4,
                                                sizeof(sims_per_year_17992),
                                                &sims_per_year_17992));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19078, 5,
                                                sizeof(mem_20351.mem),
                                                &mem_20351.mem));
        if (1 * ((size_t) segmap_usable_groups_19489 *
                 (size_t) segmap_group_sizze_19488) != 0) {
            const size_t global_work_sizze_21440[1] =
                         {(size_t) segmap_usable_groups_19489 *
                         (size_t) segmap_group_sizze_19488};
            const size_t local_work_sizze_21444[1] = {segmap_group_sizze_19488};
            int64_t time_start_21441 = 0, time_end_21442 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_19078");
                fprintf(stderr, "%zu", global_work_sizze_21440[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21444[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21441 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_19078,
                                                            1, NULL,
                                                            global_work_sizze_21440,
                                                            local_work_sizze_21444,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_19078_runs,
                                                                                                      &ctx->mainzisegmap_19078_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21442 = get_wall_time();
                
                long time_diff_21443 = time_end_21442 - time_start_21441;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_19078", time_diff_21443);
            }
        }
        if (memblock_set_device(ctx, &res_mem_20352, &mem_20346, "mem_20346") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20353, &mem_20351, "mem_20351") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20351, "mem_20351") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20346, "mem_20346") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20326, "mem_20326") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20341, "mem_20341") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20323, "mem_20323") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20320, "mem_20320") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20316, "mem_20316") != 0)
            return 1;
    }
    
    int64_t segscan_group_sizze_19500;
    
    segscan_group_sizze_19500 = ctx->sizes.mainzisegscan_group_sizze_19499;
    
    int64_t num_groups_19502;
    int32_t max_num_groups_20683;
    
    max_num_groups_20683 = ctx->sizes.mainzisegscan_num_groups_19501;
    num_groups_19502 = sext_i64_i32(smax64(1, smin64(sdiv_up64(binop_x_20308,
                                                               sext_i32_i64(segscan_group_sizze_19500)),
                                                     sext_i32_i64(max_num_groups_20683))));
    
    int64_t bytes_20355 = 8 * binop_x_20308;
    struct memblock_device mem_20356;
    
    mem_20356.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20356, bytes_20355, "mem_20356")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_20358;
    
    mem_20358.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20358, bytes_20355, "mem_20358")) {
        err = 1;
        goto cleanup;
    }
    if (slt64(0, binop_x_20308)) {
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegScan");
        
        int64_t stage1_max_num_groups_20684;
        
        stage1_max_num_groups_20684 = ctx->opencl.max_group_size;
        
        int64_t stage1_num_groups_20685;
        
        stage1_num_groups_20685 = smin64(stage1_max_num_groups_20684,
                                         num_groups_19502);
        
        int32_t num_threads_20686;
        
        num_threads_20686 = sext_i64_i32(stage1_num_groups_20685 *
            segscan_group_sizze_19500);
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(int64_t) *
                                                       segscan_group_sizze_19500),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505, 2,
                                                sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505, 3,
                                                sizeof(steps_17886),
                                                &steps_17886));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505, 4,
                                                sizeof(one_intra_par_min_18814),
                                                &one_intra_par_min_18814));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505, 5,
                                                sizeof(res_mem_20278.mem),
                                                &res_mem_20278.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505, 6,
                                                sizeof(res_mem_20279.mem),
                                                &res_mem_20279.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505, 7,
                                                sizeof(binop_x_20308),
                                                &binop_x_20308));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505, 8,
                                                sizeof(res_mem_20353.mem),
                                                &res_mem_20353.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505, 9,
                                                sizeof(mem_20356.mem),
                                                &mem_20356.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505,
                                                10, sizeof(mem_20358.mem),
                                                &mem_20358.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19505,
                                                11, sizeof(num_threads_20686),
                                                &num_threads_20686));
        if (1 * ((size_t) stage1_num_groups_20685 *
                 (size_t) segscan_group_sizze_19500) != 0) {
            const size_t global_work_sizze_21445[1] =
                         {(size_t) stage1_num_groups_20685 *
                         (size_t) segscan_group_sizze_19500};
            const size_t local_work_sizze_21449[1] =
                         {segscan_group_sizze_19500};
            int64_t time_start_21446 = 0, time_end_21447 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage1_19505");
                fprintf(stderr, "%zu", global_work_sizze_21445[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21449[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                          segscan_group_sizze_19500)));
                time_start_21446 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage1_19505,
                                                            1, NULL,
                                                            global_work_sizze_21445,
                                                            local_work_sizze_21449,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage1_19505_runs,
                                                                                                      &ctx->mainziscan_stage1_19505_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21447 = get_wall_time();
                
                long time_diff_21448 = time_end_21447 - time_start_21446;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage1_19505", time_diff_21448);
            }
        }
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "elems_per_group",
                    (long long) (segscan_group_sizze_19500 *
                                 sdiv_up64(binop_x_20308,
                                           sext_i32_i64(num_threads_20686))),
                    '\n');
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19505, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(int64_t) *
                                                       stage1_num_groups_20685),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19505, 2,
                                                sizeof(binop_x_20308),
                                                &binop_x_20308));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19505, 3,
                                                sizeof(mem_20356.mem),
                                                &mem_20356.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19505, 4,
                                                sizeof(stage1_num_groups_20685),
                                                &stage1_num_groups_20685));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19505, 5,
                                                sizeof(num_threads_20686),
                                                &num_threads_20686));
        if (1 * ((size_t) 1 * (size_t) stage1_num_groups_20685) != 0) {
            const size_t global_work_sizze_21450[1] = {(size_t) 1 *
                         (size_t) stage1_num_groups_20685};
            const size_t local_work_sizze_21454[1] = {stage1_num_groups_20685};
            int64_t time_start_21451 = 0, time_end_21452 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage2_19505");
                fprintf(stderr, "%zu", global_work_sizze_21450[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21454[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                          stage1_num_groups_20685)));
                time_start_21451 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage2_19505,
                                                            1, NULL,
                                                            global_work_sizze_21450,
                                                            local_work_sizze_21454,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage2_19505_runs,
                                                                                                      &ctx->mainziscan_stage2_19505_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21452 = get_wall_time();
                
                long time_diff_21453 = time_end_21452 - time_start_21451;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage2_19505", time_diff_21453);
            }
        }
        
        int32_t required_groups_20722;
        
        required_groups_20722 = sext_i64_i32(sdiv_up64(binop_x_20308,
                                                       segscan_group_sizze_19500));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19505, 1,
                                                sizeof(num_groups_19502),
                                                &num_groups_19502));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19505, 2,
                                                sizeof(binop_x_20308),
                                                &binop_x_20308));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19505, 3,
                                                sizeof(mem_20356.mem),
                                                &mem_20356.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19505, 4,
                                                sizeof(num_threads_20686),
                                                &num_threads_20686));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19505, 5,
                                                sizeof(required_groups_20722),
                                                &required_groups_20722));
        if (1 * ((size_t) num_groups_19502 *
                 (size_t) segscan_group_sizze_19500) != 0) {
            const size_t global_work_sizze_21455[1] =
                         {(size_t) num_groups_19502 *
                         (size_t) segscan_group_sizze_19500};
            const size_t local_work_sizze_21459[1] =
                         {segscan_group_sizze_19500};
            int64_t time_start_21456 = 0, time_end_21457 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage3_19505");
                fprintf(stderr, "%zu", global_work_sizze_21455[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21459[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21456 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage3_19505,
                                                            1, NULL,
                                                            global_work_sizze_21455,
                                                            local_work_sizze_21459,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage3_19505_runs,
                                                                                                      &ctx->mainziscan_stage3_19505_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21457 = get_wall_time();
                
                long time_diff_21458 = time_end_21457 - time_start_21456;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage3_19505", time_diff_21458);
            }
        }
    }
    
    int64_t segred_group_sizze_19508;
    
    segred_group_sizze_19508 = ctx->sizes.mainzisegred_group_sizze_19507;
    
    int64_t num_groups_19510;
    int32_t max_num_groups_20734;
    
    max_num_groups_20734 = ctx->sizes.mainzisegred_num_groups_19509;
    num_groups_19510 = sext_i64_i32(smax64(1, smin64(sdiv_up64(binop_x_20308,
                                                               sext_i32_i64(segred_group_sizze_19508)),
                                                     sext_i32_i64(max_num_groups_20734))));
    
    struct memblock_device mem_20361;
    
    mem_20361.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20361, 8, "mem_20361")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mainzicounter_mem_20735 =
                           ctx->mainzicounter_mem_20735;
    struct memblock_device group_res_arr_mem_20737;
    
    group_res_arr_mem_20737.references = NULL;
    if (memblock_alloc_device(ctx, &group_res_arr_mem_20737,
                              (int32_t) sizeof(int64_t) *
                              (segred_group_sizze_19508 * num_groups_19510),
                              "group_res_arr_mem_20737")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_threads_20739;
    
    num_threads_20739 = num_groups_19510 * segred_group_sizze_19508;
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegRed");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19515, 1,
                                            (int32_t) sizeof(int64_t) *
                                            segred_group_sizze_19508, NULL));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19515, 2,
                                            (int32_t) sizeof(bool), NULL));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19515, 3,
                                            sizeof(num_groups_19510),
                                            &num_groups_19510));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19515, 4,
                                            sizeof(binop_x_20308),
                                            &binop_x_20308));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19515, 5,
                                            sizeof(mem_20358.mem),
                                            &mem_20358.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19515, 6,
                                            sizeof(mem_20361.mem),
                                            &mem_20361.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19515, 7,
                                            sizeof(mainzicounter_mem_20735.mem),
                                            &mainzicounter_mem_20735.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19515, 8,
                                            sizeof(group_res_arr_mem_20737.mem),
                                            &group_res_arr_mem_20737.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19515, 9,
                                            sizeof(num_threads_20739),
                                            &num_threads_20739));
    if (1 * ((size_t) num_groups_19510 * (size_t) segred_group_sizze_19508) !=
        0) {
        const size_t global_work_sizze_21461[1] = {(size_t) num_groups_19510 *
                     (size_t) segred_group_sizze_19508};
        const size_t local_work_sizze_21465[1] = {segred_group_sizze_19508};
        int64_t time_start_21462 = 0, time_end_21463 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "main.segred_nonseg_19515");
            fprintf(stderr, "%zu", global_work_sizze_21461[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_21465[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) (0 + (int32_t) sizeof(int64_t) *
                           segred_group_sizze_19508 + (int32_t) sizeof(bool)));
            time_start_21462 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->mainzisegred_nonseg_19515,
                                                        1, NULL,
                                                        global_work_sizze_21461,
                                                        local_work_sizze_21465,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->mainzisegred_nonseg_19515_runs,
                                                                                                  &ctx->mainzisegred_nonseg_19515_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_21463 = get_wall_time();
            
            long time_diff_21464 = time_end_21463 - time_start_21462;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n",
                    "main.segred_nonseg_19515", time_diff_21464);
        }
    }
    if (memblock_unref_device(ctx, &mem_20358, "mem_20358") != 0)
        return 1;
    
    int64_t read_res_21466;
    
    OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                 mem_20361.mem,
                                                 ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                 0 * sizeof(int64_t),
                                                 sizeof(int64_t),
                                                 &read_res_21466, 0, NULL,
                                                 ctx->profiling_paused ||
                                                 !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                           &ctx->copy_scalar_from_dev_runs,
                                                                                           &ctx->copy_scalar_from_dev_total_runtime)));
    if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
        return 1;
    
    int64_t res_18101 = read_res_21466;
    
    if (memblock_unref_device(ctx, &mem_20361, "mem_20361") != 0)
        return 1;
    
    bool bounds_invalid_upwards_18106 = slt64(res_18101, 0);
    bool valid_18107 = !bounds_invalid_upwards_18106;
    bool range_valid_c_18108;
    
    if (!valid_18107) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", res_18101,
                               " is invalid.",
                               "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:70:18-23\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:48:30-60\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:87:14-32\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:154:18-77\n   #6  cva.fut:107:1-181:20\n");
        if (memblock_unref_device(ctx, &group_res_arr_mem_20737,
                                  "group_res_arr_mem_20737") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20361, "mem_20361") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20358, "mem_20358") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20356, "mem_20356") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20353, "res_mem_20353") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20352, "res_mem_20352") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20279, "res_mem_20279") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20278, "res_mem_20278") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20277, "res_mem_20277") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20276, "res_mem_20276") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20535,
                                  "group_res_arr_mem_20535") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20229, "mem_20229") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_20530, "out_mem_20530") != 0)
            return 1;
        return 1;
    }
    
    int64_t bytes_20362 = 8 * res_18101;
    struct memblock_device mem_20363;
    
    mem_20363.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20363, bytes_20362, "mem_20363")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_20363, res_18101, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t seghist_group_sizze_19518;
    
    seghist_group_sizze_19518 = ctx->sizes.mainziseghist_group_sizze_19517;
    
    int64_t num_groups_19520;
    int32_t max_num_groups_20774;
    
    max_num_groups_20774 = ctx->sizes.mainziseghist_num_groups_19519;
    num_groups_19520 = sext_i64_i32(smax64(1, smin64(sdiv_up64(binop_x_20308,
                                                               sext_i32_i64(seghist_group_sizze_19518)),
                                                     sext_i32_i64(max_num_groups_20774))));
    
    int32_t num_subhistos_20775;
    struct memblock_device res_subhistos_mem_20776;
    
    res_subhistos_mem_20776.references = NULL;
    
    int64_t h_20778;
    
    h_20778 = (int32_t) sizeof(int64_t) * res_18101;
    
    int64_t seg_h_20779;
    
    seg_h_20779 = (int32_t) sizeof(int64_t) * res_18101;
    if (!(seg_h_20779 == 0)) {
        int64_t hist_H_20780 = res_18101;
        int64_t hist_el_sizze_20781 = sdiv_up64(h_20778, hist_H_20780) + 4;
        int64_t hist_N_20782 = binop_x_20308;
        int64_t hist_RF_20783 = 1;
        
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegHist");
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "Number of threads (T)",
                    (long long) sext_i64_i32(num_groups_19520 *
                    seghist_group_sizze_19518), '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "Desired group size (B)",
                    (long long) seghist_group_sizze_19518, '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "Histogram size (H)",
                    (long long) hist_H_20780, '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "Input elements per histogram (N)",
                    (long long) hist_N_20782, '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "Number of segments", (long long) 1,
                    '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "Histogram element size (el_size)",
                    (long long) hist_el_sizze_20781, '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "Race factor (RF)",
                    (long long) hist_RF_20783, '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c",
                    "Memory per set of subhistograms per segment",
                    (long long) h_20778, '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c",
                    "Memory per set of subhistograms times segments",
                    (long long) seg_h_20779, '\n');
        
        int32_t hist_L_20784;
        
        hist_L_20784 = ctx->opencl.max_local_memory;
        
        int32_t max_group_sizze_20785;
        
        max_group_sizze_20785 = ctx->opencl.max_group_size;
        
        int64_t num_groups_20786;
        
        num_groups_20786 =
            sdiv_up64(sext_i32_i64(sext_i64_i32(num_groups_19520 *
                      seghist_group_sizze_19518)), max_group_sizze_20785);
        
        double hist_m_prime_20787;
        
        hist_m_prime_20787 =
            sitofp_i64_f64(smin64(sext_i32_i64(squot32(hist_L_20784,
                                                       hist_el_sizze_20781)),
                                  sdiv_up64(hist_N_20782, num_groups_20786))) /
            sitofp_i64_f64(hist_H_20780);
        
        int64_t hist_M0_20788;
        
        hist_M0_20788 = smax64(1, smin64(fptosi_f64_i64(hist_m_prime_20787),
                                         max_group_sizze_20785));
        
        int64_t hist_Nout_20789;
        
        hist_Nout_20789 = 1;
        
        int64_t hist_Nin_20790;
        
        hist_Nin_20790 = binop_x_20308;
        
        int64_t work_asymp_M_max_20791;
        
        work_asymp_M_max_20791 = squot64(hist_Nout_20789 * hist_N_20782, 2 *
                                         num_groups_20786 * hist_H_20780);
        
        int32_t hist_M_20792;
        
        hist_M_20792 = sext_i64_i32(smin64(hist_M0_20788,
                                           work_asymp_M_max_20791));
        
        int64_t hist_C_20793;
        
        hist_C_20793 = sdiv_up64(max_group_sizze_20785, sext_i32_i64(smax32(1,
                                                                            hist_M_20792)));
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "local hist_M0",
                    (long long) hist_M0_20788, '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "local work asymp M max",
                    (long long) work_asymp_M_max_20791, '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "local C", (long long) hist_C_20793,
                    '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "local B",
                    (long long) max_group_sizze_20785, '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "local M", (long long) hist_M_20792,
                    '\n');
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "local memory needed",
                    (long long) (hist_H_20780 * hist_el_sizze_20781 *
                                 sext_i32_i64(hist_M_20792)), '\n');
        
        int64_t local_mem_needed_20794;
        
        local_mem_needed_20794 = hist_el_sizze_20781 *
            sext_i32_i64(hist_M_20792);
        
        int32_t hist_S_20795;
        
        hist_S_20795 = sext_i64_i32(sdiv_up64(hist_H_20780 *
                                              local_mem_needed_20794,
                                              hist_L_20784));
        if (sle64(hist_H_20780, hist_Nin_20790) &&
            (sle64(local_mem_needed_20794, hist_L_20784) && (sle32(hist_S_20795,
                                                                   6) &&
                                                             (sle64(hist_C_20793,
                                                                    max_group_sizze_20785) &&
                                                              slt32(0,
                                                                    hist_M_20792))))) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "## Using local memory");
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Histogram size (H)",
                        (long long) hist_H_20780, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Multiplication degree (M)",
                        (long long) hist_M_20792, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Cooperation level (C)",
                        (long long) hist_C_20793, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Number of chunks (S)",
                        (long long) hist_S_20795, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Number of local subhistograms per group",
                        (long long) hist_M_20792, '\n');
            
            int64_t num_segments_20796;
            
            num_segments_20796 = 1;
            num_subhistos_20775 = num_groups_20786 * num_segments_20796;
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Number of subhistograms in global memory",
                        (long long) num_subhistos_20775, '\n');
            if (num_subhistos_20775 == 1) {
                if (memblock_set_device(ctx, &res_subhistos_mem_20776,
                                        &mem_20363, "mem_20363") != 0)
                    return 1;
            } else {
                if (memblock_alloc_device(ctx, &res_subhistos_mem_20776,
                                          sext_i32_i64(num_subhistos_20775) *
                                          res_18101 * (int32_t) sizeof(int64_t),
                                          "res_subhistos_mem_20776")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhreplicate_i64(ctx, res_subhistos_mem_20776,
                                                  num_subhistos_20775 *
                                                  res_18101, 0) != 0) {
                    err = 1;
                    goto cleanup;
                }
                if (res_18101 * (int32_t) sizeof(int64_t) > 0) {
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                                 mem_20363.mem,
                                                                 res_subhistos_mem_20776.mem,
                                                                 0, 0,
                                                                 res_18101 *
                                                                 (int32_t) sizeof(int64_t),
                                                                 0, NULL,
                                                                 ctx->profiling_paused ||
                                                                 !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                           &ctx->copy_dev_to_dev_runs,
                                                                                                           &ctx->copy_dev_to_dev_total_runtime)));
                    if (ctx->debugging)
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                }
            }
            for (int32_t chk_i_20797 = 0; chk_i_20797 < hist_S_20795;
                 chk_i_20797++) {
                int64_t num_segments_20798 = 1;
                int64_t hist_H_chk_20799 = sdiv_up64(res_18101,
                                                     sext_i32_i64(hist_S_20795));
                int64_t histo_sizze_20800 = hist_H_chk_20799;
                int32_t init_per_thread_20801 =
                        sext_i64_i32(sdiv_up64(sext_i32_i64(hist_M_20792) *
                                               histo_sizze_20800,
                                               max_group_sizze_20785));
                
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        1,
                                                        (int32_t) sizeof(int32_t) *
                                                        (hist_M_20792 *
                                                         hist_H_chk_20799),
                                                        NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        2,
                                                        (int32_t) sizeof(int64_t) *
                                                        (hist_M_20792 *
                                                         hist_H_chk_20799),
                                                        NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        3, sizeof(res_18101),
                                                        &res_18101));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        4,
                                                        sizeof(binop_x_20308),
                                                        &binop_x_20308));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        5,
                                                        sizeof(mem_20356.mem),
                                                        &mem_20356.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        6,
                                                        sizeof(res_subhistos_mem_20776.mem),
                                                        &res_subhistos_mem_20776.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        7,
                                                        sizeof(max_group_sizze_20785),
                                                        &max_group_sizze_20785));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        8,
                                                        sizeof(num_groups_20786),
                                                        &num_groups_20786));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        9, sizeof(hist_M_20792),
                                                        &hist_M_20792));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        10, sizeof(chk_i_20797),
                                                        &chk_i_20797));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        11,
                                                        sizeof(num_segments_20798),
                                                        &num_segments_20798));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        12,
                                                        sizeof(hist_H_chk_20799),
                                                        &hist_H_chk_20799));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        13,
                                                        sizeof(histo_sizze_20800),
                                                        &histo_sizze_20800));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_19523,
                                                        14,
                                                        sizeof(init_per_thread_20801),
                                                        &init_per_thread_20801));
                if (1 * ((size_t) num_groups_20786 *
                         (size_t) max_group_sizze_20785) != 0) {
                    const size_t global_work_sizze_21467[1] =
                                 {(size_t) num_groups_20786 *
                                 (size_t) max_group_sizze_20785};
                    const size_t local_work_sizze_21471[1] =
                                 {max_group_sizze_20785};
                    int64_t time_start_21468 = 0, time_end_21469 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "main.seghist_local_19523");
                        fprintf(stderr, "%zu", global_work_sizze_21467[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_21471[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) (0 + (int32_t) sizeof(int32_t) *
                                       (hist_M_20792 * hist_H_chk_20799) +
                                       (int32_t) sizeof(int64_t) *
                                       (hist_M_20792 * hist_H_chk_20799)));
                        time_start_21468 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->mainziseghist_local_19523,
                                                                    1, NULL,
                                                                    global_work_sizze_21467,
                                                                    local_work_sizze_21471,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->mainziseghist_local_19523_runs,
                                                                                                              &ctx->mainziseghist_local_19523_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_21469 = get_wall_time();
                        
                        long time_diff_21470 = time_end_21469 -
                             time_start_21468;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "main.seghist_local_19523", time_diff_21470);
                    }
                }
            }
        } else {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "## Using global memory");
            
            int64_t hist_H_20833;
            
            hist_H_20833 = res_18101;
            
            double hist_RF_20834;
            
            hist_RF_20834 = (0.0 + sitofp_i32_f64(1)) / 1.0;
            
            int32_t hist_el_sizze_20835;
            
            hist_el_sizze_20835 =
                squot32(sext_i64_i32((int32_t) sizeof(int32_t) +
                        (int32_t) sizeof(int64_t)), 2);
            
            double hist_C_max_20836;
            
            hist_C_max_20836 =
                fmin64(sitofp_i32_f64(sext_i64_i32(num_groups_19520 *
                       seghist_group_sizze_19518)),
                       sitofp_i32_f64(hist_H_20833) / 2.0);
            
            int32_t hist_M_min_20837;
            
            hist_M_min_20837 = smax32(1,
                                      sext_i64_i32(fptosi_f64_i64(sitofp_i32_f64(sext_i64_i32(num_groups_19520 *
                                      seghist_group_sizze_19518)) /
                                      hist_C_max_20836)));
            
            int32_t L2_sizze_20838;
            
            L2_sizze_20838 = ctx->sizes.mainziL2_sizze_20838;
            
            double hist_RACE_exp_20839;
            
            hist_RACE_exp_20839 = fmax64(1.0, 0.75 * hist_RF_20834 / (64.0 /
                                                                      sitofp_i32_f64(hist_el_sizze_20835)));
            
            int32_t hist_S_20840;
            
            if (slt64(binop_x_20308, hist_H_20833)) {
                hist_S_20840 = 1;
            } else {
                hist_S_20840 =
                    sext_i64_i32(sdiv_up64(sext_i32_i64(hist_M_min_20837) *
                                           hist_H_20833 *
                                           sext_i32_i64(hist_el_sizze_20835),
                                           fptosi_f64_i64(0.4 *
                                           sitofp_i32_f64(L2_sizze_20838) *
                                           hist_RACE_exp_20839)));
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %f%c", "Race expansion factor (RACE^exp)",
                        (double) hist_RACE_exp_20839, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Number of chunks (S)",
                        (long long) hist_S_20840, '\n');
            
            int64_t hist_H_chk_20841;
            
            hist_H_chk_20841 = sdiv_up64(res_18101, sext_i32_i64(hist_S_20840));
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Chunk size (H_chk)",
                        (long long) hist_H_chk_20841, '\n');
            
            double hist_k_max_20842;
            
            hist_k_max_20842 = fmin64(0.4 * (sitofp_i32_f64(L2_sizze_20838) /
                                             sitofp_i32_f64(sext_i64_i32((int32_t) sizeof(int32_t) +
                                             (int32_t) sizeof(int64_t)))) *
                                      hist_RACE_exp_20839,
                                      sitofp_i32_f64(binop_x_20308)) /
                sitofp_i32_f64(sext_i64_i32(num_groups_19520 *
                seghist_group_sizze_19518));
            
            int64_t hist_u_20843;
            
            hist_u_20843 = 1;
            
            double hist_C_20844;
            
            hist_C_20844 = fmin64(sitofp_i32_f64(sext_i64_i32(num_groups_19520 *
                                  seghist_group_sizze_19518)),
                                  sitofp_i32_f64(hist_u_20843 *
                                  hist_H_chk_20841) / hist_k_max_20842);
            
            int32_t hist_M_20845;
            
            hist_M_20845 = smax32(hist_M_min_20837,
                                  sext_i64_i32(fptosi_f64_i64(sitofp_i32_f64(sext_i64_i32(num_groups_19520 *
                                  seghist_group_sizze_19518)) / hist_C_20844)));
            if (ctx->debugging)
                fprintf(stderr, "%s: %f%c",
                        "Elements/thread in L2 cache (k_max)",
                        (double) hist_k_max_20842, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Multiplication degree (M)",
                        (long long) hist_M_20845, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %f%c", "Cooperation level (C)",
                        (double) hist_C_20844, '\n');
            num_subhistos_20775 = sext_i32_i64(hist_M_20845);
            if (hist_M_20845 == 1) {
                if (memblock_set_device(ctx, &res_subhistos_mem_20776,
                                        &mem_20363, "mem_20363") != 0)
                    return 1;
            } else {
                if (num_subhistos_20775 == 1) {
                    if (memblock_set_device(ctx, &res_subhistos_mem_20776,
                                            &mem_20363, "mem_20363") != 0)
                        return 1;
                } else {
                    if (memblock_alloc_device(ctx, &res_subhistos_mem_20776,
                                              sext_i32_i64(num_subhistos_20775) *
                                              res_18101 *
                                              (int32_t) sizeof(int64_t),
                                              "res_subhistos_mem_20776")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (futrts_builtinzhreplicate_i64(ctx,
                                                      res_subhistos_mem_20776,
                                                      num_subhistos_20775 *
                                                      res_18101, 0) != 0) {
                        err = 1;
                        goto cleanup;
                    }
                    if (res_18101 * (int32_t) sizeof(int64_t) > 0) {
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                                     mem_20363.mem,
                                                                     res_subhistos_mem_20776.mem,
                                                                     0, 0,
                                                                     res_18101 *
                                                                     (int32_t) sizeof(int64_t),
                                                                     0, NULL,
                                                                     ctx->profiling_paused ||
                                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
                        if (ctx->debugging)
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    }
                }
            }
            
            struct memblock_device mainzihist_locks_mem_20846 =
                                   ctx->mainzihist_locks_mem_20846;
            
            for (int32_t chk_i_20848 = 0; chk_i_20848 < hist_S_20840;
                 chk_i_20848++) {
                int64_t hist_H_chk_20849 = sdiv_up64(res_18101,
                                                     sext_i32_i64(hist_S_20840));
                
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_19523,
                                                        1, sizeof(res_18101),
                                                        &res_18101));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_19523,
                                                        2,
                                                        sizeof(num_groups_19520),
                                                        &num_groups_19520));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_19523,
                                                        3,
                                                        sizeof(binop_x_20308),
                                                        &binop_x_20308));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_19523,
                                                        4,
                                                        sizeof(mem_20356.mem),
                                                        &mem_20356.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_19523,
                                                        5,
                                                        sizeof(num_subhistos_20775),
                                                        &num_subhistos_20775));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_19523,
                                                        6,
                                                        sizeof(res_subhistos_mem_20776.mem),
                                                        &res_subhistos_mem_20776.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_19523,
                                                        7,
                                                        sizeof(mainzihist_locks_mem_20846.mem),
                                                        &mainzihist_locks_mem_20846.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_19523,
                                                        8, sizeof(chk_i_20848),
                                                        &chk_i_20848));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_19523,
                                                        9,
                                                        sizeof(hist_H_chk_20849),
                                                        &hist_H_chk_20849));
                if (1 * ((size_t) num_groups_19520 *
                         (size_t) seghist_group_sizze_19518) != 0) {
                    const size_t global_work_sizze_21473[1] =
                                 {(size_t) num_groups_19520 *
                                 (size_t) seghist_group_sizze_19518};
                    const size_t local_work_sizze_21477[1] =
                                 {seghist_group_sizze_19518};
                    int64_t time_start_21474 = 0, time_end_21475 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "main.seghist_global_19523");
                        fprintf(stderr, "%zu", global_work_sizze_21473[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_21477[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) 0);
                        time_start_21474 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->mainziseghist_global_19523,
                                                                    1, NULL,
                                                                    global_work_sizze_21473,
                                                                    local_work_sizze_21477,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->mainziseghist_global_19523_runs,
                                                                                                              &ctx->mainziseghist_global_19523_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_21475 = get_wall_time();
                        
                        long time_diff_21476 = time_end_21475 -
                             time_start_21474;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "main.seghist_global_19523", time_diff_21476);
                    }
                }
            }
        }
        if (num_subhistos_20775 == 1) {
            if (memblock_set_device(ctx, &mem_20363, &res_subhistos_mem_20776,
                                    "res_subhistos_mem_20776") != 0)
                return 1;
        } else {
            if (slt64(num_subhistos_20775 * 2, seghist_group_sizze_19518)) {
                int64_t segment_sizze_nonzzero_20862 = smax64(1,
                                                              num_subhistos_20775);
                int64_t num_threads_20863 = num_groups_19520 *
                        seghist_group_sizze_19518;
                
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegRed-small");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_segments",
                            (long long) res_18101, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segment_size",
                            (long long) num_subhistos_20775, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segments_per_group",
                            (long long) squot64(seghist_group_sizze_19518,
                                                segment_sizze_nonzzero_20862),
                            '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "required_groups",
                            (long long) sext_i64_i32(sdiv_up64(res_18101,
                                                               squot64(seghist_group_sizze_19518,
                                                                       segment_sizze_nonzzero_20862))),
                            '\n');
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20861,
                                                        1,
                                                        (int32_t) sizeof(int64_t) *
                                                        seghist_group_sizze_19518,
                                                        NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20861,
                                                        2, sizeof(res_18101),
                                                        &res_18101));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20861,
                                                        3,
                                                        sizeof(num_groups_19520),
                                                        &num_groups_19520));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20861,
                                                        4,
                                                        sizeof(mem_20363.mem),
                                                        &mem_20363.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20861,
                                                        5,
                                                        sizeof(num_subhistos_20775),
                                                        &num_subhistos_20775));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20861,
                                                        6,
                                                        sizeof(res_subhistos_mem_20776.mem),
                                                        &res_subhistos_mem_20776.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_20861,
                                                        7,
                                                        sizeof(segment_sizze_nonzzero_20862),
                                                        &segment_sizze_nonzzero_20862));
                if (1 * ((size_t) num_groups_19520 *
                         (size_t) seghist_group_sizze_19518) != 0) {
                    const size_t global_work_sizze_21478[1] =
                                 {(size_t) num_groups_19520 *
                                 (size_t) seghist_group_sizze_19518};
                    const size_t local_work_sizze_21482[1] =
                                 {seghist_group_sizze_19518};
                    int64_t time_start_21479 = 0, time_end_21480 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "main.segred_small_20861");
                        fprintf(stderr, "%zu", global_work_sizze_21478[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_21482[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) (0 + (int32_t) sizeof(int64_t) *
                                       seghist_group_sizze_19518));
                        time_start_21479 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->mainzisegred_small_20861,
                                                                    1, NULL,
                                                                    global_work_sizze_21478,
                                                                    local_work_sizze_21482,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->mainzisegred_small_20861_runs,
                                                                                                              &ctx->mainzisegred_small_20861_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_21480 = get_wall_time();
                        
                        long time_diff_21481 = time_end_21480 -
                             time_start_21479;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "main.segred_small_20861", time_diff_21481);
                    }
                }
            } else {
                int64_t groups_per_segment_20883 = sdiv_up64(num_groups_19520,
                                                             smax64(1,
                                                                    res_18101));
                int64_t elements_per_thread_20884 =
                        sdiv_up64(num_subhistos_20775,
                                  seghist_group_sizze_19518 *
                                  groups_per_segment_20883);
                int64_t virt_num_groups_20885 = groups_per_segment_20883 *
                        res_18101;
                int64_t num_threads_20886 = num_groups_19520 *
                        seghist_group_sizze_19518;
                int64_t threads_per_segment_20887 = groups_per_segment_20883 *
                        seghist_group_sizze_19518;
                
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegRed-large");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_segments",
                            (long long) res_18101, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segment_size",
                            (long long) num_subhistos_20775, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                            (long long) virt_num_groups_20885, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_groups",
                            (long long) num_groups_19520, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "group_size",
                            (long long) seghist_group_sizze_19518, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                            (long long) elements_per_thread_20884, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                            (long long) groups_per_segment_20883, '\n');
                
                struct memblock_device group_res_arr_mem_20888;
                
                group_res_arr_mem_20888.references = NULL;
                if (memblock_alloc_device(ctx, &group_res_arr_mem_20888,
                                          (int32_t) sizeof(int64_t) *
                                          (seghist_group_sizze_19518 *
                                           virt_num_groups_20885),
                                          "group_res_arr_mem_20888")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mainzicounter_mem_20890 =
                                       ctx->mainzicounter_mem_20890;
                
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        1,
                                                        (int32_t) sizeof(bool),
                                                        NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        2,
                                                        (int32_t) sizeof(int64_t) *
                                                        seghist_group_sizze_19518,
                                                        NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        3, sizeof(res_18101),
                                                        &res_18101));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        4,
                                                        sizeof(num_groups_19520),
                                                        &num_groups_19520));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        5,
                                                        sizeof(mem_20363.mem),
                                                        &mem_20363.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        6,
                                                        sizeof(num_subhistos_20775),
                                                        &num_subhistos_20775));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        7,
                                                        sizeof(res_subhistos_mem_20776.mem),
                                                        &res_subhistos_mem_20776.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        8,
                                                        sizeof(groups_per_segment_20883),
                                                        &groups_per_segment_20883));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        9,
                                                        sizeof(elements_per_thread_20884),
                                                        &elements_per_thread_20884));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        10,
                                                        sizeof(virt_num_groups_20885),
                                                        &virt_num_groups_20885));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        11,
                                                        sizeof(threads_per_segment_20887),
                                                        &threads_per_segment_20887));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        12,
                                                        sizeof(group_res_arr_mem_20888.mem),
                                                        &group_res_arr_mem_20888.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_20861,
                                                        13,
                                                        sizeof(mainzicounter_mem_20890.mem),
                                                        &mainzicounter_mem_20890.mem));
                if (1 * ((size_t) num_groups_19520 *
                         (size_t) seghist_group_sizze_19518) != 0) {
                    const size_t global_work_sizze_21484[1] =
                                 {(size_t) num_groups_19520 *
                                 (size_t) seghist_group_sizze_19518};
                    const size_t local_work_sizze_21488[1] =
                                 {seghist_group_sizze_19518};
                    int64_t time_start_21485 = 0, time_end_21486 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "main.segred_large_20861");
                        fprintf(stderr, "%zu", global_work_sizze_21484[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_21488[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) (0 + (int32_t) sizeof(bool) +
                                       (int32_t) sizeof(int64_t) *
                                       seghist_group_sizze_19518));
                        time_start_21485 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->mainzisegred_large_20861,
                                                                    1, NULL,
                                                                    global_work_sizze_21484,
                                                                    local_work_sizze_21488,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->mainzisegred_large_20861_runs,
                                                                                                              &ctx->mainzisegred_large_20861_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_21486 = get_wall_time();
                        
                        long time_diff_21487 = time_end_21486 -
                             time_start_21485;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "main.segred_large_20861", time_diff_21487);
                    }
                }
                if (memblock_unref_device(ctx, &group_res_arr_mem_20888,
                                          "group_res_arr_mem_20888") != 0)
                    return 1;
            }
        }
    }
    if (memblock_unref_device(ctx, &mem_20356, "mem_20356") != 0)
        return 1;
    
    int64_t segscan_group_sizze_19533;
    
    segscan_group_sizze_19533 = ctx->sizes.mainzisegscan_group_sizze_19532;
    
    int64_t num_groups_19535;
    int32_t max_num_groups_20922;
    
    max_num_groups_20922 = ctx->sizes.mainzisegscan_num_groups_19534;
    num_groups_19535 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_18101,
                                                               sext_i32_i64(segscan_group_sizze_19533)),
                                                     sext_i32_i64(max_num_groups_20922))));
    
    struct memblock_device mem_20367;
    
    mem_20367.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20367, res_18101, "mem_20367")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_20369;
    
    mem_20369.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20369, bytes_20362, "mem_20369")) {
        err = 1;
        goto cleanup;
    }
    if (slt64(0, res_18101)) {
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegScan");
        
        int64_t stage1_max_num_groups_20923;
        
        stage1_max_num_groups_20923 = ctx->opencl.max_group_size;
        
        int64_t stage1_num_groups_20924;
        
        stage1_num_groups_20924 = smin64(stage1_max_num_groups_20923,
                                         num_groups_19535);
        
        int32_t num_threads_20925;
        
        num_threads_20925 = sext_i64_i32(stage1_num_groups_20924 *
            segscan_group_sizze_19533);
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19538, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(int64_t) *
                                                       segscan_group_sizze_19533),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19538, 2,
                                                smax64(1,
                                                       (int32_t) sizeof(bool) *
                                                       segscan_group_sizze_19533),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19538, 3,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19538, 4,
                                                sizeof(mem_20363.mem),
                                                &mem_20363.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19538, 5,
                                                sizeof(mem_20367.mem),
                                                &mem_20367.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19538, 6,
                                                sizeof(mem_20369.mem),
                                                &mem_20369.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19538, 7,
                                                sizeof(num_threads_20925),
                                                &num_threads_20925));
        if (1 * ((size_t) stage1_num_groups_20924 *
                 (size_t) segscan_group_sizze_19533) != 0) {
            const size_t global_work_sizze_21489[1] =
                         {(size_t) stage1_num_groups_20924 *
                         (size_t) segscan_group_sizze_19533};
            const size_t local_work_sizze_21493[1] =
                         {segscan_group_sizze_19533};
            int64_t time_start_21490 = 0, time_end_21491 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage1_19538");
                fprintf(stderr, "%zu", global_work_sizze_21489[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21493[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                          segscan_group_sizze_19533) + smax64(1,
                                                                              (int32_t) sizeof(bool) *
                                                                              segscan_group_sizze_19533)));
                time_start_21490 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage1_19538,
                                                            1, NULL,
                                                            global_work_sizze_21489,
                                                            local_work_sizze_21493,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage1_19538_runs,
                                                                                                      &ctx->mainziscan_stage1_19538_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21491 = get_wall_time();
                
                long time_diff_21492 = time_end_21491 - time_start_21490;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage1_19538", time_diff_21492);
            }
        }
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "elems_per_group",
                    (long long) (segscan_group_sizze_19533 *
                                 sdiv_up64(res_18101,
                                           sext_i32_i64(num_threads_20925))),
                    '\n');
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19538, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(int64_t) *
                                                       stage1_num_groups_20924),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19538, 2,
                                                smax64(1,
                                                       (int32_t) sizeof(bool) *
                                                       stage1_num_groups_20924),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19538, 3,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19538, 4,
                                                sizeof(mem_20367.mem),
                                                &mem_20367.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19538, 5,
                                                sizeof(mem_20369.mem),
                                                &mem_20369.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19538, 6,
                                                sizeof(stage1_num_groups_20924),
                                                &stage1_num_groups_20924));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19538, 7,
                                                sizeof(num_threads_20925),
                                                &num_threads_20925));
        if (1 * ((size_t) 1 * (size_t) stage1_num_groups_20924) != 0) {
            const size_t global_work_sizze_21494[1] = {(size_t) 1 *
                         (size_t) stage1_num_groups_20924};
            const size_t local_work_sizze_21498[1] = {stage1_num_groups_20924};
            int64_t time_start_21495 = 0, time_end_21496 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage2_19538");
                fprintf(stderr, "%zu", global_work_sizze_21494[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21498[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                          stage1_num_groups_20924) + smax64(1,
                                                                            (int32_t) sizeof(bool) *
                                                                            stage1_num_groups_20924)));
                time_start_21495 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage2_19538,
                                                            1, NULL,
                                                            global_work_sizze_21494,
                                                            local_work_sizze_21498,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage2_19538_runs,
                                                                                                      &ctx->mainziscan_stage2_19538_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21496 = get_wall_time();
                
                long time_diff_21497 = time_end_21496 - time_start_21495;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage2_19538", time_diff_21497);
            }
        }
        
        int32_t required_groups_20977;
        
        required_groups_20977 = sext_i64_i32(sdiv_up64(res_18101,
                                                       segscan_group_sizze_19533));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19538, 1,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19538, 2,
                                                sizeof(num_groups_19535),
                                                &num_groups_19535));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19538, 3,
                                                sizeof(mem_20367.mem),
                                                &mem_20367.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19538, 4,
                                                sizeof(mem_20369.mem),
                                                &mem_20369.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19538, 5,
                                                sizeof(num_threads_20925),
                                                &num_threads_20925));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19538, 6,
                                                sizeof(required_groups_20977),
                                                &required_groups_20977));
        if (1 * ((size_t) num_groups_19535 *
                 (size_t) segscan_group_sizze_19533) != 0) {
            const size_t global_work_sizze_21499[1] =
                         {(size_t) num_groups_19535 *
                         (size_t) segscan_group_sizze_19533};
            const size_t local_work_sizze_21503[1] =
                         {segscan_group_sizze_19533};
            int64_t time_start_21500 = 0, time_end_21501 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage3_19538");
                fprintf(stderr, "%zu", global_work_sizze_21499[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21503[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21500 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage3_19538,
                                                            1, NULL,
                                                            global_work_sizze_21499,
                                                            local_work_sizze_21503,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage3_19538_runs,
                                                                                                      &ctx->mainziscan_stage3_19538_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21501 = get_wall_time();
                
                long time_diff_21502 = time_end_21501 - time_start_21500;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage3_19538", time_diff_21502);
            }
        }
    }
    if (memblock_unref_device(ctx, &mem_20363, "mem_20363") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20367, "mem_20367") != 0)
        return 1;
    
    int64_t segscan_group_sizze_19541;
    
    segscan_group_sizze_19541 = ctx->sizes.mainzisegscan_group_sizze_19540;
    
    int64_t num_groups_19543;
    int32_t max_num_groups_20989;
    
    max_num_groups_20989 = ctx->sizes.mainzisegscan_num_groups_19542;
    num_groups_19543 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_18101,
                                                               sext_i32_i64(segscan_group_sizze_19541)),
                                                     sext_i32_i64(max_num_groups_20989))));
    
    struct memblock_device mem_20372;
    
    mem_20372.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20372, res_18101, "mem_20372")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_20374;
    
    mem_20374.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20374, bytes_20362, "mem_20374")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_20376;
    
    mem_20376.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20376, res_18101, "mem_20376")) {
        err = 1;
        goto cleanup;
    }
    if (slt64(0, res_18101)) {
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegScan");
        
        int64_t stage1_max_num_groups_20990;
        
        stage1_max_num_groups_20990 = ctx->opencl.max_group_size;
        
        int64_t stage1_num_groups_20991;
        
        stage1_num_groups_20991 = smin64(stage1_max_num_groups_20990,
                                         num_groups_19543);
        
        int32_t num_threads_20992;
        
        num_threads_20992 = sext_i64_i32(stage1_num_groups_20991 *
            segscan_group_sizze_19541);
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19546, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(int64_t) *
                                                       segscan_group_sizze_19541),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19546, 2,
                                                smax64(1,
                                                       (int32_t) sizeof(bool) *
                                                       segscan_group_sizze_19541),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19546, 3,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19546, 4,
                                                sizeof(mem_20369.mem),
                                                &mem_20369.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19546, 5,
                                                sizeof(mem_20372.mem),
                                                &mem_20372.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19546, 6,
                                                sizeof(mem_20374.mem),
                                                &mem_20374.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19546, 7,
                                                sizeof(mem_20376.mem),
                                                &mem_20376.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19546, 8,
                                                sizeof(num_threads_20992),
                                                &num_threads_20992));
        if (1 * ((size_t) stage1_num_groups_20991 *
                 (size_t) segscan_group_sizze_19541) != 0) {
            const size_t global_work_sizze_21504[1] =
                         {(size_t) stage1_num_groups_20991 *
                         (size_t) segscan_group_sizze_19541};
            const size_t local_work_sizze_21508[1] =
                         {segscan_group_sizze_19541};
            int64_t time_start_21505 = 0, time_end_21506 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage1_19546");
                fprintf(stderr, "%zu", global_work_sizze_21504[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21508[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                          segscan_group_sizze_19541) + smax64(1,
                                                                              (int32_t) sizeof(bool) *
                                                                              segscan_group_sizze_19541)));
                time_start_21505 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage1_19546,
                                                            1, NULL,
                                                            global_work_sizze_21504,
                                                            local_work_sizze_21508,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage1_19546_runs,
                                                                                                      &ctx->mainziscan_stage1_19546_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21506 = get_wall_time();
                
                long time_diff_21507 = time_end_21506 - time_start_21505;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage1_19546", time_diff_21507);
            }
        }
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "elems_per_group",
                    (long long) (segscan_group_sizze_19541 *
                                 sdiv_up64(res_18101,
                                           sext_i32_i64(num_threads_20992))),
                    '\n');
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19546, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(int64_t) *
                                                       stage1_num_groups_20991),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19546, 2,
                                                smax64(1,
                                                       (int32_t) sizeof(bool) *
                                                       stage1_num_groups_20991),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19546, 3,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19546, 4,
                                                sizeof(mem_20372.mem),
                                                &mem_20372.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19546, 5,
                                                sizeof(mem_20374.mem),
                                                &mem_20374.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19546, 6,
                                                sizeof(stage1_num_groups_20991),
                                                &stage1_num_groups_20991));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19546, 7,
                                                sizeof(num_threads_20992),
                                                &num_threads_20992));
        if (1 * ((size_t) 1 * (size_t) stage1_num_groups_20991) != 0) {
            const size_t global_work_sizze_21509[1] = {(size_t) 1 *
                         (size_t) stage1_num_groups_20991};
            const size_t local_work_sizze_21513[1] = {stage1_num_groups_20991};
            int64_t time_start_21510 = 0, time_end_21511 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage2_19546");
                fprintf(stderr, "%zu", global_work_sizze_21509[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21513[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                          stage1_num_groups_20991) + smax64(1,
                                                                            (int32_t) sizeof(bool) *
                                                                            stage1_num_groups_20991)));
                time_start_21510 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage2_19546,
                                                            1, NULL,
                                                            global_work_sizze_21509,
                                                            local_work_sizze_21513,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage2_19546_runs,
                                                                                                      &ctx->mainziscan_stage2_19546_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21511 = get_wall_time();
                
                long time_diff_21512 = time_end_21511 - time_start_21510;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage2_19546", time_diff_21512);
            }
        }
        
        int32_t required_groups_21044;
        
        required_groups_21044 = sext_i64_i32(sdiv_up64(res_18101,
                                                       segscan_group_sizze_19541));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19546, 1,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19546, 2,
                                                sizeof(num_groups_19543),
                                                &num_groups_19543));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19546, 3,
                                                sizeof(mem_20372.mem),
                                                &mem_20372.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19546, 4,
                                                sizeof(mem_20374.mem),
                                                &mem_20374.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19546, 5,
                                                sizeof(num_threads_20992),
                                                &num_threads_20992));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19546, 6,
                                                sizeof(required_groups_21044),
                                                &required_groups_21044));
        if (1 * ((size_t) num_groups_19543 *
                 (size_t) segscan_group_sizze_19541) != 0) {
            const size_t global_work_sizze_21514[1] =
                         {(size_t) num_groups_19543 *
                         (size_t) segscan_group_sizze_19541};
            const size_t local_work_sizze_21518[1] =
                         {segscan_group_sizze_19541};
            int64_t time_start_21515 = 0, time_end_21516 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage3_19546");
                fprintf(stderr, "%zu", global_work_sizze_21514[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21518[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21515 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage3_19546,
                                                            1, NULL,
                                                            global_work_sizze_21514,
                                                            local_work_sizze_21518,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage3_19546_runs,
                                                                                                      &ctx->mainziscan_stage3_19546_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21516 = get_wall_time();
                
                long time_diff_21517 = time_end_21516 - time_start_21515;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage3_19546", time_diff_21517);
            }
        }
    }
    if (memblock_unref_device(ctx, &mem_20372, "mem_20372") != 0)
        return 1;
    
    int64_t segscan_group_sizze_19549;
    
    segscan_group_sizze_19549 = ctx->sizes.mainzisegscan_group_sizze_19548;
    
    int64_t num_groups_19551;
    int32_t max_num_groups_21056;
    
    max_num_groups_21056 = ctx->sizes.mainzisegscan_num_groups_19550;
    num_groups_19551 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_18101,
                                                               sext_i32_i64(segscan_group_sizze_19549)),
                                                     sext_i32_i64(max_num_groups_21056))));
    
    struct memblock_device mem_20379;
    
    mem_20379.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20379, res_18101, "mem_20379")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_20380 = 4 * res_18101;
    struct memblock_device mem_20381;
    
    mem_20381.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20381, bytes_20380, "mem_20381")) {
        err = 1;
        goto cleanup;
    }
    if (slt64(0, res_18101)) {
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegScan");
        
        int64_t stage1_max_num_groups_21057;
        
        stage1_max_num_groups_21057 = ctx->opencl.max_group_size;
        
        int64_t stage1_num_groups_21058;
        
        stage1_num_groups_21058 = smin64(stage1_max_num_groups_21057,
                                         num_groups_19551);
        
        int32_t num_threads_21059;
        
        num_threads_21059 = sext_i64_i32(stage1_num_groups_21058 *
            segscan_group_sizze_19549);
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554, 3,
                                                smax64(1,
                                                       (int32_t) sizeof(float) *
                                                       segscan_group_sizze_19549),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554, 4,
                                                smax64(1,
                                                       (int32_t) sizeof(bool) *
                                                       segscan_group_sizze_19549),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554, 5,
                                                sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554, 6,
                                                sizeof(steps_17886),
                                                &steps_17886));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554, 7,
                                                sizeof(a_17890), &a_17890));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554, 8,
                                                sizeof(b_17891), &b_17891));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554, 9,
                                                sizeof(sigma_17892),
                                                &sigma_17892));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                10, sizeof(res_18101),
                                                &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                11,
                                                sizeof(one_intra_par_min_18814),
                                                &one_intra_par_min_18814));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                12, sizeof(res_mem_20276.mem),
                                                &res_mem_20276.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                13, sizeof(res_mem_20277.mem),
                                                &res_mem_20277.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                14, sizeof(res_mem_20278.mem),
                                                &res_mem_20278.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                15, sizeof(res_mem_20279.mem),
                                                &res_mem_20279.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                16, sizeof(binop_x_20308),
                                                &binop_x_20308));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                17, sizeof(res_mem_20352.mem),
                                                &res_mem_20352.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                18, sizeof(res_mem_20353.mem),
                                                &res_mem_20353.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                19, sizeof(mem_20369.mem),
                                                &mem_20369.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                20, sizeof(mem_20374.mem),
                                                &mem_20374.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                21, sizeof(mem_20376.mem),
                                                &mem_20376.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                22, sizeof(mem_20379.mem),
                                                &mem_20379.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                23, sizeof(mem_20381.mem),
                                                &mem_20381.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19554,
                                                24, sizeof(num_threads_21059),
                                                &num_threads_21059));
        if (1 * ((size_t) stage1_num_groups_21058 *
                 (size_t) segscan_group_sizze_19549) != 0) {
            const size_t global_work_sizze_21519[1] =
                         {(size_t) stage1_num_groups_21058 *
                         (size_t) segscan_group_sizze_19549};
            const size_t local_work_sizze_21523[1] =
                         {segscan_group_sizze_19549};
            int64_t time_start_21520 = 0, time_end_21521 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage1_19554");
                fprintf(stderr, "%zu", global_work_sizze_21519[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21523[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(float) *
                                          segscan_group_sizze_19549) + smax64(1,
                                                                              (int32_t) sizeof(bool) *
                                                                              segscan_group_sizze_19549)));
                time_start_21520 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage1_19554,
                                                            1, NULL,
                                                            global_work_sizze_21519,
                                                            local_work_sizze_21523,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage1_19554_runs,
                                                                                                      &ctx->mainziscan_stage1_19554_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21521 = get_wall_time();
                
                long time_diff_21522 = time_end_21521 - time_start_21520;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage1_19554", time_diff_21522);
            }
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "elems_per_group",
                    (long long) (segscan_group_sizze_19549 *
                                 sdiv_up64(res_18101,
                                           sext_i32_i64(num_threads_21059))),
                    '\n');
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19554, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(float) *
                                                       stage1_num_groups_21058),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19554, 2,
                                                smax64(1,
                                                       (int32_t) sizeof(bool) *
                                                       stage1_num_groups_21058),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19554, 3,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19554, 4,
                                                sizeof(mem_20379.mem),
                                                &mem_20379.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19554, 5,
                                                sizeof(mem_20381.mem),
                                                &mem_20381.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19554, 6,
                                                sizeof(stage1_num_groups_21058),
                                                &stage1_num_groups_21058));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19554, 7,
                                                sizeof(num_threads_21059),
                                                &num_threads_21059));
        if (1 * ((size_t) 1 * (size_t) stage1_num_groups_21058) != 0) {
            const size_t global_work_sizze_21524[1] = {(size_t) 1 *
                         (size_t) stage1_num_groups_21058};
            const size_t local_work_sizze_21528[1] = {stage1_num_groups_21058};
            int64_t time_start_21525 = 0, time_end_21526 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage2_19554");
                fprintf(stderr, "%zu", global_work_sizze_21524[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21528[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(float) *
                                          stage1_num_groups_21058) + smax64(1,
                                                                            (int32_t) sizeof(bool) *
                                                                            stage1_num_groups_21058)));
                time_start_21525 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage2_19554,
                                                            1, NULL,
                                                            global_work_sizze_21524,
                                                            local_work_sizze_21528,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage2_19554_runs,
                                                                                                      &ctx->mainziscan_stage2_19554_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21526 = get_wall_time();
                
                long time_diff_21527 = time_end_21526 - time_start_21525;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage2_19554", time_diff_21527);
            }
        }
        
        int32_t required_groups_21111;
        
        required_groups_21111 = sext_i64_i32(sdiv_up64(res_18101,
                                                       segscan_group_sizze_19549));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19554, 1,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19554, 2,
                                                sizeof(num_groups_19551),
                                                &num_groups_19551));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19554, 3,
                                                sizeof(mem_20379.mem),
                                                &mem_20379.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19554, 4,
                                                sizeof(mem_20381.mem),
                                                &mem_20381.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19554, 5,
                                                sizeof(num_threads_21059),
                                                &num_threads_21059));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19554, 6,
                                                sizeof(required_groups_21111),
                                                &required_groups_21111));
        if (1 * ((size_t) num_groups_19551 *
                 (size_t) segscan_group_sizze_19549) != 0) {
            const size_t global_work_sizze_21529[1] =
                         {(size_t) num_groups_19551 *
                         (size_t) segscan_group_sizze_19549};
            const size_t local_work_sizze_21533[1] =
                         {segscan_group_sizze_19549};
            int64_t time_start_21530 = 0, time_end_21531 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage3_19554");
                fprintf(stderr, "%zu", global_work_sizze_21529[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21533[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21530 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage3_19554,
                                                            1, NULL,
                                                            global_work_sizze_21529,
                                                            local_work_sizze_21533,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage3_19554_runs,
                                                                                                      &ctx->mainziscan_stage3_19554_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21531 = get_wall_time();
                
                long time_diff_21532 = time_end_21531 - time_start_21530;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage3_19554", time_diff_21532);
            }
        }
    }
    if (memblock_unref_device(ctx, &res_mem_20276, "res_mem_20276") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20277, "res_mem_20277") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20278, "res_mem_20278") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20279, "res_mem_20279") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20352, "res_mem_20352") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20353, "res_mem_20353") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20369, "mem_20369") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20374, "mem_20374") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20379, "mem_20379") != 0)
        return 1;
    
    int64_t segscan_group_sizze_19601;
    
    segscan_group_sizze_19601 = ctx->sizes.mainzisegscan_group_sizze_19600;
    
    int64_t num_groups_19603;
    int32_t max_num_groups_21123;
    
    max_num_groups_21123 = ctx->sizes.mainzisegscan_num_groups_19602;
    num_groups_19603 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_18101,
                                                               sext_i32_i64(segscan_group_sizze_19601)),
                                                     sext_i32_i64(max_num_groups_21123))));
    
    struct memblock_device mem_20384;
    
    mem_20384.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20384, bytes_20362, "mem_20384")) {
        err = 1;
        goto cleanup;
    }
    if (slt64(0, res_18101)) {
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegScan");
        
        int64_t stage1_max_num_groups_21124;
        
        stage1_max_num_groups_21124 = ctx->opencl.max_group_size;
        
        int64_t stage1_num_groups_21125;
        
        stage1_num_groups_21125 = smin64(stage1_max_num_groups_21124,
                                         num_groups_19603);
        
        int32_t num_threads_21126;
        
        num_threads_21126 = sext_i64_i32(stage1_num_groups_21125 *
            segscan_group_sizze_19601);
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19606, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(int64_t) *
                                                       segscan_group_sizze_19601),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19606, 2,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19606, 3,
                                                sizeof(mem_20376.mem),
                                                &mem_20376.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19606, 4,
                                                sizeof(mem_20384.mem),
                                                &mem_20384.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_19606, 5,
                                                sizeof(num_threads_21126),
                                                &num_threads_21126));
        if (1 * ((size_t) stage1_num_groups_21125 *
                 (size_t) segscan_group_sizze_19601) != 0) {
            const size_t global_work_sizze_21534[1] =
                         {(size_t) stage1_num_groups_21125 *
                         (size_t) segscan_group_sizze_19601};
            const size_t local_work_sizze_21538[1] =
                         {segscan_group_sizze_19601};
            int64_t time_start_21535 = 0, time_end_21536 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage1_19606");
                fprintf(stderr, "%zu", global_work_sizze_21534[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21538[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                          segscan_group_sizze_19601)));
                time_start_21535 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage1_19606,
                                                            1, NULL,
                                                            global_work_sizze_21534,
                                                            local_work_sizze_21538,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage1_19606_runs,
                                                                                                      &ctx->mainziscan_stage1_19606_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21536 = get_wall_time();
                
                long time_diff_21537 = time_end_21536 - time_start_21535;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage1_19606", time_diff_21537);
            }
        }
        if (ctx->debugging)
            fprintf(stderr, "%s: %llu%c", "elems_per_group",
                    (long long) (segscan_group_sizze_19601 *
                                 sdiv_up64(res_18101,
                                           sext_i32_i64(num_threads_21126))),
                    '\n');
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19606, 1,
                                                smax64(1,
                                                       (int32_t) sizeof(int64_t) *
                                                       stage1_num_groups_21125),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19606, 2,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19606, 3,
                                                sizeof(mem_20384.mem),
                                                &mem_20384.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19606, 4,
                                                sizeof(stage1_num_groups_21125),
                                                &stage1_num_groups_21125));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_19606, 5,
                                                sizeof(num_threads_21126),
                                                &num_threads_21126));
        if (1 * ((size_t) 1 * (size_t) stage1_num_groups_21125) != 0) {
            const size_t global_work_sizze_21539[1] = {(size_t) 1 *
                         (size_t) stage1_num_groups_21125};
            const size_t local_work_sizze_21543[1] = {stage1_num_groups_21125};
            int64_t time_start_21540 = 0, time_end_21541 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage2_19606");
                fprintf(stderr, "%zu", global_work_sizze_21539[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21543[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                          stage1_num_groups_21125)));
                time_start_21540 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage2_19606,
                                                            1, NULL,
                                                            global_work_sizze_21539,
                                                            local_work_sizze_21543,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage2_19606_runs,
                                                                                                      &ctx->mainziscan_stage2_19606_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21541 = get_wall_time();
                
                long time_diff_21542 = time_end_21541 - time_start_21540;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage2_19606", time_diff_21542);
            }
        }
        
        int32_t required_groups_21162;
        
        required_groups_21162 = sext_i64_i32(sdiv_up64(res_18101,
                                                       segscan_group_sizze_19601));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19606, 1,
                                                sizeof(res_18101), &res_18101));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19606, 2,
                                                sizeof(num_groups_19603),
                                                &num_groups_19603));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19606, 3,
                                                sizeof(mem_20384.mem),
                                                &mem_20384.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19606, 4,
                                                sizeof(num_threads_21126),
                                                &num_threads_21126));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_19606, 5,
                                                sizeof(required_groups_21162),
                                                &required_groups_21162));
        if (1 * ((size_t) num_groups_19603 *
                 (size_t) segscan_group_sizze_19601) != 0) {
            const size_t global_work_sizze_21544[1] =
                         {(size_t) num_groups_19603 *
                         (size_t) segscan_group_sizze_19601};
            const size_t local_work_sizze_21548[1] =
                         {segscan_group_sizze_19601};
            int64_t time_start_21545 = 0, time_end_21546 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.scan_stage3_19606");
                fprintf(stderr, "%zu", global_work_sizze_21544[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21548[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21545 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainziscan_stage3_19606,
                                                            1, NULL,
                                                            global_work_sizze_21544,
                                                            local_work_sizze_21548,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainziscan_stage3_19606_runs,
                                                                                                      &ctx->mainziscan_stage3_19606_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21546 = get_wall_time();
                
                long time_diff_21547 = time_end_21546 - time_start_21545;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.scan_stage3_19606", time_diff_21547);
            }
        }
    }
    
    bool cond_18298 = slt64(0, res_18101);
    int64_t num_segments_18299;
    
    if (cond_18298) {
        int64_t i_18300 = sub64(res_18101, 1);
        bool x_18301 = sle64(0, i_18300);
        bool y_18302 = slt64(i_18300, res_18101);
        bool bounds_check_18303 = x_18301 && y_18302;
        bool index_certs_18304;
        
        if (!bounds_check_18303) {
            ctx->error = msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s",
                                   "Index [", i_18300,
                                   "] out of bounds for array of shape [",
                                   res_18101, "].",
                                   "-> #0  /prelude/array.fut:18:29-34\n   #1  lib/github.com/diku-dk/segmented/segmented.fut:29:36-59\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:91:6-36\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #4  cva.fut:154:18-77\n   #5  cva.fut:107:1-181:20\n");
            if (memblock_unref_device(ctx, &mem_20384, "mem_20384") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20381, "mem_20381") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20379, "mem_20379") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20376, "mem_20376") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20374, "mem_20374") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20372, "mem_20372") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20369, "mem_20369") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20367, "mem_20367") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_subhistos_mem_20776,
                                      "res_subhistos_mem_20776") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20363, "mem_20363") != 0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_20737,
                                      "group_res_arr_mem_20737") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20361, "mem_20361") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20358, "mem_20358") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20356, "mem_20356") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_20353, "res_mem_20353") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_20352, "res_mem_20352") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_20279, "res_mem_20279") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_20278, "res_mem_20278") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_20277, "res_mem_20277") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_20276, "res_mem_20276") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_20535,
                                      "group_res_arr_mem_20535") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20229, "mem_20229") != 0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_20530, "out_mem_20530") !=
                0)
                return 1;
            return 1;
        }
        
        int64_t read_res_21549;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_20384.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     i_18300 * sizeof(int64_t),
                                                     sizeof(int64_t),
                                                     &read_res_21549, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        int64_t res_18305 = read_res_21549;
        
        num_segments_18299 = res_18305;
    } else {
        num_segments_18299 = 0;
    }
    
    bool bounds_invalid_upwards_18306 = slt64(num_segments_18299, 0);
    bool valid_18307 = !bounds_invalid_upwards_18306;
    bool range_valid_c_18308;
    
    if (!valid_18307) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", num_segments_18299,
                               " is invalid.",
                               "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:70:18-23\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:33:17-41\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:91:6-36\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:154:18-77\n   #6  cva.fut:107:1-181:20\n");
        if (memblock_unref_device(ctx, &mem_20384, "mem_20384") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20381, "mem_20381") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20379, "mem_20379") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20376, "mem_20376") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20374, "mem_20374") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20372, "mem_20372") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20369, "mem_20369") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20367, "mem_20367") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_subhistos_mem_20776,
                                  "res_subhistos_mem_20776") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20363, "mem_20363") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20737,
                                  "group_res_arr_mem_20737") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20361, "mem_20361") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20358, "mem_20358") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20356, "mem_20356") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20353, "res_mem_20353") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20352, "res_mem_20352") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20279, "res_mem_20279") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20278, "res_mem_20278") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20277, "res_mem_20277") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20276, "res_mem_20276") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20535,
                                  "group_res_arr_mem_20535") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20229, "mem_20229") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_20530, "out_mem_20530") != 0)
            return 1;
        return 1;
    }
    
    int64_t bytes_20385 = 4 * num_segments_18299;
    struct memblock_device mem_20386;
    
    mem_20386.references = NULL;
    if (memblock_alloc_device(ctx, &mem_20386, bytes_20385, "mem_20386")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f32(ctx, mem_20386, num_segments_18299,
                                      0.0F) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_group_sizze_19611;
    
    segmap_group_sizze_19611 = ctx->sizes.mainzisegmap_group_sizze_19610;
    
    int64_t segmap_usable_groups_19612 = sdiv_up64(res_18101,
                                                   segmap_group_sizze_19611);
    
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19608, 1,
                                            sizeof(res_18101), &res_18101));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19608, 2,
                                            sizeof(num_segments_18299),
                                            &num_segments_18299));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19608, 3,
                                            sizeof(mem_20376.mem),
                                            &mem_20376.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19608, 4,
                                            sizeof(mem_20381.mem),
                                            &mem_20381.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19608, 5,
                                            sizeof(mem_20384.mem),
                                            &mem_20384.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19608, 6,
                                            sizeof(mem_20386.mem),
                                            &mem_20386.mem));
    if (1 * ((size_t) segmap_usable_groups_19612 *
             (size_t) segmap_group_sizze_19611) != 0) {
        const size_t global_work_sizze_21550[1] =
                     {(size_t) segmap_usable_groups_19612 *
                     (size_t) segmap_group_sizze_19611};
        const size_t local_work_sizze_21554[1] = {segmap_group_sizze_19611};
        int64_t time_start_21551 = 0, time_end_21552 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "main.segmap_19608");
            fprintf(stderr, "%zu", global_work_sizze_21550[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_21554[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_21551 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->mainzisegmap_19608,
                                                        1, NULL,
                                                        global_work_sizze_21550,
                                                        local_work_sizze_21554,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->mainzisegmap_19608_runs,
                                                                                                  &ctx->mainzisegmap_19608_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_21552 = get_wall_time();
            
            long time_diff_21553 = time_end_21552 - time_start_21551;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n", "main.segmap_19608",
                    time_diff_21553);
        }
    }
    if (memblock_unref_device(ctx, &mem_20376, "mem_20376") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20381, "mem_20381") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20384, "mem_20384") != 0)
        return 1;
    
    bool dim_match_18316 = binop_x_20308 == num_segments_18299;
    bool empty_or_match_cert_18317;
    
    if (!dim_match_18316) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Value of (core language) shape (",
                               num_segments_18299,
                               ") cannot match shape of type `[", binop_x_20308,
                               "]b`.",
                               "-> #0  lib/github.com/diku-dk/segmented/segmented.fut:103:6-45\n   #1  cva.fut:154:18-77\n   #2  cva.fut:107:1-181:20\n");
        if (memblock_unref_device(ctx, &mem_20386, "mem_20386") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20384, "mem_20384") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20381, "mem_20381") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20379, "mem_20379") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20376, "mem_20376") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20374, "mem_20374") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20372, "mem_20372") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20369, "mem_20369") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20367, "mem_20367") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_subhistos_mem_20776,
                                  "res_subhistos_mem_20776") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20363, "mem_20363") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20737,
                                  "group_res_arr_mem_20737") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20361, "mem_20361") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20358, "mem_20358") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20356, "mem_20356") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20353, "res_mem_20353") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20352, "res_mem_20352") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20279, "res_mem_20279") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20278, "res_mem_20278") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20277, "res_mem_20277") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20276, "res_mem_20276") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_20535,
                                  "group_res_arr_mem_20535") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20229, "mem_20229") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_20530, "out_mem_20530") != 0)
            return 1;
        return 1;
    }
    
    float res_18320 = sitofp_i64_f32(paths_17885);
    bool suff_outer_redomap_19614;
    
    suff_outer_redomap_19614 = ctx->sizes.mainzisuff_outer_redomap_10 <=
        steps_17886;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_outer_redomap_10",
                steps_17886);
    
    int64_t segred_group_sizze_19627;
    
    segred_group_sizze_19627 = ctx->sizes.mainzisegred_group_sizze_19616;
    
    int64_t num_groups_19628;
    int32_t max_num_groups_21188;
    
    max_num_groups_21188 = ctx->sizes.mainzisegred_num_groups_19618;
    num_groups_19628 = sext_i64_i32(smax64(1, smin64(sdiv_up64(steps_17886,
                                                               sext_i32_i64(segred_group_sizze_19627)),
                                                     sext_i32_i64(max_num_groups_21188))));
    
    bool suff_outer_par_19900;
    
    suff_outer_par_19900 = ctx->sizes.mainzisuff_outer_par_11 <= steps_17886;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_outer_par_11",
                steps_17886);
    
    bool fits_19904 = sle64(paths_17885, max_group_sizze_18966);
    bool suff_intra_par_19906;
    
    suff_intra_par_19906 = ctx->sizes.mainzisuff_intra_par_12 <= paths_17885;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_intra_par_12",
                paths_17885);
    
    bool intra_suff_and_fits_19907 = fits_19904 && suff_intra_par_19906;
    int64_t segmap_group_sizze_19911;
    
    segmap_group_sizze_19911 = ctx->sizes.mainzisegmap_group_sizze_19682;
    
    int64_t segred_group_sizze_19985;
    
    segred_group_sizze_19985 = ctx->sizes.mainzisegred_group_sizze_19824;
    
    int64_t num_groups_19986;
    int32_t max_num_groups_21189;
    
    max_num_groups_21189 = ctx->sizes.mainzisegred_num_groups_19826;
    num_groups_19986 = sext_i64_i32(smax64(1, smin64(sdiv_up64(nest_sizze_19378,
                                                               sext_i32_i64(segred_group_sizze_19985)),
                                                     sext_i32_i64(max_num_groups_21189))));
    
    int64_t segmap_group_sizze_20001;
    
    segmap_group_sizze_20001 = ctx->sizes.mainzisegmap_group_sizze_19797;
    
    int64_t segred_group_sizze_20029;
    
    segred_group_sizze_20029 = ctx->sizes.mainzisegred_group_sizze_19890;
    
    int64_t num_groups_20030;
    int32_t max_num_groups_21190;
    
    max_num_groups_21190 = ctx->sizes.mainzisegred_num_groups_19892;
    num_groups_20030 = sext_i64_i32(smax64(1, smin64(sdiv_up64(steps_17886,
                                                               sext_i32_i64(segred_group_sizze_20029)),
                                                     sext_i32_i64(max_num_groups_21190))));
    
    int64_t binop_x_20393 = n_17882 * paths_17885;
    int64_t binop_x_20394 = steps_17886 * binop_x_20393;
    int64_t bytes_20392 = 4 * binop_x_20394;
    struct memblock_device res_mem_20442;
    
    res_mem_20442.references = NULL;
    
    float res_18337;
    int32_t local_memory_capacity_21350;
    
    local_memory_capacity_21350 = ctx->opencl.max_local_memory;
    if ((sle64(0, sext_i32_i64(local_memory_capacity_21350)) &&
         sle64((int32_t) sizeof(bool) + (int32_t) sizeof(float) *
               segred_group_sizze_19627,
               sext_i32_i64(local_memory_capacity_21350))) &&
        suff_outer_redomap_19614) {
        struct memblock_device mem_20391;
        
        mem_20391.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20391, bytes_20306, "mem_20391")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t group_sizze_21194;
        
        group_sizze_21194 = ctx->sizes.mainzigroup_sizze_21194;
        
        int64_t num_groups_21195;
        
        num_groups_21195 = sdiv_up64(steps_17886 * paths_17885 * n_17882,
                                     group_sizze_21194);
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_21191, 0,
                                                sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_21191, 1,
                                                sizeof(paths_17885),
                                                &paths_17885));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_21191, 2,
                                                sizeof(steps_17886),
                                                &steps_17886));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_21191, 3,
                                                sizeof(mem_20386.mem),
                                                &mem_20386.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_21191, 4,
                                                sizeof(mem_20391.mem),
                                                &mem_20391.mem));
        if (1 * ((size_t) num_groups_21195 * (size_t) group_sizze_21194) != 0) {
            const size_t global_work_sizze_21555[1] =
                         {(size_t) num_groups_21195 *
                         (size_t) group_sizze_21194};
            const size_t local_work_sizze_21559[1] = {group_sizze_21194};
            int64_t time_start_21556 = 0, time_end_21557 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.copy_21191");
                fprintf(stderr, "%zu", global_work_sizze_21555[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21559[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_21556 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzicopy_21191,
                                                            1, NULL,
                                                            global_work_sizze_21555,
                                                            local_work_sizze_21559,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzicopy_21191_runs,
                                                                                                      &ctx->mainzicopy_21191_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21557 = get_wall_time();
                
                long time_diff_21558 = time_end_21557 - time_start_21556;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n", "main.copy_21191",
                        time_diff_21558);
            }
        }
        
        struct memblock_device mem_20395;
        
        mem_20395.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20395, bytes_20392, "mem_20395")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_20395, 0, mem_20391,
                                                  0, 1, paths_17885 * n_17882,
                                                  steps_17886) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_unref_device(ctx, &mem_20391, "mem_20391") != 0)
            return 1;
        
        struct memblock_device mem_20398;
        
        mem_20398.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20398, 4, "mem_20398")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_20400;
        
        mem_20400.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20400, bytes_20282, "mem_20400")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mainzicounter_mem_21196 =
                               ctx->mainzicounter_mem_21196;
        struct memblock_device group_res_arr_mem_21198;
        
        group_res_arr_mem_21198.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_21198,
                                  (int32_t) sizeof(float) *
                                  (segred_group_sizze_19627 * num_groups_19628),
                                  "group_res_arr_mem_21198")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_21200;
        
        num_threads_21200 = num_groups_19628 * segred_group_sizze_19627;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                1, (int32_t) sizeof(float) *
                                                segred_group_sizze_19627,
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                2, (int32_t) sizeof(bool),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                3, sizeof(n_17882), &n_17882));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                4, sizeof(paths_17885),
                                                &paths_17885));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                5, sizeof(steps_17886),
                                                &steps_17886));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                6, sizeof(a_17890), &a_17890));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                7, sizeof(x_17910), &x_17910));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                8, sizeof(x_17912), &x_17912));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                9, sizeof(y_17914), &y_17914));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                10, sizeof(y_17915), &y_17915));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                11, sizeof(sims_per_year_17992),
                                                &sims_per_year_17992));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                12, sizeof(res_18320),
                                                &res_18320));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                13, sizeof(num_groups_19628),
                                                &num_groups_19628));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                14, sizeof(mem_20395.mem),
                                                &mem_20395.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                15, sizeof(mem_20398.mem),
                                                &mem_20398.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                16, sizeof(mem_20400.mem),
                                                &mem_20400.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                17,
                                                sizeof(mainzicounter_mem_21196.mem),
                                                &mainzicounter_mem_21196.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                18,
                                                sizeof(group_res_arr_mem_21198.mem),
                                                &group_res_arr_mem_21198.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19625,
                                                19, sizeof(num_threads_21200),
                                                &num_threads_21200));
        if (1 * ((size_t) num_groups_19628 *
                 (size_t) segred_group_sizze_19627) != 0) {
            const size_t global_work_sizze_21561[1] =
                         {(size_t) num_groups_19628 *
                         (size_t) segred_group_sizze_19627};
            const size_t local_work_sizze_21565[1] = {segred_group_sizze_19627};
            int64_t time_start_21562 = 0, time_end_21563 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segred_nonseg_19625");
                fprintf(stderr, "%zu", global_work_sizze_21561[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21565[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + (int32_t) sizeof(float) *
                               segred_group_sizze_19627 +
                               (int32_t) sizeof(bool)));
                time_start_21562 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegred_nonseg_19625,
                                                            1, NULL,
                                                            global_work_sizze_21561,
                                                            local_work_sizze_21565,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegred_nonseg_19625_runs,
                                                                                                      &ctx->mainzisegred_nonseg_19625_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21563 = get_wall_time();
                
                long time_diff_21564 = time_end_21563 - time_start_21562;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segred_nonseg_19625", time_diff_21564);
            }
        }
        if (memblock_unref_device(ctx, &mem_20395, "mem_20395") != 0)
            return 1;
        
        float read_res_21566;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_20398.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0 * sizeof(float),
                                                     sizeof(float),
                                                     &read_res_21566, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        float res_19667 = read_res_21566;
        
        if (memblock_unref_device(ctx, &mem_20398, "mem_20398") != 0)
            return 1;
        
        struct memblock_device mem_20440;
        
        mem_20440.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20440, bytes_20282, "mem_20440")) {
            err = 1;
            goto cleanup;
        }
        if (steps_17886 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         mem_20400.mem,
                                                         mem_20440.mem, 0, 0,
                                                         steps_17886 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        if (memblock_unref_device(ctx, &mem_20400, "mem_20400") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20442, &mem_20440, "mem_20440") !=
            0)
            return 1;
        res_18337 = res_19667;
        if (memblock_unref_device(ctx, &mem_20440, "mem_20440") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_21198,
                                  "group_res_arr_mem_21198") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20400, "mem_20400") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20398, "mem_20398") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20395, "mem_20395") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20391, "mem_20391") != 0)
            return 1;
    } else {
        struct memblock_device res_map_acc_mem_20434;
        
        res_map_acc_mem_20434.references = NULL;
        
        struct memblock_device res_mem_20435;
        
        res_mem_20435.references = NULL;
        
        int32_t local_memory_capacity_21319;
        
        local_memory_capacity_21319 = ctx->opencl.max_local_memory;
        if ((sle64(0, sext_i32_i64(local_memory_capacity_21319)) && sle64(0,
                                                                          sext_i32_i64(local_memory_capacity_21319))) &&
            suff_outer_par_19900) {
            int64_t segmap_usable_groups_19912 = sdiv_up64(steps_17886,
                                                           segmap_group_sizze_19911);
            struct memblock_device mem_20404;
            
            mem_20404.references = NULL;
            if (memblock_alloc_device(ctx, &mem_20404, bytes_20306,
                                      "mem_20404")) {
                err = 1;
                goto cleanup;
            }
            
            int64_t group_sizze_21231;
            
            group_sizze_21231 = ctx->sizes.mainzigroup_sizze_21231;
            
            int64_t num_groups_21232;
            
            num_groups_21232 = sdiv_up64(steps_17886 * paths_17885 * n_17882,
                                         group_sizze_21231);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_21228, 0,
                                                    sizeof(n_17882), &n_17882));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_21228, 1,
                                                    sizeof(paths_17885),
                                                    &paths_17885));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_21228, 2,
                                                    sizeof(steps_17886),
                                                    &steps_17886));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_21228, 3,
                                                    sizeof(mem_20386.mem),
                                                    &mem_20386.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzicopy_21228, 4,
                                                    sizeof(mem_20404.mem),
                                                    &mem_20404.mem));
            if (1 * ((size_t) num_groups_21232 * (size_t) group_sizze_21231) !=
                0) {
                const size_t global_work_sizze_21567[1] =
                             {(size_t) num_groups_21232 *
                             (size_t) group_sizze_21231};
                const size_t local_work_sizze_21571[1] = {group_sizze_21231};
                int64_t time_start_21568 = 0, time_end_21569 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.copy_21228");
                    fprintf(stderr, "%zu", global_work_sizze_21567[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_21571[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_21568 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainzicopy_21228,
                                                                1, NULL,
                                                                global_work_sizze_21567,
                                                                local_work_sizze_21571,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainzicopy_21228_runs,
                                                                                                          &ctx->mainzicopy_21228_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_21569 = get_wall_time();
                    
                    long time_diff_21570 = time_end_21569 - time_start_21568;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.copy_21228", time_diff_21570);
                }
            }
            
            struct memblock_device mem_20408;
            
            mem_20408.references = NULL;
            if (memblock_alloc_device(ctx, &mem_20408, bytes_20392,
                                      "mem_20408")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_20408, 0,
                                                      mem_20404, 0, 1,
                                                      paths_17885 * n_17882,
                                                      steps_17886) != 0) {
                err = 1;
                goto cleanup;
            }
            if (memblock_unref_device(ctx, &mem_20404, "mem_20404") != 0)
                return 1;
            
            struct memblock_device mem_20411;
            
            mem_20411.references = NULL;
            if (memblock_alloc_device(ctx, &mem_20411, bytes_20282,
                                      "mem_20411")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_20413;
            
            mem_20413.references = NULL;
            if (memblock_alloc_device(ctx, &mem_20413, bytes_20282,
                                      "mem_20413")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 1,
                                                    sizeof(n_17882), &n_17882));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 2,
                                                    sizeof(paths_17885),
                                                    &paths_17885));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 3,
                                                    sizeof(steps_17886),
                                                    &steps_17886));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 4,
                                                    sizeof(a_17890), &a_17890));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 5,
                                                    sizeof(x_17910), &x_17910));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 6,
                                                    sizeof(x_17912), &x_17912));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 7,
                                                    sizeof(y_17914), &y_17914));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 8,
                                                    sizeof(y_17915), &y_17915));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 9,
                                                    sizeof(sims_per_year_17992),
                                                    &sims_per_year_17992));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 10,
                                                    sizeof(res_18320),
                                                    &res_18320));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 11,
                                                    sizeof(mem_20408.mem),
                                                    &mem_20408.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 12,
                                                    sizeof(mem_20411.mem),
                                                    &mem_20411.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19680, 13,
                                                    sizeof(mem_20413.mem),
                                                    &mem_20413.mem));
            if (1 * ((size_t) segmap_usable_groups_19912 *
                     (size_t) segmap_group_sizze_19911) != 0) {
                const size_t global_work_sizze_21572[1] =
                             {(size_t) segmap_usable_groups_19912 *
                             (size_t) segmap_group_sizze_19911};
                const size_t local_work_sizze_21576[1] =
                             {segmap_group_sizze_19911};
                int64_t time_start_21573 = 0, time_end_21574 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.segmap_19680");
                    fprintf(stderr, "%zu", global_work_sizze_21572[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_21576[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_21573 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainzisegmap_19680,
                                                                1, NULL,
                                                                global_work_sizze_21572,
                                                                local_work_sizze_21576,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainzisegmap_19680_runs,
                                                                                                          &ctx->mainzisegmap_19680_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_21574 = get_wall_time();
                    
                    long time_diff_21575 = time_end_21574 - time_start_21573;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.segmap_19680", time_diff_21575);
                }
            }
            if (memblock_unref_device(ctx, &mem_20408, "mem_20408") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_map_acc_mem_20434, &mem_20411,
                                    "mem_20411") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_20435, &mem_20413,
                                    "mem_20413") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20413, "mem_20413") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20411, "mem_20411") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20408, "mem_20408") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_20404, "mem_20404") != 0)
                return 1;
        } else {
            struct memblock_device res_map_acc_mem_20432;
            
            res_map_acc_mem_20432.references = NULL;
            
            struct memblock_device res_mem_20433;
            
            res_mem_20433.references = NULL;
            
            int32_t local_memory_capacity_21318;
            
            local_memory_capacity_21318 = ctx->opencl.max_local_memory;
            if (sle64((int32_t) sizeof(float) * paths_17885,
                      sext_i32_i64(local_memory_capacity_21318)) &&
                intra_suff_and_fits_19907) {
                struct memblock_device mem_20417;
                
                mem_20417.references = NULL;
                if (memblock_alloc_device(ctx, &mem_20417, bytes_20282,
                                          "mem_20417")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_20419;
                
                mem_20419.references = NULL;
                if (memblock_alloc_device(ctx, &mem_20419, bytes_20282,
                                          "mem_20419")) {
                    err = 1;
                    goto cleanup;
                }
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        1,
                                                        (int32_t) sizeof(float) *
                                                        paths_17885, NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        2, sizeof(n_17882),
                                                        &n_17882));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        3, sizeof(paths_17885),
                                                        &paths_17885));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        4, sizeof(a_17890),
                                                        &a_17890));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        5, sizeof(x_17910),
                                                        &x_17910));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        6, sizeof(x_17912),
                                                        &x_17912));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        7, sizeof(y_17914),
                                                        &y_17914));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        8, sizeof(y_17915),
                                                        &y_17915));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        9,
                                                        sizeof(sims_per_year_17992),
                                                        &sims_per_year_17992));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        10, sizeof(res_18320),
                                                        &res_18320));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        11,
                                                        sizeof(one_intra_par_min_18814),
                                                        &one_intra_par_min_18814));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        12,
                                                        sizeof(mem_20386.mem),
                                                        &mem_20386.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        13,
                                                        sizeof(mem_20417.mem),
                                                        &mem_20417.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_intragroup_19678,
                                                        14,
                                                        sizeof(mem_20419.mem),
                                                        &mem_20419.mem));
                if (1 * ((size_t) steps_17886 * (size_t) paths_17885) != 0) {
                    const size_t global_work_sizze_21577[1] =
                                 {(size_t) steps_17886 * (size_t) paths_17885};
                    const size_t local_work_sizze_21581[1] = {paths_17885};
                    int64_t time_start_21578 = 0, time_end_21579 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "main.segmap_intragroup_19678");
                        fprintf(stderr, "%zu", global_work_sizze_21577[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_21581[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) (0 + (int32_t) sizeof(float) *
                                       paths_17885));
                        time_start_21578 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->mainzisegmap_intragroup_19678,
                                                                    1, NULL,
                                                                    global_work_sizze_21577,
                                                                    local_work_sizze_21581,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->mainzisegmap_intragroup_19678_runs,
                                                                                                              &ctx->mainzisegmap_intragroup_19678_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_21579 = get_wall_time();
                        
                        long time_diff_21580 = time_end_21579 -
                             time_start_21578;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "main.segmap_intragroup_19678",
                                time_diff_21580);
                    }
                }
                if (memblock_set_device(ctx, &res_map_acc_mem_20432, &mem_20417,
                                        "mem_20417") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_20433, &mem_20419,
                                        "mem_20419") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_20419, "mem_20419") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_20417, "mem_20417") != 0)
                    return 1;
            } else {
                struct memblock_device mem_20423;
                
                mem_20423.references = NULL;
                if (memblock_alloc_device(ctx, &mem_20423, bytes_20392,
                                          "mem_20423")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_20423, 0,
                                                          mem_20386, 0, 1,
                                                          n_17882, paths_17885 *
                                                          steps_17886) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_20426;
                
                mem_20426.references = NULL;
                if (memblock_alloc_device(ctx, &mem_20426, bytes_20282,
                                          "mem_20426")) {
                    err = 1;
                    goto cleanup;
                }
                if (slt64(paths_17885 * 2, segred_group_sizze_19985)) {
                    int64_t segment_sizze_nonzzero_21251 = smax64(1,
                                                                  paths_17885);
                    int64_t num_threads_21252 = num_groups_19986 *
                            segred_group_sizze_19985;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-small");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) steps_17886, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) paths_17885, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segments_per_group",
                                (long long) squot64(segred_group_sizze_19985,
                                                    segment_sizze_nonzzero_21251),
                                '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "required_groups",
                                (long long) sext_i64_i32(sdiv_up64(steps_17886,
                                                                   squot64(segred_group_sizze_19985,
                                                                           segment_sizze_nonzzero_21251))),
                                '\n');
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_19830,
                                                            1,
                                                            (int32_t) sizeof(float) *
                                                            segred_group_sizze_19985,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_19830,
                                                            2, sizeof(n_17882),
                                                            &n_17882));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_19830,
                                                            3,
                                                            sizeof(paths_17885),
                                                            &paths_17885));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_19830,
                                                            4,
                                                            sizeof(steps_17886),
                                                            &steps_17886));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_19830,
                                                            5,
                                                            sizeof(num_groups_19986),
                                                            &num_groups_19986));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_19830,
                                                            6,
                                                            sizeof(mem_20423.mem),
                                                            &mem_20423.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_19830,
                                                            7,
                                                            sizeof(mem_20426.mem),
                                                            &mem_20426.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_19830,
                                                            8,
                                                            sizeof(segment_sizze_nonzzero_21251),
                                                            &segment_sizze_nonzzero_21251));
                    if (1 * ((size_t) num_groups_19986 *
                             (size_t) segred_group_sizze_19985) != 0) {
                        const size_t global_work_sizze_21582[1] =
                                     {(size_t) num_groups_19986 *
                                     (size_t) segred_group_sizze_19985};
                        const size_t local_work_sizze_21586[1] =
                                     {segred_group_sizze_19985};
                        int64_t time_start_21583 = 0, time_end_21584 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.segred_small_19830");
                            fprintf(stderr, "%zu", global_work_sizze_21582[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_21586[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(float) *
                                           segred_group_sizze_19985));
                            time_start_21583 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainzisegred_small_19830,
                                                                        1, NULL,
                                                                        global_work_sizze_21582,
                                                                        local_work_sizze_21586,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainzisegred_small_19830_runs,
                                                                                                                  &ctx->mainzisegred_small_19830_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_21584 = get_wall_time();
                            
                            long time_diff_21585 = time_end_21584 -
                                 time_start_21583;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.segred_small_19830", time_diff_21585);
                        }
                    }
                } else {
                    int64_t groups_per_segment_21273 =
                            sdiv_up64(num_groups_19986, smax64(1, steps_17886));
                    int64_t elements_per_thread_21274 = sdiv_up64(paths_17885,
                                                                  segred_group_sizze_19985 *
                                                                  groups_per_segment_21273);
                    int64_t virt_num_groups_21275 = groups_per_segment_21273 *
                            steps_17886;
                    int64_t num_threads_21276 = num_groups_19986 *
                            segred_group_sizze_19985;
                    int64_t threads_per_segment_21277 =
                            groups_per_segment_21273 * segred_group_sizze_19985;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-large");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) steps_17886, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) paths_17885, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                                (long long) virt_num_groups_21275, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_groups",
                                (long long) num_groups_19986, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "group_size",
                                (long long) segred_group_sizze_19985, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                                (long long) elements_per_thread_21274, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                                (long long) groups_per_segment_21273, '\n');
                    
                    struct memblock_device group_res_arr_mem_21278;
                    
                    group_res_arr_mem_21278.references = NULL;
                    if (memblock_alloc_device(ctx, &group_res_arr_mem_21278,
                                              (int32_t) sizeof(float) *
                                              (segred_group_sizze_19985 *
                                               virt_num_groups_21275),
                                              "group_res_arr_mem_21278")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    struct memblock_device mainzicounter_mem_21280 =
                                           ctx->mainzicounter_mem_21280;
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            1,
                                                            (int32_t) sizeof(bool),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            2,
                                                            (int32_t) sizeof(float) *
                                                            segred_group_sizze_19985,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            3, sizeof(n_17882),
                                                            &n_17882));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            4,
                                                            sizeof(paths_17885),
                                                            &paths_17885));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            5,
                                                            sizeof(steps_17886),
                                                            &steps_17886));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            6,
                                                            sizeof(num_groups_19986),
                                                            &num_groups_19986));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            7,
                                                            sizeof(mem_20423.mem),
                                                            &mem_20423.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            8,
                                                            sizeof(mem_20426.mem),
                                                            &mem_20426.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            9,
                                                            sizeof(groups_per_segment_21273),
                                                            &groups_per_segment_21273));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            10,
                                                            sizeof(elements_per_thread_21274),
                                                            &elements_per_thread_21274));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            11,
                                                            sizeof(virt_num_groups_21275),
                                                            &virt_num_groups_21275));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            12,
                                                            sizeof(threads_per_segment_21277),
                                                            &threads_per_segment_21277));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            13,
                                                            sizeof(group_res_arr_mem_21278.mem),
                                                            &group_res_arr_mem_21278.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_19830,
                                                            14,
                                                            sizeof(mainzicounter_mem_21280.mem),
                                                            &mainzicounter_mem_21280.mem));
                    if (1 * ((size_t) num_groups_19986 *
                             (size_t) segred_group_sizze_19985) != 0) {
                        const size_t global_work_sizze_21588[1] =
                                     {(size_t) num_groups_19986 *
                                     (size_t) segred_group_sizze_19985};
                        const size_t local_work_sizze_21592[1] =
                                     {segred_group_sizze_19985};
                        int64_t time_start_21589 = 0, time_end_21590 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.segred_large_19830");
                            fprintf(stderr, "%zu", global_work_sizze_21588[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_21592[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(bool) +
                                           (int32_t) sizeof(float) *
                                           segred_group_sizze_19985));
                            time_start_21589 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainzisegred_large_19830,
                                                                        1, NULL,
                                                                        global_work_sizze_21588,
                                                                        local_work_sizze_21592,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainzisegred_large_19830_runs,
                                                                                                                  &ctx->mainzisegred_large_19830_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_21590 = get_wall_time();
                            
                            long time_diff_21591 = time_end_21590 -
                                 time_start_21589;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.segred_large_19830", time_diff_21591);
                        }
                    }
                    if (memblock_unref_device(ctx, &group_res_arr_mem_21278,
                                              "group_res_arr_mem_21278") != 0)
                        return 1;
                }
                if (memblock_unref_device(ctx, &mem_20423, "mem_20423") != 0)
                    return 1;
                
                int64_t segmap_usable_groups_20002 = sdiv_up64(steps_17886,
                                                               segmap_group_sizze_20001);
                struct memblock_device mem_20429;
                
                mem_20429.references = NULL;
                if (memblock_alloc_device(ctx, &mem_20429, bytes_20282,
                                          "mem_20429")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_20431;
                
                mem_20431.references = NULL;
                if (memblock_alloc_device(ctx, &mem_20431, bytes_20282,
                                          "mem_20431")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        1, sizeof(steps_17886),
                                                        &steps_17886));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        2, sizeof(a_17890),
                                                        &a_17890));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        3, sizeof(x_17910),
                                                        &x_17910));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        4, sizeof(x_17912),
                                                        &x_17912));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        5, sizeof(y_17914),
                                                        &y_17914));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        6, sizeof(y_17915),
                                                        &y_17915));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        7,
                                                        sizeof(sims_per_year_17992),
                                                        &sims_per_year_17992));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        8, sizeof(res_18320),
                                                        &res_18320));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        9,
                                                        sizeof(mem_20426.mem),
                                                        &mem_20426.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        10,
                                                        sizeof(mem_20429.mem),
                                                        &mem_20429.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_19795,
                                                        11,
                                                        sizeof(mem_20431.mem),
                                                        &mem_20431.mem));
                if (1 * ((size_t) segmap_usable_groups_20002 *
                         (size_t) segmap_group_sizze_20001) != 0) {
                    const size_t global_work_sizze_21593[1] =
                                 {(size_t) segmap_usable_groups_20002 *
                                 (size_t) segmap_group_sizze_20001};
                    const size_t local_work_sizze_21597[1] =
                                 {segmap_group_sizze_20001};
                    int64_t time_start_21594 = 0, time_end_21595 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "main.segmap_19795");
                        fprintf(stderr, "%zu", global_work_sizze_21593[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_21597[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) 0);
                        time_start_21594 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->mainzisegmap_19795,
                                                                    1, NULL,
                                                                    global_work_sizze_21593,
                                                                    local_work_sizze_21597,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->mainzisegmap_19795_runs,
                                                                                                              &ctx->mainzisegmap_19795_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_21595 = get_wall_time();
                        
                        long time_diff_21596 = time_end_21595 -
                             time_start_21594;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "main.segmap_19795", time_diff_21596);
                    }
                }
                if (memblock_unref_device(ctx, &mem_20426, "mem_20426") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_map_acc_mem_20432, &mem_20429,
                                        "mem_20429") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_20433, &mem_20431,
                                        "mem_20431") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_20431, "mem_20431") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_20429, "mem_20429") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_20426, "mem_20426") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_20423, "mem_20423") != 0)
                    return 1;
            }
            if (memblock_set_device(ctx, &res_map_acc_mem_20434,
                                    &res_map_acc_mem_20432,
                                    "res_map_acc_mem_20432") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_20435, &res_mem_20433,
                                    "res_mem_20433") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_20433, "res_mem_20433") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_map_acc_mem_20432,
                                      "res_map_acc_mem_20432") != 0)
                return 1;
        }
        
        struct memblock_device mem_20438;
        
        mem_20438.references = NULL;
        if (memblock_alloc_device(ctx, &mem_20438, 4, "mem_20438")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mainzicounter_mem_21320 =
                               ctx->mainzicounter_mem_21320;
        struct memblock_device group_res_arr_mem_21322;
        
        group_res_arr_mem_21322.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_21322,
                                  (int32_t) sizeof(float) *
                                  (segred_group_sizze_20029 * num_groups_20030),
                                  "group_res_arr_mem_21322")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_21324;
        
        num_threads_21324 = num_groups_20030 * segred_group_sizze_20029;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19898,
                                                1, (int32_t) sizeof(float) *
                                                segred_group_sizze_20029,
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19898,
                                                2, (int32_t) sizeof(bool),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19898,
                                                3, sizeof(steps_17886),
                                                &steps_17886));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19898,
                                                4, sizeof(num_groups_20030),
                                                &num_groups_20030));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19898,
                                                5,
                                                sizeof(res_map_acc_mem_20434.mem),
                                                &res_map_acc_mem_20434.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19898,
                                                6, sizeof(mem_20438.mem),
                                                &mem_20438.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19898,
                                                7,
                                                sizeof(mainzicounter_mem_21320.mem),
                                                &mainzicounter_mem_21320.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19898,
                                                8,
                                                sizeof(group_res_arr_mem_21322.mem),
                                                &group_res_arr_mem_21322.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_19898,
                                                9, sizeof(num_threads_21324),
                                                &num_threads_21324));
        if (1 * ((size_t) num_groups_20030 *
                 (size_t) segred_group_sizze_20029) != 0) {
            const size_t global_work_sizze_21599[1] =
                         {(size_t) num_groups_20030 *
                         (size_t) segred_group_sizze_20029};
            const size_t local_work_sizze_21603[1] = {segred_group_sizze_20029};
            int64_t time_start_21600 = 0, time_end_21601 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segred_nonseg_19898");
                fprintf(stderr, "%zu", global_work_sizze_21599[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_21603[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + (int32_t) sizeof(float) *
                               segred_group_sizze_20029 +
                               (int32_t) sizeof(bool)));
                time_start_21600 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegred_nonseg_19898,
                                                            1, NULL,
                                                            global_work_sizze_21599,
                                                            local_work_sizze_21603,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegred_nonseg_19898_runs,
                                                                                                      &ctx->mainzisegred_nonseg_19898_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_21601 = get_wall_time();
                
                long time_diff_21602 = time_end_21601 - time_start_21600;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segred_nonseg_19898", time_diff_21602);
            }
        }
        if (memblock_unref_device(ctx, &res_map_acc_mem_20434,
                                  "res_map_acc_mem_20434") != 0)
            return 1;
        
        float read_res_21604;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_20438.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0 * sizeof(float),
                                                     sizeof(float),
                                                     &read_res_21604, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        float res_20037 = read_res_21604;
        
        if (memblock_unref_device(ctx, &mem_20438, "mem_20438") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_20442, &res_mem_20435,
                                "res_mem_20435") != 0)
            return 1;
        res_18337 = res_20037;
        if (memblock_unref_device(ctx, &group_res_arr_mem_21322,
                                  "group_res_arr_mem_21322") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_20438, "mem_20438") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_20435, "res_mem_20435") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_map_acc_mem_20434,
                                  "res_map_acc_mem_20434") != 0)
            return 1;
    }
    if (memblock_unref_device(ctx, &mem_20386, "mem_20386") != 0)
        return 1;
    
    float CVA_18376 = 6.0e-3F * res_18337;
    
    out_arrsizze_20531 = steps_17886;
    if (memblock_set_device(ctx, &out_mem_20530, &res_mem_20442,
                            "res_mem_20442") != 0)
        return 1;
    scalar_out_20529 = CVA_18376;
    *out_scalar_out_21381 = scalar_out_20529;
    (*out_mem_p_21382).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_21382, &out_mem_20530,
                            "out_mem_20530") != 0)
        return 1;
    *out_out_arrsizze_21383 = out_arrsizze_20531;
    if (memblock_unref_device(ctx, &res_mem_20442, "res_mem_20442") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20386, "mem_20386") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20384, "mem_20384") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20381, "mem_20381") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20379, "mem_20379") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20376, "mem_20376") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20374, "mem_20374") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20372, "mem_20372") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20369, "mem_20369") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20367, "mem_20367") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_subhistos_mem_20776,
                              "res_subhistos_mem_20776") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20363, "mem_20363") != 0)
        return 1;
    if (memblock_unref_device(ctx, &group_res_arr_mem_20737,
                              "group_res_arr_mem_20737") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20361, "mem_20361") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20358, "mem_20358") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20356, "mem_20356") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20353, "res_mem_20353") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20352, "res_mem_20352") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20279, "res_mem_20279") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20278, "res_mem_20278") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20277, "res_mem_20277") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_20276, "res_mem_20276") != 0)
        return 1;
    if (memblock_unref_device(ctx, &group_res_arr_mem_20535,
                              "group_res_arr_mem_20535") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_20229, "mem_20229") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_20530, "out_mem_20530") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
struct futhark_i64_1d {
    struct memblock_device mem;
    int64_t shape[1];
} ;
struct futhark_i64_1d *futhark_new_i64_1d(struct futhark_context *ctx, const
                                          int64_t *data, int64_t dim0)
{
    struct futhark_i64_1d *bad = NULL;
    struct futhark_i64_1d *arr =
                          (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(int64_t),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * sizeof(int64_t) > 0)
        OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                      arr->mem.mem, CL_TRUE, 0,
                                                      (size_t) dim0 *
                                                      sizeof(int64_t), data + 0,
                                                      0, NULL,
                                                      ctx->profiling_paused ||
                                                      !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                &ctx->copy_dev_to_host_runs,
                                                                                                &ctx->copy_dev_to_host_total_runtime)));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_i64_1d *futhark_new_raw_i64_1d(struct futhark_context *ctx, const
                                              cl_mem data, int offset,
                                              int64_t dim0)
{
    struct futhark_i64_1d *bad = NULL;
    struct futhark_i64_1d *arr =
                          (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(int64_t),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * sizeof(int64_t) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue, data,
                                                     arr->mem.mem, offset, 0,
                                                     (size_t) dim0 *
                                                     sizeof(int64_t), 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
        if (ctx->debugging)
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
    }
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr)
{
    lock_lock(&ctx->lock);
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_i64_1d(struct futhark_context *ctx,
                          struct futhark_i64_1d *arr, int64_t *data)
{
    lock_lock(&ctx->lock);
    if ((size_t) arr->shape[0] * sizeof(int64_t) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     arr->mem.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0, (size_t) arr->shape[0] *
                                                     sizeof(int64_t), data + 0,
                                                     0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_host_to_dev_runs,
                                                                                               &ctx->copy_host_to_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
    }
    lock_unlock(&ctx->lock);
    return 0;
}
cl_mem futhark_values_raw_i64_1d(struct futhark_context *ctx,
                                 struct futhark_i64_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_i64_1d(struct futhark_context *ctx,
                                    struct futhark_i64_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_f32_1d {
    struct memblock_device mem;
    int64_t shape[1];
} ;
struct futhark_f32_1d *futhark_new_f32_1d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0)
{
    struct futhark_f32_1d *bad = NULL;
    struct futhark_f32_1d *arr =
                          (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(float),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * sizeof(float) > 0)
        OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                      arr->mem.mem, CL_TRUE, 0,
                                                      (size_t) dim0 *
                                                      sizeof(float), data + 0,
                                                      0, NULL,
                                                      ctx->profiling_paused ||
                                                      !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                &ctx->copy_dev_to_host_runs,
                                                                                                &ctx->copy_dev_to_host_total_runtime)));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_f32_1d *futhark_new_raw_f32_1d(struct futhark_context *ctx, const
                                              cl_mem data, int offset,
                                              int64_t dim0)
{
    struct futhark_f32_1d *bad = NULL;
    struct futhark_f32_1d *arr =
                          (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(float),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * sizeof(float) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue, data,
                                                     arr->mem.mem, offset, 0,
                                                     (size_t) dim0 *
                                                     sizeof(float), 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
        if (ctx->debugging)
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
    }
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f32_1d(struct futhark_context *ctx, struct futhark_f32_1d *arr)
{
    lock_lock(&ctx->lock);
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f32_1d(struct futhark_context *ctx,
                          struct futhark_f32_1d *arr, float *data)
{
    lock_lock(&ctx->lock);
    if ((size_t) arr->shape[0] * sizeof(float) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     arr->mem.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0, (size_t) arr->shape[0] *
                                                     sizeof(float), data + 0, 0,
                                                     NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_host_to_dev_runs,
                                                                                               &ctx->copy_host_to_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
    }
    lock_unlock(&ctx->lock);
    return 0;
}
cl_mem futhark_values_raw_f32_1d(struct futhark_context *ctx,
                                 struct futhark_f32_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f32_1d(struct futhark_context *ctx,
                                    struct futhark_f32_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
int futhark_entry_main(struct futhark_context *ctx, float *out0,
                       struct futhark_f32_1d **out1, const int64_t in0, const
                       int64_t in1, const struct futhark_f32_1d *in2, const
                       struct futhark_i64_1d *in3, const
                       struct futhark_f32_1d *in4, const float in5, const
                       float in6, const float in7, const float in8)
{
    struct memblock_device swap_term_mem_20224;
    
    swap_term_mem_20224.references = NULL;
    
    struct memblock_device payments_mem_20225;
    
    payments_mem_20225.references = NULL;
    
    struct memblock_device notional_mem_20226;
    
    notional_mem_20226.references = NULL;
    
    int64_t n_17882;
    int64_t n_17883;
    int64_t n_17884;
    int64_t paths_17885;
    int64_t steps_17886;
    float a_17890;
    float b_17891;
    float sigma_17892;
    float r0_17893;
    float scalar_out_20529;
    struct memblock_device out_mem_20530;
    
    out_mem_20530.references = NULL;
    
    int64_t out_arrsizze_20531;
    
    lock_lock(&ctx->lock);
    paths_17885 = in0;
    steps_17886 = in1;
    swap_term_mem_20224 = in2->mem;
    n_17882 = in2->shape[0];
    payments_mem_20225 = in3->mem;
    n_17883 = in3->shape[0];
    notional_mem_20226 = in4->mem;
    n_17884 = in4->shape[0];
    a_17890 = in5;
    b_17891 = in6;
    sigma_17892 = in7;
    r0_17893 = in8;
    
    int ret = futrts_main(ctx, &scalar_out_20529, &out_mem_20530,
                          &out_arrsizze_20531, swap_term_mem_20224,
                          payments_mem_20225, notional_mem_20226, n_17882,
                          n_17883, n_17884, paths_17885, steps_17886, a_17890,
                          b_17891, sigma_17892, r0_17893);
    
    if (ret == 0) {
        *out0 = scalar_out_20529;
        assert((*out1 =
                (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d))) !=
            NULL);
        (*out1)->mem = out_mem_20530;
        (*out1)->shape[0] = out_arrsizze_20531;
    }
    lock_unlock(&ctx->lock);
    return ret;
}
