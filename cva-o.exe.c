#ifdef __GNUC__
#pragma GCC diagnostic ignored "-Wunused-function"
#pragma GCC diagnostic ignored "-Wunused-variable"
#pragma GCC diagnostic ignored "-Wparentheses"
#pragma GCC diagnostic ignored "-Wunused-label"
#endif
#ifdef __clang__
#pragma clang diagnostic ignored "-Wunused-function"
#pragma clang diagnostic ignored "-Wunused-variable"
#pragma clang diagnostic ignored "-Wparentheses"
#pragma clang diagnostic ignored "-Wunused-label"
#endif
// Headers

#define _GNU_SOURCE
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#define CL_TARGET_OPENCL_VERSION 120
#define CL_USE_DEPRECATED_OPENCL_1_2_APIS
#ifdef __APPLE__
#define CL_SILENCE_DEPRECATION
#include <OpenCL/cl.h>
#else
#include <CL/cl.h>
#endif


// Initialisation

int futhark_get_num_sizes(void);
const char *futhark_get_size_name(int);
const char *futhark_get_size_class(int);
struct futhark_context_config ;
struct futhark_context_config *futhark_context_config_new(void);
void futhark_context_config_free(struct futhark_context_config *cfg);
void futhark_context_config_add_build_option(struct futhark_context_config *cfg,
                                             const char *opt);
void futhark_context_config_set_debugging(struct futhark_context_config *cfg,
                                          int flag);
void futhark_context_config_set_profiling(struct futhark_context_config *cfg,
                                          int flag);
void futhark_context_config_set_logging(struct futhark_context_config *cfg,
                                        int flag);
void futhark_context_config_set_device(struct futhark_context_config *cfg, const
                                       char *s);
void futhark_context_config_set_platform(struct futhark_context_config *cfg,
                                         const char *s);
void
futhark_context_config_select_device_interactively(struct futhark_context_config *cfg);
void futhark_context_config_list_devices(struct futhark_context_config *cfg);
void futhark_context_config_dump_program_to(struct futhark_context_config *cfg,
                                            const char *path);
void
futhark_context_config_load_program_from(struct futhark_context_config *cfg,
                                         const char *path);
void futhark_context_config_dump_binary_to(struct futhark_context_config *cfg,
                                           const char *path);
void futhark_context_config_load_binary_from(struct futhark_context_config *cfg,
                                             const char *path);
void
futhark_context_config_set_default_group_size(struct futhark_context_config *cfg,
                                              int size);
void
futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg,
                                              int num);
void
futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg,
                                             int num);
void
futhark_context_config_set_default_threshold(struct futhark_context_config *cfg,
                                             int num);
int futhark_context_config_set_size(struct futhark_context_config *cfg, const
                                    char *size_name, size_t size_value);
struct futhark_context ;
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg);
struct futhark_context
*futhark_context_new_with_command_queue(struct futhark_context_config *cfg,
                                        cl_command_queue queue);
void futhark_context_free(struct futhark_context *ctx);
cl_command_queue futhark_context_get_command_queue(struct futhark_context *ctx);

// Arrays

struct futhark_f32_1d ;
struct futhark_f32_1d *futhark_new_f32_1d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0);
struct futhark_f32_1d *futhark_new_raw_f32_1d(struct futhark_context *ctx, const
                                              cl_mem data, int offset,
                                              int64_t dim0);
int futhark_free_f32_1d(struct futhark_context *ctx,
                        struct futhark_f32_1d *arr);
int futhark_values_f32_1d(struct futhark_context *ctx,
                          struct futhark_f32_1d *arr, float *data);
cl_mem futhark_values_raw_f32_1d(struct futhark_context *ctx,
                                 struct futhark_f32_1d *arr);
const int64_t *futhark_shape_f32_1d(struct futhark_context *ctx,
                                    struct futhark_f32_1d *arr);
struct futhark_i64_1d ;
struct futhark_i64_1d *futhark_new_i64_1d(struct futhark_context *ctx, const
                                          int64_t *data, int64_t dim0);
struct futhark_i64_1d *futhark_new_raw_i64_1d(struct futhark_context *ctx, const
                                              cl_mem data, int offset,
                                              int64_t dim0);
int futhark_free_i64_1d(struct futhark_context *ctx,
                        struct futhark_i64_1d *arr);
int futhark_values_i64_1d(struct futhark_context *ctx,
                          struct futhark_i64_1d *arr, int64_t *data);
cl_mem futhark_values_raw_i64_1d(struct futhark_context *ctx,
                                 struct futhark_i64_1d *arr);
const int64_t *futhark_shape_i64_1d(struct futhark_context *ctx,
                                    struct futhark_i64_1d *arr);

// Opaque values


// Entry points

int futhark_entry_main(struct futhark_context *ctx, float *out0,
                       struct futhark_f32_1d **out1, const int64_t in0, const
                       int64_t in1, const struct futhark_f32_1d *in2, const
                       struct futhark_i64_1d *in3, const
                       struct futhark_f32_1d *in4, const float in5, const
                       float in6, const float in7, const float in8);
int futhark_entry_test(struct futhark_context *ctx, float *out0, const
                       int64_t in0, const int64_t in1);

// Miscellaneous

int futhark_context_sync(struct futhark_context *ctx);
int futhark_context_clear_caches(struct futhark_context *ctx);
char *futhark_context_report(struct futhark_context *ctx);
char *futhark_context_get_error(struct futhark_context *ctx);
void futhark_context_pause_profiling(struct futhark_context *ctx);
void futhark_context_unpause_profiling(struct futhark_context *ctx);
#define FUTHARK_BACKEND_opencl
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <math.h>
#include <stdint.h>
#undef NDEBUG
#include <assert.h>
#include <stdarg.h>
// Start of util.h.
//
// Various helper functions that are useful in all generated C code.

#include <errno.h>
#include <string.h>

static const char *fut_progname = "(embedded Futhark)";

static void futhark_panic(int eval, const char *fmt, ...) {
  va_list ap;
  va_start(ap, fmt);
  fprintf(stderr, "%s: ", fut_progname);
  vfprintf(stderr, fmt, ap);
  va_end(ap);
  exit(eval);
}

// For generating arbitrary-sized error messages.  It is the callers
// responsibility to free the buffer at some point.
static char* msgprintf(const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = 1 + (size_t)vsnprintf(NULL, 0, s, vl);
  char *buffer = (char*) malloc(needed);
  va_start(vl, s); // Must re-init.
  vsnprintf(buffer, needed, s, vl);
  return buffer;
}


static inline void check_err(int errval, int sets_errno, const char *fun, int line,
                            const char *msg, ...)
{
  if (errval) {
    char str[256];
    char errnum[10];
    sprintf(errnum, "%d", errval);
    sprintf(str, "ERROR: %s in %s() at line %d with error code %s\n", msg, fun, line,
            sets_errno ? strerror(errno) : errnum);
    fprintf(stderr, "%s", str);
    exit(errval);
  }
}

#define CHECK_ERR(err, msg...) check_err(err, 0, __func__, __LINE__, msg)
#define CHECK_ERRNO(err, msg...) check_err(err, 1, __func__, __LINE__, msg)

// Read a file into a NUL-terminated string; returns NULL on error.
static void* slurp_file(const char *filename, size_t *size) {
  unsigned char *s;
  FILE *f = fopen(filename, "rb"); // To avoid Windows messing with linebreaks.
  if (f == NULL) return NULL;
  fseek(f, 0, SEEK_END);
  size_t src_size = ftell(f);
  fseek(f, 0, SEEK_SET);
  s = (unsigned char*) malloc(src_size + 1);
  if (fread(s, 1, src_size, f) != src_size) {
    free(s);
    s = NULL;
  } else {
    s[src_size] = '\0';
  }
  fclose(f);

  if (size) {
    *size = src_size;
  }

  return s;
}

// Dump 'n' bytes from 'buf' into the file at the designated location.
// Returns 0 on success.
static int dump_file(const char *file, const void *buf, size_t n) {
  FILE *f = fopen(file, "w");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(buf, sizeof(char), n, f) != n) {
    return 1;
  }

  if (fclose(f) != 0) {
    return 1;
  }

  return 0;
}

struct str_builder {
  char *str;
  size_t capacity; // Size of buffer.
  size_t used; // Bytes used, *not* including final zero.
};

static void str_builder_init(struct str_builder *b) {
  b->capacity = 10;
  b->used = 0;
  b->str = malloc(b->capacity);
  b->str[0] = 0;
}

static void str_builder(struct str_builder *b, const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = (size_t)vsnprintf(NULL, 0, s, vl);

  while (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }

  va_start(vl, s); // Must re-init.
  vsnprintf(b->str+b->used, b->capacity-b->used, s, vl);
  b->used += needed;
}

// End of util.h.

// Start of timing.h.

// The function get_wall_time() returns the wall time in microseconds
// (with an unspecified offset).

#ifdef _WIN32

#include <windows.h>

static int64_t get_wall_time(void) {
  LARGE_INTEGER time,freq;
  assert(QueryPerformanceFrequency(&freq));
  assert(QueryPerformanceCounter(&time));
  return ((double)time.QuadPart / freq.QuadPart) * 1000000;
}

#else
// Assuming POSIX

#include <time.h>
#include <sys/time.h>

static int64_t get_wall_time(void) {
  struct timeval time;
  assert(gettimeofday(&time,NULL) == 0);
  return time.tv_sec * 1000000 + time.tv_usec;
}

static int64_t get_wall_time_ns(void) {
  struct timespec time;
  assert(clock_gettime(CLOCK_REALTIME, &time) == 0);
  return time.tv_sec * 1000000000 + time.tv_nsec;
}


static inline uint64_t rdtsc() {
  unsigned int hi, lo;
  __asm__ __volatile__("rdtsc" : "=a"(lo), "=d"(hi));
  return  ((uint64_t) lo) | (((uint64_t) hi) << 32);
}

static inline void rdtsc_wait(uint64_t n) {
  const uint64_t start = rdtsc();
  while (rdtsc() < (start + n)) {
    __asm__("PAUSE");
  }
}
static inline void spin_for(uint64_t nb_cycles) {
  rdtsc_wait(nb_cycles);
}


#endif

// End of timing.h.

#include <string.h>
#include <inttypes.h>
#include <errno.h>
#include <ctype.h>
#include <errno.h>
#include <getopt.h>
// Start of values.h.

//// Text I/O

typedef int (*writer)(FILE*, const void*);
typedef int (*bin_reader)(void*);
typedef int (*str_reader)(const char *, void*);

struct array_reader {
  char* elems;
  int64_t n_elems_space;
  int64_t elem_size;
  int64_t n_elems_used;
  int64_t *shape;
  str_reader elem_reader;
};

static void skipspaces() {
  int c;
  do {
    c = getchar();
  } while (isspace(c));

  if (c != EOF) {
    ungetc(c, stdin);
  }
}

static int constituent(char c) {
  return isalnum(c) || c == '.' || c == '-' || c == '+' || c == '_';
}

// Produces an empty token only on EOF.
static void next_token(char *buf, int bufsize) {
 start:
  skipspaces();

  int i = 0;
  while (i < bufsize) {
    int c = getchar();
    buf[i] = (char)c;

    if (c == EOF) {
      buf[i] = 0;
      return;
    } else if (c == '-' && i == 1 && buf[0] == '-') {
      // Line comment, so skip to end of line and start over.
      for (; c != '\n' && c != EOF; c = getchar());
      goto start;
    } else if (!constituent((char)c)) {
      if (i == 0) {
        // We permit single-character tokens that are not
        // constituents; this lets things like ']' and ',' be
        // tokens.
        buf[i+1] = 0;
        return;
      } else {
        ungetc(c, stdin);
        buf[i] = 0;
        return;
      }
    }

    i++;
  }

  buf[bufsize-1] = 0;
}

static int next_token_is(char *buf, int bufsize, const char* expected) {
  next_token(buf, bufsize);
  return strcmp(buf, expected) == 0;
}

static void remove_underscores(char *buf) {
  char *w = buf;

  for (char *r = buf; *r; r++) {
    if (*r != '_') {
      *w++ = *r;
    }
  }

  *w++ = 0;
}

static int read_str_elem(char *buf, struct array_reader *reader) {
  int ret;
  if (reader->n_elems_used == reader->n_elems_space) {
    reader->n_elems_space *= 2;
    reader->elems = (char*) realloc(reader->elems,
                                    (size_t)(reader->n_elems_space * reader->elem_size));
  }

  ret = reader->elem_reader(buf, reader->elems + reader->n_elems_used * reader->elem_size);

  if (ret == 0) {
    reader->n_elems_used++;
  }

  return ret;
}

static int read_str_array_elems(char *buf, int bufsize,
                                struct array_reader *reader, int64_t dims) {
  int ret;
  int first = 1;
  char *knows_dimsize = (char*) calloc((size_t)dims, sizeof(char));
  int cur_dim = dims-1;
  int64_t *elems_read_in_dim = (int64_t*) calloc((size_t)dims, sizeof(int64_t));

  while (1) {
    next_token(buf, bufsize);

    if (strcmp(buf, "]") == 0) {
      if (knows_dimsize[cur_dim]) {
        if (reader->shape[cur_dim] != elems_read_in_dim[cur_dim]) {
          ret = 1;
          break;
        }
      } else {
        knows_dimsize[cur_dim] = 1;
        reader->shape[cur_dim] = elems_read_in_dim[cur_dim];
      }
      if (cur_dim == 0) {
        ret = 0;
        break;
      } else {
        cur_dim--;
        elems_read_in_dim[cur_dim]++;
      }
    } else if (strcmp(buf, ",") == 0) {
      next_token(buf, bufsize);
      if (strcmp(buf, "[") == 0) {
        if (cur_dim == dims - 1) {
          ret = 1;
          break;
        }
        first = 1;
        cur_dim++;
        elems_read_in_dim[cur_dim] = 0;
      } else if (cur_dim == dims - 1) {
        ret = read_str_elem(buf, reader);
        if (ret != 0) {
          break;
        }
        elems_read_in_dim[cur_dim]++;
      } else {
        ret = 1;
        break;
      }
    } else if (strlen(buf) == 0) {
      // EOF
      ret = 1;
      break;
    } else if (first) {
      if (strcmp(buf, "[") == 0) {
        if (cur_dim == dims - 1) {
          ret = 1;
          break;
        }
        cur_dim++;
        elems_read_in_dim[cur_dim] = 0;
      } else {
        ret = read_str_elem(buf, reader);
        if (ret != 0) {
          break;
        }
        elems_read_in_dim[cur_dim]++;
        first = 0;
      }
    } else {
      ret = 1;
      break;
    }
  }

  free(knows_dimsize);
  free(elems_read_in_dim);
  return ret;
}

static int read_str_empty_array(char *buf, int bufsize,
                                const char *type_name, int64_t *shape, int64_t dims) {
  if (strlen(buf) == 0) {
    // EOF
    return 1;
  }

  if (strcmp(buf, "empty") != 0) {
    return 1;
  }

  if (!next_token_is(buf, bufsize, "(")) {
    return 1;
  }

  for (int i = 0; i < dims; i++) {
    if (!next_token_is(buf, bufsize, "[")) {
      return 1;
    }

    next_token(buf, bufsize);

    if (sscanf(buf, "%"SCNu64, (uint64_t*)&shape[i]) != 1) {
      return 1;
    }

    if (!next_token_is(buf, bufsize, "]")) {
      return 1;
    }
  }

  if (!next_token_is(buf, bufsize, type_name)) {
    return 1;
  }


  if (!next_token_is(buf, bufsize, ")")) {
    return 1;
  }

  // Check whether the array really is empty.
  for (int i = 0; i < dims; i++) {
    if (shape[i] == 0) {
      return 0;
    }
  }

  // Not an empty array!
  return 1;
}

static int read_str_array(int64_t elem_size, str_reader elem_reader,
                          const char *type_name,
                          void **data, int64_t *shape, int64_t dims) {
  int ret;
  struct array_reader reader;
  char buf[100];

  int dims_seen;
  for (dims_seen = 0; dims_seen < dims; dims_seen++) {
    if (!next_token_is(buf, sizeof(buf), "[")) {
      break;
    }
  }

  if (dims_seen == 0) {
    return read_str_empty_array(buf, sizeof(buf), type_name, shape, dims);
  }

  if (dims_seen != dims) {
    return 1;
  }

  reader.shape = shape;
  reader.n_elems_used = 0;
  reader.elem_size = elem_size;
  reader.n_elems_space = 16;
  reader.elems = (char*) realloc(*data, (size_t)(elem_size*reader.n_elems_space));
  reader.elem_reader = elem_reader;

  ret = read_str_array_elems(buf, sizeof(buf), &reader, dims);

  *data = reader.elems;

  return ret;
}

#define READ_STR(MACRO, PTR, SUFFIX)                                   \
  remove_underscores(buf);                                              \
  int j;                                                                \
  if (sscanf(buf, "%"MACRO"%n", (PTR*)dest, &j) == 1) {                 \
    return !(strcmp(buf+j, "") == 0 || strcmp(buf+j, SUFFIX) == 0);     \
  } else {                                                              \
    return 1;                                                           \
  }

static int read_str_i8(char *buf, void* dest) {
  // Some platforms (WINDOWS) does not support scanf %hhd or its
  // cousin, %SCNi8.  Read into int first to avoid corrupting
  // memory.
  //
  // https://gcc.gnu.org/bugzilla/show_bug.cgi?id=63417
  remove_underscores(buf);
  int j, x;
  if (sscanf(buf, "%i%n", &x, &j) == 1) {
    *(int8_t*)dest = (int8_t)x;
    return !(strcmp(buf+j, "") == 0 || strcmp(buf+j, "i8") == 0);
  } else {
    return 1;
  }
}

static int read_str_u8(char *buf, void* dest) {
  // Some platforms (WINDOWS) does not support scanf %hhd or its
  // cousin, %SCNu8.  Read into int first to avoid corrupting
  // memory.
  //
  // https://gcc.gnu.org/bugzilla/show_bug.cgi?id=63417
  remove_underscores(buf);
  int j, x;
  if (sscanf(buf, "%i%n", &x, &j) == 1) {
    *(uint8_t*)dest = (uint8_t)x;
    return !(strcmp(buf+j, "") == 0 || strcmp(buf+j, "u8") == 0);
  } else {
    return 1;
  }
}

static int read_str_i16(char *buf, void* dest) {
  READ_STR(SCNi16, int16_t, "i16");
}

static int read_str_u16(char *buf, void* dest) {
  READ_STR(SCNi16, int16_t, "u16");
}

static int read_str_i32(char *buf, void* dest) {
  READ_STR(SCNi32, int32_t, "i32");
}

static int read_str_u32(char *buf, void* dest) {
  READ_STR(SCNi32, int32_t, "u32");
}

static int read_str_i64(char *buf, void* dest) {
  READ_STR(SCNi64, int64_t, "i64");
}

static int read_str_u64(char *buf, void* dest) {
  // FIXME: This is not correct, as SCNu64 only permits decimal
  // literals.  However, SCNi64 does not handle very large numbers
  // correctly (it's really for signed numbers, so that's fair).
  READ_STR(SCNu64, uint64_t, "u64");
}

static int read_str_f32(char *buf, void* dest) {
  remove_underscores(buf);
  if (strcmp(buf, "f32.nan") == 0) {
    *(float*)dest = NAN;
    return 0;
  } else if (strcmp(buf, "f32.inf") == 0) {
    *(float*)dest = INFINITY;
    return 0;
  } else if (strcmp(buf, "-f32.inf") == 0) {
    *(float*)dest = -INFINITY;
    return 0;
  } else {
    READ_STR("f", float, "f32");
  }
}

static int read_str_f64(char *buf, void* dest) {
  remove_underscores(buf);
  if (strcmp(buf, "f64.nan") == 0) {
    *(double*)dest = NAN;
    return 0;
  } else if (strcmp(buf, "f64.inf") == 0) {
    *(double*)dest = INFINITY;
    return 0;
  } else if (strcmp(buf, "-f64.inf") == 0) {
    *(double*)dest = -INFINITY;
    return 0;
  } else {
    READ_STR("lf", double, "f64");
  }
}

static int read_str_bool(char *buf, void* dest) {
  if (strcmp(buf, "true") == 0) {
    *(char*)dest = 1;
    return 0;
  } else if (strcmp(buf, "false") == 0) {
    *(char*)dest = 0;
    return 0;
  } else {
    return 1;
  }
}

static int write_str_i8(FILE *out, int8_t *src) {
  return fprintf(out, "%hhdi8", *src);
}

static int write_str_u8(FILE *out, uint8_t *src) {
  return fprintf(out, "%hhuu8", *src);
}

static int write_str_i16(FILE *out, int16_t *src) {
  return fprintf(out, "%hdi16", *src);
}

static int write_str_u16(FILE *out, uint16_t *src) {
  return fprintf(out, "%huu16", *src);
}

static int write_str_i32(FILE *out, int32_t *src) {
  return fprintf(out, "%di32", *src);
}

static int write_str_u32(FILE *out, uint32_t *src) {
  return fprintf(out, "%uu32", *src);
}

static int write_str_i64(FILE *out, int64_t *src) {
  return fprintf(out, "%"PRIi64"i64", *src);
}

static int write_str_u64(FILE *out, uint64_t *src) {
  return fprintf(out, "%"PRIu64"u64", *src);
}

static int write_str_f32(FILE *out, float *src) {
  float x = *src;
  if (isnan(x)) {
    return fprintf(out, "f32.nan");
  } else if (isinf(x) && x >= 0) {
    return fprintf(out, "f32.inf");
  } else if (isinf(x)) {
    return fprintf(out, "-f32.inf");
  } else {
    return fprintf(out, "%.6ff32", x);
  }
}

static int write_str_f64(FILE *out, double *src) {
  double x = *src;
  if (isnan(x)) {
    return fprintf(out, "f64.nan");
  } else if (isinf(x) && x >= 0) {
    return fprintf(out, "f64.inf");
  } else if (isinf(x)) {
    return fprintf(out, "-f64.inf");
  } else {
    return fprintf(out, "%.6ff64", *src);
  }
}

static int write_str_bool(FILE *out, void *src) {
  return fprintf(out, *(char*)src ? "true" : "false");
}

//// Binary I/O

#define BINARY_FORMAT_VERSION 2
#define IS_BIG_ENDIAN (!*(unsigned char *)&(uint16_t){1})

static void flip_bytes(int elem_size, unsigned char *elem) {
  for (int j=0; j<elem_size/2; j++) {
    unsigned char head = elem[j];
    int tail_index = elem_size-1-j;
    elem[j] = elem[tail_index];
    elem[tail_index] = head;
  }
}

// On Windows we need to explicitly set the file mode to not mangle
// newline characters.  On *nix there is no difference.
#ifdef _WIN32
#include <io.h>
#include <fcntl.h>
static void set_binary_mode(FILE *f) {
  setmode(fileno(f), O_BINARY);
}
#else
static void set_binary_mode(FILE *f) {
  (void)f;
}
#endif

static int read_byte(void* dest) {
  int num_elems_read = fread(dest, 1, 1, stdin);
  return num_elems_read == 1 ? 0 : 1;
}

//// Types

struct primtype_info_t {
  const char binname[4]; // Used for parsing binary data.
  const char* type_name; // Same name as in Futhark.
  const int64_t size; // in bytes
  const writer write_str; // Write in text format.
  const str_reader read_str; // Read in text format.
};

static const struct primtype_info_t i8_info =
  {.binname = "  i8", .type_name = "i8",   .size = 1,
   .write_str = (writer)write_str_i8, .read_str = (str_reader)read_str_i8};
static const struct primtype_info_t i16_info =
  {.binname = " i16", .type_name = "i16",  .size = 2,
   .write_str = (writer)write_str_i16, .read_str = (str_reader)read_str_i16};
static const struct primtype_info_t i32_info =
  {.binname = " i32", .type_name = "i32",  .size = 4,
   .write_str = (writer)write_str_i32, .read_str = (str_reader)read_str_i32};
static const struct primtype_info_t i64_info =
  {.binname = " i64", .type_name = "i64",  .size = 8,
   .write_str = (writer)write_str_i64, .read_str = (str_reader)read_str_i64};
static const struct primtype_info_t u8_info =
  {.binname = "  u8", .type_name = "u8",   .size = 1,
   .write_str = (writer)write_str_u8, .read_str = (str_reader)read_str_u8};
static const struct primtype_info_t u16_info =
  {.binname = " u16", .type_name = "u16",  .size = 2,
   .write_str = (writer)write_str_u16, .read_str = (str_reader)read_str_u16};
static const struct primtype_info_t u32_info =
  {.binname = " u32", .type_name = "u32",  .size = 4,
   .write_str = (writer)write_str_u32, .read_str = (str_reader)read_str_u32};
static const struct primtype_info_t u64_info =
  {.binname = " u64", .type_name = "u64",  .size = 8,
   .write_str = (writer)write_str_u64, .read_str = (str_reader)read_str_u64};
static const struct primtype_info_t f32_info =
  {.binname = " f32", .type_name = "f32",  .size = 4,
   .write_str = (writer)write_str_f32, .read_str = (str_reader)read_str_f32};
static const struct primtype_info_t f64_info =
  {.binname = " f64", .type_name = "f64",  .size = 8,
   .write_str = (writer)write_str_f64, .read_str = (str_reader)read_str_f64};
static const struct primtype_info_t bool_info =
  {.binname = "bool", .type_name = "bool", .size = 1,
   .write_str = (writer)write_str_bool, .read_str = (str_reader)read_str_bool};

static const struct primtype_info_t* primtypes[] = {
  &i8_info, &i16_info, &i32_info, &i64_info,
  &u8_info, &u16_info, &u32_info, &u64_info,
  &f32_info, &f64_info,
  &bool_info,
  NULL // NULL-terminated
};

// General value interface.  All endian business taken care of at
// lower layers.

static int read_is_binary() {
  skipspaces();
  int c = getchar();
  if (c == 'b') {
    int8_t bin_version;
    int ret = read_byte(&bin_version);

    if (ret != 0) { futhark_panic(1, "binary-input: could not read version.\n"); }

    if (bin_version != BINARY_FORMAT_VERSION) {
      futhark_panic(1, "binary-input: File uses version %i, but I only understand version %i.\n",
            bin_version, BINARY_FORMAT_VERSION);
    }

    return 1;
  }
  ungetc(c, stdin);
  return 0;
}

static const struct primtype_info_t* read_bin_read_type_enum() {
  char read_binname[4];

  int num_matched = scanf("%4c", read_binname);
  if (num_matched != 1) { futhark_panic(1, "binary-input: Couldn't read element type.\n"); }

  const struct primtype_info_t **type = primtypes;

  for (; *type != NULL; type++) {
    // I compare the 4 characters manually instead of using strncmp because
    // this allows any value to be used, also NULL bytes
    if (memcmp(read_binname, (*type)->binname, 4) == 0) {
      return *type;
    }
  }
  futhark_panic(1, "binary-input: Did not recognize the type '%s'.\n", read_binname);
  return NULL;
}

static void read_bin_ensure_scalar(const struct primtype_info_t *expected_type) {
  int8_t bin_dims;
  int ret = read_byte(&bin_dims);
  if (ret != 0) { futhark_panic(1, "binary-input: Couldn't get dims.\n"); }

  if (bin_dims != 0) {
    futhark_panic(1, "binary-input: Expected scalar (0 dimensions), but got array with %i dimensions.\n",
          bin_dims);
  }

  const struct primtype_info_t *bin_type = read_bin_read_type_enum();
  if (bin_type != expected_type) {
    futhark_panic(1, "binary-input: Expected scalar of type %s but got scalar of type %s.\n",
          expected_type->type_name,
          bin_type->type_name);
  }
}

//// High-level interface

static int read_bin_array(const struct primtype_info_t *expected_type, void **data, int64_t *shape, int64_t dims) {
  int ret;

  int8_t bin_dims;
  ret = read_byte(&bin_dims);
  if (ret != 0) { futhark_panic(1, "binary-input: Couldn't get dims.\n"); }

  if (bin_dims != dims) {
    futhark_panic(1, "binary-input: Expected %i dimensions, but got array with %i dimensions.\n",
          dims, bin_dims);
  }

  const struct primtype_info_t *bin_primtype = read_bin_read_type_enum();
  if (expected_type != bin_primtype) {
    futhark_panic(1, "binary-input: Expected %iD-array with element type '%s' but got %iD-array with element type '%s'.\n",
          dims, expected_type->type_name, dims, bin_primtype->type_name);
  }

  int64_t elem_count = 1;
  for (int i=0; i<dims; i++) {
    int64_t bin_shape;
    ret = fread(&bin_shape, sizeof(bin_shape), 1, stdin);
    if (ret != 1) {
      futhark_panic(1, "binary-input: Couldn't read size for dimension %i of array.\n", i);
    }
    if (IS_BIG_ENDIAN) {
      flip_bytes(sizeof(bin_shape), (unsigned char*) &bin_shape);
    }
    elem_count *= bin_shape;
    shape[i] = bin_shape;
  }

  int64_t elem_size = expected_type->size;
  void* tmp = realloc(*data, (size_t)(elem_count * elem_size));
  if (tmp == NULL) {
    futhark_panic(1, "binary-input: Failed to allocate array of size %i.\n",
          elem_count * elem_size);
  }
  *data = tmp;

  int64_t num_elems_read = (int64_t)fread(*data, (size_t)elem_size, (size_t)elem_count, stdin);
  if (num_elems_read != elem_count) {
    futhark_panic(1, "binary-input: tried to read %i elements of an array, but only got %i elements.\n",
          elem_count, num_elems_read);
  }

  // If we're on big endian platform we must change all multibyte elements
  // from using little endian to big endian
  if (IS_BIG_ENDIAN && elem_size != 1) {
    flip_bytes(elem_size, (unsigned char*) *data);
  }

  return 0;
}

static int read_array(const struct primtype_info_t *expected_type, void **data, int64_t *shape, int64_t dims) {
  if (!read_is_binary()) {
    return read_str_array(expected_type->size, (str_reader)expected_type->read_str, expected_type->type_name, data, shape, dims);
  } else {
    return read_bin_array(expected_type, data, shape, dims);
  }
}

static int end_of_input() {
  skipspaces();
  char token[2];
  next_token(token, sizeof(token));
  if (strcmp(token, "") == 0) {
    return 0;
  } else {
    return 1;
  }
}

static int write_str_array(FILE *out,
                           const struct primtype_info_t *elem_type,
                           const unsigned char *data,
                           const int64_t *shape,
                           int8_t rank) {
  if (rank==0) {
    elem_type->write_str(out, (void*)data);
  } else {
    int64_t len = (int64_t)shape[0];
    int64_t slice_size = 1;

    int64_t elem_size = elem_type->size;
    for (int8_t i = 1; i < rank; i++) {
      slice_size *= shape[i];
    }

    if (len*slice_size == 0) {
      printf("empty(");
      for (int64_t i = 0; i < rank; i++) {
        printf("[%"PRIi64"]", shape[i]);
      }
      printf("%s", elem_type->type_name);
      printf(")");
    } else if (rank==1) {
      putchar('[');
      for (int64_t i = 0; i < len; i++) {
        elem_type->write_str(out, (void*) (data + i * elem_size));
        if (i != len-1) {
          printf(", ");
        }
      }
      putchar(']');
    } else {
      putchar('[');
      for (int64_t i = 0; i < len; i++) {
        write_str_array(out, elem_type, data + i * slice_size * elem_size, shape+1, rank-1);
        if (i != len-1) {
          printf(", ");
        }
      }
      putchar(']');
    }
  }
  return 0;
}

static int write_bin_array(FILE *out,
                           const struct primtype_info_t *elem_type,
                           const unsigned char *data,
                           const int64_t *shape,
                           int8_t rank) {
  int64_t num_elems = 1;
  for (int64_t i = 0; i < rank; i++) {
    num_elems *= shape[i];
  }

  fputc('b', out);
  fputc((char)BINARY_FORMAT_VERSION, out);
  fwrite(&rank, sizeof(int8_t), 1, out);
  fputs(elem_type->binname, out);
  if (shape != NULL) {
    fwrite(shape, sizeof(int64_t), (size_t)rank, out);
  }

  if (IS_BIG_ENDIAN) {
    for (int64_t i = 0; i < num_elems; i++) {
      const unsigned char *elem = data+i*elem_type->size;
      for (int64_t j = 0; j < elem_type->size; j++) {
        fwrite(&elem[elem_type->size-j], 1, 1, out);
      }
    }
  } else {
    fwrite(data, (size_t)elem_type->size, (size_t)num_elems, out);
  }

  return 0;
}

static int write_array(FILE *out, int write_binary,
                       const struct primtype_info_t *elem_type,
                       const void *data,
                       const int64_t *shape,
                       const int8_t rank) {
  if (write_binary) {
    return write_bin_array(out, elem_type, data, shape, rank);
  } else {
    return write_str_array(out, elem_type, data, shape, rank);
  }
}

static int read_scalar(const struct primtype_info_t *expected_type, void *dest) {
  if (!read_is_binary()) {
    char buf[100];
    next_token(buf, sizeof(buf));
    return expected_type->read_str(buf, dest);
  } else {
    read_bin_ensure_scalar(expected_type);
    int64_t elem_size = expected_type->size;
    int num_elems_read = fread(dest, (size_t)elem_size, 1, stdin);
    if (IS_BIG_ENDIAN) {
      flip_bytes(elem_size, (unsigned char*) dest);
    }
    return num_elems_read == 1 ? 0 : 1;
  }
}

static int write_scalar(FILE *out, int write_binary, const struct primtype_info_t *type, void *src) {
  if (write_binary) {
    return write_bin_array(out, type, src, NULL, 0);
  } else {
    return type->write_str(out, src);
  }
}

// End of values.h.

#define __private
static int binary_output = 0;
static FILE *runtime_file;
static int perform_warmup = 0;
static int num_runs = 1;
static const char *entry_point = "main";
// Start of tuning.h.

static char* load_tuning_file(const char *fname,
                              void *cfg,
                              int (*set_size)(void*, const char*, size_t)) {
  const int max_line_len = 1024;
  char* line = (char*) malloc(max_line_len);

  FILE *f = fopen(fname, "r");

  if (f == NULL) {
    snprintf(line, max_line_len, "Cannot open file: %s", strerror(errno));
    return line;
  }

  int lineno = 0;
  while (fgets(line, max_line_len, f) != NULL) {
    lineno++;
    char *eql = strstr(line, "=");
    if (eql) {
      *eql = 0;
      int value = atoi(eql+1);
      if (set_size(cfg, line, value) != 0) {
        strncpy(eql+1, line, max_line_len-strlen(line)-1);
        snprintf(line, max_line_len, "Unknown name '%s' on line %d.", eql+1, lineno);
        return line;
      }
    } else {
      snprintf(line, max_line_len, "Invalid line %d (must be of form 'name=int').",
               lineno);
      return line;
    }
  }

  free(line);

  return NULL;
}

// End of tuning.h.

int parse_options(struct futhark_context_config *cfg, int argc,
                  char *const argv[])
{
    int ch;
    static struct option long_options[] = {{"write-runtime-to",
                                            required_argument, NULL, 1},
                                           {"runs", required_argument, NULL, 2},
                                           {"debugging", no_argument, NULL, 3},
                                           {"log", no_argument, NULL, 4},
                                           {"entry-point", required_argument,
                                            NULL, 5}, {"binary-output",
                                                       no_argument, NULL, 6},
                                           {"help", no_argument, NULL, 7},
                                           {"device", required_argument, NULL,
                                            8}, {"default-group-size",
                                                 required_argument, NULL, 9},
                                           {"default-num-groups",
                                            required_argument, NULL, 10},
                                           {"default-tile-size",
                                            required_argument, NULL, 11},
                                           {"default-threshold",
                                            required_argument, NULL, 12},
                                           {"print-sizes", no_argument, NULL,
                                            13}, {"size", required_argument,
                                                  NULL, 14}, {"tuning",
                                                              required_argument,
                                                              NULL, 15},
                                           {"platform", required_argument, NULL,
                                            16}, {"dump-opencl",
                                                  required_argument, NULL, 17},
                                           {"load-opencl", required_argument,
                                            NULL, 18}, {"dump-opencl-binary",
                                                        required_argument, NULL,
                                                        19},
                                           {"load-opencl-binary",
                                            required_argument, NULL, 20},
                                           {"build-option", required_argument,
                                            NULL, 21}, {"profile", no_argument,
                                                        NULL, 22},
                                           {"list-devices", no_argument, NULL,
                                            23}, {0, 0, 0, 0}};
    static char *option_descriptions =
                "  -t/--write-runtime-to FILE Print the time taken to execute the program to the indicated file, an integral number of microseconds.\n  -r/--runs INT              Perform NUM runs of the program.\n  -D/--debugging             Perform possibly expensive internal correctness checks and verbose logging.\n  -L/--log                   Print various low-overhead logging information to stderr while running.\n  -e/--entry-point NAME      The entry point to run. Defaults to main.\n  -b/--binary-output         Print the program result in the binary output format.\n  -h/--help                  Print help information and exit.\n  -d/--device NAME           Use the first OpenCL device whose name contains the given string.\n  --default-group-size INT   The default size of OpenCL workgroups that are launched.\n  --default-num-groups INT   The default number of OpenCL workgroups that are launched.\n  --default-tile-size INT    The default tile size used when performing two-dimensional tiling.\n  --default-threshold INT    The default parallelism threshold.\n  --print-sizes              Print all sizes that can be set with -size or --tuning.\n  --size ASSIGNMENT          Set a configurable run-time parameter to the given value.\n  --tuning FILE              Read size=value assignments from the given file.\n  -p/--platform NAME         Use the first OpenCL platform whose name contains the given string.\n  --dump-opencl FILE         Dump the embedded OpenCL program to the indicated file.\n  --load-opencl FILE         Instead of using the embedded OpenCL program, load it from the indicated file.\n  --dump-opencl-binary FILE  Dump the compiled version of the embedded OpenCL program to the indicated file.\n  --load-opencl-binary FILE  Load an OpenCL binary from the indicated file.\n  --build-option OPT         Add an additional build option to the string passed to clBuildProgram().\n  -P/--profile               Gather profiling data while executing and print out a summary at the end.\n  --list-devices             List all OpenCL devices and platforms available on the system.\n";
    
    while ((ch = getopt_long(argc, argv, ":t:r:DLe:bhd:p:P", long_options,
                             NULL)) != -1) {
        if (ch == 1 || ch == 't') {
            runtime_file = fopen(optarg, "w");
            if (runtime_file == NULL)
                futhark_panic(1, "Cannot open %s: %s\n", optarg,
                              strerror(errno));
        }
        if (ch == 2 || ch == 'r') {
            num_runs = atoi(optarg);
            perform_warmup = 1;
            if (num_runs <= 0)
                futhark_panic(1, "Need a positive number of runs, not %s\n",
                              optarg);
        }
        if (ch == 3 || ch == 'D')
            futhark_context_config_set_debugging(cfg, 1);
        if (ch == 4 || ch == 'L')
            futhark_context_config_set_logging(cfg, 1);
        if (ch == 5 || ch == 'e') {
            if (entry_point != NULL)
                entry_point = optarg;
        }
        if (ch == 6 || ch == 'b')
            binary_output = 1;
        if (ch == 7 || ch == 'h') {
            printf("Usage: %s [OPTION]...\nOptions:\n\n%s\nFor more information, consult the Futhark User's Guide or the man pages.\n",
                   fut_progname, option_descriptions);
            exit(0);
        }
        if (ch == 8 || ch == 'd')
            futhark_context_config_set_device(cfg, optarg);
        if (ch == 9)
            futhark_context_config_set_default_group_size(cfg, atoi(optarg));
        if (ch == 10)
            futhark_context_config_set_default_num_groups(cfg, atoi(optarg));
        if (ch == 11)
            futhark_context_config_set_default_tile_size(cfg, atoi(optarg));
        if (ch == 12)
            futhark_context_config_set_default_threshold(cfg, atoi(optarg));
        if (ch == 13) {
            int n = futhark_get_num_sizes();
            
            for (int i = 0; i < n; i++)
                printf("%s (%s)\n", futhark_get_size_name(i),
                       futhark_get_size_class(i));
            exit(0);
        }
        if (ch == 14) {
            char *name = optarg;
            char *equals = strstr(optarg, "=");
            char *value_str = equals != NULL ? equals + 1 : optarg;
            int value = atoi(value_str);
            
            if (equals != NULL) {
                *equals = 0;
                if (futhark_context_config_set_size(cfg, name, value) != 0)
                    futhark_panic(1, "Unknown size: %s\n", name);
            } else
                futhark_panic(1, "Invalid argument for size option: %s\n",
                              optarg);
        }
        if (ch == 15) {
            char *ret = load_tuning_file(optarg, cfg, (int (*)(void *, const
                                                               char *,
                                                               size_t)) futhark_context_config_set_size);
            
            if (ret != NULL)
                futhark_panic(1, "When loading tuning from '%s': %s\n", optarg,
                              ret);
        }
        if (ch == 16 || ch == 'p')
            futhark_context_config_set_platform(cfg, optarg);
        if (ch == 17) {
            futhark_context_config_dump_program_to(cfg, optarg);
            entry_point = NULL;
        }
        if (ch == 18)
            futhark_context_config_load_program_from(cfg, optarg);
        if (ch == 19) {
            futhark_context_config_dump_binary_to(cfg, optarg);
            entry_point = NULL;
        }
        if (ch == 20)
            futhark_context_config_load_binary_from(cfg, optarg);
        if (ch == 21)
            futhark_context_config_add_build_option(cfg, optarg);
        if (ch == 22 || ch == 'P')
            futhark_context_config_set_profiling(cfg, 1);
        if (ch == 23) {
            futhark_context_config_list_devices(cfg);
            entry_point = NULL;
        }
        if (ch == ':')
            futhark_panic(-1, "Missing argument for option %s\n", argv[optind -
                                                                       1]);
        if (ch == '?') {
            fprintf(stderr, "Usage: %s: %s\n", fut_progname,
                    "  -t/--write-runtime-to FILE Print the time taken to execute the program to the indicated file, an integral number of microseconds.\n  -r/--runs INT              Perform NUM runs of the program.\n  -D/--debugging             Perform possibly expensive internal correctness checks and verbose logging.\n  -L/--log                   Print various low-overhead logging information to stderr while running.\n  -e/--entry-point NAME      The entry point to run. Defaults to main.\n  -b/--binary-output         Print the program result in the binary output format.\n  -h/--help                  Print help information and exit.\n  -d/--device NAME           Use the first OpenCL device whose name contains the given string.\n  --default-group-size INT   The default size of OpenCL workgroups that are launched.\n  --default-num-groups INT   The default number of OpenCL workgroups that are launched.\n  --default-tile-size INT    The default tile size used when performing two-dimensional tiling.\n  --default-threshold INT    The default parallelism threshold.\n  --print-sizes              Print all sizes that can be set with -size or --tuning.\n  --size ASSIGNMENT          Set a configurable run-time parameter to the given value.\n  --tuning FILE              Read size=value assignments from the given file.\n  -p/--platform NAME         Use the first OpenCL platform whose name contains the given string.\n  --dump-opencl FILE         Dump the embedded OpenCL program to the indicated file.\n  --load-opencl FILE         Instead of using the embedded OpenCL program, load it from the indicated file.\n  --dump-opencl-binary FILE  Dump the compiled version of the embedded OpenCL program to the indicated file.\n  --load-opencl-binary FILE  Load an OpenCL binary from the indicated file.\n  --build-option OPT         Add an additional build option to the string passed to clBuildProgram().\n  -P/--profile               Gather profiling data while executing and print out a summary at the end.\n  --list-devices             List all OpenCL devices and platforms available on the system.\n");
            futhark_panic(1, "Unknown option: %s\n", argv[optind - 1]);
        }
    }
    return optind;
}
static void futrts_cli_entry_main(struct futhark_context *ctx)
{
    int64_t t_start, t_end;
    int time_runs = 0, profile_run = 0;
    
    // We do not want to profile all the initialisation.
    futhark_context_pause_profiling(ctx);
    // Declare and read input.
    set_binary_mode(stdin);
    
    int64_t read_value_30006;
    
    if (read_scalar(&i64_info, &read_value_30006) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      0, i64_info.type_name, strerror(errno));
    
    int64_t read_value_30007;
    
    if (read_scalar(&i64_info, &read_value_30007) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      1, i64_info.type_name, strerror(errno));
    
    struct futhark_f32_1d *read_value_30008;
    int64_t read_shape_30009[1];
    float *read_arr_30010 = NULL;
    
    errno = 0;
    if (read_array(&f32_info, (void **) &read_arr_30010, read_shape_30009, 1) !=
        0)
        futhark_panic(1, "Cannot read input #%d of type %s%s (errno: %s).\n", 2,
                      "[]", f32_info.type_name, strerror(errno));
    
    struct futhark_i64_1d *read_value_30011;
    int64_t read_shape_30012[1];
    int64_t *read_arr_30013 = NULL;
    
    errno = 0;
    if (read_array(&i64_info, (void **) &read_arr_30013, read_shape_30012, 1) !=
        0)
        futhark_panic(1, "Cannot read input #%d of type %s%s (errno: %s).\n", 3,
                      "[]", i64_info.type_name, strerror(errno));
    
    struct futhark_f32_1d *read_value_30014;
    int64_t read_shape_30015[1];
    float *read_arr_30016 = NULL;
    
    errno = 0;
    if (read_array(&f32_info, (void **) &read_arr_30016, read_shape_30015, 1) !=
        0)
        futhark_panic(1, "Cannot read input #%d of type %s%s (errno: %s).\n", 4,
                      "[]", f32_info.type_name, strerror(errno));
    
    float read_value_30017;
    
    if (read_scalar(&f32_info, &read_value_30017) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      5, f32_info.type_name, strerror(errno));
    
    float read_value_30018;
    
    if (read_scalar(&f32_info, &read_value_30018) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      6, f32_info.type_name, strerror(errno));
    
    float read_value_30019;
    
    if (read_scalar(&f32_info, &read_value_30019) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      7, f32_info.type_name, strerror(errno));
    
    float read_value_30020;
    
    if (read_scalar(&f32_info, &read_value_30020) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      8, f32_info.type_name, strerror(errno));
    if (end_of_input() != 0)
        futhark_panic(1, "Expected EOF on stdin after reading input for %s.\n",
                      "\"main\"");
    
    float result_30021;
    struct futhark_f32_1d *result_30022;
    
    if (perform_warmup) {
        int r;
        
        ;
        ;
        assert((read_value_30008 = futhark_new_f32_1d(ctx, read_arr_30010,
                                                      read_shape_30009[0])) !=
            0);
        assert((read_value_30011 = futhark_new_i64_1d(ctx, read_arr_30013,
                                                      read_shape_30012[0])) !=
            0);
        assert((read_value_30014 = futhark_new_f32_1d(ctx, read_arr_30016,
                                                      read_shape_30015[0])) !=
            0);
        ;
        ;
        ;
        ;
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        // Only profile last run.
        if (profile_run)
            futhark_context_unpause_profiling(ctx);
        t_start = get_wall_time();
        r = futhark_entry_main(ctx, &result_30021, &result_30022,
                               read_value_30006, read_value_30007,
                               read_value_30008, read_value_30011,
                               read_value_30014, read_value_30017,
                               read_value_30018, read_value_30019,
                               read_value_30020);
        if (r != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        if (profile_run)
            futhark_context_pause_profiling(ctx);
        t_end = get_wall_time();
        
        long elapsed_usec = t_end - t_start;
        
        if (time_runs && runtime_file != NULL) {
            fprintf(runtime_file, "%lld\n", (long long) elapsed_usec);
            fflush(runtime_file);
        }
        ;
        ;
        assert(futhark_free_f32_1d(ctx, read_value_30008) == 0);
        assert(futhark_free_i64_1d(ctx, read_value_30011) == 0);
        assert(futhark_free_f32_1d(ctx, read_value_30014) == 0);
        ;
        ;
        ;
        ;
        ;
        assert(futhark_free_f32_1d(ctx, result_30022) == 0);
    }
    time_runs = 1;
    // Proper run.
    for (int run = 0; run < num_runs; run++) {
        // Only profile last run.
        profile_run = run == num_runs - 1;
        
        int r;
        
        ;
        ;
        assert((read_value_30008 = futhark_new_f32_1d(ctx, read_arr_30010,
                                                      read_shape_30009[0])) !=
            0);
        assert((read_value_30011 = futhark_new_i64_1d(ctx, read_arr_30013,
                                                      read_shape_30012[0])) !=
            0);
        assert((read_value_30014 = futhark_new_f32_1d(ctx, read_arr_30016,
                                                      read_shape_30015[0])) !=
            0);
        ;
        ;
        ;
        ;
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        // Only profile last run.
        if (profile_run)
            futhark_context_unpause_profiling(ctx);
        t_start = get_wall_time();
        r = futhark_entry_main(ctx, &result_30021, &result_30022,
                               read_value_30006, read_value_30007,
                               read_value_30008, read_value_30011,
                               read_value_30014, read_value_30017,
                               read_value_30018, read_value_30019,
                               read_value_30020);
        if (r != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        if (profile_run)
            futhark_context_pause_profiling(ctx);
        t_end = get_wall_time();
        
        long elapsed_usec = t_end - t_start;
        
        if (time_runs && runtime_file != NULL) {
            fprintf(runtime_file, "%lld\n", (long long) elapsed_usec);
            fflush(runtime_file);
        }
        ;
        ;
        assert(futhark_free_f32_1d(ctx, read_value_30008) == 0);
        assert(futhark_free_i64_1d(ctx, read_value_30011) == 0);
        assert(futhark_free_f32_1d(ctx, read_value_30014) == 0);
        ;
        ;
        ;
        ;
        if (run < num_runs - 1) {
            ;
            assert(futhark_free_f32_1d(ctx, result_30022) == 0);
        }
    }
    ;
    ;
    free(read_arr_30010);
    free(read_arr_30013);
    free(read_arr_30016);
    ;
    ;
    ;
    ;
    if (binary_output)
        set_binary_mode(stdout);
    write_scalar(stdout, binary_output, &f32_info, &result_30021);
    printf("\n");
    {
        float *arr = calloc(sizeof(float), futhark_shape_f32_1d(ctx,
                                                                result_30022)[0]);
        
        assert(arr != NULL);
        assert(futhark_values_f32_1d(ctx, result_30022, arr) == 0);
        write_array(stdout, binary_output, &f32_info, arr,
                    futhark_shape_f32_1d(ctx, result_30022), 1);
        free(arr);
    }
    printf("\n");
    ;
    assert(futhark_free_f32_1d(ctx, result_30022) == 0);
}
static void futrts_cli_entry_test(struct futhark_context *ctx)
{
    int64_t t_start, t_end;
    int time_runs = 0, profile_run = 0;
    
    // We do not want to profile all the initialisation.
    futhark_context_pause_profiling(ctx);
    // Declare and read input.
    set_binary_mode(stdin);
    
    int64_t read_value_30023;
    
    if (read_scalar(&i64_info, &read_value_30023) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      0, i64_info.type_name, strerror(errno));
    
    int64_t read_value_30024;
    
    if (read_scalar(&i64_info, &read_value_30024) != 0)
        futhark_panic(1,
                      "Error when reading input #%d of type %s (errno: %s).\n",
                      1, i64_info.type_name, strerror(errno));
    if (end_of_input() != 0)
        futhark_panic(1, "Expected EOF on stdin after reading input for %s.\n",
                      "\"test\"");
    
    float result_30025;
    
    if (perform_warmup) {
        int r;
        
        ;
        ;
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        // Only profile last run.
        if (profile_run)
            futhark_context_unpause_profiling(ctx);
        t_start = get_wall_time();
        r = futhark_entry_test(ctx, &result_30025, read_value_30023,
                               read_value_30024);
        if (r != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        if (profile_run)
            futhark_context_pause_profiling(ctx);
        t_end = get_wall_time();
        
        long elapsed_usec = t_end - t_start;
        
        if (time_runs && runtime_file != NULL) {
            fprintf(runtime_file, "%lld\n", (long long) elapsed_usec);
            fflush(runtime_file);
        }
        ;
        ;
        ;
    }
    time_runs = 1;
    // Proper run.
    for (int run = 0; run < num_runs; run++) {
        // Only profile last run.
        profile_run = run == num_runs - 1;
        
        int r;
        
        ;
        ;
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        // Only profile last run.
        if (profile_run)
            futhark_context_unpause_profiling(ctx);
        t_start = get_wall_time();
        r = futhark_entry_test(ctx, &result_30025, read_value_30023,
                               read_value_30024);
        if (r != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        if (futhark_context_sync(ctx) != 0)
            futhark_panic(1, "%s", futhark_context_get_error(ctx));
        ;
        if (profile_run)
            futhark_context_pause_profiling(ctx);
        t_end = get_wall_time();
        
        long elapsed_usec = t_end - t_start;
        
        if (time_runs && runtime_file != NULL) {
            fprintf(runtime_file, "%lld\n", (long long) elapsed_usec);
            fflush(runtime_file);
        }
        ;
        ;
        if (run < num_runs - 1) {
            ;
        }
    }
    ;
    ;
    if (binary_output)
        set_binary_mode(stdout);
    write_scalar(stdout, binary_output, &f32_info, &result_30025);
    printf("\n");
    ;
}
typedef void entry_point_fun(struct futhark_context *);
struct entry_point_entry {
    const char *name;
    entry_point_fun *fun;
} ;
int main(int argc, char **argv)
{
    fut_progname = argv[0];
    
    struct entry_point_entry entry_points[] = {{.name ="main", .fun =
                                                futrts_cli_entry_main}, {.name =
                                                                         "test",
                                                                         .fun =
                                                                         futrts_cli_entry_test}};
    struct futhark_context_config *cfg = futhark_context_config_new();
    
    assert(cfg != NULL);
    
    int parsed_options = parse_options(cfg, argc, argv);
    
    argc -= parsed_options;
    argv += parsed_options;
    if (argc != 0)
        futhark_panic(1, "Excess non-option: %s\n", argv[0]);
    
    struct futhark_context *ctx = futhark_context_new(cfg);
    
    assert(ctx != NULL);
    
    char *error = futhark_context_get_error(ctx);
    
    if (error != NULL)
        futhark_panic(1, "%s", error);
    if (entry_point != NULL) {
        int num_entry_points = sizeof(entry_points) / sizeof(entry_points[0]);
        entry_point_fun *entry_point_fun = NULL;
        
        for (int i = 0; i < num_entry_points; i++) {
            if (strcmp(entry_points[i].name, entry_point) == 0) {
                entry_point_fun = entry_points[i].fun;
                break;
            }
        }
        if (entry_point_fun == NULL) {
            fprintf(stderr,
                    "No entry point '%s'.  Select another with --entry-point.  Options are:\n",
                    entry_point);
            for (int i = 0; i < num_entry_points; i++)
                fprintf(stderr, "%s\n", entry_points[i].name);
            return 1;
        }
        entry_point_fun(ctx);
        if (runtime_file != NULL)
            fclose(runtime_file);
        
        char *report = futhark_context_report(ctx);
        
        fputs(report, stderr);
        free(report);
    }
    futhark_context_free(ctx);
    futhark_context_config_free(cfg);
    return 0;
}
#ifdef _MSC_VER
#define inline __inline
#endif
#include <string.h>
#include <inttypes.h>
#include <ctype.h>
#include <errno.h>
#include <assert.h>
#define CL_TARGET_OPENCL_VERSION 120
#define CL_USE_DEPRECATED_OPENCL_1_2_APIS
#ifdef __APPLE__
#define CL_SILENCE_DEPRECATION
#include <OpenCL/cl.h>
#else
#include <CL/cl.h>
#endif

// Start of lock.h.

// A very simple cross-platform implementation of locks.  Uses
// pthreads on Unix and some Windows thing there.  Futhark's
// host-level code is not multithreaded, but user code may be, so we
// need some mechanism for ensuring atomic access to API functions.
// This is that mechanism.  It is not exposed to user code at all, so
// we do not have to worry about name collisions.

#ifdef _WIN32

typedef HANDLE lock_t;

static void create_lock(lock_t *lock) {
  *lock = CreateMutex(NULL,  // Default security attributes.
                      FALSE, // Initially unlocked.
                      NULL); // Unnamed.
}

static void lock_lock(lock_t *lock) {
  assert(WaitForSingleObject(*lock, INFINITE) == WAIT_OBJECT_0);
}

static void lock_unlock(lock_t *lock) {
  assert(ReleaseMutex(*lock));
}

static void free_lock(lock_t *lock) {
  CloseHandle(*lock);
}

#else
// Assuming POSIX

#include <pthread.h>

typedef pthread_mutex_t lock_t;

static void create_lock(lock_t *lock) {
  int r = pthread_mutex_init(lock, NULL);
  assert(r == 0);
}

static void lock_lock(lock_t *lock) {
  int r = pthread_mutex_lock(lock);
  assert(r == 0);
}

static void lock_unlock(lock_t *lock) {
  int r = pthread_mutex_unlock(lock);
  assert(r == 0);
}

static void free_lock(lock_t *lock) {
  // Nothing to do for pthreads.
  (void)lock;
}

#endif

// End of lock.h.

static inline uint8_t add8(uint8_t x, uint8_t y)
{
    return x + y;
}
static inline uint16_t add16(uint16_t x, uint16_t y)
{
    return x + y;
}
static inline uint32_t add32(uint32_t x, uint32_t y)
{
    return x + y;
}
static inline uint64_t add64(uint64_t x, uint64_t y)
{
    return x + y;
}
static inline uint8_t sub8(uint8_t x, uint8_t y)
{
    return x - y;
}
static inline uint16_t sub16(uint16_t x, uint16_t y)
{
    return x - y;
}
static inline uint32_t sub32(uint32_t x, uint32_t y)
{
    return x - y;
}
static inline uint64_t sub64(uint64_t x, uint64_t y)
{
    return x - y;
}
static inline uint8_t mul8(uint8_t x, uint8_t y)
{
    return x * y;
}
static inline uint16_t mul16(uint16_t x, uint16_t y)
{
    return x * y;
}
static inline uint32_t mul32(uint32_t x, uint32_t y)
{
    return x * y;
}
static inline uint64_t mul64(uint64_t x, uint64_t y)
{
    return x * y;
}
static inline uint8_t udiv8(uint8_t x, uint8_t y)
{
    return x / y;
}
static inline uint16_t udiv16(uint16_t x, uint16_t y)
{
    return x / y;
}
static inline uint32_t udiv32(uint32_t x, uint32_t y)
{
    return x / y;
}
static inline uint64_t udiv64(uint64_t x, uint64_t y)
{
    return x / y;
}
static inline uint8_t udiv_up8(uint8_t x, uint8_t y)
{
    return (x + y - 1) / y;
}
static inline uint16_t udiv_up16(uint16_t x, uint16_t y)
{
    return (x + y - 1) / y;
}
static inline uint32_t udiv_up32(uint32_t x, uint32_t y)
{
    return (x + y - 1) / y;
}
static inline uint64_t udiv_up64(uint64_t x, uint64_t y)
{
    return (x + y - 1) / y;
}
static inline uint8_t umod8(uint8_t x, uint8_t y)
{
    return x % y;
}
static inline uint16_t umod16(uint16_t x, uint16_t y)
{
    return x % y;
}
static inline uint32_t umod32(uint32_t x, uint32_t y)
{
    return x % y;
}
static inline uint64_t umod64(uint64_t x, uint64_t y)
{
    return x % y;
}
static inline uint8_t udiv_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint16_t udiv_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint32_t udiv_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint64_t udiv_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint8_t udiv_up_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint16_t udiv_up_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint32_t udiv_up_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint64_t udiv_up_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint8_t umod_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint16_t umod_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint32_t umod_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint64_t umod_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int8_t sdiv8(int8_t x, int8_t y)
{
    int8_t q = x / y;
    int8_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int16_t sdiv16(int16_t x, int16_t y)
{
    int16_t q = x / y;
    int16_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int32_t sdiv32(int32_t x, int32_t y)
{
    int32_t q = x / y;
    int32_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int64_t sdiv64(int64_t x, int64_t y)
{
    int64_t q = x / y;
    int64_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int8_t sdiv_up8(int8_t x, int8_t y)
{
    return sdiv8(x + y - 1, y);
}
static inline int16_t sdiv_up16(int16_t x, int16_t y)
{
    return sdiv16(x + y - 1, y);
}
static inline int32_t sdiv_up32(int32_t x, int32_t y)
{
    return sdiv32(x + y - 1, y);
}
static inline int64_t sdiv_up64(int64_t x, int64_t y)
{
    return sdiv64(x + y - 1, y);
}
static inline int8_t smod8(int8_t x, int8_t y)
{
    int8_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int16_t smod16(int16_t x, int16_t y)
{
    int16_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int32_t smod32(int32_t x, int32_t y)
{
    int32_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int64_t smod64(int64_t x, int64_t y)
{
    int64_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int8_t sdiv_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : sdiv8(x, y);
}
static inline int16_t sdiv_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : sdiv16(x, y);
}
static inline int32_t sdiv_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : sdiv32(x, y);
}
static inline int64_t sdiv_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : sdiv64(x, y);
}
static inline int8_t sdiv_up_safe8(int8_t x, int8_t y)
{
    return sdiv_safe8(x + y - 1, y);
}
static inline int16_t sdiv_up_safe16(int16_t x, int16_t y)
{
    return sdiv_safe16(x + y - 1, y);
}
static inline int32_t sdiv_up_safe32(int32_t x, int32_t y)
{
    return sdiv_safe32(x + y - 1, y);
}
static inline int64_t sdiv_up_safe64(int64_t x, int64_t y)
{
    return sdiv_safe64(x + y - 1, y);
}
static inline int8_t smod_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : smod8(x, y);
}
static inline int16_t smod_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : smod16(x, y);
}
static inline int32_t smod_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : smod32(x, y);
}
static inline int64_t smod_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : smod64(x, y);
}
static inline int8_t squot8(int8_t x, int8_t y)
{
    return x / y;
}
static inline int16_t squot16(int16_t x, int16_t y)
{
    return x / y;
}
static inline int32_t squot32(int32_t x, int32_t y)
{
    return x / y;
}
static inline int64_t squot64(int64_t x, int64_t y)
{
    return x / y;
}
static inline int8_t srem8(int8_t x, int8_t y)
{
    return x % y;
}
static inline int16_t srem16(int16_t x, int16_t y)
{
    return x % y;
}
static inline int32_t srem32(int32_t x, int32_t y)
{
    return x % y;
}
static inline int64_t srem64(int64_t x, int64_t y)
{
    return x % y;
}
static inline int8_t squot_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int16_t squot_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int32_t squot_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int64_t squot_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int8_t srem_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int16_t srem_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int32_t srem_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int64_t srem_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int8_t smin8(int8_t x, int8_t y)
{
    return x < y ? x : y;
}
static inline int16_t smin16(int16_t x, int16_t y)
{
    return x < y ? x : y;
}
static inline int32_t smin32(int32_t x, int32_t y)
{
    return x < y ? x : y;
}
static inline int64_t smin64(int64_t x, int64_t y)
{
    return x < y ? x : y;
}
static inline uint8_t umin8(uint8_t x, uint8_t y)
{
    return x < y ? x : y;
}
static inline uint16_t umin16(uint16_t x, uint16_t y)
{
    return x < y ? x : y;
}
static inline uint32_t umin32(uint32_t x, uint32_t y)
{
    return x < y ? x : y;
}
static inline uint64_t umin64(uint64_t x, uint64_t y)
{
    return x < y ? x : y;
}
static inline int8_t smax8(int8_t x, int8_t y)
{
    return x < y ? y : x;
}
static inline int16_t smax16(int16_t x, int16_t y)
{
    return x < y ? y : x;
}
static inline int32_t smax32(int32_t x, int32_t y)
{
    return x < y ? y : x;
}
static inline int64_t smax64(int64_t x, int64_t y)
{
    return x < y ? y : x;
}
static inline uint8_t umax8(uint8_t x, uint8_t y)
{
    return x < y ? y : x;
}
static inline uint16_t umax16(uint16_t x, uint16_t y)
{
    return x < y ? y : x;
}
static inline uint32_t umax32(uint32_t x, uint32_t y)
{
    return x < y ? y : x;
}
static inline uint64_t umax64(uint64_t x, uint64_t y)
{
    return x < y ? y : x;
}
static inline uint8_t shl8(uint8_t x, uint8_t y)
{
    return x << y;
}
static inline uint16_t shl16(uint16_t x, uint16_t y)
{
    return x << y;
}
static inline uint32_t shl32(uint32_t x, uint32_t y)
{
    return x << y;
}
static inline uint64_t shl64(uint64_t x, uint64_t y)
{
    return x << y;
}
static inline uint8_t lshr8(uint8_t x, uint8_t y)
{
    return x >> y;
}
static inline uint16_t lshr16(uint16_t x, uint16_t y)
{
    return x >> y;
}
static inline uint32_t lshr32(uint32_t x, uint32_t y)
{
    return x >> y;
}
static inline uint64_t lshr64(uint64_t x, uint64_t y)
{
    return x >> y;
}
static inline int8_t ashr8(int8_t x, int8_t y)
{
    return x >> y;
}
static inline int16_t ashr16(int16_t x, int16_t y)
{
    return x >> y;
}
static inline int32_t ashr32(int32_t x, int32_t y)
{
    return x >> y;
}
static inline int64_t ashr64(int64_t x, int64_t y)
{
    return x >> y;
}
static inline uint8_t and8(uint8_t x, uint8_t y)
{
    return x & y;
}
static inline uint16_t and16(uint16_t x, uint16_t y)
{
    return x & y;
}
static inline uint32_t and32(uint32_t x, uint32_t y)
{
    return x & y;
}
static inline uint64_t and64(uint64_t x, uint64_t y)
{
    return x & y;
}
static inline uint8_t or8(uint8_t x, uint8_t y)
{
    return x | y;
}
static inline uint16_t or16(uint16_t x, uint16_t y)
{
    return x | y;
}
static inline uint32_t or32(uint32_t x, uint32_t y)
{
    return x | y;
}
static inline uint64_t or64(uint64_t x, uint64_t y)
{
    return x | y;
}
static inline uint8_t xor8(uint8_t x, uint8_t y)
{
    return x ^ y;
}
static inline uint16_t xor16(uint16_t x, uint16_t y)
{
    return x ^ y;
}
static inline uint32_t xor32(uint32_t x, uint32_t y)
{
    return x ^ y;
}
static inline uint64_t xor64(uint64_t x, uint64_t y)
{
    return x ^ y;
}
static inline bool ult8(uint8_t x, uint8_t y)
{
    return x < y;
}
static inline bool ult16(uint16_t x, uint16_t y)
{
    return x < y;
}
static inline bool ult32(uint32_t x, uint32_t y)
{
    return x < y;
}
static inline bool ult64(uint64_t x, uint64_t y)
{
    return x < y;
}
static inline bool ule8(uint8_t x, uint8_t y)
{
    return x <= y;
}
static inline bool ule16(uint16_t x, uint16_t y)
{
    return x <= y;
}
static inline bool ule32(uint32_t x, uint32_t y)
{
    return x <= y;
}
static inline bool ule64(uint64_t x, uint64_t y)
{
    return x <= y;
}
static inline bool slt8(int8_t x, int8_t y)
{
    return x < y;
}
static inline bool slt16(int16_t x, int16_t y)
{
    return x < y;
}
static inline bool slt32(int32_t x, int32_t y)
{
    return x < y;
}
static inline bool slt64(int64_t x, int64_t y)
{
    return x < y;
}
static inline bool sle8(int8_t x, int8_t y)
{
    return x <= y;
}
static inline bool sle16(int16_t x, int16_t y)
{
    return x <= y;
}
static inline bool sle32(int32_t x, int32_t y)
{
    return x <= y;
}
static inline bool sle64(int64_t x, int64_t y)
{
    return x <= y;
}
static inline int8_t pow8(int8_t x, int8_t y)
{
    int8_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int16_t pow16(int16_t x, int16_t y)
{
    int16_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int32_t pow32(int32_t x, int32_t y)
{
    int32_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int64_t pow64(int64_t x, int64_t y)
{
    int64_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline bool itob_i8_bool(int8_t x)
{
    return x;
}
static inline bool itob_i16_bool(int16_t x)
{
    return x;
}
static inline bool itob_i32_bool(int32_t x)
{
    return x;
}
static inline bool itob_i64_bool(int64_t x)
{
    return x;
}
static inline int8_t btoi_bool_i8(bool x)
{
    return x;
}
static inline int16_t btoi_bool_i16(bool x)
{
    return x;
}
static inline int32_t btoi_bool_i32(bool x)
{
    return x;
}
static inline int64_t btoi_bool_i64(bool x)
{
    return x;
}
#define sext_i8_i8(x) ((int8_t) (int8_t) x)
#define sext_i8_i16(x) ((int16_t) (int8_t) x)
#define sext_i8_i32(x) ((int32_t) (int8_t) x)
#define sext_i8_i64(x) ((int64_t) (int8_t) x)
#define sext_i16_i8(x) ((int8_t) (int16_t) x)
#define sext_i16_i16(x) ((int16_t) (int16_t) x)
#define sext_i16_i32(x) ((int32_t) (int16_t) x)
#define sext_i16_i64(x) ((int64_t) (int16_t) x)
#define sext_i32_i8(x) ((int8_t) (int32_t) x)
#define sext_i32_i16(x) ((int16_t) (int32_t) x)
#define sext_i32_i32(x) ((int32_t) (int32_t) x)
#define sext_i32_i64(x) ((int64_t) (int32_t) x)
#define sext_i64_i8(x) ((int8_t) (int64_t) x)
#define sext_i64_i16(x) ((int16_t) (int64_t) x)
#define sext_i64_i32(x) ((int32_t) (int64_t) x)
#define sext_i64_i64(x) ((int64_t) (int64_t) x)
#define zext_i8_i8(x) ((int8_t) (uint8_t) x)
#define zext_i8_i16(x) ((int16_t) (uint8_t) x)
#define zext_i8_i32(x) ((int32_t) (uint8_t) x)
#define zext_i8_i64(x) ((int64_t) (uint8_t) x)
#define zext_i16_i8(x) ((int8_t) (uint16_t) x)
#define zext_i16_i16(x) ((int16_t) (uint16_t) x)
#define zext_i16_i32(x) ((int32_t) (uint16_t) x)
#define zext_i16_i64(x) ((int64_t) (uint16_t) x)
#define zext_i32_i8(x) ((int8_t) (uint32_t) x)
#define zext_i32_i16(x) ((int16_t) (uint32_t) x)
#define zext_i32_i32(x) ((int32_t) (uint32_t) x)
#define zext_i32_i64(x) ((int64_t) (uint32_t) x)
#define zext_i64_i8(x) ((int8_t) (uint64_t) x)
#define zext_i64_i16(x) ((int16_t) (uint64_t) x)
#define zext_i64_i32(x) ((int32_t) (uint64_t) x)
#define zext_i64_i64(x) ((int64_t) (uint64_t) x)
#if defined(__OPENCL_VERSION__)
static int32_t futrts_popc8(int8_t x)
{
    return popcount(x);
}
static int32_t futrts_popc16(int16_t x)
{
    return popcount(x);
}
static int32_t futrts_popc32(int32_t x)
{
    return popcount(x);
}
static int32_t futrts_popc64(int64_t x)
{
    return popcount(x);
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_popc8(int8_t x)
{
    return __popc(zext_i8_i32(x));
}
static int32_t futrts_popc16(int16_t x)
{
    return __popc(zext_i16_i32(x));
}
static int32_t futrts_popc32(int32_t x)
{
    return __popc(x);
}
static int32_t futrts_popc64(int64_t x)
{
    return __popcll(x);
}
#else
static int32_t futrts_popc8(int8_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc16(int16_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc32(int32_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc64(int64_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
#endif
#if defined(__OPENCL_VERSION__)
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    return mul_hi(a, b);
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    return mul_hi(a, b);
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    return mul_hi(a, b);
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    return mul_hi(a, b);
}
#elif defined(__CUDA_ARCH__)
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    uint16_t aa = a;
    uint16_t bb = b;
    
    return aa * bb >> 8;
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    uint32_t aa = a;
    uint32_t bb = b;
    
    return aa * bb >> 16;
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    return mulhi(a, b);
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    return mul64hi(a, b);
}
#else
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    uint16_t aa = a;
    uint16_t bb = b;
    
    return aa * bb >> 8;
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    uint32_t aa = a;
    uint32_t bb = b;
    
    return aa * bb >> 16;
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    uint64_t aa = a;
    uint64_t bb = b;
    
    return aa * bb >> 32;
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    __uint128_t aa = a;
    __uint128_t bb = b;
    
    return aa * bb >> 64;
}
#endif
#if defined(__OPENCL_VERSION__)
static uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)
{
    return mad_hi(a, b, c);
}
static uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)
{
    return mad_hi(a, b, c);
}
static uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)
{
    return mad_hi(a, b, c);
}
static uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)
{
    return mad_hi(a, b, c);
}
#else
static uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)
{
    return futrts_mul_hi8(a, b) + c;
}
static uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)
{
    return futrts_mul_hi16(a, b) + c;
}
static uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)
{
    return futrts_mul_hi32(a, b) + c;
}
static uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)
{
    return futrts_mul_hi64(a, b) + c;
}
#endif
#if defined(__OPENCL_VERSION__)
static int32_t futrts_clzz8(int8_t x)
{
    return clz(x);
}
static int32_t futrts_clzz16(int16_t x)
{
    return clz(x);
}
static int32_t futrts_clzz32(int32_t x)
{
    return clz(x);
}
static int32_t futrts_clzz64(int64_t x)
{
    return clz(x);
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_clzz8(int8_t x)
{
    return __clz(zext_i8_i32(x)) - 24;
}
static int32_t futrts_clzz16(int16_t x)
{
    return __clz(zext_i16_i32(x)) - 16;
}
static int32_t futrts_clzz32(int32_t x)
{
    return __clz(x);
}
static int32_t futrts_clzz64(int64_t x)
{
    return __clzll(x);
}
#else
static int32_t futrts_clzz8(int8_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz16(int16_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz32(int32_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz64(int64_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
#endif
#if defined(__OPENCL_VERSION__)
static int32_t futrts_ctzz8(int8_t x)
{
    int i = 0;
    
    for (; i < 8 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz16(int16_t x)
{
    int i = 0;
    
    for (; i < 16 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz32(int32_t x)
{
    int i = 0;
    
    for (; i < 32 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz64(int64_t x)
{
    int i = 0;
    
    for (; i < 64 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_ctzz8(int8_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 8 : y - 1;
}
static int32_t futrts_ctzz16(int16_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 16 : y - 1;
}
static int32_t futrts_ctzz32(int32_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 32 : y - 1;
}
static int32_t futrts_ctzz64(int64_t x)
{
    int y = __ffsll(x);
    
    return y == 0 ? 64 : y - 1;
}
#else
static int32_t futrts_ctzz8(int8_t x)
{
    return x == 0 ? 8 : __builtin_ctz((uint32_t) x);
}
static int32_t futrts_ctzz16(int16_t x)
{
    return x == 0 ? 16 : __builtin_ctz((uint32_t) x);
}
static int32_t futrts_ctzz32(int32_t x)
{
    return x == 0 ? 32 : __builtin_ctz(x);
}
static int32_t futrts_ctzz64(int64_t x)
{
    return x == 0 ? 64 : __builtin_ctzl(x);
}
#endif
static inline float fdiv32(float x, float y)
{
    return x / y;
}
static inline float fadd32(float x, float y)
{
    return x + y;
}
static inline float fsub32(float x, float y)
{
    return x - y;
}
static inline float fmul32(float x, float y)
{
    return x * y;
}
static inline float fmin32(float x, float y)
{
    return fmin(x, y);
}
static inline float fmax32(float x, float y)
{
    return fmax(x, y);
}
static inline float fpow32(float x, float y)
{
    return pow(x, y);
}
static inline bool cmplt32(float x, float y)
{
    return x < y;
}
static inline bool cmple32(float x, float y)
{
    return x <= y;
}
static inline float sitofp_i8_f32(int8_t x)
{
    return (float) x;
}
static inline float sitofp_i16_f32(int16_t x)
{
    return (float) x;
}
static inline float sitofp_i32_f32(int32_t x)
{
    return (float) x;
}
static inline float sitofp_i64_f32(int64_t x)
{
    return (float) x;
}
static inline float uitofp_i8_f32(uint8_t x)
{
    return (float) x;
}
static inline float uitofp_i16_f32(uint16_t x)
{
    return (float) x;
}
static inline float uitofp_i32_f32(uint32_t x)
{
    return (float) x;
}
static inline float uitofp_i64_f32(uint64_t x)
{
    return (float) x;
}
static inline int8_t fptosi_f32_i8(float x)
{
    return (int8_t) x;
}
static inline int16_t fptosi_f32_i16(float x)
{
    return (int16_t) x;
}
static inline int32_t fptosi_f32_i32(float x)
{
    return (int32_t) x;
}
static inline int64_t fptosi_f32_i64(float x)
{
    return (int64_t) x;
}
static inline uint8_t fptoui_f32_i8(float x)
{
    return (uint8_t) x;
}
static inline uint16_t fptoui_f32_i16(float x)
{
    return (uint16_t) x;
}
static inline uint32_t fptoui_f32_i32(float x)
{
    return (uint32_t) x;
}
static inline uint64_t fptoui_f32_i64(float x)
{
    return (uint64_t) x;
}
static inline double fdiv64(double x, double y)
{
    return x / y;
}
static inline double fadd64(double x, double y)
{
    return x + y;
}
static inline double fsub64(double x, double y)
{
    return x - y;
}
static inline double fmul64(double x, double y)
{
    return x * y;
}
static inline double fmin64(double x, double y)
{
    return fmin(x, y);
}
static inline double fmax64(double x, double y)
{
    return fmax(x, y);
}
static inline double fpow64(double x, double y)
{
    return pow(x, y);
}
static inline bool cmplt64(double x, double y)
{
    return x < y;
}
static inline bool cmple64(double x, double y)
{
    return x <= y;
}
static inline double sitofp_i8_f64(int8_t x)
{
    return (double) x;
}
static inline double sitofp_i16_f64(int16_t x)
{
    return (double) x;
}
static inline double sitofp_i32_f64(int32_t x)
{
    return (double) x;
}
static inline double sitofp_i64_f64(int64_t x)
{
    return (double) x;
}
static inline double uitofp_i8_f64(uint8_t x)
{
    return (double) x;
}
static inline double uitofp_i16_f64(uint16_t x)
{
    return (double) x;
}
static inline double uitofp_i32_f64(uint32_t x)
{
    return (double) x;
}
static inline double uitofp_i64_f64(uint64_t x)
{
    return (double) x;
}
static inline int8_t fptosi_f64_i8(double x)
{
    return (int8_t) x;
}
static inline int16_t fptosi_f64_i16(double x)
{
    return (int16_t) x;
}
static inline int32_t fptosi_f64_i32(double x)
{
    return (int32_t) x;
}
static inline int64_t fptosi_f64_i64(double x)
{
    return (int64_t) x;
}
static inline uint8_t fptoui_f64_i8(double x)
{
    return (uint8_t) x;
}
static inline uint16_t fptoui_f64_i16(double x)
{
    return (uint16_t) x;
}
static inline uint32_t fptoui_f64_i32(double x)
{
    return (uint32_t) x;
}
static inline uint64_t fptoui_f64_i64(double x)
{
    return (uint64_t) x;
}
static inline float fpconv_f32_f32(float x)
{
    return (float) x;
}
static inline double fpconv_f32_f64(float x)
{
    return (double) x;
}
static inline float fpconv_f64_f32(double x)
{
    return (float) x;
}
static inline double fpconv_f64_f64(double x)
{
    return (double) x;
}
static inline float futrts_log32(float x)
{
    return log(x);
}
static inline float futrts_log2_32(float x)
{
    return log2(x);
}
static inline float futrts_log10_32(float x)
{
    return log10(x);
}
static inline float futrts_sqrt32(float x)
{
    return sqrt(x);
}
static inline float futrts_exp32(float x)
{
    return exp(x);
}
static inline float futrts_cos32(float x)
{
    return cos(x);
}
static inline float futrts_sin32(float x)
{
    return sin(x);
}
static inline float futrts_tan32(float x)
{
    return tan(x);
}
static inline float futrts_acos32(float x)
{
    return acos(x);
}
static inline float futrts_asin32(float x)
{
    return asin(x);
}
static inline float futrts_atan32(float x)
{
    return atan(x);
}
static inline float futrts_cosh32(float x)
{
    return cosh(x);
}
static inline float futrts_sinh32(float x)
{
    return sinh(x);
}
static inline float futrts_tanh32(float x)
{
    return tanh(x);
}
static inline float futrts_acosh32(float x)
{
    return acosh(x);
}
static inline float futrts_asinh32(float x)
{
    return asinh(x);
}
static inline float futrts_atanh32(float x)
{
    return atanh(x);
}
static inline float futrts_atan2_32(float x, float y)
{
    return atan2(x, y);
}
static inline float futrts_gamma32(float x)
{
    return tgamma(x);
}
static inline float futrts_lgamma32(float x)
{
    return lgamma(x);
}
static inline bool futrts_isnan32(float x)
{
    return isnan(x);
}
static inline bool futrts_isinf32(float x)
{
    return isinf(x);
}
static inline int32_t futrts_to_bits32(float x)
{
    union {
        float f;
        int32_t t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline float futrts_from_bits32(int32_t x)
{
    union {
        int32_t f;
        float t;
    } p;
    
    p.f = x;
    return p.t;
}
#ifdef __OPENCL_VERSION__
static inline float fmod32(float x, float y)
{
    return fmod(x, y);
}
static inline float futrts_round32(float x)
{
    return rint(x);
}
static inline float futrts_floor32(float x)
{
    return floor(x);
}
static inline float futrts_ceil32(float x)
{
    return ceil(x);
}
static inline float futrts_lerp32(float v0, float v1, float t)
{
    return mix(v0, v1, t);
}
static inline float futrts_mad32(float a, float b, float c)
{
    return mad(a, b, c);
}
static inline float futrts_fma32(float a, float b, float c)
{
    return fma(a, b, c);
}
#else
static inline float fmod32(float x, float y)
{
    return fmodf(x, y);
}
static inline float futrts_round32(float x)
{
    return rintf(x);
}
static inline float futrts_floor32(float x)
{
    return floorf(x);
}
static inline float futrts_ceil32(float x)
{
    return ceilf(x);
}
static inline float futrts_lerp32(float v0, float v1, float t)
{
    return v0 + (v1 - v0) * t;
}
static inline float futrts_mad32(float a, float b, float c)
{
    return a * b + c;
}
static inline float futrts_fma32(float a, float b, float c)
{
    return fmaf(a, b, c);
}
#endif
static inline double futrts_log64(double x)
{
    return log(x);
}
static inline double futrts_log2_64(double x)
{
    return log2(x);
}
static inline double futrts_log10_64(double x)
{
    return log10(x);
}
static inline double futrts_sqrt64(double x)
{
    return sqrt(x);
}
static inline double futrts_exp64(double x)
{
    return exp(x);
}
static inline double futrts_cos64(double x)
{
    return cos(x);
}
static inline double futrts_sin64(double x)
{
    return sin(x);
}
static inline double futrts_tan64(double x)
{
    return tan(x);
}
static inline double futrts_acos64(double x)
{
    return acos(x);
}
static inline double futrts_asin64(double x)
{
    return asin(x);
}
static inline double futrts_atan64(double x)
{
    return atan(x);
}
static inline double futrts_cosh64(double x)
{
    return cosh(x);
}
static inline double futrts_sinh64(double x)
{
    return sinh(x);
}
static inline double futrts_tanh64(double x)
{
    return tanh(x);
}
static inline double futrts_acosh64(double x)
{
    return acosh(x);
}
static inline double futrts_asinh64(double x)
{
    return asinh(x);
}
static inline double futrts_atanh64(double x)
{
    return atanh(x);
}
static inline double futrts_atan2_64(double x, double y)
{
    return atan2(x, y);
}
static inline double futrts_gamma64(double x)
{
    return tgamma(x);
}
static inline double futrts_lgamma64(double x)
{
    return lgamma(x);
}
static inline double futrts_fma64(double a, double b, double c)
{
    return fma(a, b, c);
}
static inline double futrts_round64(double x)
{
    return rint(x);
}
static inline double futrts_ceil64(double x)
{
    return ceil(x);
}
static inline double futrts_floor64(double x)
{
    return floor(x);
}
static inline bool futrts_isnan64(double x)
{
    return isnan(x);
}
static inline bool futrts_isinf64(double x)
{
    return isinf(x);
}
static inline int64_t futrts_to_bits64(double x)
{
    union {
        double f;
        int64_t t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline double futrts_from_bits64(int64_t x)
{
    union {
        int64_t f;
        double t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline double fmod64(double x, double y)
{
    return fmod(x, y);
}
#ifdef __OPENCL_VERSION__
static inline double futrts_lerp64(double v0, double v1, double t)
{
    return mix(v0, v1, t);
}
static inline double futrts_mad64(double a, double b, double c)
{
    return mad(a, b, c);
}
#else
static inline double futrts_lerp64(double v0, double v1, double t)
{
    return v0 + (v1 - v0) * t;
}
static inline double futrts_mad64(double a, double b, double c)
{
    return a * b + c;
}
#endif
int init_constants(struct futhark_context *);
int free_constants(struct futhark_context *);
static int32_t mainzicounter_mem_realtype_29647[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzicounter_mem_realtype_29694[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzihist_locks_mem_realtype_29706[100151];
static int32_t mainzicounter_mem_realtype_29717[10240];
static int32_t mainzicounter_mem_realtype_29789[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t mainzicounter_mem_realtype_29806[10240];
static int32_t mainzicounter_mem_realtype_29817[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static float testzistatic_array_realtype_29826[45] = {1.0F, -0.5F, 1.0F, 1.0F,
                                                      1.0F, 1.0F, 1.0F, 1.0F,
                                                      1.0F, 1.0F, -0.5F, 1.0F,
                                                      1.0F, 1.0F, 1.0F, 1.0F,
                                                      1.0F, 1.0F, 1.0F, -0.5F,
                                                      1.0F, 1.0F, 1.0F, 1.0F,
                                                      1.0F, 1.0F, 1.0F, 1.0F,
                                                      -0.5F, 1.0F, 1.0F, 1.0F,
                                                      1.0F, 1.0F, 1.0F, 1.0F,
                                                      1.0F, -0.5F, 1.0F, 1.0F,
                                                      1.0F, 1.0F, 1.0F, 1.0F,
                                                      1.0F};
static int64_t testzistatic_array_realtype_29827[45] = {10, 20, 5, 5, 50, 20,
                                                        30, 15, 18, 10, 200, 5,
                                                        5, 50, 20, 30, 15, 18,
                                                        10, 20, 5, 5, 100, 20,
                                                        30, 15, 18, 10, 20, 5,
                                                        5, 50, 20, 30, 15, 18,
                                                        10, 20, 5, 5, 50, 20,
                                                        30, 15, 18};
static float testzistatic_array_realtype_29828[45] = {1.0F, 0.5F, 0.25F, 0.1F,
                                                      0.3F, 0.1F, 2.0F, 3.0F,
                                                      1.0F, 1.0F, 0.5F, 0.25F,
                                                      0.1F, 0.3F, 0.1F, 2.0F,
                                                      3.0F, 1.0F, 1.0F, 0.5F,
                                                      0.25F, 0.1F, 0.3F, 0.1F,
                                                      2.0F, 3.0F, 1.0F, 1.0F,
                                                      0.5F, 0.25F, 0.1F, 0.3F,
                                                      0.1F, 2.0F, 3.0F, 1.0F,
                                                      1.0F, 0.5F, 0.25F, 0.1F,
                                                      0.3F, 0.1F, 2.0F, 3.0F,
                                                      1.0F};
static int32_t testzicounter_mem_realtype_29829[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t testzicounter_mem_realtype_29876[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t testzihist_locks_mem_realtype_29888[100151];
static int32_t testzicounter_mem_realtype_29899[10240];
static int32_t testzicounter_mem_realtype_29971[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
static int32_t testzicounter_mem_realtype_29988[10240];
static int32_t testzicounter_mem_realtype_29999[10] = {0, 0, 0, 0, 0, 0, 0, 0,
                                                       0, 0};
struct memblock_device {
    int *references;
    cl_mem mem;
    int64_t size;
    const char *desc;
} ;
struct memblock {
    int *references;
    char *mem;
    int64_t size;
    const char *desc;
} ;
typedef cl_mem fl_mem_t;
// Start of free_list.h.

// An entry in the free list.  May be invalid, to avoid having to
// deallocate entries as soon as they are removed.  There is also a
// tag, to help with memory reuse.
struct free_list_entry {
  size_t size;
  fl_mem_t mem;
  const char *tag;
  unsigned char valid;
};

struct free_list {
  struct free_list_entry *entries;        // Pointer to entries.
  int capacity;                           // Number of entries.
  int used;                               // Number of valid entries.
};

static void free_list_init(struct free_list *l) {
  l->capacity = 30; // Picked arbitrarily.
  l->used = 0;
  l->entries = (struct free_list_entry*) malloc(sizeof(struct free_list_entry) * l->capacity);
  for (int i = 0; i < l->capacity; i++) {
    l->entries[i].valid = 0;
  }
}

// Remove invalid entries from the free list.
static void free_list_pack(struct free_list *l) {
  int p = 0;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[p] = l->entries[i];
      p++;
    }
  }

  // Now p is the number of used elements.  We don't want it to go
  // less than the default capacity (although in practice it's OK as
  // long as it doesn't become 1).
  if (p < 30) {
    p = 30;
  }
  l->entries = realloc(l->entries, p * sizeof(struct free_list_entry));
  l->capacity = p;
}

static void free_list_destroy(struct free_list *l) {
  assert(l->used == 0);
  free(l->entries);
}

static int free_list_find_invalid(struct free_list *l) {
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (!l->entries[i].valid) {
      break;
    }
  }
  return i;
}

static void free_list_insert(struct free_list *l, size_t size, fl_mem_t mem, const char *tag) {
  int i = free_list_find_invalid(l);

  if (i == l->capacity) {
    // List is full; so we have to grow it.
    int new_capacity = l->capacity * 2 * sizeof(struct free_list_entry);
    l->entries = realloc(l->entries, new_capacity);
    for (int j = 0; j < l->capacity; j++) {
      l->entries[j+l->capacity].valid = 0;
    }
    l->capacity *= 2;
  }

  // Now 'i' points to the first invalid entry.
  l->entries[i].valid = 1;
  l->entries[i].size = size;
  l->entries[i].mem = mem;
  l->entries[i].tag = tag;

  l->used++;
}

// Find and remove a memory block of the indicated tag, or if that
// does not exist, another memory block with exactly the desired size.
// Returns 0 on success.
static int free_list_find(struct free_list *l, size_t size,
                          size_t *size_out, fl_mem_t *mem_out) {
  int size_match = -1;
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid &&
        size <= l->entries[i].size &&
        (size_match < 0 || l->entries[i].size < l->entries[size_match].size)) {
      // If this entry is valid, has sufficient size, and is smaller than the
      // best entry found so far, use this entry.
      size_match = i;
    }
  }

  if (size_match >= 0) {
    l->entries[size_match].valid = 0;
    *size_out = l->entries[size_match].size;
    *mem_out = l->entries[size_match].mem;
    l->used--;
    return 0;
  } else {
    return 1;
  }
}

// Remove the first block in the free list.  Returns 0 if a block was
// removed, and nonzero if the free list was already empty.
static int free_list_first(struct free_list *l, fl_mem_t *mem_out) {
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[i].valid = 0;
      *mem_out = l->entries[i].mem;
      l->used--;
      return 0;
    }
  }

  return 1;
}

// End of free_list.h.

// Start of opencl.h.

#define OPENCL_SUCCEED_FATAL(e) opencl_succeed_fatal(e, #e, __FILE__, __LINE__)
#define OPENCL_SUCCEED_NONFATAL(e) opencl_succeed_nonfatal(e, #e, __FILE__, __LINE__)
// Take care not to override an existing error.
#define OPENCL_SUCCEED_OR_RETURN(e) {             \
    char *serror = OPENCL_SUCCEED_NONFATAL(e);    \
    if (serror) {                                 \
      if (!ctx->error) {                          \
        ctx->error = serror;                      \
        return bad;                               \
      } else {                                    \
        free(serror);                             \
      }                                           \
    }                                             \
  }

// OPENCL_SUCCEED_OR_RETURN returns the value of the variable 'bad' in
// scope.  By default, it will be this one.  Create a local variable
// of some other type if needed.  This is a bit of a hack, but it
// saves effort in the code generator.
static const int bad = 1;

struct opencl_config {
  int debugging;
  int profiling;
  int logging;
  int preferred_device_num;
  const char *preferred_platform;
  const char *preferred_device;
  int ignore_blacklist;

  const char* dump_program_to;
  const char* load_program_from;
  const char* dump_binary_to;
  const char* load_binary_from;

  size_t default_group_size;
  size_t default_num_groups;
  size_t default_tile_size;
  size_t default_threshold;

  int default_group_size_changed;
  int default_tile_size_changed;

  int num_sizes;
  const char **size_names;
  const char **size_vars;
  size_t *size_values;
  const char **size_classes;
};

static void opencl_config_init(struct opencl_config *cfg,
                               int num_sizes,
                               const char *size_names[],
                               const char *size_vars[],
                               size_t *size_values,
                               const char *size_classes[]) {
  cfg->debugging = 0;
  cfg->logging = 0;
  cfg->profiling = 0;
  cfg->preferred_device_num = 0;
  cfg->preferred_platform = "";
  cfg->preferred_device = "";
  cfg->ignore_blacklist = 0;
  cfg->dump_program_to = NULL;
  cfg->load_program_from = NULL;
  cfg->dump_binary_to = NULL;
  cfg->load_binary_from = NULL;

  // The following are dummy sizes that mean the concrete defaults
  // will be set during initialisation via hardware-inspection-based
  // heuristics.
  cfg->default_group_size = 0;
  cfg->default_num_groups = 0;
  cfg->default_tile_size = 0;
  cfg->default_threshold = 0;

  cfg->default_group_size_changed = 0;
  cfg->default_tile_size_changed = 0;

  cfg->num_sizes = num_sizes;
  cfg->size_names = size_names;
  cfg->size_vars = size_vars;
  cfg->size_values = size_values;
  cfg->size_classes = size_classes;
}

// A record of something that happened.
struct profiling_record {
  cl_event *event;
  int *runs;
  int64_t *runtime;
};

struct opencl_context {
  cl_device_id device;
  cl_context ctx;
  cl_command_queue queue;

  struct opencl_config cfg;

  struct free_list free_list;

  size_t max_group_size;
  size_t max_num_groups;
  size_t max_tile_size;
  size_t max_threshold;
  size_t max_local_memory;

  size_t lockstep_width;

  struct profiling_record *profiling_records;
  int profiling_records_capacity;
  int profiling_records_used;
};

struct opencl_device_option {
  cl_platform_id platform;
  cl_device_id device;
  cl_device_type device_type;
  char *platform_name;
  char *device_name;
};

// This function must be defined by the user.  It is invoked by
// setup_opencl() after the platform and device has been found, but
// before the program is loaded.  Its intended use is to tune
// constants based on the selected platform and device.
static void post_opencl_setup(struct opencl_context*, struct opencl_device_option*);

static char *strclone(const char *str) {
  size_t size = strlen(str) + 1;
  char *copy = (char*) malloc(size);
  if (copy == NULL) {
    return NULL;
  }

  memcpy(copy, str, size);
  return copy;
}

static const char* opencl_error_string(cl_int err)
{
    switch (err) {
        case CL_SUCCESS:                            return "Success!";
        case CL_DEVICE_NOT_FOUND:                   return "Device not found.";
        case CL_DEVICE_NOT_AVAILABLE:               return "Device not available";
        case CL_COMPILER_NOT_AVAILABLE:             return "Compiler not available";
        case CL_MEM_OBJECT_ALLOCATION_FAILURE:      return "Memory object allocation failure";
        case CL_OUT_OF_RESOURCES:                   return "Out of resources";
        case CL_OUT_OF_HOST_MEMORY:                 return "Out of host memory";
        case CL_PROFILING_INFO_NOT_AVAILABLE:       return "Profiling information not available";
        case CL_MEM_COPY_OVERLAP:                   return "Memory copy overlap";
        case CL_IMAGE_FORMAT_MISMATCH:              return "Image format mismatch";
        case CL_IMAGE_FORMAT_NOT_SUPPORTED:         return "Image format not supported";
        case CL_BUILD_PROGRAM_FAILURE:              return "Program build failure";
        case CL_MAP_FAILURE:                        return "Map failure";
        case CL_INVALID_VALUE:                      return "Invalid value";
        case CL_INVALID_DEVICE_TYPE:                return "Invalid device type";
        case CL_INVALID_PLATFORM:                   return "Invalid platform";
        case CL_INVALID_DEVICE:                     return "Invalid device";
        case CL_INVALID_CONTEXT:                    return "Invalid context";
        case CL_INVALID_QUEUE_PROPERTIES:           return "Invalid queue properties";
        case CL_INVALID_COMMAND_QUEUE:              return "Invalid command queue";
        case CL_INVALID_HOST_PTR:                   return "Invalid host pointer";
        case CL_INVALID_MEM_OBJECT:                 return "Invalid memory object";
        case CL_INVALID_IMAGE_FORMAT_DESCRIPTOR:    return "Invalid image format descriptor";
        case CL_INVALID_IMAGE_SIZE:                 return "Invalid image size";
        case CL_INVALID_SAMPLER:                    return "Invalid sampler";
        case CL_INVALID_BINARY:                     return "Invalid binary";
        case CL_INVALID_BUILD_OPTIONS:              return "Invalid build options";
        case CL_INVALID_PROGRAM:                    return "Invalid program";
        case CL_INVALID_PROGRAM_EXECUTABLE:         return "Invalid program executable";
        case CL_INVALID_KERNEL_NAME:                return "Invalid kernel name";
        case CL_INVALID_KERNEL_DEFINITION:          return "Invalid kernel definition";
        case CL_INVALID_KERNEL:                     return "Invalid kernel";
        case CL_INVALID_ARG_INDEX:                  return "Invalid argument index";
        case CL_INVALID_ARG_VALUE:                  return "Invalid argument value";
        case CL_INVALID_ARG_SIZE:                   return "Invalid argument size";
        case CL_INVALID_KERNEL_ARGS:                return "Invalid kernel arguments";
        case CL_INVALID_WORK_DIMENSION:             return "Invalid work dimension";
        case CL_INVALID_WORK_GROUP_SIZE:            return "Invalid work group size";
        case CL_INVALID_WORK_ITEM_SIZE:             return "Invalid work item size";
        case CL_INVALID_GLOBAL_OFFSET:              return "Invalid global offset";
        case CL_INVALID_EVENT_WAIT_LIST:            return "Invalid event wait list";
        case CL_INVALID_EVENT:                      return "Invalid event";
        case CL_INVALID_OPERATION:                  return "Invalid operation";
        case CL_INVALID_GL_OBJECT:                  return "Invalid OpenGL object";
        case CL_INVALID_BUFFER_SIZE:                return "Invalid buffer size";
        case CL_INVALID_MIP_LEVEL:                  return "Invalid mip-map level";
        default:                                    return "Unknown";
    }
}

static void opencl_succeed_fatal(unsigned int ret,
                                 const char *call,
                                 const char *file,
                                 int line) {
  if (ret != CL_SUCCESS) {
    futhark_panic(-1, "%s:%d: OpenCL call\n  %s\nfailed with error code %d (%s)\n",
          file, line, call, ret, opencl_error_string(ret));
  }
}

static char* opencl_succeed_nonfatal(unsigned int ret,
                                     const char *call,
                                     const char *file,
                                     int line) {
  if (ret != CL_SUCCESS) {
    return msgprintf("%s:%d: OpenCL call\n  %s\nfailed with error code %d (%s)\n",
                     file, line, call, ret, opencl_error_string(ret));
  } else {
    return NULL;
  }
}

static void set_preferred_platform(struct opencl_config *cfg, const char *s) {
  cfg->preferred_platform = s;
  cfg->ignore_blacklist = 1;
}

static void set_preferred_device(struct opencl_config *cfg, const char *s) {
  int x = 0;
  if (*s == '#') {
    s++;
    while (isdigit(*s)) {
      x = x * 10 + (*s++)-'0';
    }
    // Skip trailing spaces.
    while (isspace(*s)) {
      s++;
    }
  }
  cfg->preferred_device = s;
  cfg->preferred_device_num = x;
  cfg->ignore_blacklist = 1;
}

static char* opencl_platform_info(cl_platform_id platform,
                                  cl_platform_info param) {
  size_t req_bytes;
  char *info;

  OPENCL_SUCCEED_FATAL(clGetPlatformInfo(platform, param, 0, NULL, &req_bytes));

  info = (char*) malloc(req_bytes);

  OPENCL_SUCCEED_FATAL(clGetPlatformInfo(platform, param, req_bytes, info, NULL));

  return info;
}

static char* opencl_device_info(cl_device_id device,
                                cl_device_info param) {
  size_t req_bytes;
  char *info;

  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device, param, 0, NULL, &req_bytes));

  info = (char*) malloc(req_bytes);

  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device, param, req_bytes, info, NULL));

  return info;
}

static void opencl_all_device_options(struct opencl_device_option **devices_out,
                                      size_t *num_devices_out) {
  size_t num_devices = 0, num_devices_added = 0;

  cl_platform_id *all_platforms;
  cl_uint *platform_num_devices;

  cl_uint num_platforms;

  // Find the number of platforms.
  OPENCL_SUCCEED_FATAL(clGetPlatformIDs(0, NULL, &num_platforms));

  // Make room for them.
  all_platforms = calloc(num_platforms, sizeof(cl_platform_id));
  platform_num_devices = calloc(num_platforms, sizeof(cl_uint));

  // Fetch all the platforms.
  OPENCL_SUCCEED_FATAL(clGetPlatformIDs(num_platforms, all_platforms, NULL));

  // Count the number of devices for each platform, as well as the
  // total number of devices.
  for (cl_uint i = 0; i < num_platforms; i++) {
    if (clGetDeviceIDs(all_platforms[i], CL_DEVICE_TYPE_ALL,
                       0, NULL, &platform_num_devices[i]) == CL_SUCCESS) {
      num_devices += platform_num_devices[i];
    } else {
      platform_num_devices[i] = 0;
    }
  }

  // Make room for all the device options.
  struct opencl_device_option *devices =
    calloc(num_devices, sizeof(struct opencl_device_option));

  // Loop through the platforms, getting information about their devices.
  for (cl_uint i = 0; i < num_platforms; i++) {
    cl_platform_id platform = all_platforms[i];
    cl_uint num_platform_devices = platform_num_devices[i];

    if (num_platform_devices == 0) {
      continue;
    }

    char *platform_name = opencl_platform_info(platform, CL_PLATFORM_NAME);
    cl_device_id *platform_devices =
      calloc(num_platform_devices, sizeof(cl_device_id));

    // Fetch all the devices.
    OPENCL_SUCCEED_FATAL(clGetDeviceIDs(platform, CL_DEVICE_TYPE_ALL,
                                  num_platform_devices, platform_devices, NULL));

    // Loop through the devices, adding them to the devices array.
    for (cl_uint i = 0; i < num_platform_devices; i++) {
      char *device_name = opencl_device_info(platform_devices[i], CL_DEVICE_NAME);
      devices[num_devices_added].platform = platform;
      devices[num_devices_added].device = platform_devices[i];
      OPENCL_SUCCEED_FATAL(clGetDeviceInfo(platform_devices[i], CL_DEVICE_TYPE,
                                     sizeof(cl_device_type),
                                     &devices[num_devices_added].device_type,
                                     NULL));
      // We don't want the structs to share memory, so copy the platform name.
      // Each device name is already unique.
      devices[num_devices_added].platform_name = strclone(platform_name);
      devices[num_devices_added].device_name = device_name;
      num_devices_added++;
    }
    free(platform_devices);
    free(platform_name);
  }
  free(all_platforms);
  free(platform_num_devices);

  *devices_out = devices;
  *num_devices_out = num_devices;
}

// Returns 0 on success.
static int list_devices(struct opencl_config *cfg) {
  struct opencl_device_option *devices;
  size_t num_devices;

  opencl_all_device_options(&devices, &num_devices);

  const char *cur_platform = "";
  for (size_t i = 0; i < num_devices; i++) {
    struct opencl_device_option device = devices[i];
    if (strcmp(cur_platform, device.platform_name) != 0) {
      printf("Platform: %s\n", device.platform_name);
      cur_platform = device.platform_name;
    }
    printf("[%d]: %s\n", (int)i, device.device_name);
  }

  // Free all the platform and device names.
  for (size_t j = 0; j < num_devices; j++) {
    free(devices[j].platform_name);
    free(devices[j].device_name);
  }
  free(devices);

  return 0;
}

// Returns 0 on success.
static int select_device_interactively(struct opencl_config *cfg) {
  struct opencl_device_option *devices;
  size_t num_devices;
  int ret = 1;

  opencl_all_device_options(&devices, &num_devices);

  printf("Choose OpenCL device:\n");
  const char *cur_platform = "";
  for (size_t i = 0; i < num_devices; i++) {
    struct opencl_device_option device = devices[i];
    if (strcmp(cur_platform, device.platform_name) != 0) {
      printf("Platform: %s\n", device.platform_name);
      cur_platform = device.platform_name;
    }
    printf("[%d] %s\n", (int)i, device.device_name);
  }

  int selection;
  printf("Choice: ");
  if (scanf("%d", &selection) == 1) {
    ret = 0;
    cfg->preferred_platform = "";
    cfg->preferred_device = "";
    cfg->preferred_device_num = selection;
    cfg->ignore_blacklist = 1;
  }

  // Free all the platform and device names.
  for (size_t j = 0; j < num_devices; j++) {
    free(devices[j].platform_name);
    free(devices[j].device_name);
  }
  free(devices);

  return ret;
}

static int is_blacklisted(const char *platform_name, const char *device_name,
                          const struct opencl_config *cfg) {
  if (strcmp(cfg->preferred_platform, "") != 0 ||
      strcmp(cfg->preferred_device, "") != 0) {
    return 0;
  } else if (strstr(platform_name, "Apple") != NULL &&
             strstr(device_name, "Intel(R) Core(TM)") != NULL) {
    return 1;
  } else {
    return 0;
  }
}

static struct opencl_device_option get_preferred_device(const struct opencl_config *cfg) {
  struct opencl_device_option *devices;
  size_t num_devices;

  opencl_all_device_options(&devices, &num_devices);

  int num_device_matches = 0;

  for (size_t i = 0; i < num_devices; i++) {
    struct opencl_device_option device = devices[i];
    if (strstr(device.platform_name, cfg->preferred_platform) != NULL &&
        strstr(device.device_name, cfg->preferred_device) != NULL &&
        (cfg->ignore_blacklist ||
         !is_blacklisted(device.platform_name, device.device_name, cfg)) &&
        num_device_matches++ == cfg->preferred_device_num) {
      // Free all the platform and device names, except the ones we have chosen.
      for (size_t j = 0; j < num_devices; j++) {
        if (j != i) {
          free(devices[j].platform_name);
          free(devices[j].device_name);
        }
      }
      free(devices);
      return device;
    }
  }

  futhark_panic(1, "Could not find acceptable OpenCL device.\n");
  exit(1); // Never reached
}

static void describe_device_option(struct opencl_device_option device) {
  fprintf(stderr, "Using platform: %s\n", device.platform_name);
  fprintf(stderr, "Using device: %s\n", device.device_name);
}

static cl_build_status build_opencl_program(cl_program program, cl_device_id device, const char* options) {
  cl_int clBuildProgram_error = clBuildProgram(program, 1, &device, options, NULL, NULL);

  // Avoid termination due to CL_BUILD_PROGRAM_FAILURE
  if (clBuildProgram_error != CL_SUCCESS &&
      clBuildProgram_error != CL_BUILD_PROGRAM_FAILURE) {
    OPENCL_SUCCEED_FATAL(clBuildProgram_error);
  }

  cl_build_status build_status;
  OPENCL_SUCCEED_FATAL(clGetProgramBuildInfo(program,
                                             device,
                                             CL_PROGRAM_BUILD_STATUS,
                                             sizeof(cl_build_status),
                                             &build_status,
                                             NULL));

  if (build_status != CL_SUCCESS) {
    char *build_log;
    size_t ret_val_size;
    OPENCL_SUCCEED_FATAL(clGetProgramBuildInfo(program, device, CL_PROGRAM_BUILD_LOG, 0, NULL, &ret_val_size));

    build_log = (char*) malloc(ret_val_size+1);
    OPENCL_SUCCEED_FATAL(clGetProgramBuildInfo(program, device, CL_PROGRAM_BUILD_LOG, ret_val_size, build_log, NULL));

    // The spec technically does not say whether the build log is zero-terminated, so let's be careful.
    build_log[ret_val_size] = '\0';

    fprintf(stderr, "Build log:\n%s\n", build_log);

    free(build_log);
  }

  return build_status;
}

// Fields in a bitmask indicating which types we must be sure are
// available.
enum opencl_required_type { OPENCL_F64 = 1 };

// We take as input several strings representing the program, because
// C does not guarantee that the compiler supports particularly large
// literals.  Notably, Visual C has a limit of 2048 characters.  The
// array must be NULL-terminated.
static cl_program setup_opencl_with_command_queue(struct opencl_context *ctx,
                                                  cl_command_queue queue,
                                                  const char *srcs[],
                                                  int required_types,
                                                  const char *extra_build_opts[]) {
  int error;

  free_list_init(&ctx->free_list);
  ctx->queue = queue;

  OPENCL_SUCCEED_FATAL(clGetCommandQueueInfo(ctx->queue, CL_QUEUE_CONTEXT, sizeof(cl_context), &ctx->ctx, NULL));

  // Fill out the device info.  This is redundant work if we are
  // called from setup_opencl() (which is the common case), but I
  // doubt it matters much.
  struct opencl_device_option device_option;
  OPENCL_SUCCEED_FATAL(clGetCommandQueueInfo(ctx->queue, CL_QUEUE_DEVICE,
                                       sizeof(cl_device_id),
                                       &device_option.device,
                                       NULL));
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_PLATFORM,
                                 sizeof(cl_platform_id),
                                 &device_option.platform,
                                 NULL));
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_TYPE,
                                 sizeof(cl_device_type),
                                 &device_option.device_type,
                                 NULL));
  device_option.platform_name = opencl_platform_info(device_option.platform, CL_PLATFORM_NAME);
  device_option.device_name = opencl_device_info(device_option.device, CL_DEVICE_NAME);

  ctx->device = device_option.device;

  if (required_types & OPENCL_F64) {
    cl_uint supported;
    OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_PREFERRED_VECTOR_WIDTH_DOUBLE,
                                   sizeof(cl_uint), &supported, NULL));
    if (!supported) {
      futhark_panic(1, "Program uses double-precision floats, but this is not supported on the chosen device: %s\n",
            device_option.device_name);
    }
  }

  size_t max_group_size;
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_MAX_WORK_GROUP_SIZE,
                                 sizeof(size_t), &max_group_size, NULL));

  size_t max_tile_size = sqrt(max_group_size);

  cl_ulong max_local_memory;
  OPENCL_SUCCEED_FATAL(clGetDeviceInfo(device_option.device, CL_DEVICE_LOCAL_MEM_SIZE,
                                       sizeof(size_t), &max_local_memory, NULL));

  // Futhark reserves 4 bytes for bookkeeping information.
  max_local_memory -= 4;

  // The OpenCL implementation may reserve some local memory bytes for
  // various purposes.  In principle, we should use
  // clGetKernelWorkGroupInfo() to figure out for each kernel how much
  // is actually available, but our current code generator design
  // makes this infeasible.  Instead, we have this nasty hack where we
  // arbitrarily subtract some bytes, based on empirical measurements
  // (but which might be arbitrarily wrong).  Fortunately, we rarely
  // try to really push the local memory usage.
  if (strstr(device_option.platform_name, "NVIDIA CUDA") != NULL) {
    max_local_memory -= 12;
  } else if (strstr(device_option.platform_name, "AMD") != NULL) {
    max_local_memory -= 16;
  }

  // Make sure this function is defined.
  post_opencl_setup(ctx, &device_option);

  if (max_group_size < ctx->cfg.default_group_size) {
    if (ctx->cfg.default_group_size_changed) {
      fprintf(stderr, "Note: Device limits default group size to %zu (down from %zu).\n",
              max_group_size, ctx->cfg.default_group_size);
    }
    ctx->cfg.default_group_size = max_group_size;
  }

  if (max_tile_size < ctx->cfg.default_tile_size) {
    if (ctx->cfg.default_tile_size_changed) {
      fprintf(stderr, "Note: Device limits default tile size to %zu (down from %zu).\n",
              max_tile_size, ctx->cfg.default_tile_size);
    }
    ctx->cfg.default_tile_size = max_tile_size;
  }

  ctx->max_group_size = max_group_size;
  ctx->max_tile_size = max_tile_size; // No limit.
  ctx->max_threshold = ctx->max_num_groups = 0; // No limit.
  ctx->max_local_memory = max_local_memory;

  // Now we go through all the sizes, clamp them to the valid range,
  // or set them to the default.
  for (int i = 0; i < ctx->cfg.num_sizes; i++) {
    const char *size_class = ctx->cfg.size_classes[i];
    size_t *size_value = &ctx->cfg.size_values[i];
    const char* size_name = ctx->cfg.size_names[i];
    size_t max_value = 0, default_value = 0;
    if (strstr(size_class, "group_size") == size_class) {
      max_value = max_group_size;
      default_value = ctx->cfg.default_group_size;
    } else if (strstr(size_class, "num_groups") == size_class) {
      max_value = max_group_size; // Futhark assumes this constraint.
      default_value = ctx->cfg.default_num_groups;
      // XXX: as a quick and dirty hack, use twice as many threads for
      // histograms by default.  We really should just be smarter
      // about sizes somehow.
      if (strstr(size_name, ".seghist_") != NULL) {
        default_value *= 2;
      }
    } else if (strstr(size_class, "tile_size") == size_class) {
      max_value = sqrt(max_group_size);
      default_value = ctx->cfg.default_tile_size;
    } else if (strstr(size_class, "threshold") == size_class) {
      // Threshold can be as large as it takes.
      default_value = ctx->cfg.default_threshold;
    } else {
      // Bespoke sizes have no limit or default.
    }
    if (*size_value == 0) {
      *size_value = default_value;
    } else if (max_value > 0 && *size_value > max_value) {
      fprintf(stderr, "Note: Device limits %s to %d (down from %d)\n",
              size_name, (int)max_value, (int)*size_value);
      *size_value = max_value;
    }
  }

  if (ctx->lockstep_width == 0) {
    ctx->lockstep_width = 1;
  }

  if (ctx->cfg.logging) {
    fprintf(stderr, "Lockstep width: %d\n", (int)ctx->lockstep_width);
    fprintf(stderr, "Default group size: %d\n", (int)ctx->cfg.default_group_size);
    fprintf(stderr, "Default number of groups: %d\n", (int)ctx->cfg.default_num_groups);
  }

  char *fut_opencl_src = NULL;
  cl_program prog;
  error = CL_SUCCESS;

  if (ctx->cfg.load_binary_from == NULL) {
    size_t src_size = 0;

    // Maybe we have to read OpenCL source from somewhere else (used for debugging).
    if (ctx->cfg.load_program_from != NULL) {
      fut_opencl_src = slurp_file(ctx->cfg.load_program_from, NULL);
      assert(fut_opencl_src != NULL);
    } else {
      // Construct the OpenCL source concatenating all the fragments.
      for (const char **src = srcs; src && *src; src++) {
        src_size += strlen(*src);
      }

      fut_opencl_src = (char*) malloc(src_size + 1);

      size_t n, i;
      for (i = 0, n = 0; srcs && srcs[i]; i++) {
        strncpy(fut_opencl_src+n, srcs[i], src_size-n);
        n += strlen(srcs[i]);
      }
      fut_opencl_src[src_size] = 0;
    }

    if (ctx->cfg.dump_program_to != NULL) {
      if (ctx->cfg.debugging) {
        fprintf(stderr, "Dumping OpenCL source to %s...\n", ctx->cfg.dump_program_to);
      }

      dump_file(ctx->cfg.dump_program_to, fut_opencl_src, strlen(fut_opencl_src));
    }

    if (ctx->cfg.debugging) {
      fprintf(stderr, "Creating OpenCL program...\n");
    }

    const char* src_ptr[] = {fut_opencl_src};
    prog = clCreateProgramWithSource(ctx->ctx, 1, src_ptr, &src_size, &error);
    OPENCL_SUCCEED_FATAL(error);
  } else {
    if (ctx->cfg.debugging) {
      fprintf(stderr, "Loading OpenCL binary from %s...\n", ctx->cfg.load_binary_from);
    }
    size_t binary_size;
    unsigned char *fut_opencl_bin =
      (unsigned char*) slurp_file(ctx->cfg.load_binary_from, &binary_size);
    assert(fut_opencl_bin != NULL);
    const unsigned char *binaries[1] = { fut_opencl_bin };
    cl_int status = 0;

    prog = clCreateProgramWithBinary(ctx->ctx, 1, &device_option.device,
                                     &binary_size, binaries,
                                     &status, &error);

    OPENCL_SUCCEED_FATAL(status);
    OPENCL_SUCCEED_FATAL(error);
  }

  int compile_opts_size = 1024;

  for (int i = 0; i < ctx->cfg.num_sizes; i++) {
    compile_opts_size += strlen(ctx->cfg.size_names[i]) + 20;
  }

  for (int i = 0; extra_build_opts[i] != NULL; i++) {
    compile_opts_size += strlen(extra_build_opts[i] + 1);
  }

  char *compile_opts = (char*) malloc(compile_opts_size);

  int w = snprintf(compile_opts, compile_opts_size,
                   "-DLOCKSTEP_WIDTH=%d ",
                   (int)ctx->lockstep_width);

  for (int i = 0; i < ctx->cfg.num_sizes; i++) {
    w += snprintf(compile_opts+w, compile_opts_size-w,
                  "-D%s=%d ",
                  ctx->cfg.size_vars[i],
                  (int)ctx->cfg.size_values[i]);
  }

  for (int i = 0; extra_build_opts[i] != NULL; i++) {
    w += snprintf(compile_opts+w, compile_opts_size-w,
                  "%s ", extra_build_opts[i]);
  }

  if (ctx->cfg.debugging) {
    fprintf(stderr, "OpenCL compiler options: %s\n", compile_opts);
    fprintf(stderr, "Building OpenCL program...\n");
  }
  OPENCL_SUCCEED_FATAL(build_opencl_program(prog, device_option.device, compile_opts));

  free(compile_opts);
  free(fut_opencl_src);

  if (ctx->cfg.dump_binary_to != NULL) {
    if (ctx->cfg.debugging) {
      fprintf(stderr, "Dumping OpenCL binary to %s...\n", ctx->cfg.dump_binary_to);
    }

    size_t binary_size;
    OPENCL_SUCCEED_FATAL(clGetProgramInfo(prog, CL_PROGRAM_BINARY_SIZES,
                                          sizeof(size_t), &binary_size, NULL));
    unsigned char *binary = (unsigned char*) malloc(binary_size);
    unsigned char *binaries[1] = { binary };
    OPENCL_SUCCEED_FATAL(clGetProgramInfo(prog, CL_PROGRAM_BINARIES,
                                          sizeof(unsigned char*), binaries, NULL));

    dump_file(ctx->cfg.dump_binary_to, binary, binary_size);
  }

  return prog;
}

static cl_program setup_opencl(struct opencl_context *ctx,
                               const char *srcs[],
                               int required_types,
                               const char *extra_build_opts[]) {

  ctx->lockstep_width = 0; // Real value set later.

  struct opencl_device_option device_option = get_preferred_device(&ctx->cfg);

  if (ctx->cfg.logging) {
    describe_device_option(device_option);
  }

  // Note that NVIDIA's OpenCL requires the platform property
  cl_context_properties properties[] = {
    CL_CONTEXT_PLATFORM,
    (cl_context_properties)device_option.platform,
    0
  };

  cl_int clCreateContext_error;
  ctx->ctx = clCreateContext(properties, 1, &device_option.device, NULL, NULL, &clCreateContext_error);
  OPENCL_SUCCEED_FATAL(clCreateContext_error);

  cl_int clCreateCommandQueue_error;
  cl_command_queue queue =
    clCreateCommandQueue(ctx->ctx,
                         device_option.device,
                         ctx->cfg.profiling ? CL_QUEUE_PROFILING_ENABLE : 0,
                         &clCreateCommandQueue_error);
  OPENCL_SUCCEED_FATAL(clCreateCommandQueue_error);

  return setup_opencl_with_command_queue(ctx, queue, srcs, required_types, extra_build_opts);
}

// Count up the runtime all the profiling_records that occured during execution.
// Also clears the buffer of profiling_records.
static cl_int opencl_tally_profiling_records(struct opencl_context *ctx) {
  cl_int err;
  for (int i = 0; i < ctx->profiling_records_used; i++) {
    struct profiling_record record = ctx->profiling_records[i];

    cl_ulong start_t, end_t;

    if ((err = clGetEventProfilingInfo(*record.event,
                                       CL_PROFILING_COMMAND_START,
                                       sizeof(start_t),
                                       &start_t,
                                       NULL)) != CL_SUCCESS) {
      return err;
    }

    if ((err = clGetEventProfilingInfo(*record.event,
                                       CL_PROFILING_COMMAND_END,
                                       sizeof(end_t),
                                       &end_t,
                                       NULL)) != CL_SUCCESS) {
      return err;
    }

    // OpenCL provides nanosecond resolution, but we want
    // microseconds.
    *record.runs += 1;
    *record.runtime += (end_t - start_t)/1000;

    if ((err = clReleaseEvent(*record.event)) != CL_SUCCESS) {
      return err;
    }
    free(record.event);
  }

  ctx->profiling_records_used = 0;

  return CL_SUCCESS;
}

// If profiling, produce an event associated with a profiling record.
static cl_event* opencl_get_event(struct opencl_context *ctx, int *runs, int64_t *runtime) {
    if (ctx->profiling_records_used == ctx->profiling_records_capacity) {
      ctx->profiling_records_capacity *= 2;
      ctx->profiling_records =
        realloc(ctx->profiling_records,
                ctx->profiling_records_capacity *
                sizeof(struct profiling_record));
    }
    cl_event *event = malloc(sizeof(cl_event));
    ctx->profiling_records[ctx->profiling_records_used].event = event;
    ctx->profiling_records[ctx->profiling_records_used].runs = runs;
    ctx->profiling_records[ctx->profiling_records_used].runtime = runtime;
    ctx->profiling_records_used++;
    return event;
}

// Allocate memory from driver. The problem is that OpenCL may perform
// lazy allocation, so we cannot know whether an allocation succeeded
// until the first time we try to use it.  Hence we immediately
// perform a write to see if the allocation succeeded.  This is slow,
// but the assumption is that this operation will be rare (most things
// will go through the free list).
static int opencl_alloc_actual(struct opencl_context *ctx, size_t size, cl_mem *mem_out) {
  int error;
  *mem_out = clCreateBuffer(ctx->ctx, CL_MEM_READ_WRITE, size, NULL, &error);

  if (error != CL_SUCCESS) {
    return error;
  }

  int x = 2;
  error = clEnqueueWriteBuffer(ctx->queue, *mem_out, 1, 0, sizeof(x), &x, 0, NULL, NULL);

  // No need to wait for completion here. clWaitForEvents() cannot
  // return mem object allocation failures. This implies that the
  // buffer is faulted onto the device on enqueue. (Observation by
  // Andreas Kloeckner.)

  return error;
}

static int opencl_alloc(struct opencl_context *ctx, size_t min_size, const char *tag, cl_mem *mem_out) {
  (void)tag;
  if (min_size < sizeof(int)) {
    min_size = sizeof(int);
  }

  size_t size;

  if (free_list_find(&ctx->free_list, min_size, &size, mem_out) == 0) {
    // Successfully found a free block.  Is it big enough?
    //
    // FIXME: we might also want to check whether the block is *too
    // big*, to avoid internal fragmentation.  However, this can
    // sharply impact performance on programs where arrays change size
    // frequently.  Fortunately, such allocations are usually fairly
    // short-lived, as they are necessarily within a loop, so the risk
    // of internal fragmentation resulting in an OOM situation is
    // limited.  However, it would be preferable if we could go back
    // and *shrink* oversize allocations when we encounter an OOM
    // condition.  That is technically feasible, since we do not
    // expose OpenCL pointer values directly to the application, but
    // instead rely on a level of indirection.
    if (size >= min_size) {
      if (ctx->cfg.debugging) {
        fprintf(stderr, "No need to allocate: Found a block in the free list.\n");
      }

      return CL_SUCCESS;
    } else {
      if (ctx->cfg.debugging) {
        fprintf(stderr, "Found a free block, but it was too small.\n");
      }

      // Not just right - free it.
      int error = clReleaseMemObject(*mem_out);
      if (error != CL_SUCCESS) {
        return error;
      }
    }
  }

  // We have to allocate a new block from the driver.  If the
  // allocation does not succeed, then we might be in an out-of-memory
  // situation.  We now start freeing things from the free list until
  // we think we have freed enough that the allocation will succeed.
  // Since we don't know how far the allocation is from fitting, we
  // have to check after every deallocation.  This might be pretty
  // expensive.  Let's hope that this case is hit rarely.

  if (ctx->cfg.debugging) {
    fprintf(stderr, "Actually allocating the desired block.\n");
  }

  int error = opencl_alloc_actual(ctx, min_size, mem_out);

  while (error == CL_MEM_OBJECT_ALLOCATION_FAILURE) {
    if (ctx->cfg.debugging) {
      fprintf(stderr, "Out of OpenCL memory: releasing entry from the free list...\n");
    }
    cl_mem mem;
    if (free_list_first(&ctx->free_list, &mem) == 0) {
      error = clReleaseMemObject(mem);
      if (error != CL_SUCCESS) {
        return error;
      }
    } else {
      break;
    }
    error = opencl_alloc_actual(ctx, min_size, mem_out);
  }

  return error;
}

static int opencl_free(struct opencl_context *ctx, cl_mem mem, const char *tag) {
  size_t size;
  cl_mem existing_mem;

  // If there is already a block with this tag, then remove it.
  if (free_list_find(&ctx->free_list, -1, &size, &existing_mem) == 0) {
    int error = clReleaseMemObject(existing_mem);
    if (error != CL_SUCCESS) {
      return error;
    }
  }

  int error = clGetMemObjectInfo(mem, CL_MEM_SIZE, sizeof(size_t), &size, NULL);

  if (error == CL_SUCCESS) {
    free_list_insert(&ctx->free_list, size, mem, tag);
  }

  return error;
}

static int opencl_free_all(struct opencl_context *ctx) {
  cl_mem mem;
  free_list_pack(&ctx->free_list);
  while (free_list_first(&ctx->free_list, &mem) == 0) {
    int error = clReleaseMemObject(mem);
    if (error != CL_SUCCESS) {
      return error;
    }
  }

  return CL_SUCCESS;
}

// Free everything that belongs to 'ctx', but do not free 'ctx'
// itself.
static void teardown_opencl(struct opencl_context *ctx) {
  (void)opencl_tally_profiling_records(ctx);
  free(ctx->profiling_records);
  (void)opencl_free_all(ctx);
  (void)clReleaseCommandQueue(ctx->queue);
  (void)clReleaseContext(ctx->ctx);
}

// End of opencl.h.

static const char *opencl_program[] =
                  {"#ifdef cl_clang_storage_class_specifiers\n#pragma OPENCL EXTENSION cl_clang_storage_class_specifiers : enable\n#endif\n#pragma OPENCL EXTENSION cl_khr_byte_addressable_store : enable\n__kernel void dummy_kernel(__global unsigned char *dummy, int n)\n{\n    const int thread_gid = get_global_id(0);\n    \n    if (thread_gid >= n)\n        return;\n}\ntypedef char int8_t;\ntypedef short int16_t;\ntypedef int int32_t;\ntypedef long int64_t;\ntypedef uchar uint8_t;\ntypedef ushort uint16_t;\ntypedef uint uint32_t;\ntypedef ulong uint64_t;\n#ifdef cl_nv_pragma_unroll\nstatic inline void mem_fence_global()\n{\n    asm(\"membar.gl;\");\n}\n#else\nstatic inline void mem_fence_global()\n{\n    mem_fence(CLK_LOCAL_MEM_FENCE | CLK_GLOBAL_MEM_FENCE);\n}\n#endif\nstatic inline void mem_fence_local()\n{\n    mem_fence(CLK_LOCAL_MEM_FENCE);\n}\nstatic inline uint8_t add8(uint8_t x, uint8_t y)\n{\n    return x + y;\n}\nstatic inline uint16_t add16(uint16_t x, uint16_t y)\n{\n    return x + y;\n}\nstatic inline uint32_t add32(uint32_t x, uint32_t y)\n{\n    return x + y;\n}\nstatic inline uint64_t add64(uint64_t x, uint64_t y)\n{\n    return x + y;\n}\nstatic inline uint8_t sub8(uint8_t x, uint8_t y)\n{\n    return x - y;\n}\nstatic inline uint16_t sub16(uint16_t x, uint16_t y)\n{\n    return x - y;\n}\nstatic inline uint32_t sub32(uint32_t x, uint32_t y)\n{\n    return x - y;\n}\nstatic inline uint64_t sub64(uint64_t x, uint64_t y)\n{\n    return x - y;\n}\nstatic inline uint8_t mul8(uint8_t x, uint8_t y)\n{\n    return x * y;\n}\nstatic inline uint16_t mul16(uint16_t x, uint16_t y)\n{\n    return x * y;\n}\nstatic inline uint32_t mul32(uint32_t x, uint32_t y)\n{\n    return x * y;\n}\nstatic inline uint64_t mul64(uint64_t x, uint64_t y)\n{\n    return x * y;\n}\nstatic inline uint8_t udiv8(uint8_t x, uint8_t y)\n{\n    return x / y;\n}\nstatic inline uint16_t udiv16(uint16_t x, uint16_t y)\n{\n    return x / y;\n}\nstatic inline uint32_t udiv32(uint32_t x, uint32_t y)\n{\n    return x / y;\n}\nstatic inline uint64_t udiv64(uint64_t x, uint64_t y)\n{\n    return x / y;\n}\nstatic ",
                   "inline uint8_t udiv_up8(uint8_t x, uint8_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint16_t udiv_up16(uint16_t x, uint16_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint32_t udiv_up32(uint32_t x, uint32_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint64_t udiv_up64(uint64_t x, uint64_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint8_t umod8(uint8_t x, uint8_t y)\n{\n    return x % y;\n}\nstatic inline uint16_t umod16(uint16_t x, uint16_t y)\n{\n    return x % y;\n}\nstatic inline uint32_t umod32(uint32_t x, uint32_t y)\n{\n    return x % y;\n}\nstatic inline uint64_t umod64(uint64_t x, uint64_t y)\n{\n    return x % y;\n}\nstatic inline uint8_t udiv_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint16_t udiv_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint32_t udiv_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint64_t udiv_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint8_t udiv_up_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint16_t udiv_up_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint32_t udiv_up_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint64_t udiv_up_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint8_t umod_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint16_t umod_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint32_t umod_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint64_t umod_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int8_t sdiv8(int8_t x, int8_t y)\n{\n    int8_t q = x / y;\n    int8_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int16_t sdiv16(int16",
                   "_t x, int16_t y)\n{\n    int16_t q = x / y;\n    int16_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int32_t sdiv32(int32_t x, int32_t y)\n{\n    int32_t q = x / y;\n    int32_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int64_t sdiv64(int64_t x, int64_t y)\n{\n    int64_t q = x / y;\n    int64_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int8_t sdiv_up8(int8_t x, int8_t y)\n{\n    return sdiv8(x + y - 1, y);\n}\nstatic inline int16_t sdiv_up16(int16_t x, int16_t y)\n{\n    return sdiv16(x + y - 1, y);\n}\nstatic inline int32_t sdiv_up32(int32_t x, int32_t y)\n{\n    return sdiv32(x + y - 1, y);\n}\nstatic inline int64_t sdiv_up64(int64_t x, int64_t y)\n{\n    return sdiv64(x + y - 1, y);\n}\nstatic inline int8_t smod8(int8_t x, int8_t y)\n{\n    int8_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int16_t smod16(int16_t x, int16_t y)\n{\n    int16_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int32_t smod32(int32_t x, int32_t y)\n{\n    int32_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int64_t smod64(int64_t x, int64_t y)\n{\n    int64_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int8_t sdiv_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : sdiv8(x, y);\n}\nstatic inline int16_t sdiv_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : sdiv16(x, y);\n}\nstatic inline int32_t sdiv_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : sdiv32(x, y);\n}\nstatic inline int64_t sdiv_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : sdiv64(x, y);\n}\nstatic inline int8_t sdiv_up_safe8(int8_t x, int8_t y)\n{\n    return sdiv_safe8(x + y - 1, y);\n}\nstatic inline int16_t sdiv_up_safe16(int16_t x, int16_t y)\n{\n    return sdiv_safe16(x + y - 1, y",
                   ");\n}\nstatic inline int32_t sdiv_up_safe32(int32_t x, int32_t y)\n{\n    return sdiv_safe32(x + y - 1, y);\n}\nstatic inline int64_t sdiv_up_safe64(int64_t x, int64_t y)\n{\n    return sdiv_safe64(x + y - 1, y);\n}\nstatic inline int8_t smod_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : smod8(x, y);\n}\nstatic inline int16_t smod_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : smod16(x, y);\n}\nstatic inline int32_t smod_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : smod32(x, y);\n}\nstatic inline int64_t smod_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : smod64(x, y);\n}\nstatic inline int8_t squot8(int8_t x, int8_t y)\n{\n    return x / y;\n}\nstatic inline int16_t squot16(int16_t x, int16_t y)\n{\n    return x / y;\n}\nstatic inline int32_t squot32(int32_t x, int32_t y)\n{\n    return x / y;\n}\nstatic inline int64_t squot64(int64_t x, int64_t y)\n{\n    return x / y;\n}\nstatic inline int8_t srem8(int8_t x, int8_t y)\n{\n    return x % y;\n}\nstatic inline int16_t srem16(int16_t x, int16_t y)\n{\n    return x % y;\n}\nstatic inline int32_t srem32(int32_t x, int32_t y)\n{\n    return x % y;\n}\nstatic inline int64_t srem64(int64_t x, int64_t y)\n{\n    return x % y;\n}\nstatic inline int8_t squot_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int16_t squot_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int32_t squot_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int64_t squot_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int8_t srem_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int16_t srem_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int32_t srem_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int64_t srem_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int8_t smin8(int8_t x, int8_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int16_t smi",
                   "n16(int16_t x, int16_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int32_t smin32(int32_t x, int32_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int64_t smin64(int64_t x, int64_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint8_t umin8(uint8_t x, uint8_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint16_t umin16(uint16_t x, uint16_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint32_t umin32(uint32_t x, uint32_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint64_t umin64(uint64_t x, uint64_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int8_t smax8(int8_t x, int8_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int16_t smax16(int16_t x, int16_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int32_t smax32(int32_t x, int32_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int64_t smax64(int64_t x, int64_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint8_t umax8(uint8_t x, uint8_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint16_t umax16(uint16_t x, uint16_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint32_t umax32(uint32_t x, uint32_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint64_t umax64(uint64_t x, uint64_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint8_t shl8(uint8_t x, uint8_t y)\n{\n    return x << y;\n}\nstatic inline uint16_t shl16(uint16_t x, uint16_t y)\n{\n    return x << y;\n}\nstatic inline uint32_t shl32(uint32_t x, uint32_t y)\n{\n    return x << y;\n}\nstatic inline uint64_t shl64(uint64_t x, uint64_t y)\n{\n    return x << y;\n}\nstatic inline uint8_t lshr8(uint8_t x, uint8_t y)\n{\n    return x >> y;\n}\nstatic inline uint16_t lshr16(uint16_t x, uint16_t y)\n{\n    return x >> y;\n}\nstatic inline uint32_t lshr32(uint32_t x, uint32_t y)\n{\n    return x >> y;\n}\nstatic inline uint64_t lshr64(uint64_t x, uint64_t y)\n{\n    return x >> y;\n}\nstatic inline int8_t ashr8(int8_t x, int8_t y)\n{\n    return x >> y;\n}\nstatic inline int16_t ashr16(int16_t x, int16_t y)\n{\n    return x >> y;\n}\nstatic inline int32_t ashr32(int32_t x, int32_t y)",
                   "\n{\n    return x >> y;\n}\nstatic inline int64_t ashr64(int64_t x, int64_t y)\n{\n    return x >> y;\n}\nstatic inline uint8_t and8(uint8_t x, uint8_t y)\n{\n    return x & y;\n}\nstatic inline uint16_t and16(uint16_t x, uint16_t y)\n{\n    return x & y;\n}\nstatic inline uint32_t and32(uint32_t x, uint32_t y)\n{\n    return x & y;\n}\nstatic inline uint64_t and64(uint64_t x, uint64_t y)\n{\n    return x & y;\n}\nstatic inline uint8_t or8(uint8_t x, uint8_t y)\n{\n    return x | y;\n}\nstatic inline uint16_t or16(uint16_t x, uint16_t y)\n{\n    return x | y;\n}\nstatic inline uint32_t or32(uint32_t x, uint32_t y)\n{\n    return x | y;\n}\nstatic inline uint64_t or64(uint64_t x, uint64_t y)\n{\n    return x | y;\n}\nstatic inline uint8_t xor8(uint8_t x, uint8_t y)\n{\n    return x ^ y;\n}\nstatic inline uint16_t xor16(uint16_t x, uint16_t y)\n{\n    return x ^ y;\n}\nstatic inline uint32_t xor32(uint32_t x, uint32_t y)\n{\n    return x ^ y;\n}\nstatic inline uint64_t xor64(uint64_t x, uint64_t y)\n{\n    return x ^ y;\n}\nstatic inline bool ult8(uint8_t x, uint8_t y)\n{\n    return x < y;\n}\nstatic inline bool ult16(uint16_t x, uint16_t y)\n{\n    return x < y;\n}\nstatic inline bool ult32(uint32_t x, uint32_t y)\n{\n    return x < y;\n}\nstatic inline bool ult64(uint64_t x, uint64_t y)\n{\n    return x < y;\n}\nstatic inline bool ule8(uint8_t x, uint8_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule16(uint16_t x, uint16_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule32(uint32_t x, uint32_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule64(uint64_t x, uint64_t y)\n{\n    return x <= y;\n}\nstatic inline bool slt8(int8_t x, int8_t y)\n{\n    return x < y;\n}\nstatic inline bool slt16(int16_t x, int16_t y)\n{\n    return x < y;\n}\nstatic inline bool slt32(int32_t x, int32_t y)\n{\n    return x < y;\n}\nstatic inline bool slt64(int64_t x, int64_t y)\n{\n    return x < y;\n}\nstatic inline bool sle8(int8_t x, int8_t y)\n{\n    return x <= y;\n}\nstatic inline bool sle16(int16_t x, int16_t y)\n{\n    return x <= y;\n}\nstatic inline bool sle32(int32_t x, int32_",
                   "t y)\n{\n    return x <= y;\n}\nstatic inline bool sle64(int64_t x, int64_t y)\n{\n    return x <= y;\n}\nstatic inline int8_t pow8(int8_t x, int8_t y)\n{\n    int8_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int16_t pow16(int16_t x, int16_t y)\n{\n    int16_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int32_t pow32(int32_t x, int32_t y)\n{\n    int32_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int64_t pow64(int64_t x, int64_t y)\n{\n    int64_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline bool itob_i8_bool(int8_t x)\n{\n    return x;\n}\nstatic inline bool itob_i16_bool(int16_t x)\n{\n    return x;\n}\nstatic inline bool itob_i32_bool(int32_t x)\n{\n    return x;\n}\nstatic inline bool itob_i64_bool(int64_t x)\n{\n    return x;\n}\nstatic inline int8_t btoi_bool_i8(bool x)\n{\n    return x;\n}\nstatic inline int16_t btoi_bool_i16(bool x)\n{\n    return x;\n}\nstatic inline int32_t btoi_bool_i32(bool x)\n{\n    return x;\n}\nstatic inline int64_t btoi_bool_i64(bool x)\n{\n    return x;\n}\n#define sext_i8_i8(x) ((int8_t) (int8_t) x)\n#define sext_i8_i16(x) ((int16_t) (int8_t) x)\n#define sext_i8_i32(x) ((int32_t) (int8_t) x)\n#define sext_i8_i64(x) ((int64_t) (int8_t) x)\n#define sext_i16_i8(x) ((int8_t) (int16_t) x)\n#define sext_i16_i16(x) ((int16_t) (int16_t) x)\n#define sext_i16_i32(x) ((int32_t) (int16_t) x)\n#define sext_i16_i64(x) ((int64_t) (int16_t) x)\n#define sext_i32_i8(x) ((int8_t) (int32_t) x)\n#define sext_i32_i16(x) ((int16_t) (int32_t) x)\n#define sext_i32_i32(x) ((int32_t) (int32_t) x)\n#define sext_i32_i64(x) ((int64_t) (int32_t) x)\n#defi",
                   "ne sext_i64_i8(x) ((int8_t) (int64_t) x)\n#define sext_i64_i16(x) ((int16_t) (int64_t) x)\n#define sext_i64_i32(x) ((int32_t) (int64_t) x)\n#define sext_i64_i64(x) ((int64_t) (int64_t) x)\n#define zext_i8_i8(x) ((int8_t) (uint8_t) x)\n#define zext_i8_i16(x) ((int16_t) (uint8_t) x)\n#define zext_i8_i32(x) ((int32_t) (uint8_t) x)\n#define zext_i8_i64(x) ((int64_t) (uint8_t) x)\n#define zext_i16_i8(x) ((int8_t) (uint16_t) x)\n#define zext_i16_i16(x) ((int16_t) (uint16_t) x)\n#define zext_i16_i32(x) ((int32_t) (uint16_t) x)\n#define zext_i16_i64(x) ((int64_t) (uint16_t) x)\n#define zext_i32_i8(x) ((int8_t) (uint32_t) x)\n#define zext_i32_i16(x) ((int16_t) (uint32_t) x)\n#define zext_i32_i32(x) ((int32_t) (uint32_t) x)\n#define zext_i32_i64(x) ((int64_t) (uint32_t) x)\n#define zext_i64_i8(x) ((int8_t) (uint64_t) x)\n#define zext_i64_i16(x) ((int16_t) (uint64_t) x)\n#define zext_i64_i32(x) ((int32_t) (uint64_t) x)\n#define zext_i64_i64(x) ((int64_t) (uint64_t) x)\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_popc8(int8_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    return popcount(x);\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_popc8(int8_t x)\n{\n    return __popc(zext_i8_i32(x));\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    return __popc(zext_i16_i32(x));\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    return __popc(x);\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    return __popcll(x);\n}\n#else\nstatic int32_t futrts_popc8(int8_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    int c = 0;\n    \n    for ",
                   "(; x; ++c)\n        x &= x - 1;\n    return c;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    return mul_hi(a, b);\n}\n#elif defined(__CUDA_ARCH__)\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    uint16_t aa = a;\n    uint16_t bb = b;\n    \n    return aa * bb >> 8;\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    uint32_t aa = a;\n    uint32_t bb = b;\n    \n    return aa * bb >> 16;\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    return mulhi(a, b);\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    return mul64hi(a, b);\n}\n#else\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    uint16_t aa = a;\n    uint16_t bb = b;\n    \n    return aa * bb >> 8;\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    uint32_t aa = a;\n    uint32_t bb = b;\n    \n    return aa * bb >> 16;\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    uint64_t aa = a;\n    uint64_t bb = b;\n    \n    return aa * bb >> 32;\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    __uint128_t aa = a;\n    __uint128_t bb = b;\n    \n    return aa * bb >> 64;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)\n{\n    return mad_hi(a, b, c);\n}\n#else\nstatic uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)\n{\n    return futrts_mul_hi8(a, b) + c;\n}\nstatic uint16_t futrts_mad_hi16(uin",
                   "t16_t a, uint16_t b, uint16_t c)\n{\n    return futrts_mul_hi16(a, b) + c;\n}\nstatic uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)\n{\n    return futrts_mul_hi32(a, b) + c;\n}\nstatic uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)\n{\n    return futrts_mul_hi64(a, b) + c;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    return clz(x);\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    return __clz(zext_i8_i32(x)) - 24;\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    return __clz(zext_i16_i32(x)) - 16;\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    return __clz(x);\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    return __clzll(x);\n}\n#else\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    int i = 0;\n    \n    for (; i < 8 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz16(int16_t ",
                   "x)\n{\n    int i = 0;\n    \n    for (; i < 16 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    int i = 0;\n    \n    for (; i < 32 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    int i = 0;\n    \n    for (; i < 64 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 8 : y - 1;\n}\nstatic int32_t futrts_ctzz16(int16_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 16 : y - 1;\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 32 : y - 1;\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    int y = __ffsll(x);\n    \n    return y == 0 ? 64 : y - 1;\n}\n#else\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    return x == 0 ? 8 : __builtin_ctz((uint32_t) x);\n}\nstatic int32_t futrts_ctzz16(int16_t x)\n{\n    return x == 0 ? 16 : __builtin_ctz((uint32_t) x);\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    return x == 0 ? 32 : __builtin_ctz(x);\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    return x == 0 ? 64 : __builtin_ctzl(x);\n}\n#endif\nstatic inline float fdiv32(float x, float y)\n{\n    return x / y;\n}\nstatic inline float fadd32(float x, float y)\n{\n    return x + y;\n}\nstatic inline float fsub32(float x, float y)\n{\n    return x - y;\n}\nstatic inline float fmul32(float x, float y)\n{\n    return x * y;\n}\nstatic inline float fmin32(float x, float y)\n{\n    return fmin(x, y);\n}\nstatic inline float fmax32(float x, float y)\n{\n    return fmax(x, y);\n}\nstatic inline float fpow32(float x, float y)\n{\n    return pow(x, y);\n}\nstatic inline bool cmplt32(float x, float y)\n{\n    return x < y;\n}\nstatic inline bool cmple32(float x, float y)\n{\n    return x <= y;\n}\nstatic inline float sitofp_i8_f32(int8_t x)\n{\n    return (float) x;\n}\nstatic inline float sitofp_i16_f32(int16_t x)\n{\n    return (float) x;\n}\nstatic inline float sitofp_i32_f32(int32_t x)",
                   "\n{\n    return (float) x;\n}\nstatic inline float sitofp_i64_f32(int64_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i8_f32(uint8_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i16_f32(uint16_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i32_f32(uint32_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i64_f32(uint64_t x)\n{\n    return (float) x;\n}\nstatic inline int8_t fptosi_f32_i8(float x)\n{\n    return (int8_t) x;\n}\nstatic inline int16_t fptosi_f32_i16(float x)\n{\n    return (int16_t) x;\n}\nstatic inline int32_t fptosi_f32_i32(float x)\n{\n    return (int32_t) x;\n}\nstatic inline int64_t fptosi_f32_i64(float x)\n{\n    return (int64_t) x;\n}\nstatic inline uint8_t fptoui_f32_i8(float x)\n{\n    return (uint8_t) x;\n}\nstatic inline uint16_t fptoui_f32_i16(float x)\n{\n    return (uint16_t) x;\n}\nstatic inline uint32_t fptoui_f32_i32(float x)\n{\n    return (uint32_t) x;\n}\nstatic inline uint64_t fptoui_f32_i64(float x)\n{\n    return (uint64_t) x;\n}\nstatic inline float futrts_log32(float x)\n{\n    return log(x);\n}\nstatic inline float futrts_log2_32(float x)\n{\n    return log2(x);\n}\nstatic inline float futrts_log10_32(float x)\n{\n    return log10(x);\n}\nstatic inline float futrts_sqrt32(float x)\n{\n    return sqrt(x);\n}\nstatic inline float futrts_exp32(float x)\n{\n    return exp(x);\n}\nstatic inline float futrts_cos32(float x)\n{\n    return cos(x);\n}\nstatic inline float futrts_sin32(float x)\n{\n    return sin(x);\n}\nstatic inline float futrts_tan32(float x)\n{\n    return tan(x);\n}\nstatic inline float futrts_acos32(float x)\n{\n    return acos(x);\n}\nstatic inline float futrts_asin32(float x)\n{\n    return asin(x);\n}\nstatic inline float futrts_atan32(float x)\n{\n    return atan(x);\n}\nstatic inline float futrts_cosh32(float x)\n{\n    return cosh(x);\n}\nstatic inline float futrts_sinh32(float x)\n{\n    return sinh(x);\n}\nstatic inline float futrts_tanh32(float x)\n{\n    return tanh(x);\n}\nstatic inline float futrts_acosh32(float x)\n{\n    return acosh(x);\n}\nstatic inline fl",
                   "oat futrts_asinh32(float x)\n{\n    return asinh(x);\n}\nstatic inline float futrts_atanh32(float x)\n{\n    return atanh(x);\n}\nstatic inline float futrts_atan2_32(float x, float y)\n{\n    return atan2(x, y);\n}\nstatic inline float futrts_gamma32(float x)\n{\n    return tgamma(x);\n}\nstatic inline float futrts_lgamma32(float x)\n{\n    return lgamma(x);\n}\nstatic inline bool futrts_isnan32(float x)\n{\n    return isnan(x);\n}\nstatic inline bool futrts_isinf32(float x)\n{\n    return isinf(x);\n}\nstatic inline int32_t futrts_to_bits32(float x)\n{\n    union {\n        float f;\n        int32_t t;\n    } p;\n    \n    p.f = x;\n    return p.t;\n}\nstatic inline float futrts_from_bits32(int32_t x)\n{\n    union {\n        int32_t f;\n        float t;\n    } p;\n    \n    p.f = x;\n    return p.t;\n}\n#ifdef __OPENCL_VERSION__\nstatic inline float fmod32(float x, float y)\n{\n    return fmod(x, y);\n}\nstatic inline float futrts_round32(float x)\n{\n    return rint(x);\n}\nstatic inline float futrts_floor32(float x)\n{\n    return floor(x);\n}\nstatic inline float futrts_ceil32(float x)\n{\n    return ceil(x);\n}\nstatic inline float futrts_lerp32(float v0, float v1, float t)\n{\n    return mix(v0, v1, t);\n}\nstatic inline float futrts_mad32(float a, float b, float c)\n{\n    return mad(a, b, c);\n}\nstatic inline float futrts_fma32(float a, float b, float c)\n{\n    return fma(a, b, c);\n}\n#else\nstatic inline float fmod32(float x, float y)\n{\n    return fmodf(x, y);\n}\nstatic inline float futrts_round32(float x)\n{\n    return rintf(x);\n}\nstatic inline float futrts_floor32(float x)\n{\n    return floorf(x);\n}\nstatic inline float futrts_ceil32(float x)\n{\n    return ceilf(x);\n}\nstatic inline float futrts_lerp32(float v0, float v1, float t)\n{\n    return v0 + (v1 - v0) * t;\n}\nstatic inline float futrts_mad32(float a, float b, float c)\n{\n    return a * b + c;\n}\nstatic inline float futrts_fma32(float a, float b, float c)\n{\n    return fmaf(a, b, c);\n}\n#endif\n// Start of atomics.h\n\ninline int32_t atomic_add_i32_global(volatile __global int32_t *p, ",
                   "int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((int32_t*)p, x);\n#else\n  return atomic_add(p, x);\n#endif\n}\n\ninline int32_t atomic_add_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((int32_t*)p, x);\n#else\n  return atomic_add(p, x);\n#endif\n}\n\ninline float atomic_fadd_f32_global(volatile __global float *p, float x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((float*)p, x);\n#else\n  union { int32_t i; float f; } old;\n  union { int32_t i; float f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg((volatile __global int32_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\ninline float atomic_fadd_f32_local(volatile __local float *p, float x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((float*)p, x);\n#else\n  union { int32_t i; float f; } old;\n  union { int32_t i; float f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg((volatile __local int32_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\ninline int32_t atomic_smax_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline int32_t atomic_smax_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline int32_t atomic_smin_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline int32_t atomic_smin_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline uint32_t atomic_umax_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p",
                   ", x);\n#endif\n}\n\ninline uint32_t atomic_umax_i32_local(volatile __local uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline uint32_t atomic_umin_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline uint32_t atomic_umin_i32_local(volatile __local uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline int32_t atomic_and_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\ninline int32_t atomic_and_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\ninline int32_t atomic_or_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\ninline int32_t atomic_or_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\ninline int32_t atomic_xor_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xor_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xchg_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xchg_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t",
                   " atomic_cmpxchg_i32_global(volatile __global int32_t *p,\n                                         int32_t cmp, int32_t val) {\n#ifdef FUTHARK_CUDA\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\ninline int32_t atomic_cmpxchg_i32_local(volatile __local int32_t *p,\n                                         int32_t cmp, int32_t val) {\n#ifdef FUTHARK_CUDA\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\n// End of atomics.h\n\n\n\n\n__kernel void builtinzhreplicate_f32zireplicate_29470(__global\n                                                      unsigned char *mem_29466,\n                                                      int32_t num_elems_29467,\n                                                      float val_29468)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t replicate_gtid_29470;\n    int32_t replicate_ltid_29471;\n    int32_t replicate_gid_29472;\n    \n    replicate_gtid_29470 = get_global_id(0);\n    replicate_ltid_29471 = get_local_id(0);\n    replicate_gid_29472 = get_group_id(0);\n    if (slt64(replicate_gtid_29470, num_elems_29467)) {\n        ((__global float *) mem_29466)[sext_i32_i64(replicate_gtid_29470)] =\n            val_29468;\n    }\n    \n  error_0:\n    return;\n}\n__kernel void builtinzhreplicate_i64zireplicate_29062(__global\n                                                      unsigned char *mem_29058,\n                                                      int32_t num_elems_29059,\n                                                      int64_t val_29060)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t replicate_gtid_29062;\n    int32_t replicate_ltid_29063;\n    int32_t replicate_gid_29064;\n    \n    replicate_gtid_29062 = get_global_id(0);\n    replicate_ltid_29063 = get_local_id(0);\n    replicate_gid_29064 = get_group_id(0);\n    if (slt64(replicate_gtid_29062, nu",
                   "m_elems_29059)) {\n        ((__global int64_t *) mem_29058)[sext_i32_i64(replicate_gtid_29062)] =\n            val_29060;\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32(__local volatile\n                                    int64_t *block_9_backing_aligned_0,\n                                    int32_t destoffset_1, int32_t srcoffset_3,\n                                    int32_t num_arrays_4, int32_t x_elems_5,\n                                    int32_t y_elems_6, int32_t mulx_7,\n                                    int32_t muly_8, __global\n                                    unsigned char *destmem_0, __global\n                                    unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_global_id_0_37;\n    int32_t y_index_32 = get_group_id_1_41 * 32 + get_local_id_1_39;\n    \n    if (slt32(x_index_31, x_elems_5)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32",
                   "_t index_in_35 = (y_index_32 + j_43 * 8) * x_elems_5 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, y_elems_6)) {\n                ((__local float *) block_9)[sext_i32_i64((get_local_id_1_39 +\n                                                          j_43 * 8) * 33 +\n                                            get_local_id_0_38)] = ((__global\n                                                                    float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                       index_in_35)];\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 32 + get_local_id_0_38;\n    y_index_32 = get_group_id_0_40 * 32 + get_local_id_1_39;\n    if (slt32(x_index_31, y_elems_6)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_out_36 = (y_index_32 + j_43 * 8) * y_elems_6 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, x_elems_5)) {\n                ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                               index_out_36)] = ((__local\n                                                                  float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                    33 +\n                                                                                    get_local_id_1_39 +\n                                                                                    j_43 *\n                                                                                    8)];\n            }\n        }\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_low_height(__local volatile\n                                               int64_t *block_9_backing_aligned_0,\n                                               int32_t destoffset_1,\n                   ",
                   "                            int32_t srcoffset_3,\n                                               int32_t num_arrays_4,\n                                               int32_t x_elems_5,\n                                               int32_t y_elems_6,\n                                               int32_t mulx_7, int32_t muly_8,\n                                               __global\n                                               unsigned char *destmem_0,\n                                               __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_0_38 +\n            srem32(get_local_id_1_39, mulx_7) * 16;\n    int32_t y_index_32 = get_group_id_1_41 * 16 + squot32(get_local_id_1_39,\n                                                          mulx_7);\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(",
                   "y_index_32, y_elems_6)) {\n        ((__local float *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                    get_local_id_0_38)] = ((__global\n                                                            float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                               index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 + squot32(get_local_id_0_38, mulx_7);\n    y_index_32 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_1_39 +\n        srem32(get_local_id_0_38, mulx_7) * 16;\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__local\n                                                          float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                            17 +\n                                                                            get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_low_width(__local volatile\n                                              int64_t *block_9_backing_aligned_0,\n                                              int32_t destoffset_1,\n                                              int32_t srcoffset_3,\n                                              int32_t num_arrays_4,\n                                              int32_t x_elems_5,\n                                              int32_t y_elems_6, int32_t mulx_7,\n                                              int32_t muly_8, __global\n                                              unsigned char *destmem_0, __global\n                                              unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    co",
                   "nst int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 + squot32(get_local_id_0_38,\n                                                          muly_8);\n    int32_t y_index_32 = get_group_id_1_41 * 16 * muly_8 + get_local_id_1_39 +\n            srem32(get_local_id_0_38, muly_8) * 16;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local float *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                    get_local_id_0_38)] = ((__global\n                                                            float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                               index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 * muly_8 + get_local_id_0_38 +\n        srem32(get_local_id_1_39, muly_8) * 16;\n    y_index_32 = get_group_id_0_40 * 16 + squot32(get_local_id_1_39, muly_8",
                   ");\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__local\n                                                          float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                            17 +\n                                                                            get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_small(__local volatile\n                                          int64_t *block_9_backing_aligned_0,\n                                          int32_t destoffset_1,\n                                          int32_t srcoffset_3,\n                                          int32_t num_arrays_4,\n                                          int32_t x_elems_5, int32_t y_elems_6,\n                                          int32_t mulx_7, int32_t muly_8,\n                                          __global unsigned char *destmem_0,\n                                          __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict block_9_backing_0 = (__local volatile\n                                                         char *) block_9_backing_aligned_0;\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    ",
                   "\n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = squot32(get_global_id_0_37, y_elems_6 *\n                                          x_elems_5) * (y_elems_6 * x_elems_5);\n    int32_t x_index_31 = squot32(srem32(get_global_id_0_37, y_elems_6 *\n                                        x_elems_5), y_elems_6);\n    int32_t y_index_32 = srem32(get_global_id_0_37, y_elems_6);\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    int32_t index_out_36 = x_index_31 * y_elems_6 + y_index_32;\n    \n    if (slt32(get_global_id_0_37, x_elems_5 * y_elems_6 * num_arrays_4)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__global\n                                                          float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                             index_in_35)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void mainziscan_stage1_27347(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_28986_backing_aligned_0,\n                                      int64_t n_25421, int64_t flat_dim_25598,\n                                      float res_25861, __global\n                                      unsigned char *res_mem_28754, __global\n                                      unsigned char *res_mem_28755, __global\n                                      unsigned char *mem_28795, __global\n                                      unsigned char *mem_28797,\n                                      int32_t num_threads_28980)\n{\n    #define segscan_group_sizze_27342 (mainzisegscan_group_sizze_27341)\n    \n    const int block_dim0 = 0;\n    const in",
                   "t block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_28986_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_28986_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28981;\n    int32_t local_tid_28982;\n    int64_t group_sizze_28985;\n    int32_t wave_sizze_28984;\n    int32_t group_tid_28983;\n    \n    global_tid_28981 = get_global_id(0);\n    local_tid_28982 = get_local_id(0);\n    group_sizze_28985 = get_local_size(0);\n    wave_sizze_28984 = LOCKSTEP_WIDTH;\n    group_tid_28983 = get_group_id(0);\n    \n    int32_t phys_tid_27347;\n    \n    phys_tid_27347 = global_tid_28981;\n    \n    __local char *scan_arr_mem_28986;\n    \n    scan_arr_mem_28986 = (__local char *) scan_arr_mem_28986_backing_0;\n    \n    int64_t x_25867;\n    int64_t x_25868;\n    \n    x_25867 = 0;\n    for (int64_t j_28988 = 0; j_28988 < sdiv_up64(flat_dim_25598,\n                                                  sext_i32_i64(num_threads_28980));\n         j_28988++) {\n        int64_t chunk_offset_28989 = segscan_group_sizze_27342 * j_28988 +\n                sext_i32_i64(group_tid_28983) * (segscan_group_sizze_27342 *\n                                                 sdiv_up64(flat_dim_25598,\n                                                           sext_i32_i64(num_threads_28980)));\n        int64_t flat_idx_28990 = chunk_offset_28989 +\n                sext_i32_i64(local_tid_28982);\n        int64_t gtid_27346 = flat_idx_28990;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_27346, flat_dim_25598)) {\n                int64_t binop_x_28668 = squot64(gtid_27346, n_25421);\n                int64_t binop_y_28669 = n_25421 * binop_x_28668;\n                int64_t new_index_28670 = gtid_27346 - binop_y_28669;\n                int64_t x_25870 = ((__global\n                                    int64_t *) res_mem_28754)[new_index_28670];\n          ",
                   "      float x_25871 = ((__global\n                                  float *) res_mem_28755)[new_index_28670];\n                float x_25872 = res_25861 / x_25871;\n                float ceil_arg_25873 = x_25872 - 1.0F;\n                float res_25874;\n                \n                res_25874 = futrts_ceil32(ceil_arg_25873);\n                \n                int64_t res_25875 = fptosi_f32_i64(res_25874);\n                int64_t max_arg_25876 = sub64(x_25870, res_25875);\n                int64_t res_25877 = smax64(0, max_arg_25876);\n                bool cond_25878 = res_25877 == 0;\n                int64_t res_25879;\n                \n                if (cond_25878) {\n                    res_25879 = 1;\n                } else {\n                    res_25879 = res_25877;\n                }\n                // write to-scan values to parameters\n                {\n                    x_25868 = res_25879;\n                }\n                // write mapped values results to global memory\n                {\n                    ((__global int64_t *) mem_28797)[gtid_27346] = res_25879;\n                }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_27346, flat_dim_25598)) {\n                    x_25868 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                int64_t res_25869 = add64(x_25867, x_25868);\n                \n                ((__local\n                  int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)] =\n                    res_25869;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int64_t x_28991;\n            int64_t x_28992;\n            int64_t x_28994;\n            int64_t x_28995;\n            bool ltid_in_bounds_28997;\n            \n            ltid_in_bounds_28997 = slt64(sext_i32_i64(local_tid_28982),\n   ",
                   "                                      segscan_group_sizze_27342);\n            \n            int32_t skip_threads_28998;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_28997) {\n                    x_28992 = ((volatile __local\n                                int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)];\n                    if ((local_tid_28982 - squot32(local_tid_28982, 32) * 32) ==\n                        0) {\n                        x_28991 = x_28992;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_28998 = 1;\n                while (slt32(skip_threads_28998, 32)) {\n                    if (sle32(skip_threads_28998, local_tid_28982 -\n                              squot32(local_tid_28982, 32) * 32) &&\n                        ltid_in_bounds_28997) {\n                        // read operands\n                        {\n                            x_28991 = ((volatile __local\n                                        int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982) -\n                                                                       sext_i32_i64(skip_threads_28998)];\n                        }\n                        // perform operation\n                        {\n                            int64_t res_28993 = add64(x_28991, x_28992);\n                            \n                            x_28991 = res_28993;\n                        }\n                    }\n                    if (sle32(wave_sizze_28984, skip_threads_28998)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_28998, local_tid_28982 -\n                              squot32(local_tid_28982, 32) * 32) &&\n                        ltid_in_bounds_28997) {\n                        // write result\n                        {\n                            ((volat",
                   "ile __local\n                              int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)] =\n                                x_28991;\n                            x_28992 = x_28991;\n                        }\n                    }\n                    if (sle32(wave_sizze_28984, skip_threads_28998)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_28998 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_28982 - squot32(local_tid_28982, 32) * 32) ==\n                    31 && ltid_in_bounds_28997) {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_28986)[sext_i32_i64(squot32(local_tid_28982,\n                                                                          32))] =\n                        x_28991;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_28999;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_28982, 32) == 0 &&\n                        ltid_in_bounds_28997) {\n                        x_28995 = ((volatile __local\n                                    int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)];\n                        if ((local_tid_28982 - squot32(local_tid_28982, 32) *\n                             32) == 0) {\n                            x_28994 = x_28995;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_28999 = 1;\n                    while (slt32(skip_threads_28999, 32)) {\n                        if (sle32(skip_threads",
                   "_28999, local_tid_28982 -\n                                  squot32(local_tid_28982, 32) * 32) &&\n                            (squot32(local_tid_28982, 32) == 0 &&\n                             ltid_in_bounds_28997)) {\n                            // read operands\n                            {\n                                x_28994 = ((volatile __local\n                                            int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982) -\n                                                                           sext_i32_i64(skip_threads_28999)];\n                            }\n                            // perform operation\n                            {\n                                int64_t res_28996 = add64(x_28994, x_28995);\n                                \n                                x_28994 = res_28996;\n                            }\n                        }\n                        if (sle32(wave_sizze_28984, skip_threads_28999)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_28999, local_tid_28982 -\n                                  squot32(local_tid_28982, 32) * 32) &&\n                            (squot32(local_tid_28982, 32) == 0 &&\n                             ltid_in_bounds_28997)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)] =\n                                    x_28994;\n                                x_28995 = x_28994;\n                            }\n                        }\n                        if (sle32(wave_sizze_28984, skip_threads_28999)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_28999 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);",
                   "\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_28982, 32) == 0 ||\n                      !ltid_in_bounds_28997)) {\n                    // read operands\n                    {\n                        x_28992 = x_28991;\n                        x_28991 = ((__local\n                                    int64_t *) scan_arr_mem_28986)[sext_i32_i64(squot32(local_tid_28982,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_28993 = add64(x_28991, x_28992);\n                        \n                        x_28991 = res_28993;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)] =\n                            x_28991;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_28982, 32) == 0) {\n                    ((__local\n                      int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)] =\n                        x_28992;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_27346, flat_dim_25598)) {\n                    ((__global int64_t *) mem_28795)[gtid_27346] = ((__local\n                                                                     int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteratio",
                   "n\n            {\n                bool crosses_segment_29000 = 0;\n                bool should_load_carry_29001 = local_tid_28982 == 0 &&\n                     !crosses_segment_29000;\n                \n                if (should_load_carry_29001) {\n                    x_25867 = ((__local\n                                int64_t *) scan_arr_mem_28986)[segscan_group_sizze_27342 -\n                                                               1];\n                }\n                if (!should_load_carry_29001) {\n                    x_25867 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_27342\n}\n__kernel void mainziscan_stage1_27380(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29225_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29223_backing_aligned_1,\n                                      int64_t res_25881, __global\n                                      unsigned char *mem_28802, __global\n                                      unsigned char *mem_28806, __global\n                                      unsigned char *mem_28808,\n                                      int32_t num_threads_29217)\n{\n    #define segscan_group_sizze_27375 (mainzisegscan_group_sizze_27374)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29225_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_29225_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29223_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29223_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_t",
                   "id_29218;\n    int32_t local_tid_29219;\n    int64_t group_sizze_29222;\n    int32_t wave_sizze_29221;\n    int32_t group_tid_29220;\n    \n    global_tid_29218 = get_global_id(0);\n    local_tid_29219 = get_local_id(0);\n    group_sizze_29222 = get_local_size(0);\n    wave_sizze_29221 = LOCKSTEP_WIDTH;\n    group_tid_29220 = get_group_id(0);\n    \n    int32_t phys_tid_27380;\n    \n    phys_tid_27380 = global_tid_29218;\n    \n    __local char *scan_arr_mem_29223;\n    __local char *scan_arr_mem_29225;\n    \n    scan_arr_mem_29223 = (__local char *) scan_arr_mem_29223_backing_0;\n    scan_arr_mem_29225 = (__local char *) scan_arr_mem_29225_backing_1;\n    \n    bool x_25900;\n    int64_t x_25901;\n    bool x_25902;\n    int64_t x_25903;\n    \n    x_25900 = 0;\n    x_25901 = 0;\n    for (int64_t j_29227 = 0; j_29227 < sdiv_up64(res_25881,\n                                                  sext_i32_i64(num_threads_29217));\n         j_29227++) {\n        int64_t chunk_offset_29228 = segscan_group_sizze_27375 * j_29227 +\n                sext_i32_i64(group_tid_29220) * (segscan_group_sizze_27375 *\n                                                 sdiv_up64(res_25881,\n                                                           sext_i32_i64(num_threads_29217)));\n        int64_t flat_idx_29229 = chunk_offset_29228 +\n                sext_i32_i64(local_tid_29219);\n        int64_t gtid_27379 = flat_idx_29229;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_27379, res_25881)) {\n                int64_t x_25907 = ((__global int64_t *) mem_28802)[gtid_27379];\n                bool res_25908 = slt64(0, x_25907);\n                \n                // write to-scan values to parameters\n                {\n                    x_25902 = res_25908;\n                    x_25903 = x_25907;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // may",
                   "be restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_27379, res_25881)) {\n                    x_25902 = 0;\n                    x_25903 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                bool res_25904 = x_25900 || x_25902;\n                int64_t res_25905;\n                \n                if (x_25902) {\n                    res_25905 = x_25903;\n                } else {\n                    int64_t res_25906 = add64(x_25901, x_25903);\n                    \n                    res_25905 = res_25906;\n                }\n                ((__local\n                  bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)] =\n                    res_25904;\n                ((__local\n                  int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)] =\n                    res_25905;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_29230;\n            int64_t x_29231;\n            bool x_29232;\n            int64_t x_29233;\n            bool x_29237;\n            int64_t x_29238;\n            bool x_29239;\n            int64_t x_29240;\n            bool ltid_in_bounds_29244;\n            \n            ltid_in_bounds_29244 = slt64(sext_i32_i64(local_tid_29219),\n                                         segscan_group_sizze_27375);\n            \n            int32_t skip_threads_29245;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_29244) {\n                    x_29232 = ((volatile __local\n                                bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)];\n                    x_29233 = ((volatile __local\n                                int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)];\n                    if ((local_tid_29219 - squot32(local_tid_29219, 32) * 32) ==\n                        0) {\n                        x_2923",
                   "0 = x_29232;\n                        x_29231 = x_29233;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_29245 = 1;\n                while (slt32(skip_threads_29245, 32)) {\n                    if (sle32(skip_threads_29245, local_tid_29219 -\n                              squot32(local_tid_29219, 32) * 32) &&\n                        ltid_in_bounds_29244) {\n                        // read operands\n                        {\n                            x_29230 = ((volatile __local\n                                        bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219) -\n                                                                    sext_i32_i64(skip_threads_29245)];\n                            x_29231 = ((volatile __local\n                                        int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219) -\n                                                                       sext_i32_i64(skip_threads_29245)];\n                        }\n                        // perform operation\n                        {\n                            bool res_29234 = x_29230 || x_29232;\n                            int64_t res_29235;\n                            \n                            if (x_29232) {\n                                res_29235 = x_29233;\n                            } else {\n                                int64_t res_29236 = add64(x_29231, x_29233);\n                                \n                                res_29235 = res_29236;\n                            }\n                            x_29230 = res_29234;\n                            x_29231 = res_29235;\n                        }\n                    }\n                    if (sle32(wave_sizze_29221, skip_threads_29245)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_29245, local_tid_29219 -\n                ",
                   "              squot32(local_tid_29219, 32) * 32) &&\n                        ltid_in_bounds_29244) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)] =\n                                x_29230;\n                            x_29232 = x_29230;\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)] =\n                                x_29231;\n                            x_29233 = x_29231;\n                        }\n                    }\n                    if (sle32(wave_sizze_29221, skip_threads_29245)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_29245 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_29219 - squot32(local_tid_29219, 32) * 32) ==\n                    31 && ltid_in_bounds_29244) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29223)[sext_i32_i64(squot32(local_tid_29219,\n                                                                       32))] =\n                        x_29230;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29225)[sext_i32_i64(squot32(local_tid_29219,\n                                                                          32))] =\n                        x_29231;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_29246;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_29219, 32) == 0 &",
                   "&\n                        ltid_in_bounds_29244) {\n                        x_29239 = ((volatile __local\n                                    bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)];\n                        x_29240 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)];\n                        if ((local_tid_29219 - squot32(local_tid_29219, 32) *\n                             32) == 0) {\n                            x_29237 = x_29239;\n                            x_29238 = x_29240;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29246 = 1;\n                    while (slt32(skip_threads_29246, 32)) {\n                        if (sle32(skip_threads_29246, local_tid_29219 -\n                                  squot32(local_tid_29219, 32) * 32) &&\n                            (squot32(local_tid_29219, 32) == 0 &&\n                             ltid_in_bounds_29244)) {\n                            // read operands\n                            {\n                                x_29237 = ((volatile __local\n                                            bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219) -\n                                                                        sext_i32_i64(skip_threads_29246)];\n                                x_29238 = ((volatile __local\n                                            int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219) -\n                                                                           sext_i32_i64(skip_threads_29246)];\n                            }\n                            // perform operation\n                            {\n                                bool res_29241 = x_29237 || x_29239;\n                                int64_t res_29242;\n                                \n                                i",
                   "f (x_29239) {\n                                    res_29242 = x_29240;\n                                } else {\n                                    int64_t res_29243 = add64(x_29238, x_29240);\n                                    \n                                    res_29242 = res_29243;\n                                }\n                                x_29237 = res_29241;\n                                x_29238 = res_29242;\n                            }\n                        }\n                        if (sle32(wave_sizze_29221, skip_threads_29246)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29246, local_tid_29219 -\n                                  squot32(local_tid_29219, 32) * 32) &&\n                            (squot32(local_tid_29219, 32) == 0 &&\n                             ltid_in_bounds_29244)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)] =\n                                    x_29237;\n                                x_29239 = x_29237;\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)] =\n                                    x_29238;\n                                x_29240 = x_29238;\n                            }\n                        }\n                        if (sle32(wave_sizze_29221, skip_threads_29246)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29246 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_29219, 32) == 0 ||\n                      !ltid_in_bounds_292",
                   "44)) {\n                    // read operands\n                    {\n                        x_29232 = x_29230;\n                        x_29233 = x_29231;\n                        x_29230 = ((__local\n                                    bool *) scan_arr_mem_29223)[sext_i32_i64(squot32(local_tid_29219,\n                                                                                     32)) -\n                                                                1];\n                        x_29231 = ((__local\n                                    int64_t *) scan_arr_mem_29225)[sext_i32_i64(squot32(local_tid_29219,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        bool res_29234 = x_29230 || x_29232;\n                        int64_t res_29235;\n                        \n                        if (x_29232) {\n                            res_29235 = x_29233;\n                        } else {\n                            int64_t res_29236 = add64(x_29231, x_29233);\n                            \n                            res_29235 = res_29236;\n                        }\n                        x_29230 = res_29234;\n                        x_29231 = res_29235;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)] =\n                            x_29230;\n                        ((__local\n                          int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)] =\n                            x_29231;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_29219, 32) == 0)",
                   " {\n                    ((__local\n                      bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)] =\n                        x_29232;\n                    ((__local\n                      int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)] =\n                        x_29233;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_27379, res_25881)) {\n                    ((__global bool *) mem_28806)[gtid_27379] = ((__local\n                                                                  bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)];\n                    ((__global int64_t *) mem_28808)[gtid_27379] = ((__local\n                                                                     int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_29247 = 0;\n                bool should_load_carry_29248 = local_tid_29219 == 0 &&\n                     !crosses_segment_29247;\n                \n                if (should_load_carry_29248) {\n                    x_25900 = ((__local\n                                bool *) scan_arr_mem_29223)[segscan_group_sizze_27375 -\n                                                            1];\n                    x_25901 = ((__local\n                                int64_t *) scan_arr_mem_29225)[segscan_group_sizze_27375 -\n                                                               1];\n                }\n                if (!should_load_carry_29248) {\n                    x_25900 = 0;\n                    x_25901 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_27375\n}\n__kernel void mainzis",
                   "can_stage1_27388(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29292_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29290_backing_aligned_1,\n                                      int64_t res_25881, __global\n                                      unsigned char *mem_28808, __global\n                                      unsigned char *mem_28811, __global\n                                      unsigned char *mem_28813, __global\n                                      unsigned char *mem_28815,\n                                      int32_t num_threads_29284)\n{\n    #define segscan_group_sizze_27383 (mainzisegscan_group_sizze_27382)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29292_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_29292_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29290_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29290_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29285;\n    int32_t local_tid_29286;\n    int64_t group_sizze_29289;\n    int32_t wave_sizze_29288;\n    int32_t group_tid_29287;\n    \n    global_tid_29285 = get_global_id(0);\n    local_tid_29286 = get_local_id(0);\n    group_sizze_29289 = get_local_size(0);\n    wave_sizze_29288 = LOCKSTEP_WIDTH;\n    group_tid_29287 = get_group_id(0);\n    \n    int32_t phys_tid_27388;\n    \n    phys_tid_27388 = global_tid_29285;\n    \n    __local char *scan_arr_mem_29290;\n    __local char *scan_arr_mem_29292;\n    \n    scan_arr_mem_29290 = (__local char *) scan_arr_mem_29290_backing_0;\n    scan_arr_mem_29292 = (__local char *) scan_arr_mem_29292_backing_1;\n    ",
                   "\n    bool x_25939;\n    int64_t x_25940;\n    bool x_25941;\n    int64_t x_25942;\n    \n    x_25939 = 0;\n    x_25940 = 0;\n    for (int64_t j_29294 = 0; j_29294 < sdiv_up64(res_25881,\n                                                  sext_i32_i64(num_threads_29284));\n         j_29294++) {\n        int64_t chunk_offset_29295 = segscan_group_sizze_27383 * j_29294 +\n                sext_i32_i64(group_tid_29287) * (segscan_group_sizze_27383 *\n                                                 sdiv_up64(res_25881,\n                                                           sext_i32_i64(num_threads_29284)));\n        int64_t flat_idx_29296 = chunk_offset_29295 +\n                sext_i32_i64(local_tid_29286);\n        int64_t gtid_27387 = flat_idx_29296;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_27387, res_25881)) {\n                int64_t x_25946 = ((__global int64_t *) mem_28808)[gtid_27387];\n                int64_t i_p_o_28679 = add64(-1, gtid_27387);\n                int64_t rot_i_28680 = smod64(i_p_o_28679, res_25881);\n                int64_t x_25947 = ((__global int64_t *) mem_28808)[rot_i_28680];\n                bool res_25949 = x_25946 == x_25947;\n                bool res_25950 = !res_25949;\n                \n                // write to-scan values to parameters\n                {\n                    x_25941 = res_25950;\n                    x_25942 = 1;\n                }\n                // write mapped values results to global memory\n                {\n                    ((__global bool *) mem_28815)[gtid_27387] = res_25950;\n                }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_27387, res_25881)) {\n                    x_25941 = 0;\n                    x_25942 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n  ",
                   "              bool res_25943 = x_25939 || x_25941;\n                int64_t res_25944;\n                \n                if (x_25941) {\n                    res_25944 = x_25942;\n                } else {\n                    int64_t res_25945 = add64(x_25940, x_25942);\n                    \n                    res_25944 = res_25945;\n                }\n                ((__local\n                  bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)] =\n                    res_25943;\n                ((__local\n                  int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)] =\n                    res_25944;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_29297;\n            int64_t x_29298;\n            bool x_29299;\n            int64_t x_29300;\n            bool x_29304;\n            int64_t x_29305;\n            bool x_29306;\n            int64_t x_29307;\n            bool ltid_in_bounds_29311;\n            \n            ltid_in_bounds_29311 = slt64(sext_i32_i64(local_tid_29286),\n                                         segscan_group_sizze_27383);\n            \n            int32_t skip_threads_29312;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_29311) {\n                    x_29299 = ((volatile __local\n                                bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)];\n                    x_29300 = ((volatile __local\n                                int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)];\n                    if ((local_tid_29286 - squot32(local_tid_29286, 32) * 32) ==\n                        0) {\n                        x_29297 = x_29299;\n                        x_29298 = x_29300;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_29312 = 1;\n                while (slt32(skip_threads_29312, 32)) {\n                    if ",
                   "(sle32(skip_threads_29312, local_tid_29286 -\n                              squot32(local_tid_29286, 32) * 32) &&\n                        ltid_in_bounds_29311) {\n                        // read operands\n                        {\n                            x_29297 = ((volatile __local\n                                        bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286) -\n                                                                    sext_i32_i64(skip_threads_29312)];\n                            x_29298 = ((volatile __local\n                                        int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286) -\n                                                                       sext_i32_i64(skip_threads_29312)];\n                        }\n                        // perform operation\n                        {\n                            bool res_29301 = x_29297 || x_29299;\n                            int64_t res_29302;\n                            \n                            if (x_29299) {\n                                res_29302 = x_29300;\n                            } else {\n                                int64_t res_29303 = add64(x_29298, x_29300);\n                                \n                                res_29302 = res_29303;\n                            }\n                            x_29297 = res_29301;\n                            x_29298 = res_29302;\n                        }\n                    }\n                    if (sle32(wave_sizze_29288, skip_threads_29312)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_29312, local_tid_29286 -\n                              squot32(local_tid_29286, 32) * 32) &&\n                        ltid_in_bounds_29311) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)] =",
                   "\n                                x_29297;\n                            x_29299 = x_29297;\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)] =\n                                x_29298;\n                            x_29300 = x_29298;\n                        }\n                    }\n                    if (sle32(wave_sizze_29288, skip_threads_29312)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_29312 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_29286 - squot32(local_tid_29286, 32) * 32) ==\n                    31 && ltid_in_bounds_29311) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29290)[sext_i32_i64(squot32(local_tid_29286,\n                                                                       32))] =\n                        x_29297;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29292)[sext_i32_i64(squot32(local_tid_29286,\n                                                                          32))] =\n                        x_29298;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_29313;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_29286, 32) == 0 &&\n                        ltid_in_bounds_29311) {\n                        x_29306 = ((volatile __local\n                                    bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)];\n                        x_29307 = ((volatile __local\n                                    int64_t *) scan",
                   "_arr_mem_29292)[sext_i32_i64(local_tid_29286)];\n                        if ((local_tid_29286 - squot32(local_tid_29286, 32) *\n                             32) == 0) {\n                            x_29304 = x_29306;\n                            x_29305 = x_29307;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29313 = 1;\n                    while (slt32(skip_threads_29313, 32)) {\n                        if (sle32(skip_threads_29313, local_tid_29286 -\n                                  squot32(local_tid_29286, 32) * 32) &&\n                            (squot32(local_tid_29286, 32) == 0 &&\n                             ltid_in_bounds_29311)) {\n                            // read operands\n                            {\n                                x_29304 = ((volatile __local\n                                            bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286) -\n                                                                        sext_i32_i64(skip_threads_29313)];\n                                x_29305 = ((volatile __local\n                                            int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286) -\n                                                                           sext_i32_i64(skip_threads_29313)];\n                            }\n                            // perform operation\n                            {\n                                bool res_29308 = x_29304 || x_29306;\n                                int64_t res_29309;\n                                \n                                if (x_29306) {\n                                    res_29309 = x_29307;\n                                } else {\n                                    int64_t res_29310 = add64(x_29305, x_29307);\n                                    \n                                    res_29309 = res_29310;\n              ",
                   "                  }\n                                x_29304 = res_29308;\n                                x_29305 = res_29309;\n                            }\n                        }\n                        if (sle32(wave_sizze_29288, skip_threads_29313)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29313, local_tid_29286 -\n                                  squot32(local_tid_29286, 32) * 32) &&\n                            (squot32(local_tid_29286, 32) == 0 &&\n                             ltid_in_bounds_29311)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)] =\n                                    x_29304;\n                                x_29306 = x_29304;\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)] =\n                                    x_29305;\n                                x_29307 = x_29305;\n                            }\n                        }\n                        if (sle32(wave_sizze_29288, skip_threads_29313)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29313 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_29286, 32) == 0 ||\n                      !ltid_in_bounds_29311)) {\n                    // read operands\n                    {\n                        x_29299 = x_29297;\n                        x_29300 = x_29298;\n                        x_29297 = ((__local\n                                    bool *) scan_arr_mem_29290)[sext_i32_i64(squot32(local_tid_29286,\n     ",
                   "                                                                                32)) -\n                                                                1];\n                        x_29298 = ((__local\n                                    int64_t *) scan_arr_mem_29292)[sext_i32_i64(squot32(local_tid_29286,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        bool res_29301 = x_29297 || x_29299;\n                        int64_t res_29302;\n                        \n                        if (x_29299) {\n                            res_29302 = x_29300;\n                        } else {\n                            int64_t res_29303 = add64(x_29298, x_29300);\n                            \n                            res_29302 = res_29303;\n                        }\n                        x_29297 = res_29301;\n                        x_29298 = res_29302;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)] =\n                            x_29297;\n                        ((__local\n                          int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)] =\n                            x_29298;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_29286, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)] =\n                        x_29299;\n                    ((__local\n                      int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)] =\n                        x_29300;\n     ",
                   "           }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_27387, res_25881)) {\n                    ((__global bool *) mem_28811)[gtid_27387] = ((__local\n                                                                  bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)];\n                    ((__global int64_t *) mem_28813)[gtid_27387] = ((__local\n                                                                     int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_29314 = 0;\n                bool should_load_carry_29315 = local_tid_29286 == 0 &&\n                     !crosses_segment_29314;\n                \n                if (should_load_carry_29315) {\n                    x_25939 = ((__local\n                                bool *) scan_arr_mem_29290)[segscan_group_sizze_27383 -\n                                                            1];\n                    x_25940 = ((__local\n                                int64_t *) scan_arr_mem_29292)[segscan_group_sizze_27383 -\n                                                               1];\n                }\n                if (!should_load_carry_29315) {\n                    x_25939 = 0;\n                    x_25940 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_27383\n}\n__kernel void mainziscan_stage1_27396(__global int *global_failure,\n                                      int failure_is_an_option, __global\n                                      int64_t *global_failure_args,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_",
                   "29359_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29357_backing_aligned_1,\n                                      int64_t n_25421, int64_t paths_25424,\n                                      float a_25429, float b_25430,\n                                      float sigma_25431, int64_t flat_dim_25598,\n                                      float res_25861, int64_t res_25881,\n                                      int64_t i_27272, __global\n                                      unsigned char *res_mem_28752, __global\n                                      unsigned char *res_mem_28753, __global\n                                      unsigned char *res_mem_28754, __global\n                                      unsigned char *res_mem_28755, __global\n                                      unsigned char *mem_28783, __global\n                                      unsigned char *mem_28808, __global\n                                      unsigned char *mem_28813, __global\n                                      unsigned char *mem_28815, __global\n                                      unsigned char *mem_28818, __global\n                                      unsigned char *mem_28820,\n                                      int32_t num_threads_29351)\n{\n    #define segscan_group_sizze_27391 (mainzisegscan_group_sizze_27390)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29359_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_29359_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29357_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29357_backing_aligned_1;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n   ",
                   "     if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_29352;\n    int32_t local_tid_29353;\n    int64_t group_sizze_29356;\n    int32_t wave_sizze_29355;\n    int32_t group_tid_29354;\n    \n    global_tid_29352 = get_global_id(0);\n    local_tid_29353 = get_local_id(0);\n    group_sizze_29356 = get_local_size(0);\n    wave_sizze_29355 = LOCKSTEP_WIDTH;\n    group_tid_29354 = get_group_id(0);\n    \n    int32_t phys_tid_27396;\n    \n    phys_tid_27396 = global_tid_29352;\n    \n    __local char *scan_arr_mem_29357;\n    __local char *scan_arr_mem_29359;\n    \n    scan_arr_mem_29357 = (__local char *) scan_arr_mem_29357_backing_0;\n    scan_arr_mem_29359 = (__local char *) scan_arr_mem_29359_backing_1;\n    \n    bool x_25965;\n    float x_25966;\n    bool x_25967;\n    float x_25968;\n    \n    x_25965 = 0;\n    x_25966 = 0.0F;\n    for (int64_t j_29361 = 0; j_29361 < sdiv_up64(res_25881,\n                                                  sext_i32_i64(num_threads_29351));\n         j_29361++) {\n        int64_t chunk_offset_29362 = segscan_group_sizze_27391 * j_29361 +\n                sext_i32_i64(group_tid_29354) * (segscan_group_sizze_27391 *\n                                                 sdiv_up64(res_25881,\n                                                           sext_i32_i64(num_threads_29351)));\n        int64_t flat_idx_29363 = chunk_offset_29362 +\n                sext_i32_i64(local_tid_29353);\n        int64_t gtid_27395 = flat_idx_29363;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_27395, res_25881)) {\n                int64_t x_25973 = ((__global int64_t *) mem_28813)[gtid_27395];\n                int64_t x_25974 = ((__global int64_t *) mem_28808)[gtid_27395];\n                bool x_25975 = ((__global bool *) mem_28815)[gtid_27395];\n                int64_t res_25978 = sub64(x_25973, 1);\n                bool x_25979 = sle64(0, x_25974);\n                bool y_25980 = sl",
                   "t64(x_25974, flat_dim_25598);\n                bool bounds_check_25981 = x_25979 && y_25980;\n                bool index_certs_25982;\n                \n                if (!bounds_check_25981) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 6) ==\n                            -1) {\n                            global_failure_args[0] = x_25974;\n                            global_failure_args[1] = flat_dim_25598;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int64_t new_index_25983 = squot64(x_25974, n_25421);\n                int64_t binop_y_25984 = n_25421 * new_index_25983;\n                int64_t new_index_25985 = x_25974 - binop_y_25984;\n                int64_t lifted_0_get_arg_25989 = ((__global\n                                                   int64_t *) res_mem_28754)[new_index_25985];\n                float lifted_0_get_arg_25990 = ((__global\n                                                 float *) res_mem_28755)[new_index_25985];\n                float x_25991 = res_25861 / lifted_0_get_arg_25990;\n                float ceil_arg_25992 = x_25991 - 1.0F;\n                float res_25993;\n                \n                res_25993 = futrts_ceil32(ceil_arg_25992);\n                \n                int64_t res_25994 = fptosi_f32_i64(res_25993);\n                int64_t max_arg_25995 = sub64(lifted_0_get_arg_25989,\n                                              res_25994);\n                int64_t res_25996 = smax64(0, max_arg_25995);\n                bool cond_25997 = res_25996 == 0;\n                float res_25998;\n                \n                if (cond_25997) {\n                    res_25998 = 0.0F;\n                } else {\n                    float lifted_0_get_arg_25986 = ((__global\n                                                     float *) mem_28783)[i_2",
                   "7272 *\n                                                                         paths_25424 +\n                                                                         new_index_25983];\n                    float lifted_0_get_arg_25987 = ((__global\n                                                     float *) res_mem_28752)[new_index_25985];\n                    float lifted_0_get_arg_25988 = ((__global\n                                                     float *) res_mem_28753)[new_index_25985];\n                    float res_25999;\n                    \n                    res_25999 = futrts_ceil32(x_25991);\n                    \n                    float start_26000 = lifted_0_get_arg_25990 * res_25999;\n                    float res_26001;\n                    \n                    res_26001 = futrts_ceil32(ceil_arg_25992);\n                    \n                    int64_t res_26002 = fptosi_f32_i64(res_26001);\n                    int64_t max_arg_26003 = sub64(lifted_0_get_arg_25989,\n                                                  res_26002);\n                    int64_t res_26004 = smax64(0, max_arg_26003);\n                    int64_t sizze_26005 = sub64(res_26004, 1);\n                    bool cond_26006 = res_25978 == 0;\n                    float res_26007;\n                    \n                    if (cond_26006) {\n                        res_26007 = 1.0F;\n                    } else {\n                        res_26007 = 0.0F;\n                    }\n                    \n                    bool cond_26008 = slt64(0, res_25978);\n                    float res_26009;\n                    \n                    if (cond_26008) {\n                        float y_26010 = lifted_0_get_arg_25987 *\n                              lifted_0_get_arg_25990;\n                        float res_26011 = res_26007 - y_26010;\n                        \n                        res_26009 = res_26011;\n                    } else {\n                        res_26009 = res_26007;\n                    }\n   ",
                   "                 \n                    bool cond_26012 = res_25978 == sizze_26005;\n                    float res_26013;\n                    \n                    if (cond_26012) {\n                        float res_26014 = res_26009 - 1.0F;\n                        \n                        res_26013 = res_26014;\n                    } else {\n                        res_26013 = res_26009;\n                    }\n                    \n                    float res_26015 = lifted_0_get_arg_25988 * res_26013;\n                    float res_26016 = sitofp_i64_f32(res_25978);\n                    float y_26017 = lifted_0_get_arg_25990 * res_26016;\n                    float bondprice_arg_26018 = start_26000 + y_26017;\n                    float y_26019 = bondprice_arg_26018 - res_25861;\n                    float negate_arg_26020 = a_25429 * y_26019;\n                    float exp_arg_26021 = 0.0F - negate_arg_26020;\n                    float res_26022 = fpow32(2.7182817F, exp_arg_26021);\n                    float x_26023 = 1.0F - res_26022;\n                    float B_26024 = x_26023 / a_25429;\n                    float x_26025 = B_26024 - bondprice_arg_26018;\n                    float x_26026 = res_25861 + x_26025;\n                    float x_26027 = fpow32(a_25429, 2.0F);\n                    float x_26028 = b_25430 * x_26027;\n                    float x_26029 = fpow32(sigma_25431, 2.0F);\n                    float y_26030 = x_26029 / 2.0F;\n                    float y_26031 = x_26028 - y_26030;\n                    float x_26032 = x_26026 * y_26031;\n                    float A1_26033 = x_26032 / x_26027;\n                    float y_26034 = fpow32(B_26024, 2.0F);\n                    float x_26035 = x_26029 * y_26034;\n                    float y_26036 = 4.0F * a_25429;\n                    float A2_26037 = x_26035 / y_26036;\n                    float exp_arg_26038 = A1_26033 - A2_26037;\n                    float res_26039 = fpow32(2.7182817F, exp_arg_26038);\n                    float nega",
                   "te_arg_26040 = lifted_0_get_arg_25986 * B_26024;\n                    float exp_arg_26041 = 0.0F - negate_arg_26040;\n                    float res_26042 = fpow32(2.7182817F, exp_arg_26041);\n                    float res_26043 = res_26039 * res_26042;\n                    float x_26044 = res_26015 * res_26043;\n                    float res_26045 = lifted_0_get_arg_25988 * x_26044;\n                    \n                    res_25998 = res_26045;\n                }\n                // write to-scan values to parameters\n                {\n                    x_25967 = x_25975;\n                    x_25968 = res_25998;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_27395, res_25881)) {\n                    x_25967 = 0;\n                    x_25968 = 0.0F;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                bool res_25969 = x_25965 || x_25967;\n                float res_25970;\n                \n                if (x_25967) {\n                    res_25970 = x_25968;\n                } else {\n                    float res_25971 = x_25966 + x_25968;\n                    \n                    res_25970 = res_25971;\n                }\n                ((__local\n                  bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)] =\n                    res_25969;\n                ((__local\n                  float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)] =\n                    res_25970;\n            }\n            \n          error_0:\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_failure)\n                return;\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_29364;\n            float x_29365;\n            bool x_",
                   "29366;\n            float x_29367;\n            bool x_29371;\n            float x_29372;\n            bool x_29373;\n            float x_29374;\n            bool ltid_in_bounds_29378;\n            \n            ltid_in_bounds_29378 = slt64(sext_i32_i64(local_tid_29353),\n                                         segscan_group_sizze_27391);\n            \n            int32_t skip_threads_29379;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_29378) {\n                    x_29366 = ((volatile __local\n                                bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)];\n                    x_29367 = ((volatile __local\n                                float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)];\n                    if ((local_tid_29353 - squot32(local_tid_29353, 32) * 32) ==\n                        0) {\n                        x_29364 = x_29366;\n                        x_29365 = x_29367;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_29379 = 1;\n                while (slt32(skip_threads_29379, 32)) {\n                    if (sle32(skip_threads_29379, local_tid_29353 -\n                              squot32(local_tid_29353, 32) * 32) &&\n                        ltid_in_bounds_29378) {\n                        // read operands\n                        {\n                            x_29364 = ((volatile __local\n                                        bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353) -\n                                                                    sext_i32_i64(skip_threads_29379)];\n                            x_29365 = ((volatile __local\n                                        float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353) -\n                                                                     sext_i32_i64(skip_threads_29379)];\n                       ",
                   " }\n                        // perform operation\n                        {\n                            bool res_29368 = x_29364 || x_29366;\n                            float res_29369;\n                            \n                            if (x_29366) {\n                                res_29369 = x_29367;\n                            } else {\n                                float res_29370 = x_29365 + x_29367;\n                                \n                                res_29369 = res_29370;\n                            }\n                            x_29364 = res_29368;\n                            x_29365 = res_29369;\n                        }\n                    }\n                    if (sle32(wave_sizze_29355, skip_threads_29379)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_29379, local_tid_29353 -\n                              squot32(local_tid_29353, 32) * 32) &&\n                        ltid_in_bounds_29378) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)] =\n                                x_29364;\n                            x_29366 = x_29364;\n                            ((volatile __local\n                              float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)] =\n                                x_29365;\n                            x_29367 = x_29365;\n                        }\n                    }\n                    if (sle32(wave_sizze_29355, skip_threads_29379)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_29379 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_29353 - squot32(local_tid_29353, 32) * 3",
                   "2) ==\n                    31 && ltid_in_bounds_29378) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29357)[sext_i32_i64(squot32(local_tid_29353,\n                                                                       32))] =\n                        x_29364;\n                    ((volatile __local\n                      float *) scan_arr_mem_29359)[sext_i32_i64(squot32(local_tid_29353,\n                                                                        32))] =\n                        x_29365;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_29380;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_29353, 32) == 0 &&\n                        ltid_in_bounds_29378) {\n                        x_29373 = ((volatile __local\n                                    bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)];\n                        x_29374 = ((volatile __local\n                                    float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)];\n                        if ((local_tid_29353 - squot32(local_tid_29353, 32) *\n                             32) == 0) {\n                            x_29371 = x_29373;\n                            x_29372 = x_29374;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29380 = 1;\n                    while (slt32(skip_threads_29380, 32)) {\n                        if (sle32(skip_threads_29380, local_tid_29353 -\n                                  squot32(local_tid_29353, 32) * 32) &&\n                            (squot32(local_tid_29353, 32) == 0 &&\n                             ltid_in_bounds_29378)) {\n                  ",
                   "          // read operands\n                            {\n                                x_29371 = ((volatile __local\n                                            bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353) -\n                                                                        sext_i32_i64(skip_threads_29380)];\n                                x_29372 = ((volatile __local\n                                            float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353) -\n                                                                         sext_i32_i64(skip_threads_29380)];\n                            }\n                            // perform operation\n                            {\n                                bool res_29375 = x_29371 || x_29373;\n                                float res_29376;\n                                \n                                if (x_29373) {\n                                    res_29376 = x_29374;\n                                } else {\n                                    float res_29377 = x_29372 + x_29374;\n                                    \n                                    res_29376 = res_29377;\n                                }\n                                x_29371 = res_29375;\n                                x_29372 = res_29376;\n                            }\n                        }\n                        if (sle32(wave_sizze_29355, skip_threads_29380)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29380, local_tid_29353 -\n                                  squot32(local_tid_29353, 32) * 32) &&\n                            (squot32(local_tid_29353, 32) == 0 &&\n                             ltid_in_bounds_29378)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_29357)[sext_i32_i64(loca",
                   "l_tid_29353)] =\n                                    x_29371;\n                                x_29373 = x_29371;\n                                ((volatile __local\n                                  float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)] =\n                                    x_29372;\n                                x_29374 = x_29372;\n                            }\n                        }\n                        if (sle32(wave_sizze_29355, skip_threads_29380)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29380 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_29353, 32) == 0 ||\n                      !ltid_in_bounds_29378)) {\n                    // read operands\n                    {\n                        x_29366 = x_29364;\n                        x_29367 = x_29365;\n                        x_29364 = ((__local\n                                    bool *) scan_arr_mem_29357)[sext_i32_i64(squot32(local_tid_29353,\n                                                                                     32)) -\n                                                                1];\n                        x_29365 = ((__local\n                                    float *) scan_arr_mem_29359)[sext_i32_i64(squot32(local_tid_29353,\n                                                                                      32)) -\n                                                                 1];\n                    }\n                    // perform operation\n                    {\n                        bool res_29368 = x_29364 || x_29366;\n                        float res_29369;\n                        \n                        if (x_29366) {\n                            res_29369 = x_29367;\n                        } else {\n              ",
                   "              float res_29370 = x_29365 + x_29367;\n                            \n                            res_29369 = res_29370;\n                        }\n                        x_29364 = res_29368;\n                        x_29365 = res_29369;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)] =\n                            x_29364;\n                        ((__local\n                          float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)] =\n                            x_29365;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_29353, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)] =\n                        x_29366;\n                    ((__local\n                      float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)] =\n                        x_29367;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_27395, res_25881)) {\n                    ((__global bool *) mem_28818)[gtid_27395] = ((__local\n                                                                  bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)];\n                    ((__global float *) mem_28820)[gtid_27395] = ((__local\n                                                                   float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_29381 = 0;\n                bool",
                   " should_load_carry_29382 = local_tid_29353 == 0 &&\n                     !crosses_segment_29381;\n                \n                if (should_load_carry_29382) {\n                    x_25965 = ((__local\n                                bool *) scan_arr_mem_29357)[segscan_group_sizze_27391 -\n                                                            1];\n                    x_25966 = ((__local\n                                float *) scan_arr_mem_29359)[segscan_group_sizze_27391 -\n                                                             1];\n                }\n                if (!should_load_carry_29382) {\n                    x_25965 = 0;\n                    x_25966 = 0.0F;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_27391\n}\n__kernel void mainziscan_stage1_27448(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29424_backing_aligned_0,\n                                      int64_t res_25881, __global\n                                      unsigned char *mem_28815, __global\n                                      unsigned char *mem_28823,\n                                      int32_t num_threads_29418)\n{\n    #define segscan_group_sizze_27443 (mainzisegscan_group_sizze_27442)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29424_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29424_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29419;\n    int32_t local_tid_29420;\n    int64_t group_sizze_29423;\n    int32_t wave_sizze_29422;\n    int32_t group_tid_29421;\n    \n    global_tid_29419 = get_global_id(0);\n    local_tid_29420 = get_local_id(0);\n    group_sizze_29423 = get_local_size(0);\n",
                   "    wave_sizze_29422 = LOCKSTEP_WIDTH;\n    group_tid_29421 = get_group_id(0);\n    \n    int32_t phys_tid_27448;\n    \n    phys_tid_27448 = global_tid_29419;\n    \n    __local char *scan_arr_mem_29424;\n    \n    scan_arr_mem_29424 = (__local char *) scan_arr_mem_29424_backing_0;\n    \n    int64_t x_26069;\n    int64_t x_26070;\n    \n    x_26069 = 0;\n    for (int64_t j_29426 = 0; j_29426 < sdiv_up64(res_25881,\n                                                  sext_i32_i64(num_threads_29418));\n         j_29426++) {\n        int64_t chunk_offset_29427 = segscan_group_sizze_27443 * j_29426 +\n                sext_i32_i64(group_tid_29421) * (segscan_group_sizze_27443 *\n                                                 sdiv_up64(res_25881,\n                                                           sext_i32_i64(num_threads_29418)));\n        int64_t flat_idx_29428 = chunk_offset_29427 +\n                sext_i32_i64(local_tid_29420);\n        int64_t gtid_27447 = flat_idx_29428;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_27447, res_25881)) {\n                int64_t i_p_o_28681 = add64(1, gtid_27447);\n                int64_t rot_i_28682 = smod64(i_p_o_28681, res_25881);\n                bool x_26072 = ((__global bool *) mem_28815)[rot_i_28682];\n                int64_t res_26073 = btoi_bool_i64(x_26072);\n                \n                // write to-scan values to parameters\n                {\n                    x_26070 = res_26073;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_27447, res_25881)) {\n                    x_26070 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                int64_t res_26071 = add64(x_26069, x_26070",
                   ");\n                \n                ((__local\n                  int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)] =\n                    res_26071;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int64_t x_29429;\n            int64_t x_29430;\n            int64_t x_29432;\n            int64_t x_29433;\n            bool ltid_in_bounds_29435;\n            \n            ltid_in_bounds_29435 = slt64(sext_i32_i64(local_tid_29420),\n                                         segscan_group_sizze_27443);\n            \n            int32_t skip_threads_29436;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_29435) {\n                    x_29430 = ((volatile __local\n                                int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)];\n                    if ((local_tid_29420 - squot32(local_tid_29420, 32) * 32) ==\n                        0) {\n                        x_29429 = x_29430;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_29436 = 1;\n                while (slt32(skip_threads_29436, 32)) {\n                    if (sle32(skip_threads_29436, local_tid_29420 -\n                              squot32(local_tid_29420, 32) * 32) &&\n                        ltid_in_bounds_29435) {\n                        // read operands\n                        {\n                            x_29429 = ((volatile __local\n                                        int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420) -\n                                                                       sext_i32_i64(skip_threads_29436)];\n                        }\n                        // perform operation\n                        {\n                            int64_t res_29431 = add64(x_29429, x_29430);\n                            \n                            x_29429 = res_29431;\n         ",
                   "               }\n                    }\n                    if (sle32(wave_sizze_29422, skip_threads_29436)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_29436, local_tid_29420 -\n                              squot32(local_tid_29420, 32) * 32) &&\n                        ltid_in_bounds_29435) {\n                        // write result\n                        {\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)] =\n                                x_29429;\n                            x_29430 = x_29429;\n                        }\n                    }\n                    if (sle32(wave_sizze_29422, skip_threads_29436)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_29436 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_29420 - squot32(local_tid_29420, 32) * 32) ==\n                    31 && ltid_in_bounds_29435) {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29424)[sext_i32_i64(squot32(local_tid_29420,\n                                                                          32))] =\n                        x_29429;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_29437;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_29420, 32) == 0 &&\n                        ltid_in_bounds_29435) {\n                        x_29433 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29",
                   "420)];\n                        if ((local_tid_29420 - squot32(local_tid_29420, 32) *\n                             32) == 0) {\n                            x_29432 = x_29433;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29437 = 1;\n                    while (slt32(skip_threads_29437, 32)) {\n                        if (sle32(skip_threads_29437, local_tid_29420 -\n                                  squot32(local_tid_29420, 32) * 32) &&\n                            (squot32(local_tid_29420, 32) == 0 &&\n                             ltid_in_bounds_29435)) {\n                            // read operands\n                            {\n                                x_29432 = ((volatile __local\n                                            int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420) -\n                                                                           sext_i32_i64(skip_threads_29437)];\n                            }\n                            // perform operation\n                            {\n                                int64_t res_29434 = add64(x_29432, x_29433);\n                                \n                                x_29432 = res_29434;\n                            }\n                        }\n                        if (sle32(wave_sizze_29422, skip_threads_29437)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29437, local_tid_29420 -\n                                  squot32(local_tid_29420, 32) * 32) &&\n                            (squot32(local_tid_29420, 32) == 0 &&\n                             ltid_in_bounds_29435)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_29424)[sext_i32_i64(loca",
                   "l_tid_29420)] =\n                                    x_29432;\n                                x_29433 = x_29432;\n                            }\n                        }\n                        if (sle32(wave_sizze_29422, skip_threads_29437)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29437 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_29420, 32) == 0 ||\n                      !ltid_in_bounds_29435)) {\n                    // read operands\n                    {\n                        x_29430 = x_29429;\n                        x_29429 = ((__local\n                                    int64_t *) scan_arr_mem_29424)[sext_i32_i64(squot32(local_tid_29420,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_29431 = add64(x_29429, x_29430);\n                        \n                        x_29429 = res_29431;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)] =\n                            x_29429;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_29420, 32) == 0) {\n                    ((__local\n                      int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)] =\n                        x_29430;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // thr",
                   "eads in bounds write partial scan result\n            {\n                if (slt64(gtid_27447, res_25881)) {\n                    ((__global int64_t *) mem_28823)[gtid_27447] = ((__local\n                                                                     int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_29438 = 0;\n                bool should_load_carry_29439 = local_tid_29420 == 0 &&\n                     !crosses_segment_29438;\n                \n                if (should_load_carry_29439) {\n                    x_26069 = ((__local\n                                int64_t *) scan_arr_mem_29424)[segscan_group_sizze_27443 -\n                                                               1];\n                }\n                if (!should_load_carry_29439) {\n                    x_26069 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_27443\n}\n__kernel void mainziscan_stage2_27347(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29007_backing_aligned_0,\n                                      int64_t flat_dim_25598, __global\n                                      unsigned char *mem_28795,\n                                      int64_t stage1_num_groups_28979,\n                                      int32_t num_threads_28980)\n{\n    #define segscan_group_sizze_27342 (mainzisegscan_group_sizze_27341)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29007_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29007_backing_aligned_0;\n    ",
                   "\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29002;\n    int32_t local_tid_29003;\n    int64_t group_sizze_29006;\n    int32_t wave_sizze_29005;\n    int32_t group_tid_29004;\n    \n    global_tid_29002 = get_global_id(0);\n    local_tid_29003 = get_local_id(0);\n    group_sizze_29006 = get_local_size(0);\n    wave_sizze_29005 = LOCKSTEP_WIDTH;\n    group_tid_29004 = get_group_id(0);\n    \n    int32_t phys_tid_27347;\n    \n    phys_tid_27347 = global_tid_29002;\n    \n    __local char *scan_arr_mem_29007;\n    \n    scan_arr_mem_29007 = (__local char *) scan_arr_mem_29007_backing_0;\n    \n    int64_t flat_idx_29009;\n    \n    flat_idx_29009 = (sext_i32_i64(local_tid_29003) + 1) *\n        (segscan_group_sizze_27342 * sdiv_up64(flat_dim_25598,\n                                               sext_i32_i64(num_threads_28980))) -\n        1;\n    \n    int64_t gtid_27346;\n    \n    gtid_27346 = flat_idx_29009;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_27346, flat_dim_25598)) {\n            ((__local\n              int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] =\n                ((__global int64_t *) mem_28795)[gtid_27346];\n        } else {\n            ((__local\n              int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int64_t x_25867;\n    int64_t x_25868;\n    int64_t x_29010;\n    int64_t x_29011;\n    bool ltid_in_bounds_29013;\n    \n    ltid_in_bounds_29013 = slt64(sext_i32_i64(local_tid_29003),\n                                 stage1_num_groups_28979);\n    \n    int32_t skip_threads_29014;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_29013) {\n            x_25868 = ((volatile __local\n                        int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)];\n            if ((local_tid_29003 - squot32(local_tid_29003, 32) * 32) == 0) {\n                x_25867 = x_25868;\n            }\n",
                   "        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_29014 = 1;\n        while (slt32(skip_threads_29014, 32)) {\n            if (sle32(skip_threads_29014, local_tid_29003 -\n                      squot32(local_tid_29003, 32) * 32) &&\n                ltid_in_bounds_29013) {\n                // read operands\n                {\n                    x_25867 = ((volatile __local\n                                int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003) -\n                                                               sext_i32_i64(skip_threads_29014)];\n                }\n                // perform operation\n                {\n                    int64_t res_25869 = add64(x_25867, x_25868);\n                    \n                    x_25867 = res_25869;\n                }\n            }\n            if (sle32(wave_sizze_29005, skip_threads_29014)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_29014, local_tid_29003 -\n                      squot32(local_tid_29003, 32) * 32) &&\n                ltid_in_bounds_29013) {\n                // write result\n                {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] =\n                        x_25867;\n                    x_25868 = x_25867;\n                }\n            }\n            if (sle32(wave_sizze_29005, skip_threads_29014)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_29014 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_29003 - squot32(local_tid_29003, 32) * 32) == 31 &&\n            ltid_in_bounds_29013) {\n            ((volatile __local\n              int64_t *) scan_arr_mem_29007)[sext_i32_i64(squot32(local_tid_29003,\n                                                                  32))] =\n                x_25",
                   "867;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_29015;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_29003, 32) == 0 && ltid_in_bounds_29013) {\n                x_29011 = ((volatile __local\n                            int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)];\n                if ((local_tid_29003 - squot32(local_tid_29003, 32) * 32) ==\n                    0) {\n                    x_29010 = x_29011;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_29015 = 1;\n            while (slt32(skip_threads_29015, 32)) {\n                if (sle32(skip_threads_29015, local_tid_29003 -\n                          squot32(local_tid_29003, 32) * 32) &&\n                    (squot32(local_tid_29003, 32) == 0 &&\n                     ltid_in_bounds_29013)) {\n                    // read operands\n                    {\n                        x_29010 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003) -\n                                                                   sext_i32_i64(skip_threads_29015)];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_29012 = add64(x_29010, x_29011);\n                        \n                        x_29010 = res_29012;\n                    }\n                }\n                if (sle32(wave_sizze_29005, skip_threads_29015)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_29015, local_tid_29003 -\n                          squot32(local_tid_29003, 32) * 32) &&\n                    (squot32(local_tid_29003, 32) == 0 &&\n                     ltid_in_bounds_29013)) {\n                    // write res",
                   "ult\n                    {\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] =\n                            x_29010;\n                        x_29011 = x_29010;\n                    }\n                }\n                if (sle32(wave_sizze_29005, skip_threads_29015)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_29015 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_29003, 32) == 0 || !ltid_in_bounds_29013)) {\n            // read operands\n            {\n                x_25868 = x_25867;\n                x_25867 = ((__local\n                            int64_t *) scan_arr_mem_29007)[sext_i32_i64(squot32(local_tid_29003,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                int64_t res_25869 = add64(x_25867, x_25868);\n                \n                x_25867 = res_25869;\n            }\n            // write final result\n            {\n                ((__local\n                  int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] =\n                    x_25867;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_29003, 32) == 0) {\n            ((__local\n              int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] =\n                x_25868;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_27346, flat_dim_25598)) {\n            ((__global int64_t *) mem_28795)[gtid_27346] = ((__local\n                                                             int64_t *) scan_arr_mem_29007)[sext_i32_i",
                   "64(local_tid_29003)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_27342\n}\n__kernel void mainziscan_stage2_27380(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29256_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29254_backing_aligned_1,\n                                      int64_t res_25881, __global\n                                      unsigned char *mem_28806, __global\n                                      unsigned char *mem_28808,\n                                      int64_t stage1_num_groups_29216,\n                                      int32_t num_threads_29217)\n{\n    #define segscan_group_sizze_27375 (mainzisegscan_group_sizze_27374)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29256_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_29256_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29254_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29254_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29249;\n    int32_t local_tid_29250;\n    int64_t group_sizze_29253;\n    int32_t wave_sizze_29252;\n    int32_t group_tid_29251;\n    \n    global_tid_29249 = get_global_id(0);\n    local_tid_29250 = get_local_id(0);\n    group_sizze_29253 = get_local_size(0);\n    wave_sizze_29252 = LOCKSTEP_WIDTH;\n    group_tid_29251 = get_group_id(0);\n    \n    int32_t phys_tid_27380;\n    \n    phys_tid_27380 = global_tid_29249;\n    \n    __local char *scan_arr_mem_29254;\n    __local char *scan_arr_mem_29256;\n    \n    scan_arr_mem_29254 = (__local char *) scan_arr_mem_29254_backing_0;\n    scan_arr_mem_29256 = ",
                   "(__local char *) scan_arr_mem_29256_backing_1;\n    \n    int64_t flat_idx_29258;\n    \n    flat_idx_29258 = (sext_i32_i64(local_tid_29250) + 1) *\n        (segscan_group_sizze_27375 * sdiv_up64(res_25881,\n                                               sext_i32_i64(num_threads_29217))) -\n        1;\n    \n    int64_t gtid_27379;\n    \n    gtid_27379 = flat_idx_29258;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_27379, res_25881)) {\n            ((__local\n              bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] =\n                ((__global bool *) mem_28806)[gtid_27379];\n            ((__local\n              int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] =\n                ((__global int64_t *) mem_28808)[gtid_27379];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] = 0;\n            ((__local\n              int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_25900;\n    int64_t x_25901;\n    bool x_25902;\n    int64_t x_25903;\n    bool x_29259;\n    int64_t x_29260;\n    bool x_29261;\n    int64_t x_29262;\n    bool ltid_in_bounds_29266;\n    \n    ltid_in_bounds_29266 = slt64(sext_i32_i64(local_tid_29250),\n                                 stage1_num_groups_29216);\n    \n    int32_t skip_threads_29267;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_29266) {\n            x_25902 = ((volatile __local\n                        bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)];\n            x_25903 = ((volatile __local\n                        int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)];\n            if ((local_tid_29250 - squot32(local_tid_29250, 32) * 32) == 0) {\n                x_25900 = x_25902;\n                x_25901 = x_25903;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n     ",
                   "   skip_threads_29267 = 1;\n        while (slt32(skip_threads_29267, 32)) {\n            if (sle32(skip_threads_29267, local_tid_29250 -\n                      squot32(local_tid_29250, 32) * 32) &&\n                ltid_in_bounds_29266) {\n                // read operands\n                {\n                    x_25900 = ((volatile __local\n                                bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250) -\n                                                            sext_i32_i64(skip_threads_29267)];\n                    x_25901 = ((volatile __local\n                                int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250) -\n                                                               sext_i32_i64(skip_threads_29267)];\n                }\n                // perform operation\n                {\n                    bool res_25904 = x_25900 || x_25902;\n                    int64_t res_25905;\n                    \n                    if (x_25902) {\n                        res_25905 = x_25903;\n                    } else {\n                        int64_t res_25906 = add64(x_25901, x_25903);\n                        \n                        res_25905 = res_25906;\n                    }\n                    x_25900 = res_25904;\n                    x_25901 = res_25905;\n                }\n            }\n            if (sle32(wave_sizze_29252, skip_threads_29267)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_29267, local_tid_29250 -\n                      squot32(local_tid_29250, 32) * 32) &&\n                ltid_in_bounds_29266) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] =\n                        x_25900;\n                    x_25902 = x_25900;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] =\n        ",
                   "                x_25901;\n                    x_25903 = x_25901;\n                }\n            }\n            if (sle32(wave_sizze_29252, skip_threads_29267)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_29267 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_29250 - squot32(local_tid_29250, 32) * 32) == 31 &&\n            ltid_in_bounds_29266) {\n            ((volatile __local\n              bool *) scan_arr_mem_29254)[sext_i32_i64(squot32(local_tid_29250,\n                                                               32))] = x_25900;\n            ((volatile __local\n              int64_t *) scan_arr_mem_29256)[sext_i32_i64(squot32(local_tid_29250,\n                                                                  32))] =\n                x_25901;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_29268;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_29250, 32) == 0 && ltid_in_bounds_29266) {\n                x_29261 = ((volatile __local\n                            bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)];\n                x_29262 = ((volatile __local\n                            int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)];\n                if ((local_tid_29250 - squot32(local_tid_29250, 32) * 32) ==\n                    0) {\n                    x_29259 = x_29261;\n                    x_29260 = x_29262;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_29268 = 1;\n            while (slt32(skip_threads_29268, 32)) {\n                if (sle32(skip_threads_29268, local_tid_29250 -\n                          squot32(local_tid_29250, 32) * 32) &&\n                    (s",
                   "quot32(local_tid_29250, 32) == 0 &&\n                     ltid_in_bounds_29266)) {\n                    // read operands\n                    {\n                        x_29259 = ((volatile __local\n                                    bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250) -\n                                                                sext_i32_i64(skip_threads_29268)];\n                        x_29260 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250) -\n                                                                   sext_i32_i64(skip_threads_29268)];\n                    }\n                    // perform operation\n                    {\n                        bool res_29263 = x_29259 || x_29261;\n                        int64_t res_29264;\n                        \n                        if (x_29261) {\n                            res_29264 = x_29262;\n                        } else {\n                            int64_t res_29265 = add64(x_29260, x_29262);\n                            \n                            res_29264 = res_29265;\n                        }\n                        x_29259 = res_29263;\n                        x_29260 = res_29264;\n                    }\n                }\n                if (sle32(wave_sizze_29252, skip_threads_29268)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_29268, local_tid_29250 -\n                          squot32(local_tid_29250, 32) * 32) &&\n                    (squot32(local_tid_29250, 32) == 0 &&\n                     ltid_in_bounds_29266)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] =\n                            x_29259;\n                        x_29261 = x_29259;\n                        ((volatile __local\n                          int64_t *",
                   ") scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] =\n                            x_29260;\n                        x_29262 = x_29260;\n                    }\n                }\n                if (sle32(wave_sizze_29252, skip_threads_29268)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_29268 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_29250, 32) == 0 || !ltid_in_bounds_29266)) {\n            // read operands\n            {\n                x_25902 = x_25900;\n                x_25903 = x_25901;\n                x_25900 = ((__local\n                            bool *) scan_arr_mem_29254)[sext_i32_i64(squot32(local_tid_29250,\n                                                                             32)) -\n                                                        1];\n                x_25901 = ((__local\n                            int64_t *) scan_arr_mem_29256)[sext_i32_i64(squot32(local_tid_29250,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                bool res_25904 = x_25900 || x_25902;\n                int64_t res_25905;\n                \n                if (x_25902) {\n                    res_25905 = x_25903;\n                } else {\n                    int64_t res_25906 = add64(x_25901, x_25903);\n                    \n                    res_25905 = res_25906;\n                }\n                x_25900 = res_25904;\n                x_25901 = res_25905;\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] =\n                    x_25900;\n                ((__local\n                  int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250",
                   ")] =\n                    x_25901;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_29250, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] =\n                x_25902;\n            ((__local\n              int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] =\n                x_25903;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_27379, res_25881)) {\n            ((__global bool *) mem_28806)[gtid_27379] = ((__local\n                                                          bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)];\n            ((__global int64_t *) mem_28808)[gtid_27379] = ((__local\n                                                             int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_27375\n}\n__kernel void mainziscan_stage2_27388(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29323_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29321_backing_aligned_1,\n                                      int64_t res_25881, __global\n                                      unsigned char *mem_28811, __global\n                                      unsigned char *mem_28813,\n                                      int64_t stage1_num_groups_29283,\n                                      int32_t num_threads_29284)\n{\n    #define segscan_group_sizze_27383 (mainzisegscan_group_sizze_27382)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29323_backing_1 =\n                        ",
                   "  (__local volatile\n                           char *) scan_arr_mem_29323_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29321_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29321_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29316;\n    int32_t local_tid_29317;\n    int64_t group_sizze_29320;\n    int32_t wave_sizze_29319;\n    int32_t group_tid_29318;\n    \n    global_tid_29316 = get_global_id(0);\n    local_tid_29317 = get_local_id(0);\n    group_sizze_29320 = get_local_size(0);\n    wave_sizze_29319 = LOCKSTEP_WIDTH;\n    group_tid_29318 = get_group_id(0);\n    \n    int32_t phys_tid_27388;\n    \n    phys_tid_27388 = global_tid_29316;\n    \n    __local char *scan_arr_mem_29321;\n    __local char *scan_arr_mem_29323;\n    \n    scan_arr_mem_29321 = (__local char *) scan_arr_mem_29321_backing_0;\n    scan_arr_mem_29323 = (__local char *) scan_arr_mem_29323_backing_1;\n    \n    int64_t flat_idx_29325;\n    \n    flat_idx_29325 = (sext_i32_i64(local_tid_29317) + 1) *\n        (segscan_group_sizze_27383 * sdiv_up64(res_25881,\n                                               sext_i32_i64(num_threads_29284))) -\n        1;\n    \n    int64_t gtid_27387;\n    \n    gtid_27387 = flat_idx_29325;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_27387, res_25881)) {\n            ((__local\n              bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] =\n                ((__global bool *) mem_28811)[gtid_27387];\n            ((__local\n              int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] =\n                ((__global int64_t *) mem_28813)[gtid_27387];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] = 0;\n            ((__local\n              int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] = 0;\n        }\n    }\n    barrier(CLK_LOCA",
                   "L_MEM_FENCE);\n    \n    bool x_25939;\n    int64_t x_25940;\n    bool x_25941;\n    int64_t x_25942;\n    bool x_29326;\n    int64_t x_29327;\n    bool x_29328;\n    int64_t x_29329;\n    bool ltid_in_bounds_29333;\n    \n    ltid_in_bounds_29333 = slt64(sext_i32_i64(local_tid_29317),\n                                 stage1_num_groups_29283);\n    \n    int32_t skip_threads_29334;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_29333) {\n            x_25941 = ((volatile __local\n                        bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)];\n            x_25942 = ((volatile __local\n                        int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)];\n            if ((local_tid_29317 - squot32(local_tid_29317, 32) * 32) == 0) {\n                x_25939 = x_25941;\n                x_25940 = x_25942;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_29334 = 1;\n        while (slt32(skip_threads_29334, 32)) {\n            if (sle32(skip_threads_29334, local_tid_29317 -\n                      squot32(local_tid_29317, 32) * 32) &&\n                ltid_in_bounds_29333) {\n                // read operands\n                {\n                    x_25939 = ((volatile __local\n                                bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317) -\n                                                            sext_i32_i64(skip_threads_29334)];\n                    x_25940 = ((volatile __local\n                                int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317) -\n                                                               sext_i32_i64(skip_threads_29334)];\n                }\n                // perform operation\n                {\n                    bool res_25943 = x_25939 || x_25941;\n                    int64_t res_25944;\n                    \n                    if (x_25941) {\n                        res_25944 = x_25942;\n                  ",
                   "  } else {\n                        int64_t res_25945 = add64(x_25940, x_25942);\n                        \n                        res_25944 = res_25945;\n                    }\n                    x_25939 = res_25943;\n                    x_25940 = res_25944;\n                }\n            }\n            if (sle32(wave_sizze_29319, skip_threads_29334)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_29334, local_tid_29317 -\n                      squot32(local_tid_29317, 32) * 32) &&\n                ltid_in_bounds_29333) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] =\n                        x_25939;\n                    x_25941 = x_25939;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] =\n                        x_25940;\n                    x_25942 = x_25940;\n                }\n            }\n            if (sle32(wave_sizze_29319, skip_threads_29334)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_29334 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_29317 - squot32(local_tid_29317, 32) * 32) == 31 &&\n            ltid_in_bounds_29333) {\n            ((volatile __local\n              bool *) scan_arr_mem_29321)[sext_i32_i64(squot32(local_tid_29317,\n                                                               32))] = x_25939;\n            ((volatile __local\n              int64_t *) scan_arr_mem_29323)[sext_i32_i64(squot32(local_tid_29317,\n                                                                  32))] =\n                x_25940;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t ski",
                   "p_threads_29335;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_29317, 32) == 0 && ltid_in_bounds_29333) {\n                x_29328 = ((volatile __local\n                            bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)];\n                x_29329 = ((volatile __local\n                            int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)];\n                if ((local_tid_29317 - squot32(local_tid_29317, 32) * 32) ==\n                    0) {\n                    x_29326 = x_29328;\n                    x_29327 = x_29329;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_29335 = 1;\n            while (slt32(skip_threads_29335, 32)) {\n                if (sle32(skip_threads_29335, local_tid_29317 -\n                          squot32(local_tid_29317, 32) * 32) &&\n                    (squot32(local_tid_29317, 32) == 0 &&\n                     ltid_in_bounds_29333)) {\n                    // read operands\n                    {\n                        x_29326 = ((volatile __local\n                                    bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317) -\n                                                                sext_i32_i64(skip_threads_29335)];\n                        x_29327 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317) -\n                                                                   sext_i32_i64(skip_threads_29335)];\n                    }\n                    // perform operation\n                    {\n                        bool res_29330 = x_29326 || x_29328;\n                        int64_t res_29331;\n                        \n                        if (x_29328) {\n                            res_29331 = x_29329;\n                        } else {\n                            int64_t res_29332 = add64(x_29327, x_29329);\n ",
                   "                           \n                            res_29331 = res_29332;\n                        }\n                        x_29326 = res_29330;\n                        x_29327 = res_29331;\n                    }\n                }\n                if (sle32(wave_sizze_29319, skip_threads_29335)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_29335, local_tid_29317 -\n                          squot32(local_tid_29317, 32) * 32) &&\n                    (squot32(local_tid_29317, 32) == 0 &&\n                     ltid_in_bounds_29333)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] =\n                            x_29326;\n                        x_29328 = x_29326;\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] =\n                            x_29327;\n                        x_29329 = x_29327;\n                    }\n                }\n                if (sle32(wave_sizze_29319, skip_threads_29335)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_29335 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_29317, 32) == 0 || !ltid_in_bounds_29333)) {\n            // read operands\n            {\n                x_25941 = x_25939;\n                x_25942 = x_25940;\n                x_25939 = ((__local\n                            bool *) scan_arr_mem_29321)[sext_i32_i64(squot32(local_tid_29317,\n                                                                             32)) -\n                                                        1];\n                x_25940 = ((__local\n                            int64_t *) scan_arr_mem_29323)[sext_i32_i64(squot32(lo",
                   "cal_tid_29317,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                bool res_25943 = x_25939 || x_25941;\n                int64_t res_25944;\n                \n                if (x_25941) {\n                    res_25944 = x_25942;\n                } else {\n                    int64_t res_25945 = add64(x_25940, x_25942);\n                    \n                    res_25944 = res_25945;\n                }\n                x_25939 = res_25943;\n                x_25940 = res_25944;\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] =\n                    x_25939;\n                ((__local\n                  int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] =\n                    x_25940;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_29317, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] =\n                x_25941;\n            ((__local\n              int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] =\n                x_25942;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_27387, res_25881)) {\n            ((__global bool *) mem_28811)[gtid_27387] = ((__local\n                                                          bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)];\n            ((__global int64_t *) mem_28813)[gtid_27387] = ((__local\n                                                             int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_27383\n}",
                   "\n__kernel void mainziscan_stage2_27396(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29390_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29388_backing_aligned_1,\n                                      int64_t res_25881, __global\n                                      unsigned char *mem_28818, __global\n                                      unsigned char *mem_28820,\n                                      int64_t stage1_num_groups_29350,\n                                      int32_t num_threads_29351)\n{\n    #define segscan_group_sizze_27391 (mainzisegscan_group_sizze_27390)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29390_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_29390_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29388_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29388_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29383;\n    int32_t local_tid_29384;\n    int64_t group_sizze_29387;\n    int32_t wave_sizze_29386;\n    int32_t group_tid_29385;\n    \n    global_tid_29383 = get_global_id(0);\n    local_tid_29384 = get_local_id(0);\n    group_sizze_29387 = get_local_size(0);\n    wave_sizze_29386 = LOCKSTEP_WIDTH;\n    group_tid_29385 = get_group_id(0);\n    \n    int32_t phys_tid_27396;\n    \n    phys_tid_27396 = global_tid_29383;\n    \n    __local char *scan_arr_mem_29388;\n    __local char *scan_arr_mem_29390;\n    \n    scan_arr_mem_29388 = (__local char *) scan_arr_mem_29388_backing_0;\n    scan_arr_mem_29390 = (__local char *) scan_arr_mem_29390_backing_1;\n    \n    int64_t flat_idx_29392;\n    \n    flat_idx_29392 ",
                   "= (sext_i32_i64(local_tid_29384) + 1) *\n        (segscan_group_sizze_27391 * sdiv_up64(res_25881,\n                                               sext_i32_i64(num_threads_29351))) -\n        1;\n    \n    int64_t gtid_27395;\n    \n    gtid_27395 = flat_idx_29392;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_27395, res_25881)) {\n            ((__local\n              bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] =\n                ((__global bool *) mem_28818)[gtid_27395];\n            ((__local\n              float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                ((__global float *) mem_28820)[gtid_27395];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] = 0;\n            ((__local\n              float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                0.0F;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_25965;\n    float x_25966;\n    bool x_25967;\n    float x_25968;\n    bool x_29393;\n    float x_29394;\n    bool x_29395;\n    float x_29396;\n    bool ltid_in_bounds_29400;\n    \n    ltid_in_bounds_29400 = slt64(sext_i32_i64(local_tid_29384),\n                                 stage1_num_groups_29350);\n    \n    int32_t skip_threads_29401;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_29400) {\n            x_25967 = ((volatile __local\n                        bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)];\n            x_25968 = ((volatile __local\n                        float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)];\n            if ((local_tid_29384 - squot32(local_tid_29384, 32) * 32) == 0) {\n                x_25965 = x_25967;\n                x_25966 = x_25968;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_29401 = 1;\n        while (slt32(skip_threads_29401, 32)) {\n            if (sle32(skip",
                   "_threads_29401, local_tid_29384 -\n                      squot32(local_tid_29384, 32) * 32) &&\n                ltid_in_bounds_29400) {\n                // read operands\n                {\n                    x_25965 = ((volatile __local\n                                bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384) -\n                                                            sext_i32_i64(skip_threads_29401)];\n                    x_25966 = ((volatile __local\n                                float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384) -\n                                                             sext_i32_i64(skip_threads_29401)];\n                }\n                // perform operation\n                {\n                    bool res_25969 = x_25965 || x_25967;\n                    float res_25970;\n                    \n                    if (x_25967) {\n                        res_25970 = x_25968;\n                    } else {\n                        float res_25971 = x_25966 + x_25968;\n                        \n                        res_25970 = res_25971;\n                    }\n                    x_25965 = res_25969;\n                    x_25966 = res_25970;\n                }\n            }\n            if (sle32(wave_sizze_29386, skip_threads_29401)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_29401, local_tid_29384 -\n                      squot32(local_tid_29384, 32) * 32) &&\n                ltid_in_bounds_29400) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] =\n                        x_25965;\n                    x_25967 = x_25965;\n                    ((volatile __local\n                      float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                        x_25966;\n                    x_25968 = x_25966;\n                }\n            }\n            if (sle32",
                   "(wave_sizze_29386, skip_threads_29401)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_29401 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_29384 - squot32(local_tid_29384, 32) * 32) == 31 &&\n            ltid_in_bounds_29400) {\n            ((volatile __local\n              bool *) scan_arr_mem_29388)[sext_i32_i64(squot32(local_tid_29384,\n                                                               32))] = x_25965;\n            ((volatile __local\n              float *) scan_arr_mem_29390)[sext_i32_i64(squot32(local_tid_29384,\n                                                                32))] = x_25966;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_29402;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_29384, 32) == 0 && ltid_in_bounds_29400) {\n                x_29395 = ((volatile __local\n                            bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)];\n                x_29396 = ((volatile __local\n                            float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)];\n                if ((local_tid_29384 - squot32(local_tid_29384, 32) * 32) ==\n                    0) {\n                    x_29393 = x_29395;\n                    x_29394 = x_29396;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_29402 = 1;\n            while (slt32(skip_threads_29402, 32)) {\n                if (sle32(skip_threads_29402, local_tid_29384 -\n                          squot32(local_tid_29384, 32) * 32) &&\n                    (squot32(local_tid_29384, 32) == 0 &&\n                     ltid_in_bounds_29400)) {\n                    // read operands\n                    ",
                   "{\n                        x_29393 = ((volatile __local\n                                    bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384) -\n                                                                sext_i32_i64(skip_threads_29402)];\n                        x_29394 = ((volatile __local\n                                    float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384) -\n                                                                 sext_i32_i64(skip_threads_29402)];\n                    }\n                    // perform operation\n                    {\n                        bool res_29397 = x_29393 || x_29395;\n                        float res_29398;\n                        \n                        if (x_29395) {\n                            res_29398 = x_29396;\n                        } else {\n                            float res_29399 = x_29394 + x_29396;\n                            \n                            res_29398 = res_29399;\n                        }\n                        x_29393 = res_29397;\n                        x_29394 = res_29398;\n                    }\n                }\n                if (sle32(wave_sizze_29386, skip_threads_29402)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_29402, local_tid_29384 -\n                          squot32(local_tid_29384, 32) * 32) &&\n                    (squot32(local_tid_29384, 32) == 0 &&\n                     ltid_in_bounds_29400)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] =\n                            x_29393;\n                        x_29395 = x_29393;\n                        ((volatile __local\n                          float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                            x_29394;\n                        x_29396 = x_29394;\n                    ",
                   "}\n                }\n                if (sle32(wave_sizze_29386, skip_threads_29402)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_29402 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_29384, 32) == 0 || !ltid_in_bounds_29400)) {\n            // read operands\n            {\n                x_25967 = x_25965;\n                x_25968 = x_25966;\n                x_25965 = ((__local\n                            bool *) scan_arr_mem_29388)[sext_i32_i64(squot32(local_tid_29384,\n                                                                             32)) -\n                                                        1];\n                x_25966 = ((__local\n                            float *) scan_arr_mem_29390)[sext_i32_i64(squot32(local_tid_29384,\n                                                                              32)) -\n                                                         1];\n            }\n            // perform operation\n            {\n                bool res_25969 = x_25965 || x_25967;\n                float res_25970;\n                \n                if (x_25967) {\n                    res_25970 = x_25968;\n                } else {\n                    float res_25971 = x_25966 + x_25968;\n                    \n                    res_25970 = res_25971;\n                }\n                x_25965 = res_25969;\n                x_25966 = res_25970;\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] =\n                    x_25965;\n                ((__local\n                  float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                    x_25966;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(loc",
                   "al_tid_29384, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] =\n                x_25967;\n            ((__local\n              float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                x_25968;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_27395, res_25881)) {\n            ((__global bool *) mem_28818)[gtid_27395] = ((__local\n                                                          bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)];\n            ((__global float *) mem_28820)[gtid_27395] = ((__local\n                                                           float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_27391\n}\n__kernel void mainziscan_stage2_27448(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29445_backing_aligned_0,\n                                      int64_t res_25881, __global\n                                      unsigned char *mem_28823,\n                                      int64_t stage1_num_groups_29417,\n                                      int32_t num_threads_29418)\n{\n    #define segscan_group_sizze_27443 (mainzisegscan_group_sizze_27442)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29445_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29445_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29440;\n    int32_t local_tid_29441;\n    int64_t group_sizze_29444;\n    int32_t wave_sizze_29443;\n    int32_t group_tid_29442;\n    \n    global_tid_29440 = get_global_id(0);\n    local_tid_29441 = get_local_id(0);\n    group_s",
                   "izze_29444 = get_local_size(0);\n    wave_sizze_29443 = LOCKSTEP_WIDTH;\n    group_tid_29442 = get_group_id(0);\n    \n    int32_t phys_tid_27448;\n    \n    phys_tid_27448 = global_tid_29440;\n    \n    __local char *scan_arr_mem_29445;\n    \n    scan_arr_mem_29445 = (__local char *) scan_arr_mem_29445_backing_0;\n    \n    int64_t flat_idx_29447;\n    \n    flat_idx_29447 = (sext_i32_i64(local_tid_29441) + 1) *\n        (segscan_group_sizze_27443 * sdiv_up64(res_25881,\n                                               sext_i32_i64(num_threads_29418))) -\n        1;\n    \n    int64_t gtid_27447;\n    \n    gtid_27447 = flat_idx_29447;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_27447, res_25881)) {\n            ((__local\n              int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] =\n                ((__global int64_t *) mem_28823)[gtid_27447];\n        } else {\n            ((__local\n              int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int64_t x_26069;\n    int64_t x_26070;\n    int64_t x_29448;\n    int64_t x_29449;\n    bool ltid_in_bounds_29451;\n    \n    ltid_in_bounds_29451 = slt64(sext_i32_i64(local_tid_29441),\n                                 stage1_num_groups_29417);\n    \n    int32_t skip_threads_29452;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_29451) {\n            x_26070 = ((volatile __local\n                        int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)];\n            if ((local_tid_29441 - squot32(local_tid_29441, 32) * 32) == 0) {\n                x_26069 = x_26070;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_29452 = 1;\n        while (slt32(skip_threads_29452, 32)) {\n            if (sle32(skip_threads_29452, local_tid_29441 -\n                      squot32(local_tid_29441, 32) * 32) &&\n                ltid_in_bounds_29",
                   "451) {\n                // read operands\n                {\n                    x_26069 = ((volatile __local\n                                int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441) -\n                                                               sext_i32_i64(skip_threads_29452)];\n                }\n                // perform operation\n                {\n                    int64_t res_26071 = add64(x_26069, x_26070);\n                    \n                    x_26069 = res_26071;\n                }\n            }\n            if (sle32(wave_sizze_29443, skip_threads_29452)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_29452, local_tid_29441 -\n                      squot32(local_tid_29441, 32) * 32) &&\n                ltid_in_bounds_29451) {\n                // write result\n                {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] =\n                        x_26069;\n                    x_26070 = x_26069;\n                }\n            }\n            if (sle32(wave_sizze_29443, skip_threads_29452)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_29452 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_29441 - squot32(local_tid_29441, 32) * 32) == 31 &&\n            ltid_in_bounds_29451) {\n            ((volatile __local\n              int64_t *) scan_arr_mem_29445)[sext_i32_i64(squot32(local_tid_29441,\n                                                                  32))] =\n                x_26069;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_29453;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_29441, 32) == 0 && ltid_in_boun",
                   "ds_29451) {\n                x_29449 = ((volatile __local\n                            int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)];\n                if ((local_tid_29441 - squot32(local_tid_29441, 32) * 32) ==\n                    0) {\n                    x_29448 = x_29449;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_29453 = 1;\n            while (slt32(skip_threads_29453, 32)) {\n                if (sle32(skip_threads_29453, local_tid_29441 -\n                          squot32(local_tid_29441, 32) * 32) &&\n                    (squot32(local_tid_29441, 32) == 0 &&\n                     ltid_in_bounds_29451)) {\n                    // read operands\n                    {\n                        x_29448 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441) -\n                                                                   sext_i32_i64(skip_threads_29453)];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_29450 = add64(x_29448, x_29449);\n                        \n                        x_29448 = res_29450;\n                    }\n                }\n                if (sle32(wave_sizze_29443, skip_threads_29453)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_29453, local_tid_29441 -\n                          squot32(local_tid_29441, 32) * 32) &&\n                    (squot32(local_tid_29441, 32) == 0 &&\n                     ltid_in_bounds_29451)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] =\n                            x_29448;\n                        x_29449 = x_29448;\n                    }\n                }\n                if (sle32(wa",
                   "ve_sizze_29443, skip_threads_29453)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_29453 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_29441, 32) == 0 || !ltid_in_bounds_29451)) {\n            // read operands\n            {\n                x_26070 = x_26069;\n                x_26069 = ((__local\n                            int64_t *) scan_arr_mem_29445)[sext_i32_i64(squot32(local_tid_29441,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                int64_t res_26071 = add64(x_26069, x_26070);\n                \n                x_26069 = res_26071;\n            }\n            // write final result\n            {\n                ((__local\n                  int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] =\n                    x_26069;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_29441, 32) == 0) {\n            ((__local\n              int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] =\n                x_26070;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_27447, res_25881)) {\n            ((__global int64_t *) mem_28823)[gtid_27447] = ((__local\n                                                             int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_27443\n}\n__kernel void mainziscan_stage3_27347(__global int *global_failure,\n                                      int64_t flat_dim_25598,\n                                      int64_t num_groups_27344, __global\n    ",
                   "                                  unsigned char *mem_28795,\n                                      int32_t num_threads_28980,\n                                      int32_t required_groups_29016)\n{\n    #define segscan_group_sizze_27342 (mainzisegscan_group_sizze_27341)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29017;\n    int32_t local_tid_29018;\n    int64_t group_sizze_29021;\n    int32_t wave_sizze_29020;\n    int32_t group_tid_29019;\n    \n    global_tid_29017 = get_global_id(0);\n    local_tid_29018 = get_local_id(0);\n    group_sizze_29021 = get_local_size(0);\n    wave_sizze_29020 = LOCKSTEP_WIDTH;\n    group_tid_29019 = get_group_id(0);\n    \n    int32_t phys_tid_27347;\n    \n    phys_tid_27347 = global_tid_29017;\n    \n    int32_t phys_group_id_29022;\n    \n    phys_group_id_29022 = get_group_id(0);\n    for (int32_t i_29023 = 0; i_29023 < sdiv_up32(required_groups_29016 -\n                                                  phys_group_id_29022,\n                                                  sext_i64_i32(num_groups_27344));\n         i_29023++) {\n        int32_t virt_group_id_29024 = phys_group_id_29022 + i_29023 *\n                sext_i64_i32(num_groups_27344);\n        int64_t flat_idx_29025 = sext_i32_i64(virt_group_id_29024) *\n                segscan_group_sizze_27342 + sext_i32_i64(local_tid_29018);\n        int64_t gtid_27346 = flat_idx_29025;\n        int64_t orig_group_29026 = squot64(flat_idx_29025,\n                                           segscan_group_sizze_27342 *\n                                           sdiv_up64(flat_dim_25598,\n                                                     sext_i32_i64(num_threads_28980)));\n        int64_t carry_in_flat_idx_29027 = orig_group_29026 *\n                (segscan_group_sizze_27342 * sdiv_up64(flat_dim_25598,\n                                                       sext_i32_i64(num_threads_28980))",
                   ") -\n                1;\n        \n        if (slt64(gtid_27346, flat_dim_25598)) {\n            if (!(orig_group_29026 == 0 || flat_idx_29025 == (orig_group_29026 +\n                                                              1) *\n                  (segscan_group_sizze_27342 * sdiv_up64(flat_dim_25598,\n                                                         sext_i32_i64(num_threads_28980))) -\n                  1)) {\n                int64_t x_25867;\n                int64_t x_25868;\n                \n                x_25867 = ((__global\n                            int64_t *) mem_28795)[carry_in_flat_idx_29027];\n                x_25868 = ((__global int64_t *) mem_28795)[gtid_27346];\n                \n                int64_t res_25869;\n                \n                res_25869 = add64(x_25867, x_25868);\n                x_25867 = res_25869;\n                ((__global int64_t *) mem_28795)[gtid_27346] = x_25867;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_27342\n}\n__kernel void mainziscan_stage3_27380(__global int *global_failure,\n                                      int64_t res_25881,\n                                      int64_t num_groups_27377, __global\n                                      unsigned char *mem_28806, __global\n                                      unsigned char *mem_28808,\n                                      int32_t num_threads_29217,\n                                      int32_t required_groups_29269)\n{\n    #define segscan_group_sizze_27375 (mainzisegscan_group_sizze_27374)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29270;\n    int32_t local_tid_29271;\n    int64_t group_sizze_29274;\n    int32_t wave_sizze_29273;\n    int32_t group_tid_29272;\n    \n    global_tid_29270 = get_global_id(0);\n    local_tid_29271 = get_local_id(",
                   "0);\n    group_sizze_29274 = get_local_size(0);\n    wave_sizze_29273 = LOCKSTEP_WIDTH;\n    group_tid_29272 = get_group_id(0);\n    \n    int32_t phys_tid_27380;\n    \n    phys_tid_27380 = global_tid_29270;\n    \n    int32_t phys_group_id_29275;\n    \n    phys_group_id_29275 = get_group_id(0);\n    for (int32_t i_29276 = 0; i_29276 < sdiv_up32(required_groups_29269 -\n                                                  phys_group_id_29275,\n                                                  sext_i64_i32(num_groups_27377));\n         i_29276++) {\n        int32_t virt_group_id_29277 = phys_group_id_29275 + i_29276 *\n                sext_i64_i32(num_groups_27377);\n        int64_t flat_idx_29278 = sext_i32_i64(virt_group_id_29277) *\n                segscan_group_sizze_27375 + sext_i32_i64(local_tid_29271);\n        int64_t gtid_27379 = flat_idx_29278;\n        int64_t orig_group_29279 = squot64(flat_idx_29278,\n                                           segscan_group_sizze_27375 *\n                                           sdiv_up64(res_25881,\n                                                     sext_i32_i64(num_threads_29217)));\n        int64_t carry_in_flat_idx_29280 = orig_group_29279 *\n                (segscan_group_sizze_27375 * sdiv_up64(res_25881,\n                                                       sext_i32_i64(num_threads_29217))) -\n                1;\n        \n        if (slt64(gtid_27379, res_25881)) {\n            if (!(orig_group_29279 == 0 || flat_idx_29278 == (orig_group_29279 +\n                                                              1) *\n                  (segscan_group_sizze_27375 * sdiv_up64(res_25881,\n                                                         sext_i32_i64(num_threads_29217))) -\n                  1)) {\n                bool x_25900;\n                int64_t x_25901;\n                bool x_25902;\n                int64_t x_25903;\n                \n                x_25900 = ((__global\n                            bool *) mem_28806)[carry_in_flat_idx_29280",
                   "];\n                x_25901 = ((__global\n                            int64_t *) mem_28808)[carry_in_flat_idx_29280];\n                x_25902 = ((__global bool *) mem_28806)[gtid_27379];\n                x_25903 = ((__global int64_t *) mem_28808)[gtid_27379];\n                \n                bool res_25904;\n                \n                res_25904 = x_25900 || x_25902;\n                \n                int64_t res_25905;\n                \n                if (x_25902) {\n                    res_25905 = x_25903;\n                } else {\n                    int64_t res_25906 = add64(x_25901, x_25903);\n                    \n                    res_25905 = res_25906;\n                }\n                x_25900 = res_25904;\n                x_25901 = res_25905;\n                ((__global bool *) mem_28806)[gtid_27379] = x_25900;\n                ((__global int64_t *) mem_28808)[gtid_27379] = x_25901;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_27375\n}\n__kernel void mainziscan_stage3_27388(__global int *global_failure,\n                                      int64_t res_25881,\n                                      int64_t num_groups_27385, __global\n                                      unsigned char *mem_28811, __global\n                                      unsigned char *mem_28813,\n                                      int32_t num_threads_29284,\n                                      int32_t required_groups_29336)\n{\n    #define segscan_group_sizze_27383 (mainzisegscan_group_sizze_27382)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29337;\n    int32_t local_tid_29338;\n    int64_t group_sizze_29341;\n    int32_t wave_sizze_29340;\n    int32_t group_tid_29339;\n    \n    global_tid_29337 = get_global_id(0);\n    local_tid_29338 = get_local_id(0);\n    group_sizze",
                   "_29341 = get_local_size(0);\n    wave_sizze_29340 = LOCKSTEP_WIDTH;\n    group_tid_29339 = get_group_id(0);\n    \n    int32_t phys_tid_27388;\n    \n    phys_tid_27388 = global_tid_29337;\n    \n    int32_t phys_group_id_29342;\n    \n    phys_group_id_29342 = get_group_id(0);\n    for (int32_t i_29343 = 0; i_29343 < sdiv_up32(required_groups_29336 -\n                                                  phys_group_id_29342,\n                                                  sext_i64_i32(num_groups_27385));\n         i_29343++) {\n        int32_t virt_group_id_29344 = phys_group_id_29342 + i_29343 *\n                sext_i64_i32(num_groups_27385);\n        int64_t flat_idx_29345 = sext_i32_i64(virt_group_id_29344) *\n                segscan_group_sizze_27383 + sext_i32_i64(local_tid_29338);\n        int64_t gtid_27387 = flat_idx_29345;\n        int64_t orig_group_29346 = squot64(flat_idx_29345,\n                                           segscan_group_sizze_27383 *\n                                           sdiv_up64(res_25881,\n                                                     sext_i32_i64(num_threads_29284)));\n        int64_t carry_in_flat_idx_29347 = orig_group_29346 *\n                (segscan_group_sizze_27383 * sdiv_up64(res_25881,\n                                                       sext_i32_i64(num_threads_29284))) -\n                1;\n        \n        if (slt64(gtid_27387, res_25881)) {\n            if (!(orig_group_29346 == 0 || flat_idx_29345 == (orig_group_29346 +\n                                                              1) *\n                  (segscan_group_sizze_27383 * sdiv_up64(res_25881,\n                                                         sext_i32_i64(num_threads_29284))) -\n                  1)) {\n                bool x_25939;\n                int64_t x_25940;\n                bool x_25941;\n                int64_t x_25942;\n                \n                x_25939 = ((__global\n                            bool *) mem_28811)[carry_in_flat_idx_29347];\n                ",
                   "x_25940 = ((__global\n                            int64_t *) mem_28813)[carry_in_flat_idx_29347];\n                x_25941 = ((__global bool *) mem_28811)[gtid_27387];\n                x_25942 = ((__global int64_t *) mem_28813)[gtid_27387];\n                \n                bool res_25943;\n                \n                res_25943 = x_25939 || x_25941;\n                \n                int64_t res_25944;\n                \n                if (x_25941) {\n                    res_25944 = x_25942;\n                } else {\n                    int64_t res_25945 = add64(x_25940, x_25942);\n                    \n                    res_25944 = res_25945;\n                }\n                x_25939 = res_25943;\n                x_25940 = res_25944;\n                ((__global bool *) mem_28811)[gtid_27387] = x_25939;\n                ((__global int64_t *) mem_28813)[gtid_27387] = x_25940;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_27383\n}\n__kernel void mainziscan_stage3_27396(__global int *global_failure,\n                                      int64_t res_25881,\n                                      int64_t num_groups_27393, __global\n                                      unsigned char *mem_28818, __global\n                                      unsigned char *mem_28820,\n                                      int32_t num_threads_29351,\n                                      int32_t required_groups_29403)\n{\n    #define segscan_group_sizze_27391 (mainzisegscan_group_sizze_27390)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29404;\n    int32_t local_tid_29405;\n    int64_t group_sizze_29408;\n    int32_t wave_sizze_29407;\n    int32_t group_tid_29406;\n    \n    global_tid_29404 = get_global_id(0);\n    local_tid_29405 = get_local_id(0);\n    group_sizze_29408 = get_local_",
                   "size(0);\n    wave_sizze_29407 = LOCKSTEP_WIDTH;\n    group_tid_29406 = get_group_id(0);\n    \n    int32_t phys_tid_27396;\n    \n    phys_tid_27396 = global_tid_29404;\n    \n    int32_t phys_group_id_29409;\n    \n    phys_group_id_29409 = get_group_id(0);\n    for (int32_t i_29410 = 0; i_29410 < sdiv_up32(required_groups_29403 -\n                                                  phys_group_id_29409,\n                                                  sext_i64_i32(num_groups_27393));\n         i_29410++) {\n        int32_t virt_group_id_29411 = phys_group_id_29409 + i_29410 *\n                sext_i64_i32(num_groups_27393);\n        int64_t flat_idx_29412 = sext_i32_i64(virt_group_id_29411) *\n                segscan_group_sizze_27391 + sext_i32_i64(local_tid_29405);\n        int64_t gtid_27395 = flat_idx_29412;\n        int64_t orig_group_29413 = squot64(flat_idx_29412,\n                                           segscan_group_sizze_27391 *\n                                           sdiv_up64(res_25881,\n                                                     sext_i32_i64(num_threads_29351)));\n        int64_t carry_in_flat_idx_29414 = orig_group_29413 *\n                (segscan_group_sizze_27391 * sdiv_up64(res_25881,\n                                                       sext_i32_i64(num_threads_29351))) -\n                1;\n        \n        if (slt64(gtid_27395, res_25881)) {\n            if (!(orig_group_29413 == 0 || flat_idx_29412 == (orig_group_29413 +\n                                                              1) *\n                  (segscan_group_sizze_27391 * sdiv_up64(res_25881,\n                                                         sext_i32_i64(num_threads_29351))) -\n                  1)) {\n                bool x_25965;\n                float x_25966;\n                bool x_25967;\n                float x_25968;\n                \n                x_25965 = ((__global\n                            bool *) mem_28818)[carry_in_flat_idx_29414];\n                x_25966 = ((__global\n  ",
                   "                          float *) mem_28820)[carry_in_flat_idx_29414];\n                x_25967 = ((__global bool *) mem_28818)[gtid_27395];\n                x_25968 = ((__global float *) mem_28820)[gtid_27395];\n                \n                bool res_25969;\n                \n                res_25969 = x_25965 || x_25967;\n                \n                float res_25970;\n                \n                if (x_25967) {\n                    res_25970 = x_25968;\n                } else {\n                    float res_25971 = x_25966 + x_25968;\n                    \n                    res_25970 = res_25971;\n                }\n                x_25965 = res_25969;\n                x_25966 = res_25970;\n                ((__global bool *) mem_28818)[gtid_27395] = x_25965;\n                ((__global float *) mem_28820)[gtid_27395] = x_25966;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_27391\n}\n__kernel void mainziscan_stage3_27448(__global int *global_failure,\n                                      int64_t res_25881,\n                                      int64_t num_groups_27445, __global\n                                      unsigned char *mem_28823,\n                                      int32_t num_threads_29418,\n                                      int32_t required_groups_29454)\n{\n    #define segscan_group_sizze_27443 (mainzisegscan_group_sizze_27442)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29455;\n    int32_t local_tid_29456;\n    int64_t group_sizze_29459;\n    int32_t wave_sizze_29458;\n    int32_t group_tid_29457;\n    \n    global_tid_29455 = get_global_id(0);\n    local_tid_29456 = get_local_id(0);\n    group_sizze_29459 = get_local_size(0);\n    wave_sizze_29458 = LOCKSTEP_WIDTH;\n    group_tid_29457 = get_group_id(0);\n    \n    int32_t phys_tid",
                   "_27448;\n    \n    phys_tid_27448 = global_tid_29455;\n    \n    int32_t phys_group_id_29460;\n    \n    phys_group_id_29460 = get_group_id(0);\n    for (int32_t i_29461 = 0; i_29461 < sdiv_up32(required_groups_29454 -\n                                                  phys_group_id_29460,\n                                                  sext_i64_i32(num_groups_27445));\n         i_29461++) {\n        int32_t virt_group_id_29462 = phys_group_id_29460 + i_29461 *\n                sext_i64_i32(num_groups_27445);\n        int64_t flat_idx_29463 = sext_i32_i64(virt_group_id_29462) *\n                segscan_group_sizze_27443 + sext_i32_i64(local_tid_29456);\n        int64_t gtid_27447 = flat_idx_29463;\n        int64_t orig_group_29464 = squot64(flat_idx_29463,\n                                           segscan_group_sizze_27443 *\n                                           sdiv_up64(res_25881,\n                                                     sext_i32_i64(num_threads_29418)));\n        int64_t carry_in_flat_idx_29465 = orig_group_29464 *\n                (segscan_group_sizze_27443 * sdiv_up64(res_25881,\n                                                       sext_i32_i64(num_threads_29418))) -\n                1;\n        \n        if (slt64(gtid_27447, res_25881)) {\n            if (!(orig_group_29464 == 0 || flat_idx_29463 == (orig_group_29464 +\n                                                              1) *\n                  (segscan_group_sizze_27443 * sdiv_up64(res_25881,\n                                                         sext_i32_i64(num_threads_29418))) -\n                  1)) {\n                int64_t x_26069;\n                int64_t x_26070;\n                \n                x_26069 = ((__global\n                            int64_t *) mem_28823)[carry_in_flat_idx_29465];\n                x_26070 = ((__global int64_t *) mem_28823)[gtid_27447];\n                \n                int64_t res_26071;\n                \n                res_26071 = add64(x_26069, x_26070);\n          ",
                   "      x_26069 = res_26071;\n                ((__global int64_t *) mem_28823)[gtid_27447] = x_26069;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_27443\n}\n__kernel void mainziseghist_global_27365(__global int *global_failure,\n                                         int64_t flat_dim_25598,\n                                         int64_t res_25881,\n                                         int64_t num_groups_27362, __global\n                                         unsigned char *mem_28795,\n                                         int32_t num_subhistos_29067, __global\n                                         unsigned char *res_subhistos_mem_29068,\n                                         __global\n                                         unsigned char *mainzihist_locks_mem_29138,\n                                         int32_t chk_i_29140,\n                                         int64_t hist_H_chk_29141)\n{\n    #define seghist_group_sizze_27360 (mainziseghist_group_sizze_27359)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29142;\n    int32_t local_tid_29143;\n    int64_t group_sizze_29146;\n    int32_t wave_sizze_29145;\n    int32_t group_tid_29144;\n    \n    global_tid_29142 = get_global_id(0);\n    local_tid_29143 = get_local_id(0);\n    group_sizze_29146 = get_local_size(0);\n    wave_sizze_29145 = LOCKSTEP_WIDTH;\n    group_tid_29144 = get_group_id(0);\n    \n    int32_t phys_tid_27365;\n    \n    phys_tid_27365 = global_tid_29142;\n    \n    int32_t subhisto_ind_29147;\n    \n    subhisto_ind_29147 = squot32(global_tid_29142,\n                                 sdiv_up32(sext_i64_i32(seghist_group_sizze_27360 *\n                                           num_groups_27362),\n                                           num_subhistos_29067));\n    for (int64_t i_",
                   "29148 = 0; i_29148 < sdiv_up64(flat_dim_25598 -\n                                                  sext_i32_i64(global_tid_29142),\n                                                  sext_i32_i64(sext_i64_i32(seghist_group_sizze_27360 *\n                                                  num_groups_27362)));\n         i_29148++) {\n        int32_t gtid_27364 = sext_i64_i32(i_29148 *\n                sext_i32_i64(sext_i64_i32(seghist_group_sizze_27360 *\n                num_groups_27362)) + sext_i32_i64(global_tid_29142));\n        \n        if (slt64(i_29148 *\n                  sext_i32_i64(sext_i64_i32(seghist_group_sizze_27360 *\n                  num_groups_27362)) + sext_i32_i64(global_tid_29142),\n                  flat_dim_25598)) {\n            int64_t i_p_o_28675 = add64(-1, gtid_27364);\n            int64_t rot_i_28676 = smod64(i_p_o_28675, flat_dim_25598);\n            bool cond_27371 = gtid_27364 == 0;\n            int64_t res_27372;\n            \n            if (cond_27371) {\n                res_27372 = 0;\n            } else {\n                int64_t x_27370 = ((__global int64_t *) mem_28795)[rot_i_28676];\n                \n                res_27372 = x_27370;\n            }\n            // save map-out results\n            { }\n            // perform atomic updates\n            {\n                if (sle64(sext_i32_i64(chk_i_29140) * hist_H_chk_29141,\n                          res_27372) && (slt64(res_27372,\n                                               sext_i32_i64(chk_i_29140) *\n                                               hist_H_chk_29141 +\n                                               hist_H_chk_29141) &&\n                                         slt64(res_27372, res_25881))) {\n                    int64_t x_27366;\n                    int64_t x_27367;\n                    \n                    x_27367 = gtid_27364;\n                    \n                    int32_t old_29149;\n                    volatile bool continue_29150;\n                    \n                    continue_2",
                   "9150 = 1;\n                    while (continue_29150) {\n                        old_29149 =\n                            atomic_cmpxchg_i32_global(&((volatile __global\n                                                         int *) mainzihist_locks_mem_29138)[srem64(sext_i32_i64(subhisto_ind_29147) *\n                                                                                                   res_25881 +\n                                                                                                   res_27372,\n                                                                                                   100151)],\n                                                      0, 1);\n                        if (old_29149 == 0) {\n                            int64_t x_27366;\n                            \n                            // bind lhs\n                            {\n                                x_27366 = ((volatile __global\n                                            int64_t *) res_subhistos_mem_29068)[sext_i32_i64(subhisto_ind_29147) *\n                                                                                res_25881 +\n                                                                                res_27372];\n                            }\n                            // execute operation\n                            {\n                                int64_t res_27368 = smax64(x_27366, x_27367);\n                                \n                                x_27366 = res_27368;\n                            }\n                            // update global result\n                            {\n                                ((volatile __global\n                                  int64_t *) res_subhistos_mem_29068)[sext_i32_i64(subhisto_ind_29147) *\n                                                                      res_25881 +\n                                                                      res_27372] =\n                                    x_27366;\n      ",
                   "                      }\n                            mem_fence_global();\n                            old_29149 =\n                                atomic_cmpxchg_i32_global(&((volatile __global\n                                                             int *) mainzihist_locks_mem_29138)[srem64(sext_i32_i64(subhisto_ind_29147) *\n                                                                                                       res_25881 +\n                                                                                                       res_27372,\n                                                                                                       100151)],\n                                                          1, 0);\n                            continue_29150 = 0;\n                        }\n                        mem_fence_global();\n                    }\n                }\n            }\n        }\n    }\n    \n  error_0:\n    return;\n    #undef seghist_group_sizze_27360\n}\n__kernel void mainziseghist_local_27365(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *locks_mem_29108_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *subhistogram_local_mem_29106_backing_aligned_1,\n                                        int64_t flat_dim_25598,\n                                        int64_t res_25881, __global\n                                        unsigned char *mem_28795, __global\n                                        unsigned char *res_subhistos_mem_29068,\n                                        int32_t max_group_sizze_29077,\n                                        int64_t num_groups_29078,\n                                        int32_t hist_M_29084,\n                                        int32_t chk_i_29089,\n                                        int64_t num_segments_29090,\n                             ",
                   "           int64_t hist_H_chk_29091,\n                                        int64_t histo_sizze_29092,\n                                        int32_t init_per_thread_29093)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict locks_mem_29108_backing_1 =\n                          (__local volatile\n                           char *) locks_mem_29108_backing_aligned_0;\n    __local volatile char *restrict subhistogram_local_mem_29106_backing_0 =\n                          (__local volatile\n                           char *) subhistogram_local_mem_29106_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29094;\n    int32_t local_tid_29095;\n    int64_t group_sizze_29098;\n    int32_t wave_sizze_29097;\n    int32_t group_tid_29096;\n    \n    global_tid_29094 = get_global_id(0);\n    local_tid_29095 = get_local_id(0);\n    group_sizze_29098 = get_local_size(0);\n    wave_sizze_29097 = LOCKSTEP_WIDTH;\n    group_tid_29096 = get_group_id(0);\n    \n    int32_t phys_tid_27365;\n    \n    phys_tid_27365 = global_tid_29094;\n    \n    int32_t phys_group_id_29099;\n    \n    phys_group_id_29099 = get_group_id(0);\n    for (int32_t i_29100 = 0; i_29100 <\n         sdiv_up32(sext_i64_i32(num_groups_29078 * num_segments_29090) -\n                   phys_group_id_29099, sext_i64_i32(num_groups_29078));\n         i_29100++) {\n        int32_t virt_group_id_29101 = phys_group_id_29099 + i_29100 *\n                sext_i64_i32(num_groups_29078);\n        int32_t flat_segment_id_29102 = squot32(virt_group_id_29101,\n                                                sext_i64_i32(num_groups_29078));\n        int32_t gid_in_segment_29103 = srem32(virt_group_id_29101,\n                                              sext_i64_i32(num_groups_29078));\n        int32_t pgtid_in_segment_29104 = gid_in_segment_29103 *\n                sext_i64_i32(max_group_sizze_29077) + local_tid_29095;\n        int32_t thre",
                   "ads_per_segment_29105 = sext_i64_i32(num_groups_29078 *\n                max_group_sizze_29077);\n        __local char *subhistogram_local_mem_29106;\n        \n        subhistogram_local_mem_29106 = (__local\n                                        char *) subhistogram_local_mem_29106_backing_0;\n        \n        __local char *locks_mem_29108;\n        \n        locks_mem_29108 = (__local char *) locks_mem_29108_backing_1;\n        // All locks start out unlocked\n        {\n            for (int64_t i_29110 = 0; i_29110 < sdiv_up64(hist_M_29084 *\n                                                          hist_H_chk_29091 -\n                                                          sext_i32_i64(local_tid_29095),\n                                                          max_group_sizze_29077);\n                 i_29110++) {\n                ((__local int32_t *) locks_mem_29108)[squot64(i_29110 *\n                                                              max_group_sizze_29077 +\n                                                              sext_i32_i64(local_tid_29095),\n                                                              hist_H_chk_29091) *\n                                                      hist_H_chk_29091 +\n                                                      (i_29110 *\n                                                       max_group_sizze_29077 +\n                                                       sext_i32_i64(local_tid_29095) -\n                                                       squot64(i_29110 *\n                                                               max_group_sizze_29077 +\n                                                               sext_i32_i64(local_tid_29095),\n                                                               hist_H_chk_29091) *\n                                                       hist_H_chk_29091)] = 0;\n            }\n        }\n        \n        int32_t thread_local_subhisto_i_29111;\n        \n        thread_local_subhisto_i_29111",
                   " = srem32(local_tid_29095, hist_M_29084);\n        // initialize histograms in local memory\n        {\n            for (int32_t local_i_29112 = 0; local_i_29112 <\n                 init_per_thread_29093; local_i_29112++) {\n                int32_t j_29113 = local_i_29112 *\n                        sext_i64_i32(max_group_sizze_29077) + local_tid_29095;\n                int32_t j_offset_29114 = hist_M_29084 *\n                        sext_i64_i32(histo_sizze_29092) * gid_in_segment_29103 +\n                        j_29113;\n                int32_t local_subhisto_i_29115 = squot32(j_29113,\n                                                         sext_i64_i32(histo_sizze_29092));\n                int32_t global_subhisto_i_29116 = squot32(j_offset_29114,\n                                                          sext_i64_i32(histo_sizze_29092));\n                \n                if (slt32(j_29113, hist_M_29084 *\n                          sext_i64_i32(histo_sizze_29092))) {\n                    // First subhistogram is initialised from global memory; others with neutral element.\n                    {\n                        if (global_subhisto_i_29116 == 0) {\n                            ((__local\n                              int64_t *) subhistogram_local_mem_29106)[sext_i32_i64(local_subhisto_i_29115) *\n                                                                       hist_H_chk_29091 +\n                                                                       sext_i32_i64(srem32(j_29113,\n                                                                                           sext_i64_i32(histo_sizze_29092)))] =\n                                ((__global\n                                  int64_t *) res_subhistos_mem_29068)[sext_i32_i64(srem32(j_29113,\n                                                                                          sext_i64_i32(histo_sizze_29092))) +\n                                                                      sext_i32_i64(chk_i_29089) *\n         ",
                   "                                                             hist_H_chk_29091];\n                        } else {\n                            ((__local\n                              int64_t *) subhistogram_local_mem_29106)[sext_i32_i64(local_subhisto_i_29115) *\n                                                                       hist_H_chk_29091 +\n                                                                       sext_i32_i64(srem32(j_29113,\n                                                                                           sext_i64_i32(histo_sizze_29092)))] =\n                                0;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_29117 = 0; i_29117 <\n             sdiv_up32(sext_i64_i32(flat_dim_25598) - pgtid_in_segment_29104,\n                       threads_per_segment_29105); i_29117++) {\n            int32_t gtid_27364 = i_29117 * threads_per_segment_29105 +\n                    pgtid_in_segment_29104;\n            int64_t i_p_o_28675 = add64(-1, gtid_27364);\n            int64_t rot_i_28676 = smod64(i_p_o_28675, flat_dim_25598);\n            bool cond_27371 = gtid_27364 == 0;\n            int64_t res_27372;\n            \n            if (cond_27371) {\n                res_27372 = 0;\n            } else {\n                int64_t x_27370 = ((__global int64_t *) mem_28795)[rot_i_28676];\n                \n                res_27372 = x_27370;\n            }\n            if (chk_i_29089 == 0) {\n                // save map-out results\n                { }\n            }\n            // perform atomic updates\n            {\n                if (slt64(res_27372, res_25881) &&\n                    (sle64(sext_i32_i64(chk_i_29089) * hist_H_chk_29091,\n                           res_27372) && slt64(res_27372,\n                                               sext_i32_i64(chk_i_29089) *\n                                               hist_H_chk_29091 +\n                      ",
                   "                         hist_H_chk_29091))) {\n                    int64_t x_27366;\n                    int64_t x_27367;\n                    \n                    x_27367 = gtid_27364;\n                    \n                    int32_t old_29118;\n                    volatile bool continue_29119;\n                    \n                    continue_29119 = 1;\n                    while (continue_29119) {\n                        old_29118 = atomic_cmpxchg_i32_local(&((volatile __local\n                                                                int *) locks_mem_29108)[sext_i32_i64(thread_local_subhisto_i_29111) *\n                                                                                        hist_H_chk_29091 +\n                                                                                        (res_27372 -\n                                                                                         sext_i32_i64(chk_i_29089) *\n                                                                                         hist_H_chk_29091)],\n                                                             0, 1);\n                        if (old_29118 == 0) {\n                            int64_t x_27366;\n                            \n                            // bind lhs\n                            {\n                                x_27366 = ((volatile __local\n                                            int64_t *) subhistogram_local_mem_29106)[sext_i32_i64(thread_local_subhisto_i_29111) *\n                                                                                     hist_H_chk_29091 +\n                                                                                     (res_27372 -\n                                                                                      sext_i32_i64(chk_i_29089) *\n                                                                                      hist_H_chk_29091)];\n                            }\n                            // execute operation\n",
                   "                            {\n                                int64_t res_27368 = smax64(x_27366, x_27367);\n                                \n                                x_27366 = res_27368;\n                            }\n                            // update global result\n                            {\n                                ((volatile __local\n                                  int64_t *) subhistogram_local_mem_29106)[sext_i32_i64(thread_local_subhisto_i_29111) *\n                                                                           hist_H_chk_29091 +\n                                                                           (res_27372 -\n                                                                            sext_i32_i64(chk_i_29089) *\n                                                                            hist_H_chk_29091)] =\n                                    x_27366;\n                            }\n                            mem_fence_local();\n                            old_29118 =\n                                atomic_cmpxchg_i32_local(&((volatile __local\n                                                            int *) locks_mem_29108)[sext_i32_i64(thread_local_subhisto_i_29111) *\n                                                                                    hist_H_chk_29091 +\n                                                                                    (res_27372 -\n                                                                                     sext_i32_i64(chk_i_29089) *\n                                                                                     hist_H_chk_29091)],\n                                                         1, 0);\n                            continue_29119 = 0;\n                        }\n                        mem_fence_local();\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Compact the multiple local memory subhistograms to result ",
                   "in global memory\n        {\n            int64_t trunc_H_29120 = smin64(hist_H_chk_29091, res_25881 -\n                                           sext_i32_i64(chk_i_29089) *\n                                           hist_H_chk_29091);\n            int32_t histo_sizze_29121 = sext_i64_i32(trunc_H_29120);\n            \n            for (int32_t local_i_29122 = 0; local_i_29122 <\n                 init_per_thread_29093; local_i_29122++) {\n                int32_t j_29123 = local_i_29122 *\n                        sext_i64_i32(max_group_sizze_29077) + local_tid_29095;\n                \n                if (slt32(j_29123, histo_sizze_29121)) {\n                    int64_t x_27366;\n                    int64_t x_27367;\n                    \n                    // Read values from subhistogram 0.\n                    {\n                        x_27366 = ((__local\n                                    int64_t *) subhistogram_local_mem_29106)[sext_i32_i64(j_29123)];\n                    }\n                    // Accumulate based on values in other subhistograms.\n                    {\n                        for (int32_t subhisto_id_29124 = 0; subhisto_id_29124 <\n                             hist_M_29084 - 1; subhisto_id_29124++) {\n                            x_27367 = ((__local\n                                        int64_t *) subhistogram_local_mem_29106)[(sext_i32_i64(subhisto_id_29124) +\n                                                                                  1) *\n                                                                                 hist_H_chk_29091 +\n                                                                                 sext_i32_i64(j_29123)];\n                            \n                            int64_t res_27368;\n                            \n                            res_27368 = smax64(x_27366, x_27367);\n                            x_27366 = res_27368;\n                        }\n                    }\n                    // Put final bucket value in glob",
                   "al memory.\n                    {\n                        ((__global\n                          int64_t *) res_subhistos_mem_29068)[srem64(sext_i32_i64(virt_group_id_29101),\n                                                                     num_groups_29078) *\n                                                              res_25881 +\n                                                              (sext_i32_i64(j_29123) +\n                                                               sext_i32_i64(chk_i_29089) *\n                                                               hist_H_chk_29091)] =\n                            x_27366;\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\n__kernel void mainzisegmap_26568(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args, int64_t n_25421,\n                                 float a_25429, float r0_25432, float x_25449,\n                                 float x_25451, float y_25453, float y_25454,\n                                 __global unsigned char *swap_term_mem_28728,\n                                 __global unsigned char *payments_mem_28729,\n                                 __global unsigned char *mem_28742)\n{\n    #define segmap_group_sizze_26634 (mainzisegmap_group_sizze_26570)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28935;\n    int32_t local_tid_28936;\n    int64_t group_sizze_28939;\n    int32_t wave_sizze_28938;\n    int32_t group_tid_28937;\n    \n    global_tid_28935 = get_global_id(0);\n    local_tid_28936 = get_local_id(0);\n    group_sizze_28939 = get_local_size(0);\n    wave_sizze_28938 = LOCKSTEP_WIDTH;\n    group_tid_28937 = get_group_id(0);\n    \n    int32_t phys_tid_26568;\n   ",
                   " \n    phys_tid_26568 = global_tid_28935;\n    \n    int64_t gtid_26567;\n    \n    gtid_26567 = sext_i32_i64(group_tid_28937) * segmap_group_sizze_26634 +\n        sext_i32_i64(local_tid_28936);\n    if (slt64(gtid_26567, n_25421)) {\n        float res_26645 = ((__global float *) swap_term_mem_28728)[gtid_26567];\n        int64_t res_26646 = ((__global\n                              int64_t *) payments_mem_28729)[gtid_26567];\n        bool bounds_invalid_upwards_26648 = slt64(res_26646, 1);\n        bool valid_26649 = !bounds_invalid_upwards_26648;\n        bool range_valid_c_26650;\n        \n        if (!valid_26649) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 0) == -1) {\n                    global_failure_args[0] = 1;\n                    global_failure_args[1] = 2;\n                    global_failure_args[2] = res_26646;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        bool y_26652 = slt64(0, res_26646);\n        bool index_certs_26653;\n        \n        if (!y_26652) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 1) == -1) {\n                    global_failure_args[0] = 0;\n                    global_failure_args[1] = res_26646;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        float binop_y_26654 = sitofp_i64_f32(res_26646);\n        float index_primexp_26655 = res_26645 * binop_y_26654;\n        float negate_arg_26656 = a_25429 * index_primexp_26655;\n        float exp_arg_26657 = 0.0F - negate_arg_26656;\n        float res_26658 = fpow32(2.7182817F, exp_arg_26657);\n        float x_26659 = 1.0F - res_26658;\n        float B_26660 = x_26659 / a_25429;\n        float x_26661 = B_26660 - index_primexp_26655;\n        float x_26662 = y_25453 * x_26661;\n        float A1_26663 = x_26662 / x_25449;\n        float y_26664 = fpow32(B_26660, 2.0F);\n        float x_26665 = x_25451 * y_26664;\n        float A2_26666 = ",
                   "x_26665 / y_25454;\n        float exp_arg_26667 = A1_26663 - A2_26666;\n        float res_26668 = fpow32(2.7182817F, exp_arg_26667);\n        float negate_arg_26669 = r0_25432 * B_26660;\n        float exp_arg_26670 = 0.0F - negate_arg_26669;\n        float res_26671 = fpow32(2.7182817F, exp_arg_26670);\n        float res_26672 = res_26668 * res_26671;\n        float res_26673;\n        float redout_28654 = 0.0F;\n        \n        for (int64_t i_28655 = 0; i_28655 < res_26646; i_28655++) {\n            int64_t index_primexp_28688 = add64(1, i_28655);\n            float res_26678 = sitofp_i64_f32(index_primexp_28688);\n            float res_26679 = res_26645 * res_26678;\n            float negate_arg_26680 = a_25429 * res_26679;\n            float exp_arg_26681 = 0.0F - negate_arg_26680;\n            float res_26682 = fpow32(2.7182817F, exp_arg_26681);\n            float x_26683 = 1.0F - res_26682;\n            float B_26684 = x_26683 / a_25429;\n            float x_26685 = B_26684 - res_26679;\n            float x_26686 = y_25453 * x_26685;\n            float A1_26687 = x_26686 / x_25449;\n            float y_26688 = fpow32(B_26684, 2.0F);\n            float x_26689 = x_25451 * y_26688;\n            float A2_26690 = x_26689 / y_25454;\n            float exp_arg_26691 = A1_26687 - A2_26690;\n            float res_26692 = fpow32(2.7182817F, exp_arg_26691);\n            float negate_arg_26693 = r0_25432 * B_26684;\n            float exp_arg_26694 = 0.0F - negate_arg_26693;\n            float res_26695 = fpow32(2.7182817F, exp_arg_26694);\n            float res_26696 = res_26692 * res_26695;\n            float res_26676 = res_26696 + redout_28654;\n            float redout_tmp_28940 = res_26676;\n            \n            redout_28654 = redout_tmp_28940;\n        }\n        res_26673 = redout_28654;\n        \n        float x_26697 = 1.0F - res_26672;\n        float y_26698 = res_26645 * res_26673;\n        float res_26699 = x_26697 / y_26698;\n        \n        ((__global float *) mem_28742)[gtid_26567] = res",
                   "_26699;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_26634\n}\n__kernel void mainzisegmap_26717(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args, int64_t n_25421,\n                                 float a_25429, float r0_25432, float x_25449,\n                                 float x_25451, float y_25453, float y_25454,\n                                 __global unsigned char *swap_term_mem_28728,\n                                 __global unsigned char *payments_mem_28729,\n                                 __global unsigned char *mem_28751)\n{\n    #define segmap_group_sizze_26783 (mainzisegmap_group_sizze_26719)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28941;\n    int32_t local_tid_28942;\n    int64_t group_sizze_28945;\n    int32_t wave_sizze_28944;\n    int32_t group_tid_28943;\n    \n    global_tid_28941 = get_global_id(0);\n    local_tid_28942 = get_local_id(0);\n    group_sizze_28945 = get_local_size(0);\n    wave_sizze_28944 = LOCKSTEP_WIDTH;\n    group_tid_28943 = get_group_id(0);\n    \n    int32_t phys_tid_26717;\n    \n    phys_tid_26717 = global_tid_28941;\n    \n    int64_t gtid_26716;\n    \n    gtid_26716 = sext_i32_i64(group_tid_28943) * segmap_group_sizze_26783 +\n        sext_i32_i64(local_tid_28942);\n    if (slt64(gtid_26716, n_25421)) {\n        float res_26794 = ((__global float *) swap_term_mem_28728)[gtid_26716];\n        int64_t res_26795 = ((__global\n                              int64_t *) payments_mem_28729)[gtid_26716];\n        bool bounds_invalid_upwards_26797 = slt64(res_26795, 1);\n        bool valid_26798 = !bounds_invalid_upwards_26797;\n        bool range_valid_c_26799;\n        \n        if (!valid_26798) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 2) == -1) {\n        ",
                   "            global_failure_args[0] = 1;\n                    global_failure_args[1] = 2;\n                    global_failure_args[2] = res_26795;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        bool y_26801 = slt64(0, res_26795);\n        bool index_certs_26802;\n        \n        if (!y_26801) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 3) == -1) {\n                    global_failure_args[0] = 0;\n                    global_failure_args[1] = res_26795;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        float binop_y_26803 = sitofp_i64_f32(res_26795);\n        float index_primexp_26804 = res_26794 * binop_y_26803;\n        float negate_arg_26805 = a_25429 * index_primexp_26804;\n        float exp_arg_26806 = 0.0F - negate_arg_26805;\n        float res_26807 = fpow32(2.7182817F, exp_arg_26806);\n        float x_26808 = 1.0F - res_26807;\n        float B_26809 = x_26808 / a_25429;\n        float x_26810 = B_26809 - index_primexp_26804;\n        float x_26811 = y_25453 * x_26810;\n        float A1_26812 = x_26811 / x_25449;\n        float y_26813 = fpow32(B_26809, 2.0F);\n        float x_26814 = x_25451 * y_26813;\n        float A2_26815 = x_26814 / y_25454;\n        float exp_arg_26816 = A1_26812 - A2_26815;\n        float res_26817 = fpow32(2.7182817F, exp_arg_26816);\n        float negate_arg_26818 = r0_25432 * B_26809;\n        float exp_arg_26819 = 0.0F - negate_arg_26818;\n        float res_26820 = fpow32(2.7182817F, exp_arg_26819);\n        float res_26821 = res_26817 * res_26820;\n        float res_26822;\n        float redout_28658 = 0.0F;\n        \n        for (int64_t i_28659 = 0; i_28659 < res_26795; i_28659++) {\n            int64_t index_primexp_28690 = add64(1, i_28659);\n            float res_26827 = sitofp_i64_f32(index_primexp_28690);\n            float res_26828 = res_26794 * res_26827;\n            float negate_arg_26829 = a_25429 * r",
                   "es_26828;\n            float exp_arg_26830 = 0.0F - negate_arg_26829;\n            float res_26831 = fpow32(2.7182817F, exp_arg_26830);\n            float x_26832 = 1.0F - res_26831;\n            float B_26833 = x_26832 / a_25429;\n            float x_26834 = B_26833 - res_26828;\n            float x_26835 = y_25453 * x_26834;\n            float A1_26836 = x_26835 / x_25449;\n            float y_26837 = fpow32(B_26833, 2.0F);\n            float x_26838 = x_25451 * y_26837;\n            float A2_26839 = x_26838 / y_25454;\n            float exp_arg_26840 = A1_26836 - A2_26839;\n            float res_26841 = fpow32(2.7182817F, exp_arg_26840);\n            float negate_arg_26842 = r0_25432 * B_26833;\n            float exp_arg_26843 = 0.0F - negate_arg_26842;\n            float res_26844 = fpow32(2.7182817F, exp_arg_26843);\n            float res_26845 = res_26841 * res_26844;\n            float res_26825 = res_26845 + redout_28658;\n            float redout_tmp_28946 = res_26825;\n            \n            redout_28658 = redout_tmp_28946;\n        }\n        res_26822 = redout_28658;\n        \n        float x_26846 = 1.0F - res_26821;\n        float y_26847 = res_26794 * res_26822;\n        float res_26848 = x_26846 / y_26847;\n        \n        ((__global float *) mem_28751)[gtid_26716] = res_26848;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_26783\n}\n__kernel void mainzisegmap_26992(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args,\n                                 int64_t paths_25424, int64_t steps_25425,\n                                 float a_25429, float b_25430,\n                                 float sigma_25431, float r0_25432,\n                                 float dt_25447, int64_t upper_bound_25533,\n                                 float res_25534, int64_t num_groups_27244,\n                                 __global unsigned char *mem_28765, __global\n      ",
                   "                           unsigned char *mem_28768, __global\n                                 unsigned char *mem_28783)\n{\n    #define segmap_group_sizze_27243 (mainzisegmap_group_sizze_26994)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_28959;\n    int32_t local_tid_28960;\n    int64_t group_sizze_28963;\n    int32_t wave_sizze_28962;\n    int32_t group_tid_28961;\n    \n    global_tid_28959 = get_global_id(0);\n    local_tid_28960 = get_local_id(0);\n    group_sizze_28963 = get_local_size(0);\n    wave_sizze_28962 = LOCKSTEP_WIDTH;\n    group_tid_28961 = get_group_id(0);\n    \n    int32_t phys_tid_26992;\n    \n    phys_tid_26992 = global_tid_28959;\n    \n    int32_t phys_group_id_28964;\n    \n    phys_group_id_28964 = get_group_id(0);\n    for (int32_t i_28965 = 0; i_28965 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(paths_25424,\n                                          segmap_group_sizze_27243)) -\n                   phys_group_id_28964, sext_i64_i32(num_groups_27244));\n         i_28965++) {\n        int32_t virt_group_id_28966 = phys_group_id_28964 + i_28965 *\n                sext_i64_i32(num_groups_27244);\n        int64_t gtid_26991 = sext_i32_i64(virt_group_id_28966) *\n                segmap_group_sizze_27243 + sext_i32_i64(local_tid_28960);\n        \n        if (slt64(gtid_26991, paths_25424)) {\n            for (int64_t i_28967 = 0; i_28967 < steps_25425; i_28967++) {\n                ((__global float *) mem_28768)[phys_tid_26992 + i_28967 *\n                                               (num_groups_27244 *\n                                                segmap_group_sizze_27243)] =\n                    r0_25432;\n            }\n            for (int64_t i_27250 = 0; i_272",
                   "50 < upper_bound_25533; i_27250++) {\n                bool y_27252 = slt64(i_27250, steps_25425);\n                bool index_certs_27253;\n                \n                if (!y_27252) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 4) ==\n                            -1) {\n                            global_failure_args[0] = i_27250;\n                            global_failure_args[1] = steps_25425;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                float shortstep_arg_27254 = ((__global\n                                              float *) mem_28765)[i_27250 *\n                                                                  paths_25424 +\n                                                                  gtid_26991];\n                float shortstep_arg_27255 = ((__global\n                                              float *) mem_28768)[phys_tid_26992 +\n                                                                  i_27250 *\n                                                                  (num_groups_27244 *\n                                                                   segmap_group_sizze_27243)];\n                float y_27256 = b_25430 - shortstep_arg_27255;\n                float x_27257 = a_25429 * y_27256;\n                float x_27258 = dt_25447 * x_27257;\n                float x_27259 = res_25534 * shortstep_arg_27254;\n                float y_27260 = sigma_25431 * x_27259;\n                float delta_r_27261 = x_27258 + y_27260;\n                float res_27262 = shortstep_arg_27255 + delta_r_27261;\n                int64_t i_27263 = add64(1, i_27250);\n                bool x_27264 = sle64(0, i_27263);\n                bool y_27265 = slt64(i_27263, steps_25425);\n                bool bounds_check_27266 = x_27264 && y_27265;\n                bool index_ce",
                   "rts_27267;\n                \n                if (!bounds_check_27266) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 5) ==\n                            -1) {\n                            global_failure_args[0] = i_27263;\n                            global_failure_args[1] = steps_25425;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                ((__global float *) mem_28768)[phys_tid_26992 + i_27263 *\n                                               (num_groups_27244 *\n                                                segmap_group_sizze_27243)] =\n                    res_27262;\n            }\n            for (int64_t i_28969 = 0; i_28969 < steps_25425; i_28969++) {\n                ((__global float *) mem_28783)[i_28969 * paths_25424 +\n                                               gtid_26991] = ((__global\n                                                               float *) mem_28768)[phys_tid_26992 +\n                                                                                   i_28969 *\n                                                                                   (num_groups_27244 *\n                                                                                    segmap_group_sizze_27243)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_27243\n}\n__kernel void mainzisegmap_27090(__global int *global_failure,\n                                 int64_t paths_25424, int64_t steps_25425,\n                                 __global unsigned char *mem_28758, __global\n                                 unsigned char *mem_28762)\n{\n    #define segmap_group_sizze_27198 (mainzisegmap_group_sizze_27093)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;",
                   "\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28953;\n    int32_t local_tid_28954;\n    int64_t group_sizze_28957;\n    int32_t wave_sizze_28956;\n    int32_t group_tid_28955;\n    \n    global_tid_28953 = get_global_id(0);\n    local_tid_28954 = get_local_id(0);\n    group_sizze_28957 = get_local_size(0);\n    wave_sizze_28956 = LOCKSTEP_WIDTH;\n    group_tid_28955 = get_group_id(0);\n    \n    int32_t phys_tid_27090;\n    \n    phys_tid_27090 = global_tid_28953;\n    \n    int64_t gtid_27088;\n    \n    gtid_27088 = squot64(sext_i32_i64(group_tid_28955) *\n                         segmap_group_sizze_27198 +\n                         sext_i32_i64(local_tid_28954), steps_25425);\n    \n    int64_t gtid_27089;\n    \n    gtid_27089 = sext_i32_i64(group_tid_28955) * segmap_group_sizze_27198 +\n        sext_i32_i64(local_tid_28954) - squot64(sext_i32_i64(group_tid_28955) *\n                                                segmap_group_sizze_27198 +\n                                                sext_i32_i64(local_tid_28954),\n                                                steps_25425) * steps_25425;\n    if (slt64(gtid_27088, paths_25424) && slt64(gtid_27089, steps_25425)) {\n        int32_t unsign_arg_27201 = ((__global int32_t *) mem_28758)[gtid_27088];\n        int32_t res_27203 = sext_i64_i32(gtid_27089);\n        int32_t x_27204 = lshr32(res_27203, 16);\n        int32_t x_27205 = res_27203 ^ x_27204;\n        int32_t x_27206 = mul32(73244475, x_27205);\n        int32_t x_27207 = lshr32(x_27206, 16);\n        int32_t x_27208 = x_27206 ^ x_27207;\n        int32_t x_27209 = mul32(73244475, x_27208);\n        int32_t x_27210 = lshr32(x_27209, 16);\n        int32_t x_27211 = x_27209 ^ x_27210;\n        int32_t unsign_arg_27212 = unsign_arg_27201 ^ x_27211;\n        int32_t unsign_arg_27213 = mul32(48271, unsign_arg_27212);\n        int32_t unsign_arg_27214 = umod32(unsign_arg_27213, 2147483647);\n        int32_t unsign_arg_27215 = mul32(48271, unsign_arg_27214);\n        int32",
                   "_t unsign_arg_27216 = umod32(unsign_arg_27215, 2147483647);\n        float res_27217 = uitofp_i32_f32(unsign_arg_27214);\n        float res_27218 = res_27217 / 2.1474836e9F;\n        float res_27219 = uitofp_i32_f32(unsign_arg_27216);\n        float res_27220 = res_27219 / 2.1474836e9F;\n        float res_27221;\n        \n        res_27221 = futrts_log32(res_27218);\n        \n        float res_27222 = -2.0F * res_27221;\n        float res_27223;\n        \n        res_27223 = futrts_sqrt32(res_27222);\n        \n        float res_27224 = 6.2831855F * res_27220;\n        float res_27225;\n        \n        res_27225 = futrts_cos32(res_27224);\n        \n        float res_27226 = res_27223 * res_27225;\n        \n        ((__global float *) mem_28762)[gtid_27088 * steps_25425 + gtid_27089] =\n            res_27226;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_27198\n}\n__kernel void mainzisegmap_27154(__global int *global_failure,\n                                 int64_t paths_25424, __global\n                                 unsigned char *mem_28758)\n{\n    #define segmap_group_sizze_27173 (mainzisegmap_group_sizze_27156)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28948;\n    int32_t local_tid_28949;\n    int64_t group_sizze_28952;\n    int32_t wave_sizze_28951;\n    int32_t group_tid_28950;\n    \n    global_tid_28948 = get_global_id(0);\n    local_tid_28949 = get_local_id(0);\n    group_sizze_28952 = get_local_size(0);\n    wave_sizze_28951 = LOCKSTEP_WIDTH;\n    group_tid_28950 = get_group_id(0);\n    \n    int32_t phys_tid_27154;\n    \n    phys_tid_27154 = global_tid_28948;\n    \n    int64_t gtid_27153;\n    \n    gtid_27153 = sext_i32_i64(group_tid_28950) * segmap_group_sizze_27173 +\n        sext_i32_i64(local_tid_28949);\n    if (slt64(gtid_27153, paths_25424)) {\n        int32_t res_27177 = sext_i64_i32(gtid_27153);\n        int32_t x_27178 = lshr32(res_2",
                   "7177, 16);\n        int32_t x_27179 = res_27177 ^ x_27178;\n        int32_t x_27180 = mul32(73244475, x_27179);\n        int32_t x_27181 = lshr32(x_27180, 16);\n        int32_t x_27182 = x_27180 ^ x_27181;\n        int32_t x_27183 = mul32(73244475, x_27182);\n        int32_t x_27184 = lshr32(x_27183, 16);\n        int32_t x_27185 = x_27183 ^ x_27184;\n        int32_t unsign_arg_27186 = 777822902 ^ x_27185;\n        int32_t unsign_arg_27187 = mul32(48271, unsign_arg_27186);\n        int32_t unsign_arg_27188 = umod32(unsign_arg_27187, 2147483647);\n        \n        ((__global int32_t *) mem_28758)[gtid_27153] = unsign_arg_27188;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_27173\n}\n__kernel void mainzisegmap_27450(__global int *global_failure,\n                                 int64_t res_25881, int64_t num_segments_26075,\n                                 __global unsigned char *mem_28815, __global\n                                 unsigned char *mem_28820, __global\n                                 unsigned char *mem_28823, __global\n                                 unsigned char *mem_28825)\n{\n    #define segmap_group_sizze_27453 (mainzisegmap_group_sizze_27452)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29475;\n    int32_t local_tid_29476;\n    int64_t group_sizze_29479;\n    int32_t wave_sizze_29478;\n    int32_t group_tid_29477;\n    \n    global_tid_29475 = get_global_id(0);\n    local_tid_29476 = get_local_id(0);\n    group_sizze_29479 = get_local_size(0);\n    wave_sizze_29478 = LOCKSTEP_WIDTH;\n    group_tid_29477 = get_group_id(0);\n    \n    int32_t phys_tid_27450;\n    \n    phys_tid_27450 = global_tid_29475;\n    \n    int64_t write_i_27449;\n    \n    write_i_27449 = sext_i32_i64(group_tid_29477) * segmap_group_sizze_27453 +\n        sext_i32_i64(local_tid_29476);\n    if (slt64(write_i_27449, res_25881)) {\n        int64_t i_p_o_28683 = add64(",
                   "1, write_i_27449);\n        int64_t rot_i_28684 = smod64(i_p_o_28683, res_25881);\n        bool x_26088 = ((__global bool *) mem_28815)[rot_i_28684];\n        float write_value_26089 = ((__global float *) mem_28820)[write_i_27449];\n        int64_t res_26090;\n        \n        if (x_26088) {\n            int64_t x_26087 = ((__global int64_t *) mem_28823)[write_i_27449];\n            int64_t res_26091 = sub64(x_26087, 1);\n            \n            res_26090 = res_26091;\n        } else {\n            res_26090 = -1;\n        }\n        if (sle64(0, res_26090) && slt64(res_26090, num_segments_26075)) {\n            ((__global float *) mem_28825)[res_26090] = write_value_26089;\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_27453\n}\n__kernel void mainzisegmap_27488(__global int *global_failure, int64_t n_25421,\n                                 int64_t paths_25424, __global\n                                 unsigned char *mem_28835, __global\n                                 unsigned char *mem_28838)\n{\n    #define segmap_group_sizze_27567 (mainzisegmap_group_sizze_27490)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29511;\n    int32_t local_tid_29512;\n    int64_t group_sizze_29515;\n    int32_t wave_sizze_29514;\n    int32_t group_tid_29513;\n    \n    global_tid_29511 = get_global_id(0);\n    local_tid_29512 = get_local_id(0);\n    group_sizze_29515 = get_local_size(0);\n    wave_sizze_29514 = LOCKSTEP_WIDTH;\n    group_tid_29513 = get_group_id(0);\n    \n    int32_t phys_tid_27488;\n    \n    phys_tid_27488 = global_tid_29511;\n    \n    int64_t gtid_27487;\n    \n    gtid_27487 = sext_i32_i64(group_tid_29513) * segmap_group_sizze_27567 +\n        sext_i32_i64(local_tid_29512);\n    if (slt64(gtid_27487, paths_25424)) {\n        float res_27571;\n        float redout_28724 = 0.0F;\n        \n        for (int64_t i_28725 = 0; i_28725 < n_25421; i_28725++",
                   ") {\n            float x_27575 = ((__global float *) mem_28835)[i_28725 *\n                                                           paths_25424 +\n                                                           gtid_27487];\n            float res_27574 = x_27575 + redout_28724;\n            float redout_tmp_29516 = res_27574;\n            \n            redout_28724 = redout_tmp_29516;\n        }\n        res_27571 = redout_28724;\n        \n        float res_27576 = fmax32(0.0F, res_27571);\n        \n        ((__global float *) mem_28838)[gtid_27487] = res_27576;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_27567\n}\n__kernel void mainzisegmap_27513(__global int *global_failure,\n                                 int64_t paths_25424, __global\n                                 unsigned char *mem_28841, __global\n                                 unsigned char *mem_28844)\n{\n    #define segmap_group_sizze_27589 (mainzisegmap_group_sizze_27515)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29577;\n    int32_t local_tid_29578;\n    int64_t group_sizze_29581;\n    int32_t wave_sizze_29580;\n    int32_t group_tid_29579;\n    \n    global_tid_29577 = get_global_id(0);\n    local_tid_29578 = get_local_id(0);\n    group_sizze_29581 = get_local_size(0);\n    wave_sizze_29580 = LOCKSTEP_WIDTH;\n    group_tid_29579 = get_group_id(0);\n    \n    int32_t phys_tid_27513;\n    \n    phys_tid_27513 = global_tid_29577;\n    \n    int64_t gtid_27512;\n    \n    gtid_27512 = sext_i32_i64(group_tid_29579) * segmap_group_sizze_27589 +\n        sext_i32_i64(local_tid_29578);\n    if (slt64(gtid_27512, paths_25424)) {\n        float res_27592 = ((__global float *) mem_28841)[gtid_27512];\n        float res_27593 = fmax32(0.0F, res_27592);\n        \n        ((__global float *) mem_28844)[gtid_27512] = res_27593;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_27589\n}\n__kernel",
                   " void mainzisegred_large_27529(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *sync_arr_mem_29554_backing_aligned_0,\n                                       __local volatile\n                                       int64_t *red_arr_mem_29552_backing_aligned_1,\n                                       int64_t n_25421,\n                                       int64_t num_groups_27580, __global\n                                       unsigned char *mem_28825, __global\n                                       unsigned char *mem_28841,\n                                       int64_t groups_per_segment_29538,\n                                       int64_t elements_per_thread_29539,\n                                       int64_t virt_num_groups_29540,\n                                       int64_t threads_per_segment_29542,\n                                       __global\n                                       unsigned char *group_res_arr_mem_29543,\n                                       __global\n                                       unsigned char *mainzicounter_mem_29545)\n{\n    #define segred_group_sizze_27579 (mainzisegred_group_sizze_27523)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict sync_arr_mem_29554_backing_1 =\n                          (__local volatile\n                           char *) sync_arr_mem_29554_backing_aligned_0;\n    __local volatile char *restrict red_arr_mem_29552_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_29552_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29547;\n    int32_t local_tid_29548;\n    int64_t group_sizze_29551;\n    int32_t wave_sizze_29550;\n    int32_t group_tid_29549;\n    \n    global_tid_29547 = get_global_id(0);\n    local_tid_29548 = get_local_id(0);\n    group_sizze_295",
                   "51 = get_local_size(0);\n    wave_sizze_29550 = LOCKSTEP_WIDTH;\n    group_tid_29549 = get_group_id(0);\n    \n    int32_t phys_tid_27529;\n    \n    phys_tid_27529 = global_tid_29547;\n    \n    __local char *red_arr_mem_29552;\n    \n    red_arr_mem_29552 = (__local char *) red_arr_mem_29552_backing_0;\n    \n    __local char *sync_arr_mem_29554;\n    \n    sync_arr_mem_29554 = (__local char *) sync_arr_mem_29554_backing_1;\n    \n    int32_t phys_group_id_29556;\n    \n    phys_group_id_29556 = get_group_id(0);\n    for (int32_t i_29557 = 0; i_29557 <\n         sdiv_up32(sext_i64_i32(virt_num_groups_29540) - phys_group_id_29556,\n                   sext_i64_i32(num_groups_27580)); i_29557++) {\n        int32_t virt_group_id_29558 = phys_group_id_29556 + i_29557 *\n                sext_i64_i32(num_groups_27580);\n        int32_t flat_segment_id_29559 = squot32(virt_group_id_29558,\n                                                sext_i64_i32(groups_per_segment_29538));\n        int64_t global_tid_29560 = srem64(sext_i32_i64(virt_group_id_29558) *\n                                          segred_group_sizze_27579 +\n                                          sext_i32_i64(local_tid_29548),\n                                          segred_group_sizze_27579 *\n                                          groups_per_segment_29538);\n        int64_t gtid_27520 = sext_i32_i64(flat_segment_id_29559);\n        int64_t gtid_27528;\n        float x_acc_29561;\n        int64_t chunk_sizze_29562;\n        \n        chunk_sizze_29562 = smin64(elements_per_thread_29539,\n                                   sdiv_up64(n_25421 -\n                                             sext_i32_i64(sext_i64_i32(global_tid_29560)),\n                                             threads_per_segment_29542));\n        \n        float x_27583;\n        float x_27584;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_29561 = 0.0F;\n        }\n        for (int64_t i_29566 = 0; i_29566 < chunk_sizze_29562; i_29566+",
                   "+) {\n            gtid_27528 = sext_i32_i64(sext_i64_i32(global_tid_29560)) +\n                threads_per_segment_29542 * i_29566;\n            // apply map function\n            {\n                int64_t binop_x_28697 = n_25421 * gtid_27520;\n                int64_t new_index_28698 = gtid_27528 + binop_x_28697;\n                float x_27587 = ((__global float *) mem_28825)[new_index_28698];\n                \n                // save map-out results\n                { }\n                // load accumulator\n                {\n                    x_27583 = x_acc_29561;\n                }\n                // load new values\n                {\n                    x_27584 = x_27587;\n                }\n                // apply reduction operator\n                {\n                    float res_27585 = x_27583 + x_27584;\n                    \n                    // store in accumulator\n                    {\n                        x_acc_29561 = res_27585;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_27583 = x_acc_29561;\n            ((__local\n              float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                x_27583;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_29567;\n        int32_t skip_waves_29568;\n        \n        skip_waves_29568 = 1;\n        \n        float x_29563;\n        float x_29564;\n        \n        offset_29567 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_29548,\n                      sext_i64_i32(segred_group_sizze_27579))) {\n                x_29563 = ((__local\n                            float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                        offset_29567)];\n            }\n        }\n        offset_29567 = 1;\n        while (slt32(offset_29567, wave_sizze_29550)) {\n            if (slt32(local_t",
                   "id_29548 + offset_29567,\n                      sext_i64_i32(segred_group_sizze_27579)) &&\n                ((local_tid_29548 - squot32(local_tid_29548, wave_sizze_29550) *\n                  wave_sizze_29550) & (2 * offset_29567 - 1)) == 0) {\n                // read array element\n                {\n                    x_29564 = ((volatile __local\n                                float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                            offset_29567)];\n                }\n                // apply reduction operation\n                {\n                    float res_29565 = x_29563 + x_29564;\n                    \n                    x_29563 = res_29565;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                        x_29563;\n                }\n            }\n            offset_29567 *= 2;\n        }\n        while (slt32(skip_waves_29568,\n                     squot32(sext_i64_i32(segred_group_sizze_27579) +\n                             wave_sizze_29550 - 1, wave_sizze_29550))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_29567 = skip_waves_29568 * wave_sizze_29550;\n            if (slt32(local_tid_29548 + offset_29567,\n                      sext_i64_i32(segred_group_sizze_27579)) &&\n                ((local_tid_29548 - squot32(local_tid_29548, wave_sizze_29550) *\n                  wave_sizze_29550) == 0 && (squot32(local_tid_29548,\n                                                     wave_sizze_29550) & (2 *\n                                                                          skip_waves_29568 -\n                                                                          1)) ==\n                 0)) {\n                // read array element\n                {\n                    x_29564 = ((__local\n                                float *) red_arr_",
                   "mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                            offset_29567)];\n                }\n                // apply reduction operation\n                {\n                    float res_29565 = x_29563 + x_29564;\n                    \n                    x_29563 = res_29565;\n                }\n                // write result of operation\n                {\n                    ((__local\n                      float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                        x_29563;\n                }\n            }\n            skip_waves_29568 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (sext_i32_i64(local_tid_29548) == 0) {\n                x_acc_29561 = x_29563;\n            }\n        }\n        if (groups_per_segment_29538 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_29548 == 0) {\n                    ((__global float *) mem_28841)[gtid_27520] = x_acc_29561;\n                }\n            }\n        } else {\n            int32_t old_counter_29569;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_29548 == 0) {\n                    ((__global\n                      float *) group_res_arr_mem_29543)[sext_i32_i64(virt_group_id_29558) *\n                                                        segred_group_sizze_27579] =\n                        x_acc_29561;\n                    mem_fence_global();\n                    old_counter_29569 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_29545)[sext_i32_i64(srem32(flat_segment_id_29559,\n                                                                                                     10240))],\n                                              (int) ",
                   "1);\n                    ((__local bool *) sync_arr_mem_29554)[0] =\n                        old_counter_29569 == groups_per_segment_29538 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            \n            bool is_last_group_29570;\n            \n            is_last_group_29570 = ((__local bool *) sync_arr_mem_29554)[0];\n            if (is_last_group_29570) {\n                if (local_tid_29548 == 0) {\n                    old_counter_29569 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_29545)[sext_i32_i64(srem32(flat_segment_id_29559,\n                                                                                                     10240))],\n                                              (int) (0 -\n                                                     groups_per_segment_29538));\n                }\n                // read in the per-group-results\n                {\n                    int64_t read_per_thread_29571 =\n                            sdiv_up64(groups_per_segment_29538,\n                                      segred_group_sizze_27579);\n                    \n                    x_27583 = 0.0F;\n                    for (int64_t i_29572 = 0; i_29572 < read_per_thread_29571;\n                         i_29572++) {\n                        int64_t group_res_id_29573 =\n                                sext_i32_i64(local_tid_29548) *\n                                read_per_thread_29571 + i_29572;\n                        int64_t index_of_group_res_29574 =\n                                sext_i32_i64(flat_segment_id_29559) *\n                                groups_per_segment_29538 + group_res_id_29573;\n                        \n                        if (slt64(group_res_id_29573,\n                                  groups_per_segment_29538)) {\n                            x_27584 = ((__global\n                                     ",
                   "   float *) group_res_arr_mem_29543)[index_of_group_res_29574 *\n                                                                          segred_group_sizze_27579];\n                            \n                            float res_27585;\n                            \n                            res_27585 = x_27583 + x_27584;\n                            x_27583 = res_27585;\n                        }\n                    }\n                }\n                ((__local\n                  float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                    x_27583;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n                    int32_t offset_29575;\n                    int32_t skip_waves_29576;\n                    \n                    skip_waves_29576 = 1;\n                    \n                    float x_29563;\n                    float x_29564;\n                    \n                    offset_29575 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_29548,\n                                  sext_i64_i32(segred_group_sizze_27579))) {\n                            x_29563 = ((__local\n                                        float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                                    offset_29575)];\n                        }\n                    }\n                    offset_29575 = 1;\n                    while (slt32(offset_29575, wave_sizze_29550)) {\n                        if (slt32(local_tid_29548 + offset_29575,\n                                  sext_i64_i32(segred_group_sizze_27579)) &&\n                            ((local_tid_29548 - squot32(local_tid_29548,\n                                                        wave_sizze_29550) *\n                              wave_sizze_29550) & (2 * offset_29575 - 1)) ==\n                            0) {\n    ",
                   "                        // read array element\n                            {\n                                x_29564 = ((volatile __local\n                                            float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                                        offset_29575)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_29565 = x_29563 + x_29564;\n                                \n                                x_29563 = res_29565;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                                    x_29563;\n                            }\n                        }\n                        offset_29575 *= 2;\n                    }\n                    while (slt32(skip_waves_29576,\n                                 squot32(sext_i64_i32(segred_group_sizze_27579) +\n                                         wave_sizze_29550 - 1,\n                                         wave_sizze_29550))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_29575 = skip_waves_29576 * wave_sizze_29550;\n                        if (slt32(local_tid_29548 + offset_29575,\n                                  sext_i64_i32(segred_group_sizze_27579)) &&\n                            ((local_tid_29548 - squot32(local_tid_29548,\n                                                        wave_sizze_29550) *\n                              wave_sizze_29550) == 0 &&\n                             (squot32(local_tid_29548, wave_sizze_29550) & (2 *\n                                                                            skip_waves_29576 -\n                                                           ",
                   "                 1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_29564 = ((__local\n                                            float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                                        offset_29575)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_29565 = x_29563 + x_29564;\n                                \n                                x_29563 = res_29565;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                                    x_29563;\n                            }\n                        }\n                        skip_waves_29576 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_29548 == 0) {\n                            ((__global float *) mem_28841)[gtid_27520] =\n                                x_29563;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_27579\n}\n__kernel void mainzisegred_large_29153(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *sync_arr_mem_29191_backing_aligned_0,\n                                       __local volatile\n                                       int64_t *red_arr_mem_29189_backing_aligned_1,\n                                       int64_t res_25881,\n                                     ",
                   "  int64_t num_groups_27362, __global\n                                       unsigned char *mem_28802,\n                                       int32_t num_subhistos_29067, __global\n                                       unsigned char *res_subhistos_mem_29068,\n                                       int64_t groups_per_segment_29175,\n                                       int64_t elements_per_thread_29176,\n                                       int64_t virt_num_groups_29177,\n                                       int64_t threads_per_segment_29179,\n                                       __global\n                                       unsigned char *group_res_arr_mem_29180,\n                                       __global\n                                       unsigned char *mainzicounter_mem_29182)\n{\n    #define seghist_group_sizze_27360 (mainziseghist_group_sizze_27359)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict sync_arr_mem_29191_backing_1 =\n                          (__local volatile\n                           char *) sync_arr_mem_29191_backing_aligned_0;\n    __local volatile char *restrict red_arr_mem_29189_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_29189_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29184;\n    int32_t local_tid_29185;\n    int64_t group_sizze_29188;\n    int32_t wave_sizze_29187;\n    int32_t group_tid_29186;\n    \n    global_tid_29184 = get_global_id(0);\n    local_tid_29185 = get_local_id(0);\n    group_sizze_29188 = get_local_size(0);\n    wave_sizze_29187 = LOCKSTEP_WIDTH;\n    group_tid_29186 = get_group_id(0);\n    \n    int32_t flat_gtid_29153;\n    \n    flat_gtid_29153 = global_tid_29184;\n    \n    __local char *red_arr_mem_29189;\n    \n    red_arr_mem_29189 = (__local char *) red_arr_mem_29189_backing_0;\n    \n    __local char *sync_arr_mem_29191;\n    \n    syn",
                   "c_arr_mem_29191 = (__local char *) sync_arr_mem_29191_backing_1;\n    \n    int32_t phys_group_id_29193;\n    \n    phys_group_id_29193 = get_group_id(0);\n    for (int32_t i_29194 = 0; i_29194 <\n         sdiv_up32(sext_i64_i32(virt_num_groups_29177) - phys_group_id_29193,\n                   sext_i64_i32(num_groups_27362)); i_29194++) {\n        int32_t virt_group_id_29195 = phys_group_id_29193 + i_29194 *\n                sext_i64_i32(num_groups_27362);\n        int32_t flat_segment_id_29196 = squot32(virt_group_id_29195,\n                                                sext_i64_i32(groups_per_segment_29175));\n        int64_t global_tid_29197 = srem64(sext_i32_i64(virt_group_id_29195) *\n                                          seghist_group_sizze_27360 +\n                                          sext_i32_i64(local_tid_29185),\n                                          seghist_group_sizze_27360 *\n                                          groups_per_segment_29175);\n        int64_t bucket_id_29151 = sext_i32_i64(flat_segment_id_29196);\n        int64_t subhistogram_id_29152;\n        int64_t x_acc_29198;\n        int64_t chunk_sizze_29199;\n        \n        chunk_sizze_29199 = smin64(elements_per_thread_29176,\n                                   sdiv_up64(num_subhistos_29067 -\n                                             sext_i32_i64(sext_i64_i32(global_tid_29197)),\n                                             threads_per_segment_29179));\n        \n        int64_t x_27366;\n        int64_t x_27367;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_29198 = 0;\n        }\n        for (int64_t i_29203 = 0; i_29203 < chunk_sizze_29199; i_29203++) {\n            subhistogram_id_29152 =\n                sext_i32_i64(sext_i64_i32(global_tid_29197)) +\n                threads_per_segment_29179 * i_29203;\n            // apply map function\n            {\n                // load accumulator\n                {\n                    x_27366 = x_acc_29198;\n                ",
                   "}\n                // load new values\n                {\n                    x_27367 = ((__global\n                                int64_t *) res_subhistos_mem_29068)[subhistogram_id_29152 *\n                                                                    res_25881 +\n                                                                    bucket_id_29151];\n                }\n                // apply reduction operator\n                {\n                    int64_t res_27368 = smax64(x_27366, x_27367);\n                    \n                    // store in accumulator\n                    {\n                        x_acc_29198 = res_27368;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_27366 = x_acc_29198;\n            ((__local\n              int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                x_27366;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_29204;\n        int32_t skip_waves_29205;\n        \n        skip_waves_29205 = 1;\n        \n        int64_t x_29200;\n        int64_t x_29201;\n        \n        offset_29204 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_29185,\n                      sext_i64_i32(seghist_group_sizze_27360))) {\n                x_29200 = ((__local\n                            int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185 +\n                                                          offset_29204)];\n            }\n        }\n        offset_29204 = 1;\n        while (slt32(offset_29204, wave_sizze_29187)) {\n            if (slt32(local_tid_29185 + offset_29204,\n                      sext_i64_i32(seghist_group_sizze_27360)) &&\n                ((local_tid_29185 - squot32(local_tid_29185, wave_sizze_29187) *\n                  wave_sizze_29187) & (2 * offset_29204 - 1)) == 0) {\n                // read array element\n                {\n   ",
                   "                 x_29201 = ((volatile __local\n                                int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185 +\n                                                              offset_29204)];\n                }\n                // apply reduction operation\n                {\n                    int64_t res_29202 = smax64(x_29200, x_29201);\n                    \n                    x_29200 = res_29202;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                        x_29200;\n                }\n            }\n            offset_29204 *= 2;\n        }\n        while (slt32(skip_waves_29205,\n                     squot32(sext_i64_i32(seghist_group_sizze_27360) +\n                             wave_sizze_29187 - 1, wave_sizze_29187))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_29204 = skip_waves_29205 * wave_sizze_29187;\n            if (slt32(local_tid_29185 + offset_29204,\n                      sext_i64_i32(seghist_group_sizze_27360)) &&\n                ((local_tid_29185 - squot32(local_tid_29185, wave_sizze_29187) *\n                  wave_sizze_29187) == 0 && (squot32(local_tid_29185,\n                                                     wave_sizze_29187) & (2 *\n                                                                          skip_waves_29205 -\n                                                                          1)) ==\n                 0)) {\n                // read array element\n                {\n                    x_29201 = ((__local\n                                int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185 +\n                                                              offset_29204)];\n                }\n                // apply reduction operation\n                {\n                    int64_t res_29202 = smax64(x_29200, x_29201);\n              ",
                   "      \n                    x_29200 = res_29202;\n                }\n                // write result of operation\n                {\n                    ((__local\n                      int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                        x_29200;\n                }\n            }\n            skip_waves_29205 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (sext_i32_i64(local_tid_29185) == 0) {\n                x_acc_29198 = x_29200;\n            }\n        }\n        if (groups_per_segment_29175 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_29185 == 0) {\n                    ((__global int64_t *) mem_28802)[bucket_id_29151] =\n                        x_acc_29198;\n                }\n            }\n        } else {\n            int32_t old_counter_29206;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_29185 == 0) {\n                    ((__global\n                      int64_t *) group_res_arr_mem_29180)[sext_i32_i64(virt_group_id_29195) *\n                                                          seghist_group_sizze_27360] =\n                        x_acc_29198;\n                    mem_fence_global();\n                    old_counter_29206 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_29182)[sext_i32_i64(srem32(flat_segment_id_29196,\n                                                                                                     10240))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_29191)[0] =\n                        old_counter_29206 == groups_per_segment_29175 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_F",
                   "ENCE);\n            \n            bool is_last_group_29207;\n            \n            is_last_group_29207 = ((__local bool *) sync_arr_mem_29191)[0];\n            if (is_last_group_29207) {\n                if (local_tid_29185 == 0) {\n                    old_counter_29206 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) mainzicounter_mem_29182)[sext_i32_i64(srem32(flat_segment_id_29196,\n                                                                                                     10240))],\n                                              (int) (0 -\n                                                     groups_per_segment_29175));\n                }\n                // read in the per-group-results\n                {\n                    int64_t read_per_thread_29208 =\n                            sdiv_up64(groups_per_segment_29175,\n                                      seghist_group_sizze_27360);\n                    \n                    x_27366 = 0;\n                    for (int64_t i_29209 = 0; i_29209 < read_per_thread_29208;\n                         i_29209++) {\n                        int64_t group_res_id_29210 =\n                                sext_i32_i64(local_tid_29185) *\n                                read_per_thread_29208 + i_29209;\n                        int64_t index_of_group_res_29211 =\n                                sext_i32_i64(flat_segment_id_29196) *\n                                groups_per_segment_29175 + group_res_id_29210;\n                        \n                        if (slt64(group_res_id_29210,\n                                  groups_per_segment_29175)) {\n                            x_27367 = ((__global\n                                        int64_t *) group_res_arr_mem_29180)[index_of_group_res_29211 *\n                                                                            seghist_group_sizze_27360];\n                            \n                            int64_t",
                   " res_27368;\n                            \n                            res_27368 = smax64(x_27366, x_27367);\n                            x_27366 = res_27368;\n                        }\n                    }\n                }\n                ((__local\n                  int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                    x_27366;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n                    int32_t offset_29212;\n                    int32_t skip_waves_29213;\n                    \n                    skip_waves_29213 = 1;\n                    \n                    int64_t x_29200;\n                    int64_t x_29201;\n                    \n                    offset_29212 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_29185,\n                                  sext_i64_i32(seghist_group_sizze_27360))) {\n                            x_29200 = ((__local\n                                        int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185 +\n                                                                      offset_29212)];\n                        }\n                    }\n                    offset_29212 = 1;\n                    while (slt32(offset_29212, wave_sizze_29187)) {\n                        if (slt32(local_tid_29185 + offset_29212,\n                                  sext_i64_i32(seghist_group_sizze_27360)) &&\n                            ((local_tid_29185 - squot32(local_tid_29185,\n                                                        wave_sizze_29187) *\n                              wave_sizze_29187) & (2 * offset_29212 - 1)) ==\n                            0) {\n                            // read array element\n                            {\n                                x_29201 = ((volatile __local\n                                            int64_t *) red_arr_mem_2918",
                   "9)[sext_i32_i64(local_tid_29185 +\n                                                                          offset_29212)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t res_29202 = smax64(x_29200, x_29201);\n                                \n                                x_29200 = res_29202;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                                    x_29200;\n                            }\n                        }\n                        offset_29212 *= 2;\n                    }\n                    while (slt32(skip_waves_29213,\n                                 squot32(sext_i64_i32(seghist_group_sizze_27360) +\n                                         wave_sizze_29187 - 1,\n                                         wave_sizze_29187))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_29212 = skip_waves_29213 * wave_sizze_29187;\n                        if (slt32(local_tid_29185 + offset_29212,\n                                  sext_i64_i32(seghist_group_sizze_27360)) &&\n                            ((local_tid_29185 - squot32(local_tid_29185,\n                                                        wave_sizze_29187) *\n                              wave_sizze_29187) == 0 &&\n                             (squot32(local_tid_29185, wave_sizze_29187) & (2 *\n                                                                            skip_waves_29213 -\n                                                                            1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_29201 = ((__local\n",
                   "                                            int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185 +\n                                                                          offset_29212)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t res_29202 = smax64(x_29200, x_29201);\n                                \n                                x_29200 = res_29202;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                                    x_29200;\n                            }\n                        }\n                        skip_waves_29213 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_29185 == 0) {\n                            ((__global int64_t *) mem_28802)[bucket_id_29151] =\n                                x_29200;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef seghist_group_sizze_27360\n}\n__kernel void mainzisegred_nonseg_26564(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_28917_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_28915_backing_aligned_1,\n                                        int64_t n_25421,\n                                        int64_t num_groups_26559, __global\n                                        unsigned char *swap_term_mem_28728,\n                                        __global\n ",
                   "                                       unsigned char *payments_mem_28729,\n                                        __global unsigned char *mem_28733,\n                                        __global\n                                        unsigned char *mainzicounter_mem_28905,\n                                        __global\n                                        unsigned char *group_res_arr_mem_28907,\n                                        int64_t num_threads_28909)\n{\n    #define segred_group_sizze_26557 (mainzisegred_group_sizze_26556)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_28917_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_28917_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_28915_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_28915_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28910;\n    int32_t local_tid_28911;\n    int64_t group_sizze_28914;\n    int32_t wave_sizze_28913;\n    int32_t group_tid_28912;\n    \n    global_tid_28910 = get_global_id(0);\n    local_tid_28911 = get_local_id(0);\n    group_sizze_28914 = get_local_size(0);\n    wave_sizze_28913 = LOCKSTEP_WIDTH;\n    group_tid_28912 = get_group_id(0);\n    \n    int32_t phys_tid_26564;\n    \n    phys_tid_26564 = global_tid_28910;\n    \n    __local char *sync_arr_mem_28915;\n    \n    sync_arr_mem_28915 = (__local char *) sync_arr_mem_28915_backing_0;\n    \n    __local char *red_arr_mem_28917;\n    \n    red_arr_mem_28917 = (__local char *) red_arr_mem_28917_backing_1;\n    \n    int64_t dummy_26562;\n    \n    dummy_26562 = 0;\n    \n    int64_t gtid_26563;\n    \n    gtid_26563 = 0;\n    \n    float x_acc_28919;\n    int64_t chunk_sizze_28920;\n    \n    chunk_sizze_28920 = smin64(sdiv_up64(n_25421,\n                                         sex",
                   "t_i32_i64(sext_i64_i32(segred_group_sizze_26557 *\n                                         num_groups_26559))),\n                               sdiv_up64(n_25421 - sext_i32_i64(phys_tid_26564),\n                                         num_threads_28909));\n    \n    float x_25439;\n    float x_25440;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_28919 = -INFINITY;\n    }\n    for (int64_t i_28924 = 0; i_28924 < chunk_sizze_28920; i_28924++) {\n        gtid_26563 = sext_i32_i64(phys_tid_26564) + num_threads_28909 * i_28924;\n        // apply map function\n        {\n            float x_25442 = ((__global\n                              float *) swap_term_mem_28728)[gtid_26563];\n            int64_t x_25443 = ((__global\n                                int64_t *) payments_mem_28729)[gtid_26563];\n            float res_25444 = sitofp_i64_f32(x_25443);\n            float res_25445 = x_25442 * res_25444;\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_25439 = x_acc_28919;\n            }\n            // load new values\n            {\n                x_25440 = res_25445;\n            }\n            // apply reduction operator\n            {\n                float res_25441 = fmax32(x_25439, x_25440);\n                \n                // store in accumulator\n                {\n                    x_acc_28919 = res_25441;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_25439 = x_acc_28919;\n        ((__local float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911)] =\n            x_25439;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_28925;\n    int32_t skip_waves_28926;\n    \n    skip_waves_28926 = 1;\n    \n    float x_28921;\n    float x_28922;\n    \n    offset_28925 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_28911, sext_i64_i32(segred_group_sizze_26557)))",
                   " {\n            x_28921 = ((__local\n                        float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911 +\n                                                    offset_28925)];\n        }\n    }\n    offset_28925 = 1;\n    while (slt32(offset_28925, wave_sizze_28913)) {\n        if (slt32(local_tid_28911 + offset_28925,\n                  sext_i64_i32(segred_group_sizze_26557)) && ((local_tid_28911 -\n                                                               squot32(local_tid_28911,\n                                                                       wave_sizze_28913) *\n                                                               wave_sizze_28913) &\n                                                              (2 *\n                                                               offset_28925 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_28922 = ((volatile __local\n                            float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911 +\n                                                        offset_28925)];\n            }\n            // apply reduction operation\n            {\n                float res_28923 = fmax32(x_28921, x_28922);\n                \n                x_28921 = res_28923;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911)] =\n                    x_28921;\n            }\n        }\n        offset_28925 *= 2;\n    }\n    while (slt32(skip_waves_28926,\n                 squot32(sext_i64_i32(segred_group_sizze_26557) +\n                         wave_sizze_28913 - 1, wave_sizze_28913))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_28925 = skip_waves_28926 * wave_sizze_28913;\n        if (slt32(local_tid_28911 + offset_28925,\n                  sext_i64_i32(segred_group_sizze_26557)) && ((local_tid_28911 -\n        ",
                   "                                                       squot32(local_tid_28911,\n                                                                       wave_sizze_28913) *\n                                                               wave_sizze_28913) ==\n                                                              0 &&\n                                                              (squot32(local_tid_28911,\n                                                                       wave_sizze_28913) &\n                                                               (2 *\n                                                                skip_waves_28926 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_28922 = ((__local\n                            float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911 +\n                                                        offset_28925)];\n            }\n            // apply reduction operation\n            {\n                float res_28923 = fmax32(x_28921, x_28922);\n                \n                x_28921 = res_28923;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911)] =\n                    x_28921;\n            }\n        }\n        skip_waves_28926 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_28911) == 0) {\n            x_acc_28919 = x_28921;\n        }\n    }\n    \n    int32_t old_counter_28927;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_28911 == 0) {\n            ((__global\n              float *) group_res_arr_mem_28907)[sext_i32_i64(group_tid_28912) *\n                                                segred_group_sizze_26557] =\n                x_acc_28919;\n            mem_fence_global();\n",
                   "            old_counter_28927 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_28905)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_28915)[0] = old_counter_28927 ==\n                num_groups_26559 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_28928;\n    \n    is_last_group_28928 = ((__local bool *) sync_arr_mem_28915)[0];\n    if (is_last_group_28928) {\n        if (local_tid_28911 == 0) {\n            old_counter_28927 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_28905)[0],\n                                                      (int) (0 -\n                                                             num_groups_26559));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_28929 = sdiv_up64(num_groups_26559,\n                                                      segred_group_sizze_26557);\n            \n            x_25439 = -INFINITY;\n            for (int64_t i_28930 = 0; i_28930 < read_per_thread_28929;\n                 i_28930++) {\n                int64_t group_res_id_28931 = sext_i32_i64(local_tid_28911) *\n                        read_per_thread_28929 + i_28930;\n                int64_t index_of_group_res_28932 = group_res_id_28931;\n                \n                if (slt64(group_res_id_28931, num_groups_26559)) {\n                    x_25440 = ((__global\n                                float *) group_res_arr_mem_28907)[index_of_group_res_28932 *\n                                                                  segred_group_sizze_26557];\n                    \n                    float res_25441;\n                    \n                    res_25441 = fmax32(x_25439, x_25440);\n                    x_25439 = res_25441;\n                }\n            }\n     ",
                   "   }\n        ((__local float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911)] =\n            x_25439;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_28933;\n            int32_t skip_waves_28934;\n            \n            skip_waves_28934 = 1;\n            \n            float x_28921;\n            float x_28922;\n            \n            offset_28933 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_28911,\n                          sext_i64_i32(segred_group_sizze_26557))) {\n                    x_28921 = ((__local\n                                float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911 +\n                                                            offset_28933)];\n                }\n            }\n            offset_28933 = 1;\n            while (slt32(offset_28933, wave_sizze_28913)) {\n                if (slt32(local_tid_28911 + offset_28933,\n                          sext_i64_i32(segred_group_sizze_26557)) &&\n                    ((local_tid_28911 - squot32(local_tid_28911,\n                                                wave_sizze_28913) *\n                      wave_sizze_28913) & (2 * offset_28933 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_28922 = ((volatile __local\n                                    float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911 +\n                                                                offset_28933)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_28923 = fmax32(x_28921, x_28922);\n                        \n                        x_28921 = res_28923;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_28917)[sext_i32_i64(l",
                   "ocal_tid_28911)] =\n                            x_28921;\n                    }\n                }\n                offset_28933 *= 2;\n            }\n            while (slt32(skip_waves_28934,\n                         squot32(sext_i64_i32(segred_group_sizze_26557) +\n                                 wave_sizze_28913 - 1, wave_sizze_28913))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_28933 = skip_waves_28934 * wave_sizze_28913;\n                if (slt32(local_tid_28911 + offset_28933,\n                          sext_i64_i32(segred_group_sizze_26557)) &&\n                    ((local_tid_28911 - squot32(local_tid_28911,\n                                                wave_sizze_28913) *\n                      wave_sizze_28913) == 0 && (squot32(local_tid_28911,\n                                                         wave_sizze_28913) &\n                                                 (2 * skip_waves_28934 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_28922 = ((__local\n                                    float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911 +\n                                                                offset_28933)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_28923 = fmax32(x_28921, x_28922);\n                        \n                        x_28921 = res_28923;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_28917)[sext_i32_i64(local_tid_28911)] =\n                            x_28921;\n                    }\n                }\n                skip_waves_28934 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_28911 == 0) {\n                    ((__global float *) mem_28733)[0] = x",
                   "_28921;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_26557\n}\n__kernel void mainzisegred_nonseg_27357(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_29040_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_29038_backing_aligned_1,\n                                        int64_t flat_dim_25598,\n                                        int64_t num_groups_27352, __global\n                                        unsigned char *mem_28797, __global\n                                        unsigned char *mem_28800, __global\n                                        unsigned char *mainzicounter_mem_29028,\n                                        __global\n                                        unsigned char *group_res_arr_mem_29030,\n                                        int64_t num_threads_29032)\n{\n    #define segred_group_sizze_27350 (mainzisegred_group_sizze_27349)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_29040_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_29040_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_29038_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_29038_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29033;\n    int32_t local_tid_29034;\n    int64_t group_sizze_29037;\n    int32_t wave_sizze_29036;\n    int32_t group_tid_29035;\n    \n    global_tid_29033 = get_global_id(0);\n    local_tid_29034 = get_local_id(0);\n    group_sizze_29037 = get_local_size(0);\n    wave_sizze_29036 = LOCKSTEP_WIDTH;\n    group_tid_29035 = get_group_id(0);\n    \n    int",
                   "32_t phys_tid_27357;\n    \n    phys_tid_27357 = global_tid_29033;\n    \n    __local char *sync_arr_mem_29038;\n    \n    sync_arr_mem_29038 = (__local char *) sync_arr_mem_29038_backing_0;\n    \n    __local char *red_arr_mem_29040;\n    \n    red_arr_mem_29040 = (__local char *) red_arr_mem_29040_backing_1;\n    \n    int64_t dummy_27355;\n    \n    dummy_27355 = 0;\n    \n    int64_t gtid_27356;\n    \n    gtid_27356 = 0;\n    \n    int64_t x_acc_29042;\n    int64_t chunk_sizze_29043;\n    \n    chunk_sizze_29043 = smin64(sdiv_up64(flat_dim_25598,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_27350 *\n                                         num_groups_27352))),\n                               sdiv_up64(flat_dim_25598 -\n                                         sext_i32_i64(phys_tid_27357),\n                                         num_threads_29032));\n    \n    int64_t x_25882;\n    int64_t x_25883;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_29042 = 0;\n    }\n    for (int64_t i_29047 = 0; i_29047 < chunk_sizze_29043; i_29047++) {\n        gtid_27356 = sext_i32_i64(phys_tid_27357) + num_threads_29032 * i_29047;\n        // apply map function\n        {\n            int64_t x_25885 = ((__global int64_t *) mem_28797)[gtid_27356];\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_25882 = x_acc_29042;\n            }\n            // load new values\n            {\n                x_25883 = x_25885;\n            }\n            // apply reduction operator\n            {\n                int64_t res_25884 = add64(x_25882, x_25883);\n                \n                // store in accumulator\n                {\n                    x_acc_29042 = res_25884;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_25882 = x_acc_29042;\n        ((__local int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_290",
                   "34)] =\n            x_25882;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_29048;\n    int32_t skip_waves_29049;\n    \n    skip_waves_29049 = 1;\n    \n    int64_t x_29044;\n    int64_t x_29045;\n    \n    offset_29048 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_29034, sext_i64_i32(segred_group_sizze_27350))) {\n            x_29044 = ((__local\n                        int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                      offset_29048)];\n        }\n    }\n    offset_29048 = 1;\n    while (slt32(offset_29048, wave_sizze_29036)) {\n        if (slt32(local_tid_29034 + offset_29048,\n                  sext_i64_i32(segred_group_sizze_27350)) && ((local_tid_29034 -\n                                                               squot32(local_tid_29034,\n                                                                       wave_sizze_29036) *\n                                                               wave_sizze_29036) &\n                                                              (2 *\n                                                               offset_29048 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_29045 = ((volatile __local\n                            int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                          offset_29048)];\n            }\n            // apply reduction operation\n            {\n                int64_t res_29046 = add64(x_29044, x_29045);\n                \n                x_29044 = res_29046;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n                    x_29044;\n            }\n        }\n        offset_29048 *= 2;\n    }\n    while (slt32(skip_waves",
                   "_29049,\n                 squot32(sext_i64_i32(segred_group_sizze_27350) +\n                         wave_sizze_29036 - 1, wave_sizze_29036))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_29048 = skip_waves_29049 * wave_sizze_29036;\n        if (slt32(local_tid_29034 + offset_29048,\n                  sext_i64_i32(segred_group_sizze_27350)) && ((local_tid_29034 -\n                                                               squot32(local_tid_29034,\n                                                                       wave_sizze_29036) *\n                                                               wave_sizze_29036) ==\n                                                              0 &&\n                                                              (squot32(local_tid_29034,\n                                                                       wave_sizze_29036) &\n                                                               (2 *\n                                                                skip_waves_29049 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_29045 = ((__local\n                            int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                          offset_29048)];\n            }\n            // apply reduction operation\n            {\n                int64_t res_29046 = add64(x_29044, x_29045);\n                \n                x_29044 = res_29046;\n            }\n            // write result of operation\n            {\n                ((__local\n                  int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n                    x_29044;\n            }\n        }\n        skip_waves_29049 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_29034) == 0) {\n            x_acc_29042 = x_29044;\n        }\n    }\n ",
                   "   \n    int32_t old_counter_29050;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_29034 == 0) {\n            ((__global\n              int64_t *) group_res_arr_mem_29030)[sext_i32_i64(group_tid_29035) *\n                                                  segred_group_sizze_27350] =\n                x_acc_29042;\n            mem_fence_global();\n            old_counter_29050 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_29028)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_29038)[0] = old_counter_29050 ==\n                num_groups_27352 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_29051;\n    \n    is_last_group_29051 = ((__local bool *) sync_arr_mem_29038)[0];\n    if (is_last_group_29051) {\n        if (local_tid_29034 == 0) {\n            old_counter_29050 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_29028)[0],\n                                                      (int) (0 -\n                                                             num_groups_27352));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_29052 = sdiv_up64(num_groups_27352,\n                                                      segred_group_sizze_27350);\n            \n            x_25882 = 0;\n            for (int64_t i_29053 = 0; i_29053 < read_per_thread_29052;\n                 i_29053++) {\n                int64_t group_res_id_29054 = sext_i32_i64(local_tid_29034) *\n                        read_per_thread_29052 + i_29053;\n                int64_t index_of_group_res_29055 = group_res_id_29054;\n                \n                if (slt64(group_res_id_29054, num_groups_27352)) {\n                    x_25883 = ((__global\n                  ",
                   "              int64_t *) group_res_arr_mem_29030)[index_of_group_res_29055 *\n                                                                    segred_group_sizze_27350];\n                    \n                    int64_t res_25884;\n                    \n                    res_25884 = add64(x_25882, x_25883);\n                    x_25882 = res_25884;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n            x_25882;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_29056;\n            int32_t skip_waves_29057;\n            \n            skip_waves_29057 = 1;\n            \n            int64_t x_29044;\n            int64_t x_29045;\n            \n            offset_29056 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_29034,\n                          sext_i64_i32(segred_group_sizze_27350))) {\n                    x_29044 = ((__local\n                                int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                              offset_29056)];\n                }\n            }\n            offset_29056 = 1;\n            while (slt32(offset_29056, wave_sizze_29036)) {\n                if (slt32(local_tid_29034 + offset_29056,\n                          sext_i64_i32(segred_group_sizze_27350)) &&\n                    ((local_tid_29034 - squot32(local_tid_29034,\n                                                wave_sizze_29036) *\n                      wave_sizze_29036) & (2 * offset_29056 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_29045 = ((volatile __local\n                                    int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                                  offset_29056)];\n                    }\n           ",
                   "         // apply reduction operation\n                    {\n                        int64_t res_29046 = add64(x_29044, x_29045);\n                        \n                        x_29044 = res_29046;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n                            x_29044;\n                    }\n                }\n                offset_29056 *= 2;\n            }\n            while (slt32(skip_waves_29057,\n                         squot32(sext_i64_i32(segred_group_sizze_27350) +\n                                 wave_sizze_29036 - 1, wave_sizze_29036))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_29056 = skip_waves_29057 * wave_sizze_29036;\n                if (slt32(local_tid_29034 + offset_29056,\n                          sext_i64_i32(segred_group_sizze_27350)) &&\n                    ((local_tid_29034 - squot32(local_tid_29034,\n                                                wave_sizze_29036) *\n                      wave_sizze_29036) == 0 && (squot32(local_tid_29034,\n                                                         wave_sizze_29036) &\n                                                 (2 * skip_waves_29057 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_29045 = ((__local\n                                    int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                                  offset_29056)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t res_29046 = add64(x_29044, x_29045);\n                        \n                        x_29044 = res_29046;\n                    }\n                    // write result of operation\n                    {\n            ",
                   "            ((__local\n                          int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n                            x_29044;\n                    }\n                }\n                skip_waves_29057 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_29034 == 0) {\n                    ((__global int64_t *) mem_28800)[0] = x_29044;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_27350\n}\n__kernel void mainzisegred_nonseg_27466(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_29492_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_29490_backing_aligned_1,\n                                        int64_t n_25421, int64_t paths_25424,\n                                        int64_t num_groups_27469, __global\n                                        unsigned char *mem_28829, __global\n                                        unsigned char *mem_28832, __global\n                                        unsigned char *mainzicounter_mem_29480,\n                                        __global\n                                        unsigned char *group_res_arr_mem_29482,\n                                        int64_t num_threads_29484)\n{\n    #define segred_group_sizze_27468 (mainzisegred_group_sizze_27458)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_29492_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_29492_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_29490_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_29490_backing_aligne",
                   "d_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29485;\n    int32_t local_tid_29486;\n    int64_t group_sizze_29489;\n    int32_t wave_sizze_29488;\n    int32_t group_tid_29487;\n    \n    global_tid_29485 = get_global_id(0);\n    local_tid_29486 = get_local_id(0);\n    group_sizze_29489 = get_local_size(0);\n    wave_sizze_29488 = LOCKSTEP_WIDTH;\n    group_tid_29487 = get_group_id(0);\n    \n    int32_t phys_tid_27466;\n    \n    phys_tid_27466 = global_tid_29485;\n    \n    __local char *sync_arr_mem_29490;\n    \n    sync_arr_mem_29490 = (__local char *) sync_arr_mem_29490_backing_0;\n    \n    __local char *red_arr_mem_29492;\n    \n    red_arr_mem_29492 = (__local char *) red_arr_mem_29492_backing_1;\n    \n    int64_t dummy_27464;\n    \n    dummy_27464 = 0;\n    \n    int64_t gtid_27465;\n    \n    gtid_27465 = 0;\n    \n    float x_acc_29494;\n    int64_t chunk_sizze_29495;\n    \n    chunk_sizze_29495 = smin64(sdiv_up64(paths_25424,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_27468 *\n                                         num_groups_27469))),\n                               sdiv_up64(paths_25424 -\n                                         sext_i32_i64(phys_tid_27466),\n                                         num_threads_29484));\n    \n    float x_27472;\n    float x_27473;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_29494 = 0.0F;\n    }\n    for (int64_t i_29499 = 0; i_29499 < chunk_sizze_29495; i_29499++) {\n        gtid_27465 = sext_i32_i64(phys_tid_27466) + num_threads_29484 * i_29499;\n        // apply map function\n        {\n            float res_27476;\n            float redout_28722 = 0.0F;\n            \n            for (int64_t i_28723 = 0; i_28723 < n_25421; i_28723++) {\n                float x_27480 = ((__global float *) mem_28829)[i_28723 *\n                                                               paths_25424 +\n                                                               gtid_27465",
                   "];\n                float res_27479 = x_27480 + redout_28722;\n                float redout_tmp_29500 = res_27479;\n                \n                redout_28722 = redout_tmp_29500;\n            }\n            res_27476 = redout_28722;\n            \n            float res_27481 = fmax32(0.0F, res_27476);\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_27472 = x_acc_29494;\n            }\n            // load new values\n            {\n                x_27473 = res_27481;\n            }\n            // apply reduction operator\n            {\n                float res_27474 = x_27472 + x_27473;\n                \n                // store in accumulator\n                {\n                    x_acc_29494 = res_27474;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_27472 = x_acc_29494;\n        ((__local float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n            x_27472;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_29501;\n    int32_t skip_waves_29502;\n    \n    skip_waves_29502 = 1;\n    \n    float x_29496;\n    float x_29497;\n    \n    offset_29501 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_29486, sext_i64_i32(segred_group_sizze_27468))) {\n            x_29496 = ((__local\n                        float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                    offset_29501)];\n        }\n    }\n    offset_29501 = 1;\n    while (slt32(offset_29501, wave_sizze_29488)) {\n        if (slt32(local_tid_29486 + offset_29501,\n                  sext_i64_i32(segred_group_sizze_27468)) && ((local_tid_29486 -\n                                                               squot32(local_tid_29486,\n                                                                       wave_sizze_29488) *\n                                         ",
                   "                      wave_sizze_29488) &\n                                                              (2 *\n                                                               offset_29501 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_29497 = ((volatile __local\n                            float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                        offset_29501)];\n            }\n            // apply reduction operation\n            {\n                float res_29498 = x_29496 + x_29497;\n                \n                x_29496 = res_29498;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n                    x_29496;\n            }\n        }\n        offset_29501 *= 2;\n    }\n    while (slt32(skip_waves_29502,\n                 squot32(sext_i64_i32(segred_group_sizze_27468) +\n                         wave_sizze_29488 - 1, wave_sizze_29488))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_29501 = skip_waves_29502 * wave_sizze_29488;\n        if (slt32(local_tid_29486 + offset_29501,\n                  sext_i64_i32(segred_group_sizze_27468)) && ((local_tid_29486 -\n                                                               squot32(local_tid_29486,\n                                                                       wave_sizze_29488) *\n                                                               wave_sizze_29488) ==\n                                                              0 &&\n                                                              (squot32(local_tid_29486,\n                                                                       wave_sizze_29488) &\n                                                               (2 *\n                                                                s",
                   "kip_waves_29502 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_29497 = ((__local\n                            float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                        offset_29501)];\n            }\n            // apply reduction operation\n            {\n                float res_29498 = x_29496 + x_29497;\n                \n                x_29496 = res_29498;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n                    x_29496;\n            }\n        }\n        skip_waves_29502 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_29486) == 0) {\n            x_acc_29494 = x_29496;\n        }\n    }\n    \n    int32_t old_counter_29503;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_29486 == 0) {\n            ((__global\n              float *) group_res_arr_mem_29482)[sext_i32_i64(group_tid_29487) *\n                                                segred_group_sizze_27468] =\n                x_acc_29494;\n            mem_fence_global();\n            old_counter_29503 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_29480)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_29490)[0] = old_counter_29503 ==\n                num_groups_27469 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_29504;\n    \n    is_last_group_29504 = ((__local bool *) sync_arr_mem_29490)[0];\n    if (is_last_group_29504) {\n        if (local_tid_29486 == 0) {\n            old_counter_29503 = atomic_add_i32_",
                   "global(&((volatile __global\n                                                         int *) mainzicounter_mem_29480)[0],\n                                                      (int) (0 -\n                                                             num_groups_27469));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_29505 = sdiv_up64(num_groups_27469,\n                                                      segred_group_sizze_27468);\n            \n            x_27472 = 0.0F;\n            for (int64_t i_29506 = 0; i_29506 < read_per_thread_29505;\n                 i_29506++) {\n                int64_t group_res_id_29507 = sext_i32_i64(local_tid_29486) *\n                        read_per_thread_29505 + i_29506;\n                int64_t index_of_group_res_29508 = group_res_id_29507;\n                \n                if (slt64(group_res_id_29507, num_groups_27469)) {\n                    x_27473 = ((__global\n                                float *) group_res_arr_mem_29482)[index_of_group_res_29508 *\n                                                                  segred_group_sizze_27468];\n                    \n                    float res_27474;\n                    \n                    res_27474 = x_27472 + x_27473;\n                    x_27472 = res_27474;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n            x_27472;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_29509;\n            int32_t skip_waves_29510;\n            \n            skip_waves_29510 = 1;\n            \n            float x_29496;\n            float x_29497;\n            \n            offset_29509 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_29486,\n                          sext_i64_i32(segred_group_sizze_27468))) {\n                    x_29496 = ((__local\n   ",
                   "                             float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                            offset_29509)];\n                }\n            }\n            offset_29509 = 1;\n            while (slt32(offset_29509, wave_sizze_29488)) {\n                if (slt32(local_tid_29486 + offset_29509,\n                          sext_i64_i32(segred_group_sizze_27468)) &&\n                    ((local_tid_29486 - squot32(local_tid_29486,\n                                                wave_sizze_29488) *\n                      wave_sizze_29488) & (2 * offset_29509 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_29497 = ((volatile __local\n                                    float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                                offset_29509)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_29498 = x_29496 + x_29497;\n                        \n                        x_29496 = res_29498;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n                            x_29496;\n                    }\n                }\n                offset_29509 *= 2;\n            }\n            while (slt32(skip_waves_29510,\n                         squot32(sext_i64_i32(segred_group_sizze_27468) +\n                                 wave_sizze_29488 - 1, wave_sizze_29488))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_29509 = skip_waves_29510 * wave_sizze_29488;\n                if (slt32(local_tid_29486 + offset_29509,\n                          sext_i64_i32(segred_group_sizze_27468)) &&\n                    ((local_tid_29486 - squot32(local_tid_29486,\n               ",
                   "                                 wave_sizze_29488) *\n                      wave_sizze_29488) == 0 && (squot32(local_tid_29486,\n                                                         wave_sizze_29488) &\n                                                 (2 * skip_waves_29510 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_29497 = ((__local\n                                    float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                                offset_29509)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_29498 = x_29496 + x_29497;\n                        \n                        x_29496 = res_29498;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n                            x_29496;\n                    }\n                }\n                skip_waves_29510 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_29486 == 0) {\n                    ((__global float *) mem_28832)[0] = x_29496;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_27468\n}\n__kernel void mainzisegred_nonseg_27562(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_29595_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_29593_backing_aligned_1,\n                                        int64_t paths_25424,\n                                        int64_t num_groups_27597, __global\n                                        unsigned cha",
                   "r *res_map_acc_mem_28845,\n                                        __global unsigned char *mem_28848,\n                                        __global\n                                        unsigned char *mainzicounter_mem_29583,\n                                        __global\n                                        unsigned char *group_res_arr_mem_29585,\n                                        int64_t num_threads_29587)\n{\n    #define segred_group_sizze_27596 (mainzisegred_group_sizze_27554)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_29595_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_29595_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_29593_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_29593_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29588;\n    int32_t local_tid_29589;\n    int64_t group_sizze_29592;\n    int32_t wave_sizze_29591;\n    int32_t group_tid_29590;\n    \n    global_tid_29588 = get_global_id(0);\n    local_tid_29589 = get_local_id(0);\n    group_sizze_29592 = get_local_size(0);\n    wave_sizze_29591 = LOCKSTEP_WIDTH;\n    group_tid_29590 = get_group_id(0);\n    \n    int32_t phys_tid_27562;\n    \n    phys_tid_27562 = global_tid_29588;\n    \n    __local char *sync_arr_mem_29593;\n    \n    sync_arr_mem_29593 = (__local char *) sync_arr_mem_29593_backing_0;\n    \n    __local char *red_arr_mem_29595;\n    \n    red_arr_mem_29595 = (__local char *) red_arr_mem_29595_backing_1;\n    \n    int64_t dummy_27560;\n    \n    dummy_27560 = 0;\n    \n    int64_t gtid_27561;\n    \n    gtid_27561 = 0;\n    \n    float x_acc_29597;\n    int64_t chunk_sizze_29598;\n    \n    chunk_sizze_29598 = smin64(sdiv_up64(paths_25424,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_27",
                   "596 *\n                                         num_groups_27597))),\n                               sdiv_up64(paths_25424 -\n                                         sext_i32_i64(phys_tid_27562),\n                                         num_threads_29587));\n    \n    float x_27600;\n    float x_27601;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_29597 = 0.0F;\n    }\n    for (int64_t i_29602 = 0; i_29602 < chunk_sizze_29598; i_29602++) {\n        gtid_27561 = sext_i32_i64(phys_tid_27562) + num_threads_29587 * i_29602;\n        // apply map function\n        {\n            float x_27603 = ((__global\n                              float *) res_map_acc_mem_28845)[gtid_27561];\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_27600 = x_acc_29597;\n            }\n            // load new values\n            {\n                x_27601 = x_27603;\n            }\n            // apply reduction operator\n            {\n                float res_27602 = x_27600 + x_27601;\n                \n                // store in accumulator\n                {\n                    x_acc_29597 = res_27602;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_27600 = x_acc_29597;\n        ((__local float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n            x_27600;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_29603;\n    int32_t skip_waves_29604;\n    \n    skip_waves_29604 = 1;\n    \n    float x_29599;\n    float x_29600;\n    \n    offset_29603 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_29589, sext_i64_i32(segred_group_sizze_27596))) {\n            x_29599 = ((__local\n                        float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                    offset_29603)];\n        }\n    }\n    offset_29603 = 1;\n    while ",
                   "(slt32(offset_29603, wave_sizze_29591)) {\n        if (slt32(local_tid_29589 + offset_29603,\n                  sext_i64_i32(segred_group_sizze_27596)) && ((local_tid_29589 -\n                                                               squot32(local_tid_29589,\n                                                                       wave_sizze_29591) *\n                                                               wave_sizze_29591) &\n                                                              (2 *\n                                                               offset_29603 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_29600 = ((volatile __local\n                            float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                        offset_29603)];\n            }\n            // apply reduction operation\n            {\n                float res_29601 = x_29599 + x_29600;\n                \n                x_29599 = res_29601;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n                    x_29599;\n            }\n        }\n        offset_29603 *= 2;\n    }\n    while (slt32(skip_waves_29604,\n                 squot32(sext_i64_i32(segred_group_sizze_27596) +\n                         wave_sizze_29591 - 1, wave_sizze_29591))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_29603 = skip_waves_29604 * wave_sizze_29591;\n        if (slt32(local_tid_29589 + offset_29603,\n                  sext_i64_i32(segred_group_sizze_27596)) && ((local_tid_29589 -\n                                                               squot32(local_tid_29589,\n                                                                       wave_sizze_29591) *\n                                                               wave_si",
                   "zze_29591) ==\n                                                              0 &&\n                                                              (squot32(local_tid_29589,\n                                                                       wave_sizze_29591) &\n                                                               (2 *\n                                                                skip_waves_29604 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_29600 = ((__local\n                            float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                        offset_29603)];\n            }\n            // apply reduction operation\n            {\n                float res_29601 = x_29599 + x_29600;\n                \n                x_29599 = res_29601;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n                    x_29599;\n            }\n        }\n        skip_waves_29604 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_29589) == 0) {\n            x_acc_29597 = x_29599;\n        }\n    }\n    \n    int32_t old_counter_29605;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_29589 == 0) {\n            ((__global\n              float *) group_res_arr_mem_29585)[sext_i32_i64(group_tid_29590) *\n                                                segred_group_sizze_27596] =\n                x_acc_29597;\n            mem_fence_global();\n            old_counter_29605 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_29583)[0],\n                                                      (int) 1);\n            ((__",
                   "local bool *) sync_arr_mem_29593)[0] = old_counter_29605 ==\n                num_groups_27597 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_29606;\n    \n    is_last_group_29606 = ((__local bool *) sync_arr_mem_29593)[0];\n    if (is_last_group_29606) {\n        if (local_tid_29589 == 0) {\n            old_counter_29605 = atomic_add_i32_global(&((volatile __global\n                                                         int *) mainzicounter_mem_29583)[0],\n                                                      (int) (0 -\n                                                             num_groups_27597));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_29607 = sdiv_up64(num_groups_27597,\n                                                      segred_group_sizze_27596);\n            \n            x_27600 = 0.0F;\n            for (int64_t i_29608 = 0; i_29608 < read_per_thread_29607;\n                 i_29608++) {\n                int64_t group_res_id_29609 = sext_i32_i64(local_tid_29589) *\n                        read_per_thread_29607 + i_29608;\n                int64_t index_of_group_res_29610 = group_res_id_29609;\n                \n                if (slt64(group_res_id_29609, num_groups_27597)) {\n                    x_27601 = ((__global\n                                float *) group_res_arr_mem_29585)[index_of_group_res_29610 *\n                                                                  segred_group_sizze_27596];\n                    \n                    float res_27602;\n                    \n                    res_27602 = x_27600 + x_27601;\n                    x_27600 = res_27602;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n            x_27600;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_29611;\n            int32_t skip_waves_29",
                   "612;\n            \n            skip_waves_29612 = 1;\n            \n            float x_29599;\n            float x_29600;\n            \n            offset_29611 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_29589,\n                          sext_i64_i32(segred_group_sizze_27596))) {\n                    x_29599 = ((__local\n                                float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                            offset_29611)];\n                }\n            }\n            offset_29611 = 1;\n            while (slt32(offset_29611, wave_sizze_29591)) {\n                if (slt32(local_tid_29589 + offset_29611,\n                          sext_i64_i32(segred_group_sizze_27596)) &&\n                    ((local_tid_29589 - squot32(local_tid_29589,\n                                                wave_sizze_29591) *\n                      wave_sizze_29591) & (2 * offset_29611 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_29600 = ((volatile __local\n                                    float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                                offset_29611)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_29601 = x_29599 + x_29600;\n                        \n                        x_29599 = res_29601;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n                            x_29599;\n                    }\n                }\n                offset_29611 *= 2;\n            }\n            while (slt32(skip_waves_29612,\n                         squot32(sext_i64_i32(segred_group_sizze_27596) +\n     ",
                   "                            wave_sizze_29591 - 1, wave_sizze_29591))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_29611 = skip_waves_29612 * wave_sizze_29591;\n                if (slt32(local_tid_29589 + offset_29611,\n                          sext_i64_i32(segred_group_sizze_27596)) &&\n                    ((local_tid_29589 - squot32(local_tid_29589,\n                                                wave_sizze_29591) *\n                      wave_sizze_29591) == 0 && (squot32(local_tid_29589,\n                                                         wave_sizze_29591) &\n                                                 (2 * skip_waves_29612 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_29600 = ((__local\n                                    float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                                offset_29611)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_29601 = x_29599 + x_29600;\n                        \n                        x_29599 = res_29601;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n                            x_29599;\n                    }\n                }\n                skip_waves_29612 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_29589 == 0) {\n                    ((__global float *) mem_28848)[0] = x_29599;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_27596\n}\n__kernel void mainzisegred_small_27529(__global int *global_failure,\n                                       __local volatile\n                           ",
                   "            int64_t *red_arr_mem_29524_backing_aligned_0,\n                                       int64_t n_25421, int64_t paths_25424,\n                                       int64_t num_groups_27580, __global\n                                       unsigned char *mem_28825, __global\n                                       unsigned char *mem_28841,\n                                       int64_t segment_sizze_nonzzero_29517)\n{\n    #define segred_group_sizze_27579 (mainzisegred_group_sizze_27523)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_29524_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_29524_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29519;\n    int32_t local_tid_29520;\n    int64_t group_sizze_29523;\n    int32_t wave_sizze_29522;\n    int32_t group_tid_29521;\n    \n    global_tid_29519 = get_global_id(0);\n    local_tid_29520 = get_local_id(0);\n    group_sizze_29523 = get_local_size(0);\n    wave_sizze_29522 = LOCKSTEP_WIDTH;\n    group_tid_29521 = get_group_id(0);\n    \n    int32_t phys_tid_27529;\n    \n    phys_tid_27529 = global_tid_29519;\n    \n    __local char *red_arr_mem_29524;\n    \n    red_arr_mem_29524 = (__local char *) red_arr_mem_29524_backing_0;\n    \n    int32_t phys_group_id_29526;\n    \n    phys_group_id_29526 = get_group_id(0);\n    for (int32_t i_29527 = 0; i_29527 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(paths_25424,\n                                          squot64(segred_group_sizze_27579,\n                                                  segment_sizze_nonzzero_29517))) -\n                   phys_group_id_29526, sext_i64_i32(num_groups_27580));\n         i_29527++) {\n        int32_t virt_group_id_29528 = phys_group_id_29526 + i_29527 *\n                sext_i64_i32(num_groups_27580);\n        int64_t gtid_27520 = squot64(sext_i32_i64(local_tid_29520),",
                   "\n                                     segment_sizze_nonzzero_29517) +\n                sext_i32_i64(virt_group_id_29528) *\n                squot64(segred_group_sizze_27579, segment_sizze_nonzzero_29517);\n        int64_t gtid_27528 = srem64(sext_i32_i64(local_tid_29520), n_25421);\n        \n        // apply map function if in bounds\n        {\n            if (slt64(0, n_25421) && (slt64(gtid_27520, paths_25424) &&\n                                      slt64(sext_i32_i64(local_tid_29520),\n                                            n_25421 *\n                                            squot64(segred_group_sizze_27579,\n                                                    segment_sizze_nonzzero_29517)))) {\n                int64_t binop_x_28697 = n_25421 * gtid_27520;\n                int64_t new_index_28698 = gtid_27528 + binop_x_28697;\n                float x_27587 = ((__global float *) mem_28825)[new_index_28698];\n                \n                // save map-out results\n                { }\n                // save results to be reduced\n                {\n                    ((__local\n                      float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                        x_27587;\n                }\n            } else {\n                ((__local\n                  float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                    0.0F;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64(0, n_25421)) {\n            // perform segmented scan to imitate reduction\n            {\n                float x_27583;\n                float x_27584;\n                float x_29529;\n                float x_29530;\n                bool ltid_in_bounds_29532;\n                \n                ltid_in_bounds_29532 = slt64(sext_i32_i64(local_tid_29520),\n                                             n_25421 *\n                                             squot64(segred_group_sizze_27579,\n                                                     segment",
                   "_sizze_nonzzero_29517));\n                \n                int32_t skip_threads_29533;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_29532) {\n                        x_27584 = ((volatile __local\n                                    float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)];\n                        if ((local_tid_29520 - squot32(local_tid_29520, 32) *\n                             32) == 0) {\n                            x_27583 = x_27584;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29533 = 1;\n                    while (slt32(skip_threads_29533, 32)) {\n                        if (sle32(skip_threads_29533, local_tid_29520 -\n                                  squot32(local_tid_29520, 32) * 32) &&\n                            ltid_in_bounds_29532) {\n                            // read operands\n                            {\n                                x_27583 = ((volatile __local\n                                            float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520) -\n                                                                        sext_i32_i64(skip_threads_29533)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_29534 =\n                                     slt64(srem64(sext_i32_i64(local_tid_29520),\n                                                  n_25421),\n                                           sext_i32_i64(local_tid_29520) -\n                                           sext_i32_i64(local_tid_29520 -\n                                           skip_threads_29533));\n                                \n                                if (inactive_29534) {\n                                    x_27583 = x_27584;\n             ",
                   "                   }\n                                if (!inactive_29534) {\n                                    float res_27585 = x_27583 + x_27584;\n                                    \n                                    x_27583 = res_27585;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_29522, skip_threads_29533)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29533, local_tid_29520 -\n                                  squot32(local_tid_29520, 32) * 32) &&\n                            ltid_in_bounds_29532) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                                    x_27583;\n                                x_27584 = x_27583;\n                            }\n                        }\n                        if (sle32(wave_sizze_29522, skip_threads_29533)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29533 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_29520 - squot32(local_tid_29520, 32) * 32) ==\n                        31 && ltid_in_bounds_29532) {\n                        ((volatile __local\n                          float *) red_arr_mem_29524)[sext_i32_i64(squot32(local_tid_29520,\n                                                                           32))] =\n                            x_27583;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains car",
                   "ry-in for block 'i+1'\n                {\n                    int32_t skip_threads_29535;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_29520, 32) == 0 &&\n                            ltid_in_bounds_29532) {\n                            x_29530 = ((volatile __local\n                                        float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)];\n                            if ((local_tid_29520 - squot32(local_tid_29520,\n                                                           32) * 32) == 0) {\n                                x_29529 = x_29530;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_29535 = 1;\n                        while (slt32(skip_threads_29535, 32)) {\n                            if (sle32(skip_threads_29535, local_tid_29520 -\n                                      squot32(local_tid_29520, 32) * 32) &&\n                                (squot32(local_tid_29520, 32) == 0 &&\n                                 ltid_in_bounds_29532)) {\n                                // read operands\n                                {\n                                    x_29529 = ((volatile __local\n                                                float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520) -\n                                                                            sext_i32_i64(skip_threads_29535)];\n                                }\n                                // perform operation\n                                {\n                                    bool inactive_29536 =\n                                         slt64(srem64(sext_i32_i64(local_tid_29520 *\n                                                      32 + 32 - 1), n_25421),\n                                               sext_i32_i64(local_tid_",
                   "29520 *\n                                               32 + 32 - 1) -\n                                               sext_i32_i64((local_tid_29520 -\n                                                             skip_threads_29535) *\n                                               32 + 32 - 1));\n                                    \n                                    if (inactive_29536) {\n                                        x_29529 = x_29530;\n                                    }\n                                    if (!inactive_29536) {\n                                        float res_29531 = x_29529 + x_29530;\n                                        \n                                        x_29529 = res_29531;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_29522, skip_threads_29535)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_29535, local_tid_29520 -\n                                      squot32(local_tid_29520, 32) * 32) &&\n                                (squot32(local_tid_29520, 32) == 0 &&\n                                 ltid_in_bounds_29532)) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                                        x_29529;\n                                    x_29530 = x_29529;\n                                }\n                            }\n                            if (sle32(wave_sizze_29522, skip_threads_29535)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_29535 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_L",
                   "OCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_29520, 32) == 0 ||\n                          !ltid_in_bounds_29532)) {\n                        // read operands\n                        {\n                            x_27584 = x_27583;\n                            x_27583 = ((__local\n                                        float *) red_arr_mem_29524)[sext_i32_i64(squot32(local_tid_29520,\n                                                                                         32)) -\n                                                                    1];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_29537 =\n                                 slt64(srem64(sext_i32_i64(local_tid_29520),\n                                              n_25421),\n                                       sext_i32_i64(local_tid_29520) -\n                                       sext_i32_i64(squot32(local_tid_29520,\n                                                            32) * 32 - 1));\n                            \n                            if (inactive_29537) {\n                                x_27583 = x_27584;\n                            }\n                            if (!inactive_29537) {\n                                float res_27585 = x_27583 + x_27584;\n                                \n                                x_27583 = res_27585;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                                x_27583;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n               ",
                   " {\n                    if (squot32(local_tid_29520, 32) == 0) {\n                        ((__local\n                          float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                            x_27584;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_group_id_29528) *\n                      squot64(segred_group_sizze_27579,\n                              segment_sizze_nonzzero_29517) +\n                      sext_i32_i64(local_tid_29520), paths_25424) &&\n                slt64(sext_i32_i64(local_tid_29520),\n                      squot64(segred_group_sizze_27579,\n                              segment_sizze_nonzzero_29517))) {\n                ((__global\n                  float *) mem_28841)[sext_i32_i64(virt_group_id_29528) *\n                                      squot64(segred_group_sizze_27579,\n                                              segment_sizze_nonzzero_29517) +\n                                      sext_i32_i64(local_tid_29520)] = ((__local\n                                                                         float *) red_arr_mem_29524)[(sext_i32_i64(local_tid_29520) +\n                                                                                                      1) *\n                                                                                                     segment_sizze_nonzzero_29517 -\n                                                                                                     1];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_27579\n}\n__kernel void mainzisegred_small_29153(__global int *global_failure,\n                                       __local volatile\n                               ",
                   "        int64_t *red_arr_mem_29161_backing_aligned_0,\n                                       int64_t res_25881,\n                                       int64_t num_groups_27362, __global\n                                       unsigned char *mem_28802,\n                                       int32_t num_subhistos_29067, __global\n                                       unsigned char *res_subhistos_mem_29068,\n                                       int64_t segment_sizze_nonzzero_29154)\n{\n    #define seghist_group_sizze_27360 (mainziseghist_group_sizze_27359)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_29161_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_29161_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29156;\n    int32_t local_tid_29157;\n    int64_t group_sizze_29160;\n    int32_t wave_sizze_29159;\n    int32_t group_tid_29158;\n    \n    global_tid_29156 = get_global_id(0);\n    local_tid_29157 = get_local_id(0);\n    group_sizze_29160 = get_local_size(0);\n    wave_sizze_29159 = LOCKSTEP_WIDTH;\n    group_tid_29158 = get_group_id(0);\n    \n    int32_t flat_gtid_29153;\n    \n    flat_gtid_29153 = global_tid_29156;\n    \n    __local char *red_arr_mem_29161;\n    \n    red_arr_mem_29161 = (__local char *) red_arr_mem_29161_backing_0;\n    \n    int32_t phys_group_id_29163;\n    \n    phys_group_id_29163 = get_group_id(0);\n    for (int32_t i_29164 = 0; i_29164 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(res_25881,\n                                          squot64(seghist_group_sizze_27360,\n                                                  segment_sizze_nonzzero_29154))) -\n                   phys_group_id_29163, sext_i64_i32(num_groups_27362));\n         i_29164++) {\n        int32_t virt_group_id_29165 = phys_group_id_29163 + i_29164 *\n                sext_i64_i32(num_groups_27362);\n     ",
                   "   int64_t bucket_id_29151 = squot64(sext_i32_i64(local_tid_29157),\n                                          segment_sizze_nonzzero_29154) +\n                sext_i32_i64(virt_group_id_29165) *\n                squot64(seghist_group_sizze_27360,\n                        segment_sizze_nonzzero_29154);\n        int64_t subhistogram_id_29152 = srem64(sext_i32_i64(local_tid_29157),\n                                               num_subhistos_29067);\n        \n        // apply map function if in bounds\n        {\n            if (slt64(0, num_subhistos_29067) && (slt64(bucket_id_29151,\n                                                        res_25881) &&\n                                                  slt64(sext_i32_i64(local_tid_29157),\n                                                        num_subhistos_29067 *\n                                                        squot64(seghist_group_sizze_27360,\n                                                                segment_sizze_nonzzero_29154)))) {\n                // save results to be reduced\n                {\n                    ((__local\n                      int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                        ((__global\n                          int64_t *) res_subhistos_mem_29068)[subhistogram_id_29152 *\n                                                              res_25881 +\n                                                              bucket_id_29151];\n                }\n            } else {\n                ((__local\n                  int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                    0;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64(0, num_subhistos_29067)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t x_27366;\n                int64_t x_27367;\n                int64_t x_29166;\n                int64_t x_29167;\n                bool ltid_in_bounds_29169;\n               ",
                   " \n                ltid_in_bounds_29169 = slt64(sext_i32_i64(local_tid_29157),\n                                             num_subhistos_29067 *\n                                             squot64(seghist_group_sizze_27360,\n                                                     segment_sizze_nonzzero_29154));\n                \n                int32_t skip_threads_29170;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_29169) {\n                        x_27367 = ((volatile __local\n                                    int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)];\n                        if ((local_tid_29157 - squot32(local_tid_29157, 32) *\n                             32) == 0) {\n                            x_27366 = x_27367;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29170 = 1;\n                    while (slt32(skip_threads_29170, 32)) {\n                        if (sle32(skip_threads_29170, local_tid_29157 -\n                                  squot32(local_tid_29157, 32) * 32) &&\n                            ltid_in_bounds_29169) {\n                            // read operands\n                            {\n                                x_27366 = ((volatile __local\n                                            int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157) -\n                                                                          sext_i32_i64(skip_threads_29170)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_29171 =\n                                     slt64(srem64(sext_i32_i64(local_tid_29157),\n                                                  num_subhistos_29067),\n                                           sext_i32_i64(local_tid_",
                   "29157) -\n                                           sext_i32_i64(local_tid_29157 -\n                                           skip_threads_29170));\n                                \n                                if (inactive_29171) {\n                                    x_27366 = x_27367;\n                                }\n                                if (!inactive_29171) {\n                                    int64_t res_27368 = smax64(x_27366,\n                                                               x_27367);\n                                    \n                                    x_27366 = res_27368;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_29159, skip_threads_29170)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29170, local_tid_29157 -\n                                  squot32(local_tid_29157, 32) * 32) &&\n                            ltid_in_bounds_29169) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                                    x_27366;\n                                x_27367 = x_27366;\n                            }\n                        }\n                        if (sle32(wave_sizze_29159, skip_threads_29170)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29170 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_29157 - squot32(local_tid_29157, 32) * 32) ==\n                        31 && ltid_in_bounds_29169) {\n                        ((volatile __loc",
                   "al\n                          int64_t *) red_arr_mem_29161)[sext_i32_i64(squot32(local_tid_29157,\n                                                                             32))] =\n                            x_27366;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_29172;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_29157, 32) == 0 &&\n                            ltid_in_bounds_29169) {\n                            x_29167 = ((volatile __local\n                                        int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)];\n                            if ((local_tid_29157 - squot32(local_tid_29157,\n                                                           32) * 32) == 0) {\n                                x_29166 = x_29167;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_29172 = 1;\n                        while (slt32(skip_threads_29172, 32)) {\n                            if (sle32(skip_threads_29172, local_tid_29157 -\n                                      squot32(local_tid_29157, 32) * 32) &&\n                                (squot32(local_tid_29157, 32) == 0 &&\n                                 ltid_in_bounds_29169)) {\n                                // read operands\n                                {\n                                    x_29166 = ((volatile __local\n                                                int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157) -\n                                                                              sext_i32_i64(skip_threads_29172)];\n                         ",
                   "       }\n                                // perform operation\n                                {\n                                    bool inactive_29173 =\n                                         slt64(srem64(sext_i32_i64(local_tid_29157 *\n                                                      32 + 32 - 1),\n                                                      num_subhistos_29067),\n                                               sext_i32_i64(local_tid_29157 *\n                                               32 + 32 - 1) -\n                                               sext_i32_i64((local_tid_29157 -\n                                                             skip_threads_29172) *\n                                               32 + 32 - 1));\n                                    \n                                    if (inactive_29173) {\n                                        x_29166 = x_29167;\n                                    }\n                                    if (!inactive_29173) {\n                                        int64_t res_29168 = smax64(x_29166,\n                                                                   x_29167);\n                                        \n                                        x_29166 = res_29168;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_29159, skip_threads_29172)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_29172, local_tid_29157 -\n                                      squot32(local_tid_29157, 32) * 32) &&\n                                (squot32(local_tid_29157, 32) == 0 &&\n                                 ltid_in_bounds_29169)) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      int64_t *) red_arr_",
                   "mem_29161)[sext_i32_i64(local_tid_29157)] =\n                                        x_29166;\n                                    x_29167 = x_29166;\n                                }\n                            }\n                            if (sle32(wave_sizze_29159, skip_threads_29172)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_29172 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_29157, 32) == 0 ||\n                          !ltid_in_bounds_29169)) {\n                        // read operands\n                        {\n                            x_27367 = x_27366;\n                            x_27366 = ((__local\n                                        int64_t *) red_arr_mem_29161)[sext_i32_i64(squot32(local_tid_29157,\n                                                                                           32)) -\n                                                                      1];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_29174 =\n                                 slt64(srem64(sext_i32_i64(local_tid_29157),\n                                              num_subhistos_29067),\n                                       sext_i32_i64(local_tid_29157) -\n                                       sext_i32_i64(squot32(local_tid_29157,\n                                                            32) * 32 - 1));\n                            \n                            if (inactive_29174) {\n                                x_27366 = x_27367;\n                            }\n                            if (!inactive_29174) {\n                                int64_t res_27368 = smax64(x_27366, x_27367);\n           ",
                   "                     \n                                x_27366 = res_27368;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                                x_27366;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_29157, 32) == 0) {\n                        ((__local\n                          int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                            x_27367;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_group_id_29165) *\n                      squot64(seghist_group_sizze_27360,\n                              segment_sizze_nonzzero_29154) +\n                      sext_i32_i64(local_tid_29157), res_25881) &&\n                slt64(sext_i32_i64(local_tid_29157),\n                      squot64(seghist_group_sizze_27360,\n                              segment_sizze_nonzzero_29154))) {\n                ((__global\n                  int64_t *) mem_28802)[sext_i32_i64(virt_group_id_29165) *\n                                        squot64(seghist_group_sizze_27360,\n                                                segment_sizze_nonzzero_29154) +\n                                        sext_i32_i64(local_tid_29157)] =\n                    ((__local\n                      int64_t *) red_arr_mem_29161)[(sext_i32_i64(local_tid_29157) +\n                                                     1) *\n                                                    segment_sizze_nonzzero_29154 -\n            ",
                   "                                        1];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef seghist_group_sizze_27360\n}\n__kernel void testziscan_stage1_28395(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_28986_backing_aligned_0,\n                                      int64_t flat_dim_26283, float res_26296,\n                                      __global unsigned char *res_mem_28757,\n                                      __global unsigned char *res_mem_28758,\n                                      __global unsigned char *mem_28789,\n                                      __global unsigned char *mem_28791,\n                                      int32_t num_threads_28980)\n{\n    #define segscan_group_sizze_28390 (testzisegscan_group_sizze_28389)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_28986_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_28986_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28981;\n    int32_t local_tid_28982;\n    int64_t group_sizze_28985;\n    int32_t wave_sizze_28984;\n    int32_t group_tid_28983;\n    \n    global_tid_28981 = get_global_id(0);\n    local_tid_28982 = get_local_id(0);\n    group_sizze_28985 = get_local_size(0);\n    wave_sizze_28984 = LOCKSTEP_WIDTH;\n    group_tid_28983 = get_group_id(0);\n    \n    int32_t phys_tid_28395;\n    \n    phys_tid_28395 = global_tid_28981;\n    \n    __local char *scan_arr_mem_28986;\n    \n    scan_arr_mem_28986 = (__local char *) scan_arr_mem_28986_backing_0;\n    \n    int64_t x_26302;\n    int64_t x_26303;\n    \n    x_26302 = 0;\n    for (int64_t j_28988 = 0; j_28988 < sdiv_up64(flat_dim_26283,\n            ",
                   "                                      sext_i32_i64(num_threads_28980));\n         j_28988++) {\n        int64_t chunk_offset_28989 = segscan_group_sizze_28390 * j_28988 +\n                sext_i32_i64(group_tid_28983) * (segscan_group_sizze_28390 *\n                                                 sdiv_up64(flat_dim_26283,\n                                                           sext_i32_i64(num_threads_28980)));\n        int64_t flat_idx_28990 = chunk_offset_28989 +\n                sext_i32_i64(local_tid_28982);\n        int64_t gtid_28394 = flat_idx_28990;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_28394, flat_dim_26283)) {\n                int64_t binop_x_28668 = squot64(gtid_28394, 45);\n                int64_t binop_y_28669 = 45 * binop_x_28668;\n                int64_t new_index_28670 = gtid_28394 - binop_y_28669;\n                int64_t x_26305 = ((__global\n                                    int64_t *) res_mem_28757)[new_index_28670];\n                float x_26306 = ((__global\n                                  float *) res_mem_28758)[new_index_28670];\n                float x_26307 = res_26296 / x_26306;\n                float ceil_arg_26308 = x_26307 - 1.0F;\n                float res_26309;\n                \n                res_26309 = futrts_ceil32(ceil_arg_26308);\n                \n                int64_t res_26310 = fptosi_f32_i64(res_26309);\n                int64_t max_arg_26311 = sub64(x_26305, res_26310);\n                int64_t res_26312 = smax64(0, max_arg_26311);\n                bool cond_26313 = res_26312 == 0;\n                int64_t res_26314;\n                \n                if (cond_26313) {\n                    res_26314 = 1;\n                } else {\n                    res_26314 = res_26312;\n                }\n                // write to-scan values to parameters\n                {\n                    x_26303 = res_26314;\n                }\n                // write mapped values results to global memory\n          ",
                   "      {\n                    ((__global int64_t *) mem_28791)[gtid_28394] = res_26314;\n                }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_28394, flat_dim_26283)) {\n                    x_26303 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                int64_t res_26304 = add64(x_26302, x_26303);\n                \n                ((__local\n                  int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)] =\n                    res_26304;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int64_t x_28991;\n            int64_t x_28992;\n            int64_t x_28994;\n            int64_t x_28995;\n            bool ltid_in_bounds_28997;\n            \n            ltid_in_bounds_28997 = slt64(sext_i32_i64(local_tid_28982),\n                                         segscan_group_sizze_28390);\n            \n            int32_t skip_threads_28998;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_28997) {\n                    x_28992 = ((volatile __local\n                                int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)];\n                    if ((local_tid_28982 - squot32(local_tid_28982, 32) * 32) ==\n                        0) {\n                        x_28991 = x_28992;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_28998 = 1;\n                while (slt32(skip_threads_28998, 32)) {\n                    if (sle32(skip_threads_28998, local_tid_28982 -\n                              squot32(local_tid_28982, 32) * 32) &&\n                        ltid_in_bounds_28997) {\n                        // read operands\n                 ",
                   "       {\n                            x_28991 = ((volatile __local\n                                        int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982) -\n                                                                       sext_i32_i64(skip_threads_28998)];\n                        }\n                        // perform operation\n                        {\n                            int64_t res_28993 = add64(x_28991, x_28992);\n                            \n                            x_28991 = res_28993;\n                        }\n                    }\n                    if (sle32(wave_sizze_28984, skip_threads_28998)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_28998, local_tid_28982 -\n                              squot32(local_tid_28982, 32) * 32) &&\n                        ltid_in_bounds_28997) {\n                        // write result\n                        {\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)] =\n                                x_28991;\n                            x_28992 = x_28991;\n                        }\n                    }\n                    if (sle32(wave_sizze_28984, skip_threads_28998)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_28998 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_28982 - squot32(local_tid_28982, 32) * 32) ==\n                    31 && ltid_in_bounds_28997) {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_28986)[sext_i32_i64(squot32(local_tid_28982,\n                                                                          32))] =\n                        x_28991;\n                }\n            }",
                   "\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_28999;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_28982, 32) == 0 &&\n                        ltid_in_bounds_28997) {\n                        x_28995 = ((volatile __local\n                                    int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)];\n                        if ((local_tid_28982 - squot32(local_tid_28982, 32) *\n                             32) == 0) {\n                            x_28994 = x_28995;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_28999 = 1;\n                    while (slt32(skip_threads_28999, 32)) {\n                        if (sle32(skip_threads_28999, local_tid_28982 -\n                                  squot32(local_tid_28982, 32) * 32) &&\n                            (squot32(local_tid_28982, 32) == 0 &&\n                             ltid_in_bounds_28997)) {\n                            // read operands\n                            {\n                                x_28994 = ((volatile __local\n                                            int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982) -\n                                                                           sext_i32_i64(skip_threads_28999)];\n                            }\n                            // perform operation\n                            {\n                                int64_t res_28996 = add64(x_28994, x_28995);\n                                \n                                x_28994 = res_28996;\n                            }\n                        }\n                        if (sle32(wave_sizze_28984, skip_threads_28999)) {\n                       ",
                   "     barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_28999, local_tid_28982 -\n                                  squot32(local_tid_28982, 32) * 32) &&\n                            (squot32(local_tid_28982, 32) == 0 &&\n                             ltid_in_bounds_28997)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)] =\n                                    x_28994;\n                                x_28995 = x_28994;\n                            }\n                        }\n                        if (sle32(wave_sizze_28984, skip_threads_28999)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_28999 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_28982, 32) == 0 ||\n                      !ltid_in_bounds_28997)) {\n                    // read operands\n                    {\n                        x_28992 = x_28991;\n                        x_28991 = ((__local\n                                    int64_t *) scan_arr_mem_28986)[sext_i32_i64(squot32(local_tid_28982,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_28993 = add64(x_28991, x_28992);\n                        \n                        x_28991 = res_28993;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          int64_t *) scan_arr_mem_28986)[",
                   "sext_i32_i64(local_tid_28982)] =\n                            x_28991;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_28982, 32) == 0) {\n                    ((__local\n                      int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)] =\n                        x_28992;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_28394, flat_dim_26283)) {\n                    ((__global int64_t *) mem_28789)[gtid_28394] = ((__local\n                                                                     int64_t *) scan_arr_mem_28986)[sext_i32_i64(local_tid_28982)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_29000 = 0;\n                bool should_load_carry_29001 = local_tid_28982 == 0 &&\n                     !crosses_segment_29000;\n                \n                if (should_load_carry_29001) {\n                    x_26302 = ((__local\n                                int64_t *) scan_arr_mem_28986)[segscan_group_sizze_28390 -\n                                                               1];\n                }\n                if (!should_load_carry_29001) {\n                    x_26302 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_28390\n}\n__kernel void testziscan_stage1_28428(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29225_backing_aligned_0,\n                                      __local volatile\n                                    ",
                   "  int64_t *scan_arr_mem_29223_backing_aligned_1,\n                                      int64_t res_26316, __global\n                                      unsigned char *mem_28796, __global\n                                      unsigned char *mem_28800, __global\n                                      unsigned char *mem_28802,\n                                      int32_t num_threads_29217)\n{\n    #define segscan_group_sizze_28423 (testzisegscan_group_sizze_28422)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29225_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_29225_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29223_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29223_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29218;\n    int32_t local_tid_29219;\n    int64_t group_sizze_29222;\n    int32_t wave_sizze_29221;\n    int32_t group_tid_29220;\n    \n    global_tid_29218 = get_global_id(0);\n    local_tid_29219 = get_local_id(0);\n    group_sizze_29222 = get_local_size(0);\n    wave_sizze_29221 = LOCKSTEP_WIDTH;\n    group_tid_29220 = get_group_id(0);\n    \n    int32_t phys_tid_28428;\n    \n    phys_tid_28428 = global_tid_29218;\n    \n    __local char *scan_arr_mem_29223;\n    __local char *scan_arr_mem_29225;\n    \n    scan_arr_mem_29223 = (__local char *) scan_arr_mem_29223_backing_0;\n    scan_arr_mem_29225 = (__local char *) scan_arr_mem_29225_backing_1;\n    \n    bool x_26335;\n    int64_t x_26336;\n    bool x_26337;\n    int64_t x_26338;\n    \n    x_26335 = 0;\n    x_26336 = 0;\n    for (int64_t j_29227 = 0; j_29227 < sdiv_up64(res_26316,\n                                                  sext_i32_i64(num_threads_29217));\n         j_29227++) {\n        int64_t chunk_offset_29228 = segscan_group_sizze_28423 * j",
                   "_29227 +\n                sext_i32_i64(group_tid_29220) * (segscan_group_sizze_28423 *\n                                                 sdiv_up64(res_26316,\n                                                           sext_i32_i64(num_threads_29217)));\n        int64_t flat_idx_29229 = chunk_offset_29228 +\n                sext_i32_i64(local_tid_29219);\n        int64_t gtid_28427 = flat_idx_29229;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_28427, res_26316)) {\n                int64_t x_26342 = ((__global int64_t *) mem_28796)[gtid_28427];\n                bool res_26343 = slt64(0, x_26342);\n                \n                // write to-scan values to parameters\n                {\n                    x_26337 = res_26343;\n                    x_26338 = x_26342;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_28427, res_26316)) {\n                    x_26337 = 0;\n                    x_26338 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                bool res_26339 = x_26335 || x_26337;\n                int64_t res_26340;\n                \n                if (x_26337) {\n                    res_26340 = x_26338;\n                } else {\n                    int64_t res_26341 = add64(x_26336, x_26338);\n                    \n                    res_26340 = res_26341;\n                }\n                ((__local\n                  bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)] =\n                    res_26339;\n                ((__local\n                  int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)] =\n                    res_26340;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n   ",
                   "         bool x_29230;\n            int64_t x_29231;\n            bool x_29232;\n            int64_t x_29233;\n            bool x_29237;\n            int64_t x_29238;\n            bool x_29239;\n            int64_t x_29240;\n            bool ltid_in_bounds_29244;\n            \n            ltid_in_bounds_29244 = slt64(sext_i32_i64(local_tid_29219),\n                                         segscan_group_sizze_28423);\n            \n            int32_t skip_threads_29245;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_29244) {\n                    x_29232 = ((volatile __local\n                                bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)];\n                    x_29233 = ((volatile __local\n                                int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)];\n                    if ((local_tid_29219 - squot32(local_tid_29219, 32) * 32) ==\n                        0) {\n                        x_29230 = x_29232;\n                        x_29231 = x_29233;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_29245 = 1;\n                while (slt32(skip_threads_29245, 32)) {\n                    if (sle32(skip_threads_29245, local_tid_29219 -\n                              squot32(local_tid_29219, 32) * 32) &&\n                        ltid_in_bounds_29244) {\n                        // read operands\n                        {\n                            x_29230 = ((volatile __local\n                                        bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219) -\n                                                                    sext_i32_i64(skip_threads_29245)];\n                            x_29231 = ((volatile __local\n                                        int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219) -\n                                              ",
                   "                         sext_i32_i64(skip_threads_29245)];\n                        }\n                        // perform operation\n                        {\n                            bool res_29234 = x_29230 || x_29232;\n                            int64_t res_29235;\n                            \n                            if (x_29232) {\n                                res_29235 = x_29233;\n                            } else {\n                                int64_t res_29236 = add64(x_29231, x_29233);\n                                \n                                res_29235 = res_29236;\n                            }\n                            x_29230 = res_29234;\n                            x_29231 = res_29235;\n                        }\n                    }\n                    if (sle32(wave_sizze_29221, skip_threads_29245)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_29245, local_tid_29219 -\n                              squot32(local_tid_29219, 32) * 32) &&\n                        ltid_in_bounds_29244) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)] =\n                                x_29230;\n                            x_29232 = x_29230;\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)] =\n                                x_29231;\n                            x_29233 = x_29231;\n                        }\n                    }\n                    if (sle32(wave_sizze_29221, skip_threads_29245)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_29245 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to o",
                   "ffset 'i'\n            {\n                if ((local_tid_29219 - squot32(local_tid_29219, 32) * 32) ==\n                    31 && ltid_in_bounds_29244) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29223)[sext_i32_i64(squot32(local_tid_29219,\n                                                                       32))] =\n                        x_29230;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29225)[sext_i32_i64(squot32(local_tid_29219,\n                                                                          32))] =\n                        x_29231;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_29246;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_29219, 32) == 0 &&\n                        ltid_in_bounds_29244) {\n                        x_29239 = ((volatile __local\n                                    bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)];\n                        x_29240 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)];\n                        if ((local_tid_29219 - squot32(local_tid_29219, 32) *\n                             32) == 0) {\n                            x_29237 = x_29239;\n                            x_29238 = x_29240;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29246 = 1;\n                    while (slt32(skip_threads_29246, 32)) {\n                        if (sle32(skip_threads_29246, local_tid_29219 -\n                                  squot32(local_tid_29219, 32) * 32) &&\n                            (squot32(",
                   "local_tid_29219, 32) == 0 &&\n                             ltid_in_bounds_29244)) {\n                            // read operands\n                            {\n                                x_29237 = ((volatile __local\n                                            bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219) -\n                                                                        sext_i32_i64(skip_threads_29246)];\n                                x_29238 = ((volatile __local\n                                            int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219) -\n                                                                           sext_i32_i64(skip_threads_29246)];\n                            }\n                            // perform operation\n                            {\n                                bool res_29241 = x_29237 || x_29239;\n                                int64_t res_29242;\n                                \n                                if (x_29239) {\n                                    res_29242 = x_29240;\n                                } else {\n                                    int64_t res_29243 = add64(x_29238, x_29240);\n                                    \n                                    res_29242 = res_29243;\n                                }\n                                x_29237 = res_29241;\n                                x_29238 = res_29242;\n                            }\n                        }\n                        if (sle32(wave_sizze_29221, skip_threads_29246)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29246, local_tid_29219 -\n                                  squot32(local_tid_29219, 32) * 32) &&\n                            (squot32(local_tid_29219, 32) == 0 &&\n                             ltid_in_bounds_29244)) {\n                            // write result\n                            {\n               ",
                   "                 ((volatile __local\n                                  bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)] =\n                                    x_29237;\n                                x_29239 = x_29237;\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)] =\n                                    x_29238;\n                                x_29240 = x_29238;\n                            }\n                        }\n                        if (sle32(wave_sizze_29221, skip_threads_29246)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29246 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_29219, 32) == 0 ||\n                      !ltid_in_bounds_29244)) {\n                    // read operands\n                    {\n                        x_29232 = x_29230;\n                        x_29233 = x_29231;\n                        x_29230 = ((__local\n                                    bool *) scan_arr_mem_29223)[sext_i32_i64(squot32(local_tid_29219,\n                                                                                     32)) -\n                                                                1];\n                        x_29231 = ((__local\n                                    int64_t *) scan_arr_mem_29225)[sext_i32_i64(squot32(local_tid_29219,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        bool res_29234 = x_29230 || x_29232;\n                        int64_t res_29235;\n                        \n          ",
                   "              if (x_29232) {\n                            res_29235 = x_29233;\n                        } else {\n                            int64_t res_29236 = add64(x_29231, x_29233);\n                            \n                            res_29235 = res_29236;\n                        }\n                        x_29230 = res_29234;\n                        x_29231 = res_29235;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)] =\n                            x_29230;\n                        ((__local\n                          int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)] =\n                            x_29231;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_29219, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)] =\n                        x_29232;\n                    ((__local\n                      int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)] =\n                        x_29233;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_28427, res_26316)) {\n                    ((__global bool *) mem_28800)[gtid_28427] = ((__local\n                                                                  bool *) scan_arr_mem_29223)[sext_i32_i64(local_tid_29219)];\n                    ((__global int64_t *) mem_28802)[gtid_28427] = ((__local\n                                                                     int64_t *) scan_arr_mem_29225)[sext_i32_i64(local_tid_29219)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // fi",
                   "rst thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_29247 = 0;\n                bool should_load_carry_29248 = local_tid_29219 == 0 &&\n                     !crosses_segment_29247;\n                \n                if (should_load_carry_29248) {\n                    x_26335 = ((__local\n                                bool *) scan_arr_mem_29223)[segscan_group_sizze_28423 -\n                                                            1];\n                    x_26336 = ((__local\n                                int64_t *) scan_arr_mem_29225)[segscan_group_sizze_28423 -\n                                                               1];\n                }\n                if (!should_load_carry_29248) {\n                    x_26335 = 0;\n                    x_26336 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_28423\n}\n__kernel void testziscan_stage1_28436(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29292_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29290_backing_aligned_1,\n                                      int64_t res_26316, __global\n                                      unsigned char *mem_28802, __global\n                                      unsigned char *mem_28805, __global\n                                      unsigned char *mem_28807, __global\n                                      unsigned char *mem_28809,\n                                      int32_t num_threads_29284)\n{\n    #define segscan_group_sizze_28431 (testzisegscan_group_sizze_28430)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29292_backing_1 =\n                    ",
                   "      (__local volatile\n                           char *) scan_arr_mem_29292_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29290_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29290_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29285;\n    int32_t local_tid_29286;\n    int64_t group_sizze_29289;\n    int32_t wave_sizze_29288;\n    int32_t group_tid_29287;\n    \n    global_tid_29285 = get_global_id(0);\n    local_tid_29286 = get_local_id(0);\n    group_sizze_29289 = get_local_size(0);\n    wave_sizze_29288 = LOCKSTEP_WIDTH;\n    group_tid_29287 = get_group_id(0);\n    \n    int32_t phys_tid_28436;\n    \n    phys_tid_28436 = global_tid_29285;\n    \n    __local char *scan_arr_mem_29290;\n    __local char *scan_arr_mem_29292;\n    \n    scan_arr_mem_29290 = (__local char *) scan_arr_mem_29290_backing_0;\n    scan_arr_mem_29292 = (__local char *) scan_arr_mem_29292_backing_1;\n    \n    bool x_26374;\n    int64_t x_26375;\n    bool x_26376;\n    int64_t x_26377;\n    \n    x_26374 = 0;\n    x_26375 = 0;\n    for (int64_t j_29294 = 0; j_29294 < sdiv_up64(res_26316,\n                                                  sext_i32_i64(num_threads_29284));\n         j_29294++) {\n        int64_t chunk_offset_29295 = segscan_group_sizze_28431 * j_29294 +\n                sext_i32_i64(group_tid_29287) * (segscan_group_sizze_28431 *\n                                                 sdiv_up64(res_26316,\n                                                           sext_i32_i64(num_threads_29284)));\n        int64_t flat_idx_29296 = chunk_offset_29295 +\n                sext_i32_i64(local_tid_29286);\n        int64_t gtid_28435 = flat_idx_29296;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_28435, res_26316)) {\n                int64_t x_26381 = ((__global int64_t *) mem_28802)[gtid_28435];\n                int64_t i_p_o_28679 = add64(-1, gtid_28435);\n  ",
                   "              int64_t rot_i_28680 = smod64(i_p_o_28679, res_26316);\n                int64_t x_26382 = ((__global int64_t *) mem_28802)[rot_i_28680];\n                bool res_26384 = x_26381 == x_26382;\n                bool res_26385 = !res_26384;\n                \n                // write to-scan values to parameters\n                {\n                    x_26376 = res_26385;\n                    x_26377 = 1;\n                }\n                // write mapped values results to global memory\n                {\n                    ((__global bool *) mem_28809)[gtid_28435] = res_26385;\n                }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_28435, res_26316)) {\n                    x_26376 = 0;\n                    x_26377 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                bool res_26378 = x_26374 || x_26376;\n                int64_t res_26379;\n                \n                if (x_26376) {\n                    res_26379 = x_26377;\n                } else {\n                    int64_t res_26380 = add64(x_26375, x_26377);\n                    \n                    res_26379 = res_26380;\n                }\n                ((__local\n                  bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)] =\n                    res_26378;\n                ((__local\n                  int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)] =\n                    res_26379;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_29297;\n            int64_t x_29298;\n            bool x_29299;\n            int64_t x_29300;\n            bool x_29304;\n            int64_t x_29305;\n            bool x_29306;\n            int64_t x_29307;\n            bool ltid_in_bounds_29311;\n            \n            ltid_in_bounds_29311 =",
                   " slt64(sext_i32_i64(local_tid_29286),\n                                         segscan_group_sizze_28431);\n            \n            int32_t skip_threads_29312;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_29311) {\n                    x_29299 = ((volatile __local\n                                bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)];\n                    x_29300 = ((volatile __local\n                                int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)];\n                    if ((local_tid_29286 - squot32(local_tid_29286, 32) * 32) ==\n                        0) {\n                        x_29297 = x_29299;\n                        x_29298 = x_29300;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_29312 = 1;\n                while (slt32(skip_threads_29312, 32)) {\n                    if (sle32(skip_threads_29312, local_tid_29286 -\n                              squot32(local_tid_29286, 32) * 32) &&\n                        ltid_in_bounds_29311) {\n                        // read operands\n                        {\n                            x_29297 = ((volatile __local\n                                        bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286) -\n                                                                    sext_i32_i64(skip_threads_29312)];\n                            x_29298 = ((volatile __local\n                                        int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286) -\n                                                                       sext_i32_i64(skip_threads_29312)];\n                        }\n                        // perform operation\n                        {\n                            bool res_29301 = x_29297 || x_29299;\n                            int64_t res_29302;\n                            \n     ",
                   "                       if (x_29299) {\n                                res_29302 = x_29300;\n                            } else {\n                                int64_t res_29303 = add64(x_29298, x_29300);\n                                \n                                res_29302 = res_29303;\n                            }\n                            x_29297 = res_29301;\n                            x_29298 = res_29302;\n                        }\n                    }\n                    if (sle32(wave_sizze_29288, skip_threads_29312)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_29312, local_tid_29286 -\n                              squot32(local_tid_29286, 32) * 32) &&\n                        ltid_in_bounds_29311) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)] =\n                                x_29297;\n                            x_29299 = x_29297;\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)] =\n                                x_29298;\n                            x_29300 = x_29298;\n                        }\n                    }\n                    if (sle32(wave_sizze_29288, skip_threads_29312)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_29312 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_29286 - squot32(local_tid_29286, 32) * 32) ==\n                    31 && ltid_in_bounds_29311) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29290)[sext_i32_i64(squot32(local_tid_29286,\n                         ",
                   "                                              32))] =\n                        x_29297;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29292)[sext_i32_i64(squot32(local_tid_29286,\n                                                                          32))] =\n                        x_29298;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_29313;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_29286, 32) == 0 &&\n                        ltid_in_bounds_29311) {\n                        x_29306 = ((volatile __local\n                                    bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)];\n                        x_29307 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)];\n                        if ((local_tid_29286 - squot32(local_tid_29286, 32) *\n                             32) == 0) {\n                            x_29304 = x_29306;\n                            x_29305 = x_29307;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29313 = 1;\n                    while (slt32(skip_threads_29313, 32)) {\n                        if (sle32(skip_threads_29313, local_tid_29286 -\n                                  squot32(local_tid_29286, 32) * 32) &&\n                            (squot32(local_tid_29286, 32) == 0 &&\n                             ltid_in_bounds_29311)) {\n                            // read operands\n                            {\n                                x_29304 = ((volatile __local\n                                            bool *) scan_arr_mem_29290)[sext_i32_i64",
                   "(local_tid_29286) -\n                                                                        sext_i32_i64(skip_threads_29313)];\n                                x_29305 = ((volatile __local\n                                            int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286) -\n                                                                           sext_i32_i64(skip_threads_29313)];\n                            }\n                            // perform operation\n                            {\n                                bool res_29308 = x_29304 || x_29306;\n                                int64_t res_29309;\n                                \n                                if (x_29306) {\n                                    res_29309 = x_29307;\n                                } else {\n                                    int64_t res_29310 = add64(x_29305, x_29307);\n                                    \n                                    res_29309 = res_29310;\n                                }\n                                x_29304 = res_29308;\n                                x_29305 = res_29309;\n                            }\n                        }\n                        if (sle32(wave_sizze_29288, skip_threads_29313)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29313, local_tid_29286 -\n                                  squot32(local_tid_29286, 32) * 32) &&\n                            (squot32(local_tid_29286, 32) == 0 &&\n                             ltid_in_bounds_29311)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)] =\n                                    x_29304;\n                                x_29306 = x_29304;\n                                ((volatile __local\n                         ",
                   "         int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)] =\n                                    x_29305;\n                                x_29307 = x_29305;\n                            }\n                        }\n                        if (sle32(wave_sizze_29288, skip_threads_29313)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29313 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_29286, 32) == 0 ||\n                      !ltid_in_bounds_29311)) {\n                    // read operands\n                    {\n                        x_29299 = x_29297;\n                        x_29300 = x_29298;\n                        x_29297 = ((__local\n                                    bool *) scan_arr_mem_29290)[sext_i32_i64(squot32(local_tid_29286,\n                                                                                     32)) -\n                                                                1];\n                        x_29298 = ((__local\n                                    int64_t *) scan_arr_mem_29292)[sext_i32_i64(squot32(local_tid_29286,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        bool res_29301 = x_29297 || x_29299;\n                        int64_t res_29302;\n                        \n                        if (x_29299) {\n                            res_29302 = x_29300;\n                        } else {\n                            int64_t res_29303 = add64(x_29298, x_29300);\n                            \n                            res_29302 = res_29303;\n                        }\n             ",
                   "           x_29297 = res_29301;\n                        x_29298 = res_29302;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)] =\n                            x_29297;\n                        ((__local\n                          int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)] =\n                            x_29298;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_29286, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)] =\n                        x_29299;\n                    ((__local\n                      int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)] =\n                        x_29300;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_28435, res_26316)) {\n                    ((__global bool *) mem_28805)[gtid_28435] = ((__local\n                                                                  bool *) scan_arr_mem_29290)[sext_i32_i64(local_tid_29286)];\n                    ((__global int64_t *) mem_28807)[gtid_28435] = ((__local\n                                                                     int64_t *) scan_arr_mem_29292)[sext_i32_i64(local_tid_29286)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_29314 = 0;\n                bool should_load_carry_29315 = local_tid_29286 == 0 &&\n                     !crosses_segment_29314;\n                \n                if (should_load_carry_29315) {\n",
                   "                    x_26374 = ((__local\n                                bool *) scan_arr_mem_29290)[segscan_group_sizze_28431 -\n                                                            1];\n                    x_26375 = ((__local\n                                int64_t *) scan_arr_mem_29292)[segscan_group_sizze_28431 -\n                                                               1];\n                }\n                if (!should_load_carry_29315) {\n                    x_26374 = 0;\n                    x_26375 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_28431\n}\n__kernel void testziscan_stage1_28444(__global int *global_failure,\n                                      int failure_is_an_option, __global\n                                      int64_t *global_failure_args,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29359_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29357_backing_aligned_1,\n                                      int64_t paths_26128,\n                                      int64_t flat_dim_26283, float res_26296,\n                                      int64_t res_26316, int64_t i_28321,\n                                      __global unsigned char *res_mem_28755,\n                                      __global unsigned char *res_mem_28756,\n                                      __global unsigned char *res_mem_28757,\n                                      __global unsigned char *res_mem_28758,\n                                      __global unsigned char *mem_28786,\n                                      __global unsigned char *mem_28802,\n                                      __global unsigned char *mem_28807,\n                                      __global unsigned char *mem_28809,\n                    ",
                   "                  __global unsigned char *mem_28812,\n                                      __global unsigned char *mem_28814,\n                                      int32_t num_threads_29351)\n{\n    #define segscan_group_sizze_28439 (testzisegscan_group_sizze_28438)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29359_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_29359_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29357_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29357_backing_aligned_1;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_29352;\n    int32_t local_tid_29353;\n    int64_t group_sizze_29356;\n    int32_t wave_sizze_29355;\n    int32_t group_tid_29354;\n    \n    global_tid_29352 = get_global_id(0);\n    local_tid_29353 = get_local_id(0);\n    group_sizze_29356 = get_local_size(0);\n    wave_sizze_29355 = LOCKSTEP_WIDTH;\n    group_tid_29354 = get_group_id(0);\n    \n    int32_t phys_tid_28444;\n    \n    phys_tid_28444 = global_tid_29352;\n    \n    __local char *scan_arr_mem_29357;\n    __local char *scan_arr_mem_29359;\n    \n    scan_arr_mem_29357 = (__local char *) scan_arr_mem_29357_backing_0;\n    scan_arr_mem_29359 = (__local char *) scan_arr_mem_29359_backing_1;\n    \n    bool x_26400;\n    float x_26401;\n    bool x_26402;\n    float x_26403;\n    \n    x_26400 = 0;\n    x_26401 = 0.0F;\n    for (int64_t j_29361 = 0; j_29361 < sdiv_up64(res_26316,\n                                                  sext_i32_i64(num_threads_29351));\n         j_29361++) {\n        int64_t chunk_offset_29362 = segscan_group_sizze_28439 * j_29361 +\n     ",
                   "           sext_i32_i64(group_tid_29354) * (segscan_group_sizze_28439 *\n                                                 sdiv_up64(res_26316,\n                                                           sext_i32_i64(num_threads_29351)));\n        int64_t flat_idx_29363 = chunk_offset_29362 +\n                sext_i32_i64(local_tid_29353);\n        int64_t gtid_28443 = flat_idx_29363;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_28443, res_26316)) {\n                int64_t x_26408 = ((__global int64_t *) mem_28807)[gtid_28443];\n                int64_t x_26409 = ((__global int64_t *) mem_28802)[gtid_28443];\n                bool x_26410 = ((__global bool *) mem_28809)[gtid_28443];\n                int64_t res_26413 = sub64(x_26408, 1);\n                bool x_26414 = sle64(0, x_26409);\n                bool y_26415 = slt64(x_26409, flat_dim_26283);\n                bool bounds_check_26416 = x_26414 && y_26415;\n                bool index_certs_26417;\n                \n                if (!bounds_check_26416) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 13) ==\n                            -1) {\n                            global_failure_args[0] = x_26409;\n                            global_failure_args[1] = flat_dim_26283;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int64_t new_index_26418 = squot64(x_26409, 45);\n                int64_t binop_y_26419 = 45 * new_index_26418;\n                int64_t new_index_26420 = x_26409 - binop_y_26419;\n                int64_t lifted_0_get_arg_26424 = ((__global\n                                                   int64_t *) res_mem_28757)[new_index_26420];\n                float lifted_0_get_arg_26425 = ((__global\n                                                 float *) res_mem_28758)[new",
                   "_index_26420];\n                float x_26426 = res_26296 / lifted_0_get_arg_26425;\n                float ceil_arg_26427 = x_26426 - 1.0F;\n                float res_26428;\n                \n                res_26428 = futrts_ceil32(ceil_arg_26427);\n                \n                int64_t res_26429 = fptosi_f32_i64(res_26428);\n                int64_t max_arg_26430 = sub64(lifted_0_get_arg_26424,\n                                              res_26429);\n                int64_t res_26431 = smax64(0, max_arg_26430);\n                bool cond_26432 = res_26431 == 0;\n                float res_26433;\n                \n                if (cond_26432) {\n                    res_26433 = 0.0F;\n                } else {\n                    float lifted_0_get_arg_26421 = ((__global\n                                                     float *) mem_28786)[i_28321 *\n                                                                         paths_26128 +\n                                                                         new_index_26418];\n                    float lifted_0_get_arg_26422 = ((__global\n                                                     float *) res_mem_28755)[new_index_26420];\n                    float lifted_0_get_arg_26423 = ((__global\n                                                     float *) res_mem_28756)[new_index_26420];\n                    float res_26434;\n                    \n                    res_26434 = futrts_ceil32(x_26426);\n                    \n                    float start_26435 = lifted_0_get_arg_26425 * res_26434;\n                    float res_26436;\n                    \n                    res_26436 = futrts_ceil32(ceil_arg_26427);\n                    \n                    int64_t res_26437 = fptosi_f32_i64(res_26436);\n                    int64_t max_arg_26438 = sub64(lifted_0_get_arg_26424,\n                                                  res_26437);\n                    int64_t res_26439 = smax64(0, max_arg_26438);\n                    int64_t",
                   " sizze_26440 = sub64(res_26439, 1);\n                    bool cond_26441 = res_26413 == 0;\n                    float res_26442;\n                    \n                    if (cond_26441) {\n                        res_26442 = 1.0F;\n                    } else {\n                        res_26442 = 0.0F;\n                    }\n                    \n                    bool cond_26443 = slt64(0, res_26413);\n                    float res_26444;\n                    \n                    if (cond_26443) {\n                        float y_26445 = lifted_0_get_arg_26422 *\n                              lifted_0_get_arg_26425;\n                        float res_26446 = res_26442 - y_26445;\n                        \n                        res_26444 = res_26446;\n                    } else {\n                        res_26444 = res_26442;\n                    }\n                    \n                    bool cond_26447 = res_26413 == sizze_26440;\n                    float res_26448;\n                    \n                    if (cond_26447) {\n                        float res_26449 = res_26444 - 1.0F;\n                        \n                        res_26448 = res_26449;\n                    } else {\n                        res_26448 = res_26444;\n                    }\n                    \n                    float res_26450 = lifted_0_get_arg_26423 * res_26448;\n                    float res_26451 = sitofp_i64_f32(res_26413);\n                    float y_26452 = lifted_0_get_arg_26425 * res_26451;\n                    float bondprice_arg_26453 = start_26435 + y_26452;\n                    float y_26454 = bondprice_arg_26453 - res_26296;\n                    float negate_arg_26455 = 1.0e-2F * y_26454;\n                    float exp_arg_26456 = 0.0F - negate_arg_26455;\n                    float res_26457 = fpow32(2.7182817F, exp_arg_26456);\n                    float x_26458 = 1.0F - res_26457;\n                    float B_26459 = x_26458 / 1.0e-2F;\n                    float x_26460 = B_26459 - bondprice",
                   "_arg_26453;\n                    float x_26461 = res_26296 + x_26460;\n                    float x_26462 = 4.4999997e-6F * x_26461;\n                    float A1_26463 = x_26462 / 1.0e-4F;\n                    float y_26464 = fpow32(B_26459, 2.0F);\n                    float x_26465 = 1.0000001e-6F * y_26464;\n                    float A2_26466 = x_26465 / 4.0e-2F;\n                    float exp_arg_26467 = A1_26463 - A2_26466;\n                    float res_26468 = fpow32(2.7182817F, exp_arg_26467);\n                    float negate_arg_26469 = lifted_0_get_arg_26421 * B_26459;\n                    float exp_arg_26470 = 0.0F - negate_arg_26469;\n                    float res_26471 = fpow32(2.7182817F, exp_arg_26470);\n                    float res_26472 = res_26468 * res_26471;\n                    float x_26473 = res_26450 * res_26472;\n                    float res_26474 = lifted_0_get_arg_26423 * x_26473;\n                    \n                    res_26433 = res_26474;\n                }\n                // write to-scan values to parameters\n                {\n                    x_26402 = x_26410;\n                    x_26403 = res_26433;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_28443, res_26316)) {\n                    x_26402 = 0;\n                    x_26403 = 0.0F;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                bool res_26404 = x_26400 || x_26402;\n                float res_26405;\n                \n                if (x_26402) {\n                    res_26405 = x_26403;\n                } else {\n                    float res_26406 = x_26401 + x_26403;\n                    \n                    res_26405 = res_26406;\n                }\n               ",
                   " ((__local\n                  bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)] =\n                    res_26404;\n                ((__local\n                  float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)] =\n                    res_26405;\n            }\n            \n          error_0:\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_failure)\n                return;\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool x_29364;\n            float x_29365;\n            bool x_29366;\n            float x_29367;\n            bool x_29371;\n            float x_29372;\n            bool x_29373;\n            float x_29374;\n            bool ltid_in_bounds_29378;\n            \n            ltid_in_bounds_29378 = slt64(sext_i32_i64(local_tid_29353),\n                                         segscan_group_sizze_28439);\n            \n            int32_t skip_threads_29379;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_29378) {\n                    x_29366 = ((volatile __local\n                                bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)];\n                    x_29367 = ((volatile __local\n                                float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)];\n                    if ((local_tid_29353 - squot32(local_tid_29353, 32) * 32) ==\n                        0) {\n                        x_29364 = x_29366;\n                        x_29365 = x_29367;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_29379 = 1;\n                while (slt32(skip_threads_29379, 32)) {\n                    if (sle32(skip_threads_29379, local_tid_29353 -\n                              squot32(local_tid_29353, 32) * 32) &&\n                        ltid_in_bounds_29378) {\n                        // read operands\n                        {\n                 ",
                   "           x_29364 = ((volatile __local\n                                        bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353) -\n                                                                    sext_i32_i64(skip_threads_29379)];\n                            x_29365 = ((volatile __local\n                                        float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353) -\n                                                                     sext_i32_i64(skip_threads_29379)];\n                        }\n                        // perform operation\n                        {\n                            bool res_29368 = x_29364 || x_29366;\n                            float res_29369;\n                            \n                            if (x_29366) {\n                                res_29369 = x_29367;\n                            } else {\n                                float res_29370 = x_29365 + x_29367;\n                                \n                                res_29369 = res_29370;\n                            }\n                            x_29364 = res_29368;\n                            x_29365 = res_29369;\n                        }\n                    }\n                    if (sle32(wave_sizze_29355, skip_threads_29379)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_29379, local_tid_29353 -\n                              squot32(local_tid_29353, 32) * 32) &&\n                        ltid_in_bounds_29378) {\n                        // write result\n                        {\n                            ((volatile __local\n                              bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)] =\n                                x_29364;\n                            x_29366 = x_29364;\n                            ((volatile __local\n                              float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)] =\n                               ",
                   " x_29365;\n                            x_29367 = x_29365;\n                        }\n                    }\n                    if (sle32(wave_sizze_29355, skip_threads_29379)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_29379 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_29353 - squot32(local_tid_29353, 32) * 32) ==\n                    31 && ltid_in_bounds_29378) {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29357)[sext_i32_i64(squot32(local_tid_29353,\n                                                                       32))] =\n                        x_29364;\n                    ((volatile __local\n                      float *) scan_arr_mem_29359)[sext_i32_i64(squot32(local_tid_29353,\n                                                                        32))] =\n                        x_29365;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_29380;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_29353, 32) == 0 &&\n                        ltid_in_bounds_29378) {\n                        x_29373 = ((volatile __local\n                                    bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)];\n                        x_29374 = ((volatile __local\n                                    float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)];\n                        if ((local_tid_29353 - squot32(local_tid_29353, 32) *\n                             32) == 0) {\n                            x_29371 = x_29373;\n                            x_29372 = x_29374;\n      ",
                   "                  }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29380 = 1;\n                    while (slt32(skip_threads_29380, 32)) {\n                        if (sle32(skip_threads_29380, local_tid_29353 -\n                                  squot32(local_tid_29353, 32) * 32) &&\n                            (squot32(local_tid_29353, 32) == 0 &&\n                             ltid_in_bounds_29378)) {\n                            // read operands\n                            {\n                                x_29371 = ((volatile __local\n                                            bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353) -\n                                                                        sext_i32_i64(skip_threads_29380)];\n                                x_29372 = ((volatile __local\n                                            float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353) -\n                                                                         sext_i32_i64(skip_threads_29380)];\n                            }\n                            // perform operation\n                            {\n                                bool res_29375 = x_29371 || x_29373;\n                                float res_29376;\n                                \n                                if (x_29373) {\n                                    res_29376 = x_29374;\n                                } else {\n                                    float res_29377 = x_29372 + x_29374;\n                                    \n                                    res_29376 = res_29377;\n                                }\n                                x_29371 = res_29375;\n                                x_29372 = res_29376;\n                            }\n                        }\n                        if (sle32(wave_sizze_29355, skip_threads_29380)) {\n                        ",
                   "    barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29380, local_tid_29353 -\n                                  squot32(local_tid_29353, 32) * 32) &&\n                            (squot32(local_tid_29353, 32) == 0 &&\n                             ltid_in_bounds_29378)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)] =\n                                    x_29371;\n                                x_29373 = x_29371;\n                                ((volatile __local\n                                  float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)] =\n                                    x_29372;\n                                x_29374 = x_29372;\n                            }\n                        }\n                        if (sle32(wave_sizze_29355, skip_threads_29380)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29380 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_29353, 32) == 0 ||\n                      !ltid_in_bounds_29378)) {\n                    // read operands\n                    {\n                        x_29366 = x_29364;\n                        x_29367 = x_29365;\n                        x_29364 = ((__local\n                                    bool *) scan_arr_mem_29357)[sext_i32_i64(squot32(local_tid_29353,\n                                                                                     32)) -\n                                                                1];\n                        x_29365 = ((__local\n                                    float *) scan_arr_mem_29359)[sext_i32_i64(squot3",
                   "2(local_tid_29353,\n                                                                                      32)) -\n                                                                 1];\n                    }\n                    // perform operation\n                    {\n                        bool res_29368 = x_29364 || x_29366;\n                        float res_29369;\n                        \n                        if (x_29366) {\n                            res_29369 = x_29367;\n                        } else {\n                            float res_29370 = x_29365 + x_29367;\n                            \n                            res_29369 = res_29370;\n                        }\n                        x_29364 = res_29368;\n                        x_29365 = res_29369;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)] =\n                            x_29364;\n                        ((__local\n                          float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)] =\n                            x_29365;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_29353, 32) == 0) {\n                    ((__local\n                      bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)] =\n                        x_29366;\n                    ((__local\n                      float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)] =\n                        x_29367;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_28443, res_26316)) {\n                    ((__global bool *) mem_28812)[gtid_28443] = ((__local\n                                   ",
                   "                               bool *) scan_arr_mem_29357)[sext_i32_i64(local_tid_29353)];\n                    ((__global float *) mem_28814)[gtid_28443] = ((__local\n                                                                   float *) scan_arr_mem_29359)[sext_i32_i64(local_tid_29353)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_29381 = 0;\n                bool should_load_carry_29382 = local_tid_29353 == 0 &&\n                     !crosses_segment_29381;\n                \n                if (should_load_carry_29382) {\n                    x_26400 = ((__local\n                                bool *) scan_arr_mem_29357)[segscan_group_sizze_28439 -\n                                                            1];\n                    x_26401 = ((__local\n                                float *) scan_arr_mem_29359)[segscan_group_sizze_28439 -\n                                                             1];\n                }\n                if (!should_load_carry_29382) {\n                    x_26400 = 0;\n                    x_26401 = 0.0F;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_28439\n}\n__kernel void testziscan_stage1_28496(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29424_backing_aligned_0,\n                                      int64_t res_26316, __global\n                                      unsigned char *mem_28809, __global\n                                      unsigned char *mem_28817,\n                                      int32_t num_threads_29418)\n{\n    #define segscan_group_sizze_28491 (testzisegscan_group_sizze_28490)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block",
                   "_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29424_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29424_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29419;\n    int32_t local_tid_29420;\n    int64_t group_sizze_29423;\n    int32_t wave_sizze_29422;\n    int32_t group_tid_29421;\n    \n    global_tid_29419 = get_global_id(0);\n    local_tid_29420 = get_local_id(0);\n    group_sizze_29423 = get_local_size(0);\n    wave_sizze_29422 = LOCKSTEP_WIDTH;\n    group_tid_29421 = get_group_id(0);\n    \n    int32_t phys_tid_28496;\n    \n    phys_tid_28496 = global_tid_29419;\n    \n    __local char *scan_arr_mem_29424;\n    \n    scan_arr_mem_29424 = (__local char *) scan_arr_mem_29424_backing_0;\n    \n    int64_t x_26498;\n    int64_t x_26499;\n    \n    x_26498 = 0;\n    for (int64_t j_29426 = 0; j_29426 < sdiv_up64(res_26316,\n                                                  sext_i32_i64(num_threads_29418));\n         j_29426++) {\n        int64_t chunk_offset_29427 = segscan_group_sizze_28491 * j_29426 +\n                sext_i32_i64(group_tid_29421) * (segscan_group_sizze_28491 *\n                                                 sdiv_up64(res_26316,\n                                                           sext_i32_i64(num_threads_29418)));\n        int64_t flat_idx_29428 = chunk_offset_29427 +\n                sext_i32_i64(local_tid_29420);\n        int64_t gtid_28495 = flat_idx_29428;\n        \n        // threads in bounds read input\n        {\n            if (slt64(gtid_28495, res_26316)) {\n                int64_t i_p_o_28681 = add64(1, gtid_28495);\n                int64_t rot_i_28682 = smod64(i_p_o_28681, res_26316);\n                bool x_26501 = ((__global bool *) mem_28809)[rot_i_28682];\n                int64_t res_26502 = btoi_bool_i64(x_26501);\n                \n                // write to-scan values to parameters\n                {\n                    x_26499 = res_2650",
                   "2;\n                }\n                // write mapped values results to global memory\n                { }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt64(gtid_28495, res_26316)) {\n                    x_26499 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                int64_t res_26500 = add64(x_26498, x_26499);\n                \n                ((__local\n                  int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)] =\n                    res_26500;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int64_t x_29429;\n            int64_t x_29430;\n            int64_t x_29432;\n            int64_t x_29433;\n            bool ltid_in_bounds_29435;\n            \n            ltid_in_bounds_29435 = slt64(sext_i32_i64(local_tid_29420),\n                                         segscan_group_sizze_28491);\n            \n            int32_t skip_threads_29436;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_29435) {\n                    x_29430 = ((volatile __local\n                                int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)];\n                    if ((local_tid_29420 - squot32(local_tid_29420, 32) * 32) ==\n                        0) {\n                        x_29429 = x_29430;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_29436 = 1;\n                while (slt32(skip_threads_29436, 32)) {\n                    if (sle32(skip_threads_29436, local_tid_29420 -\n                              squot32(local_tid_29420, 32) * 32) &&\n                        ltid_in_bounds_29435) {\n                        // read operands\n                     ",
                   "   {\n                            x_29429 = ((volatile __local\n                                        int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420) -\n                                                                       sext_i32_i64(skip_threads_29436)];\n                        }\n                        // perform operation\n                        {\n                            int64_t res_29431 = add64(x_29429, x_29430);\n                            \n                            x_29429 = res_29431;\n                        }\n                    }\n                    if (sle32(wave_sizze_29422, skip_threads_29436)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_29436, local_tid_29420 -\n                              squot32(local_tid_29420, 32) * 32) &&\n                        ltid_in_bounds_29435) {\n                        // write result\n                        {\n                            ((volatile __local\n                              int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)] =\n                                x_29429;\n                            x_29430 = x_29429;\n                        }\n                    }\n                    if (sle32(wave_sizze_29422, skip_threads_29436)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_29436 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_29420 - squot32(local_tid_29420, 32) * 32) ==\n                    31 && ltid_in_bounds_29435) {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29424)[sext_i32_i64(squot32(local_tid_29420,\n                                                                          32))] =\n                        x_29429;\n                }\n            }\n   ",
                   "         barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_29437;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_29420, 32) == 0 &&\n                        ltid_in_bounds_29435) {\n                        x_29433 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)];\n                        if ((local_tid_29420 - squot32(local_tid_29420, 32) *\n                             32) == 0) {\n                            x_29432 = x_29433;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29437 = 1;\n                    while (slt32(skip_threads_29437, 32)) {\n                        if (sle32(skip_threads_29437, local_tid_29420 -\n                                  squot32(local_tid_29420, 32) * 32) &&\n                            (squot32(local_tid_29420, 32) == 0 &&\n                             ltid_in_bounds_29435)) {\n                            // read operands\n                            {\n                                x_29432 = ((volatile __local\n                                            int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420) -\n                                                                           sext_i32_i64(skip_threads_29437)];\n                            }\n                            // perform operation\n                            {\n                                int64_t res_29434 = add64(x_29432, x_29433);\n                                \n                                x_29432 = res_29434;\n                            }\n                        }\n                        if (sle32(wave_sizze_29422, skip_threads_29437)) {\n                           ",
                   " barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29437, local_tid_29420 -\n                                  squot32(local_tid_29420, 32) * 32) &&\n                            (squot32(local_tid_29420, 32) == 0 &&\n                             ltid_in_bounds_29435)) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)] =\n                                    x_29432;\n                                x_29433 = x_29432;\n                            }\n                        }\n                        if (sle32(wave_sizze_29422, skip_threads_29437)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29437 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_29420, 32) == 0 ||\n                      !ltid_in_bounds_29435)) {\n                    // read operands\n                    {\n                        x_29430 = x_29429;\n                        x_29429 = ((__local\n                                    int64_t *) scan_arr_mem_29424)[sext_i32_i64(squot32(local_tid_29420,\n                                                                                        32)) -\n                                                                   1];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_29431 = add64(x_29429, x_29430);\n                        \n                        x_29429 = res_29431;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          int64_t *) scan_arr_mem_29424)[sext",
                   "_i32_i64(local_tid_29420)] =\n                            x_29429;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_29420, 32) == 0) {\n                    ((__local\n                      int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)] =\n                        x_29430;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt64(gtid_28495, res_26316)) {\n                    ((__global int64_t *) mem_28817)[gtid_28495] = ((__local\n                                                                     int64_t *) scan_arr_mem_29424)[sext_i32_i64(local_tid_29420)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_29438 = 0;\n                bool should_load_carry_29439 = local_tid_29420 == 0 &&\n                     !crosses_segment_29438;\n                \n                if (should_load_carry_29439) {\n                    x_26498 = ((__local\n                                int64_t *) scan_arr_mem_29424)[segscan_group_sizze_28491 -\n                                                               1];\n                }\n                if (!should_load_carry_29439) {\n                    x_26498 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_28491\n}\n__kernel void testziscan_stage2_28395(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29007_backing_aligned_0,\n                                      int64_t flat_dim_26283, __global\n                             ",
                   "         unsigned char *mem_28789,\n                                      int64_t stage1_num_groups_28979,\n                                      int32_t num_threads_28980)\n{\n    #define segscan_group_sizze_28390 (testzisegscan_group_sizze_28389)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29007_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29007_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29002;\n    int32_t local_tid_29003;\n    int64_t group_sizze_29006;\n    int32_t wave_sizze_29005;\n    int32_t group_tid_29004;\n    \n    global_tid_29002 = get_global_id(0);\n    local_tid_29003 = get_local_id(0);\n    group_sizze_29006 = get_local_size(0);\n    wave_sizze_29005 = LOCKSTEP_WIDTH;\n    group_tid_29004 = get_group_id(0);\n    \n    int32_t phys_tid_28395;\n    \n    phys_tid_28395 = global_tid_29002;\n    \n    __local char *scan_arr_mem_29007;\n    \n    scan_arr_mem_29007 = (__local char *) scan_arr_mem_29007_backing_0;\n    \n    int64_t flat_idx_29009;\n    \n    flat_idx_29009 = (sext_i32_i64(local_tid_29003) + 1) *\n        (segscan_group_sizze_28390 * sdiv_up64(flat_dim_26283,\n                                               sext_i32_i64(num_threads_28980))) -\n        1;\n    \n    int64_t gtid_28394;\n    \n    gtid_28394 = flat_idx_29009;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_28394, flat_dim_26283)) {\n            ((__local\n              int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] =\n                ((__global int64_t *) mem_28789)[gtid_28394];\n        } else {\n            ((__local\n              int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int64_t x_26302;\n    int64_t x_26303;\n    int64_t x_29010;\n    int64_t x_29011;\n    bo",
                   "ol ltid_in_bounds_29013;\n    \n    ltid_in_bounds_29013 = slt64(sext_i32_i64(local_tid_29003),\n                                 stage1_num_groups_28979);\n    \n    int32_t skip_threads_29014;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_29013) {\n            x_26303 = ((volatile __local\n                        int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)];\n            if ((local_tid_29003 - squot32(local_tid_29003, 32) * 32) == 0) {\n                x_26302 = x_26303;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_29014 = 1;\n        while (slt32(skip_threads_29014, 32)) {\n            if (sle32(skip_threads_29014, local_tid_29003 -\n                      squot32(local_tid_29003, 32) * 32) &&\n                ltid_in_bounds_29013) {\n                // read operands\n                {\n                    x_26302 = ((volatile __local\n                                int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003) -\n                                                               sext_i32_i64(skip_threads_29014)];\n                }\n                // perform operation\n                {\n                    int64_t res_26304 = add64(x_26302, x_26303);\n                    \n                    x_26302 = res_26304;\n                }\n            }\n            if (sle32(wave_sizze_29005, skip_threads_29014)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_29014, local_tid_29003 -\n                      squot32(local_tid_29003, 32) * 32) &&\n                ltid_in_bounds_29013) {\n                // write result\n                {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] =\n                        x_26302;\n                    x_26303 = x_26302;\n                }\n            }\n            if (sle32(wave_sizze_29005, skip_threads_29014)) {\n        ",
                   "        barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_29014 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_29003 - squot32(local_tid_29003, 32) * 32) == 31 &&\n            ltid_in_bounds_29013) {\n            ((volatile __local\n              int64_t *) scan_arr_mem_29007)[sext_i32_i64(squot32(local_tid_29003,\n                                                                  32))] =\n                x_26302;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_29015;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_29003, 32) == 0 && ltid_in_bounds_29013) {\n                x_29011 = ((volatile __local\n                            int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)];\n                if ((local_tid_29003 - squot32(local_tid_29003, 32) * 32) ==\n                    0) {\n                    x_29010 = x_29011;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_29015 = 1;\n            while (slt32(skip_threads_29015, 32)) {\n                if (sle32(skip_threads_29015, local_tid_29003 -\n                          squot32(local_tid_29003, 32) * 32) &&\n                    (squot32(local_tid_29003, 32) == 0 &&\n                     ltid_in_bounds_29013)) {\n                    // read operands\n                    {\n                        x_29010 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003) -\n                                                                   sext_i32_i64(skip_threads_29015)];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_29012 = add64(",
                   "x_29010, x_29011);\n                        \n                        x_29010 = res_29012;\n                    }\n                }\n                if (sle32(wave_sizze_29005, skip_threads_29015)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_29015, local_tid_29003 -\n                          squot32(local_tid_29003, 32) * 32) &&\n                    (squot32(local_tid_29003, 32) == 0 &&\n                     ltid_in_bounds_29013)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] =\n                            x_29010;\n                        x_29011 = x_29010;\n                    }\n                }\n                if (sle32(wave_sizze_29005, skip_threads_29015)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_29015 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_29003, 32) == 0 || !ltid_in_bounds_29013)) {\n            // read operands\n            {\n                x_26303 = x_26302;\n                x_26302 = ((__local\n                            int64_t *) scan_arr_mem_29007)[sext_i32_i64(squot32(local_tid_29003,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                int64_t res_26304 = add64(x_26302, x_26303);\n                \n                x_26302 = res_26304;\n            }\n            // write final result\n            {\n                ((__local\n                  int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] =\n                    x_26302;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correc",
                   "t values for first block\n    {\n        if (squot32(local_tid_29003, 32) == 0) {\n            ((__local\n              int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)] =\n                x_26303;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_28394, flat_dim_26283)) {\n            ((__global int64_t *) mem_28789)[gtid_28394] = ((__local\n                                                             int64_t *) scan_arr_mem_29007)[sext_i32_i64(local_tid_29003)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_28390\n}\n__kernel void testziscan_stage2_28428(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29256_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29254_backing_aligned_1,\n                                      int64_t res_26316, __global\n                                      unsigned char *mem_28800, __global\n                                      unsigned char *mem_28802,\n                                      int64_t stage1_num_groups_29216,\n                                      int32_t num_threads_29217)\n{\n    #define segscan_group_sizze_28423 (testzisegscan_group_sizze_28422)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29256_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_29256_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29254_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29254_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29249;\n    int32_t local_tid_29250;\n    int64_t group_sizze_2925",
                   "3;\n    int32_t wave_sizze_29252;\n    int32_t group_tid_29251;\n    \n    global_tid_29249 = get_global_id(0);\n    local_tid_29250 = get_local_id(0);\n    group_sizze_29253 = get_local_size(0);\n    wave_sizze_29252 = LOCKSTEP_WIDTH;\n    group_tid_29251 = get_group_id(0);\n    \n    int32_t phys_tid_28428;\n    \n    phys_tid_28428 = global_tid_29249;\n    \n    __local char *scan_arr_mem_29254;\n    __local char *scan_arr_mem_29256;\n    \n    scan_arr_mem_29254 = (__local char *) scan_arr_mem_29254_backing_0;\n    scan_arr_mem_29256 = (__local char *) scan_arr_mem_29256_backing_1;\n    \n    int64_t flat_idx_29258;\n    \n    flat_idx_29258 = (sext_i32_i64(local_tid_29250) + 1) *\n        (segscan_group_sizze_28423 * sdiv_up64(res_26316,\n                                               sext_i32_i64(num_threads_29217))) -\n        1;\n    \n    int64_t gtid_28427;\n    \n    gtid_28427 = flat_idx_29258;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_28427, res_26316)) {\n            ((__local\n              bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] =\n                ((__global bool *) mem_28800)[gtid_28427];\n            ((__local\n              int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] =\n                ((__global int64_t *) mem_28802)[gtid_28427];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] = 0;\n            ((__local\n              int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_26335;\n    int64_t x_26336;\n    bool x_26337;\n    int64_t x_26338;\n    bool x_29259;\n    int64_t x_29260;\n    bool x_29261;\n    int64_t x_29262;\n    bool ltid_in_bounds_29266;\n    \n    ltid_in_bounds_29266 = slt64(sext_i32_i64(local_tid_29250),\n                                 stage1_num_groups_29216);\n    \n    int32_t skip_threads_29267;\n    \n    // read input for in-block scan\n    {\n  ",
                   "      if (ltid_in_bounds_29266) {\n            x_26337 = ((volatile __local\n                        bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)];\n            x_26338 = ((volatile __local\n                        int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)];\n            if ((local_tid_29250 - squot32(local_tid_29250, 32) * 32) == 0) {\n                x_26335 = x_26337;\n                x_26336 = x_26338;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_29267 = 1;\n        while (slt32(skip_threads_29267, 32)) {\n            if (sle32(skip_threads_29267, local_tid_29250 -\n                      squot32(local_tid_29250, 32) * 32) &&\n                ltid_in_bounds_29266) {\n                // read operands\n                {\n                    x_26335 = ((volatile __local\n                                bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250) -\n                                                            sext_i32_i64(skip_threads_29267)];\n                    x_26336 = ((volatile __local\n                                int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250) -\n                                                               sext_i32_i64(skip_threads_29267)];\n                }\n                // perform operation\n                {\n                    bool res_26339 = x_26335 || x_26337;\n                    int64_t res_26340;\n                    \n                    if (x_26337) {\n                        res_26340 = x_26338;\n                    } else {\n                        int64_t res_26341 = add64(x_26336, x_26338);\n                        \n                        res_26340 = res_26341;\n                    }\n                    x_26335 = res_26339;\n                    x_26336 = res_26340;\n                }\n            }\n            if (sle32(wave_sizze_29252, skip_threads_29267)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n         ",
                   "   if (sle32(skip_threads_29267, local_tid_29250 -\n                      squot32(local_tid_29250, 32) * 32) &&\n                ltid_in_bounds_29266) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] =\n                        x_26335;\n                    x_26337 = x_26335;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] =\n                        x_26336;\n                    x_26338 = x_26336;\n                }\n            }\n            if (sle32(wave_sizze_29252, skip_threads_29267)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_29267 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_29250 - squot32(local_tid_29250, 32) * 32) == 31 &&\n            ltid_in_bounds_29266) {\n            ((volatile __local\n              bool *) scan_arr_mem_29254)[sext_i32_i64(squot32(local_tid_29250,\n                                                               32))] = x_26335;\n            ((volatile __local\n              int64_t *) scan_arr_mem_29256)[sext_i32_i64(squot32(local_tid_29250,\n                                                                  32))] =\n                x_26336;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_29268;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_29250, 32) == 0 && ltid_in_bounds_29266) {\n                x_29261 = ((volatile __local\n                            bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)];\n                x_29262 = ((volatile __local\n                            int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)]",
                   ";\n                if ((local_tid_29250 - squot32(local_tid_29250, 32) * 32) ==\n                    0) {\n                    x_29259 = x_29261;\n                    x_29260 = x_29262;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_29268 = 1;\n            while (slt32(skip_threads_29268, 32)) {\n                if (sle32(skip_threads_29268, local_tid_29250 -\n                          squot32(local_tid_29250, 32) * 32) &&\n                    (squot32(local_tid_29250, 32) == 0 &&\n                     ltid_in_bounds_29266)) {\n                    // read operands\n                    {\n                        x_29259 = ((volatile __local\n                                    bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250) -\n                                                                sext_i32_i64(skip_threads_29268)];\n                        x_29260 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250) -\n                                                                   sext_i32_i64(skip_threads_29268)];\n                    }\n                    // perform operation\n                    {\n                        bool res_29263 = x_29259 || x_29261;\n                        int64_t res_29264;\n                        \n                        if (x_29261) {\n                            res_29264 = x_29262;\n                        } else {\n                            int64_t res_29265 = add64(x_29260, x_29262);\n                            \n                            res_29264 = res_29265;\n                        }\n                        x_29259 = res_29263;\n                        x_29260 = res_29264;\n                    }\n                }\n                if (sle32(wave_sizze_29252, skip_threads_29268)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_29268, loca",
                   "l_tid_29250 -\n                          squot32(local_tid_29250, 32) * 32) &&\n                    (squot32(local_tid_29250, 32) == 0 &&\n                     ltid_in_bounds_29266)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] =\n                            x_29259;\n                        x_29261 = x_29259;\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] =\n                            x_29260;\n                        x_29262 = x_29260;\n                    }\n                }\n                if (sle32(wave_sizze_29252, skip_threads_29268)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_29268 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_29250, 32) == 0 || !ltid_in_bounds_29266)) {\n            // read operands\n            {\n                x_26337 = x_26335;\n                x_26338 = x_26336;\n                x_26335 = ((__local\n                            bool *) scan_arr_mem_29254)[sext_i32_i64(squot32(local_tid_29250,\n                                                                             32)) -\n                                                        1];\n                x_26336 = ((__local\n                            int64_t *) scan_arr_mem_29256)[sext_i32_i64(squot32(local_tid_29250,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                bool res_26339 = x_26335 || x_26337;\n                int64_t res_26340;\n                \n                if (x_26337) {\n                    res_26340 = x_26338;\n                }",
                   " else {\n                    int64_t res_26341 = add64(x_26336, x_26338);\n                    \n                    res_26340 = res_26341;\n                }\n                x_26335 = res_26339;\n                x_26336 = res_26340;\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] =\n                    x_26335;\n                ((__local\n                  int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] =\n                    x_26336;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_29250, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)] =\n                x_26337;\n            ((__local\n              int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)] =\n                x_26338;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_28427, res_26316)) {\n            ((__global bool *) mem_28800)[gtid_28427] = ((__local\n                                                          bool *) scan_arr_mem_29254)[sext_i32_i64(local_tid_29250)];\n            ((__global int64_t *) mem_28802)[gtid_28427] = ((__local\n                                                             int64_t *) scan_arr_mem_29256)[sext_i32_i64(local_tid_29250)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_28423\n}\n__kernel void testziscan_stage2_28436(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29323_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29321_backing_aligned_1,\n                                      int64_t res_26316, __global\n     ",
                   "                                 unsigned char *mem_28805, __global\n                                      unsigned char *mem_28807,\n                                      int64_t stage1_num_groups_29283,\n                                      int32_t num_threads_29284)\n{\n    #define segscan_group_sizze_28431 (testzisegscan_group_sizze_28430)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29323_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_29323_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29321_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29321_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29316;\n    int32_t local_tid_29317;\n    int64_t group_sizze_29320;\n    int32_t wave_sizze_29319;\n    int32_t group_tid_29318;\n    \n    global_tid_29316 = get_global_id(0);\n    local_tid_29317 = get_local_id(0);\n    group_sizze_29320 = get_local_size(0);\n    wave_sizze_29319 = LOCKSTEP_WIDTH;\n    group_tid_29318 = get_group_id(0);\n    \n    int32_t phys_tid_28436;\n    \n    phys_tid_28436 = global_tid_29316;\n    \n    __local char *scan_arr_mem_29321;\n    __local char *scan_arr_mem_29323;\n    \n    scan_arr_mem_29321 = (__local char *) scan_arr_mem_29321_backing_0;\n    scan_arr_mem_29323 = (__local char *) scan_arr_mem_29323_backing_1;\n    \n    int64_t flat_idx_29325;\n    \n    flat_idx_29325 = (sext_i32_i64(local_tid_29317) + 1) *\n        (segscan_group_sizze_28431 * sdiv_up64(res_26316,\n                                               sext_i32_i64(num_threads_29284))) -\n        1;\n    \n    int64_t gtid_28435;\n    \n    gtid_28435 = flat_idx_29325;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_28435, res_26316)) {\n            ((__local\n              bool *) sc",
                   "an_arr_mem_29321)[sext_i32_i64(local_tid_29317)] =\n                ((__global bool *) mem_28805)[gtid_28435];\n            ((__local\n              int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] =\n                ((__global int64_t *) mem_28807)[gtid_28435];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] = 0;\n            ((__local\n              int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_26374;\n    int64_t x_26375;\n    bool x_26376;\n    int64_t x_26377;\n    bool x_29326;\n    int64_t x_29327;\n    bool x_29328;\n    int64_t x_29329;\n    bool ltid_in_bounds_29333;\n    \n    ltid_in_bounds_29333 = slt64(sext_i32_i64(local_tid_29317),\n                                 stage1_num_groups_29283);\n    \n    int32_t skip_threads_29334;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_29333) {\n            x_26376 = ((volatile __local\n                        bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)];\n            x_26377 = ((volatile __local\n                        int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)];\n            if ((local_tid_29317 - squot32(local_tid_29317, 32) * 32) == 0) {\n                x_26374 = x_26376;\n                x_26375 = x_26377;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_29334 = 1;\n        while (slt32(skip_threads_29334, 32)) {\n            if (sle32(skip_threads_29334, local_tid_29317 -\n                      squot32(local_tid_29317, 32) * 32) &&\n                ltid_in_bounds_29333) {\n                // read operands\n                {\n                    x_26374 = ((volatile __local\n                                bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317) -\n                                                            sext_i32_i64(skip_threads_29334)];\n  ",
                   "                  x_26375 = ((volatile __local\n                                int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317) -\n                                                               sext_i32_i64(skip_threads_29334)];\n                }\n                // perform operation\n                {\n                    bool res_26378 = x_26374 || x_26376;\n                    int64_t res_26379;\n                    \n                    if (x_26376) {\n                        res_26379 = x_26377;\n                    } else {\n                        int64_t res_26380 = add64(x_26375, x_26377);\n                        \n                        res_26379 = res_26380;\n                    }\n                    x_26374 = res_26378;\n                    x_26375 = res_26379;\n                }\n            }\n            if (sle32(wave_sizze_29319, skip_threads_29334)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_29334, local_tid_29317 -\n                      squot32(local_tid_29317, 32) * 32) &&\n                ltid_in_bounds_29333) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] =\n                        x_26374;\n                    x_26376 = x_26374;\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] =\n                        x_26375;\n                    x_26377 = x_26375;\n                }\n            }\n            if (sle32(wave_sizze_29319, skip_threads_29334)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_29334 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_29317 - squot32(local_tid_29317, 32) * 32) == 31 &&\n            ltid_in_bounds_29333) {\n            ((volatile __local\n      ",
                   "        bool *) scan_arr_mem_29321)[sext_i32_i64(squot32(local_tid_29317,\n                                                               32))] = x_26374;\n            ((volatile __local\n              int64_t *) scan_arr_mem_29323)[sext_i32_i64(squot32(local_tid_29317,\n                                                                  32))] =\n                x_26375;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_29335;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_29317, 32) == 0 && ltid_in_bounds_29333) {\n                x_29328 = ((volatile __local\n                            bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)];\n                x_29329 = ((volatile __local\n                            int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)];\n                if ((local_tid_29317 - squot32(local_tid_29317, 32) * 32) ==\n                    0) {\n                    x_29326 = x_29328;\n                    x_29327 = x_29329;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_29335 = 1;\n            while (slt32(skip_threads_29335, 32)) {\n                if (sle32(skip_threads_29335, local_tid_29317 -\n                          squot32(local_tid_29317, 32) * 32) &&\n                    (squot32(local_tid_29317, 32) == 0 &&\n                     ltid_in_bounds_29333)) {\n                    // read operands\n                    {\n                        x_29326 = ((volatile __local\n                                    bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317) -\n                                                                sext_i32_i64(skip_threads_29335)];\n                        x_29327 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29323)[sext_i32_i64(lo",
                   "cal_tid_29317) -\n                                                                   sext_i32_i64(skip_threads_29335)];\n                    }\n                    // perform operation\n                    {\n                        bool res_29330 = x_29326 || x_29328;\n                        int64_t res_29331;\n                        \n                        if (x_29328) {\n                            res_29331 = x_29329;\n                        } else {\n                            int64_t res_29332 = add64(x_29327, x_29329);\n                            \n                            res_29331 = res_29332;\n                        }\n                        x_29326 = res_29330;\n                        x_29327 = res_29331;\n                    }\n                }\n                if (sle32(wave_sizze_29319, skip_threads_29335)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_29335, local_tid_29317 -\n                          squot32(local_tid_29317, 32) * 32) &&\n                    (squot32(local_tid_29317, 32) == 0 &&\n                     ltid_in_bounds_29333)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] =\n                            x_29326;\n                        x_29328 = x_29326;\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] =\n                            x_29327;\n                        x_29329 = x_29327;\n                    }\n                }\n                if (sle32(wave_sizze_29319, skip_threads_29335)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_29335 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_29317, 32) == 0 || !lt",
                   "id_in_bounds_29333)) {\n            // read operands\n            {\n                x_26376 = x_26374;\n                x_26377 = x_26375;\n                x_26374 = ((__local\n                            bool *) scan_arr_mem_29321)[sext_i32_i64(squot32(local_tid_29317,\n                                                                             32)) -\n                                                        1];\n                x_26375 = ((__local\n                            int64_t *) scan_arr_mem_29323)[sext_i32_i64(squot32(local_tid_29317,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                bool res_26378 = x_26374 || x_26376;\n                int64_t res_26379;\n                \n                if (x_26376) {\n                    res_26379 = x_26377;\n                } else {\n                    int64_t res_26380 = add64(x_26375, x_26377);\n                    \n                    res_26379 = res_26380;\n                }\n                x_26374 = res_26378;\n                x_26375 = res_26379;\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] =\n                    x_26374;\n                ((__local\n                  int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] =\n                    x_26375;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_29317, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)] =\n                x_26376;\n            ((__local\n              int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)] =\n                x_26377;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds wri",
                   "te scanned carries\n    {\n        if (slt64(gtid_28435, res_26316)) {\n            ((__global bool *) mem_28805)[gtid_28435] = ((__local\n                                                          bool *) scan_arr_mem_29321)[sext_i32_i64(local_tid_29317)];\n            ((__global int64_t *) mem_28807)[gtid_28435] = ((__local\n                                                             int64_t *) scan_arr_mem_29323)[sext_i32_i64(local_tid_29317)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_28431\n}\n__kernel void testziscan_stage2_28444(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29390_backing_aligned_0,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29388_backing_aligned_1,\n                                      int64_t res_26316, __global\n                                      unsigned char *mem_28812, __global\n                                      unsigned char *mem_28814,\n                                      int64_t stage1_num_groups_29350,\n                                      int32_t num_threads_29351)\n{\n    #define segscan_group_sizze_28439 (testzisegscan_group_sizze_28438)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29390_backing_1 =\n                          (__local volatile\n                           char *) scan_arr_mem_29390_backing_aligned_0;\n    __local volatile char *restrict scan_arr_mem_29388_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29388_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29383;\n    int32_t local_tid_29384;\n    int64_t group_sizze_29387;\n    int32_t wave_sizze_29386;\n    int32_t group_tid_29385;\n    \n    global_tid_29383 = get_global_id(",
                   "0);\n    local_tid_29384 = get_local_id(0);\n    group_sizze_29387 = get_local_size(0);\n    wave_sizze_29386 = LOCKSTEP_WIDTH;\n    group_tid_29385 = get_group_id(0);\n    \n    int32_t phys_tid_28444;\n    \n    phys_tid_28444 = global_tid_29383;\n    \n    __local char *scan_arr_mem_29388;\n    __local char *scan_arr_mem_29390;\n    \n    scan_arr_mem_29388 = (__local char *) scan_arr_mem_29388_backing_0;\n    scan_arr_mem_29390 = (__local char *) scan_arr_mem_29390_backing_1;\n    \n    int64_t flat_idx_29392;\n    \n    flat_idx_29392 = (sext_i32_i64(local_tid_29384) + 1) *\n        (segscan_group_sizze_28439 * sdiv_up64(res_26316,\n                                               sext_i32_i64(num_threads_29351))) -\n        1;\n    \n    int64_t gtid_28443;\n    \n    gtid_28443 = flat_idx_29392;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_28443, res_26316)) {\n            ((__local\n              bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] =\n                ((__global bool *) mem_28812)[gtid_28443];\n            ((__local\n              float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                ((__global float *) mem_28814)[gtid_28443];\n        } else {\n            ((__local\n              bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] = 0;\n            ((__local\n              float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                0.0F;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    bool x_26400;\n    float x_26401;\n    bool x_26402;\n    float x_26403;\n    bool x_29393;\n    float x_29394;\n    bool x_29395;\n    float x_29396;\n    bool ltid_in_bounds_29400;\n    \n    ltid_in_bounds_29400 = slt64(sext_i32_i64(local_tid_29384),\n                                 stage1_num_groups_29350);\n    \n    int32_t skip_threads_29401;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_29400) {\n            x_26402 = ((volatile __local\n                        ",
                   "bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)];\n            x_26403 = ((volatile __local\n                        float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)];\n            if ((local_tid_29384 - squot32(local_tid_29384, 32) * 32) == 0) {\n                x_26400 = x_26402;\n                x_26401 = x_26403;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_29401 = 1;\n        while (slt32(skip_threads_29401, 32)) {\n            if (sle32(skip_threads_29401, local_tid_29384 -\n                      squot32(local_tid_29384, 32) * 32) &&\n                ltid_in_bounds_29400) {\n                // read operands\n                {\n                    x_26400 = ((volatile __local\n                                bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384) -\n                                                            sext_i32_i64(skip_threads_29401)];\n                    x_26401 = ((volatile __local\n                                float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384) -\n                                                             sext_i32_i64(skip_threads_29401)];\n                }\n                // perform operation\n                {\n                    bool res_26404 = x_26400 || x_26402;\n                    float res_26405;\n                    \n                    if (x_26402) {\n                        res_26405 = x_26403;\n                    } else {\n                        float res_26406 = x_26401 + x_26403;\n                        \n                        res_26405 = res_26406;\n                    }\n                    x_26400 = res_26404;\n                    x_26401 = res_26405;\n                }\n            }\n            if (sle32(wave_sizze_29386, skip_threads_29401)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_29401, local_tid_29384 -\n                      squot32(local_tid_29384, 32) * 32) &&\n    ",
                   "            ltid_in_bounds_29400) {\n                // write result\n                {\n                    ((volatile __local\n                      bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] =\n                        x_26400;\n                    x_26402 = x_26400;\n                    ((volatile __local\n                      float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                        x_26401;\n                    x_26403 = x_26401;\n                }\n            }\n            if (sle32(wave_sizze_29386, skip_threads_29401)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_29401 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_29384 - squot32(local_tid_29384, 32) * 32) == 31 &&\n            ltid_in_bounds_29400) {\n            ((volatile __local\n              bool *) scan_arr_mem_29388)[sext_i32_i64(squot32(local_tid_29384,\n                                                               32))] = x_26400;\n            ((volatile __local\n              float *) scan_arr_mem_29390)[sext_i32_i64(squot32(local_tid_29384,\n                                                                32))] = x_26401;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_29402;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_29384, 32) == 0 && ltid_in_bounds_29400) {\n                x_29395 = ((volatile __local\n                            bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)];\n                x_29396 = ((volatile __local\n                            float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)];\n                if ((local_tid_29384 - squot32(local_tid_29384, 32) * 32) ==\n                    0) {\n                    x_29393 = x_293",
                   "95;\n                    x_29394 = x_29396;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_29402 = 1;\n            while (slt32(skip_threads_29402, 32)) {\n                if (sle32(skip_threads_29402, local_tid_29384 -\n                          squot32(local_tid_29384, 32) * 32) &&\n                    (squot32(local_tid_29384, 32) == 0 &&\n                     ltid_in_bounds_29400)) {\n                    // read operands\n                    {\n                        x_29393 = ((volatile __local\n                                    bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384) -\n                                                                sext_i32_i64(skip_threads_29402)];\n                        x_29394 = ((volatile __local\n                                    float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384) -\n                                                                 sext_i32_i64(skip_threads_29402)];\n                    }\n                    // perform operation\n                    {\n                        bool res_29397 = x_29393 || x_29395;\n                        float res_29398;\n                        \n                        if (x_29395) {\n                            res_29398 = x_29396;\n                        } else {\n                            float res_29399 = x_29394 + x_29396;\n                            \n                            res_29398 = res_29399;\n                        }\n                        x_29393 = res_29397;\n                        x_29394 = res_29398;\n                    }\n                }\n                if (sle32(wave_sizze_29386, skip_threads_29402)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_29402, local_tid_29384 -\n                          squot32(local_tid_29384, 32) * 32) &&\n                    (squot32(local_tid_29384, 32) == 0 &&\n                 ",
                   "    ltid_in_bounds_29400)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] =\n                            x_29393;\n                        x_29395 = x_29393;\n                        ((volatile __local\n                          float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                            x_29394;\n                        x_29396 = x_29394;\n                    }\n                }\n                if (sle32(wave_sizze_29386, skip_threads_29402)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_29402 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_29384, 32) == 0 || !ltid_in_bounds_29400)) {\n            // read operands\n            {\n                x_26402 = x_26400;\n                x_26403 = x_26401;\n                x_26400 = ((__local\n                            bool *) scan_arr_mem_29388)[sext_i32_i64(squot32(local_tid_29384,\n                                                                             32)) -\n                                                        1];\n                x_26401 = ((__local\n                            float *) scan_arr_mem_29390)[sext_i32_i64(squot32(local_tid_29384,\n                                                                              32)) -\n                                                         1];\n            }\n            // perform operation\n            {\n                bool res_26404 = x_26400 || x_26402;\n                float res_26405;\n                \n                if (x_26402) {\n                    res_26405 = x_26403;\n                } else {\n                    float res_26406 = x_26401 + x_26403;\n                    \n                    res_26405 = res_26406;\n                }\n                ",
                   "x_26400 = res_26404;\n                x_26401 = res_26405;\n            }\n            // write final result\n            {\n                ((__local\n                  bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] =\n                    x_26400;\n                ((__local\n                  float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                    x_26401;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_29384, 32) == 0) {\n            ((__local\n              bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)] =\n                x_26402;\n            ((__local\n              float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)] =\n                x_26403;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt64(gtid_28443, res_26316)) {\n            ((__global bool *) mem_28812)[gtid_28443] = ((__local\n                                                          bool *) scan_arr_mem_29388)[sext_i32_i64(local_tid_29384)];\n            ((__global float *) mem_28814)[gtid_28443] = ((__local\n                                                           float *) scan_arr_mem_29390)[sext_i32_i64(local_tid_29384)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_28439\n}\n__kernel void testziscan_stage2_28496(__global int *global_failure,\n                                      __local volatile\n                                      int64_t *scan_arr_mem_29445_backing_aligned_0,\n                                      int64_t res_26316, __global\n                                      unsigned char *mem_28817,\n                                      int64_t stage1_num_groups_29417,\n                                      int32_t num_threads_29418)\n{\n    #define segscan_group_sizze_28491 (testzisegscan_group_sizze_28490)\n    \n    const int block_dim0 = 0;\n    const int blo",
                   "ck_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict scan_arr_mem_29445_backing_0 =\n                          (__local volatile\n                           char *) scan_arr_mem_29445_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29440;\n    int32_t local_tid_29441;\n    int64_t group_sizze_29444;\n    int32_t wave_sizze_29443;\n    int32_t group_tid_29442;\n    \n    global_tid_29440 = get_global_id(0);\n    local_tid_29441 = get_local_id(0);\n    group_sizze_29444 = get_local_size(0);\n    wave_sizze_29443 = LOCKSTEP_WIDTH;\n    group_tid_29442 = get_group_id(0);\n    \n    int32_t phys_tid_28496;\n    \n    phys_tid_28496 = global_tid_29440;\n    \n    __local char *scan_arr_mem_29445;\n    \n    scan_arr_mem_29445 = (__local char *) scan_arr_mem_29445_backing_0;\n    \n    int64_t flat_idx_29447;\n    \n    flat_idx_29447 = (sext_i32_i64(local_tid_29441) + 1) *\n        (segscan_group_sizze_28491 * sdiv_up64(res_26316,\n                                               sext_i32_i64(num_threads_29418))) -\n        1;\n    \n    int64_t gtid_28495;\n    \n    gtid_28495 = flat_idx_29447;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt64(gtid_28495, res_26316)) {\n            ((__local\n              int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] =\n                ((__global int64_t *) mem_28817)[gtid_28495];\n        } else {\n            ((__local\n              int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int64_t x_26498;\n    int64_t x_26499;\n    int64_t x_29448;\n    int64_t x_29449;\n    bool ltid_in_bounds_29451;\n    \n    ltid_in_bounds_29451 = slt64(sext_i32_i64(local_tid_29441),\n                                 stage1_num_groups_29417);\n    \n    int32_t skip_threads_29452;\n    \n    // read input for in-block scan\n    {\n        if (ltid_in_bounds_29451) {\n            x_26499 = ((volatile _",
                   "_local\n                        int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)];\n            if ((local_tid_29441 - squot32(local_tid_29441, 32) * 32) == 0) {\n                x_26498 = x_26499;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_29452 = 1;\n        while (slt32(skip_threads_29452, 32)) {\n            if (sle32(skip_threads_29452, local_tid_29441 -\n                      squot32(local_tid_29441, 32) * 32) &&\n                ltid_in_bounds_29451) {\n                // read operands\n                {\n                    x_26498 = ((volatile __local\n                                int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441) -\n                                                               sext_i32_i64(skip_threads_29452)];\n                }\n                // perform operation\n                {\n                    int64_t res_26500 = add64(x_26498, x_26499);\n                    \n                    x_26498 = res_26500;\n                }\n            }\n            if (sle32(wave_sizze_29443, skip_threads_29452)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_29452, local_tid_29441 -\n                      squot32(local_tid_29441, 32) * 32) &&\n                ltid_in_bounds_29451) {\n                // write result\n                {\n                    ((volatile __local\n                      int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] =\n                        x_26498;\n                    x_26499 = x_26498;\n                }\n            }\n            if (sle32(wave_sizze_29443, skip_threads_29452)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_29452 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_29441 - squot32(local_tid_29441, 32) * 32) == 31 &&\n            ltid_in_bou",
                   "nds_29451) {\n            ((volatile __local\n              int64_t *) scan_arr_mem_29445)[sext_i32_i64(squot32(local_tid_29441,\n                                                                  32))] =\n                x_26498;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_29453;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_29441, 32) == 0 && ltid_in_bounds_29451) {\n                x_29449 = ((volatile __local\n                            int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)];\n                if ((local_tid_29441 - squot32(local_tid_29441, 32) * 32) ==\n                    0) {\n                    x_29448 = x_29449;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_29453 = 1;\n            while (slt32(skip_threads_29453, 32)) {\n                if (sle32(skip_threads_29453, local_tid_29441 -\n                          squot32(local_tid_29441, 32) * 32) &&\n                    (squot32(local_tid_29441, 32) == 0 &&\n                     ltid_in_bounds_29451)) {\n                    // read operands\n                    {\n                        x_29448 = ((volatile __local\n                                    int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441) -\n                                                                   sext_i32_i64(skip_threads_29453)];\n                    }\n                    // perform operation\n                    {\n                        int64_t res_29450 = add64(x_29448, x_29449);\n                        \n                        x_29448 = res_29450;\n                    }\n                }\n                if (sle32(wave_sizze_29443, skip_threads_29453)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_2945",
                   "3, local_tid_29441 -\n                          squot32(local_tid_29441, 32) * 32) &&\n                    (squot32(local_tid_29441, 32) == 0 &&\n                     ltid_in_bounds_29451)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] =\n                            x_29448;\n                        x_29449 = x_29448;\n                    }\n                }\n                if (sle32(wave_sizze_29443, skip_threads_29453)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_29453 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_29441, 32) == 0 || !ltid_in_bounds_29451)) {\n            // read operands\n            {\n                x_26499 = x_26498;\n                x_26498 = ((__local\n                            int64_t *) scan_arr_mem_29445)[sext_i32_i64(squot32(local_tid_29441,\n                                                                                32)) -\n                                                           1];\n            }\n            // perform operation\n            {\n                int64_t res_26500 = add64(x_26498, x_26499);\n                \n                x_26498 = res_26500;\n            }\n            // write final result\n            {\n                ((__local\n                  int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] =\n                    x_26498;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_29441, 32) == 0) {\n            ((__local\n              int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)] =\n                x_26499;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {",
                   "\n        if (slt64(gtid_28495, res_26316)) {\n            ((__global int64_t *) mem_28817)[gtid_28495] = ((__local\n                                                             int64_t *) scan_arr_mem_29445)[sext_i32_i64(local_tid_29441)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_28491\n}\n__kernel void testziscan_stage3_28395(__global int *global_failure,\n                                      int64_t flat_dim_26283,\n                                      int64_t num_groups_28392, __global\n                                      unsigned char *mem_28789,\n                                      int32_t num_threads_28980,\n                                      int32_t required_groups_29016)\n{\n    #define segscan_group_sizze_28390 (testzisegscan_group_sizze_28389)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29017;\n    int32_t local_tid_29018;\n    int64_t group_sizze_29021;\n    int32_t wave_sizze_29020;\n    int32_t group_tid_29019;\n    \n    global_tid_29017 = get_global_id(0);\n    local_tid_29018 = get_local_id(0);\n    group_sizze_29021 = get_local_size(0);\n    wave_sizze_29020 = LOCKSTEP_WIDTH;\n    group_tid_29019 = get_group_id(0);\n    \n    int32_t phys_tid_28395;\n    \n    phys_tid_28395 = global_tid_29017;\n    \n    int32_t phys_group_id_29022;\n    \n    phys_group_id_29022 = get_group_id(0);\n    for (int32_t i_29023 = 0; i_29023 < sdiv_up32(required_groups_29016 -\n                                                  phys_group_id_29022,\n                                                  sext_i64_i32(num_groups_28392));\n         i_29023++) {\n        int32_t virt_group_id_29024 = phys_group_id_29022 + i_29023 *\n                sext_i64_i32(num_groups_28392);\n        int64_t flat_idx_29025 = sext_i32_i64(virt_group_id_29024) *\n                segscan_group_sizze_28390 + sext_i32_i64(local_tid_29018);\n        int64_t gtid_28",
                   "394 = flat_idx_29025;\n        int64_t orig_group_29026 = squot64(flat_idx_29025,\n                                           segscan_group_sizze_28390 *\n                                           sdiv_up64(flat_dim_26283,\n                                                     sext_i32_i64(num_threads_28980)));\n        int64_t carry_in_flat_idx_29027 = orig_group_29026 *\n                (segscan_group_sizze_28390 * sdiv_up64(flat_dim_26283,\n                                                       sext_i32_i64(num_threads_28980))) -\n                1;\n        \n        if (slt64(gtid_28394, flat_dim_26283)) {\n            if (!(orig_group_29026 == 0 || flat_idx_29025 == (orig_group_29026 +\n                                                              1) *\n                  (segscan_group_sizze_28390 * sdiv_up64(flat_dim_26283,\n                                                         sext_i32_i64(num_threads_28980))) -\n                  1)) {\n                int64_t x_26302;\n                int64_t x_26303;\n                \n                x_26302 = ((__global\n                            int64_t *) mem_28789)[carry_in_flat_idx_29027];\n                x_26303 = ((__global int64_t *) mem_28789)[gtid_28394];\n                \n                int64_t res_26304;\n                \n                res_26304 = add64(x_26302, x_26303);\n                x_26302 = res_26304;\n                ((__global int64_t *) mem_28789)[gtid_28394] = x_26302;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_28390\n}\n__kernel void testziscan_stage3_28428(__global int *global_failure,\n                                      int64_t res_26316,\n                                      int64_t num_groups_28425, __global\n                                      unsigned char *mem_28800, __global\n                                      unsigned char *mem_28802,\n                                      int32_t num_threads_292",
                   "17,\n                                      int32_t required_groups_29269)\n{\n    #define segscan_group_sizze_28423 (testzisegscan_group_sizze_28422)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29270;\n    int32_t local_tid_29271;\n    int64_t group_sizze_29274;\n    int32_t wave_sizze_29273;\n    int32_t group_tid_29272;\n    \n    global_tid_29270 = get_global_id(0);\n    local_tid_29271 = get_local_id(0);\n    group_sizze_29274 = get_local_size(0);\n    wave_sizze_29273 = LOCKSTEP_WIDTH;\n    group_tid_29272 = get_group_id(0);\n    \n    int32_t phys_tid_28428;\n    \n    phys_tid_28428 = global_tid_29270;\n    \n    int32_t phys_group_id_29275;\n    \n    phys_group_id_29275 = get_group_id(0);\n    for (int32_t i_29276 = 0; i_29276 < sdiv_up32(required_groups_29269 -\n                                                  phys_group_id_29275,\n                                                  sext_i64_i32(num_groups_28425));\n         i_29276++) {\n        int32_t virt_group_id_29277 = phys_group_id_29275 + i_29276 *\n                sext_i64_i32(num_groups_28425);\n        int64_t flat_idx_29278 = sext_i32_i64(virt_group_id_29277) *\n                segscan_group_sizze_28423 + sext_i32_i64(local_tid_29271);\n        int64_t gtid_28427 = flat_idx_29278;\n        int64_t orig_group_29279 = squot64(flat_idx_29278,\n                                           segscan_group_sizze_28423 *\n                                           sdiv_up64(res_26316,\n                                                     sext_i32_i64(num_threads_29217)));\n        int64_t carry_in_flat_idx_29280 = orig_group_29279 *\n                (segscan_group_sizze_28423 * sdiv_up64(res_26316,\n                                                       sext_i32_i64(num_threads_29217))) -\n                1;\n        \n        if (slt64(gtid_28427, res_26316)) {\n            if (!(orig_group_29279 == 0 || flat_idx_292",
                   "78 == (orig_group_29279 +\n                                                              1) *\n                  (segscan_group_sizze_28423 * sdiv_up64(res_26316,\n                                                         sext_i32_i64(num_threads_29217))) -\n                  1)) {\n                bool x_26335;\n                int64_t x_26336;\n                bool x_26337;\n                int64_t x_26338;\n                \n                x_26335 = ((__global\n                            bool *) mem_28800)[carry_in_flat_idx_29280];\n                x_26336 = ((__global\n                            int64_t *) mem_28802)[carry_in_flat_idx_29280];\n                x_26337 = ((__global bool *) mem_28800)[gtid_28427];\n                x_26338 = ((__global int64_t *) mem_28802)[gtid_28427];\n                \n                bool res_26339;\n                \n                res_26339 = x_26335 || x_26337;\n                \n                int64_t res_26340;\n                \n                if (x_26337) {\n                    res_26340 = x_26338;\n                } else {\n                    int64_t res_26341 = add64(x_26336, x_26338);\n                    \n                    res_26340 = res_26341;\n                }\n                x_26335 = res_26339;\n                x_26336 = res_26340;\n                ((__global bool *) mem_28800)[gtid_28427] = x_26335;\n                ((__global int64_t *) mem_28802)[gtid_28427] = x_26336;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_28423\n}\n__kernel void testziscan_stage3_28436(__global int *global_failure,\n                                      int64_t res_26316,\n                                      int64_t num_groups_28433, __global\n                                      unsigned char *mem_28805, __global\n                                      unsigned char *mem_28807,\n                                      int32_t num_threads_29284,\n               ",
                   "                       int32_t required_groups_29336)\n{\n    #define segscan_group_sizze_28431 (testzisegscan_group_sizze_28430)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29337;\n    int32_t local_tid_29338;\n    int64_t group_sizze_29341;\n    int32_t wave_sizze_29340;\n    int32_t group_tid_29339;\n    \n    global_tid_29337 = get_global_id(0);\n    local_tid_29338 = get_local_id(0);\n    group_sizze_29341 = get_local_size(0);\n    wave_sizze_29340 = LOCKSTEP_WIDTH;\n    group_tid_29339 = get_group_id(0);\n    \n    int32_t phys_tid_28436;\n    \n    phys_tid_28436 = global_tid_29337;\n    \n    int32_t phys_group_id_29342;\n    \n    phys_group_id_29342 = get_group_id(0);\n    for (int32_t i_29343 = 0; i_29343 < sdiv_up32(required_groups_29336 -\n                                                  phys_group_id_29342,\n                                                  sext_i64_i32(num_groups_28433));\n         i_29343++) {\n        int32_t virt_group_id_29344 = phys_group_id_29342 + i_29343 *\n                sext_i64_i32(num_groups_28433);\n        int64_t flat_idx_29345 = sext_i32_i64(virt_group_id_29344) *\n                segscan_group_sizze_28431 + sext_i32_i64(local_tid_29338);\n        int64_t gtid_28435 = flat_idx_29345;\n        int64_t orig_group_29346 = squot64(flat_idx_29345,\n                                           segscan_group_sizze_28431 *\n                                           sdiv_up64(res_26316,\n                                                     sext_i32_i64(num_threads_29284)));\n        int64_t carry_in_flat_idx_29347 = orig_group_29346 *\n                (segscan_group_sizze_28431 * sdiv_up64(res_26316,\n                                                       sext_i32_i64(num_threads_29284))) -\n                1;\n        \n        if (slt64(gtid_28435, res_26316)) {\n            if (!(orig_group_29346 == 0 || flat_idx_29345 == (orig_group_2",
                   "9346 +\n                                                              1) *\n                  (segscan_group_sizze_28431 * sdiv_up64(res_26316,\n                                                         sext_i32_i64(num_threads_29284))) -\n                  1)) {\n                bool x_26374;\n                int64_t x_26375;\n                bool x_26376;\n                int64_t x_26377;\n                \n                x_26374 = ((__global\n                            bool *) mem_28805)[carry_in_flat_idx_29347];\n                x_26375 = ((__global\n                            int64_t *) mem_28807)[carry_in_flat_idx_29347];\n                x_26376 = ((__global bool *) mem_28805)[gtid_28435];\n                x_26377 = ((__global int64_t *) mem_28807)[gtid_28435];\n                \n                bool res_26378;\n                \n                res_26378 = x_26374 || x_26376;\n                \n                int64_t res_26379;\n                \n                if (x_26376) {\n                    res_26379 = x_26377;\n                } else {\n                    int64_t res_26380 = add64(x_26375, x_26377);\n                    \n                    res_26379 = res_26380;\n                }\n                x_26374 = res_26378;\n                x_26375 = res_26379;\n                ((__global bool *) mem_28805)[gtid_28435] = x_26374;\n                ((__global int64_t *) mem_28807)[gtid_28435] = x_26375;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_28431\n}\n__kernel void testziscan_stage3_28444(__global int *global_failure,\n                                      int64_t res_26316,\n                                      int64_t num_groups_28441, __global\n                                      unsigned char *mem_28812, __global\n                                      unsigned char *mem_28814,\n                                      int32_t num_threads_29351,\n                                  ",
                   "    int32_t required_groups_29403)\n{\n    #define segscan_group_sizze_28439 (testzisegscan_group_sizze_28438)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29404;\n    int32_t local_tid_29405;\n    int64_t group_sizze_29408;\n    int32_t wave_sizze_29407;\n    int32_t group_tid_29406;\n    \n    global_tid_29404 = get_global_id(0);\n    local_tid_29405 = get_local_id(0);\n    group_sizze_29408 = get_local_size(0);\n    wave_sizze_29407 = LOCKSTEP_WIDTH;\n    group_tid_29406 = get_group_id(0);\n    \n    int32_t phys_tid_28444;\n    \n    phys_tid_28444 = global_tid_29404;\n    \n    int32_t phys_group_id_29409;\n    \n    phys_group_id_29409 = get_group_id(0);\n    for (int32_t i_29410 = 0; i_29410 < sdiv_up32(required_groups_29403 -\n                                                  phys_group_id_29409,\n                                                  sext_i64_i32(num_groups_28441));\n         i_29410++) {\n        int32_t virt_group_id_29411 = phys_group_id_29409 + i_29410 *\n                sext_i64_i32(num_groups_28441);\n        int64_t flat_idx_29412 = sext_i32_i64(virt_group_id_29411) *\n                segscan_group_sizze_28439 + sext_i32_i64(local_tid_29405);\n        int64_t gtid_28443 = flat_idx_29412;\n        int64_t orig_group_29413 = squot64(flat_idx_29412,\n                                           segscan_group_sizze_28439 *\n                                           sdiv_up64(res_26316,\n                                                     sext_i32_i64(num_threads_29351)));\n        int64_t carry_in_flat_idx_29414 = orig_group_29413 *\n                (segscan_group_sizze_28439 * sdiv_up64(res_26316,\n                                                       sext_i32_i64(num_threads_29351))) -\n                1;\n        \n        if (slt64(gtid_28443, res_26316)) {\n            if (!(orig_group_29413 == 0 || flat_idx_29412 == (orig_group_29413 +\n            ",
                   "                                                  1) *\n                  (segscan_group_sizze_28439 * sdiv_up64(res_26316,\n                                                         sext_i32_i64(num_threads_29351))) -\n                  1)) {\n                bool x_26400;\n                float x_26401;\n                bool x_26402;\n                float x_26403;\n                \n                x_26400 = ((__global\n                            bool *) mem_28812)[carry_in_flat_idx_29414];\n                x_26401 = ((__global\n                            float *) mem_28814)[carry_in_flat_idx_29414];\n                x_26402 = ((__global bool *) mem_28812)[gtid_28443];\n                x_26403 = ((__global float *) mem_28814)[gtid_28443];\n                \n                bool res_26404;\n                \n                res_26404 = x_26400 || x_26402;\n                \n                float res_26405;\n                \n                if (x_26402) {\n                    res_26405 = x_26403;\n                } else {\n                    float res_26406 = x_26401 + x_26403;\n                    \n                    res_26405 = res_26406;\n                }\n                x_26400 = res_26404;\n                x_26401 = res_26405;\n                ((__global bool *) mem_28812)[gtid_28443] = x_26400;\n                ((__global float *) mem_28814)[gtid_28443] = x_26401;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_28439\n}\n__kernel void testziscan_stage3_28496(__global int *global_failure,\n                                      int64_t res_26316,\n                                      int64_t num_groups_28493, __global\n                                      unsigned char *mem_28817,\n                                      int32_t num_threads_29418,\n                                      int32_t required_groups_29454)\n{\n    #define segscan_group_sizze_28491 (testzisegscan_group_sizze_28490)\n   ",
                   " \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29455;\n    int32_t local_tid_29456;\n    int64_t group_sizze_29459;\n    int32_t wave_sizze_29458;\n    int32_t group_tid_29457;\n    \n    global_tid_29455 = get_global_id(0);\n    local_tid_29456 = get_local_id(0);\n    group_sizze_29459 = get_local_size(0);\n    wave_sizze_29458 = LOCKSTEP_WIDTH;\n    group_tid_29457 = get_group_id(0);\n    \n    int32_t phys_tid_28496;\n    \n    phys_tid_28496 = global_tid_29455;\n    \n    int32_t phys_group_id_29460;\n    \n    phys_group_id_29460 = get_group_id(0);\n    for (int32_t i_29461 = 0; i_29461 < sdiv_up32(required_groups_29454 -\n                                                  phys_group_id_29460,\n                                                  sext_i64_i32(num_groups_28493));\n         i_29461++) {\n        int32_t virt_group_id_29462 = phys_group_id_29460 + i_29461 *\n                sext_i64_i32(num_groups_28493);\n        int64_t flat_idx_29463 = sext_i32_i64(virt_group_id_29462) *\n                segscan_group_sizze_28491 + sext_i32_i64(local_tid_29456);\n        int64_t gtid_28495 = flat_idx_29463;\n        int64_t orig_group_29464 = squot64(flat_idx_29463,\n                                           segscan_group_sizze_28491 *\n                                           sdiv_up64(res_26316,\n                                                     sext_i32_i64(num_threads_29418)));\n        int64_t carry_in_flat_idx_29465 = orig_group_29464 *\n                (segscan_group_sizze_28491 * sdiv_up64(res_26316,\n                                                       sext_i32_i64(num_threads_29418))) -\n                1;\n        \n        if (slt64(gtid_28495, res_26316)) {\n            if (!(orig_group_29464 == 0 || flat_idx_29463 == (orig_group_29464 +\n                                                              1) *\n                  (segscan_group_sizze_28491 * sdiv_up64(",
                   "res_26316,\n                                                         sext_i32_i64(num_threads_29418))) -\n                  1)) {\n                int64_t x_26498;\n                int64_t x_26499;\n                \n                x_26498 = ((__global\n                            int64_t *) mem_28817)[carry_in_flat_idx_29465];\n                x_26499 = ((__global int64_t *) mem_28817)[gtid_28495];\n                \n                int64_t res_26500;\n                \n                res_26500 = add64(x_26498, x_26499);\n                x_26498 = res_26500;\n                ((__global int64_t *) mem_28817)[gtid_28495] = x_26498;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_28491\n}\n__kernel void testziseghist_global_28413(__global int *global_failure,\n                                         int64_t flat_dim_26283,\n                                         int64_t res_26316,\n                                         int64_t num_groups_28410, __global\n                                         unsigned char *mem_28789,\n                                         int32_t num_subhistos_29067, __global\n                                         unsigned char *res_subhistos_mem_29068,\n                                         __global\n                                         unsigned char *testzihist_locks_mem_29138,\n                                         int32_t chk_i_29140,\n                                         int64_t hist_H_chk_29141)\n{\n    #define seghist_group_sizze_28408 (testziseghist_group_sizze_28407)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29142;\n    int32_t local_tid_29143;\n    int64_t group_sizze_29146;\n    int32_t wave_sizze_29145;\n    int32_t group_tid_29144;\n    \n    global_tid_29142 = get_global_id(0);\n    local_tid_29143 = get_local_i",
                   "d(0);\n    group_sizze_29146 = get_local_size(0);\n    wave_sizze_29145 = LOCKSTEP_WIDTH;\n    group_tid_29144 = get_group_id(0);\n    \n    int32_t phys_tid_28413;\n    \n    phys_tid_28413 = global_tid_29142;\n    \n    int32_t subhisto_ind_29147;\n    \n    subhisto_ind_29147 = squot32(global_tid_29142,\n                                 sdiv_up32(sext_i64_i32(seghist_group_sizze_28408 *\n                                           num_groups_28410),\n                                           num_subhistos_29067));\n    for (int64_t i_29148 = 0; i_29148 < sdiv_up64(flat_dim_26283 -\n                                                  sext_i32_i64(global_tid_29142),\n                                                  sext_i32_i64(sext_i64_i32(seghist_group_sizze_28408 *\n                                                  num_groups_28410)));\n         i_29148++) {\n        int32_t gtid_28412 = sext_i64_i32(i_29148 *\n                sext_i32_i64(sext_i64_i32(seghist_group_sizze_28408 *\n                num_groups_28410)) + sext_i32_i64(global_tid_29142));\n        \n        if (slt64(i_29148 *\n                  sext_i32_i64(sext_i64_i32(seghist_group_sizze_28408 *\n                  num_groups_28410)) + sext_i32_i64(global_tid_29142),\n                  flat_dim_26283)) {\n            int64_t i_p_o_28675 = add64(-1, gtid_28412);\n            int64_t rot_i_28676 = smod64(i_p_o_28675, flat_dim_26283);\n            bool cond_28419 = gtid_28412 == 0;\n            int64_t res_28420;\n            \n            if (cond_28419) {\n                res_28420 = 0;\n            } else {\n                int64_t x_28418 = ((__global int64_t *) mem_28789)[rot_i_28676];\n                \n                res_28420 = x_28418;\n            }\n            // save map-out results\n            { }\n            // perform atomic updates\n            {\n                if (sle64(sext_i32_i64(chk_i_29140) * hist_H_chk_29141,\n                          res_28420) && (slt64(res_28420,\n                                               sext_",
                   "i32_i64(chk_i_29140) *\n                                               hist_H_chk_29141 +\n                                               hist_H_chk_29141) &&\n                                         slt64(res_28420, res_26316))) {\n                    int64_t x_28414;\n                    int64_t x_28415;\n                    \n                    x_28415 = gtid_28412;\n                    \n                    int32_t old_29149;\n                    volatile bool continue_29150;\n                    \n                    continue_29150 = 1;\n                    while (continue_29150) {\n                        old_29149 =\n                            atomic_cmpxchg_i32_global(&((volatile __global\n                                                         int *) testzihist_locks_mem_29138)[srem64(sext_i32_i64(subhisto_ind_29147) *\n                                                                                                   res_26316 +\n                                                                                                   res_28420,\n                                                                                                   100151)],\n                                                      0, 1);\n                        if (old_29149 == 0) {\n                            int64_t x_28414;\n                            \n                            // bind lhs\n                            {\n                                x_28414 = ((volatile __global\n                                            int64_t *) res_subhistos_mem_29068)[sext_i32_i64(subhisto_ind_29147) *\n                                                                                res_26316 +\n                                                                                res_28420];\n                            }\n                            // execute operation\n                            {\n                                int64_t res_28416 = smax64(x_28414, x_28415);\n                                \n          ",
                   "                      x_28414 = res_28416;\n                            }\n                            // update global result\n                            {\n                                ((volatile __global\n                                  int64_t *) res_subhistos_mem_29068)[sext_i32_i64(subhisto_ind_29147) *\n                                                                      res_26316 +\n                                                                      res_28420] =\n                                    x_28414;\n                            }\n                            mem_fence_global();\n                            old_29149 =\n                                atomic_cmpxchg_i32_global(&((volatile __global\n                                                             int *) testzihist_locks_mem_29138)[srem64(sext_i32_i64(subhisto_ind_29147) *\n                                                                                                       res_26316 +\n                                                                                                       res_28420,\n                                                                                                       100151)],\n                                                          1, 0);\n                            continue_29150 = 0;\n                        }\n                        mem_fence_global();\n                    }\n                }\n            }\n        }\n    }\n    \n  error_0:\n    return;\n    #undef seghist_group_sizze_28408\n}\n__kernel void testziseghist_local_28413(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *locks_mem_29108_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *subhistogram_local_mem_29106_backing_aligned_1,\n                                        int64_t flat_dim_26283,\n                                        int64_t res_",
                   "26316, __global\n                                        unsigned char *mem_28789, __global\n                                        unsigned char *res_subhistos_mem_29068,\n                                        int32_t max_group_sizze_29077,\n                                        int64_t num_groups_29078,\n                                        int32_t hist_M_29084,\n                                        int32_t chk_i_29089,\n                                        int64_t num_segments_29090,\n                                        int64_t hist_H_chk_29091,\n                                        int64_t histo_sizze_29092,\n                                        int32_t init_per_thread_29093)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict locks_mem_29108_backing_1 =\n                          (__local volatile\n                           char *) locks_mem_29108_backing_aligned_0;\n    __local volatile char *restrict subhistogram_local_mem_29106_backing_0 =\n                          (__local volatile\n                           char *) subhistogram_local_mem_29106_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29094;\n    int32_t local_tid_29095;\n    int64_t group_sizze_29098;\n    int32_t wave_sizze_29097;\n    int32_t group_tid_29096;\n    \n    global_tid_29094 = get_global_id(0);\n    local_tid_29095 = get_local_id(0);\n    group_sizze_29098 = get_local_size(0);\n    wave_sizze_29097 = LOCKSTEP_WIDTH;\n    group_tid_29096 = get_group_id(0);\n    \n    int32_t phys_tid_28413;\n    \n    phys_tid_28413 = global_tid_29094;\n    \n    int32_t phys_group_id_29099;\n    \n    phys_group_id_29099 = get_group_id(0);\n    for (int32_t i_29100 = 0; i_29100 <\n         sdiv_up32(sext_i64_i32(num_groups_29078 * num_segments_29090) -\n                   phys_group_id_29099, sext_i64_i32(num_groups_29078));\n         i_29100++) {\n        int32_t virt_group_id_29101 = phy",
                   "s_group_id_29099 + i_29100 *\n                sext_i64_i32(num_groups_29078);\n        int32_t flat_segment_id_29102 = squot32(virt_group_id_29101,\n                                                sext_i64_i32(num_groups_29078));\n        int32_t gid_in_segment_29103 = srem32(virt_group_id_29101,\n                                              sext_i64_i32(num_groups_29078));\n        int32_t pgtid_in_segment_29104 = gid_in_segment_29103 *\n                sext_i64_i32(max_group_sizze_29077) + local_tid_29095;\n        int32_t threads_per_segment_29105 = sext_i64_i32(num_groups_29078 *\n                max_group_sizze_29077);\n        __local char *subhistogram_local_mem_29106;\n        \n        subhistogram_local_mem_29106 = (__local\n                                        char *) subhistogram_local_mem_29106_backing_0;\n        \n        __local char *locks_mem_29108;\n        \n        locks_mem_29108 = (__local char *) locks_mem_29108_backing_1;\n        // All locks start out unlocked\n        {\n            for (int64_t i_29110 = 0; i_29110 < sdiv_up64(hist_M_29084 *\n                                                          hist_H_chk_29091 -\n                                                          sext_i32_i64(local_tid_29095),\n                                                          max_group_sizze_29077);\n                 i_29110++) {\n                ((__local int32_t *) locks_mem_29108)[squot64(i_29110 *\n                                                              max_group_sizze_29077 +\n                                                              sext_i32_i64(local_tid_29095),\n                                                              hist_H_chk_29091) *\n                                                      hist_H_chk_29091 +\n                                                      (i_29110 *\n                                                       max_group_sizze_29077 +\n                                                       sext_i32_i64(local_tid_29095) -\n              ",
                   "                                         squot64(i_29110 *\n                                                               max_group_sizze_29077 +\n                                                               sext_i32_i64(local_tid_29095),\n                                                               hist_H_chk_29091) *\n                                                       hist_H_chk_29091)] = 0;\n            }\n        }\n        \n        int32_t thread_local_subhisto_i_29111;\n        \n        thread_local_subhisto_i_29111 = srem32(local_tid_29095, hist_M_29084);\n        // initialize histograms in local memory\n        {\n            for (int32_t local_i_29112 = 0; local_i_29112 <\n                 init_per_thread_29093; local_i_29112++) {\n                int32_t j_29113 = local_i_29112 *\n                        sext_i64_i32(max_group_sizze_29077) + local_tid_29095;\n                int32_t j_offset_29114 = hist_M_29084 *\n                        sext_i64_i32(histo_sizze_29092) * gid_in_segment_29103 +\n                        j_29113;\n                int32_t local_subhisto_i_29115 = squot32(j_29113,\n                                                         sext_i64_i32(histo_sizze_29092));\n                int32_t global_subhisto_i_29116 = squot32(j_offset_29114,\n                                                          sext_i64_i32(histo_sizze_29092));\n                \n                if (slt32(j_29113, hist_M_29084 *\n                          sext_i64_i32(histo_sizze_29092))) {\n                    // First subhistogram is initialised from global memory; others with neutral element.\n                    {\n                        if (global_subhisto_i_29116 == 0) {\n                            ((__local\n                              int64_t *) subhistogram_local_mem_29106)[sext_i32_i64(local_subhisto_i_29115) *\n                                                                       hist_H_chk_29091 +\n                                                                       sext",
                   "_i32_i64(srem32(j_29113,\n                                                                                           sext_i64_i32(histo_sizze_29092)))] =\n                                ((__global\n                                  int64_t *) res_subhistos_mem_29068)[sext_i32_i64(srem32(j_29113,\n                                                                                          sext_i64_i32(histo_sizze_29092))) +\n                                                                      sext_i32_i64(chk_i_29089) *\n                                                                      hist_H_chk_29091];\n                        } else {\n                            ((__local\n                              int64_t *) subhistogram_local_mem_29106)[sext_i32_i64(local_subhisto_i_29115) *\n                                                                       hist_H_chk_29091 +\n                                                                       sext_i32_i64(srem32(j_29113,\n                                                                                           sext_i64_i32(histo_sizze_29092)))] =\n                                0;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_29117 = 0; i_29117 <\n             sdiv_up32(sext_i64_i32(flat_dim_26283) - pgtid_in_segment_29104,\n                       threads_per_segment_29105); i_29117++) {\n            int32_t gtid_28412 = i_29117 * threads_per_segment_29105 +\n                    pgtid_in_segment_29104;\n            int64_t i_p_o_28675 = add64(-1, gtid_28412);\n            int64_t rot_i_28676 = smod64(i_p_o_28675, flat_dim_26283);\n            bool cond_28419 = gtid_28412 == 0;\n            int64_t res_28420;\n            \n            if (cond_28419) {\n                res_28420 = 0;\n            } else {\n                int64_t x_28418 = ((__global int64_t *) mem_28789)[rot_i_28676];\n                \n                res_28420 = x_",
                   "28418;\n            }\n            if (chk_i_29089 == 0) {\n                // save map-out results\n                { }\n            }\n            // perform atomic updates\n            {\n                if (slt64(res_28420, res_26316) &&\n                    (sle64(sext_i32_i64(chk_i_29089) * hist_H_chk_29091,\n                           res_28420) && slt64(res_28420,\n                                               sext_i32_i64(chk_i_29089) *\n                                               hist_H_chk_29091 +\n                                               hist_H_chk_29091))) {\n                    int64_t x_28414;\n                    int64_t x_28415;\n                    \n                    x_28415 = gtid_28412;\n                    \n                    int32_t old_29118;\n                    volatile bool continue_29119;\n                    \n                    continue_29119 = 1;\n                    while (continue_29119) {\n                        old_29118 = atomic_cmpxchg_i32_local(&((volatile __local\n                                                                int *) locks_mem_29108)[sext_i32_i64(thread_local_subhisto_i_29111) *\n                                                                                        hist_H_chk_29091 +\n                                                                                        (res_28420 -\n                                                                                         sext_i32_i64(chk_i_29089) *\n                                                                                         hist_H_chk_29091)],\n                                                             0, 1);\n                        if (old_29118 == 0) {\n                            int64_t x_28414;\n                            \n                            // bind lhs\n                            {\n                                x_28414 = ((volatile __local\n                                            int64_t *) subhistogram_local_mem_29106)[sext_i32_i64(thread",
                   "_local_subhisto_i_29111) *\n                                                                                     hist_H_chk_29091 +\n                                                                                     (res_28420 -\n                                                                                      sext_i32_i64(chk_i_29089) *\n                                                                                      hist_H_chk_29091)];\n                            }\n                            // execute operation\n                            {\n                                int64_t res_28416 = smax64(x_28414, x_28415);\n                                \n                                x_28414 = res_28416;\n                            }\n                            // update global result\n                            {\n                                ((volatile __local\n                                  int64_t *) subhistogram_local_mem_29106)[sext_i32_i64(thread_local_subhisto_i_29111) *\n                                                                           hist_H_chk_29091 +\n                                                                           (res_28420 -\n                                                                            sext_i32_i64(chk_i_29089) *\n                                                                            hist_H_chk_29091)] =\n                                    x_28414;\n                            }\n                            mem_fence_local();\n                            old_29118 =\n                                atomic_cmpxchg_i32_local(&((volatile __local\n                                                            int *) locks_mem_29108)[sext_i32_i64(thread_local_subhisto_i_29111) *\n                                                                                    hist_H_chk_29091 +\n                                                                                    (res_28420 -\n                                          ",
                   "                                           sext_i32_i64(chk_i_29089) *\n                                                                                     hist_H_chk_29091)],\n                                                         1, 0);\n                            continue_29119 = 0;\n                        }\n                        mem_fence_local();\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Compact the multiple local memory subhistograms to result in global memory\n        {\n            int64_t trunc_H_29120 = smin64(hist_H_chk_29091, res_26316 -\n                                           sext_i32_i64(chk_i_29089) *\n                                           hist_H_chk_29091);\n            int32_t histo_sizze_29121 = sext_i64_i32(trunc_H_29120);\n            \n            for (int32_t local_i_29122 = 0; local_i_29122 <\n                 init_per_thread_29093; local_i_29122++) {\n                int32_t j_29123 = local_i_29122 *\n                        sext_i64_i32(max_group_sizze_29077) + local_tid_29095;\n                \n                if (slt32(j_29123, histo_sizze_29121)) {\n                    int64_t x_28414;\n                    int64_t x_28415;\n                    \n                    // Read values from subhistogram 0.\n                    {\n                        x_28414 = ((__local\n                                    int64_t *) subhistogram_local_mem_29106)[sext_i32_i64(j_29123)];\n                    }\n                    // Accumulate based on values in other subhistograms.\n                    {\n                        for (int32_t subhisto_id_29124 = 0; subhisto_id_29124 <\n                             hist_M_29084 - 1; subhisto_id_29124++) {\n                            x_28415 = ((__local\n                                        int64_t *) subhistogram_local_mem_29106)[(sext_i32_i64(subhisto_id_29124) +\n                                                                                  1) ",
                   "*\n                                                                                 hist_H_chk_29091 +\n                                                                                 sext_i32_i64(j_29123)];\n                            \n                            int64_t res_28416;\n                            \n                            res_28416 = smax64(x_28414, x_28415);\n                            x_28414 = res_28416;\n                        }\n                    }\n                    // Put final bucket value in global memory.\n                    {\n                        ((__global\n                          int64_t *) res_subhistos_mem_29068)[srem64(sext_i32_i64(virt_group_id_29101),\n                                                                     num_groups_29078) *\n                                                              res_26316 +\n                                                              (sext_i32_i64(j_29123) +\n                                                               sext_i32_i64(chk_i_29089) *\n                                                               hist_H_chk_29091)] =\n                            x_28414;\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\n__kernel void testzisegmap_27619(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args, __global\n                                 unsigned char *mem_28731, __global\n                                 unsigned char *mem_28733, __global\n                                 unsigned char *mem_28745)\n{\n    #define segmap_group_sizze_27685 (testzisegmap_group_sizze_27621)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28936;\n    int32_t local_tid_2893",
                   "7;\n    int64_t group_sizze_28940;\n    int32_t wave_sizze_28939;\n    int32_t group_tid_28938;\n    \n    global_tid_28936 = get_global_id(0);\n    local_tid_28937 = get_local_id(0);\n    group_sizze_28940 = get_local_size(0);\n    wave_sizze_28939 = LOCKSTEP_WIDTH;\n    group_tid_28938 = get_group_id(0);\n    \n    int32_t phys_tid_27619;\n    \n    phys_tid_27619 = global_tid_28936;\n    \n    int64_t gtid_27618;\n    \n    gtid_27618 = sext_i32_i64(group_tid_28938) * segmap_group_sizze_27685 +\n        sext_i32_i64(local_tid_28937);\n    if (slt64(gtid_27618, 45)) {\n        float res_27696 = ((__global float *) mem_28733)[gtid_27618];\n        int64_t res_27697 = ((__global int64_t *) mem_28731)[gtid_27618];\n        bool bounds_invalid_upwards_27699 = slt64(res_27697, 1);\n        bool valid_27700 = !bounds_invalid_upwards_27699;\n        bool range_valid_c_27701;\n        \n        if (!valid_27700) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 7) == -1) {\n                    global_failure_args[0] = 1;\n                    global_failure_args[1] = 2;\n                    global_failure_args[2] = res_27697;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        bool y_27703 = slt64(0, res_27697);\n        bool index_certs_27704;\n        \n        if (!y_27703) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 8) == -1) {\n                    global_failure_args[0] = 0;\n                    global_failure_args[1] = res_27697;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        float binop_y_27705 = sitofp_i64_f32(res_27697);\n        float index_primexp_27706 = res_27696 * binop_y_27705;\n        float negate_arg_27707 = 1.0e-2F * index_primexp_27706;\n        float exp_arg_27708 = 0.0F - negate_arg_27707;\n        float res_27709 = fpow32(2.7182817F, exp_arg_27708);\n        float x_27710 = 1.0F - res_27709;\n        float B_277",
                   "11 = x_27710 / 1.0e-2F;\n        float x_27712 = B_27711 - index_primexp_27706;\n        float x_27713 = 4.4999997e-6F * x_27712;\n        float A1_27714 = x_27713 / 1.0e-4F;\n        float y_27715 = fpow32(B_27711, 2.0F);\n        float x_27716 = 1.0000001e-6F * y_27715;\n        float A2_27717 = x_27716 / 4.0e-2F;\n        float exp_arg_27718 = A1_27714 - A2_27717;\n        float res_27719 = fpow32(2.7182817F, exp_arg_27718);\n        float negate_arg_27720 = 5.0e-2F * B_27711;\n        float exp_arg_27721 = 0.0F - negate_arg_27720;\n        float res_27722 = fpow32(2.7182817F, exp_arg_27721);\n        float res_27723 = res_27719 * res_27722;\n        float res_27724;\n        float redout_28654 = 0.0F;\n        \n        for (int64_t i_28655 = 0; i_28655 < res_27697; i_28655++) {\n            int64_t index_primexp_28688 = add64(1, i_28655);\n            float res_27729 = sitofp_i64_f32(index_primexp_28688);\n            float res_27730 = res_27696 * res_27729;\n            float negate_arg_27731 = 1.0e-2F * res_27730;\n            float exp_arg_27732 = 0.0F - negate_arg_27731;\n            float res_27733 = fpow32(2.7182817F, exp_arg_27732);\n            float x_27734 = 1.0F - res_27733;\n            float B_27735 = x_27734 / 1.0e-2F;\n            float x_27736 = B_27735 - res_27730;\n            float x_27737 = 4.4999997e-6F * x_27736;\n            float A1_27738 = x_27737 / 1.0e-4F;\n            float y_27739 = fpow32(B_27735, 2.0F);\n            float x_27740 = 1.0000001e-6F * y_27739;\n            float A2_27741 = x_27740 / 4.0e-2F;\n            float exp_arg_27742 = A1_27738 - A2_27741;\n            float res_27743 = fpow32(2.7182817F, exp_arg_27742);\n            float negate_arg_27744 = 5.0e-2F * B_27735;\n            float exp_arg_27745 = 0.0F - negate_arg_27744;\n            float res_27746 = fpow32(2.7182817F, exp_arg_27745);\n            float res_27747 = res_27743 * res_27746;\n            float res_27727 = res_27747 + redout_28654;\n            float redout_tmp_28941 = res_27727;\n       ",
                   "     \n            redout_28654 = redout_tmp_28941;\n        }\n        res_27724 = redout_28654;\n        \n        float x_27748 = 1.0F - res_27723;\n        float y_27749 = res_27696 * res_27724;\n        float res_27750 = x_27748 / y_27749;\n        \n        ((__global float *) mem_28745)[gtid_27618] = res_27750;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_27685\n}\n__kernel void testzisegmap_27768(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args, __global\n                                 unsigned char *mem_28731, __global\n                                 unsigned char *mem_28733, __global\n                                 unsigned char *mem_28754)\n{\n    #define segmap_group_sizze_27834 (testzisegmap_group_sizze_27770)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28942;\n    int32_t local_tid_28943;\n    int64_t group_sizze_28946;\n    int32_t wave_sizze_28945;\n    int32_t group_tid_28944;\n    \n    global_tid_28942 = get_global_id(0);\n    local_tid_28943 = get_local_id(0);\n    group_sizze_28946 = get_local_size(0);\n    wave_sizze_28945 = LOCKSTEP_WIDTH;\n    group_tid_28944 = get_group_id(0);\n    \n    int32_t phys_tid_27768;\n    \n    phys_tid_27768 = global_tid_28942;\n    \n    int64_t gtid_27767;\n    \n    gtid_27767 = sext_i32_i64(group_tid_28944) * segmap_group_sizze_27834 +\n        sext_i32_i64(local_tid_28943);\n    if (slt64(gtid_27767, 45)) {\n        float res_27845 = ((__global float *) mem_28733)[gtid_27767];\n        int64_t res_27846 = ((__global int64_t *) mem_28731)[gtid_27767];\n        bool bounds_invalid_upwards_27848 = slt64(res_27846, 1);\n        bool valid_27849 = !bounds_invalid_upwards_27848;\n        bool range_valid_c_27850;\n        \n        if (!valid_27849) {\n            {\n                if (atomic_cmp",
                   "xchg_i32_global(global_failure, -1, 9) == -1) {\n                    global_failure_args[0] = 1;\n                    global_failure_args[1] = 2;\n                    global_failure_args[2] = res_27846;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        bool y_27852 = slt64(0, res_27846);\n        bool index_certs_27853;\n        \n        if (!y_27852) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 10) == -1) {\n                    global_failure_args[0] = 0;\n                    global_failure_args[1] = res_27846;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        float binop_y_27854 = sitofp_i64_f32(res_27846);\n        float index_primexp_27855 = res_27845 * binop_y_27854;\n        float negate_arg_27856 = 1.0e-2F * index_primexp_27855;\n        float exp_arg_27857 = 0.0F - negate_arg_27856;\n        float res_27858 = fpow32(2.7182817F, exp_arg_27857);\n        float x_27859 = 1.0F - res_27858;\n        float B_27860 = x_27859 / 1.0e-2F;\n        float x_27861 = B_27860 - index_primexp_27855;\n        float x_27862 = 4.4999997e-6F * x_27861;\n        float A1_27863 = x_27862 / 1.0e-4F;\n        float y_27864 = fpow32(B_27860, 2.0F);\n        float x_27865 = 1.0000001e-6F * y_27864;\n        float A2_27866 = x_27865 / 4.0e-2F;\n        float exp_arg_27867 = A1_27863 - A2_27866;\n        float res_27868 = fpow32(2.7182817F, exp_arg_27867);\n        float negate_arg_27869 = 5.0e-2F * B_27860;\n        float exp_arg_27870 = 0.0F - negate_arg_27869;\n        float res_27871 = fpow32(2.7182817F, exp_arg_27870);\n        float res_27872 = res_27868 * res_27871;\n        float res_27873;\n        float redout_28658 = 0.0F;\n        \n        for (int64_t i_28659 = 0; i_28659 < res_27846; i_28659++) {\n            int64_t index_primexp_28690 = add64(1, i_28659);\n            float res_27878 = sitofp_i64_f32(index_primexp_28690);\n            float res_27879 = res",
                   "_27845 * res_27878;\n            float negate_arg_27880 = 1.0e-2F * res_27879;\n            float exp_arg_27881 = 0.0F - negate_arg_27880;\n            float res_27882 = fpow32(2.7182817F, exp_arg_27881);\n            float x_27883 = 1.0F - res_27882;\n            float B_27884 = x_27883 / 1.0e-2F;\n            float x_27885 = B_27884 - res_27879;\n            float x_27886 = 4.4999997e-6F * x_27885;\n            float A1_27887 = x_27886 / 1.0e-4F;\n            float y_27888 = fpow32(B_27884, 2.0F);\n            float x_27889 = 1.0000001e-6F * y_27888;\n            float A2_27890 = x_27889 / 4.0e-2F;\n            float exp_arg_27891 = A1_27887 - A2_27890;\n            float res_27892 = fpow32(2.7182817F, exp_arg_27891);\n            float negate_arg_27893 = 5.0e-2F * B_27884;\n            float exp_arg_27894 = 0.0F - negate_arg_27893;\n            float res_27895 = fpow32(2.7182817F, exp_arg_27894);\n            float res_27896 = res_27892 * res_27895;\n            float res_27876 = res_27896 + redout_28658;\n            float redout_tmp_28947 = res_27876;\n            \n            redout_28658 = redout_tmp_28947;\n        }\n        res_27873 = redout_28658;\n        \n        float x_27897 = 1.0F - res_27872;\n        float y_27898 = res_27845 * res_27873;\n        float res_27899 = x_27897 / y_27898;\n        \n        ((__global float *) mem_28754)[gtid_27767] = res_27899;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_27834\n}\n__kernel void testzisegmap_28043(__global int *global_failure,\n                                 int failure_is_an_option, __global\n                                 int64_t *global_failure_args,\n                                 int64_t paths_26128, int64_t steps_26129,\n                                 float dt_26142, int64_t upper_bound_26218,\n                                 float res_26219, int64_t num_groups_28295,\n                                 __global unsigned char *mem_28768, __global\n                                 unsigned char *mem_28771,",
                   " __global\n                                 unsigned char *mem_28786)\n{\n    #define segmap_group_sizze_28294 (testzisegmap_group_sizze_28045)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_28960;\n    int32_t local_tid_28961;\n    int64_t group_sizze_28964;\n    int32_t wave_sizze_28963;\n    int32_t group_tid_28962;\n    \n    global_tid_28960 = get_global_id(0);\n    local_tid_28961 = get_local_id(0);\n    group_sizze_28964 = get_local_size(0);\n    wave_sizze_28963 = LOCKSTEP_WIDTH;\n    group_tid_28962 = get_group_id(0);\n    \n    int32_t phys_tid_28043;\n    \n    phys_tid_28043 = global_tid_28960;\n    \n    int32_t phys_group_id_28965;\n    \n    phys_group_id_28965 = get_group_id(0);\n    for (int32_t i_28966 = 0; i_28966 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(paths_26128,\n                                          segmap_group_sizze_28294)) -\n                   phys_group_id_28965, sext_i64_i32(num_groups_28295));\n         i_28966++) {\n        int32_t virt_group_id_28967 = phys_group_id_28965 + i_28966 *\n                sext_i64_i32(num_groups_28295);\n        int64_t gtid_28042 = sext_i32_i64(virt_group_id_28967) *\n                segmap_group_sizze_28294 + sext_i32_i64(local_tid_28961);\n        \n        if (slt64(gtid_28042, paths_26128)) {\n            for (int64_t i_28968 = 0; i_28968 < steps_26129; i_28968++) {\n                ((__global float *) mem_28771)[phys_tid_28043 + i_28968 *\n                                               (num_groups_28295 *\n                                                segmap_group_sizze_28294)] =\n                    5.0e-2F;\n            }\n            for (int64_t i_28301 = 0; i_28301 < upper_bound_26218; i_28301++) {\n                ",
                   "bool y_28303 = slt64(i_28301, steps_26129);\n                bool index_certs_28304;\n                \n                if (!y_28303) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 11) ==\n                            -1) {\n                            global_failure_args[0] = i_28301;\n                            global_failure_args[1] = steps_26129;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                float shortstep_arg_28305 = ((__global\n                                              float *) mem_28768)[i_28301 *\n                                                                  paths_26128 +\n                                                                  gtid_28042];\n                float shortstep_arg_28306 = ((__global\n                                              float *) mem_28771)[phys_tid_28043 +\n                                                                  i_28301 *\n                                                                  (num_groups_28295 *\n                                                                   segmap_group_sizze_28294)];\n                float y_28307 = 5.0e-2F - shortstep_arg_28306;\n                float x_28308 = 1.0e-2F * y_28307;\n                float x_28309 = dt_26142 * x_28308;\n                float x_28310 = res_26219 * shortstep_arg_28305;\n                float y_28311 = 1.0e-3F * x_28310;\n                float delta_r_28312 = x_28309 + y_28311;\n                float res_28313 = shortstep_arg_28306 + delta_r_28312;\n                int64_t i_28314 = add64(1, i_28301);\n                bool x_28315 = sle64(0, i_28314);\n                bool y_28316 = slt64(i_28314, steps_26129);\n                bool bounds_check_28317 = x_28315 && y_28316;\n                bool index_certs_28318;\n                \n                if (!bounds_",
                   "check_28317) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 12) ==\n                            -1) {\n                            global_failure_args[0] = i_28314;\n                            global_failure_args[1] = steps_26129;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                ((__global float *) mem_28771)[phys_tid_28043 + i_28314 *\n                                               (num_groups_28295 *\n                                                segmap_group_sizze_28294)] =\n                    res_28313;\n            }\n            for (int64_t i_28970 = 0; i_28970 < steps_26129; i_28970++) {\n                ((__global float *) mem_28786)[i_28970 * paths_26128 +\n                                               gtid_28042] = ((__global\n                                                               float *) mem_28771)[phys_tid_28043 +\n                                                                                   i_28970 *\n                                                                                   (num_groups_28295 *\n                                                                                    segmap_group_sizze_28294)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_28294\n}\n__kernel void testzisegmap_28141(__global int *global_failure,\n                                 int64_t paths_26128, int64_t steps_26129,\n                                 __global unsigned char *mem_28761, __global\n                                 unsigned char *mem_28765)\n{\n    #define segmap_group_sizze_28249 (testzisegmap_group_sizze_28144)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n   ",
                   " \n    int32_t global_tid_28954;\n    int32_t local_tid_28955;\n    int64_t group_sizze_28958;\n    int32_t wave_sizze_28957;\n    int32_t group_tid_28956;\n    \n    global_tid_28954 = get_global_id(0);\n    local_tid_28955 = get_local_id(0);\n    group_sizze_28958 = get_local_size(0);\n    wave_sizze_28957 = LOCKSTEP_WIDTH;\n    group_tid_28956 = get_group_id(0);\n    \n    int32_t phys_tid_28141;\n    \n    phys_tid_28141 = global_tid_28954;\n    \n    int64_t gtid_28139;\n    \n    gtid_28139 = squot64(sext_i32_i64(group_tid_28956) *\n                         segmap_group_sizze_28249 +\n                         sext_i32_i64(local_tid_28955), steps_26129);\n    \n    int64_t gtid_28140;\n    \n    gtid_28140 = sext_i32_i64(group_tid_28956) * segmap_group_sizze_28249 +\n        sext_i32_i64(local_tid_28955) - squot64(sext_i32_i64(group_tid_28956) *\n                                                segmap_group_sizze_28249 +\n                                                sext_i32_i64(local_tid_28955),\n                                                steps_26129) * steps_26129;\n    if (slt64(gtid_28139, paths_26128) && slt64(gtid_28140, steps_26129)) {\n        int32_t unsign_arg_28252 = ((__global int32_t *) mem_28761)[gtid_28139];\n        int32_t res_28254 = sext_i64_i32(gtid_28140);\n        int32_t x_28255 = lshr32(res_28254, 16);\n        int32_t x_28256 = res_28254 ^ x_28255;\n        int32_t x_28257 = mul32(73244475, x_28256);\n        int32_t x_28258 = lshr32(x_28257, 16);\n        int32_t x_28259 = x_28257 ^ x_28258;\n        int32_t x_28260 = mul32(73244475, x_28259);\n        int32_t x_28261 = lshr32(x_28260, 16);\n        int32_t x_28262 = x_28260 ^ x_28261;\n        int32_t unsign_arg_28263 = unsign_arg_28252 ^ x_28262;\n        int32_t unsign_arg_28264 = mul32(48271, unsign_arg_28263);\n        int32_t unsign_arg_28265 = umod32(unsign_arg_28264, 2147483647);\n        int32_t unsign_arg_28266 = mul32(48271, unsign_arg_28265);\n        int32_t unsign_arg_28267 = umod32(unsign_arg_28266, 21474836",
                   "47);\n        float res_28268 = uitofp_i32_f32(unsign_arg_28265);\n        float res_28269 = res_28268 / 2.1474836e9F;\n        float res_28270 = uitofp_i32_f32(unsign_arg_28267);\n        float res_28271 = res_28270 / 2.1474836e9F;\n        float res_28272;\n        \n        res_28272 = futrts_log32(res_28269);\n        \n        float res_28273 = -2.0F * res_28272;\n        float res_28274;\n        \n        res_28274 = futrts_sqrt32(res_28273);\n        \n        float res_28275 = 6.2831855F * res_28271;\n        float res_28276;\n        \n        res_28276 = futrts_cos32(res_28275);\n        \n        float res_28277 = res_28274 * res_28276;\n        \n        ((__global float *) mem_28765)[gtid_28139 * steps_26129 + gtid_28140] =\n            res_28277;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_28249\n}\n__kernel void testzisegmap_28205(__global int *global_failure,\n                                 int64_t paths_26128, __global\n                                 unsigned char *mem_28761)\n{\n    #define segmap_group_sizze_28224 (testzisegmap_group_sizze_28207)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28949;\n    int32_t local_tid_28950;\n    int64_t group_sizze_28953;\n    int32_t wave_sizze_28952;\n    int32_t group_tid_28951;\n    \n    global_tid_28949 = get_global_id(0);\n    local_tid_28950 = get_local_id(0);\n    group_sizze_28953 = get_local_size(0);\n    wave_sizze_28952 = LOCKSTEP_WIDTH;\n    group_tid_28951 = get_group_id(0);\n    \n    int32_t phys_tid_28205;\n    \n    phys_tid_28205 = global_tid_28949;\n    \n    int64_t gtid_28204;\n    \n    gtid_28204 = sext_i32_i64(group_tid_28951) * segmap_group_sizze_28224 +\n        sext_i32_i64(local_tid_28950);\n    if (slt64(gtid_28204, paths_26128)) {\n        int32_t res_28228 = sext_i64_i32(gtid_28204);\n        int32_t x_28229 = lshr32(res_28228, 16);\n        int32_t x_28230 = res_28228 ^ x_2822",
                   "9;\n        int32_t x_28231 = mul32(73244475, x_28230);\n        int32_t x_28232 = lshr32(x_28231, 16);\n        int32_t x_28233 = x_28231 ^ x_28232;\n        int32_t x_28234 = mul32(73244475, x_28233);\n        int32_t x_28235 = lshr32(x_28234, 16);\n        int32_t x_28236 = x_28234 ^ x_28235;\n        int32_t unsign_arg_28237 = 777822902 ^ x_28236;\n        int32_t unsign_arg_28238 = mul32(48271, unsign_arg_28237);\n        int32_t unsign_arg_28239 = umod32(unsign_arg_28238, 2147483647);\n        \n        ((__global int32_t *) mem_28761)[gtid_28204] = unsign_arg_28239;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_28224\n}\n__kernel void testzisegmap_28498(__global int *global_failure,\n                                 int64_t res_26316, int64_t num_segments_26504,\n                                 __global unsigned char *mem_28809, __global\n                                 unsigned char *mem_28814, __global\n                                 unsigned char *mem_28817, __global\n                                 unsigned char *mem_28819)\n{\n    #define segmap_group_sizze_28501 (testzisegmap_group_sizze_28500)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29475;\n    int32_t local_tid_29476;\n    int64_t group_sizze_29479;\n    int32_t wave_sizze_29478;\n    int32_t group_tid_29477;\n    \n    global_tid_29475 = get_global_id(0);\n    local_tid_29476 = get_local_id(0);\n    group_sizze_29479 = get_local_size(0);\n    wave_sizze_29478 = LOCKSTEP_WIDTH;\n    group_tid_29477 = get_group_id(0);\n    \n    int32_t phys_tid_28498;\n    \n    phys_tid_28498 = global_tid_29475;\n    \n    int64_t write_i_28497;\n    \n    write_i_28497 = sext_i32_i64(group_tid_29477) * segmap_group_sizze_28501 +\n        sext_i32_i64(local_tid_29476);\n    if (slt64(write_i_28497, res_26316)) {\n        int64_t i_p_o_28683 = add64(1, write_i_28497);\n        int64_t rot_i_28684 = smod64",
                   "(i_p_o_28683, res_26316);\n        bool x_26517 = ((__global bool *) mem_28809)[rot_i_28684];\n        float write_value_26518 = ((__global float *) mem_28814)[write_i_28497];\n        int64_t res_26519;\n        \n        if (x_26517) {\n            int64_t x_26516 = ((__global int64_t *) mem_28817)[write_i_28497];\n            int64_t res_26520 = sub64(x_26516, 1);\n            \n            res_26519 = res_26520;\n        } else {\n            res_26519 = -1;\n        }\n        if (sle64(0, res_26519) && slt64(res_26519, num_segments_26504)) {\n            ((__global float *) mem_28819)[res_26519] = write_value_26518;\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_28501\n}\n__kernel void testzisegmap_28536(__global int *global_failure,\n                                 int64_t paths_26128, __global\n                                 unsigned char *mem_28829, __global\n                                 unsigned char *mem_28832)\n{\n    #define segmap_group_sizze_28615 (testzisegmap_group_sizze_28538)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29511;\n    int32_t local_tid_29512;\n    int64_t group_sizze_29515;\n    int32_t wave_sizze_29514;\n    int32_t group_tid_29513;\n    \n    global_tid_29511 = get_global_id(0);\n    local_tid_29512 = get_local_id(0);\n    group_sizze_29515 = get_local_size(0);\n    wave_sizze_29514 = LOCKSTEP_WIDTH;\n    group_tid_29513 = get_group_id(0);\n    \n    int32_t phys_tid_28536;\n    \n    phys_tid_28536 = global_tid_29511;\n    \n    int64_t gtid_28535;\n    \n    gtid_28535 = sext_i32_i64(group_tid_29513) * segmap_group_sizze_28615 +\n        sext_i32_i64(local_tid_29512);\n    if (slt64(gtid_28535, paths_26128)) {\n        float res_28619;\n        float redout_28724 = 0.0F;\n        \n        for (int32_t i_28727 = 0; i_28727 < 45; i_28727++) {\n            int64_t i_28725 = sext_i32_i64(i_28727);\n            float x_",
                   "28623 = ((__global float *) mem_28829)[i_28725 *\n                                                           paths_26128 +\n                                                           gtid_28535];\n            float res_28622 = x_28623 + redout_28724;\n            float redout_tmp_29516 = res_28622;\n            \n            redout_28724 = redout_tmp_29516;\n        }\n        res_28619 = redout_28724;\n        \n        float res_28624 = fmax32(0.0F, res_28619);\n        \n        ((__global float *) mem_28832)[gtid_28535] = res_28624;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_28615\n}\n__kernel void testzisegmap_28561(__global int *global_failure,\n                                 int64_t paths_26128, __global\n                                 unsigned char *mem_28835, __global\n                                 unsigned char *mem_28838)\n{\n    #define segmap_group_sizze_28637 (testzisegmap_group_sizze_28563)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29577;\n    int32_t local_tid_29578;\n    int64_t group_sizze_29581;\n    int32_t wave_sizze_29580;\n    int32_t group_tid_29579;\n    \n    global_tid_29577 = get_global_id(0);\n    local_tid_29578 = get_local_id(0);\n    group_sizze_29581 = get_local_size(0);\n    wave_sizze_29580 = LOCKSTEP_WIDTH;\n    group_tid_29579 = get_group_id(0);\n    \n    int32_t phys_tid_28561;\n    \n    phys_tid_28561 = global_tid_29577;\n    \n    int64_t gtid_28560;\n    \n    gtid_28560 = sext_i32_i64(group_tid_29579) * segmap_group_sizze_28637 +\n        sext_i32_i64(local_tid_29578);\n    if (slt64(gtid_28560, paths_26128)) {\n        float res_28640 = ((__global float *) mem_28835)[gtid_28560];\n        float res_28641 = fmax32(0.0F, res_28640);\n        \n        ((__global float *) mem_28838)[gtid_28560] = res_28641;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_28637\n}\n__kernel void testzisegred_large",
                   "_28577(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *sync_arr_mem_29554_backing_aligned_0,\n                                       __local volatile\n                                       int64_t *red_arr_mem_29552_backing_aligned_1,\n                                       int64_t num_groups_28628, __global\n                                       unsigned char *mem_28819, __global\n                                       unsigned char *mem_28835,\n                                       int64_t groups_per_segment_29538,\n                                       int64_t elements_per_thread_29539,\n                                       int64_t virt_num_groups_29540,\n                                       int64_t threads_per_segment_29542,\n                                       __global\n                                       unsigned char *group_res_arr_mem_29543,\n                                       __global\n                                       unsigned char *testzicounter_mem_29545)\n{\n    #define segred_group_sizze_28627 (testzisegred_group_sizze_28571)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict sync_arr_mem_29554_backing_1 =\n                          (__local volatile\n                           char *) sync_arr_mem_29554_backing_aligned_0;\n    __local volatile char *restrict red_arr_mem_29552_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_29552_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29547;\n    int32_t local_tid_29548;\n    int64_t group_sizze_29551;\n    int32_t wave_sizze_29550;\n    int32_t group_tid_29549;\n    \n    global_tid_29547 = get_global_id(0);\n    local_tid_29548 = get_local_id(0);\n    group_sizze_29551 = get_local_size(0);\n    wave_sizze_29550 = LOCKSTEP_WIDTH;\n    group_tid_295",
                   "49 = get_group_id(0);\n    \n    int32_t phys_tid_28577;\n    \n    phys_tid_28577 = global_tid_29547;\n    \n    __local char *red_arr_mem_29552;\n    \n    red_arr_mem_29552 = (__local char *) red_arr_mem_29552_backing_0;\n    \n    __local char *sync_arr_mem_29554;\n    \n    sync_arr_mem_29554 = (__local char *) sync_arr_mem_29554_backing_1;\n    \n    int32_t phys_group_id_29556;\n    \n    phys_group_id_29556 = get_group_id(0);\n    for (int32_t i_29557 = 0; i_29557 <\n         sdiv_up32(sext_i64_i32(virt_num_groups_29540) - phys_group_id_29556,\n                   sext_i64_i32(num_groups_28628)); i_29557++) {\n        int32_t virt_group_id_29558 = phys_group_id_29556 + i_29557 *\n                sext_i64_i32(num_groups_28628);\n        int32_t flat_segment_id_29559 = squot32(virt_group_id_29558,\n                                                sext_i64_i32(groups_per_segment_29538));\n        int64_t global_tid_29560 = srem64(sext_i32_i64(virt_group_id_29558) *\n                                          segred_group_sizze_28627 +\n                                          sext_i32_i64(local_tid_29548),\n                                          segred_group_sizze_28627 *\n                                          groups_per_segment_29538);\n        int64_t gtid_28568 = sext_i32_i64(flat_segment_id_29559);\n        int64_t gtid_28576;\n        float x_acc_29561;\n        int64_t chunk_sizze_29562;\n        \n        chunk_sizze_29562 = smin64(elements_per_thread_29539, sdiv_up64(45 -\n                                                                        sext_i32_i64(sext_i64_i32(global_tid_29560)),\n                                                                        threads_per_segment_29542));\n        \n        float x_28631;\n        float x_28632;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_29561 = 0.0F;\n        }\n        for (int64_t i_29566 = 0; i_29566 < chunk_sizze_29562; i_29566++) {\n            gtid_28576 = sext_i32_i64(sext_i64_i32(global_tid",
                   "_29560)) +\n                threads_per_segment_29542 * i_29566;\n            // apply map function\n            {\n                int64_t binop_x_28697 = 45 * gtid_28568;\n                int64_t new_index_28698 = gtid_28576 + binop_x_28697;\n                float x_28635 = ((__global float *) mem_28819)[new_index_28698];\n                \n                // save map-out results\n                { }\n                // load accumulator\n                {\n                    x_28631 = x_acc_29561;\n                }\n                // load new values\n                {\n                    x_28632 = x_28635;\n                }\n                // apply reduction operator\n                {\n                    float res_28633 = x_28631 + x_28632;\n                    \n                    // store in accumulator\n                    {\n                        x_acc_29561 = res_28633;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_28631 = x_acc_29561;\n            ((__local\n              float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                x_28631;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_29567;\n        int32_t skip_waves_29568;\n        \n        skip_waves_29568 = 1;\n        \n        float x_29563;\n        float x_29564;\n        \n        offset_29567 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_29548,\n                      sext_i64_i32(segred_group_sizze_28627))) {\n                x_29563 = ((__local\n                            float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                        offset_29567)];\n            }\n        }\n        offset_29567 = 1;\n        while (slt32(offset_29567, wave_sizze_29550)) {\n            if (slt32(local_tid_29548 + offset_29567,\n                      sext_i64_i32(segred_grou",
                   "p_sizze_28627)) &&\n                ((local_tid_29548 - squot32(local_tid_29548, wave_sizze_29550) *\n                  wave_sizze_29550) & (2 * offset_29567 - 1)) == 0) {\n                // read array element\n                {\n                    x_29564 = ((volatile __local\n                                float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                            offset_29567)];\n                }\n                // apply reduction operation\n                {\n                    float res_29565 = x_29563 + x_29564;\n                    \n                    x_29563 = res_29565;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                        x_29563;\n                }\n            }\n            offset_29567 *= 2;\n        }\n        while (slt32(skip_waves_29568,\n                     squot32(sext_i64_i32(segred_group_sizze_28627) +\n                             wave_sizze_29550 - 1, wave_sizze_29550))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_29567 = skip_waves_29568 * wave_sizze_29550;\n            if (slt32(local_tid_29548 + offset_29567,\n                      sext_i64_i32(segred_group_sizze_28627)) &&\n                ((local_tid_29548 - squot32(local_tid_29548, wave_sizze_29550) *\n                  wave_sizze_29550) == 0 && (squot32(local_tid_29548,\n                                                     wave_sizze_29550) & (2 *\n                                                                          skip_waves_29568 -\n                                                                          1)) ==\n                 0)) {\n                // read array element\n                {\n                    x_29564 = ((__local\n                                float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                             ",
                   "                               offset_29567)];\n                }\n                // apply reduction operation\n                {\n                    float res_29565 = x_29563 + x_29564;\n                    \n                    x_29563 = res_29565;\n                }\n                // write result of operation\n                {\n                    ((__local\n                      float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                        x_29563;\n                }\n            }\n            skip_waves_29568 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (sext_i32_i64(local_tid_29548) == 0) {\n                x_acc_29561 = x_29563;\n            }\n        }\n        if (groups_per_segment_29538 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_29548 == 0) {\n                    ((__global float *) mem_28835)[gtid_28568] = x_acc_29561;\n                }\n            }\n        } else {\n            int32_t old_counter_29569;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_29548 == 0) {\n                    ((__global\n                      float *) group_res_arr_mem_29543)[sext_i32_i64(virt_group_id_29558) *\n                                                        segred_group_sizze_28627] =\n                        x_acc_29561;\n                    mem_fence_global();\n                    old_counter_29569 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) testzicounter_mem_29545)[sext_i32_i64(srem32(flat_segment_id_29559,\n                                                                                                     10240))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_29554)[0] =\n    ",
                   "                    old_counter_29569 == groups_per_segment_29538 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            \n            bool is_last_group_29570;\n            \n            is_last_group_29570 = ((__local bool *) sync_arr_mem_29554)[0];\n            if (is_last_group_29570) {\n                if (local_tid_29548 == 0) {\n                    old_counter_29569 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) testzicounter_mem_29545)[sext_i32_i64(srem32(flat_segment_id_29559,\n                                                                                                     10240))],\n                                              (int) (0 -\n                                                     groups_per_segment_29538));\n                }\n                // read in the per-group-results\n                {\n                    int64_t read_per_thread_29571 =\n                            sdiv_up64(groups_per_segment_29538,\n                                      segred_group_sizze_28627);\n                    \n                    x_28631 = 0.0F;\n                    for (int64_t i_29572 = 0; i_29572 < read_per_thread_29571;\n                         i_29572++) {\n                        int64_t group_res_id_29573 =\n                                sext_i32_i64(local_tid_29548) *\n                                read_per_thread_29571 + i_29572;\n                        int64_t index_of_group_res_29574 =\n                                sext_i32_i64(flat_segment_id_29559) *\n                                groups_per_segment_29538 + group_res_id_29573;\n                        \n                        if (slt64(group_res_id_29573,\n                                  groups_per_segment_29538)) {\n                            x_28632 = ((__global\n                                        float *) group_res_arr_mem_29543)[index_of_group_res_29574 *\n       ",
                   "                                                                   segred_group_sizze_28627];\n                            \n                            float res_28633;\n                            \n                            res_28633 = x_28631 + x_28632;\n                            x_28631 = res_28633;\n                        }\n                    }\n                }\n                ((__local\n                  float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                    x_28631;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n                    int32_t offset_29575;\n                    int32_t skip_waves_29576;\n                    \n                    skip_waves_29576 = 1;\n                    \n                    float x_29563;\n                    float x_29564;\n                    \n                    offset_29575 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_29548,\n                                  sext_i64_i32(segred_group_sizze_28627))) {\n                            x_29563 = ((__local\n                                        float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                                    offset_29575)];\n                        }\n                    }\n                    offset_29575 = 1;\n                    while (slt32(offset_29575, wave_sizze_29550)) {\n                        if (slt32(local_tid_29548 + offset_29575,\n                                  sext_i64_i32(segred_group_sizze_28627)) &&\n                            ((local_tid_29548 - squot32(local_tid_29548,\n                                                        wave_sizze_29550) *\n                              wave_sizze_29550) & (2 * offset_29575 - 1)) ==\n                            0) {\n                            // read array element\n                         ",
                   "   {\n                                x_29564 = ((volatile __local\n                                            float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                                        offset_29575)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_29565 = x_29563 + x_29564;\n                                \n                                x_29563 = res_29565;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                                    x_29563;\n                            }\n                        }\n                        offset_29575 *= 2;\n                    }\n                    while (slt32(skip_waves_29576,\n                                 squot32(sext_i64_i32(segred_group_sizze_28627) +\n                                         wave_sizze_29550 - 1,\n                                         wave_sizze_29550))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_29575 = skip_waves_29576 * wave_sizze_29550;\n                        if (slt32(local_tid_29548 + offset_29575,\n                                  sext_i64_i32(segred_group_sizze_28627)) &&\n                            ((local_tid_29548 - squot32(local_tid_29548,\n                                                        wave_sizze_29550) *\n                              wave_sizze_29550) == 0 &&\n                             (squot32(local_tid_29548, wave_sizze_29550) & (2 *\n                                                                            skip_waves_29576 -\n                                                                            1)) ==\n                             0)) {\n            ",
                   "                // read array element\n                            {\n                                x_29564 = ((__local\n                                            float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548 +\n                                                                        offset_29575)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_29565 = x_29563 + x_29564;\n                                \n                                x_29563 = res_29565;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  float *) red_arr_mem_29552)[sext_i32_i64(local_tid_29548)] =\n                                    x_29563;\n                            }\n                        }\n                        skip_waves_29576 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_29548 == 0) {\n                            ((__global float *) mem_28835)[gtid_28568] =\n                                x_29563;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_28627\n}\n__kernel void testzisegred_large_29153(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *sync_arr_mem_29191_backing_aligned_0,\n                                       __local volatile\n                                       int64_t *red_arr_mem_29189_backing_aligned_1,\n                                       int64_t res_26316,\n                                       int64_t num_groups_28410, __global\n                                  ",
                   "     unsigned char *mem_28796,\n                                       int32_t num_subhistos_29067, __global\n                                       unsigned char *res_subhistos_mem_29068,\n                                       int64_t groups_per_segment_29175,\n                                       int64_t elements_per_thread_29176,\n                                       int64_t virt_num_groups_29177,\n                                       int64_t threads_per_segment_29179,\n                                       __global\n                                       unsigned char *group_res_arr_mem_29180,\n                                       __global\n                                       unsigned char *testzicounter_mem_29182)\n{\n    #define seghist_group_sizze_28408 (testziseghist_group_sizze_28407)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict sync_arr_mem_29191_backing_1 =\n                          (__local volatile\n                           char *) sync_arr_mem_29191_backing_aligned_0;\n    __local volatile char *restrict red_arr_mem_29189_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_29189_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29184;\n    int32_t local_tid_29185;\n    int64_t group_sizze_29188;\n    int32_t wave_sizze_29187;\n    int32_t group_tid_29186;\n    \n    global_tid_29184 = get_global_id(0);\n    local_tid_29185 = get_local_id(0);\n    group_sizze_29188 = get_local_size(0);\n    wave_sizze_29187 = LOCKSTEP_WIDTH;\n    group_tid_29186 = get_group_id(0);\n    \n    int32_t flat_gtid_29153;\n    \n    flat_gtid_29153 = global_tid_29184;\n    \n    __local char *red_arr_mem_29189;\n    \n    red_arr_mem_29189 = (__local char *) red_arr_mem_29189_backing_0;\n    \n    __local char *sync_arr_mem_29191;\n    \n    sync_arr_mem_29191 = (__local char *) sync_arr_mem_29191_backing_1;\n    \n ",
                   "   int32_t phys_group_id_29193;\n    \n    phys_group_id_29193 = get_group_id(0);\n    for (int32_t i_29194 = 0; i_29194 <\n         sdiv_up32(sext_i64_i32(virt_num_groups_29177) - phys_group_id_29193,\n                   sext_i64_i32(num_groups_28410)); i_29194++) {\n        int32_t virt_group_id_29195 = phys_group_id_29193 + i_29194 *\n                sext_i64_i32(num_groups_28410);\n        int32_t flat_segment_id_29196 = squot32(virt_group_id_29195,\n                                                sext_i64_i32(groups_per_segment_29175));\n        int64_t global_tid_29197 = srem64(sext_i32_i64(virt_group_id_29195) *\n                                          seghist_group_sizze_28408 +\n                                          sext_i32_i64(local_tid_29185),\n                                          seghist_group_sizze_28408 *\n                                          groups_per_segment_29175);\n        int64_t bucket_id_29151 = sext_i32_i64(flat_segment_id_29196);\n        int64_t subhistogram_id_29152;\n        int64_t x_acc_29198;\n        int64_t chunk_sizze_29199;\n        \n        chunk_sizze_29199 = smin64(elements_per_thread_29176,\n                                   sdiv_up64(num_subhistos_29067 -\n                                             sext_i32_i64(sext_i64_i32(global_tid_29197)),\n                                             threads_per_segment_29179));\n        \n        int64_t x_28414;\n        int64_t x_28415;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_29198 = 0;\n        }\n        for (int64_t i_29203 = 0; i_29203 < chunk_sizze_29199; i_29203++) {\n            subhistogram_id_29152 =\n                sext_i32_i64(sext_i64_i32(global_tid_29197)) +\n                threads_per_segment_29179 * i_29203;\n            // apply map function\n            {\n                // load accumulator\n                {\n                    x_28414 = x_acc_29198;\n                }\n                // load new values\n                {\n                ",
                   "    x_28415 = ((__global\n                                int64_t *) res_subhistos_mem_29068)[subhistogram_id_29152 *\n                                                                    res_26316 +\n                                                                    bucket_id_29151];\n                }\n                // apply reduction operator\n                {\n                    int64_t res_28416 = smax64(x_28414, x_28415);\n                    \n                    // store in accumulator\n                    {\n                        x_acc_29198 = res_28416;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_28414 = x_acc_29198;\n            ((__local\n              int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                x_28414;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_29204;\n        int32_t skip_waves_29205;\n        \n        skip_waves_29205 = 1;\n        \n        int64_t x_29200;\n        int64_t x_29201;\n        \n        offset_29204 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_29185,\n                      sext_i64_i32(seghist_group_sizze_28408))) {\n                x_29200 = ((__local\n                            int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185 +\n                                                          offset_29204)];\n            }\n        }\n        offset_29204 = 1;\n        while (slt32(offset_29204, wave_sizze_29187)) {\n            if (slt32(local_tid_29185 + offset_29204,\n                      sext_i64_i32(seghist_group_sizze_28408)) &&\n                ((local_tid_29185 - squot32(local_tid_29185, wave_sizze_29187) *\n                  wave_sizze_29187) & (2 * offset_29204 - 1)) == 0) {\n                // read array element\n                {\n                    x_29201 = ((volatile __local\n                         ",
                   "       int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185 +\n                                                              offset_29204)];\n                }\n                // apply reduction operation\n                {\n                    int64_t res_29202 = smax64(x_29200, x_29201);\n                    \n                    x_29200 = res_29202;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                        x_29200;\n                }\n            }\n            offset_29204 *= 2;\n        }\n        while (slt32(skip_waves_29205,\n                     squot32(sext_i64_i32(seghist_group_sizze_28408) +\n                             wave_sizze_29187 - 1, wave_sizze_29187))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_29204 = skip_waves_29205 * wave_sizze_29187;\n            if (slt32(local_tid_29185 + offset_29204,\n                      sext_i64_i32(seghist_group_sizze_28408)) &&\n                ((local_tid_29185 - squot32(local_tid_29185, wave_sizze_29187) *\n                  wave_sizze_29187) == 0 && (squot32(local_tid_29185,\n                                                     wave_sizze_29187) & (2 *\n                                                                          skip_waves_29205 -\n                                                                          1)) ==\n                 0)) {\n                // read array element\n                {\n                    x_29201 = ((__local\n                                int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185 +\n                                                              offset_29204)];\n                }\n                // apply reduction operation\n                {\n                    int64_t res_29202 = smax64(x_29200, x_29201);\n                    \n                    x_29200 = res_29202;\n                }\n     ",
                   "           // write result of operation\n                {\n                    ((__local\n                      int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                        x_29200;\n                }\n            }\n            skip_waves_29205 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (sext_i32_i64(local_tid_29185) == 0) {\n                x_acc_29198 = x_29200;\n            }\n        }\n        if (groups_per_segment_29175 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_29185 == 0) {\n                    ((__global int64_t *) mem_28796)[bucket_id_29151] =\n                        x_acc_29198;\n                }\n            }\n        } else {\n            int32_t old_counter_29206;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_29185 == 0) {\n                    ((__global\n                      int64_t *) group_res_arr_mem_29180)[sext_i32_i64(virt_group_id_29195) *\n                                                          seghist_group_sizze_28408] =\n                        x_acc_29198;\n                    mem_fence_global();\n                    old_counter_29206 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) testzicounter_mem_29182)[sext_i32_i64(srem32(flat_segment_id_29196,\n                                                                                                     10240))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_29191)[0] =\n                        old_counter_29206 == groups_per_segment_29175 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            \n            bool is_last_group_29207;\n            \n",
                   "            is_last_group_29207 = ((__local bool *) sync_arr_mem_29191)[0];\n            if (is_last_group_29207) {\n                if (local_tid_29185 == 0) {\n                    old_counter_29206 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) testzicounter_mem_29182)[sext_i32_i64(srem32(flat_segment_id_29196,\n                                                                                                     10240))],\n                                              (int) (0 -\n                                                     groups_per_segment_29175));\n                }\n                // read in the per-group-results\n                {\n                    int64_t read_per_thread_29208 =\n                            sdiv_up64(groups_per_segment_29175,\n                                      seghist_group_sizze_28408);\n                    \n                    x_28414 = 0;\n                    for (int64_t i_29209 = 0; i_29209 < read_per_thread_29208;\n                         i_29209++) {\n                        int64_t group_res_id_29210 =\n                                sext_i32_i64(local_tid_29185) *\n                                read_per_thread_29208 + i_29209;\n                        int64_t index_of_group_res_29211 =\n                                sext_i32_i64(flat_segment_id_29196) *\n                                groups_per_segment_29175 + group_res_id_29210;\n                        \n                        if (slt64(group_res_id_29210,\n                                  groups_per_segment_29175)) {\n                            x_28415 = ((__global\n                                        int64_t *) group_res_arr_mem_29180)[index_of_group_res_29211 *\n                                                                            seghist_group_sizze_28408];\n                            \n                            int64_t res_28416;\n                            \n                            re",
                   "s_28416 = smax64(x_28414, x_28415);\n                            x_28414 = res_28416;\n                        }\n                    }\n                }\n                ((__local\n                  int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                    x_28414;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n                    int32_t offset_29212;\n                    int32_t skip_waves_29213;\n                    \n                    skip_waves_29213 = 1;\n                    \n                    int64_t x_29200;\n                    int64_t x_29201;\n                    \n                    offset_29212 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_29185,\n                                  sext_i64_i32(seghist_group_sizze_28408))) {\n                            x_29200 = ((__local\n                                        int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185 +\n                                                                      offset_29212)];\n                        }\n                    }\n                    offset_29212 = 1;\n                    while (slt32(offset_29212, wave_sizze_29187)) {\n                        if (slt32(local_tid_29185 + offset_29212,\n                                  sext_i64_i32(seghist_group_sizze_28408)) &&\n                            ((local_tid_29185 - squot32(local_tid_29185,\n                                                        wave_sizze_29187) *\n                              wave_sizze_29187) & (2 * offset_29212 - 1)) ==\n                            0) {\n                            // read array element\n                            {\n                                x_29201 = ((volatile __local\n                                            int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185 +\n                                     ",
                   "                                     offset_29212)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t res_29202 = smax64(x_29200, x_29201);\n                                \n                                x_29200 = res_29202;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                                    x_29200;\n                            }\n                        }\n                        offset_29212 *= 2;\n                    }\n                    while (slt32(skip_waves_29213,\n                                 squot32(sext_i64_i32(seghist_group_sizze_28408) +\n                                         wave_sizze_29187 - 1,\n                                         wave_sizze_29187))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_29212 = skip_waves_29213 * wave_sizze_29187;\n                        if (slt32(local_tid_29185 + offset_29212,\n                                  sext_i64_i32(seghist_group_sizze_28408)) &&\n                            ((local_tid_29185 - squot32(local_tid_29185,\n                                                        wave_sizze_29187) *\n                              wave_sizze_29187) == 0 &&\n                             (squot32(local_tid_29185, wave_sizze_29187) & (2 *\n                                                                            skip_waves_29213 -\n                                                                            1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_29201 = ((__local\n                                            int64_t *) red_arr_mem_2918",
                   "9)[sext_i32_i64(local_tid_29185 +\n                                                                          offset_29212)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t res_29202 = smax64(x_29200, x_29201);\n                                \n                                x_29200 = res_29202;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  int64_t *) red_arr_mem_29189)[sext_i32_i64(local_tid_29185)] =\n                                    x_29200;\n                            }\n                        }\n                        skip_waves_29213 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_29185 == 0) {\n                            ((__global int64_t *) mem_28796)[bucket_id_29151] =\n                                x_29200;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef seghist_group_sizze_28408\n}\n__kernel void testzisegred_nonseg_27615(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_28918_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_28916_backing_aligned_1,\n                                        int64_t num_groups_27610, __global\n                                        unsigned char *mem_28731, __global\n                                        unsigned char *mem_28733, __global\n                                        unsigned char *mem_28736, __global\n                             ",
                   "           unsigned char *testzicounter_mem_28906,\n                                        __global\n                                        unsigned char *group_res_arr_mem_28908,\n                                        int64_t num_threads_28910)\n{\n    #define segred_group_sizze_27608 (testzisegred_group_sizze_27607)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_28918_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_28918_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_28916_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_28916_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_28911;\n    int32_t local_tid_28912;\n    int64_t group_sizze_28915;\n    int32_t wave_sizze_28914;\n    int32_t group_tid_28913;\n    \n    global_tid_28911 = get_global_id(0);\n    local_tid_28912 = get_local_id(0);\n    group_sizze_28915 = get_local_size(0);\n    wave_sizze_28914 = LOCKSTEP_WIDTH;\n    group_tid_28913 = get_group_id(0);\n    \n    int32_t phys_tid_27615;\n    \n    phys_tid_27615 = global_tid_28911;\n    \n    __local char *sync_arr_mem_28916;\n    \n    sync_arr_mem_28916 = (__local char *) sync_arr_mem_28916_backing_0;\n    \n    __local char *red_arr_mem_28918;\n    \n    red_arr_mem_28918 = (__local char *) red_arr_mem_28918_backing_1;\n    \n    int64_t dummy_27613;\n    \n    dummy_27613 = 0;\n    \n    int64_t gtid_27614;\n    \n    gtid_27614 = 0;\n    \n    float x_acc_28920;\n    int64_t chunk_sizze_28921;\n    \n    chunk_sizze_28921 = smin64(sdiv_up64(45,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_27608 *\n                                         num_groups_27610))), sdiv_up64(45 -\n                                                                        sext_i32_i64(phys_tid_27615),\n   ",
                   "                                                                     num_threads_28910));\n    \n    float x_26134;\n    float x_26135;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_28920 = -INFINITY;\n    }\n    for (int64_t i_28925 = 0; i_28925 < chunk_sizze_28921; i_28925++) {\n        gtid_27614 = sext_i32_i64(phys_tid_27615) + num_threads_28910 * i_28925;\n        // apply map function\n        {\n            float x_26137 = ((__global float *) mem_28733)[gtid_27614];\n            int64_t x_26138 = ((__global int64_t *) mem_28731)[gtid_27614];\n            float res_26139 = sitofp_i64_f32(x_26138);\n            float res_26140 = x_26137 * res_26139;\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_26134 = x_acc_28920;\n            }\n            // load new values\n            {\n                x_26135 = res_26140;\n            }\n            // apply reduction operator\n            {\n                float res_26136 = fmax32(x_26134, x_26135);\n                \n                // store in accumulator\n                {\n                    x_acc_28920 = res_26136;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_26134 = x_acc_28920;\n        ((__local float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912)] =\n            x_26134;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_28926;\n    int32_t skip_waves_28927;\n    \n    skip_waves_28927 = 1;\n    \n    float x_28922;\n    float x_28923;\n    \n    offset_28926 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_28912, sext_i64_i32(segred_group_sizze_27608))) {\n            x_28922 = ((__local\n                        float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912 +\n                                                    offset_28926)];\n        }\n    }\n    offset_28926 = 1;\n    while (slt32(offse",
                   "t_28926, wave_sizze_28914)) {\n        if (slt32(local_tid_28912 + offset_28926,\n                  sext_i64_i32(segred_group_sizze_27608)) && ((local_tid_28912 -\n                                                               squot32(local_tid_28912,\n                                                                       wave_sizze_28914) *\n                                                               wave_sizze_28914) &\n                                                              (2 *\n                                                               offset_28926 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_28923 = ((volatile __local\n                            float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912 +\n                                                        offset_28926)];\n            }\n            // apply reduction operation\n            {\n                float res_28924 = fmax32(x_28922, x_28923);\n                \n                x_28922 = res_28924;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912)] =\n                    x_28922;\n            }\n        }\n        offset_28926 *= 2;\n    }\n    while (slt32(skip_waves_28927,\n                 squot32(sext_i64_i32(segred_group_sizze_27608) +\n                         wave_sizze_28914 - 1, wave_sizze_28914))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_28926 = skip_waves_28927 * wave_sizze_28914;\n        if (slt32(local_tid_28912 + offset_28926,\n                  sext_i64_i32(segred_group_sizze_27608)) && ((local_tid_28912 -\n                                                               squot32(local_tid_28912,\n                                                                       wave_sizze_28914) *\n                                                               wave_sizze_2",
                   "8914) ==\n                                                              0 &&\n                                                              (squot32(local_tid_28912,\n                                                                       wave_sizze_28914) &\n                                                               (2 *\n                                                                skip_waves_28927 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_28923 = ((__local\n                            float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912 +\n                                                        offset_28926)];\n            }\n            // apply reduction operation\n            {\n                float res_28924 = fmax32(x_28922, x_28923);\n                \n                x_28922 = res_28924;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912)] =\n                    x_28922;\n            }\n        }\n        skip_waves_28927 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_28912) == 0) {\n            x_acc_28920 = x_28922;\n        }\n    }\n    \n    int32_t old_counter_28928;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_28912 == 0) {\n            ((__global\n              float *) group_res_arr_mem_28908)[sext_i32_i64(group_tid_28913) *\n                                                segred_group_sizze_27608] =\n                x_acc_28920;\n            mem_fence_global();\n            old_counter_28928 = atomic_add_i32_global(&((volatile __global\n                                                         int *) testzicounter_mem_28906)[0],\n                                                      (int) 1);\n            ((",
                   "__local bool *) sync_arr_mem_28916)[0] = old_counter_28928 ==\n                num_groups_27610 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_28929;\n    \n    is_last_group_28929 = ((__local bool *) sync_arr_mem_28916)[0];\n    if (is_last_group_28929) {\n        if (local_tid_28912 == 0) {\n            old_counter_28928 = atomic_add_i32_global(&((volatile __global\n                                                         int *) testzicounter_mem_28906)[0],\n                                                      (int) (0 -\n                                                             num_groups_27610));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_28930 = sdiv_up64(num_groups_27610,\n                                                      segred_group_sizze_27608);\n            \n            x_26134 = -INFINITY;\n            for (int64_t i_28931 = 0; i_28931 < read_per_thread_28930;\n                 i_28931++) {\n                int64_t group_res_id_28932 = sext_i32_i64(local_tid_28912) *\n                        read_per_thread_28930 + i_28931;\n                int64_t index_of_group_res_28933 = group_res_id_28932;\n                \n                if (slt64(group_res_id_28932, num_groups_27610)) {\n                    x_26135 = ((__global\n                                float *) group_res_arr_mem_28908)[index_of_group_res_28933 *\n                                                                  segred_group_sizze_27608];\n                    \n                    float res_26136;\n                    \n                    res_26136 = fmax32(x_26134, x_26135);\n                    x_26134 = res_26136;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912)] =\n            x_26134;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_28934;\n            int32_t",
                   " skip_waves_28935;\n            \n            skip_waves_28935 = 1;\n            \n            float x_28922;\n            float x_28923;\n            \n            offset_28934 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_28912,\n                          sext_i64_i32(segred_group_sizze_27608))) {\n                    x_28922 = ((__local\n                                float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912 +\n                                                            offset_28934)];\n                }\n            }\n            offset_28934 = 1;\n            while (slt32(offset_28934, wave_sizze_28914)) {\n                if (slt32(local_tid_28912 + offset_28934,\n                          sext_i64_i32(segred_group_sizze_27608)) &&\n                    ((local_tid_28912 - squot32(local_tid_28912,\n                                                wave_sizze_28914) *\n                      wave_sizze_28914) & (2 * offset_28934 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_28923 = ((volatile __local\n                                    float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912 +\n                                                                offset_28934)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_28924 = fmax32(x_28922, x_28923);\n                        \n                        x_28922 = res_28924;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912)] =\n                            x_28922;\n                    }\n                }\n                offset_28934 *= 2;\n            }\n            while (slt32(skip_waves_28935,\n                         squot32(sext_i64_i32(segred_group",
                   "_sizze_27608) +\n                                 wave_sizze_28914 - 1, wave_sizze_28914))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_28934 = skip_waves_28935 * wave_sizze_28914;\n                if (slt32(local_tid_28912 + offset_28934,\n                          sext_i64_i32(segred_group_sizze_27608)) &&\n                    ((local_tid_28912 - squot32(local_tid_28912,\n                                                wave_sizze_28914) *\n                      wave_sizze_28914) == 0 && (squot32(local_tid_28912,\n                                                         wave_sizze_28914) &\n                                                 (2 * skip_waves_28935 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_28923 = ((__local\n                                    float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912 +\n                                                                offset_28934)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_28924 = fmax32(x_28922, x_28923);\n                        \n                        x_28922 = res_28924;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_28918)[sext_i32_i64(local_tid_28912)] =\n                            x_28922;\n                    }\n                }\n                skip_waves_28935 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_28912 == 0) {\n                    ((__global float *) mem_28736)[0] = x_28922;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_27608\n}\n__kernel void testzisegred_nonseg_28405(__global int *global_failure,\n                                        __local volati",
                   "le\n                                        int64_t *red_arr_mem_29040_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_29038_backing_aligned_1,\n                                        int64_t flat_dim_26283,\n                                        int64_t num_groups_28400, __global\n                                        unsigned char *mem_28791, __global\n                                        unsigned char *mem_28794, __global\n                                        unsigned char *testzicounter_mem_29028,\n                                        __global\n                                        unsigned char *group_res_arr_mem_29030,\n                                        int64_t num_threads_29032)\n{\n    #define segred_group_sizze_28398 (testzisegred_group_sizze_28397)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_29040_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_29040_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_29038_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_29038_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29033;\n    int32_t local_tid_29034;\n    int64_t group_sizze_29037;\n    int32_t wave_sizze_29036;\n    int32_t group_tid_29035;\n    \n    global_tid_29033 = get_global_id(0);\n    local_tid_29034 = get_local_id(0);\n    group_sizze_29037 = get_local_size(0);\n    wave_sizze_29036 = LOCKSTEP_WIDTH;\n    group_tid_29035 = get_group_id(0);\n    \n    int32_t phys_tid_28405;\n    \n    phys_tid_28405 = global_tid_29033;\n    \n    __local char *sync_arr_mem_29038;\n    \n    sync_arr_mem_29038 = (__local char *) sync_arr_mem_29038_backing_0;\n    \n    __local char *red_arr_mem_29040;\n    \n    red_arr_me",
                   "m_29040 = (__local char *) red_arr_mem_29040_backing_1;\n    \n    int64_t dummy_28403;\n    \n    dummy_28403 = 0;\n    \n    int64_t gtid_28404;\n    \n    gtid_28404 = 0;\n    \n    int64_t x_acc_29042;\n    int64_t chunk_sizze_29043;\n    \n    chunk_sizze_29043 = smin64(sdiv_up64(flat_dim_26283,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_28398 *\n                                         num_groups_28400))),\n                               sdiv_up64(flat_dim_26283 -\n                                         sext_i32_i64(phys_tid_28405),\n                                         num_threads_29032));\n    \n    int64_t x_26317;\n    int64_t x_26318;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_29042 = 0;\n    }\n    for (int64_t i_29047 = 0; i_29047 < chunk_sizze_29043; i_29047++) {\n        gtid_28404 = sext_i32_i64(phys_tid_28405) + num_threads_29032 * i_29047;\n        // apply map function\n        {\n            int64_t x_26320 = ((__global int64_t *) mem_28791)[gtid_28404];\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_26317 = x_acc_29042;\n            }\n            // load new values\n            {\n                x_26318 = x_26320;\n            }\n            // apply reduction operator\n            {\n                int64_t res_26319 = add64(x_26317, x_26318);\n                \n                // store in accumulator\n                {\n                    x_acc_29042 = res_26319;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_26317 = x_acc_29042;\n        ((__local int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n            x_26317;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_29048;\n    int32_t skip_waves_29049;\n    \n    skip_waves_29049 = 1;\n    \n    int64_t x_29044;\n    int64_t x_29045;\n    \n    offset_29048 = 0;\n    // parti",
                   "cipating threads read initial accumulator\n    {\n        if (slt32(local_tid_29034, sext_i64_i32(segred_group_sizze_28398))) {\n            x_29044 = ((__local\n                        int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                      offset_29048)];\n        }\n    }\n    offset_29048 = 1;\n    while (slt32(offset_29048, wave_sizze_29036)) {\n        if (slt32(local_tid_29034 + offset_29048,\n                  sext_i64_i32(segred_group_sizze_28398)) && ((local_tid_29034 -\n                                                               squot32(local_tid_29034,\n                                                                       wave_sizze_29036) *\n                                                               wave_sizze_29036) &\n                                                              (2 *\n                                                               offset_29048 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_29045 = ((volatile __local\n                            int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                          offset_29048)];\n            }\n            // apply reduction operation\n            {\n                int64_t res_29046 = add64(x_29044, x_29045);\n                \n                x_29044 = res_29046;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n                    x_29044;\n            }\n        }\n        offset_29048 *= 2;\n    }\n    while (slt32(skip_waves_29049,\n                 squot32(sext_i64_i32(segred_group_sizze_28398) +\n                         wave_sizze_29036 - 1, wave_sizze_29036))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_29048 = skip_waves_29049 * wave_sizze_29036;\n     ",
                   "   if (slt32(local_tid_29034 + offset_29048,\n                  sext_i64_i32(segred_group_sizze_28398)) && ((local_tid_29034 -\n                                                               squot32(local_tid_29034,\n                                                                       wave_sizze_29036) *\n                                                               wave_sizze_29036) ==\n                                                              0 &&\n                                                              (squot32(local_tid_29034,\n                                                                       wave_sizze_29036) &\n                                                               (2 *\n                                                                skip_waves_29049 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_29045 = ((__local\n                            int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                          offset_29048)];\n            }\n            // apply reduction operation\n            {\n                int64_t res_29046 = add64(x_29044, x_29045);\n                \n                x_29044 = res_29046;\n            }\n            // write result of operation\n            {\n                ((__local\n                  int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n                    x_29044;\n            }\n        }\n        skip_waves_29049 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_29034) == 0) {\n            x_acc_29042 = x_29044;\n        }\n    }\n    \n    int32_t old_counter_29050;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_29034 == 0) {\n            ((__global\n              int64_t *) group_res_arr_mem_29030)[sext_i32_i64(group_tid_290",
                   "35) *\n                                                  segred_group_sizze_28398] =\n                x_acc_29042;\n            mem_fence_global();\n            old_counter_29050 = atomic_add_i32_global(&((volatile __global\n                                                         int *) testzicounter_mem_29028)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_29038)[0] = old_counter_29050 ==\n                num_groups_28400 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_29051;\n    \n    is_last_group_29051 = ((__local bool *) sync_arr_mem_29038)[0];\n    if (is_last_group_29051) {\n        if (local_tid_29034 == 0) {\n            old_counter_29050 = atomic_add_i32_global(&((volatile __global\n                                                         int *) testzicounter_mem_29028)[0],\n                                                      (int) (0 -\n                                                             num_groups_28400));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_29052 = sdiv_up64(num_groups_28400,\n                                                      segred_group_sizze_28398);\n            \n            x_26317 = 0;\n            for (int64_t i_29053 = 0; i_29053 < read_per_thread_29052;\n                 i_29053++) {\n                int64_t group_res_id_29054 = sext_i32_i64(local_tid_29034) *\n                        read_per_thread_29052 + i_29053;\n                int64_t index_of_group_res_29055 = group_res_id_29054;\n                \n                if (slt64(group_res_id_29054, num_groups_28400)) {\n                    x_26318 = ((__global\n                                int64_t *) group_res_arr_mem_29030)[index_of_group_res_29055 *\n                                                                    segred_group_sizze_28398];\n                    \n                    int64_t res_26319;\n              ",
                   "      \n                    res_26319 = add64(x_26317, x_26318);\n                    x_26317 = res_26319;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n            x_26317;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_29056;\n            int32_t skip_waves_29057;\n            \n            skip_waves_29057 = 1;\n            \n            int64_t x_29044;\n            int64_t x_29045;\n            \n            offset_29056 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_29034,\n                          sext_i64_i32(segred_group_sizze_28398))) {\n                    x_29044 = ((__local\n                                int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                              offset_29056)];\n                }\n            }\n            offset_29056 = 1;\n            while (slt32(offset_29056, wave_sizze_29036)) {\n                if (slt32(local_tid_29034 + offset_29056,\n                          sext_i64_i32(segred_group_sizze_28398)) &&\n                    ((local_tid_29034 - squot32(local_tid_29034,\n                                                wave_sizze_29036) *\n                      wave_sizze_29036) & (2 * offset_29056 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_29045 = ((volatile __local\n                                    int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                                  offset_29056)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t res_29046 = add64(x_29044, x_29045);\n                        \n                        x_29044 = res_29046;\n                    }\n                    // wr",
                   "ite result of operation\n                    {\n                        ((volatile __local\n                          int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n                            x_29044;\n                    }\n                }\n                offset_29056 *= 2;\n            }\n            while (slt32(skip_waves_29057,\n                         squot32(sext_i64_i32(segred_group_sizze_28398) +\n                                 wave_sizze_29036 - 1, wave_sizze_29036))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_29056 = skip_waves_29057 * wave_sizze_29036;\n                if (slt32(local_tid_29034 + offset_29056,\n                          sext_i64_i32(segred_group_sizze_28398)) &&\n                    ((local_tid_29034 - squot32(local_tid_29034,\n                                                wave_sizze_29036) *\n                      wave_sizze_29036) == 0 && (squot32(local_tid_29034,\n                                                         wave_sizze_29036) &\n                                                 (2 * skip_waves_29057 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_29045 = ((__local\n                                    int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034 +\n                                                                  offset_29056)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t res_29046 = add64(x_29044, x_29045);\n                        \n                        x_29044 = res_29046;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          int64_t *) red_arr_mem_29040)[sext_i32_i64(local_tid_29034)] =\n                            x_29044;\n                    }\n                }\n                skip_waves_29057 *= 2;\n            }\n     ",
                   "       // and back to memory with the final result\n            {\n                if (local_tid_29034 == 0) {\n                    ((__global int64_t *) mem_28794)[0] = x_29044;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_28398\n}\n__kernel void testzisegred_nonseg_28514(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_29492_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_29490_backing_aligned_1,\n                                        int64_t paths_26128,\n                                        int64_t num_groups_28517, __global\n                                        unsigned char *mem_28823, __global\n                                        unsigned char *mem_28826, __global\n                                        unsigned char *testzicounter_mem_29480,\n                                        __global\n                                        unsigned char *group_res_arr_mem_29482,\n                                        int64_t num_threads_29484)\n{\n    #define segred_group_sizze_28516 (testzisegred_group_sizze_28506)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_29492_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_29492_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_29490_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_29490_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29485;\n    int32_t local_tid_29486;\n    int64_t group_sizze_29489;\n    int32_t wave_sizze_29488;\n    int32_t group_tid_29487;\n    \n    global_tid_29485 = get_global_id(0);\n    loc",
                   "al_tid_29486 = get_local_id(0);\n    group_sizze_29489 = get_local_size(0);\n    wave_sizze_29488 = LOCKSTEP_WIDTH;\n    group_tid_29487 = get_group_id(0);\n    \n    int32_t phys_tid_28514;\n    \n    phys_tid_28514 = global_tid_29485;\n    \n    __local char *sync_arr_mem_29490;\n    \n    sync_arr_mem_29490 = (__local char *) sync_arr_mem_29490_backing_0;\n    \n    __local char *red_arr_mem_29492;\n    \n    red_arr_mem_29492 = (__local char *) red_arr_mem_29492_backing_1;\n    \n    int64_t dummy_28512;\n    \n    dummy_28512 = 0;\n    \n    int64_t gtid_28513;\n    \n    gtid_28513 = 0;\n    \n    float x_acc_29494;\n    int64_t chunk_sizze_29495;\n    \n    chunk_sizze_29495 = smin64(sdiv_up64(paths_26128,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_28516 *\n                                         num_groups_28517))),\n                               sdiv_up64(paths_26128 -\n                                         sext_i32_i64(phys_tid_28514),\n                                         num_threads_29484));\n    \n    float x_28520;\n    float x_28521;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_29494 = 0.0F;\n    }\n    for (int64_t i_29499 = 0; i_29499 < chunk_sizze_29495; i_29499++) {\n        gtid_28513 = sext_i32_i64(phys_tid_28514) + num_threads_29484 * i_29499;\n        // apply map function\n        {\n            float res_28524;\n            float redout_28722 = 0.0F;\n            \n            for (int32_t i_28726 = 0; i_28726 < 45; i_28726++) {\n                int64_t i_28723 = sext_i32_i64(i_28726);\n                float x_28528 = ((__global float *) mem_28823)[i_28723 *\n                                                               paths_26128 +\n                                                               gtid_28513];\n                float res_28527 = x_28528 + redout_28722;\n                float redout_tmp_29500 = res_28527;\n                \n                redout_28722 = redout_tmp_29500;\n            }\n            res_28",
                   "524 = redout_28722;\n            \n            float res_28529 = fmax32(0.0F, res_28524);\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_28520 = x_acc_29494;\n            }\n            // load new values\n            {\n                x_28521 = res_28529;\n            }\n            // apply reduction operator\n            {\n                float res_28522 = x_28520 + x_28521;\n                \n                // store in accumulator\n                {\n                    x_acc_29494 = res_28522;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_28520 = x_acc_29494;\n        ((__local float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n            x_28520;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_29501;\n    int32_t skip_waves_29502;\n    \n    skip_waves_29502 = 1;\n    \n    float x_29496;\n    float x_29497;\n    \n    offset_29501 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_29486, sext_i64_i32(segred_group_sizze_28516))) {\n            x_29496 = ((__local\n                        float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                    offset_29501)];\n        }\n    }\n    offset_29501 = 1;\n    while (slt32(offset_29501, wave_sizze_29488)) {\n        if (slt32(local_tid_29486 + offset_29501,\n                  sext_i64_i32(segred_group_sizze_28516)) && ((local_tid_29486 -\n                                                               squot32(local_tid_29486,\n                                                                       wave_sizze_29488) *\n                                                               wave_sizze_29488) &\n                                                              (2 *\n                                                               offset_29501 -\n                        ",
                   "                                       1)) == 0) {\n            // read array element\n            {\n                x_29497 = ((volatile __local\n                            float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                        offset_29501)];\n            }\n            // apply reduction operation\n            {\n                float res_29498 = x_29496 + x_29497;\n                \n                x_29496 = res_29498;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n                    x_29496;\n            }\n        }\n        offset_29501 *= 2;\n    }\n    while (slt32(skip_waves_29502,\n                 squot32(sext_i64_i32(segred_group_sizze_28516) +\n                         wave_sizze_29488 - 1, wave_sizze_29488))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_29501 = skip_waves_29502 * wave_sizze_29488;\n        if (slt32(local_tid_29486 + offset_29501,\n                  sext_i64_i32(segred_group_sizze_28516)) && ((local_tid_29486 -\n                                                               squot32(local_tid_29486,\n                                                                       wave_sizze_29488) *\n                                                               wave_sizze_29488) ==\n                                                              0 &&\n                                                              (squot32(local_tid_29486,\n                                                                       wave_sizze_29488) &\n                                                               (2 *\n                                                                skip_waves_29502 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_29497 = ((__local\n                            floa",
                   "t *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                        offset_29501)];\n            }\n            // apply reduction operation\n            {\n                float res_29498 = x_29496 + x_29497;\n                \n                x_29496 = res_29498;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n                    x_29496;\n            }\n        }\n        skip_waves_29502 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_29486) == 0) {\n            x_acc_29494 = x_29496;\n        }\n    }\n    \n    int32_t old_counter_29503;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_29486 == 0) {\n            ((__global\n              float *) group_res_arr_mem_29482)[sext_i32_i64(group_tid_29487) *\n                                                segred_group_sizze_28516] =\n                x_acc_29494;\n            mem_fence_global();\n            old_counter_29503 = atomic_add_i32_global(&((volatile __global\n                                                         int *) testzicounter_mem_29480)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_29490)[0] = old_counter_29503 ==\n                num_groups_28517 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_29504;\n    \n    is_last_group_29504 = ((__local bool *) sync_arr_mem_29490)[0];\n    if (is_last_group_29504) {\n        if (local_tid_29486 == 0) {\n            old_counter_29503 = atomic_add_i32_global(&((volatile __global\n                                                         int *) testzicounter_mem_29480)[0],\n                                                      (int) (0 -\n                         ",
                   "                                    num_groups_28517));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_29505 = sdiv_up64(num_groups_28517,\n                                                      segred_group_sizze_28516);\n            \n            x_28520 = 0.0F;\n            for (int64_t i_29506 = 0; i_29506 < read_per_thread_29505;\n                 i_29506++) {\n                int64_t group_res_id_29507 = sext_i32_i64(local_tid_29486) *\n                        read_per_thread_29505 + i_29506;\n                int64_t index_of_group_res_29508 = group_res_id_29507;\n                \n                if (slt64(group_res_id_29507, num_groups_28517)) {\n                    x_28521 = ((__global\n                                float *) group_res_arr_mem_29482)[index_of_group_res_29508 *\n                                                                  segred_group_sizze_28516];\n                    \n                    float res_28522;\n                    \n                    res_28522 = x_28520 + x_28521;\n                    x_28520 = res_28522;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n            x_28520;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_29509;\n            int32_t skip_waves_29510;\n            \n            skip_waves_29510 = 1;\n            \n            float x_29496;\n            float x_29497;\n            \n            offset_29509 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_29486,\n                          sext_i64_i32(segred_group_sizze_28516))) {\n                    x_29496 = ((__local\n                                float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                            offset_29509)];\n                }\n            }\n            off",
                   "set_29509 = 1;\n            while (slt32(offset_29509, wave_sizze_29488)) {\n                if (slt32(local_tid_29486 + offset_29509,\n                          sext_i64_i32(segred_group_sizze_28516)) &&\n                    ((local_tid_29486 - squot32(local_tid_29486,\n                                                wave_sizze_29488) *\n                      wave_sizze_29488) & (2 * offset_29509 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_29497 = ((volatile __local\n                                    float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                                offset_29509)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_29498 = x_29496 + x_29497;\n                        \n                        x_29496 = res_29498;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n                            x_29496;\n                    }\n                }\n                offset_29509 *= 2;\n            }\n            while (slt32(skip_waves_29510,\n                         squot32(sext_i64_i32(segred_group_sizze_28516) +\n                                 wave_sizze_29488 - 1, wave_sizze_29488))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_29509 = skip_waves_29510 * wave_sizze_29488;\n                if (slt32(local_tid_29486 + offset_29509,\n                          sext_i64_i32(segred_group_sizze_28516)) &&\n                    ((local_tid_29486 - squot32(local_tid_29486,\n                                                wave_sizze_29488) *\n                      wave_sizze_29488) == 0 && (squot32(local_tid_29486,\n                                                         wave_sizze_29488) &\n       ",
                   "                                          (2 * skip_waves_29510 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_29497 = ((__local\n                                    float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486 +\n                                                                offset_29509)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_29498 = x_29496 + x_29497;\n                        \n                        x_29496 = res_29498;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_29492)[sext_i32_i64(local_tid_29486)] =\n                            x_29496;\n                    }\n                }\n                skip_waves_29510 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_29486 == 0) {\n                    ((__global float *) mem_28826)[0] = x_29496;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_28516\n}\n__kernel void testzisegred_nonseg_28610(__global int *global_failure,\n                                        __local volatile\n                                        int64_t *red_arr_mem_29595_backing_aligned_0,\n                                        __local volatile\n                                        int64_t *sync_arr_mem_29593_backing_aligned_1,\n                                        int64_t paths_26128,\n                                        int64_t num_groups_28645, __global\n                                        unsigned char *res_map_acc_mem_28839,\n                                        __global unsigned char *mem_28842,\n                                        __global\n                                        unsigned char *testzi",
                   "counter_mem_29583,\n                                        __global\n                                        unsigned char *group_res_arr_mem_29585,\n                                        int64_t num_threads_29587)\n{\n    #define segred_group_sizze_28644 (testzisegred_group_sizze_28602)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_29595_backing_1 =\n                          (__local volatile\n                           char *) red_arr_mem_29595_backing_aligned_0;\n    __local volatile char *restrict sync_arr_mem_29593_backing_0 =\n                          (__local volatile\n                           char *) sync_arr_mem_29593_backing_aligned_1;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29588;\n    int32_t local_tid_29589;\n    int64_t group_sizze_29592;\n    int32_t wave_sizze_29591;\n    int32_t group_tid_29590;\n    \n    global_tid_29588 = get_global_id(0);\n    local_tid_29589 = get_local_id(0);\n    group_sizze_29592 = get_local_size(0);\n    wave_sizze_29591 = LOCKSTEP_WIDTH;\n    group_tid_29590 = get_group_id(0);\n    \n    int32_t phys_tid_28610;\n    \n    phys_tid_28610 = global_tid_29588;\n    \n    __local char *sync_arr_mem_29593;\n    \n    sync_arr_mem_29593 = (__local char *) sync_arr_mem_29593_backing_0;\n    \n    __local char *red_arr_mem_29595;\n    \n    red_arr_mem_29595 = (__local char *) red_arr_mem_29595_backing_1;\n    \n    int64_t dummy_28608;\n    \n    dummy_28608 = 0;\n    \n    int64_t gtid_28609;\n    \n    gtid_28609 = 0;\n    \n    float x_acc_29597;\n    int64_t chunk_sizze_29598;\n    \n    chunk_sizze_29598 = smin64(sdiv_up64(paths_26128,\n                                         sext_i32_i64(sext_i64_i32(segred_group_sizze_28644 *\n                                         num_groups_28645))),\n                               sdiv_up64(paths_26128 -\n                                         sext_i32_i64(phys_tid_28610),\n                 ",
                   "                        num_threads_29587));\n    \n    float x_28648;\n    float x_28649;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_29597 = 0.0F;\n    }\n    for (int64_t i_29602 = 0; i_29602 < chunk_sizze_29598; i_29602++) {\n        gtid_28609 = sext_i32_i64(phys_tid_28610) + num_threads_29587 * i_29602;\n        // apply map function\n        {\n            float x_28651 = ((__global\n                              float *) res_map_acc_mem_28839)[gtid_28609];\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_28648 = x_acc_29597;\n            }\n            // load new values\n            {\n                x_28649 = x_28651;\n            }\n            // apply reduction operator\n            {\n                float res_28650 = x_28648 + x_28649;\n                \n                // store in accumulator\n                {\n                    x_acc_29597 = res_28650;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_28648 = x_acc_29597;\n        ((__local float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n            x_28648;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_29603;\n    int32_t skip_waves_29604;\n    \n    skip_waves_29604 = 1;\n    \n    float x_29599;\n    float x_29600;\n    \n    offset_29603 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_29589, sext_i64_i32(segred_group_sizze_28644))) {\n            x_29599 = ((__local\n                        float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                    offset_29603)];\n        }\n    }\n    offset_29603 = 1;\n    while (slt32(offset_29603, wave_sizze_29591)) {\n        if (slt32(local_tid_29589 + offset_29603,\n                  sext_i64_i32(segred_group_sizze_28644)) && ((local_tid_29589 -\n                                      ",
                   "                         squot32(local_tid_29589,\n                                                                       wave_sizze_29591) *\n                                                               wave_sizze_29591) &\n                                                              (2 *\n                                                               offset_29603 -\n                                                               1)) == 0) {\n            // read array element\n            {\n                x_29600 = ((volatile __local\n                            float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                        offset_29603)];\n            }\n            // apply reduction operation\n            {\n                float res_29601 = x_29599 + x_29600;\n                \n                x_29599 = res_29601;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n                    x_29599;\n            }\n        }\n        offset_29603 *= 2;\n    }\n    while (slt32(skip_waves_29604,\n                 squot32(sext_i64_i32(segred_group_sizze_28644) +\n                         wave_sizze_29591 - 1, wave_sizze_29591))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_29603 = skip_waves_29604 * wave_sizze_29591;\n        if (slt32(local_tid_29589 + offset_29603,\n                  sext_i64_i32(segred_group_sizze_28644)) && ((local_tid_29589 -\n                                                               squot32(local_tid_29589,\n                                                                       wave_sizze_29591) *\n                                                               wave_sizze_29591) ==\n                                                              0 &&\n                                                              (squot32(local_tid_29589,\n                                          ",
                   "                             wave_sizze_29591) &\n                                                               (2 *\n                                                                skip_waves_29604 -\n                                                                1)) == 0)) {\n            // read array element\n            {\n                x_29600 = ((__local\n                            float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                        offset_29603)];\n            }\n            // apply reduction operation\n            {\n                float res_29601 = x_29599 + x_29600;\n                \n                x_29599 = res_29601;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n                    x_29599;\n            }\n        }\n        skip_waves_29604 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (sext_i32_i64(local_tid_29589) == 0) {\n            x_acc_29597 = x_29599;\n        }\n    }\n    \n    int32_t old_counter_29605;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_29589 == 0) {\n            ((__global\n              float *) group_res_arr_mem_29585)[sext_i32_i64(group_tid_29590) *\n                                                segred_group_sizze_28644] =\n                x_acc_29597;\n            mem_fence_global();\n            old_counter_29605 = atomic_add_i32_global(&((volatile __global\n                                                         int *) testzicounter_mem_29583)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_29593)[0] = old_counter_29605 ==\n                num_groups_28645 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_29606;\n    \n",
                   "    is_last_group_29606 = ((__local bool *) sync_arr_mem_29593)[0];\n    if (is_last_group_29606) {\n        if (local_tid_29589 == 0) {\n            old_counter_29605 = atomic_add_i32_global(&((volatile __global\n                                                         int *) testzicounter_mem_29583)[0],\n                                                      (int) (0 -\n                                                             num_groups_28645));\n        }\n        // read in the per-group-results\n        {\n            int64_t read_per_thread_29607 = sdiv_up64(num_groups_28645,\n                                                      segred_group_sizze_28644);\n            \n            x_28648 = 0.0F;\n            for (int64_t i_29608 = 0; i_29608 < read_per_thread_29607;\n                 i_29608++) {\n                int64_t group_res_id_29609 = sext_i32_i64(local_tid_29589) *\n                        read_per_thread_29607 + i_29608;\n                int64_t index_of_group_res_29610 = group_res_id_29609;\n                \n                if (slt64(group_res_id_29609, num_groups_28645)) {\n                    x_28649 = ((__global\n                                float *) group_res_arr_mem_29585)[index_of_group_res_29610 *\n                                                                  segred_group_sizze_28644];\n                    \n                    float res_28650;\n                    \n                    res_28650 = x_28648 + x_28649;\n                    x_28648 = res_28650;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n            x_28648;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_29611;\n            int32_t skip_waves_29612;\n            \n            skip_waves_29612 = 1;\n            \n            float x_29599;\n            float x_29600;\n            \n            offset_29611 = 0;\n            // participating threads read initial",
                   " accumulator\n            {\n                if (slt32(local_tid_29589,\n                          sext_i64_i32(segred_group_sizze_28644))) {\n                    x_29599 = ((__local\n                                float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                            offset_29611)];\n                }\n            }\n            offset_29611 = 1;\n            while (slt32(offset_29611, wave_sizze_29591)) {\n                if (slt32(local_tid_29589 + offset_29611,\n                          sext_i64_i32(segred_group_sizze_28644)) &&\n                    ((local_tid_29589 - squot32(local_tid_29589,\n                                                wave_sizze_29591) *\n                      wave_sizze_29591) & (2 * offset_29611 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_29600 = ((volatile __local\n                                    float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                                offset_29611)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_29601 = x_29599 + x_29600;\n                        \n                        x_29599 = res_29601;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n                            x_29599;\n                    }\n                }\n                offset_29611 *= 2;\n            }\n            while (slt32(skip_waves_29612,\n                         squot32(sext_i64_i32(segred_group_sizze_28644) +\n                                 wave_sizze_29591 - 1, wave_sizze_29591))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_29611 = skip_waves_29612 * wave_sizze_29591;\n                if (slt32",
                   "(local_tid_29589 + offset_29611,\n                          sext_i64_i32(segred_group_sizze_28644)) &&\n                    ((local_tid_29589 - squot32(local_tid_29589,\n                                                wave_sizze_29591) *\n                      wave_sizze_29591) == 0 && (squot32(local_tid_29589,\n                                                         wave_sizze_29591) &\n                                                 (2 * skip_waves_29612 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_29600 = ((__local\n                                    float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589 +\n                                                                offset_29611)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_29601 = x_29599 + x_29600;\n                        \n                        x_29599 = res_29601;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_29595)[sext_i32_i64(local_tid_29589)] =\n                            x_29599;\n                    }\n                }\n                skip_waves_29612 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_29589 == 0) {\n                    ((__global float *) mem_28842)[0] = x_29599;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_28644\n}\n__kernel void testzisegred_small_28577(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *red_arr_mem_29524_backing_aligned_0,\n                                       int64_t paths_26128,\n                                       int64_t num_groups_28628, __global\n                   ",
                   "                    unsigned char *mem_28819, __global\n                                       unsigned char *mem_28835,\n                                       int64_t segment_sizze_nonzzero_29517)\n{\n    #define segred_group_sizze_28627 (testzisegred_group_sizze_28571)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_29524_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_29524_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29519;\n    int32_t local_tid_29520;\n    int64_t group_sizze_29523;\n    int32_t wave_sizze_29522;\n    int32_t group_tid_29521;\n    \n    global_tid_29519 = get_global_id(0);\n    local_tid_29520 = get_local_id(0);\n    group_sizze_29523 = get_local_size(0);\n    wave_sizze_29522 = LOCKSTEP_WIDTH;\n    group_tid_29521 = get_group_id(0);\n    \n    int32_t phys_tid_28577;\n    \n    phys_tid_28577 = global_tid_29519;\n    \n    __local char *red_arr_mem_29524;\n    \n    red_arr_mem_29524 = (__local char *) red_arr_mem_29524_backing_0;\n    \n    int32_t phys_group_id_29526;\n    \n    phys_group_id_29526 = get_group_id(0);\n    for (int32_t i_29527 = 0; i_29527 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(paths_26128,\n                                          squot64(segred_group_sizze_28627,\n                                                  segment_sizze_nonzzero_29517))) -\n                   phys_group_id_29526, sext_i64_i32(num_groups_28628));\n         i_29527++) {\n        int32_t virt_group_id_29528 = phys_group_id_29526 + i_29527 *\n                sext_i64_i32(num_groups_28628);\n        int64_t gtid_28568 = squot64(sext_i32_i64(local_tid_29520),\n                                     segment_sizze_nonzzero_29517) +\n                sext_i32_i64(virt_group_id_29528) *\n                squot64(segred_group_sizze_28627, segment_sizze_nonzzero_29517);\n        int64_t gtid_2857",
                   "6 = srem64(sext_i32_i64(local_tid_29520), 45);\n        \n        // apply map function if in bounds\n        {\n            if (slt64(0, 45) && (slt64(gtid_28568, paths_26128) &&\n                                 slt64(sext_i32_i64(local_tid_29520), 45 *\n                                       squot64(segred_group_sizze_28627,\n                                               segment_sizze_nonzzero_29517)))) {\n                int64_t binop_x_28697 = 45 * gtid_28568;\n                int64_t new_index_28698 = gtid_28576 + binop_x_28697;\n                float x_28635 = ((__global float *) mem_28819)[new_index_28698];\n                \n                // save map-out results\n                { }\n                // save results to be reduced\n                {\n                    ((__local\n                      float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                        x_28635;\n                }\n            } else {\n                ((__local\n                  float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                    0.0F;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64(0, 45)) {\n            // perform segmented scan to imitate reduction\n            {\n                float x_28631;\n                float x_28632;\n                float x_29529;\n                float x_29530;\n                bool ltid_in_bounds_29532;\n                \n                ltid_in_bounds_29532 = slt64(sext_i32_i64(local_tid_29520), 45 *\n                                             squot64(segred_group_sizze_28627,\n                                                     segment_sizze_nonzzero_29517));\n                \n                int32_t skip_threads_29533;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_29532) {\n                        x_28632 = ((volatile __local\n                                    float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520",
                   ")];\n                        if ((local_tid_29520 - squot32(local_tid_29520, 32) *\n                             32) == 0) {\n                            x_28631 = x_28632;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29533 = 1;\n                    while (slt32(skip_threads_29533, 32)) {\n                        if (sle32(skip_threads_29533, local_tid_29520 -\n                                  squot32(local_tid_29520, 32) * 32) &&\n                            ltid_in_bounds_29532) {\n                            // read operands\n                            {\n                                x_28631 = ((volatile __local\n                                            float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520) -\n                                                                        sext_i32_i64(skip_threads_29533)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_29534 =\n                                     slt64(srem64(sext_i32_i64(local_tid_29520),\n                                                  45),\n                                           sext_i32_i64(local_tid_29520) -\n                                           sext_i32_i64(local_tid_29520 -\n                                           skip_threads_29533));\n                                \n                                if (inactive_29534) {\n                                    x_28631 = x_28632;\n                                }\n                                if (!inactive_29534) {\n                                    float res_28633 = x_28631 + x_28632;\n                                    \n                                    x_28631 = res_28633;\n                                }\n                            }\n                        }\n                        if (sle32(",
                   "wave_sizze_29522, skip_threads_29533)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29533, local_tid_29520 -\n                                  squot32(local_tid_29520, 32) * 32) &&\n                            ltid_in_bounds_29532) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                                    x_28631;\n                                x_28632 = x_28631;\n                            }\n                        }\n                        if (sle32(wave_sizze_29522, skip_threads_29533)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29533 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_29520 - squot32(local_tid_29520, 32) * 32) ==\n                        31 && ltid_in_bounds_29532) {\n                        ((volatile __local\n                          float *) red_arr_mem_29524)[sext_i32_i64(squot32(local_tid_29520,\n                                                                           32))] =\n                            x_28631;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_29535;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_29520, 32) == 0 &&\n                            ltid_in_bounds_29532) {\n                            x_29530 = ((volatile __local\n          ",
                   "                              float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)];\n                            if ((local_tid_29520 - squot32(local_tid_29520,\n                                                           32) * 32) == 0) {\n                                x_29529 = x_29530;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_29535 = 1;\n                        while (slt32(skip_threads_29535, 32)) {\n                            if (sle32(skip_threads_29535, local_tid_29520 -\n                                      squot32(local_tid_29520, 32) * 32) &&\n                                (squot32(local_tid_29520, 32) == 0 &&\n                                 ltid_in_bounds_29532)) {\n                                // read operands\n                                {\n                                    x_29529 = ((volatile __local\n                                                float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520) -\n                                                                            sext_i32_i64(skip_threads_29535)];\n                                }\n                                // perform operation\n                                {\n                                    bool inactive_29536 =\n                                         slt64(srem64(sext_i32_i64(local_tid_29520 *\n                                                      32 + 32 - 1), 45),\n                                               sext_i32_i64(local_tid_29520 *\n                                               32 + 32 - 1) -\n                                               sext_i32_i64((local_tid_29520 -\n                                                             skip_threads_29535) *\n                                               32 + 32 - 1));\n                                    \n                                    if (i",
                   "nactive_29536) {\n                                        x_29529 = x_29530;\n                                    }\n                                    if (!inactive_29536) {\n                                        float res_29531 = x_29529 + x_29530;\n                                        \n                                        x_29529 = res_29531;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_29522, skip_threads_29535)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_29535, local_tid_29520 -\n                                      squot32(local_tid_29520, 32) * 32) &&\n                                (squot32(local_tid_29520, 32) == 0 &&\n                                 ltid_in_bounds_29532)) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                                        x_29529;\n                                    x_29530 = x_29529;\n                                }\n                            }\n                            if (sle32(wave_sizze_29522, skip_threads_29535)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_29535 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_29520, 32) == 0 ||\n                          !ltid_in_bounds_29532)) {\n                        // read operands\n                        {\n                            x_28632 = x_28631;\n                            x_28631 = ((__local",
                   "\n                                        float *) red_arr_mem_29524)[sext_i32_i64(squot32(local_tid_29520,\n                                                                                         32)) -\n                                                                    1];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_29537 =\n                                 slt64(srem64(sext_i32_i64(local_tid_29520),\n                                              45),\n                                       sext_i32_i64(local_tid_29520) -\n                                       sext_i32_i64(squot32(local_tid_29520,\n                                                            32) * 32 - 1));\n                            \n                            if (inactive_29537) {\n                                x_28631 = x_28632;\n                            }\n                            if (!inactive_29537) {\n                                float res_28633 = x_28631 + x_28632;\n                                \n                                x_28631 = res_28633;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                                x_28631;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_29520, 32) == 0) {\n                        ((__local\n                          float *) red_arr_mem_29524)[sext_i32_i64(local_tid_29520)] =\n                            x_28632;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n       ",
                   " // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_group_id_29528) *\n                      squot64(segred_group_sizze_28627,\n                              segment_sizze_nonzzero_29517) +\n                      sext_i32_i64(local_tid_29520), paths_26128) &&\n                slt64(sext_i32_i64(local_tid_29520),\n                      squot64(segred_group_sizze_28627,\n                              segment_sizze_nonzzero_29517))) {\n                ((__global\n                  float *) mem_28835)[sext_i32_i64(virt_group_id_29528) *\n                                      squot64(segred_group_sizze_28627,\n                                              segment_sizze_nonzzero_29517) +\n                                      sext_i32_i64(local_tid_29520)] = ((__local\n                                                                         float *) red_arr_mem_29524)[(sext_i32_i64(local_tid_29520) +\n                                                                                                      1) *\n                                                                                                     segment_sizze_nonzzero_29517 -\n                                                                                                     1];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_28627\n}\n__kernel void testzisegred_small_29153(__global int *global_failure,\n                                       __local volatile\n                                       int64_t *red_arr_mem_29161_backing_aligned_0,\n                                       int64_t res_26316,\n                                       int64_t num_groups_28410, __global\n                                       unsigned char *mem_28796,\n                                       int32_t num_subhistos_29067, __global\n                                       unsigned c",
                   "har *res_subhistos_mem_29068,\n                                       int64_t segment_sizze_nonzzero_29154)\n{\n    #define seghist_group_sizze_28408 (testziseghist_group_sizze_28407)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    __local volatile char *restrict red_arr_mem_29161_backing_0 =\n                          (__local volatile\n                           char *) red_arr_mem_29161_backing_aligned_0;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_29156;\n    int32_t local_tid_29157;\n    int64_t group_sizze_29160;\n    int32_t wave_sizze_29159;\n    int32_t group_tid_29158;\n    \n    global_tid_29156 = get_global_id(0);\n    local_tid_29157 = get_local_id(0);\n    group_sizze_29160 = get_local_size(0);\n    wave_sizze_29159 = LOCKSTEP_WIDTH;\n    group_tid_29158 = get_group_id(0);\n    \n    int32_t flat_gtid_29153;\n    \n    flat_gtid_29153 = global_tid_29156;\n    \n    __local char *red_arr_mem_29161;\n    \n    red_arr_mem_29161 = (__local char *) red_arr_mem_29161_backing_0;\n    \n    int32_t phys_group_id_29163;\n    \n    phys_group_id_29163 = get_group_id(0);\n    for (int32_t i_29164 = 0; i_29164 <\n         sdiv_up32(sext_i64_i32(sdiv_up64(res_26316,\n                                          squot64(seghist_group_sizze_28408,\n                                                  segment_sizze_nonzzero_29154))) -\n                   phys_group_id_29163, sext_i64_i32(num_groups_28410));\n         i_29164++) {\n        int32_t virt_group_id_29165 = phys_group_id_29163 + i_29164 *\n                sext_i64_i32(num_groups_28410);\n        int64_t bucket_id_29151 = squot64(sext_i32_i64(local_tid_29157),\n                                          segment_sizze_nonzzero_29154) +\n                sext_i32_i64(virt_group_id_29165) *\n                squot64(seghist_group_sizze_28408,\n                        segment_sizze_nonzzero_29154);\n        int64_t subhistogram_id_29152 = srem64(sext_i32_i64(local_tid_29157),",
                   "\n                                               num_subhistos_29067);\n        \n        // apply map function if in bounds\n        {\n            if (slt64(0, num_subhistos_29067) && (slt64(bucket_id_29151,\n                                                        res_26316) &&\n                                                  slt64(sext_i32_i64(local_tid_29157),\n                                                        num_subhistos_29067 *\n                                                        squot64(seghist_group_sizze_28408,\n                                                                segment_sizze_nonzzero_29154)))) {\n                // save results to be reduced\n                {\n                    ((__local\n                      int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                        ((__global\n                          int64_t *) res_subhistos_mem_29068)[subhistogram_id_29152 *\n                                                              res_26316 +\n                                                              bucket_id_29151];\n                }\n            } else {\n                ((__local\n                  int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                    0;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64(0, num_subhistos_29067)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t x_28414;\n                int64_t x_28415;\n                int64_t x_29166;\n                int64_t x_29167;\n                bool ltid_in_bounds_29169;\n                \n                ltid_in_bounds_29169 = slt64(sext_i32_i64(local_tid_29157),\n                                             num_subhistos_29067 *\n                                             squot64(seghist_group_sizze_28408,\n                                                     segment_sizze_nonzzero_29154));\n                \n                int32_t skip_threads_29170;\n      ",
                   "          \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_29169) {\n                        x_28415 = ((volatile __local\n                                    int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)];\n                        if ((local_tid_29157 - squot32(local_tid_29157, 32) *\n                             32) == 0) {\n                            x_28414 = x_28415;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_29170 = 1;\n                    while (slt32(skip_threads_29170, 32)) {\n                        if (sle32(skip_threads_29170, local_tid_29157 -\n                                  squot32(local_tid_29157, 32) * 32) &&\n                            ltid_in_bounds_29169) {\n                            // read operands\n                            {\n                                x_28414 = ((volatile __local\n                                            int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157) -\n                                                                          sext_i32_i64(skip_threads_29170)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_29171 =\n                                     slt64(srem64(sext_i32_i64(local_tid_29157),\n                                                  num_subhistos_29067),\n                                           sext_i32_i64(local_tid_29157) -\n                                           sext_i32_i64(local_tid_29157 -\n                                           skip_threads_29170));\n                                \n                                if (inactive_29171) {\n                                    x_28414 = x_28415;\n                                }\n                                if (!inactive_29171) ",
                   "{\n                                    int64_t res_28416 = smax64(x_28414,\n                                                               x_28415);\n                                    \n                                    x_28414 = res_28416;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_29159, skip_threads_29170)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_29170, local_tid_29157 -\n                                  squot32(local_tid_29157, 32) * 32) &&\n                            ltid_in_bounds_29169) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                                    x_28414;\n                                x_28415 = x_28414;\n                            }\n                        }\n                        if (sle32(wave_sizze_29159, skip_threads_29170)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_29170 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_29157 - squot32(local_tid_29157, 32) * 32) ==\n                        31 && ltid_in_bounds_29169) {\n                        ((volatile __local\n                          int64_t *) red_arr_mem_29161)[sext_i32_i64(squot32(local_tid_29157,\n                                                                             32))] =\n                            x_28414;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains",
                   " carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_29172;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_29157, 32) == 0 &&\n                            ltid_in_bounds_29169) {\n                            x_29167 = ((volatile __local\n                                        int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)];\n                            if ((local_tid_29157 - squot32(local_tid_29157,\n                                                           32) * 32) == 0) {\n                                x_29166 = x_29167;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_29172 = 1;\n                        while (slt32(skip_threads_29172, 32)) {\n                            if (sle32(skip_threads_29172, local_tid_29157 -\n                                      squot32(local_tid_29157, 32) * 32) &&\n                                (squot32(local_tid_29157, 32) == 0 &&\n                                 ltid_in_bounds_29169)) {\n                                // read operands\n                                {\n                                    x_29166 = ((volatile __local\n                                                int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157) -\n                                                                              sext_i32_i64(skip_threads_29172)];\n                                }\n                                // perform operation\n                                {\n                                    bool inactive_29173 =\n                                         slt64(srem64(sext_i32_i64(local_tid_29157 *\n                                                      32 + 32 - 1),\n                                                      num_subhistos_29",
                   "067),\n                                               sext_i32_i64(local_tid_29157 *\n                                               32 + 32 - 1) -\n                                               sext_i32_i64((local_tid_29157 -\n                                                             skip_threads_29172) *\n                                               32 + 32 - 1));\n                                    \n                                    if (inactive_29173) {\n                                        x_29166 = x_29167;\n                                    }\n                                    if (!inactive_29173) {\n                                        int64_t res_29168 = smax64(x_29166,\n                                                                   x_29167);\n                                        \n                                        x_29166 = res_29168;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_29159, skip_threads_29172)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_29172, local_tid_29157 -\n                                      squot32(local_tid_29157, 32) * 32) &&\n                                (squot32(local_tid_29157, 32) == 0 &&\n                                 ltid_in_bounds_29169)) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                                        x_29166;\n                                    x_29167 = x_29166;\n                                }\n                            }\n                            if (sle32(wave_sizze_29159, skip_threads_29172)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                        ",
                   "    }\n                            skip_threads_29172 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_29157, 32) == 0 ||\n                          !ltid_in_bounds_29169)) {\n                        // read operands\n                        {\n                            x_28415 = x_28414;\n                            x_28414 = ((__local\n                                        int64_t *) red_arr_mem_29161)[sext_i32_i64(squot32(local_tid_29157,\n                                                                                           32)) -\n                                                                      1];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_29174 =\n                                 slt64(srem64(sext_i32_i64(local_tid_29157),\n                                              num_subhistos_29067),\n                                       sext_i32_i64(local_tid_29157) -\n                                       sext_i32_i64(squot32(local_tid_29157,\n                                                            32) * 32 - 1));\n                            \n                            if (inactive_29174) {\n                                x_28414 = x_28415;\n                            }\n                            if (!inactive_29174) {\n                                int64_t res_28416 = smax64(x_28414, x_28415);\n                                \n                                x_28414 = res_28416;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                                x_28414;\n  ",
                   "                      }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_29157, 32) == 0) {\n                        ((__local\n                          int64_t *) red_arr_mem_29161)[sext_i32_i64(local_tid_29157)] =\n                            x_28415;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_group_id_29165) *\n                      squot64(seghist_group_sizze_28408,\n                              segment_sizze_nonzzero_29154) +\n                      sext_i32_i64(local_tid_29157), res_26316) &&\n                slt64(sext_i32_i64(local_tid_29157),\n                      squot64(seghist_group_sizze_28408,\n                              segment_sizze_nonzzero_29154))) {\n                ((__global\n                  int64_t *) mem_28796)[sext_i32_i64(virt_group_id_29165) *\n                                        squot64(seghist_group_sizze_28408,\n                                                segment_sizze_nonzzero_29154) +\n                                        sext_i32_i64(local_tid_29157)] =\n                    ((__local\n                      int64_t *) red_arr_mem_29161)[(sext_i32_i64(local_tid_29157) +\n                                                     1) *\n                                                    segment_sizze_nonzzero_29154 -\n                                                    1];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef seghist_group_sizze_28408\n}\n",
                   NULL};
static const char *size_names[] = {"builtin#replicate_f32.group_size_29473",
                                   "builtin#replicate_i64.group_size_29065",
                                   "main.L2_size_29130",
                                   "main.seghist_group_size_27359",
                                   "main.seghist_num_groups_27361",
                                   "main.segmap_group_size_26570",
                                   "main.segmap_group_size_26719",
                                   "main.segmap_group_size_26994",
                                   "main.segmap_group_size_27093",
                                   "main.segmap_group_size_27156",
                                   "main.segmap_group_size_27452",
                                   "main.segmap_group_size_27490",
                                   "main.segmap_group_size_27515",
                                   "main.segmap_num_groups_26996",
                                   "main.segred_group_size_26556",
                                   "main.segred_group_size_27349",
                                   "main.segred_group_size_27458",
                                   "main.segred_group_size_27523",
                                   "main.segred_group_size_27554",
                                   "main.segred_num_groups_26558",
                                   "main.segred_num_groups_27351",
                                   "main.segred_num_groups_27460",
                                   "main.segred_num_groups_27525",
                                   "main.segred_num_groups_27556",
                                   "main.segscan_group_size_27341",
                                   "main.segscan_group_size_27374",
                                   "main.segscan_group_size_27382",
                                   "main.segscan_group_size_27390",
                                   "main.segscan_group_size_27442",
                                   "main.segscan_num_groups_27343",
                                   "main.segscan_num_groups_27376",
                                   "main.segscan_num_groups_27384",
                                   "main.segscan_num_groups_27392",
                                   "main.segscan_num_groups_27444",
                                   "main.suff_outer_par_0",
                                   "main.suff_outer_par_8",
                                   "main.suff_outer_redomap_7",
                                   "test.L2_size_29130",
                                   "test.seghist_group_size_28407",
                                   "test.seghist_num_groups_28409",
                                   "test.segmap_group_size_27621",
                                   "test.segmap_group_size_27770",
                                   "test.segmap_group_size_28045",
                                   "test.segmap_group_size_28144",
                                   "test.segmap_group_size_28207",
                                   "test.segmap_group_size_28500",
                                   "test.segmap_group_size_28538",
                                   "test.segmap_group_size_28563",
                                   "test.segmap_num_groups_28047",
                                   "test.segred_group_size_27607",
                                   "test.segred_group_size_28397",
                                   "test.segred_group_size_28506",
                                   "test.segred_group_size_28571",
                                   "test.segred_group_size_28602",
                                   "test.segred_num_groups_27609",
                                   "test.segred_num_groups_28399",
                                   "test.segred_num_groups_28508",
                                   "test.segred_num_groups_28573",
                                   "test.segred_num_groups_28604",
                                   "test.segscan_group_size_28389",
                                   "test.segscan_group_size_28422",
                                   "test.segscan_group_size_28430",
                                   "test.segscan_group_size_28438",
                                   "test.segscan_group_size_28490",
                                   "test.segscan_num_groups_28391",
                                   "test.segscan_num_groups_28424",
                                   "test.segscan_num_groups_28432",
                                   "test.segscan_num_groups_28440",
                                   "test.segscan_num_groups_28492",
                                   "test.suff_outer_par_0",
                                   "test.suff_outer_par_8",
                                   "test.suff_outer_redomap_7"};
static const char *size_vars[] = {"builtinzhreplicate_f32zigroup_sizze_29473",
                                  "builtinzhreplicate_i64zigroup_sizze_29065",
                                  "mainziL2_sizze_29130",
                                  "mainziseghist_group_sizze_27359",
                                  "mainziseghist_num_groups_27361",
                                  "mainzisegmap_group_sizze_26570",
                                  "mainzisegmap_group_sizze_26719",
                                  "mainzisegmap_group_sizze_26994",
                                  "mainzisegmap_group_sizze_27093",
                                  "mainzisegmap_group_sizze_27156",
                                  "mainzisegmap_group_sizze_27452",
                                  "mainzisegmap_group_sizze_27490",
                                  "mainzisegmap_group_sizze_27515",
                                  "mainzisegmap_num_groups_26996",
                                  "mainzisegred_group_sizze_26556",
                                  "mainzisegred_group_sizze_27349",
                                  "mainzisegred_group_sizze_27458",
                                  "mainzisegred_group_sizze_27523",
                                  "mainzisegred_group_sizze_27554",
                                  "mainzisegred_num_groups_26558",
                                  "mainzisegred_num_groups_27351",
                                  "mainzisegred_num_groups_27460",
                                  "mainzisegred_num_groups_27525",
                                  "mainzisegred_num_groups_27556",
                                  "mainzisegscan_group_sizze_27341",
                                  "mainzisegscan_group_sizze_27374",
                                  "mainzisegscan_group_sizze_27382",
                                  "mainzisegscan_group_sizze_27390",
                                  "mainzisegscan_group_sizze_27442",
                                  "mainzisegscan_num_groups_27343",
                                  "mainzisegscan_num_groups_27376",
                                  "mainzisegscan_num_groups_27384",
                                  "mainzisegscan_num_groups_27392",
                                  "mainzisegscan_num_groups_27444",
                                  "mainzisuff_outer_par_0",
                                  "mainzisuff_outer_par_8",
                                  "mainzisuff_outer_redomap_7",
                                  "testziL2_sizze_29130",
                                  "testziseghist_group_sizze_28407",
                                  "testziseghist_num_groups_28409",
                                  "testzisegmap_group_sizze_27621",
                                  "testzisegmap_group_sizze_27770",
                                  "testzisegmap_group_sizze_28045",
                                  "testzisegmap_group_sizze_28144",
                                  "testzisegmap_group_sizze_28207",
                                  "testzisegmap_group_sizze_28500",
                                  "testzisegmap_group_sizze_28538",
                                  "testzisegmap_group_sizze_28563",
                                  "testzisegmap_num_groups_28047",
                                  "testzisegred_group_sizze_27607",
                                  "testzisegred_group_sizze_28397",
                                  "testzisegred_group_sizze_28506",
                                  "testzisegred_group_sizze_28571",
                                  "testzisegred_group_sizze_28602",
                                  "testzisegred_num_groups_27609",
                                  "testzisegred_num_groups_28399",
                                  "testzisegred_num_groups_28508",
                                  "testzisegred_num_groups_28573",
                                  "testzisegred_num_groups_28604",
                                  "testzisegscan_group_sizze_28389",
                                  "testzisegscan_group_sizze_28422",
                                  "testzisegscan_group_sizze_28430",
                                  "testzisegscan_group_sizze_28438",
                                  "testzisegscan_group_sizze_28490",
                                  "testzisegscan_num_groups_28391",
                                  "testzisegscan_num_groups_28424",
                                  "testzisegscan_num_groups_28432",
                                  "testzisegscan_num_groups_28440",
                                  "testzisegscan_num_groups_28492",
                                  "testzisuff_outer_par_0",
                                  "testzisuff_outer_par_8",
                                  "testzisuff_outer_redomap_7"};
static const char *size_classes[] = {"group_size", "group_size",
                                     "L2_for_histogram", "group_size",
                                     "num_groups", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "num_groups", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "num_groups", "num_groups", "num_groups",
                                     "num_groups", "num_groups", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "num_groups", "num_groups",
                                     "num_groups", "num_groups", "num_groups",
                                     "threshold ()",
                                     "threshold (!main.suff_outer_redomap_7)",
                                     "threshold ()", "L2_for_histogram",
                                     "group_size", "num_groups", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "num_groups", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "num_groups", "num_groups",
                                     "num_groups", "num_groups", "num_groups",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "num_groups",
                                     "num_groups", "num_groups", "num_groups",
                                     "num_groups", "threshold ()",
                                     "threshold (!test.suff_outer_redomap_7)",
                                     "threshold ()"};
int futhark_get_num_sizes(void)
{
    return 72;
}
const char *futhark_get_size_name(int i)
{
    return size_names[i];
}
const char *futhark_get_size_class(int i)
{
    return size_classes[i];
}
struct sizes {
    size_t builtinzhreplicate_f32zigroup_sizze_29473;
    size_t builtinzhreplicate_i64zigroup_sizze_29065;
    size_t mainziL2_sizze_29130;
    size_t mainziseghist_group_sizze_27359;
    size_t mainziseghist_num_groups_27361;
    size_t mainzisegmap_group_sizze_26570;
    size_t mainzisegmap_group_sizze_26719;
    size_t mainzisegmap_group_sizze_26994;
    size_t mainzisegmap_group_sizze_27093;
    size_t mainzisegmap_group_sizze_27156;
    size_t mainzisegmap_group_sizze_27452;
    size_t mainzisegmap_group_sizze_27490;
    size_t mainzisegmap_group_sizze_27515;
    size_t mainzisegmap_num_groups_26996;
    size_t mainzisegred_group_sizze_26556;
    size_t mainzisegred_group_sizze_27349;
    size_t mainzisegred_group_sizze_27458;
    size_t mainzisegred_group_sizze_27523;
    size_t mainzisegred_group_sizze_27554;
    size_t mainzisegred_num_groups_26558;
    size_t mainzisegred_num_groups_27351;
    size_t mainzisegred_num_groups_27460;
    size_t mainzisegred_num_groups_27525;
    size_t mainzisegred_num_groups_27556;
    size_t mainzisegscan_group_sizze_27341;
    size_t mainzisegscan_group_sizze_27374;
    size_t mainzisegscan_group_sizze_27382;
    size_t mainzisegscan_group_sizze_27390;
    size_t mainzisegscan_group_sizze_27442;
    size_t mainzisegscan_num_groups_27343;
    size_t mainzisegscan_num_groups_27376;
    size_t mainzisegscan_num_groups_27384;
    size_t mainzisegscan_num_groups_27392;
    size_t mainzisegscan_num_groups_27444;
    size_t mainzisuff_outer_par_0;
    size_t mainzisuff_outer_par_8;
    size_t mainzisuff_outer_redomap_7;
    size_t testziL2_sizze_29130;
    size_t testziseghist_group_sizze_28407;
    size_t testziseghist_num_groups_28409;
    size_t testzisegmap_group_sizze_27621;
    size_t testzisegmap_group_sizze_27770;
    size_t testzisegmap_group_sizze_28045;
    size_t testzisegmap_group_sizze_28144;
    size_t testzisegmap_group_sizze_28207;
    size_t testzisegmap_group_sizze_28500;
    size_t testzisegmap_group_sizze_28538;
    size_t testzisegmap_group_sizze_28563;
    size_t testzisegmap_num_groups_28047;
    size_t testzisegred_group_sizze_27607;
    size_t testzisegred_group_sizze_28397;
    size_t testzisegred_group_sizze_28506;
    size_t testzisegred_group_sizze_28571;
    size_t testzisegred_group_sizze_28602;
    size_t testzisegred_num_groups_27609;
    size_t testzisegred_num_groups_28399;
    size_t testzisegred_num_groups_28508;
    size_t testzisegred_num_groups_28573;
    size_t testzisegred_num_groups_28604;
    size_t testzisegscan_group_sizze_28389;
    size_t testzisegscan_group_sizze_28422;
    size_t testzisegscan_group_sizze_28430;
    size_t testzisegscan_group_sizze_28438;
    size_t testzisegscan_group_sizze_28490;
    size_t testzisegscan_num_groups_28391;
    size_t testzisegscan_num_groups_28424;
    size_t testzisegscan_num_groups_28432;
    size_t testzisegscan_num_groups_28440;
    size_t testzisegscan_num_groups_28492;
    size_t testzisuff_outer_par_0;
    size_t testzisuff_outer_par_8;
    size_t testzisuff_outer_redomap_7;
} ;
struct futhark_context_config {
    struct opencl_config opencl;
    size_t sizes[72];
    int num_build_opts;
    const char **build_opts;
} ;
struct futhark_context_config *futhark_context_config_new(void)
{
    struct futhark_context_config *cfg =
                                  (struct futhark_context_config *) malloc(sizeof(struct futhark_context_config));
    
    if (cfg == NULL)
        return NULL;
    cfg->num_build_opts = 0;
    cfg->build_opts = (const char **) malloc(sizeof(const char *));
    cfg->build_opts[0] = NULL;
    cfg->sizes[0] = 0;
    cfg->sizes[1] = 0;
    cfg->sizes[2] = 4194304;
    cfg->sizes[3] = 0;
    cfg->sizes[4] = 0;
    cfg->sizes[5] = 0;
    cfg->sizes[6] = 0;
    cfg->sizes[7] = 0;
    cfg->sizes[8] = 0;
    cfg->sizes[9] = 0;
    cfg->sizes[10] = 0;
    cfg->sizes[11] = 0;
    cfg->sizes[12] = 0;
    cfg->sizes[13] = 0;
    cfg->sizes[14] = 0;
    cfg->sizes[15] = 0;
    cfg->sizes[16] = 0;
    cfg->sizes[17] = 0;
    cfg->sizes[18] = 0;
    cfg->sizes[19] = 0;
    cfg->sizes[20] = 0;
    cfg->sizes[21] = 0;
    cfg->sizes[22] = 0;
    cfg->sizes[23] = 0;
    cfg->sizes[24] = 0;
    cfg->sizes[25] = 0;
    cfg->sizes[26] = 0;
    cfg->sizes[27] = 0;
    cfg->sizes[28] = 0;
    cfg->sizes[29] = 0;
    cfg->sizes[30] = 0;
    cfg->sizes[31] = 0;
    cfg->sizes[32] = 0;
    cfg->sizes[33] = 0;
    cfg->sizes[34] = 0;
    cfg->sizes[35] = 0;
    cfg->sizes[36] = 0;
    cfg->sizes[37] = 4194304;
    cfg->sizes[38] = 0;
    cfg->sizes[39] = 0;
    cfg->sizes[40] = 0;
    cfg->sizes[41] = 0;
    cfg->sizes[42] = 0;
    cfg->sizes[43] = 0;
    cfg->sizes[44] = 0;
    cfg->sizes[45] = 0;
    cfg->sizes[46] = 0;
    cfg->sizes[47] = 0;
    cfg->sizes[48] = 0;
    cfg->sizes[49] = 0;
    cfg->sizes[50] = 0;
    cfg->sizes[51] = 0;
    cfg->sizes[52] = 0;
    cfg->sizes[53] = 0;
    cfg->sizes[54] = 0;
    cfg->sizes[55] = 0;
    cfg->sizes[56] = 0;
    cfg->sizes[57] = 0;
    cfg->sizes[58] = 0;
    cfg->sizes[59] = 0;
    cfg->sizes[60] = 0;
    cfg->sizes[61] = 0;
    cfg->sizes[62] = 0;
    cfg->sizes[63] = 0;
    cfg->sizes[64] = 0;
    cfg->sizes[65] = 0;
    cfg->sizes[66] = 0;
    cfg->sizes[67] = 0;
    cfg->sizes[68] = 0;
    cfg->sizes[69] = 0;
    cfg->sizes[70] = 0;
    cfg->sizes[71] = 0;
    opencl_config_init(&cfg->opencl, 72, size_names, size_vars, cfg->sizes,
                       size_classes);
    return cfg;
}
void futhark_context_config_free(struct futhark_context_config *cfg)
{
    free(cfg->build_opts);
    free(cfg);
}
void futhark_context_config_add_build_option(struct futhark_context_config *cfg,
                                             const char *opt)
{
    cfg->build_opts[cfg->num_build_opts] = opt;
    cfg->num_build_opts++;
    cfg->build_opts = (const char **) realloc(cfg->build_opts,
                                              (cfg->num_build_opts + 1) *
                                              sizeof(const char *));
    cfg->build_opts[cfg->num_build_opts] = NULL;
}
void futhark_context_config_set_debugging(struct futhark_context_config *cfg,
                                          int flag)
{
    cfg->opencl.profiling = cfg->opencl.logging = cfg->opencl.debugging = flag;
}
void futhark_context_config_set_profiling(struct futhark_context_config *cfg,
                                          int flag)
{
    cfg->opencl.profiling = flag;
}
void futhark_context_config_set_logging(struct futhark_context_config *cfg,
                                        int flag)
{
    cfg->opencl.logging = flag;
}
void futhark_context_config_set_device(struct futhark_context_config *cfg, const
                                       char *s)
{
    set_preferred_device(&cfg->opencl, s);
}
void futhark_context_config_set_platform(struct futhark_context_config *cfg,
                                         const char *s)
{
    set_preferred_platform(&cfg->opencl, s);
}
void futhark_context_config_select_device_interactively(struct futhark_context_config *cfg)
{
    select_device_interactively(&cfg->opencl);
}
void futhark_context_config_list_devices(struct futhark_context_config *cfg)
{
    list_devices(&cfg->opencl);
}
void futhark_context_config_dump_program_to(struct futhark_context_config *cfg,
                                            const char *path)
{
    cfg->opencl.dump_program_to = path;
}
void futhark_context_config_load_program_from(struct futhark_context_config *cfg,
                                              const char *path)
{
    cfg->opencl.load_program_from = path;
}
void futhark_context_config_dump_binary_to(struct futhark_context_config *cfg,
                                           const char *path)
{
    cfg->opencl.dump_binary_to = path;
}
void futhark_context_config_load_binary_from(struct futhark_context_config *cfg,
                                             const char *path)
{
    cfg->opencl.load_binary_from = path;
}
void futhark_context_config_set_default_group_size(struct futhark_context_config *cfg,
                                                   int size)
{
    cfg->opencl.default_group_size = size;
    cfg->opencl.default_group_size_changed = 1;
}
void futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg,
                                                   int num)
{
    cfg->opencl.default_num_groups = num;
}
void futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg,
                                                  int size)
{
    cfg->opencl.default_tile_size = size;
    cfg->opencl.default_tile_size_changed = 1;
}
void futhark_context_config_set_default_threshold(struct futhark_context_config *cfg,
                                                  int size)
{
    cfg->opencl.default_threshold = size;
}
int futhark_context_config_set_size(struct futhark_context_config *cfg, const
                                    char *size_name, size_t size_value)
{
    for (int i = 0; i < 72; i++) {
        if (strcmp(size_name, size_names[i]) == 0) {
            cfg->sizes[i] = size_value;
            return 0;
        }
    }
    if (strcmp(size_name, "default_group_size") == 0) {
        cfg->opencl.default_group_size = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_num_groups") == 0) {
        cfg->opencl.default_num_groups = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_threshold") == 0) {
        cfg->opencl.default_threshold = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_tile_size") == 0) {
        cfg->opencl.default_tile_size = size_value;
        return 0;
    }
    return 1;
}
struct futhark_context {
    int detail_memory;
    int debugging;
    int profiling;
    int profiling_paused;
    int logging;
    lock_t lock;
    char *error;
    int64_t peak_mem_usage_device;
    int64_t cur_mem_usage_device;
    int64_t peak_mem_usage_default;
    int64_t cur_mem_usage_default;
    struct {
        int dummy;
    } constants;
    struct memblock_device mainzicounter_mem_28905;
    struct memblock_device mainzicounter_mem_29028;
    struct memblock_device mainzihist_locks_mem_29138;
    struct memblock_device mainzicounter_mem_29182;
    struct memblock_device mainzicounter_mem_29480;
    struct memblock_device mainzicounter_mem_29545;
    struct memblock_device mainzicounter_mem_29583;
    struct memblock_device testzistatic_array_28902;
    struct memblock_device testzistatic_array_28903;
    struct memblock_device testzistatic_array_28904;
    struct memblock_device testzicounter_mem_28906;
    struct memblock_device testzicounter_mem_29028;
    struct memblock_device testzihist_locks_mem_29138;
    struct memblock_device testzicounter_mem_29182;
    struct memblock_device testzicounter_mem_29480;
    struct memblock_device testzicounter_mem_29545;
    struct memblock_device testzicounter_mem_29583;
    int total_runs;
    long total_runtime;
    cl_kernel builtinzhreplicate_f32zireplicate_29470;
    cl_kernel builtinzhreplicate_i64zireplicate_29062;
    cl_kernel gpu_map_transpose_f32;
    cl_kernel gpu_map_transpose_f32_low_height;
    cl_kernel gpu_map_transpose_f32_low_width;
    cl_kernel gpu_map_transpose_f32_small;
    cl_kernel mainziscan_stage1_27347;
    cl_kernel mainziscan_stage1_27380;
    cl_kernel mainziscan_stage1_27388;
    cl_kernel mainziscan_stage1_27396;
    cl_kernel mainziscan_stage1_27448;
    cl_kernel mainziscan_stage2_27347;
    cl_kernel mainziscan_stage2_27380;
    cl_kernel mainziscan_stage2_27388;
    cl_kernel mainziscan_stage2_27396;
    cl_kernel mainziscan_stage2_27448;
    cl_kernel mainziscan_stage3_27347;
    cl_kernel mainziscan_stage3_27380;
    cl_kernel mainziscan_stage3_27388;
    cl_kernel mainziscan_stage3_27396;
    cl_kernel mainziscan_stage3_27448;
    cl_kernel mainziseghist_global_27365;
    cl_kernel mainziseghist_local_27365;
    cl_kernel mainzisegmap_26568;
    cl_kernel mainzisegmap_26717;
    cl_kernel mainzisegmap_26992;
    cl_kernel mainzisegmap_27090;
    cl_kernel mainzisegmap_27154;
    cl_kernel mainzisegmap_27450;
    cl_kernel mainzisegmap_27488;
    cl_kernel mainzisegmap_27513;
    cl_kernel mainzisegred_large_27529;
    cl_kernel mainzisegred_large_29153;
    cl_kernel mainzisegred_nonseg_26564;
    cl_kernel mainzisegred_nonseg_27357;
    cl_kernel mainzisegred_nonseg_27466;
    cl_kernel mainzisegred_nonseg_27562;
    cl_kernel mainzisegred_small_27529;
    cl_kernel mainzisegred_small_29153;
    cl_kernel testziscan_stage1_28395;
    cl_kernel testziscan_stage1_28428;
    cl_kernel testziscan_stage1_28436;
    cl_kernel testziscan_stage1_28444;
    cl_kernel testziscan_stage1_28496;
    cl_kernel testziscan_stage2_28395;
    cl_kernel testziscan_stage2_28428;
    cl_kernel testziscan_stage2_28436;
    cl_kernel testziscan_stage2_28444;
    cl_kernel testziscan_stage2_28496;
    cl_kernel testziscan_stage3_28395;
    cl_kernel testziscan_stage3_28428;
    cl_kernel testziscan_stage3_28436;
    cl_kernel testziscan_stage3_28444;
    cl_kernel testziscan_stage3_28496;
    cl_kernel testziseghist_global_28413;
    cl_kernel testziseghist_local_28413;
    cl_kernel testzisegmap_27619;
    cl_kernel testzisegmap_27768;
    cl_kernel testzisegmap_28043;
    cl_kernel testzisegmap_28141;
    cl_kernel testzisegmap_28205;
    cl_kernel testzisegmap_28498;
    cl_kernel testzisegmap_28536;
    cl_kernel testzisegmap_28561;
    cl_kernel testzisegred_large_28577;
    cl_kernel testzisegred_large_29153;
    cl_kernel testzisegred_nonseg_27615;
    cl_kernel testzisegred_nonseg_28405;
    cl_kernel testzisegred_nonseg_28514;
    cl_kernel testzisegred_nonseg_28610;
    cl_kernel testzisegred_small_28577;
    cl_kernel testzisegred_small_29153;
    int64_t copy_dev_to_dev_total_runtime;
    int copy_dev_to_dev_runs;
    int64_t copy_dev_to_host_total_runtime;
    int copy_dev_to_host_runs;
    int64_t copy_host_to_dev_total_runtime;
    int copy_host_to_dev_runs;
    int64_t copy_scalar_to_dev_total_runtime;
    int copy_scalar_to_dev_runs;
    int64_t copy_scalar_from_dev_total_runtime;
    int copy_scalar_from_dev_runs;
    int64_t builtinzhreplicate_f32zireplicate_29470_total_runtime;
    int builtinzhreplicate_f32zireplicate_29470_runs;
    int64_t builtinzhreplicate_i64zireplicate_29062_total_runtime;
    int builtinzhreplicate_i64zireplicate_29062_runs;
    int64_t gpu_map_transpose_f32_total_runtime;
    int gpu_map_transpose_f32_runs;
    int64_t gpu_map_transpose_f32_low_height_total_runtime;
    int gpu_map_transpose_f32_low_height_runs;
    int64_t gpu_map_transpose_f32_low_width_total_runtime;
    int gpu_map_transpose_f32_low_width_runs;
    int64_t gpu_map_transpose_f32_small_total_runtime;
    int gpu_map_transpose_f32_small_runs;
    int64_t mainziscan_stage1_27347_total_runtime;
    int mainziscan_stage1_27347_runs;
    int64_t mainziscan_stage1_27380_total_runtime;
    int mainziscan_stage1_27380_runs;
    int64_t mainziscan_stage1_27388_total_runtime;
    int mainziscan_stage1_27388_runs;
    int64_t mainziscan_stage1_27396_total_runtime;
    int mainziscan_stage1_27396_runs;
    int64_t mainziscan_stage1_27448_total_runtime;
    int mainziscan_stage1_27448_runs;
    int64_t mainziscan_stage2_27347_total_runtime;
    int mainziscan_stage2_27347_runs;
    int64_t mainziscan_stage2_27380_total_runtime;
    int mainziscan_stage2_27380_runs;
    int64_t mainziscan_stage2_27388_total_runtime;
    int mainziscan_stage2_27388_runs;
    int64_t mainziscan_stage2_27396_total_runtime;
    int mainziscan_stage2_27396_runs;
    int64_t mainziscan_stage2_27448_total_runtime;
    int mainziscan_stage2_27448_runs;
    int64_t mainziscan_stage3_27347_total_runtime;
    int mainziscan_stage3_27347_runs;
    int64_t mainziscan_stage3_27380_total_runtime;
    int mainziscan_stage3_27380_runs;
    int64_t mainziscan_stage3_27388_total_runtime;
    int mainziscan_stage3_27388_runs;
    int64_t mainziscan_stage3_27396_total_runtime;
    int mainziscan_stage3_27396_runs;
    int64_t mainziscan_stage3_27448_total_runtime;
    int mainziscan_stage3_27448_runs;
    int64_t mainziseghist_global_27365_total_runtime;
    int mainziseghist_global_27365_runs;
    int64_t mainziseghist_local_27365_total_runtime;
    int mainziseghist_local_27365_runs;
    int64_t mainzisegmap_26568_total_runtime;
    int mainzisegmap_26568_runs;
    int64_t mainzisegmap_26717_total_runtime;
    int mainzisegmap_26717_runs;
    int64_t mainzisegmap_26992_total_runtime;
    int mainzisegmap_26992_runs;
    int64_t mainzisegmap_27090_total_runtime;
    int mainzisegmap_27090_runs;
    int64_t mainzisegmap_27154_total_runtime;
    int mainzisegmap_27154_runs;
    int64_t mainzisegmap_27450_total_runtime;
    int mainzisegmap_27450_runs;
    int64_t mainzisegmap_27488_total_runtime;
    int mainzisegmap_27488_runs;
    int64_t mainzisegmap_27513_total_runtime;
    int mainzisegmap_27513_runs;
    int64_t mainzisegred_large_27529_total_runtime;
    int mainzisegred_large_27529_runs;
    int64_t mainzisegred_large_29153_total_runtime;
    int mainzisegred_large_29153_runs;
    int64_t mainzisegred_nonseg_26564_total_runtime;
    int mainzisegred_nonseg_26564_runs;
    int64_t mainzisegred_nonseg_27357_total_runtime;
    int mainzisegred_nonseg_27357_runs;
    int64_t mainzisegred_nonseg_27466_total_runtime;
    int mainzisegred_nonseg_27466_runs;
    int64_t mainzisegred_nonseg_27562_total_runtime;
    int mainzisegred_nonseg_27562_runs;
    int64_t mainzisegred_small_27529_total_runtime;
    int mainzisegred_small_27529_runs;
    int64_t mainzisegred_small_29153_total_runtime;
    int mainzisegred_small_29153_runs;
    int64_t testziscan_stage1_28395_total_runtime;
    int testziscan_stage1_28395_runs;
    int64_t testziscan_stage1_28428_total_runtime;
    int testziscan_stage1_28428_runs;
    int64_t testziscan_stage1_28436_total_runtime;
    int testziscan_stage1_28436_runs;
    int64_t testziscan_stage1_28444_total_runtime;
    int testziscan_stage1_28444_runs;
    int64_t testziscan_stage1_28496_total_runtime;
    int testziscan_stage1_28496_runs;
    int64_t testziscan_stage2_28395_total_runtime;
    int testziscan_stage2_28395_runs;
    int64_t testziscan_stage2_28428_total_runtime;
    int testziscan_stage2_28428_runs;
    int64_t testziscan_stage2_28436_total_runtime;
    int testziscan_stage2_28436_runs;
    int64_t testziscan_stage2_28444_total_runtime;
    int testziscan_stage2_28444_runs;
    int64_t testziscan_stage2_28496_total_runtime;
    int testziscan_stage2_28496_runs;
    int64_t testziscan_stage3_28395_total_runtime;
    int testziscan_stage3_28395_runs;
    int64_t testziscan_stage3_28428_total_runtime;
    int testziscan_stage3_28428_runs;
    int64_t testziscan_stage3_28436_total_runtime;
    int testziscan_stage3_28436_runs;
    int64_t testziscan_stage3_28444_total_runtime;
    int testziscan_stage3_28444_runs;
    int64_t testziscan_stage3_28496_total_runtime;
    int testziscan_stage3_28496_runs;
    int64_t testziseghist_global_28413_total_runtime;
    int testziseghist_global_28413_runs;
    int64_t testziseghist_local_28413_total_runtime;
    int testziseghist_local_28413_runs;
    int64_t testzisegmap_27619_total_runtime;
    int testzisegmap_27619_runs;
    int64_t testzisegmap_27768_total_runtime;
    int testzisegmap_27768_runs;
    int64_t testzisegmap_28043_total_runtime;
    int testzisegmap_28043_runs;
    int64_t testzisegmap_28141_total_runtime;
    int testzisegmap_28141_runs;
    int64_t testzisegmap_28205_total_runtime;
    int testzisegmap_28205_runs;
    int64_t testzisegmap_28498_total_runtime;
    int testzisegmap_28498_runs;
    int64_t testzisegmap_28536_total_runtime;
    int testzisegmap_28536_runs;
    int64_t testzisegmap_28561_total_runtime;
    int testzisegmap_28561_runs;
    int64_t testzisegred_large_28577_total_runtime;
    int testzisegred_large_28577_runs;
    int64_t testzisegred_large_29153_total_runtime;
    int testzisegred_large_29153_runs;
    int64_t testzisegred_nonseg_27615_total_runtime;
    int testzisegred_nonseg_27615_runs;
    int64_t testzisegred_nonseg_28405_total_runtime;
    int testzisegred_nonseg_28405_runs;
    int64_t testzisegred_nonseg_28514_total_runtime;
    int testzisegred_nonseg_28514_runs;
    int64_t testzisegred_nonseg_28610_total_runtime;
    int testzisegred_nonseg_28610_runs;
    int64_t testzisegred_small_28577_total_runtime;
    int testzisegred_small_28577_runs;
    int64_t testzisegred_small_29153_total_runtime;
    int testzisegred_small_29153_runs;
    cl_mem global_failure;
    cl_mem global_failure_args;
    struct opencl_context opencl;
    struct sizes sizes;
    cl_int failure_is_an_option;
} ;
void post_opencl_setup(struct opencl_context *ctx,
                       struct opencl_device_option *option)
{
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name,
                                            "NVIDIA CUDA") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_GPU) == CL_DEVICE_TYPE_GPU) {
        ctx->lockstep_width = 32;
    }
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name,
                                            "AMD Accelerated Parallel Processing") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->lockstep_width = 32;
    }
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->lockstep_width = 1;
    }
    if ((ctx->cfg.default_num_groups == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_GPU) == CL_DEVICE_TYPE_GPU) {
        size_t MAX_COMPUTE_UNITS_val = 0;
        
        clGetDeviceInfo(ctx->device, CL_DEVICE_MAX_COMPUTE_UNITS,
                        sizeof(MAX_COMPUTE_UNITS_val), &MAX_COMPUTE_UNITS_val,
                        NULL);
        ctx->cfg.default_num_groups = 4 * MAX_COMPUTE_UNITS_val;
    }
    if ((ctx->cfg.default_group_size == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_GPU) == CL_DEVICE_TYPE_GPU) {
        ctx->cfg.default_group_size = 256;
    }
    if ((ctx->cfg.default_tile_size == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->cfg.default_tile_size = 32;
    }
    if ((ctx->cfg.default_threshold == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_GPU) ==
        CL_DEVICE_TYPE_GPU) {
        ctx->cfg.default_threshold = 32768;
    }
    if ((ctx->lockstep_width == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_CPU) ==
        CL_DEVICE_TYPE_CPU) {
        ctx->lockstep_width = 1;
    }
    if ((ctx->cfg.default_num_groups == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_CPU) == CL_DEVICE_TYPE_CPU) {
        size_t MAX_COMPUTE_UNITS_val = 0;
        
        clGetDeviceInfo(ctx->device, CL_DEVICE_MAX_COMPUTE_UNITS,
                        sizeof(MAX_COMPUTE_UNITS_val), &MAX_COMPUTE_UNITS_val,
                        NULL);
        ctx->cfg.default_num_groups = MAX_COMPUTE_UNITS_val;
    }
    if ((ctx->cfg.default_group_size == 0 && strstr(option->platform_name,
                                                    "") != NULL) &&
        (option->device_type & CL_DEVICE_TYPE_CPU) == CL_DEVICE_TYPE_CPU) {
        ctx->cfg.default_group_size = 32;
    }
    if ((ctx->cfg.default_tile_size == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_CPU) ==
        CL_DEVICE_TYPE_CPU) {
        ctx->cfg.default_tile_size = 4;
    }
    if ((ctx->cfg.default_threshold == 0 && strstr(option->platform_name, "") !=
         NULL) && (option->device_type & CL_DEVICE_TYPE_CPU) ==
        CL_DEVICE_TYPE_CPU) {
        size_t MAX_COMPUTE_UNITS_val = 0;
        
        clGetDeviceInfo(ctx->device, CL_DEVICE_MAX_COMPUTE_UNITS,
                        sizeof(MAX_COMPUTE_UNITS_val), &MAX_COMPUTE_UNITS_val,
                        NULL);
        ctx->cfg.default_threshold = MAX_COMPUTE_UNITS_val;
    }
}
static void init_context_early(struct futhark_context_config *cfg,
                               struct futhark_context *ctx)
{
    ctx->opencl.cfg = cfg->opencl;
    ctx->detail_memory = cfg->opencl.debugging;
    ctx->debugging = cfg->opencl.debugging;
    ctx->profiling = cfg->opencl.profiling;
    ctx->profiling_paused = 0;
    ctx->logging = cfg->opencl.logging;
    ctx->error = NULL;
    ctx->opencl.profiling_records_capacity = 200;
    ctx->opencl.profiling_records_used = 0;
    ctx->opencl.profiling_records =
        malloc(ctx->opencl.profiling_records_capacity *
        sizeof(struct profiling_record));
    create_lock(&ctx->lock);
    ctx->failure_is_an_option = 0;
    ctx->peak_mem_usage_device = 0;
    ctx->cur_mem_usage_device = 0;
    ctx->peak_mem_usage_default = 0;
    ctx->cur_mem_usage_default = 0;
    ctx->total_runs = 0;
    ctx->total_runtime = 0;
    ctx->copy_dev_to_dev_total_runtime = 0;
    ctx->copy_dev_to_dev_runs = 0;
    ctx->copy_dev_to_host_total_runtime = 0;
    ctx->copy_dev_to_host_runs = 0;
    ctx->copy_host_to_dev_total_runtime = 0;
    ctx->copy_host_to_dev_runs = 0;
    ctx->copy_scalar_to_dev_total_runtime = 0;
    ctx->copy_scalar_to_dev_runs = 0;
    ctx->copy_scalar_from_dev_total_runtime = 0;
    ctx->copy_scalar_from_dev_runs = 0;
    ctx->builtinzhreplicate_f32zireplicate_29470_total_runtime = 0;
    ctx->builtinzhreplicate_f32zireplicate_29470_runs = 0;
    ctx->builtinzhreplicate_i64zireplicate_29062_total_runtime = 0;
    ctx->builtinzhreplicate_i64zireplicate_29062_runs = 0;
    ctx->gpu_map_transpose_f32_total_runtime = 0;
    ctx->gpu_map_transpose_f32_runs = 0;
    ctx->gpu_map_transpose_f32_low_height_total_runtime = 0;
    ctx->gpu_map_transpose_f32_low_height_runs = 0;
    ctx->gpu_map_transpose_f32_low_width_total_runtime = 0;
    ctx->gpu_map_transpose_f32_low_width_runs = 0;
    ctx->gpu_map_transpose_f32_small_total_runtime = 0;
    ctx->gpu_map_transpose_f32_small_runs = 0;
    ctx->mainziscan_stage1_27347_total_runtime = 0;
    ctx->mainziscan_stage1_27347_runs = 0;
    ctx->mainziscan_stage1_27380_total_runtime = 0;
    ctx->mainziscan_stage1_27380_runs = 0;
    ctx->mainziscan_stage1_27388_total_runtime = 0;
    ctx->mainziscan_stage1_27388_runs = 0;
    ctx->mainziscan_stage1_27396_total_runtime = 0;
    ctx->mainziscan_stage1_27396_runs = 0;
    ctx->mainziscan_stage1_27448_total_runtime = 0;
    ctx->mainziscan_stage1_27448_runs = 0;
    ctx->mainziscan_stage2_27347_total_runtime = 0;
    ctx->mainziscan_stage2_27347_runs = 0;
    ctx->mainziscan_stage2_27380_total_runtime = 0;
    ctx->mainziscan_stage2_27380_runs = 0;
    ctx->mainziscan_stage2_27388_total_runtime = 0;
    ctx->mainziscan_stage2_27388_runs = 0;
    ctx->mainziscan_stage2_27396_total_runtime = 0;
    ctx->mainziscan_stage2_27396_runs = 0;
    ctx->mainziscan_stage2_27448_total_runtime = 0;
    ctx->mainziscan_stage2_27448_runs = 0;
    ctx->mainziscan_stage3_27347_total_runtime = 0;
    ctx->mainziscan_stage3_27347_runs = 0;
    ctx->mainziscan_stage3_27380_total_runtime = 0;
    ctx->mainziscan_stage3_27380_runs = 0;
    ctx->mainziscan_stage3_27388_total_runtime = 0;
    ctx->mainziscan_stage3_27388_runs = 0;
    ctx->mainziscan_stage3_27396_total_runtime = 0;
    ctx->mainziscan_stage3_27396_runs = 0;
    ctx->mainziscan_stage3_27448_total_runtime = 0;
    ctx->mainziscan_stage3_27448_runs = 0;
    ctx->mainziseghist_global_27365_total_runtime = 0;
    ctx->mainziseghist_global_27365_runs = 0;
    ctx->mainziseghist_local_27365_total_runtime = 0;
    ctx->mainziseghist_local_27365_runs = 0;
    ctx->mainzisegmap_26568_total_runtime = 0;
    ctx->mainzisegmap_26568_runs = 0;
    ctx->mainzisegmap_26717_total_runtime = 0;
    ctx->mainzisegmap_26717_runs = 0;
    ctx->mainzisegmap_26992_total_runtime = 0;
    ctx->mainzisegmap_26992_runs = 0;
    ctx->mainzisegmap_27090_total_runtime = 0;
    ctx->mainzisegmap_27090_runs = 0;
    ctx->mainzisegmap_27154_total_runtime = 0;
    ctx->mainzisegmap_27154_runs = 0;
    ctx->mainzisegmap_27450_total_runtime = 0;
    ctx->mainzisegmap_27450_runs = 0;
    ctx->mainzisegmap_27488_total_runtime = 0;
    ctx->mainzisegmap_27488_runs = 0;
    ctx->mainzisegmap_27513_total_runtime = 0;
    ctx->mainzisegmap_27513_runs = 0;
    ctx->mainzisegred_large_27529_total_runtime = 0;
    ctx->mainzisegred_large_27529_runs = 0;
    ctx->mainzisegred_large_29153_total_runtime = 0;
    ctx->mainzisegred_large_29153_runs = 0;
    ctx->mainzisegred_nonseg_26564_total_runtime = 0;
    ctx->mainzisegred_nonseg_26564_runs = 0;
    ctx->mainzisegred_nonseg_27357_total_runtime = 0;
    ctx->mainzisegred_nonseg_27357_runs = 0;
    ctx->mainzisegred_nonseg_27466_total_runtime = 0;
    ctx->mainzisegred_nonseg_27466_runs = 0;
    ctx->mainzisegred_nonseg_27562_total_runtime = 0;
    ctx->mainzisegred_nonseg_27562_runs = 0;
    ctx->mainzisegred_small_27529_total_runtime = 0;
    ctx->mainzisegred_small_27529_runs = 0;
    ctx->mainzisegred_small_29153_total_runtime = 0;
    ctx->mainzisegred_small_29153_runs = 0;
    ctx->testziscan_stage1_28395_total_runtime = 0;
    ctx->testziscan_stage1_28395_runs = 0;
    ctx->testziscan_stage1_28428_total_runtime = 0;
    ctx->testziscan_stage1_28428_runs = 0;
    ctx->testziscan_stage1_28436_total_runtime = 0;
    ctx->testziscan_stage1_28436_runs = 0;
    ctx->testziscan_stage1_28444_total_runtime = 0;
    ctx->testziscan_stage1_28444_runs = 0;
    ctx->testziscan_stage1_28496_total_runtime = 0;
    ctx->testziscan_stage1_28496_runs = 0;
    ctx->testziscan_stage2_28395_total_runtime = 0;
    ctx->testziscan_stage2_28395_runs = 0;
    ctx->testziscan_stage2_28428_total_runtime = 0;
    ctx->testziscan_stage2_28428_runs = 0;
    ctx->testziscan_stage2_28436_total_runtime = 0;
    ctx->testziscan_stage2_28436_runs = 0;
    ctx->testziscan_stage2_28444_total_runtime = 0;
    ctx->testziscan_stage2_28444_runs = 0;
    ctx->testziscan_stage2_28496_total_runtime = 0;
    ctx->testziscan_stage2_28496_runs = 0;
    ctx->testziscan_stage3_28395_total_runtime = 0;
    ctx->testziscan_stage3_28395_runs = 0;
    ctx->testziscan_stage3_28428_total_runtime = 0;
    ctx->testziscan_stage3_28428_runs = 0;
    ctx->testziscan_stage3_28436_total_runtime = 0;
    ctx->testziscan_stage3_28436_runs = 0;
    ctx->testziscan_stage3_28444_total_runtime = 0;
    ctx->testziscan_stage3_28444_runs = 0;
    ctx->testziscan_stage3_28496_total_runtime = 0;
    ctx->testziscan_stage3_28496_runs = 0;
    ctx->testziseghist_global_28413_total_runtime = 0;
    ctx->testziseghist_global_28413_runs = 0;
    ctx->testziseghist_local_28413_total_runtime = 0;
    ctx->testziseghist_local_28413_runs = 0;
    ctx->testzisegmap_27619_total_runtime = 0;
    ctx->testzisegmap_27619_runs = 0;
    ctx->testzisegmap_27768_total_runtime = 0;
    ctx->testzisegmap_27768_runs = 0;
    ctx->testzisegmap_28043_total_runtime = 0;
    ctx->testzisegmap_28043_runs = 0;
    ctx->testzisegmap_28141_total_runtime = 0;
    ctx->testzisegmap_28141_runs = 0;
    ctx->testzisegmap_28205_total_runtime = 0;
    ctx->testzisegmap_28205_runs = 0;
    ctx->testzisegmap_28498_total_runtime = 0;
    ctx->testzisegmap_28498_runs = 0;
    ctx->testzisegmap_28536_total_runtime = 0;
    ctx->testzisegmap_28536_runs = 0;
    ctx->testzisegmap_28561_total_runtime = 0;
    ctx->testzisegmap_28561_runs = 0;
    ctx->testzisegred_large_28577_total_runtime = 0;
    ctx->testzisegred_large_28577_runs = 0;
    ctx->testzisegred_large_29153_total_runtime = 0;
    ctx->testzisegred_large_29153_runs = 0;
    ctx->testzisegred_nonseg_27615_total_runtime = 0;
    ctx->testzisegred_nonseg_27615_runs = 0;
    ctx->testzisegred_nonseg_28405_total_runtime = 0;
    ctx->testzisegred_nonseg_28405_runs = 0;
    ctx->testzisegred_nonseg_28514_total_runtime = 0;
    ctx->testzisegred_nonseg_28514_runs = 0;
    ctx->testzisegred_nonseg_28610_total_runtime = 0;
    ctx->testzisegred_nonseg_28610_runs = 0;
    ctx->testzisegred_small_28577_total_runtime = 0;
    ctx->testzisegred_small_28577_runs = 0;
    ctx->testzisegred_small_29153_total_runtime = 0;
    ctx->testzisegred_small_29153_runs = 0;
}
static int init_context_late(struct futhark_context_config *cfg,
                             struct futhark_context *ctx, cl_program prog)
{
    cl_int error;
    cl_int no_error = -1;
    
    ctx->global_failure = clCreateBuffer(ctx->opencl.ctx, CL_MEM_READ_WRITE |
                                         CL_MEM_COPY_HOST_PTR, sizeof(cl_int),
                                         &no_error, &error);
    OPENCL_SUCCEED_OR_RETURN(error);
    // The +1 is to avoid zero-byte allocations.
    ctx->global_failure_args = clCreateBuffer(ctx->opencl.ctx,
                                              CL_MEM_READ_WRITE,
                                              sizeof(int64_t) * (3 + 1), NULL,
                                              &error);
    OPENCL_SUCCEED_OR_RETURN(error);
    {
        ctx->builtinzhreplicate_f32zireplicate_29470 = clCreateKernel(prog,
                                                                      "builtinzhreplicate_f32zireplicate_29470",
                                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "builtin#replicate_f32.replicate_29470");
    }
    {
        ctx->builtinzhreplicate_i64zireplicate_29062 = clCreateKernel(prog,
                                                                      "builtinzhreplicate_i64zireplicate_29062",
                                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "builtin#replicate_i64.replicate_29062");
    }
    {
        ctx->gpu_map_transpose_f32 = clCreateKernel(prog,
                                                    "gpu_map_transpose_f32",
                                                    &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "gpu_map_transpose_f32");
    }
    {
        ctx->gpu_map_transpose_f32_low_height = clCreateKernel(prog,
                                                               "gpu_map_transpose_f32_low_height",
                                                               &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_f32_low_height");
    }
    {
        ctx->gpu_map_transpose_f32_low_width = clCreateKernel(prog,
                                                              "gpu_map_transpose_f32_low_width",
                                                              &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_f32_low_width");
    }
    {
        ctx->gpu_map_transpose_f32_small = clCreateKernel(prog,
                                                          "gpu_map_transpose_f32_small",
                                                          &error);
        OPENCL_SUCCEED_FATAL(error);
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "gpu_map_transpose_f32_small");
    }
    {
        ctx->mainziscan_stage1_27347 = clCreateKernel(prog,
                                                      "mainziscan_stage1_27347",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_27347, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_27347");
    }
    {
        ctx->mainziscan_stage1_27380 = clCreateKernel(prog,
                                                      "mainziscan_stage1_27380",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_27380, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_27380");
    }
    {
        ctx->mainziscan_stage1_27388 = clCreateKernel(prog,
                                                      "mainziscan_stage1_27388",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_27388, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_27388");
    }
    {
        ctx->mainziscan_stage1_27396 = clCreateKernel(prog,
                                                      "mainziscan_stage1_27396",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_27396, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_27396, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_27396");
    }
    {
        ctx->mainziscan_stage1_27448 = clCreateKernel(prog,
                                                      "mainziscan_stage1_27448",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage1_27448, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage1_27448");
    }
    {
        ctx->mainziscan_stage2_27347 = clCreateKernel(prog,
                                                      "mainziscan_stage2_27347",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_27347, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_27347");
    }
    {
        ctx->mainziscan_stage2_27380 = clCreateKernel(prog,
                                                      "mainziscan_stage2_27380",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_27380, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_27380");
    }
    {
        ctx->mainziscan_stage2_27388 = clCreateKernel(prog,
                                                      "mainziscan_stage2_27388",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_27388, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_27388");
    }
    {
        ctx->mainziscan_stage2_27396 = clCreateKernel(prog,
                                                      "mainziscan_stage2_27396",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_27396, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_27396");
    }
    {
        ctx->mainziscan_stage2_27448 = clCreateKernel(prog,
                                                      "mainziscan_stage2_27448",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage2_27448, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage2_27448");
    }
    {
        ctx->mainziscan_stage3_27347 = clCreateKernel(prog,
                                                      "mainziscan_stage3_27347",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_27347, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_27347");
    }
    {
        ctx->mainziscan_stage3_27380 = clCreateKernel(prog,
                                                      "mainziscan_stage3_27380",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_27380, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_27380");
    }
    {
        ctx->mainziscan_stage3_27388 = clCreateKernel(prog,
                                                      "mainziscan_stage3_27388",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_27388, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_27388");
    }
    {
        ctx->mainziscan_stage3_27396 = clCreateKernel(prog,
                                                      "mainziscan_stage3_27396",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_27396, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_27396");
    }
    {
        ctx->mainziscan_stage3_27448 = clCreateKernel(prog,
                                                      "mainziscan_stage3_27448",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziscan_stage3_27448, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.scan_stage3_27448");
    }
    {
        ctx->mainziseghist_global_27365 = clCreateKernel(prog,
                                                         "mainziseghist_global_27365",
                                                         &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziseghist_global_27365, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "main.seghist_global_27365");
    }
    {
        ctx->mainziseghist_local_27365 = clCreateKernel(prog,
                                                        "mainziseghist_local_27365",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainziseghist_local_27365, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.seghist_local_27365");
    }
    {
        ctx->mainzisegmap_26568 = clCreateKernel(prog, "mainzisegmap_26568",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_26568, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_26568, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_26568");
    }
    {
        ctx->mainzisegmap_26717 = clCreateKernel(prog, "mainzisegmap_26717",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_26717, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_26717, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_26717");
    }
    {
        ctx->mainzisegmap_26992 = clCreateKernel(prog, "mainzisegmap_26992",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_26992, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_26992, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_26992");
    }
    {
        ctx->mainzisegmap_27090 = clCreateKernel(prog, "mainzisegmap_27090",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_27090, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_27090");
    }
    {
        ctx->mainzisegmap_27154 = clCreateKernel(prog, "mainzisegmap_27154",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_27154, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_27154");
    }
    {
        ctx->mainzisegmap_27450 = clCreateKernel(prog, "mainzisegmap_27450",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_27450, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_27450");
    }
    {
        ctx->mainzisegmap_27488 = clCreateKernel(prog, "mainzisegmap_27488",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_27488, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_27488");
    }
    {
        ctx->mainzisegmap_27513 = clCreateKernel(prog, "mainzisegmap_27513",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegmap_27513, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segmap_27513");
    }
    {
        ctx->mainzisegred_large_27529 = clCreateKernel(prog,
                                                       "mainzisegred_large_27529",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_large_27529, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_large_27529");
    }
    {
        ctx->mainzisegred_large_29153 = clCreateKernel(prog,
                                                       "mainzisegred_large_29153",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_large_29153, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_large_29153");
    }
    {
        ctx->mainzisegred_nonseg_26564 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_26564",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_26564");
    }
    {
        ctx->mainzisegred_nonseg_27357 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_27357",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_27357, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_27357");
    }
    {
        ctx->mainzisegred_nonseg_27466 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_27466",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_27466, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_27466");
    }
    {
        ctx->mainzisegred_nonseg_27562 = clCreateKernel(prog,
                                                        "mainzisegred_nonseg_27562",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_nonseg_27562, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_nonseg_27562");
    }
    {
        ctx->mainzisegred_small_27529 = clCreateKernel(prog,
                                                       "mainzisegred_small_27529",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_small_27529, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_small_27529");
    }
    {
        ctx->mainzisegred_small_29153 = clCreateKernel(prog,
                                                       "mainzisegred_small_29153",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->mainzisegred_small_29153, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "main.segred_small_29153");
    }
    {
        ctx->testziscan_stage1_28395 = clCreateKernel(prog,
                                                      "testziscan_stage1_28395",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage1_28395, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage1_28395");
    }
    {
        ctx->testziscan_stage1_28428 = clCreateKernel(prog,
                                                      "testziscan_stage1_28428",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage1_28428, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage1_28428");
    }
    {
        ctx->testziscan_stage1_28436 = clCreateKernel(prog,
                                                      "testziscan_stage1_28436",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage1_28436, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage1_28436");
    }
    {
        ctx->testziscan_stage1_28444 = clCreateKernel(prog,
                                                      "testziscan_stage1_28444",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage1_28444, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage1_28444, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage1_28444");
    }
    {
        ctx->testziscan_stage1_28496 = clCreateKernel(prog,
                                                      "testziscan_stage1_28496",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage1_28496, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage1_28496");
    }
    {
        ctx->testziscan_stage2_28395 = clCreateKernel(prog,
                                                      "testziscan_stage2_28395",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage2_28395, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage2_28395");
    }
    {
        ctx->testziscan_stage2_28428 = clCreateKernel(prog,
                                                      "testziscan_stage2_28428",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage2_28428, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage2_28428");
    }
    {
        ctx->testziscan_stage2_28436 = clCreateKernel(prog,
                                                      "testziscan_stage2_28436",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage2_28436, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage2_28436");
    }
    {
        ctx->testziscan_stage2_28444 = clCreateKernel(prog,
                                                      "testziscan_stage2_28444",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage2_28444, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage2_28444");
    }
    {
        ctx->testziscan_stage2_28496 = clCreateKernel(prog,
                                                      "testziscan_stage2_28496",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage2_28496, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage2_28496");
    }
    {
        ctx->testziscan_stage3_28395 = clCreateKernel(prog,
                                                      "testziscan_stage3_28395",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage3_28395, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage3_28395");
    }
    {
        ctx->testziscan_stage3_28428 = clCreateKernel(prog,
                                                      "testziscan_stage3_28428",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage3_28428, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage3_28428");
    }
    {
        ctx->testziscan_stage3_28436 = clCreateKernel(prog,
                                                      "testziscan_stage3_28436",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage3_28436, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage3_28436");
    }
    {
        ctx->testziscan_stage3_28444 = clCreateKernel(prog,
                                                      "testziscan_stage3_28444",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage3_28444, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage3_28444");
    }
    {
        ctx->testziscan_stage3_28496 = clCreateKernel(prog,
                                                      "testziscan_stage3_28496",
                                                      &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziscan_stage3_28496, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.scan_stage3_28496");
    }
    {
        ctx->testziseghist_global_28413 = clCreateKernel(prog,
                                                         "testziseghist_global_28413",
                                                         &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziseghist_global_28413, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n",
                    "test.seghist_global_28413");
    }
    {
        ctx->testziseghist_local_28413 = clCreateKernel(prog,
                                                        "testziseghist_local_28413",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testziseghist_local_28413, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.seghist_local_28413");
    }
    {
        ctx->testzisegmap_27619 = clCreateKernel(prog, "testzisegmap_27619",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_27619, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_27619, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segmap_27619");
    }
    {
        ctx->testzisegmap_27768 = clCreateKernel(prog, "testzisegmap_27768",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_27768, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_27768, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segmap_27768");
    }
    {
        ctx->testzisegmap_28043 = clCreateKernel(prog, "testzisegmap_28043",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_28043, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_28043, 2,
                                            sizeof(cl_mem),
                                            &ctx->global_failure_args));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segmap_28043");
    }
    {
        ctx->testzisegmap_28141 = clCreateKernel(prog, "testzisegmap_28141",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_28141, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segmap_28141");
    }
    {
        ctx->testzisegmap_28205 = clCreateKernel(prog, "testzisegmap_28205",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_28205, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segmap_28205");
    }
    {
        ctx->testzisegmap_28498 = clCreateKernel(prog, "testzisegmap_28498",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_28498, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segmap_28498");
    }
    {
        ctx->testzisegmap_28536 = clCreateKernel(prog, "testzisegmap_28536",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_28536, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segmap_28536");
    }
    {
        ctx->testzisegmap_28561 = clCreateKernel(prog, "testzisegmap_28561",
                                                 &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegmap_28561, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segmap_28561");
    }
    {
        ctx->testzisegred_large_28577 = clCreateKernel(prog,
                                                       "testzisegred_large_28577",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegred_large_28577, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segred_large_28577");
    }
    {
        ctx->testzisegred_large_29153 = clCreateKernel(prog,
                                                       "testzisegred_large_29153",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegred_large_29153, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segred_large_29153");
    }
    {
        ctx->testzisegred_nonseg_27615 = clCreateKernel(prog,
                                                        "testzisegred_nonseg_27615",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegred_nonseg_27615, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segred_nonseg_27615");
    }
    {
        ctx->testzisegred_nonseg_28405 = clCreateKernel(prog,
                                                        "testzisegred_nonseg_28405",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegred_nonseg_28405, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segred_nonseg_28405");
    }
    {
        ctx->testzisegred_nonseg_28514 = clCreateKernel(prog,
                                                        "testzisegred_nonseg_28514",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegred_nonseg_28514, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segred_nonseg_28514");
    }
    {
        ctx->testzisegred_nonseg_28610 = clCreateKernel(prog,
                                                        "testzisegred_nonseg_28610",
                                                        &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegred_nonseg_28610, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segred_nonseg_28610");
    }
    {
        ctx->testzisegred_small_28577 = clCreateKernel(prog,
                                                       "testzisegred_small_28577",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegred_small_28577, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segred_small_28577");
    }
    {
        ctx->testzisegred_small_29153 = clCreateKernel(prog,
                                                       "testzisegred_small_29153",
                                                       &error);
        OPENCL_SUCCEED_FATAL(error);
        OPENCL_SUCCEED_FATAL(clSetKernelArg(ctx->testzisegred_small_29153, 0,
                                            sizeof(cl_mem),
                                            &ctx->global_failure));
        if (ctx->debugging)
            fprintf(stderr, "Created kernel %s.\n", "test.segred_small_29153");
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_28905.references = NULL;
        ctx->mainzicounter_mem_28905.size = 0;
        ctx->mainzicounter_mem_28905.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_28905.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_29647,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_29028.references = NULL;
        ctx->mainzicounter_mem_29028.size = 0;
        ctx->mainzicounter_mem_29028.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_29028.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_29694,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzihist_locks_mem_29138.references = NULL;
        ctx->mainzihist_locks_mem_29138.size = 0;
        ctx->mainzihist_locks_mem_29138.mem = clCreateBuffer(ctx->opencl.ctx,
                                                             CL_MEM_READ_WRITE,
                                                             (100151 >
                                                              0 ? 100151 : 1) *
                                                             sizeof(int32_t),
                                                             NULL, &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (100151 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzihist_locks_mem_29138.mem,
                                                          CL_TRUE, 0, 100151 *
                                                          sizeof(int32_t),
                                                          mainzihist_locks_mem_realtype_29706,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_29182.references = NULL;
        ctx->mainzicounter_mem_29182.size = 0;
        ctx->mainzicounter_mem_29182.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10240 >
                                                           0 ? 10240 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10240 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_29182.mem,
                                                          CL_TRUE, 0, 10240 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_29717,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_29480.references = NULL;
        ctx->mainzicounter_mem_29480.size = 0;
        ctx->mainzicounter_mem_29480.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_29480.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_29789,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_29545.references = NULL;
        ctx->mainzicounter_mem_29545.size = 0;
        ctx->mainzicounter_mem_29545.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10240 >
                                                           0 ? 10240 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10240 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_29545.mem,
                                                          CL_TRUE, 0, 10240 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_29806,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->mainzicounter_mem_29583.references = NULL;
        ctx->mainzicounter_mem_29583.size = 0;
        ctx->mainzicounter_mem_29583.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->mainzicounter_mem_29583.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          mainzicounter_mem_realtype_29817,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->testzistatic_array_28902.references = NULL;
        ctx->testzistatic_array_28902.size = 0;
        ctx->testzistatic_array_28902.mem = clCreateBuffer(ctx->opencl.ctx,
                                                           CL_MEM_READ_WRITE,
                                                           (45 > 0 ? 45 : 1) *
                                                           sizeof(float), NULL,
                                                           &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (45 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->testzistatic_array_28902.mem,
                                                          CL_TRUE, 0, 45 *
                                                          sizeof(float),
                                                          testzistatic_array_realtype_29826,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->testzistatic_array_28903.references = NULL;
        ctx->testzistatic_array_28903.size = 0;
        ctx->testzistatic_array_28903.mem = clCreateBuffer(ctx->opencl.ctx,
                                                           CL_MEM_READ_WRITE,
                                                           (45 > 0 ? 45 : 1) *
                                                           sizeof(int64_t),
                                                           NULL, &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (45 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->testzistatic_array_28903.mem,
                                                          CL_TRUE, 0, 45 *
                                                          sizeof(int64_t),
                                                          testzistatic_array_realtype_29827,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->testzistatic_array_28904.references = NULL;
        ctx->testzistatic_array_28904.size = 0;
        ctx->testzistatic_array_28904.mem = clCreateBuffer(ctx->opencl.ctx,
                                                           CL_MEM_READ_WRITE,
                                                           (45 > 0 ? 45 : 1) *
                                                           sizeof(float), NULL,
                                                           &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (45 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->testzistatic_array_28904.mem,
                                                          CL_TRUE, 0, 45 *
                                                          sizeof(float),
                                                          testzistatic_array_realtype_29828,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->testzicounter_mem_28906.references = NULL;
        ctx->testzicounter_mem_28906.size = 0;
        ctx->testzicounter_mem_28906.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->testzicounter_mem_28906.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          testzicounter_mem_realtype_29829,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->testzicounter_mem_29028.references = NULL;
        ctx->testzicounter_mem_29028.size = 0;
        ctx->testzicounter_mem_29028.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->testzicounter_mem_29028.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          testzicounter_mem_realtype_29876,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->testzihist_locks_mem_29138.references = NULL;
        ctx->testzihist_locks_mem_29138.size = 0;
        ctx->testzihist_locks_mem_29138.mem = clCreateBuffer(ctx->opencl.ctx,
                                                             CL_MEM_READ_WRITE,
                                                             (100151 >
                                                              0 ? 100151 : 1) *
                                                             sizeof(int32_t),
                                                             NULL, &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (100151 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->testzihist_locks_mem_29138.mem,
                                                          CL_TRUE, 0, 100151 *
                                                          sizeof(int32_t),
                                                          testzihist_locks_mem_realtype_29888,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->testzicounter_mem_29182.references = NULL;
        ctx->testzicounter_mem_29182.size = 0;
        ctx->testzicounter_mem_29182.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10240 >
                                                           0 ? 10240 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10240 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->testzicounter_mem_29182.mem,
                                                          CL_TRUE, 0, 10240 *
                                                          sizeof(int32_t),
                                                          testzicounter_mem_realtype_29899,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->testzicounter_mem_29480.references = NULL;
        ctx->testzicounter_mem_29480.size = 0;
        ctx->testzicounter_mem_29480.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->testzicounter_mem_29480.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          testzicounter_mem_realtype_29971,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->testzicounter_mem_29545.references = NULL;
        ctx->testzicounter_mem_29545.size = 0;
        ctx->testzicounter_mem_29545.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10240 >
                                                           0 ? 10240 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10240 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->testzicounter_mem_29545.mem,
                                                          CL_TRUE, 0, 10240 *
                                                          sizeof(int32_t),
                                                          testzicounter_mem_realtype_29988,
                                                          0, NULL, NULL));
    }
    {
        cl_int success;
        
        ctx->testzicounter_mem_29583.references = NULL;
        ctx->testzicounter_mem_29583.size = 0;
        ctx->testzicounter_mem_29583.mem = clCreateBuffer(ctx->opencl.ctx,
                                                          CL_MEM_READ_WRITE,
                                                          (10 > 0 ? 10 : 1) *
                                                          sizeof(int32_t), NULL,
                                                          &success);
        OPENCL_SUCCEED_OR_RETURN(success);
        if (10 > 0)
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          ctx->testzicounter_mem_29583.mem,
                                                          CL_TRUE, 0, 10 *
                                                          sizeof(int32_t),
                                                          testzicounter_mem_realtype_29999,
                                                          0, NULL, NULL));
    }
    ctx->sizes.builtinzhreplicate_f32zigroup_sizze_29473 = cfg->sizes[0];
    ctx->sizes.builtinzhreplicate_i64zigroup_sizze_29065 = cfg->sizes[1];
    ctx->sizes.mainziL2_sizze_29130 = cfg->sizes[2];
    ctx->sizes.mainziseghist_group_sizze_27359 = cfg->sizes[3];
    ctx->sizes.mainziseghist_num_groups_27361 = cfg->sizes[4];
    ctx->sizes.mainzisegmap_group_sizze_26570 = cfg->sizes[5];
    ctx->sizes.mainzisegmap_group_sizze_26719 = cfg->sizes[6];
    ctx->sizes.mainzisegmap_group_sizze_26994 = cfg->sizes[7];
    ctx->sizes.mainzisegmap_group_sizze_27093 = cfg->sizes[8];
    ctx->sizes.mainzisegmap_group_sizze_27156 = cfg->sizes[9];
    ctx->sizes.mainzisegmap_group_sizze_27452 = cfg->sizes[10];
    ctx->sizes.mainzisegmap_group_sizze_27490 = cfg->sizes[11];
    ctx->sizes.mainzisegmap_group_sizze_27515 = cfg->sizes[12];
    ctx->sizes.mainzisegmap_num_groups_26996 = cfg->sizes[13];
    ctx->sizes.mainzisegred_group_sizze_26556 = cfg->sizes[14];
    ctx->sizes.mainzisegred_group_sizze_27349 = cfg->sizes[15];
    ctx->sizes.mainzisegred_group_sizze_27458 = cfg->sizes[16];
    ctx->sizes.mainzisegred_group_sizze_27523 = cfg->sizes[17];
    ctx->sizes.mainzisegred_group_sizze_27554 = cfg->sizes[18];
    ctx->sizes.mainzisegred_num_groups_26558 = cfg->sizes[19];
    ctx->sizes.mainzisegred_num_groups_27351 = cfg->sizes[20];
    ctx->sizes.mainzisegred_num_groups_27460 = cfg->sizes[21];
    ctx->sizes.mainzisegred_num_groups_27525 = cfg->sizes[22];
    ctx->sizes.mainzisegred_num_groups_27556 = cfg->sizes[23];
    ctx->sizes.mainzisegscan_group_sizze_27341 = cfg->sizes[24];
    ctx->sizes.mainzisegscan_group_sizze_27374 = cfg->sizes[25];
    ctx->sizes.mainzisegscan_group_sizze_27382 = cfg->sizes[26];
    ctx->sizes.mainzisegscan_group_sizze_27390 = cfg->sizes[27];
    ctx->sizes.mainzisegscan_group_sizze_27442 = cfg->sizes[28];
    ctx->sizes.mainzisegscan_num_groups_27343 = cfg->sizes[29];
    ctx->sizes.mainzisegscan_num_groups_27376 = cfg->sizes[30];
    ctx->sizes.mainzisegscan_num_groups_27384 = cfg->sizes[31];
    ctx->sizes.mainzisegscan_num_groups_27392 = cfg->sizes[32];
    ctx->sizes.mainzisegscan_num_groups_27444 = cfg->sizes[33];
    ctx->sizes.mainzisuff_outer_par_0 = cfg->sizes[34];
    ctx->sizes.mainzisuff_outer_par_8 = cfg->sizes[35];
    ctx->sizes.mainzisuff_outer_redomap_7 = cfg->sizes[36];
    ctx->sizes.testziL2_sizze_29130 = cfg->sizes[37];
    ctx->sizes.testziseghist_group_sizze_28407 = cfg->sizes[38];
    ctx->sizes.testziseghist_num_groups_28409 = cfg->sizes[39];
    ctx->sizes.testzisegmap_group_sizze_27621 = cfg->sizes[40];
    ctx->sizes.testzisegmap_group_sizze_27770 = cfg->sizes[41];
    ctx->sizes.testzisegmap_group_sizze_28045 = cfg->sizes[42];
    ctx->sizes.testzisegmap_group_sizze_28144 = cfg->sizes[43];
    ctx->sizes.testzisegmap_group_sizze_28207 = cfg->sizes[44];
    ctx->sizes.testzisegmap_group_sizze_28500 = cfg->sizes[45];
    ctx->sizes.testzisegmap_group_sizze_28538 = cfg->sizes[46];
    ctx->sizes.testzisegmap_group_sizze_28563 = cfg->sizes[47];
    ctx->sizes.testzisegmap_num_groups_28047 = cfg->sizes[48];
    ctx->sizes.testzisegred_group_sizze_27607 = cfg->sizes[49];
    ctx->sizes.testzisegred_group_sizze_28397 = cfg->sizes[50];
    ctx->sizes.testzisegred_group_sizze_28506 = cfg->sizes[51];
    ctx->sizes.testzisegred_group_sizze_28571 = cfg->sizes[52];
    ctx->sizes.testzisegred_group_sizze_28602 = cfg->sizes[53];
    ctx->sizes.testzisegred_num_groups_27609 = cfg->sizes[54];
    ctx->sizes.testzisegred_num_groups_28399 = cfg->sizes[55];
    ctx->sizes.testzisegred_num_groups_28508 = cfg->sizes[56];
    ctx->sizes.testzisegred_num_groups_28573 = cfg->sizes[57];
    ctx->sizes.testzisegred_num_groups_28604 = cfg->sizes[58];
    ctx->sizes.testzisegscan_group_sizze_28389 = cfg->sizes[59];
    ctx->sizes.testzisegscan_group_sizze_28422 = cfg->sizes[60];
    ctx->sizes.testzisegscan_group_sizze_28430 = cfg->sizes[61];
    ctx->sizes.testzisegscan_group_sizze_28438 = cfg->sizes[62];
    ctx->sizes.testzisegscan_group_sizze_28490 = cfg->sizes[63];
    ctx->sizes.testzisegscan_num_groups_28391 = cfg->sizes[64];
    ctx->sizes.testzisegscan_num_groups_28424 = cfg->sizes[65];
    ctx->sizes.testzisegscan_num_groups_28432 = cfg->sizes[66];
    ctx->sizes.testzisegscan_num_groups_28440 = cfg->sizes[67];
    ctx->sizes.testzisegscan_num_groups_28492 = cfg->sizes[68];
    ctx->sizes.testzisuff_outer_par_0 = cfg->sizes[69];
    ctx->sizes.testzisuff_outer_par_8 = cfg->sizes[70];
    ctx->sizes.testzisuff_outer_redomap_7 = cfg->sizes[71];
    init_constants(ctx);
    // Clear the free list of any deallocations that occurred while initialising constants.
    OPENCL_SUCCEED_OR_RETURN(opencl_free_all(&ctx->opencl));
    // The program will be properly freed after all the kernels have also been freed.
    OPENCL_SUCCEED_OR_RETURN(clReleaseProgram(prog));
    return futhark_context_sync(ctx);
}
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg)
{
    struct futhark_context *ctx =
                           (struct futhark_context *) malloc(sizeof(struct futhark_context));
    
    if (ctx == NULL)
        return NULL;
    
    int required_types = 0;
    
    init_context_early(cfg, ctx);
    
    cl_program prog = setup_opencl(&ctx->opencl, opencl_program, required_types,
                                   cfg->build_opts);
    
    init_context_late(cfg, ctx, prog);
    return ctx;
}
struct futhark_context *futhark_context_new_with_command_queue(struct futhark_context_config *cfg,
                                                               cl_command_queue queue)
{
    struct futhark_context *ctx =
                           (struct futhark_context *) malloc(sizeof(struct futhark_context));
    
    if (ctx == NULL)
        return NULL;
    
    int required_types = 0;
    
    init_context_early(cfg, ctx);
    
    cl_program prog = setup_opencl_with_command_queue(&ctx->opencl, queue,
                                                      opencl_program,
                                                      required_types,
                                                      cfg->build_opts);
    
    init_context_late(cfg, ctx, prog);
    return ctx;
}
void futhark_context_free(struct futhark_context *ctx)
{
    free_constants(ctx);
    free_lock(&ctx->lock);
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->builtinzhreplicate_f32zireplicate_29470));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->builtinzhreplicate_i64zireplicate_29062));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32_low_height));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32_low_width));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->gpu_map_transpose_f32_small));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_27347));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_27380));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_27388));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_27396));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage1_27448));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_27347));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_27380));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_27388));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_27396));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage2_27448));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_27347));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_27380));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_27388));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_27396));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziscan_stage3_27448));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziseghist_global_27365));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainziseghist_local_27365));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_26568));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_26717));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_26992));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_27090));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_27154));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_27450));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_27488));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegmap_27513));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_large_27529));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_large_29153));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_26564));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_27357));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_27466));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_nonseg_27562));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_small_27529));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->mainzisegred_small_29153));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage1_28395));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage1_28428));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage1_28436));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage1_28444));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage1_28496));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage2_28395));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage2_28428));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage2_28436));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage2_28444));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage2_28496));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage3_28395));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage3_28428));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage3_28436));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage3_28444));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziscan_stage3_28496));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziseghist_global_28413));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testziseghist_local_28413));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegmap_27619));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegmap_27768));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegmap_28043));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegmap_28141));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegmap_28205));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegmap_28498));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegmap_28536));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegmap_28561));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegred_large_28577));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegred_large_29153));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegred_nonseg_27615));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegred_nonseg_28405));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegred_nonseg_28514));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegred_nonseg_28610));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegred_small_28577));
    OPENCL_SUCCEED_FATAL(clReleaseKernel(ctx->testzisegred_small_29153));
    teardown_opencl(&ctx->opencl);
    free(ctx);
}
int futhark_context_sync(struct futhark_context *ctx)
{
    cl_int failure_idx = -1;
    
    if (ctx->failure_is_an_option) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     ctx->global_failure,
                                                     CL_FALSE, 0,
                                                     sizeof(cl_int),
                                                     &failure_idx, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        ctx->failure_is_an_option = 0;
    }
    OPENCL_SUCCEED_OR_RETURN(clFinish(ctx->opencl.queue));
    if (failure_idx >= 0) {
        cl_int no_failure = -1;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                      ctx->global_failure,
                                                      CL_TRUE, 0,
                                                      sizeof(cl_int),
                                                      &no_failure, 0, NULL,
                                                      NULL));
        
        int64_t args[3 + 1];
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     ctx->global_failure_args,
                                                     CL_TRUE, 0, sizeof(args),
                                                     &args, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_host_runs,
                                                                                               &ctx->copy_dev_to_host_total_runtime)));
        switch (failure_idx) {
            
          case 0:
            {
                ctx->error =
                    msgprintf("Range %lld..%lld...%lld is invalid.\n-> #0  cva.fut:54:29-48\n   #1  cva.fut:95:25-65\n   #2  cva.fut:110:16-62\n   #3  cva.fut:106:17-110:85\n   #4  cva.fut:101:1-145:20\n",
                              args[0], args[1], args[2]);
                break;
            }
            
          case 1:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:96:47-70\n   #1  cva.fut:110:16-62\n   #2  cva.fut:106:17-110:85\n   #3  cva.fut:101:1-145:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 2:
            {
                ctx->error =
                    msgprintf("Range %lld..%lld...%lld is invalid.\n-> #0  cva.fut:54:29-48\n   #1  cva.fut:95:25-65\n   #2  cva.fut:110:16-62\n   #3  cva.fut:106:17-110:85\n   #4  cva.fut:101:1-145:20\n",
                              args[0], args[1], args[2]);
                break;
            }
            
          case 3:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:96:47-70\n   #1  cva.fut:110:16-62\n   #2  cva.fut:106:17-110:85\n   #3  cva.fut:101:1-145:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 4:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:71:97-104\n   #1  cva.fut:123:32-62\n   #2  cva.fut:123:22-69\n   #3  cva.fut:101:1-145:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 5:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:71:58-105\n   #1  cva.fut:123:32-62\n   #2  cva.fut:123:22-69\n   #3  cva.fut:101:1-145:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 6:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  lib/github.com/diku-dk/segmented/segmented.fut:90:30-35\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:90:12-49\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:133:38-97\n   #6  /prelude/soacs.fut:56:19-23\n   #7  /prelude/soacs.fut:56:3-37\n   #8  cva.fut:126:44-136:50\n   #9  cva.fut:101:1-145:20\n",
                              args[0], args[1]);
                break;
            }
            
          case 7:
            {
                ctx->error =
                    msgprintf("Range %lld..%lld...%lld is invalid.\n-> #0  cva.fut:54:29-48\n   #1  cva.fut:95:25-65\n   #2  cva.fut:110:16-62\n   #3  cva.fut:106:17-110:85\n   #4  cva.fut:154:3-156:129\n   #5  cva.fut:153:1-156:137\n",
                              args[0], args[1], args[2]);
                break;
            }
            
          case 8:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:96:47-70\n   #1  cva.fut:110:16-62\n   #2  cva.fut:106:17-110:85\n   #3  cva.fut:154:3-156:129\n   #4  cva.fut:153:1-156:137\n",
                              args[0], args[1]);
                break;
            }
            
          case 9:
            {
                ctx->error =
                    msgprintf("Range %lld..%lld...%lld is invalid.\n-> #0  cva.fut:54:29-48\n   #1  cva.fut:95:25-65\n   #2  cva.fut:110:16-62\n   #3  cva.fut:106:17-110:85\n   #4  cva.fut:154:3-156:129\n   #5  cva.fut:153:1-156:137\n",
                              args[0], args[1], args[2]);
                break;
            }
            
          case 10:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:96:47-70\n   #1  cva.fut:110:16-62\n   #2  cva.fut:106:17-110:85\n   #3  cva.fut:154:3-156:129\n   #4  cva.fut:153:1-156:137\n",
                              args[0], args[1]);
                break;
            }
            
          case 11:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:71:97-104\n   #1  cva.fut:123:32-62\n   #2  cva.fut:123:22-69\n   #3  cva.fut:154:3-156:129\n   #4  cva.fut:153:1-156:137\n",
                              args[0], args[1]);
                break;
            }
            
          case 12:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  cva.fut:71:58-105\n   #1  cva.fut:123:32-62\n   #2  cva.fut:123:22-69\n   #3  cva.fut:154:3-156:129\n   #4  cva.fut:153:1-156:137\n",
                              args[0], args[1]);
                break;
            }
            
          case 13:
            {
                ctx->error =
                    msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  lib/github.com/diku-dk/segmented/segmented.fut:90:30-35\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:90:12-49\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:133:38-97\n   #6  /prelude/soacs.fut:56:19-23\n   #7  /prelude/soacs.fut:56:3-37\n   #8  cva.fut:126:44-136:50\n   #9  cva.fut:154:3-156:129\n   #10 cva.fut:153:1-156:137\n",
                              args[0], args[1]);
                break;
            }
        }
        return 1;
    }
    return 0;
}
int futhark_context_clear_caches(struct futhark_context *ctx)
{
    ctx->error = OPENCL_SUCCEED_NONFATAL(opencl_free_all(&ctx->opencl));
    return ctx->error != NULL;
}
cl_command_queue futhark_context_get_command_queue(struct futhark_context *ctx)
{
    return ctx->opencl.queue;
}
static int memblock_unref_device(struct futhark_context *ctx,
                                 struct memblock_device *block, const
                                 char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(stderr,
                    "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n",
                    desc, block->desc, "space 'device'", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_device -= block->size;
            OPENCL_SUCCEED_OR_RETURN(opencl_free(&ctx->opencl, block->mem,
                                                 desc));
            free(block->references);
            if (ctx->detail_memory)
                fprintf(stderr,
                        "%lld bytes freed (now allocated: %lld bytes)\n",
                        (long long) block->size,
                        (long long) ctx->cur_mem_usage_device);
        }
        block->references = NULL;
    }
    return 0;
}
static int memblock_alloc_device(struct futhark_context *ctx,
                                 struct memblock_device *block, int64_t size,
                                 const char *desc)
{
    if (size < 0)
        futhark_panic(1,
                      "Negative allocation of %lld bytes attempted for %s in %s.\n",
                      (long long) size, desc, "space 'device'",
                      ctx->cur_mem_usage_device);
    
    int ret = memblock_unref_device(ctx, block, desc);
    
    ctx->cur_mem_usage_device += size;
    if (ctx->detail_memory)
        fprintf(stderr,
                "Allocating %lld bytes for %s in %s (then allocated: %lld bytes)",
                (long long) size, desc, "space 'device'",
                (long long) ctx->cur_mem_usage_device);
    if (ctx->cur_mem_usage_device > ctx->peak_mem_usage_device) {
        ctx->peak_mem_usage_device = ctx->cur_mem_usage_device;
        if (ctx->detail_memory)
            fprintf(stderr, " (new peak).\n");
    } else if (ctx->detail_memory)
        fprintf(stderr, ".\n");
    OPENCL_SUCCEED_OR_RETURN(opencl_alloc(&ctx->opencl, size, desc,
                                          &block->mem));
    block->references = (int *) malloc(sizeof(int));
    *block->references = 1;
    block->size = size;
    block->desc = desc;
    return ret;
}
static int memblock_set_device(struct futhark_context *ctx,
                               struct memblock_device *lhs,
                               struct memblock_device *rhs, const
                               char *lhs_desc)
{
    int ret = memblock_unref_device(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
static int memblock_unref(struct futhark_context *ctx, struct memblock *block,
                          const char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(stderr,
                    "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n",
                    desc, block->desc, "default space", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_default -= block->size;
            free(block->mem);
            free(block->references);
            if (ctx->detail_memory)
                fprintf(stderr,
                        "%lld bytes freed (now allocated: %lld bytes)\n",
                        (long long) block->size,
                        (long long) ctx->cur_mem_usage_default);
        }
        block->references = NULL;
    }
    return 0;
}
static int memblock_alloc(struct futhark_context *ctx, struct memblock *block,
                          int64_t size, const char *desc)
{
    if (size < 0)
        futhark_panic(1,
                      "Negative allocation of %lld bytes attempted for %s in %s.\n",
                      (long long) size, desc, "default space",
                      ctx->cur_mem_usage_default);
    
    int ret = memblock_unref(ctx, block, desc);
    
    ctx->cur_mem_usage_default += size;
    if (ctx->detail_memory)
        fprintf(stderr,
                "Allocating %lld bytes for %s in %s (then allocated: %lld bytes)",
                (long long) size, desc, "default space",
                (long long) ctx->cur_mem_usage_default);
    if (ctx->cur_mem_usage_default > ctx->peak_mem_usage_default) {
        ctx->peak_mem_usage_default = ctx->cur_mem_usage_default;
        if (ctx->detail_memory)
            fprintf(stderr, " (new peak).\n");
    } else if (ctx->detail_memory)
        fprintf(stderr, ".\n");
    block->mem = (char *) malloc(size);
    block->references = (int *) malloc(sizeof(int));
    *block->references = 1;
    block->size = size;
    block->desc = desc;
    return ret;
}
static int memblock_set(struct futhark_context *ctx, struct memblock *lhs,
                        struct memblock *rhs, const char *lhs_desc)
{
    int ret = memblock_unref(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
char *futhark_context_report(struct futhark_context *ctx)
{
    struct str_builder builder;
    
    str_builder_init(&builder);
    if (ctx->detail_memory || ctx->profiling) {
        str_builder(&builder,
                    "Peak memory usage for space 'device': %lld bytes.\n",
                    (long long) ctx->peak_mem_usage_device);
        { }
    }
    if (ctx->profiling) {
        OPENCL_SUCCEED_FATAL(opencl_tally_profiling_records(&ctx->opencl));
        str_builder(&builder,
                    "copy_dev_to_dev                       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_dev_to_dev_runs,
                    (long) ctx->copy_dev_to_dev_total_runtime /
                    (ctx->copy_dev_to_dev_runs !=
                     0 ? ctx->copy_dev_to_dev_runs : 1),
                    (long) ctx->copy_dev_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_dev_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_dev_to_dev_runs;
        str_builder(&builder,
                    "copy_dev_to_host                      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_dev_to_host_runs,
                    (long) ctx->copy_dev_to_host_total_runtime /
                    (ctx->copy_dev_to_host_runs !=
                     0 ? ctx->copy_dev_to_host_runs : 1),
                    (long) ctx->copy_dev_to_host_total_runtime);
        ctx->total_runtime += ctx->copy_dev_to_host_total_runtime;
        ctx->total_runs += ctx->copy_dev_to_host_runs;
        str_builder(&builder,
                    "copy_host_to_dev                      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_host_to_dev_runs,
                    (long) ctx->copy_host_to_dev_total_runtime /
                    (ctx->copy_host_to_dev_runs !=
                     0 ? ctx->copy_host_to_dev_runs : 1),
                    (long) ctx->copy_host_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_host_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_host_to_dev_runs;
        str_builder(&builder,
                    "copy_scalar_to_dev                    ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_scalar_to_dev_runs,
                    (long) ctx->copy_scalar_to_dev_total_runtime /
                    (ctx->copy_scalar_to_dev_runs !=
                     0 ? ctx->copy_scalar_to_dev_runs : 1),
                    (long) ctx->copy_scalar_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_scalar_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_scalar_to_dev_runs;
        str_builder(&builder,
                    "copy_scalar_from_dev                  ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_scalar_from_dev_runs,
                    (long) ctx->copy_scalar_from_dev_total_runtime /
                    (ctx->copy_scalar_from_dev_runs !=
                     0 ? ctx->copy_scalar_from_dev_runs : 1),
                    (long) ctx->copy_scalar_from_dev_total_runtime);
        ctx->total_runtime += ctx->copy_scalar_from_dev_total_runtime;
        ctx->total_runs += ctx->copy_scalar_from_dev_runs;
        str_builder(&builder,
                    "builtin#replicate_f32.replicate_29470 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->builtinzhreplicate_f32zireplicate_29470_runs,
                    (long) ctx->builtinzhreplicate_f32zireplicate_29470_total_runtime /
                    (ctx->builtinzhreplicate_f32zireplicate_29470_runs !=
                     0 ? ctx->builtinzhreplicate_f32zireplicate_29470_runs : 1),
                    (long) ctx->builtinzhreplicate_f32zireplicate_29470_total_runtime);
        ctx->total_runtime +=
            ctx->builtinzhreplicate_f32zireplicate_29470_total_runtime;
        ctx->total_runs += ctx->builtinzhreplicate_f32zireplicate_29470_runs;
        str_builder(&builder,
                    "builtin#replicate_i64.replicate_29062 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->builtinzhreplicate_i64zireplicate_29062_runs,
                    (long) ctx->builtinzhreplicate_i64zireplicate_29062_total_runtime /
                    (ctx->builtinzhreplicate_i64zireplicate_29062_runs !=
                     0 ? ctx->builtinzhreplicate_i64zireplicate_29062_runs : 1),
                    (long) ctx->builtinzhreplicate_i64zireplicate_29062_total_runtime);
        ctx->total_runtime +=
            ctx->builtinzhreplicate_i64zireplicate_29062_total_runtime;
        ctx->total_runs += ctx->builtinzhreplicate_i64zireplicate_29062_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32                 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_runs,
                    (long) ctx->gpu_map_transpose_f32_total_runtime /
                    (ctx->gpu_map_transpose_f32_runs !=
                     0 ? ctx->gpu_map_transpose_f32_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_f32_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_low_height      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_low_height_runs,
                    (long) ctx->gpu_map_transpose_f32_low_height_total_runtime /
                    (ctx->gpu_map_transpose_f32_low_height_runs !=
                     0 ? ctx->gpu_map_transpose_f32_low_height_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_low_height_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_f32_low_height_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_low_height_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_low_width       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_low_width_runs,
                    (long) ctx->gpu_map_transpose_f32_low_width_total_runtime /
                    (ctx->gpu_map_transpose_f32_low_width_runs !=
                     0 ? ctx->gpu_map_transpose_f32_low_width_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_low_width_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_f32_low_width_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_low_width_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_small           ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_small_runs,
                    (long) ctx->gpu_map_transpose_f32_small_total_runtime /
                    (ctx->gpu_map_transpose_f32_small_runs !=
                     0 ? ctx->gpu_map_transpose_f32_small_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_small_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_f32_small_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_small_runs;
        str_builder(&builder,
                    "main.scan_stage1_27347                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_27347_runs,
                    (long) ctx->mainziscan_stage1_27347_total_runtime /
                    (ctx->mainziscan_stage1_27347_runs !=
                     0 ? ctx->mainziscan_stage1_27347_runs : 1),
                    (long) ctx->mainziscan_stage1_27347_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_27347_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_27347_runs;
        str_builder(&builder,
                    "main.scan_stage1_27380                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_27380_runs,
                    (long) ctx->mainziscan_stage1_27380_total_runtime /
                    (ctx->mainziscan_stage1_27380_runs !=
                     0 ? ctx->mainziscan_stage1_27380_runs : 1),
                    (long) ctx->mainziscan_stage1_27380_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_27380_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_27380_runs;
        str_builder(&builder,
                    "main.scan_stage1_27388                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_27388_runs,
                    (long) ctx->mainziscan_stage1_27388_total_runtime /
                    (ctx->mainziscan_stage1_27388_runs !=
                     0 ? ctx->mainziscan_stage1_27388_runs : 1),
                    (long) ctx->mainziscan_stage1_27388_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_27388_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_27388_runs;
        str_builder(&builder,
                    "main.scan_stage1_27396                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_27396_runs,
                    (long) ctx->mainziscan_stage1_27396_total_runtime /
                    (ctx->mainziscan_stage1_27396_runs !=
                     0 ? ctx->mainziscan_stage1_27396_runs : 1),
                    (long) ctx->mainziscan_stage1_27396_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_27396_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_27396_runs;
        str_builder(&builder,
                    "main.scan_stage1_27448                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage1_27448_runs,
                    (long) ctx->mainziscan_stage1_27448_total_runtime /
                    (ctx->mainziscan_stage1_27448_runs !=
                     0 ? ctx->mainziscan_stage1_27448_runs : 1),
                    (long) ctx->mainziscan_stage1_27448_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage1_27448_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage1_27448_runs;
        str_builder(&builder,
                    "main.scan_stage2_27347                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_27347_runs,
                    (long) ctx->mainziscan_stage2_27347_total_runtime /
                    (ctx->mainziscan_stage2_27347_runs !=
                     0 ? ctx->mainziscan_stage2_27347_runs : 1),
                    (long) ctx->mainziscan_stage2_27347_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_27347_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_27347_runs;
        str_builder(&builder,
                    "main.scan_stage2_27380                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_27380_runs,
                    (long) ctx->mainziscan_stage2_27380_total_runtime /
                    (ctx->mainziscan_stage2_27380_runs !=
                     0 ? ctx->mainziscan_stage2_27380_runs : 1),
                    (long) ctx->mainziscan_stage2_27380_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_27380_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_27380_runs;
        str_builder(&builder,
                    "main.scan_stage2_27388                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_27388_runs,
                    (long) ctx->mainziscan_stage2_27388_total_runtime /
                    (ctx->mainziscan_stage2_27388_runs !=
                     0 ? ctx->mainziscan_stage2_27388_runs : 1),
                    (long) ctx->mainziscan_stage2_27388_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_27388_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_27388_runs;
        str_builder(&builder,
                    "main.scan_stage2_27396                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_27396_runs,
                    (long) ctx->mainziscan_stage2_27396_total_runtime /
                    (ctx->mainziscan_stage2_27396_runs !=
                     0 ? ctx->mainziscan_stage2_27396_runs : 1),
                    (long) ctx->mainziscan_stage2_27396_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_27396_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_27396_runs;
        str_builder(&builder,
                    "main.scan_stage2_27448                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage2_27448_runs,
                    (long) ctx->mainziscan_stage2_27448_total_runtime /
                    (ctx->mainziscan_stage2_27448_runs !=
                     0 ? ctx->mainziscan_stage2_27448_runs : 1),
                    (long) ctx->mainziscan_stage2_27448_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage2_27448_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage2_27448_runs;
        str_builder(&builder,
                    "main.scan_stage3_27347                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_27347_runs,
                    (long) ctx->mainziscan_stage3_27347_total_runtime /
                    (ctx->mainziscan_stage3_27347_runs !=
                     0 ? ctx->mainziscan_stage3_27347_runs : 1),
                    (long) ctx->mainziscan_stage3_27347_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_27347_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_27347_runs;
        str_builder(&builder,
                    "main.scan_stage3_27380                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_27380_runs,
                    (long) ctx->mainziscan_stage3_27380_total_runtime /
                    (ctx->mainziscan_stage3_27380_runs !=
                     0 ? ctx->mainziscan_stage3_27380_runs : 1),
                    (long) ctx->mainziscan_stage3_27380_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_27380_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_27380_runs;
        str_builder(&builder,
                    "main.scan_stage3_27388                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_27388_runs,
                    (long) ctx->mainziscan_stage3_27388_total_runtime /
                    (ctx->mainziscan_stage3_27388_runs !=
                     0 ? ctx->mainziscan_stage3_27388_runs : 1),
                    (long) ctx->mainziscan_stage3_27388_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_27388_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_27388_runs;
        str_builder(&builder,
                    "main.scan_stage3_27396                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_27396_runs,
                    (long) ctx->mainziscan_stage3_27396_total_runtime /
                    (ctx->mainziscan_stage3_27396_runs !=
                     0 ? ctx->mainziscan_stage3_27396_runs : 1),
                    (long) ctx->mainziscan_stage3_27396_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_27396_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_27396_runs;
        str_builder(&builder,
                    "main.scan_stage3_27448                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziscan_stage3_27448_runs,
                    (long) ctx->mainziscan_stage3_27448_total_runtime /
                    (ctx->mainziscan_stage3_27448_runs !=
                     0 ? ctx->mainziscan_stage3_27448_runs : 1),
                    (long) ctx->mainziscan_stage3_27448_total_runtime);
        ctx->total_runtime += ctx->mainziscan_stage3_27448_total_runtime;
        ctx->total_runs += ctx->mainziscan_stage3_27448_runs;
        str_builder(&builder,
                    "main.seghist_global_27365             ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziseghist_global_27365_runs,
                    (long) ctx->mainziseghist_global_27365_total_runtime /
                    (ctx->mainziseghist_global_27365_runs !=
                     0 ? ctx->mainziseghist_global_27365_runs : 1),
                    (long) ctx->mainziseghist_global_27365_total_runtime);
        ctx->total_runtime += ctx->mainziseghist_global_27365_total_runtime;
        ctx->total_runs += ctx->mainziseghist_global_27365_runs;
        str_builder(&builder,
                    "main.seghist_local_27365              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainziseghist_local_27365_runs,
                    (long) ctx->mainziseghist_local_27365_total_runtime /
                    (ctx->mainziseghist_local_27365_runs !=
                     0 ? ctx->mainziseghist_local_27365_runs : 1),
                    (long) ctx->mainziseghist_local_27365_total_runtime);
        ctx->total_runtime += ctx->mainziseghist_local_27365_total_runtime;
        ctx->total_runs += ctx->mainziseghist_local_27365_runs;
        str_builder(&builder,
                    "main.segmap_26568                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_26568_runs,
                    (long) ctx->mainzisegmap_26568_total_runtime /
                    (ctx->mainzisegmap_26568_runs !=
                     0 ? ctx->mainzisegmap_26568_runs : 1),
                    (long) ctx->mainzisegmap_26568_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_26568_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_26568_runs;
        str_builder(&builder,
                    "main.segmap_26717                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_26717_runs,
                    (long) ctx->mainzisegmap_26717_total_runtime /
                    (ctx->mainzisegmap_26717_runs !=
                     0 ? ctx->mainzisegmap_26717_runs : 1),
                    (long) ctx->mainzisegmap_26717_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_26717_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_26717_runs;
        str_builder(&builder,
                    "main.segmap_26992                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_26992_runs,
                    (long) ctx->mainzisegmap_26992_total_runtime /
                    (ctx->mainzisegmap_26992_runs !=
                     0 ? ctx->mainzisegmap_26992_runs : 1),
                    (long) ctx->mainzisegmap_26992_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_26992_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_26992_runs;
        str_builder(&builder,
                    "main.segmap_27090                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_27090_runs,
                    (long) ctx->mainzisegmap_27090_total_runtime /
                    (ctx->mainzisegmap_27090_runs !=
                     0 ? ctx->mainzisegmap_27090_runs : 1),
                    (long) ctx->mainzisegmap_27090_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_27090_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_27090_runs;
        str_builder(&builder,
                    "main.segmap_27154                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_27154_runs,
                    (long) ctx->mainzisegmap_27154_total_runtime /
                    (ctx->mainzisegmap_27154_runs !=
                     0 ? ctx->mainzisegmap_27154_runs : 1),
                    (long) ctx->mainzisegmap_27154_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_27154_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_27154_runs;
        str_builder(&builder,
                    "main.segmap_27450                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_27450_runs,
                    (long) ctx->mainzisegmap_27450_total_runtime /
                    (ctx->mainzisegmap_27450_runs !=
                     0 ? ctx->mainzisegmap_27450_runs : 1),
                    (long) ctx->mainzisegmap_27450_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_27450_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_27450_runs;
        str_builder(&builder,
                    "main.segmap_27488                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_27488_runs,
                    (long) ctx->mainzisegmap_27488_total_runtime /
                    (ctx->mainzisegmap_27488_runs !=
                     0 ? ctx->mainzisegmap_27488_runs : 1),
                    (long) ctx->mainzisegmap_27488_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_27488_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_27488_runs;
        str_builder(&builder,
                    "main.segmap_27513                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegmap_27513_runs,
                    (long) ctx->mainzisegmap_27513_total_runtime /
                    (ctx->mainzisegmap_27513_runs !=
                     0 ? ctx->mainzisegmap_27513_runs : 1),
                    (long) ctx->mainzisegmap_27513_total_runtime);
        ctx->total_runtime += ctx->mainzisegmap_27513_total_runtime;
        ctx->total_runs += ctx->mainzisegmap_27513_runs;
        str_builder(&builder,
                    "main.segred_large_27529               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_large_27529_runs,
                    (long) ctx->mainzisegred_large_27529_total_runtime /
                    (ctx->mainzisegred_large_27529_runs !=
                     0 ? ctx->mainzisegred_large_27529_runs : 1),
                    (long) ctx->mainzisegred_large_27529_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_large_27529_total_runtime;
        ctx->total_runs += ctx->mainzisegred_large_27529_runs;
        str_builder(&builder,
                    "main.segred_large_29153               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_large_29153_runs,
                    (long) ctx->mainzisegred_large_29153_total_runtime /
                    (ctx->mainzisegred_large_29153_runs !=
                     0 ? ctx->mainzisegred_large_29153_runs : 1),
                    (long) ctx->mainzisegred_large_29153_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_large_29153_total_runtime;
        ctx->total_runs += ctx->mainzisegred_large_29153_runs;
        str_builder(&builder,
                    "main.segred_nonseg_26564              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_26564_runs,
                    (long) ctx->mainzisegred_nonseg_26564_total_runtime /
                    (ctx->mainzisegred_nonseg_26564_runs !=
                     0 ? ctx->mainzisegred_nonseg_26564_runs : 1),
                    (long) ctx->mainzisegred_nonseg_26564_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_26564_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_26564_runs;
        str_builder(&builder,
                    "main.segred_nonseg_27357              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_27357_runs,
                    (long) ctx->mainzisegred_nonseg_27357_total_runtime /
                    (ctx->mainzisegred_nonseg_27357_runs !=
                     0 ? ctx->mainzisegred_nonseg_27357_runs : 1),
                    (long) ctx->mainzisegred_nonseg_27357_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_27357_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_27357_runs;
        str_builder(&builder,
                    "main.segred_nonseg_27466              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_27466_runs,
                    (long) ctx->mainzisegred_nonseg_27466_total_runtime /
                    (ctx->mainzisegred_nonseg_27466_runs !=
                     0 ? ctx->mainzisegred_nonseg_27466_runs : 1),
                    (long) ctx->mainzisegred_nonseg_27466_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_27466_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_27466_runs;
        str_builder(&builder,
                    "main.segred_nonseg_27562              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_nonseg_27562_runs,
                    (long) ctx->mainzisegred_nonseg_27562_total_runtime /
                    (ctx->mainzisegred_nonseg_27562_runs !=
                     0 ? ctx->mainzisegred_nonseg_27562_runs : 1),
                    (long) ctx->mainzisegred_nonseg_27562_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_nonseg_27562_total_runtime;
        ctx->total_runs += ctx->mainzisegred_nonseg_27562_runs;
        str_builder(&builder,
                    "main.segred_small_27529               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_small_27529_runs,
                    (long) ctx->mainzisegred_small_27529_total_runtime /
                    (ctx->mainzisegred_small_27529_runs !=
                     0 ? ctx->mainzisegred_small_27529_runs : 1),
                    (long) ctx->mainzisegred_small_27529_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_small_27529_total_runtime;
        ctx->total_runs += ctx->mainzisegred_small_27529_runs;
        str_builder(&builder,
                    "main.segred_small_29153               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mainzisegred_small_29153_runs,
                    (long) ctx->mainzisegred_small_29153_total_runtime /
                    (ctx->mainzisegred_small_29153_runs !=
                     0 ? ctx->mainzisegred_small_29153_runs : 1),
                    (long) ctx->mainzisegred_small_29153_total_runtime);
        ctx->total_runtime += ctx->mainzisegred_small_29153_total_runtime;
        ctx->total_runs += ctx->mainzisegred_small_29153_runs;
        str_builder(&builder,
                    "test.scan_stage1_28395                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage1_28395_runs,
                    (long) ctx->testziscan_stage1_28395_total_runtime /
                    (ctx->testziscan_stage1_28395_runs !=
                     0 ? ctx->testziscan_stage1_28395_runs : 1),
                    (long) ctx->testziscan_stage1_28395_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage1_28395_total_runtime;
        ctx->total_runs += ctx->testziscan_stage1_28395_runs;
        str_builder(&builder,
                    "test.scan_stage1_28428                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage1_28428_runs,
                    (long) ctx->testziscan_stage1_28428_total_runtime /
                    (ctx->testziscan_stage1_28428_runs !=
                     0 ? ctx->testziscan_stage1_28428_runs : 1),
                    (long) ctx->testziscan_stage1_28428_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage1_28428_total_runtime;
        ctx->total_runs += ctx->testziscan_stage1_28428_runs;
        str_builder(&builder,
                    "test.scan_stage1_28436                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage1_28436_runs,
                    (long) ctx->testziscan_stage1_28436_total_runtime /
                    (ctx->testziscan_stage1_28436_runs !=
                     0 ? ctx->testziscan_stage1_28436_runs : 1),
                    (long) ctx->testziscan_stage1_28436_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage1_28436_total_runtime;
        ctx->total_runs += ctx->testziscan_stage1_28436_runs;
        str_builder(&builder,
                    "test.scan_stage1_28444                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage1_28444_runs,
                    (long) ctx->testziscan_stage1_28444_total_runtime /
                    (ctx->testziscan_stage1_28444_runs !=
                     0 ? ctx->testziscan_stage1_28444_runs : 1),
                    (long) ctx->testziscan_stage1_28444_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage1_28444_total_runtime;
        ctx->total_runs += ctx->testziscan_stage1_28444_runs;
        str_builder(&builder,
                    "test.scan_stage1_28496                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage1_28496_runs,
                    (long) ctx->testziscan_stage1_28496_total_runtime /
                    (ctx->testziscan_stage1_28496_runs !=
                     0 ? ctx->testziscan_stage1_28496_runs : 1),
                    (long) ctx->testziscan_stage1_28496_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage1_28496_total_runtime;
        ctx->total_runs += ctx->testziscan_stage1_28496_runs;
        str_builder(&builder,
                    "test.scan_stage2_28395                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage2_28395_runs,
                    (long) ctx->testziscan_stage2_28395_total_runtime /
                    (ctx->testziscan_stage2_28395_runs !=
                     0 ? ctx->testziscan_stage2_28395_runs : 1),
                    (long) ctx->testziscan_stage2_28395_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage2_28395_total_runtime;
        ctx->total_runs += ctx->testziscan_stage2_28395_runs;
        str_builder(&builder,
                    "test.scan_stage2_28428                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage2_28428_runs,
                    (long) ctx->testziscan_stage2_28428_total_runtime /
                    (ctx->testziscan_stage2_28428_runs !=
                     0 ? ctx->testziscan_stage2_28428_runs : 1),
                    (long) ctx->testziscan_stage2_28428_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage2_28428_total_runtime;
        ctx->total_runs += ctx->testziscan_stage2_28428_runs;
        str_builder(&builder,
                    "test.scan_stage2_28436                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage2_28436_runs,
                    (long) ctx->testziscan_stage2_28436_total_runtime /
                    (ctx->testziscan_stage2_28436_runs !=
                     0 ? ctx->testziscan_stage2_28436_runs : 1),
                    (long) ctx->testziscan_stage2_28436_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage2_28436_total_runtime;
        ctx->total_runs += ctx->testziscan_stage2_28436_runs;
        str_builder(&builder,
                    "test.scan_stage2_28444                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage2_28444_runs,
                    (long) ctx->testziscan_stage2_28444_total_runtime /
                    (ctx->testziscan_stage2_28444_runs !=
                     0 ? ctx->testziscan_stage2_28444_runs : 1),
                    (long) ctx->testziscan_stage2_28444_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage2_28444_total_runtime;
        ctx->total_runs += ctx->testziscan_stage2_28444_runs;
        str_builder(&builder,
                    "test.scan_stage2_28496                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage2_28496_runs,
                    (long) ctx->testziscan_stage2_28496_total_runtime /
                    (ctx->testziscan_stage2_28496_runs !=
                     0 ? ctx->testziscan_stage2_28496_runs : 1),
                    (long) ctx->testziscan_stage2_28496_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage2_28496_total_runtime;
        ctx->total_runs += ctx->testziscan_stage2_28496_runs;
        str_builder(&builder,
                    "test.scan_stage3_28395                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage3_28395_runs,
                    (long) ctx->testziscan_stage3_28395_total_runtime /
                    (ctx->testziscan_stage3_28395_runs !=
                     0 ? ctx->testziscan_stage3_28395_runs : 1),
                    (long) ctx->testziscan_stage3_28395_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage3_28395_total_runtime;
        ctx->total_runs += ctx->testziscan_stage3_28395_runs;
        str_builder(&builder,
                    "test.scan_stage3_28428                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage3_28428_runs,
                    (long) ctx->testziscan_stage3_28428_total_runtime /
                    (ctx->testziscan_stage3_28428_runs !=
                     0 ? ctx->testziscan_stage3_28428_runs : 1),
                    (long) ctx->testziscan_stage3_28428_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage3_28428_total_runtime;
        ctx->total_runs += ctx->testziscan_stage3_28428_runs;
        str_builder(&builder,
                    "test.scan_stage3_28436                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage3_28436_runs,
                    (long) ctx->testziscan_stage3_28436_total_runtime /
                    (ctx->testziscan_stage3_28436_runs !=
                     0 ? ctx->testziscan_stage3_28436_runs : 1),
                    (long) ctx->testziscan_stage3_28436_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage3_28436_total_runtime;
        ctx->total_runs += ctx->testziscan_stage3_28436_runs;
        str_builder(&builder,
                    "test.scan_stage3_28444                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage3_28444_runs,
                    (long) ctx->testziscan_stage3_28444_total_runtime /
                    (ctx->testziscan_stage3_28444_runs !=
                     0 ? ctx->testziscan_stage3_28444_runs : 1),
                    (long) ctx->testziscan_stage3_28444_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage3_28444_total_runtime;
        ctx->total_runs += ctx->testziscan_stage3_28444_runs;
        str_builder(&builder,
                    "test.scan_stage3_28496                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziscan_stage3_28496_runs,
                    (long) ctx->testziscan_stage3_28496_total_runtime /
                    (ctx->testziscan_stage3_28496_runs !=
                     0 ? ctx->testziscan_stage3_28496_runs : 1),
                    (long) ctx->testziscan_stage3_28496_total_runtime);
        ctx->total_runtime += ctx->testziscan_stage3_28496_total_runtime;
        ctx->total_runs += ctx->testziscan_stage3_28496_runs;
        str_builder(&builder,
                    "test.seghist_global_28413             ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziseghist_global_28413_runs,
                    (long) ctx->testziseghist_global_28413_total_runtime /
                    (ctx->testziseghist_global_28413_runs !=
                     0 ? ctx->testziseghist_global_28413_runs : 1),
                    (long) ctx->testziseghist_global_28413_total_runtime);
        ctx->total_runtime += ctx->testziseghist_global_28413_total_runtime;
        ctx->total_runs += ctx->testziseghist_global_28413_runs;
        str_builder(&builder,
                    "test.seghist_local_28413              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testziseghist_local_28413_runs,
                    (long) ctx->testziseghist_local_28413_total_runtime /
                    (ctx->testziseghist_local_28413_runs !=
                     0 ? ctx->testziseghist_local_28413_runs : 1),
                    (long) ctx->testziseghist_local_28413_total_runtime);
        ctx->total_runtime += ctx->testziseghist_local_28413_total_runtime;
        ctx->total_runs += ctx->testziseghist_local_28413_runs;
        str_builder(&builder,
                    "test.segmap_27619                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegmap_27619_runs,
                    (long) ctx->testzisegmap_27619_total_runtime /
                    (ctx->testzisegmap_27619_runs !=
                     0 ? ctx->testzisegmap_27619_runs : 1),
                    (long) ctx->testzisegmap_27619_total_runtime);
        ctx->total_runtime += ctx->testzisegmap_27619_total_runtime;
        ctx->total_runs += ctx->testzisegmap_27619_runs;
        str_builder(&builder,
                    "test.segmap_27768                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegmap_27768_runs,
                    (long) ctx->testzisegmap_27768_total_runtime /
                    (ctx->testzisegmap_27768_runs !=
                     0 ? ctx->testzisegmap_27768_runs : 1),
                    (long) ctx->testzisegmap_27768_total_runtime);
        ctx->total_runtime += ctx->testzisegmap_27768_total_runtime;
        ctx->total_runs += ctx->testzisegmap_27768_runs;
        str_builder(&builder,
                    "test.segmap_28043                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegmap_28043_runs,
                    (long) ctx->testzisegmap_28043_total_runtime /
                    (ctx->testzisegmap_28043_runs !=
                     0 ? ctx->testzisegmap_28043_runs : 1),
                    (long) ctx->testzisegmap_28043_total_runtime);
        ctx->total_runtime += ctx->testzisegmap_28043_total_runtime;
        ctx->total_runs += ctx->testzisegmap_28043_runs;
        str_builder(&builder,
                    "test.segmap_28141                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegmap_28141_runs,
                    (long) ctx->testzisegmap_28141_total_runtime /
                    (ctx->testzisegmap_28141_runs !=
                     0 ? ctx->testzisegmap_28141_runs : 1),
                    (long) ctx->testzisegmap_28141_total_runtime);
        ctx->total_runtime += ctx->testzisegmap_28141_total_runtime;
        ctx->total_runs += ctx->testzisegmap_28141_runs;
        str_builder(&builder,
                    "test.segmap_28205                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegmap_28205_runs,
                    (long) ctx->testzisegmap_28205_total_runtime /
                    (ctx->testzisegmap_28205_runs !=
                     0 ? ctx->testzisegmap_28205_runs : 1),
                    (long) ctx->testzisegmap_28205_total_runtime);
        ctx->total_runtime += ctx->testzisegmap_28205_total_runtime;
        ctx->total_runs += ctx->testzisegmap_28205_runs;
        str_builder(&builder,
                    "test.segmap_28498                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegmap_28498_runs,
                    (long) ctx->testzisegmap_28498_total_runtime /
                    (ctx->testzisegmap_28498_runs !=
                     0 ? ctx->testzisegmap_28498_runs : 1),
                    (long) ctx->testzisegmap_28498_total_runtime);
        ctx->total_runtime += ctx->testzisegmap_28498_total_runtime;
        ctx->total_runs += ctx->testzisegmap_28498_runs;
        str_builder(&builder,
                    "test.segmap_28536                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegmap_28536_runs,
                    (long) ctx->testzisegmap_28536_total_runtime /
                    (ctx->testzisegmap_28536_runs !=
                     0 ? ctx->testzisegmap_28536_runs : 1),
                    (long) ctx->testzisegmap_28536_total_runtime);
        ctx->total_runtime += ctx->testzisegmap_28536_total_runtime;
        ctx->total_runs += ctx->testzisegmap_28536_runs;
        str_builder(&builder,
                    "test.segmap_28561                     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegmap_28561_runs,
                    (long) ctx->testzisegmap_28561_total_runtime /
                    (ctx->testzisegmap_28561_runs !=
                     0 ? ctx->testzisegmap_28561_runs : 1),
                    (long) ctx->testzisegmap_28561_total_runtime);
        ctx->total_runtime += ctx->testzisegmap_28561_total_runtime;
        ctx->total_runs += ctx->testzisegmap_28561_runs;
        str_builder(&builder,
                    "test.segred_large_28577               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegred_large_28577_runs,
                    (long) ctx->testzisegred_large_28577_total_runtime /
                    (ctx->testzisegred_large_28577_runs !=
                     0 ? ctx->testzisegred_large_28577_runs : 1),
                    (long) ctx->testzisegred_large_28577_total_runtime);
        ctx->total_runtime += ctx->testzisegred_large_28577_total_runtime;
        ctx->total_runs += ctx->testzisegred_large_28577_runs;
        str_builder(&builder,
                    "test.segred_large_29153               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegred_large_29153_runs,
                    (long) ctx->testzisegred_large_29153_total_runtime /
                    (ctx->testzisegred_large_29153_runs !=
                     0 ? ctx->testzisegred_large_29153_runs : 1),
                    (long) ctx->testzisegred_large_29153_total_runtime);
        ctx->total_runtime += ctx->testzisegred_large_29153_total_runtime;
        ctx->total_runs += ctx->testzisegred_large_29153_runs;
        str_builder(&builder,
                    "test.segred_nonseg_27615              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegred_nonseg_27615_runs,
                    (long) ctx->testzisegred_nonseg_27615_total_runtime /
                    (ctx->testzisegred_nonseg_27615_runs !=
                     0 ? ctx->testzisegred_nonseg_27615_runs : 1),
                    (long) ctx->testzisegred_nonseg_27615_total_runtime);
        ctx->total_runtime += ctx->testzisegred_nonseg_27615_total_runtime;
        ctx->total_runs += ctx->testzisegred_nonseg_27615_runs;
        str_builder(&builder,
                    "test.segred_nonseg_28405              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegred_nonseg_28405_runs,
                    (long) ctx->testzisegred_nonseg_28405_total_runtime /
                    (ctx->testzisegred_nonseg_28405_runs !=
                     0 ? ctx->testzisegred_nonseg_28405_runs : 1),
                    (long) ctx->testzisegred_nonseg_28405_total_runtime);
        ctx->total_runtime += ctx->testzisegred_nonseg_28405_total_runtime;
        ctx->total_runs += ctx->testzisegred_nonseg_28405_runs;
        str_builder(&builder,
                    "test.segred_nonseg_28514              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegred_nonseg_28514_runs,
                    (long) ctx->testzisegred_nonseg_28514_total_runtime /
                    (ctx->testzisegred_nonseg_28514_runs !=
                     0 ? ctx->testzisegred_nonseg_28514_runs : 1),
                    (long) ctx->testzisegred_nonseg_28514_total_runtime);
        ctx->total_runtime += ctx->testzisegred_nonseg_28514_total_runtime;
        ctx->total_runs += ctx->testzisegred_nonseg_28514_runs;
        str_builder(&builder,
                    "test.segred_nonseg_28610              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegred_nonseg_28610_runs,
                    (long) ctx->testzisegred_nonseg_28610_total_runtime /
                    (ctx->testzisegred_nonseg_28610_runs !=
                     0 ? ctx->testzisegred_nonseg_28610_runs : 1),
                    (long) ctx->testzisegred_nonseg_28610_total_runtime);
        ctx->total_runtime += ctx->testzisegred_nonseg_28610_total_runtime;
        ctx->total_runs += ctx->testzisegred_nonseg_28610_runs;
        str_builder(&builder,
                    "test.segred_small_28577               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegred_small_28577_runs,
                    (long) ctx->testzisegred_small_28577_total_runtime /
                    (ctx->testzisegred_small_28577_runs !=
                     0 ? ctx->testzisegred_small_28577_runs : 1),
                    (long) ctx->testzisegred_small_28577_total_runtime);
        ctx->total_runtime += ctx->testzisegred_small_28577_total_runtime;
        ctx->total_runs += ctx->testzisegred_small_28577_runs;
        str_builder(&builder,
                    "test.segred_small_29153               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->testzisegred_small_29153_runs,
                    (long) ctx->testzisegred_small_29153_total_runtime /
                    (ctx->testzisegred_small_29153_runs !=
                     0 ? ctx->testzisegred_small_29153_runs : 1),
                    (long) ctx->testzisegred_small_29153_total_runtime);
        ctx->total_runtime += ctx->testzisegred_small_29153_total_runtime;
        ctx->total_runs += ctx->testzisegred_small_29153_runs;
        str_builder(&builder, "%d operations with cumulative runtime: %6ldus\n",
                    ctx->total_runs, ctx->total_runtime);
    }
    return builder.str;
}
char *futhark_context_get_error(struct futhark_context *ctx)
{
    char *error = ctx->error;
    
    ctx->error = NULL;
    return error;
}
void futhark_context_pause_profiling(struct futhark_context *ctx)
{
    ctx->profiling_paused = 1;
}
void futhark_context_unpause_profiling(struct futhark_context *ctx)
{
    ctx->profiling_paused = 0;
}
static int futrts_builtinzhgpu_map_transpose_f32(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6);
static int futrts_builtinzhreplicate_f32(struct futhark_context *ctx,
                                         struct memblock_device mem_29466,
                                         int32_t num_elems_29467,
                                         float val_29468);
static int futrts_builtinzhreplicate_i64(struct futhark_context *ctx,
                                         struct memblock_device mem_29058,
                                         int32_t num_elems_29059,
                                         int64_t val_29060);
static int futrts_main(struct futhark_context *ctx, float *out_scalar_out_29644,
                       struct memblock_device *out_mem_p_29645,
                       int64_t *out_out_arrsizze_29646,
                       struct memblock_device swap_term_mem_28728,
                       struct memblock_device payments_mem_28729,
                       struct memblock_device notional_mem_28730,
                       int64_t n_25421, int64_t n_25422, int64_t n_25423,
                       int64_t paths_25424, int64_t steps_25425, float a_25429,
                       float b_25430, float sigma_25431, float r0_25432);
static int futrts_test(struct futhark_context *ctx, float *out_scalar_out_29825,
                       int64_t paths_26128, int64_t steps_26129);
int init_constants(struct futhark_context *ctx)
{
    (void) ctx;
    
    int err = 0;
    
    
  cleanup:
    return err;
}
int free_constants(struct futhark_context *ctx)
{
    (void) ctx;
    return 0;
}
static int futrts_builtinzhgpu_map_transpose_f32(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6)
{
    (void) ctx;
    
    int err = 0;
    
    if (!(num_arrays_4 == 0 || (x_elems_5 == 0 || y_elems_6 == 0))) {
        int32_t muly_8 = squot32(16, x_elems_5);
        int32_t mulx_7 = squot32(16, y_elems_6);
        
        if (num_arrays_4 == 1 && (x_elems_5 == 1 || y_elems_6 == 1)) {
            if (sext_i32_i64(x_elems_5 * y_elems_6 * (int32_t) sizeof(float)) >
                0) {
                OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                             srcmem_2.mem,
                                                             destmem_0.mem,
                                                             sext_i32_i64(srcoffset_3),
                                                             sext_i32_i64(destoffset_1),
                                                             sext_i32_i64(x_elems_5 *
                                                             y_elems_6 *
                                                             (int32_t) sizeof(float)),
                                                             0, NULL,
                                                             ctx->profiling_paused ||
                                                             !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                       &ctx->copy_dev_to_dev_runs,
                                                                                                       &ctx->copy_dev_to_dev_total_runtime)));
                if (ctx->debugging)
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            }
        } else {
            if (sle32(x_elems_5, 8) && slt32(16, y_elems_6)) {
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        0, 1088, NULL));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        1, sizeof(destoffset_1),
                                                        &destoffset_1));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        2, sizeof(srcoffset_3),
                                                        &srcoffset_3));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        3, sizeof(num_arrays_4),
                                                        &num_arrays_4));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        4, sizeof(x_elems_5),
                                                        &x_elems_5));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        5, sizeof(y_elems_6),
                                                        &y_elems_6));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        6, sizeof(mulx_7),
                                                        &mulx_7));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        7, sizeof(muly_8),
                                                        &muly_8));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        8,
                                                        sizeof(destmem_0.mem),
                                                        &destmem_0.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_width,
                                                        9, sizeof(srcmem_2.mem),
                                                        &srcmem_2.mem));
                if (1 * ((size_t) sdiv_up32(x_elems_5, 16) * (size_t) 16) *
                    ((size_t) sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16) *
                     (size_t) 16) * ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                    const size_t global_work_sizze_29614[3] =
                                 {(size_t) sdiv_up32(x_elems_5, 16) *
                                  (size_t) 16,
                                  (size_t) sdiv_up32(sdiv_up32(y_elems_6,
                                                               muly_8), 16) *
                                  (size_t) 16, (size_t) num_arrays_4 *
                                  (size_t) 1};
                    const size_t local_work_sizze_29618[3] = {16, 16, 1};
                    int64_t time_start_29615 = 0, time_end_29616 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "gpu_map_transpose_f32_low_width");
                        fprintf(stderr, "%zu", global_work_sizze_29614[0]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", global_work_sizze_29614[1]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", global_work_sizze_29614[2]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_29618[0]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", local_work_sizze_29618[1]);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%zu", local_work_sizze_29618[2]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) (0 + 1088));
                        time_start_29615 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->gpu_map_transpose_f32_low_width,
                                                                    3, NULL,
                                                                    global_work_sizze_29614,
                                                                    local_work_sizze_29618,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->gpu_map_transpose_f32_low_width_runs,
                                                                                                              &ctx->gpu_map_transpose_f32_low_width_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_29616 = get_wall_time();
                        
                        long time_diff_29617 = time_end_29616 -
                             time_start_29615;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "gpu_map_transpose_f32_low_width",
                                time_diff_29617);
                    }
                }
            } else {
                if (sle32(y_elems_6, 8) && slt32(16, x_elems_5)) {
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            0, 1088, NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            1,
                                                            sizeof(destoffset_1),
                                                            &destoffset_1));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            2,
                                                            sizeof(srcoffset_3),
                                                            &srcoffset_3));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            3,
                                                            sizeof(num_arrays_4),
                                                            &num_arrays_4));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            4,
                                                            sizeof(x_elems_5),
                                                            &x_elems_5));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            5,
                                                            sizeof(y_elems_6),
                                                            &y_elems_6));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            6, sizeof(mulx_7),
                                                            &mulx_7));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            7, sizeof(muly_8),
                                                            &muly_8));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            8,
                                                            sizeof(destmem_0.mem),
                                                            &destmem_0.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_low_height,
                                                            9,
                                                            sizeof(srcmem_2.mem),
                                                            &srcmem_2.mem));
                    if (1 * ((size_t) sdiv_up32(sdiv_up32(x_elems_5, mulx_7),
                                                16) * (size_t) 16) *
                        ((size_t) sdiv_up32(y_elems_6, 16) * (size_t) 16) *
                        ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                        const size_t global_work_sizze_29619[3] =
                                     {(size_t) sdiv_up32(sdiv_up32(x_elems_5,
                                                                   mulx_7),
                                                         16) * (size_t) 16,
                                      (size_t) sdiv_up32(y_elems_6, 16) *
                                      (size_t) 16, (size_t) num_arrays_4 *
                                      (size_t) 1};
                        const size_t local_work_sizze_29623[3] = {16, 16, 1};
                        int64_t time_start_29620 = 0, time_end_29621 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "gpu_map_transpose_f32_low_height");
                            fprintf(stderr, "%zu", global_work_sizze_29619[0]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", global_work_sizze_29619[1]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", global_work_sizze_29619[2]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29623[0]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", local_work_sizze_29623[1]);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%zu", local_work_sizze_29623[2]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + 1088));
                            time_start_29620 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->gpu_map_transpose_f32_low_height,
                                                                        3, NULL,
                                                                        global_work_sizze_29619,
                                                                        local_work_sizze_29623,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->gpu_map_transpose_f32_low_height_runs,
                                                                                                                  &ctx->gpu_map_transpose_f32_low_height_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29621 = get_wall_time();
                            
                            long time_diff_29622 = time_end_29621 -
                                 time_start_29620;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "gpu_map_transpose_f32_low_height",
                                    time_diff_29622);
                        }
                    }
                } else {
                    if (sle32(x_elems_5, 8) && sle32(y_elems_6, 8)) {
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                0, 1, NULL));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                1,
                                                                sizeof(destoffset_1),
                                                                &destoffset_1));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                2,
                                                                sizeof(srcoffset_3),
                                                                &srcoffset_3));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                3,
                                                                sizeof(num_arrays_4),
                                                                &num_arrays_4));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                4,
                                                                sizeof(x_elems_5),
                                                                &x_elems_5));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                5,
                                                                sizeof(y_elems_6),
                                                                &y_elems_6));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                6,
                                                                sizeof(mulx_7),
                                                                &mulx_7));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                7,
                                                                sizeof(muly_8),
                                                                &muly_8));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                8,
                                                                sizeof(destmem_0.mem),
                                                                &destmem_0.mem));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32_small,
                                                                9,
                                                                sizeof(srcmem_2.mem),
                                                                &srcmem_2.mem));
                        if (1 * ((size_t) sdiv_up32(num_arrays_4 * x_elems_5 *
                                                    y_elems_6, 256) *
                                 (size_t) 256) != 0) {
                            const size_t global_work_sizze_29624[1] =
                                         {(size_t) sdiv_up32(num_arrays_4 *
                                                             x_elems_5 *
                                                             y_elems_6, 256) *
                                         (size_t) 256};
                            const size_t local_work_sizze_29628[1] = {256};
                            int64_t time_start_29625 = 0, time_end_29626 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr,
                                        "Launching %s with global work size [",
                                        "gpu_map_transpose_f32_small");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_29624[0]);
                                fprintf(stderr, "] and local work size [");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_29628[0]);
                                fprintf(stderr,
                                        "]; local memory parameters sum to %d bytes.\n",
                                        (int) (0 + 1));
                                time_start_29625 = get_wall_time();
                            }
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                            ctx->gpu_map_transpose_f32_small,
                                                                            1,
                                                                            NULL,
                                                                            global_work_sizze_29624,
                                                                            local_work_sizze_29628,
                                                                            0,
                                                                            NULL,
                                                                            ctx->profiling_paused ||
                                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                      &ctx->gpu_map_transpose_f32_small_runs,
                                                                                                                      &ctx->gpu_map_transpose_f32_small_total_runtime)));
                            if (ctx->debugging) {
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                                time_end_29626 = get_wall_time();
                                
                                long time_diff_29627 = time_end_29626 -
                                     time_start_29625;
                                
                                fprintf(stderr, "kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_f32_small",
                                        time_diff_29627);
                            }
                        }
                    } else {
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                0, 4224, NULL));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                1,
                                                                sizeof(destoffset_1),
                                                                &destoffset_1));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                2,
                                                                sizeof(srcoffset_3),
                                                                &srcoffset_3));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                3,
                                                                sizeof(num_arrays_4),
                                                                &num_arrays_4));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                4,
                                                                sizeof(x_elems_5),
                                                                &x_elems_5));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                5,
                                                                sizeof(y_elems_6),
                                                                &y_elems_6));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                6,
                                                                sizeof(mulx_7),
                                                                &mulx_7));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                7,
                                                                sizeof(muly_8),
                                                                &muly_8));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                8,
                                                                sizeof(destmem_0.mem),
                                                                &destmem_0.mem));
                        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->gpu_map_transpose_f32,
                                                                9,
                                                                sizeof(srcmem_2.mem),
                                                                &srcmem_2.mem));
                        if (1 * ((size_t) sdiv_up32(x_elems_5, 32) *
                                 (size_t) 32) * ((size_t) sdiv_up32(y_elems_6,
                                                                    32) *
                                                 (size_t) 8) *
                            ((size_t) num_arrays_4 * (size_t) 1) != 0) {
                            const size_t global_work_sizze_29629[3] =
                                         {(size_t) sdiv_up32(x_elems_5, 32) *
                                          (size_t) 32,
                                          (size_t) sdiv_up32(y_elems_6, 32) *
                                          (size_t) 8, (size_t) num_arrays_4 *
                                          (size_t) 1};
                            const size_t local_work_sizze_29633[3] = {32, 8, 1};
                            int64_t time_start_29630 = 0, time_end_29631 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr,
                                        "Launching %s with global work size [",
                                        "gpu_map_transpose_f32");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_29629[0]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_29629[1]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        global_work_sizze_29629[2]);
                                fprintf(stderr, "] and local work size [");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_29633[0]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_29633[1]);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%zu",
                                        local_work_sizze_29633[2]);
                                fprintf(stderr,
                                        "]; local memory parameters sum to %d bytes.\n",
                                        (int) (0 + 4224));
                                time_start_29630 = get_wall_time();
                            }
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                            ctx->gpu_map_transpose_f32,
                                                                            3,
                                                                            NULL,
                                                                            global_work_sizze_29629,
                                                                            local_work_sizze_29633,
                                                                            0,
                                                                            NULL,
                                                                            ctx->profiling_paused ||
                                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                      &ctx->gpu_map_transpose_f32_runs,
                                                                                                                      &ctx->gpu_map_transpose_f32_total_runtime)));
                            if (ctx->debugging) {
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                                time_end_29631 = get_wall_time();
                                
                                long time_diff_29632 = time_end_29631 -
                                     time_start_29630;
                                
                                fprintf(stderr, "kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_f32",
                                        time_diff_29632);
                            }
                        }
                    }
                }
            }
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhreplicate_f32(struct futhark_context *ctx,
                                         struct memblock_device mem_29466,
                                         int32_t num_elems_29467,
                                         float val_29468)
{
    (void) ctx;
    
    int err = 0;
    int64_t group_sizze_29473;
    
    group_sizze_29473 = ctx->sizes.builtinzhreplicate_f32zigroup_sizze_29473;
    
    int64_t num_groups_29474;
    
    num_groups_29474 = sdiv_up64(num_elems_29467, group_sizze_29473);
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_f32zireplicate_29470,
                                            0, sizeof(mem_29466.mem),
                                            &mem_29466.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_f32zireplicate_29470,
                                            1, sizeof(num_elems_29467),
                                            &num_elems_29467));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_f32zireplicate_29470,
                                            2, sizeof(val_29468), &val_29468));
    if (1 * ((size_t) num_groups_29474 * (size_t) group_sizze_29473) != 0) {
        const size_t global_work_sizze_29634[1] = {(size_t) num_groups_29474 *
                     (size_t) group_sizze_29473};
        const size_t local_work_sizze_29638[1] = {group_sizze_29473};
        int64_t time_start_29635 = 0, time_end_29636 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "builtin#replicate_f32.replicate_29470");
            fprintf(stderr, "%zu", global_work_sizze_29634[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_29638[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_29635 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->builtinzhreplicate_f32zireplicate_29470,
                                                        1, NULL,
                                                        global_work_sizze_29634,
                                                        local_work_sizze_29638,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->builtinzhreplicate_f32zireplicate_29470_runs,
                                                                                                  &ctx->builtinzhreplicate_f32zireplicate_29470_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_29636 = get_wall_time();
            
            long time_diff_29637 = time_end_29636 - time_start_29635;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n",
                    "builtin#replicate_f32.replicate_29470", time_diff_29637);
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhreplicate_i64(struct futhark_context *ctx,
                                         struct memblock_device mem_29058,
                                         int32_t num_elems_29059,
                                         int64_t val_29060)
{
    (void) ctx;
    
    int err = 0;
    int64_t group_sizze_29065;
    
    group_sizze_29065 = ctx->sizes.builtinzhreplicate_i64zigroup_sizze_29065;
    
    int64_t num_groups_29066;
    
    num_groups_29066 = sdiv_up64(num_elems_29059, group_sizze_29065);
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_i64zireplicate_29062,
                                            0, sizeof(mem_29058.mem),
                                            &mem_29058.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_i64zireplicate_29062,
                                            1, sizeof(num_elems_29059),
                                            &num_elems_29059));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->builtinzhreplicate_i64zireplicate_29062,
                                            2, sizeof(val_29060), &val_29060));
    if (1 * ((size_t) num_groups_29066 * (size_t) group_sizze_29065) != 0) {
        const size_t global_work_sizze_29639[1] = {(size_t) num_groups_29066 *
                     (size_t) group_sizze_29065};
        const size_t local_work_sizze_29643[1] = {group_sizze_29065};
        int64_t time_start_29640 = 0, time_end_29641 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "builtin#replicate_i64.replicate_29062");
            fprintf(stderr, "%zu", global_work_sizze_29639[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_29643[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_29640 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->builtinzhreplicate_i64zireplicate_29062,
                                                        1, NULL,
                                                        global_work_sizze_29639,
                                                        local_work_sizze_29643,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->builtinzhreplicate_i64zireplicate_29062_runs,
                                                                                                  &ctx->builtinzhreplicate_i64zireplicate_29062_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_29641 = get_wall_time();
            
            long time_diff_29642 = time_end_29641 - time_start_29640;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n",
                    "builtin#replicate_i64.replicate_29062", time_diff_29642);
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_main(struct futhark_context *ctx, float *out_scalar_out_29644,
                       struct memblock_device *out_mem_p_29645,
                       int64_t *out_out_arrsizze_29646,
                       struct memblock_device swap_term_mem_28728,
                       struct memblock_device payments_mem_28729,
                       struct memblock_device notional_mem_28730,
                       int64_t n_25421, int64_t n_25422, int64_t n_25423,
                       int64_t paths_25424, int64_t steps_25425, float a_25429,
                       float b_25430, float sigma_25431, float r0_25432)
{
    (void) ctx;
    
    int err = 0;
    float scalar_out_28901;
    struct memblock_device out_mem_28902;
    
    out_mem_28902.references = NULL;
    
    int64_t out_arrsizze_28903;
    bool dim_match_25433 = n_25421 == n_25422;
    bool empty_or_match_cert_25434;
    
    if (!dim_match_25433) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  cva.fut:101:1-145:20\n");
        if (memblock_unref_device(ctx, &out_mem_28902, "out_mem_28902") != 0)
            return 1;
        return 1;
    }
    
    int64_t segred_group_sizze_26557;
    
    segred_group_sizze_26557 = ctx->sizes.mainzisegred_group_sizze_26556;
    
    int64_t num_groups_26559;
    int32_t max_num_groups_28904;
    
    max_num_groups_28904 = ctx->sizes.mainzisegred_num_groups_26558;
    num_groups_26559 = sext_i64_i32(smax64(1, smin64(sdiv_up64(n_25421,
                                                               sext_i32_i64(segred_group_sizze_26557)),
                                                     sext_i32_i64(max_num_groups_28904))));
    
    struct memblock_device mem_28733;
    
    mem_28733.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28733, 4, "mem_28733")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mainzicounter_mem_28905 =
                           ctx->mainzicounter_mem_28905;
    struct memblock_device group_res_arr_mem_28907;
    
    group_res_arr_mem_28907.references = NULL;
    if (memblock_alloc_device(ctx, &group_res_arr_mem_28907,
                              (int32_t) sizeof(float) *
                              (segred_group_sizze_26557 * num_groups_26559),
                              "group_res_arr_mem_28907")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_threads_28909;
    
    num_threads_28909 = num_groups_26559 * segred_group_sizze_26557;
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegRed");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 1,
                                            (int32_t) sizeof(float) *
                                            segred_group_sizze_26557, NULL));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 2,
                                            (int32_t) sizeof(bool), NULL));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 3,
                                            sizeof(n_25421), &n_25421));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 4,
                                            sizeof(num_groups_26559),
                                            &num_groups_26559));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 5,
                                            sizeof(swap_term_mem_28728.mem),
                                            &swap_term_mem_28728.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 6,
                                            sizeof(payments_mem_28729.mem),
                                            &payments_mem_28729.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 7,
                                            sizeof(mem_28733.mem),
                                            &mem_28733.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 8,
                                            sizeof(mainzicounter_mem_28905.mem),
                                            &mainzicounter_mem_28905.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 9,
                                            sizeof(group_res_arr_mem_28907.mem),
                                            &group_res_arr_mem_28907.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_26564, 10,
                                            sizeof(num_threads_28909),
                                            &num_threads_28909));
    if (1 * ((size_t) num_groups_26559 * (size_t) segred_group_sizze_26557) !=
        0) {
        const size_t global_work_sizze_29648[1] = {(size_t) num_groups_26559 *
                     (size_t) segred_group_sizze_26557};
        const size_t local_work_sizze_29652[1] = {segred_group_sizze_26557};
        int64_t time_start_29649 = 0, time_end_29650 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "main.segred_nonseg_26564");
            fprintf(stderr, "%zu", global_work_sizze_29648[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_29652[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) (0 + (int32_t) sizeof(float) *
                           segred_group_sizze_26557 + (int32_t) sizeof(bool)));
            time_start_29649 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->mainzisegred_nonseg_26564,
                                                        1, NULL,
                                                        global_work_sizze_29648,
                                                        local_work_sizze_29652,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->mainzisegred_nonseg_26564_runs,
                                                                                                  &ctx->mainzisegred_nonseg_26564_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_29650 = get_wall_time();
            
            long time_diff_29651 = time_end_29650 - time_start_29649;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n",
                    "main.segred_nonseg_26564", time_diff_29651);
        }
    }
    
    float read_res_29653;
    
    OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                 mem_28733.mem,
                                                 ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                 0 * sizeof(float),
                                                 sizeof(float), &read_res_29653,
                                                 0, NULL,
                                                 ctx->profiling_paused ||
                                                 !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                           &ctx->copy_scalar_from_dev_runs,
                                                                                           &ctx->copy_scalar_from_dev_total_runtime)));
    if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
        return 1;
    
    float res_25438 = read_res_29653;
    
    if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
        return 1;
    
    float res_25446 = sitofp_i64_f32(steps_25425);
    float dt_25447 = res_25438 / res_25446;
    float x_25449 = fpow32(a_25429, 2.0F);
    float x_25450 = b_25430 * x_25449;
    float x_25451 = fpow32(sigma_25431, 2.0F);
    float y_25452 = x_25451 / 2.0F;
    float y_25453 = x_25450 - y_25452;
    float y_25454 = 4.0F * a_25429;
    bool suff_outer_par_26566;
    
    suff_outer_par_26566 = ctx->sizes.mainzisuff_outer_par_0 <= n_25421;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_outer_par_0",
                n_25421);
    
    int64_t segmap_group_sizze_26634;
    
    segmap_group_sizze_26634 = ctx->sizes.mainzisegmap_group_sizze_26570;
    
    int64_t segmap_group_sizze_26783;
    
    segmap_group_sizze_26783 = ctx->sizes.mainzisegmap_group_sizze_26719;
    
    int64_t bytes_28734 = 4 * n_25421;
    int64_t bytes_28736 = 8 * n_25421;
    struct memblock_device res_mem_28752;
    
    res_mem_28752.references = NULL;
    
    struct memblock_device res_mem_28753;
    
    res_mem_28753.references = NULL;
    
    struct memblock_device res_mem_28754;
    
    res_mem_28754.references = NULL;
    
    struct memblock_device res_mem_28755;
    
    res_mem_28755.references = NULL;
    
    int32_t local_memory_capacity_28947;
    
    local_memory_capacity_28947 = ctx->opencl.max_local_memory;
    if (sle64(0, sext_i32_i64(local_memory_capacity_28947)) &&
        suff_outer_par_26566) {
        int64_t segmap_usable_groups_26635 = sdiv_up64(n_25421,
                                                       segmap_group_sizze_26634);
        struct memblock_device mem_28735;
        
        mem_28735.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28735, bytes_28734, "mem_28735")) {
            err = 1;
            goto cleanup;
        }
        if (n_25421 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         swap_term_mem_28728.mem,
                                                         mem_28735.mem, 0, 0,
                                                         n_25421 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28737;
        
        mem_28737.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28737, bytes_28736, "mem_28737")) {
            err = 1;
            goto cleanup;
        }
        if (n_25421 * (int32_t) sizeof(int64_t) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         payments_mem_28729.mem,
                                                         mem_28737.mem, 0, 0,
                                                         n_25421 *
                                                         (int32_t) sizeof(int64_t),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28739;
        
        mem_28739.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28739, bytes_28734, "mem_28739")) {
            err = 1;
            goto cleanup;
        }
        if (n_25421 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         notional_mem_28730.mem,
                                                         mem_28739.mem, 0, 0,
                                                         n_25421 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28742;
        
        mem_28742.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28742, bytes_28734, "mem_28742")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 3,
                                                sizeof(n_25421), &n_25421));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 4,
                                                sizeof(a_25429), &a_25429));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 5,
                                                sizeof(r0_25432), &r0_25432));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 6,
                                                sizeof(x_25449), &x_25449));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 7,
                                                sizeof(x_25451), &x_25451));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 8,
                                                sizeof(y_25453), &y_25453));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 9,
                                                sizeof(y_25454), &y_25454));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 10,
                                                sizeof(swap_term_mem_28728.mem),
                                                &swap_term_mem_28728.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 11,
                                                sizeof(payments_mem_28729.mem),
                                                &payments_mem_28729.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26568, 12,
                                                sizeof(mem_28742.mem),
                                                &mem_28742.mem));
        if (1 * ((size_t) segmap_usable_groups_26635 *
                 (size_t) segmap_group_sizze_26634) != 0) {
            const size_t global_work_sizze_29654[1] =
                         {(size_t) segmap_usable_groups_26635 *
                         (size_t) segmap_group_sizze_26634};
            const size_t local_work_sizze_29658[1] = {segmap_group_sizze_26634};
            int64_t time_start_29655 = 0, time_end_29656 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_26568");
                fprintf(stderr, "%zu", global_work_sizze_29654[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_29658[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_29655 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_26568,
                                                            1, NULL,
                                                            global_work_sizze_29654,
                                                            local_work_sizze_29658,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_26568_runs,
                                                                                                      &ctx->mainzisegmap_26568_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_29656 = get_wall_time();
                
                long time_diff_29657 = time_end_29656 - time_start_29655;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_26568", time_diff_29657);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_set_device(ctx, &res_mem_28752, &mem_28742, "mem_28742") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28753, &mem_28739, "mem_28739") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28754, &mem_28737, "mem_28737") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28755, &mem_28735, "mem_28735") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28742, "mem_28742") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28739, "mem_28739") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28737, "mem_28737") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28735, "mem_28735") != 0)
            return 1;
    } else {
        int64_t segmap_usable_groups_26784 = sdiv_up64(n_25421,
                                                       segmap_group_sizze_26783);
        struct memblock_device mem_28744;
        
        mem_28744.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28744, bytes_28734, "mem_28744")) {
            err = 1;
            goto cleanup;
        }
        if (n_25421 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         swap_term_mem_28728.mem,
                                                         mem_28744.mem, 0, 0,
                                                         n_25421 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28746;
        
        mem_28746.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28746, bytes_28736, "mem_28746")) {
            err = 1;
            goto cleanup;
        }
        if (n_25421 * (int32_t) sizeof(int64_t) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         payments_mem_28729.mem,
                                                         mem_28746.mem, 0, 0,
                                                         n_25421 *
                                                         (int32_t) sizeof(int64_t),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28748;
        
        mem_28748.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28748, bytes_28734, "mem_28748")) {
            err = 1;
            goto cleanup;
        }
        if (n_25421 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         notional_mem_28730.mem,
                                                         mem_28748.mem, 0, 0,
                                                         n_25421 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28751;
        
        mem_28751.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28751, bytes_28734, "mem_28751")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 3,
                                                sizeof(n_25421), &n_25421));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 4,
                                                sizeof(a_25429), &a_25429));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 5,
                                                sizeof(r0_25432), &r0_25432));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 6,
                                                sizeof(x_25449), &x_25449));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 7,
                                                sizeof(x_25451), &x_25451));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 8,
                                                sizeof(y_25453), &y_25453));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 9,
                                                sizeof(y_25454), &y_25454));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 10,
                                                sizeof(swap_term_mem_28728.mem),
                                                &swap_term_mem_28728.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 11,
                                                sizeof(payments_mem_28729.mem),
                                                &payments_mem_28729.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26717, 12,
                                                sizeof(mem_28751.mem),
                                                &mem_28751.mem));
        if (1 * ((size_t) segmap_usable_groups_26784 *
                 (size_t) segmap_group_sizze_26783) != 0) {
            const size_t global_work_sizze_29659[1] =
                         {(size_t) segmap_usable_groups_26784 *
                         (size_t) segmap_group_sizze_26783};
            const size_t local_work_sizze_29663[1] = {segmap_group_sizze_26783};
            int64_t time_start_29660 = 0, time_end_29661 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_26717");
                fprintf(stderr, "%zu", global_work_sizze_29659[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_29663[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_29660 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_26717,
                                                            1, NULL,
                                                            global_work_sizze_29659,
                                                            local_work_sizze_29663,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_26717_runs,
                                                                                                      &ctx->mainzisegmap_26717_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_29661 = get_wall_time();
                
                long time_diff_29662 = time_end_29661 - time_start_29660;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_26717", time_diff_29662);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_set_device(ctx, &res_mem_28752, &mem_28751, "mem_28751") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28753, &mem_28748, "mem_28748") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28754, &mem_28746, "mem_28746") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28755, &mem_28744, "mem_28744") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28751, "mem_28751") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28748, "mem_28748") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28746, "mem_28746") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28744, "mem_28744") != 0)
            return 1;
    }
    
    float sims_per_year_25519 = res_25446 / res_25438;
    bool bounds_invalid_upwards_25520 = slt64(steps_25425, 1);
    bool valid_25521 = !bounds_invalid_upwards_25520;
    bool range_valid_c_25522;
    
    if (!valid_25521) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 1, "..", 2, "...", steps_25425,
                               " is invalid.",
                               "-> #0  cva.fut:60:56-67\n   #1  cva.fut:112:17-44\n   #2  cva.fut:101:1-145:20\n");
        if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28754, "res_mem_28754") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28753, "res_mem_28753") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28752, "res_mem_28752") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_28907,
                                  "group_res_arr_mem_28907") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_28902, "out_mem_28902") != 0)
            return 1;
        return 1;
    }
    
    bool bounds_invalid_upwards_25528 = slt64(paths_25424, 0);
    bool valid_25529 = !bounds_invalid_upwards_25528;
    bool range_valid_c_25530;
    
    if (!valid_25529) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", paths_25424,
                               " is invalid.",
                               "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:126:11-16\n   #2  lib/github.com/diku-dk/cpprandom/random.fut:174:8-56\n   #3  cva.fut:115:19-49\n   #4  cva.fut:101:1-145:20\n");
        if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28754, "res_mem_28754") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28753, "res_mem_28753") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28752, "res_mem_28752") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_28907,
                                  "group_res_arr_mem_28907") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_28902, "out_mem_28902") != 0)
            return 1;
        return 1;
    }
    
    int64_t upper_bound_25533 = sub64(steps_25425, 1);
    float res_25534;
    
    res_25534 = futrts_sqrt32(dt_25447);
    
    int64_t segmap_group_sizze_27173;
    
    segmap_group_sizze_27173 = ctx->sizes.mainzisegmap_group_sizze_27156;
    
    int64_t segmap_usable_groups_27174 = sdiv_up64(paths_25424,
                                                   segmap_group_sizze_27173);
    int64_t bytes_28757 = 4 * paths_25424;
    struct memblock_device mem_28758;
    
    mem_28758.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28758, bytes_28757, "mem_28758")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27154, 1,
                                            sizeof(paths_25424), &paths_25424));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27154, 2,
                                            sizeof(mem_28758.mem),
                                            &mem_28758.mem));
    if (1 * ((size_t) segmap_usable_groups_27174 *
             (size_t) segmap_group_sizze_27173) != 0) {
        const size_t global_work_sizze_29664[1] =
                     {(size_t) segmap_usable_groups_27174 *
                     (size_t) segmap_group_sizze_27173};
        const size_t local_work_sizze_29668[1] = {segmap_group_sizze_27173};
        int64_t time_start_29665 = 0, time_end_29666 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "main.segmap_27154");
            fprintf(stderr, "%zu", global_work_sizze_29664[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_29668[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_29665 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->mainzisegmap_27154,
                                                        1, NULL,
                                                        global_work_sizze_29664,
                                                        local_work_sizze_29668,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->mainzisegmap_27154_runs,
                                                                                                  &ctx->mainzisegmap_27154_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_29666 = get_wall_time();
            
            long time_diff_29667 = time_end_29666 - time_start_29665;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n", "main.segmap_27154",
                    time_diff_29667);
        }
    }
    
    int64_t nest_sizze_27197 = paths_25424 * steps_25425;
    int64_t segmap_group_sizze_27198;
    
    segmap_group_sizze_27198 = ctx->sizes.mainzisegmap_group_sizze_27093;
    
    int64_t segmap_usable_groups_27199 = sdiv_up64(nest_sizze_27197,
                                                   segmap_group_sizze_27198);
    int64_t bytes_28760 = 4 * nest_sizze_27197;
    struct memblock_device mem_28762;
    
    mem_28762.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28762, bytes_28760, "mem_28762")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27090, 1,
                                            sizeof(paths_25424), &paths_25424));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27090, 2,
                                            sizeof(steps_25425), &steps_25425));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27090, 3,
                                            sizeof(mem_28758.mem),
                                            &mem_28758.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27090, 4,
                                            sizeof(mem_28762.mem),
                                            &mem_28762.mem));
    if (1 * ((size_t) segmap_usable_groups_27199 *
             (size_t) segmap_group_sizze_27198) != 0) {
        const size_t global_work_sizze_29669[1] =
                     {(size_t) segmap_usable_groups_27199 *
                     (size_t) segmap_group_sizze_27198};
        const size_t local_work_sizze_29673[1] = {segmap_group_sizze_27198};
        int64_t time_start_29670 = 0, time_end_29671 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "main.segmap_27090");
            fprintf(stderr, "%zu", global_work_sizze_29669[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_29673[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_29670 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->mainzisegmap_27090,
                                                        1, NULL,
                                                        global_work_sizze_29669,
                                                        local_work_sizze_29673,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->mainzisegmap_27090_runs,
                                                                                                  &ctx->mainzisegmap_27090_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_29671 = get_wall_time();
            
            long time_diff_29672 = time_end_29671 - time_start_29670;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n", "main.segmap_27090",
                    time_diff_29672);
        }
    }
    if (memblock_unref_device(ctx, &mem_28758, "mem_28758") != 0)
        return 1;
    
    int64_t segmap_group_sizze_27243;
    
    segmap_group_sizze_27243 = ctx->sizes.mainzisegmap_group_sizze_26994;
    
    int64_t num_groups_27244;
    int32_t max_num_groups_28958;
    
    max_num_groups_28958 = ctx->sizes.mainzisegmap_num_groups_26996;
    num_groups_27244 = sext_i64_i32(smax64(1, smin64(sdiv_up64(paths_25424,
                                                               sext_i32_i64(segmap_group_sizze_27243)),
                                                     sext_i32_i64(max_num_groups_28958))));
    
    struct memblock_device mem_28765;
    
    mem_28765.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28765, bytes_28760, "mem_28765")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_28765, 0, mem_28762, 0,
                                              1, steps_25425, paths_25424) !=
        0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_28762, "mem_28762") != 0)
        return 1;
    
    struct memblock_device mem_28783;
    
    mem_28783.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28783, bytes_28760, "mem_28783")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_28767 = 4 * steps_25425;
    int64_t num_threads_28866 = segmap_group_sizze_27243 * num_groups_27244;
    int64_t total_sizze_28867 = bytes_28767 * num_threads_28866;
    struct memblock_device mem_28768;
    
    mem_28768.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28768, total_sizze_28867,
                              "mem_28768")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 1,
                                            sizeof(ctx->failure_is_an_option),
                                            &ctx->failure_is_an_option));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 3,
                                            sizeof(paths_25424), &paths_25424));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 4,
                                            sizeof(steps_25425), &steps_25425));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 5,
                                            sizeof(a_25429), &a_25429));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 6,
                                            sizeof(b_25430), &b_25430));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 7,
                                            sizeof(sigma_25431), &sigma_25431));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 8,
                                            sizeof(r0_25432), &r0_25432));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 9,
                                            sizeof(dt_25447), &dt_25447));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 10,
                                            sizeof(upper_bound_25533),
                                            &upper_bound_25533));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 11,
                                            sizeof(res_25534), &res_25534));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 12,
                                            sizeof(num_groups_27244),
                                            &num_groups_27244));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 13,
                                            sizeof(mem_28765.mem),
                                            &mem_28765.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 14,
                                            sizeof(mem_28768.mem),
                                            &mem_28768.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_26992, 15,
                                            sizeof(mem_28783.mem),
                                            &mem_28783.mem));
    if (1 * ((size_t) num_groups_27244 * (size_t) segmap_group_sizze_27243) !=
        0) {
        const size_t global_work_sizze_29674[1] = {(size_t) num_groups_27244 *
                     (size_t) segmap_group_sizze_27243};
        const size_t local_work_sizze_29678[1] = {segmap_group_sizze_27243};
        int64_t time_start_29675 = 0, time_end_29676 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "main.segmap_26992");
            fprintf(stderr, "%zu", global_work_sizze_29674[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_29678[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_29675 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->mainzisegmap_26992,
                                                        1, NULL,
                                                        global_work_sizze_29674,
                                                        local_work_sizze_29678,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->mainzisegmap_26992_runs,
                                                                                                  &ctx->mainzisegmap_26992_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_29676 = get_wall_time();
            
            long time_diff_29677 = time_end_29676 - time_start_29675;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n", "main.segmap_26992",
                    time_diff_29677);
        }
    }
    ctx->failure_is_an_option = 1;
    if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
        return 1;
    
    int64_t flat_dim_25598 = n_25421 * paths_25424;
    float res_25602 = sitofp_i64_f32(paths_25424);
    struct memblock_device mem_28785;
    
    mem_28785.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28785, bytes_28767, "mem_28785")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segscan_group_sizze_27342;
    
    segscan_group_sizze_27342 = ctx->sizes.mainzisegscan_group_sizze_27341;
    
    int64_t num_groups_27344;
    int32_t max_num_groups_28970;
    
    max_num_groups_28970 = ctx->sizes.mainzisegscan_num_groups_27343;
    num_groups_27344 = sext_i64_i32(smax64(1, smin64(sdiv_up64(flat_dim_25598,
                                                               sext_i32_i64(segscan_group_sizze_27342)),
                                                     sext_i32_i64(max_num_groups_28970))));
    
    int64_t segred_group_sizze_27350;
    
    segred_group_sizze_27350 = ctx->sizes.mainzisegred_group_sizze_27349;
    
    int64_t num_groups_27352;
    int32_t max_num_groups_28971;
    
    max_num_groups_28971 = ctx->sizes.mainzisegred_num_groups_27351;
    num_groups_27352 = sext_i64_i32(smax64(1, smin64(sdiv_up64(flat_dim_25598,
                                                               sext_i32_i64(segred_group_sizze_27350)),
                                                     sext_i32_i64(max_num_groups_28971))));
    
    int64_t seghist_group_sizze_27360;
    
    seghist_group_sizze_27360 = ctx->sizes.mainziseghist_group_sizze_27359;
    
    int64_t num_groups_27362;
    int32_t max_num_groups_28972;
    
    max_num_groups_28972 = ctx->sizes.mainziseghist_num_groups_27361;
    num_groups_27362 = sext_i64_i32(smax64(1, smin64(sdiv_up64(flat_dim_25598,
                                                               sext_i32_i64(seghist_group_sizze_27360)),
                                                     sext_i32_i64(max_num_groups_28972))));
    
    int64_t segscan_group_sizze_27375;
    
    segscan_group_sizze_27375 = ctx->sizes.mainzisegscan_group_sizze_27374;
    
    int64_t segscan_group_sizze_27383;
    
    segscan_group_sizze_27383 = ctx->sizes.mainzisegscan_group_sizze_27382;
    
    int64_t segscan_group_sizze_27391;
    
    segscan_group_sizze_27391 = ctx->sizes.mainzisegscan_group_sizze_27390;
    
    int64_t segscan_group_sizze_27443;
    
    segscan_group_sizze_27443 = ctx->sizes.mainzisegscan_group_sizze_27442;
    
    bool suff_outer_redomap_27456;
    
    suff_outer_redomap_27456 = ctx->sizes.mainzisuff_outer_redomap_7 <=
        paths_25424;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_outer_redomap_7",
                paths_25424);
    
    int64_t segred_group_sizze_27468;
    
    segred_group_sizze_27468 = ctx->sizes.mainzisegred_group_sizze_27458;
    
    int64_t num_groups_27469;
    int32_t max_num_groups_28973;
    
    max_num_groups_28973 = ctx->sizes.mainzisegred_num_groups_27460;
    num_groups_27469 = sext_i64_i32(smax64(1, smin64(sdiv_up64(paths_25424,
                                                               sext_i32_i64(segred_group_sizze_27468)),
                                                     sext_i32_i64(max_num_groups_28973))));
    
    bool suff_outer_par_27564;
    
    suff_outer_par_27564 = ctx->sizes.mainzisuff_outer_par_8 <= paths_25424;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "main.suff_outer_par_8",
                paths_25424);
    
    int64_t segmap_group_sizze_27567;
    
    segmap_group_sizze_27567 = ctx->sizes.mainzisegmap_group_sizze_27490;
    
    int64_t segred_group_sizze_27579;
    
    segred_group_sizze_27579 = ctx->sizes.mainzisegred_group_sizze_27523;
    
    int64_t num_groups_27580;
    int32_t max_num_groups_28974;
    
    max_num_groups_28974 = ctx->sizes.mainzisegred_num_groups_27525;
    num_groups_27580 = sext_i64_i32(smax64(1, smin64(sdiv_up64(flat_dim_25598,
                                                               sext_i32_i64(segred_group_sizze_27579)),
                                                     sext_i32_i64(max_num_groups_28974))));
    
    int64_t segmap_group_sizze_27589;
    
    segmap_group_sizze_27589 = ctx->sizes.mainzisegmap_group_sizze_27515;
    
    int64_t segred_group_sizze_27596;
    
    segred_group_sizze_27596 = ctx->sizes.mainzisegred_group_sizze_27554;
    
    int64_t num_groups_27597;
    int32_t max_num_groups_28975;
    
    max_num_groups_28975 = ctx->sizes.mainzisegred_num_groups_27556;
    num_groups_27597 = sext_i64_i32(smax64(1, smin64(sdiv_up64(paths_25424,
                                                               sext_i32_i64(segred_group_sizze_27596)),
                                                     sext_i32_i64(max_num_groups_28975))));
    
    int64_t segmap_usable_groups_27568 = sdiv_up_safe64(paths_25424,
                                                        segmap_group_sizze_27567);
    int64_t segmap_usable_groups_27590 = sdiv_up_safe64(paths_25424,
                                                        segmap_group_sizze_27589);
    int64_t bytes_28794 = 8 * flat_dim_25598;
    struct memblock_device mem_28795;
    
    mem_28795.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28795, bytes_28794, "mem_28795")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_28797;
    
    mem_28797.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28797, bytes_28794, "mem_28797")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_28800;
    
    mem_28800.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28800, 8, "mem_28800")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_28827 = 4 * flat_dim_25598;
    float res_25853;
    float redout_27270 = 0.0F;
    
    for (int64_t i_27272 = 0; i_27272 < steps_25425; i_27272++) {
        int64_t index_primexp_28686 = add64(1, i_27272);
        float res_25860 = sitofp_i64_f32(index_primexp_28686);
        float res_25861 = res_25860 / sims_per_year_25519;
        
        if (slt64(0, flat_dim_25598)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_28978;
            
            stage1_max_num_groups_28978 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_28979;
            
            stage1_num_groups_28979 = smin64(stage1_max_num_groups_28978,
                                             num_groups_27344);
            
            int32_t num_threads_28980;
            
            num_threads_28980 = sext_i64_i32(stage1_num_groups_28979 *
                segscan_group_sizze_27342);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27347,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_27342),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27347,
                                                    2, sizeof(n_25421),
                                                    &n_25421));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27347,
                                                    3, sizeof(flat_dim_25598),
                                                    &flat_dim_25598));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27347,
                                                    4, sizeof(res_25861),
                                                    &res_25861));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27347,
                                                    5,
                                                    sizeof(res_mem_28754.mem),
                                                    &res_mem_28754.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27347,
                                                    6,
                                                    sizeof(res_mem_28755.mem),
                                                    &res_mem_28755.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27347,
                                                    7, sizeof(mem_28795.mem),
                                                    &mem_28795.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27347,
                                                    8, sizeof(mem_28797.mem),
                                                    &mem_28797.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27347,
                                                    9,
                                                    sizeof(num_threads_28980),
                                                    &num_threads_28980));
            if (1 * ((size_t) stage1_num_groups_28979 *
                     (size_t) segscan_group_sizze_27342) != 0) {
                const size_t global_work_sizze_29679[1] =
                             {(size_t) stage1_num_groups_28979 *
                             (size_t) segscan_group_sizze_27342};
                const size_t local_work_sizze_29683[1] =
                             {segscan_group_sizze_27342};
                int64_t time_start_29680 = 0, time_end_29681 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage1_27347");
                    fprintf(stderr, "%zu", global_work_sizze_29679[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29683[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_27342)));
                    time_start_29680 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage1_27347,
                                                                1, NULL,
                                                                global_work_sizze_29679,
                                                                local_work_sizze_29683,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage1_27347_runs,
                                                                                                          &ctx->mainziscan_stage1_27347_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29681 = get_wall_time();
                    
                    long time_diff_29682 = time_end_29681 - time_start_29680;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage1_27347", time_diff_29682);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_27342 *
                                     sdiv_up64(flat_dim_25598,
                                               sext_i32_i64(num_threads_28980))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27347,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_28979),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27347,
                                                    2, sizeof(flat_dim_25598),
                                                    &flat_dim_25598));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27347,
                                                    3, sizeof(mem_28795.mem),
                                                    &mem_28795.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27347,
                                                    4,
                                                    sizeof(stage1_num_groups_28979),
                                                    &stage1_num_groups_28979));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27347,
                                                    5,
                                                    sizeof(num_threads_28980),
                                                    &num_threads_28980));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_28979) != 0) {
                const size_t global_work_sizze_29684[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_28979};
                const size_t local_work_sizze_29688[1] =
                             {stage1_num_groups_28979};
                int64_t time_start_29685 = 0, time_end_29686 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage2_27347");
                    fprintf(stderr, "%zu", global_work_sizze_29684[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29688[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_28979)));
                    time_start_29685 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage2_27347,
                                                                1, NULL,
                                                                global_work_sizze_29684,
                                                                local_work_sizze_29688,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage2_27347_runs,
                                                                                                          &ctx->mainziscan_stage2_27347_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29686 = get_wall_time();
                    
                    long time_diff_29687 = time_end_29686 - time_start_29685;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage2_27347", time_diff_29687);
                }
            }
            
            int32_t required_groups_29016;
            
            required_groups_29016 = sext_i64_i32(sdiv_up64(flat_dim_25598,
                                                           segscan_group_sizze_27342));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27347,
                                                    1, sizeof(flat_dim_25598),
                                                    &flat_dim_25598));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27347,
                                                    2, sizeof(num_groups_27344),
                                                    &num_groups_27344));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27347,
                                                    3, sizeof(mem_28795.mem),
                                                    &mem_28795.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27347,
                                                    4,
                                                    sizeof(num_threads_28980),
                                                    &num_threads_28980));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27347,
                                                    5,
                                                    sizeof(required_groups_29016),
                                                    &required_groups_29016));
            if (1 * ((size_t) num_groups_27344 *
                     (size_t) segscan_group_sizze_27342) != 0) {
                const size_t global_work_sizze_29689[1] =
                             {(size_t) num_groups_27344 *
                             (size_t) segscan_group_sizze_27342};
                const size_t local_work_sizze_29693[1] =
                             {segscan_group_sizze_27342};
                int64_t time_start_29690 = 0, time_end_29691 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage3_27347");
                    fprintf(stderr, "%zu", global_work_sizze_29689[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29693[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_29690 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage3_27347,
                                                                1, NULL,
                                                                global_work_sizze_29689,
                                                                local_work_sizze_29693,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage3_27347_runs,
                                                                                                          &ctx->mainziscan_stage3_27347_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29691 = get_wall_time();
                    
                    long time_diff_29692 = time_end_29691 - time_start_29690;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage3_27347", time_diff_29692);
                }
            }
        }
        
        struct memblock_device mainzicounter_mem_29028 =
                               ctx->mainzicounter_mem_29028;
        struct memblock_device group_res_arr_mem_29030;
        
        group_res_arr_mem_29030.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_29030,
                                  (int32_t) sizeof(int64_t) *
                                  (segred_group_sizze_27350 * num_groups_27352),
                                  "group_res_arr_mem_29030")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_29032;
        
        num_threads_29032 = num_groups_27352 * segred_group_sizze_27350;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27357,
                                                1, (int32_t) sizeof(int64_t) *
                                                segred_group_sizze_27350,
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27357,
                                                2, (int32_t) sizeof(bool),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27357,
                                                3, sizeof(flat_dim_25598),
                                                &flat_dim_25598));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27357,
                                                4, sizeof(num_groups_27352),
                                                &num_groups_27352));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27357,
                                                5, sizeof(mem_28797.mem),
                                                &mem_28797.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27357,
                                                6, sizeof(mem_28800.mem),
                                                &mem_28800.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27357,
                                                7,
                                                sizeof(mainzicounter_mem_29028.mem),
                                                &mainzicounter_mem_29028.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27357,
                                                8,
                                                sizeof(group_res_arr_mem_29030.mem),
                                                &group_res_arr_mem_29030.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27357,
                                                9, sizeof(num_threads_29032),
                                                &num_threads_29032));
        if (1 * ((size_t) num_groups_27352 *
                 (size_t) segred_group_sizze_27350) != 0) {
            const size_t global_work_sizze_29695[1] =
                         {(size_t) num_groups_27352 *
                         (size_t) segred_group_sizze_27350};
            const size_t local_work_sizze_29699[1] = {segred_group_sizze_27350};
            int64_t time_start_29696 = 0, time_end_29697 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segred_nonseg_27357");
                fprintf(stderr, "%zu", global_work_sizze_29695[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_29699[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + (int32_t) sizeof(int64_t) *
                               segred_group_sizze_27350 +
                               (int32_t) sizeof(bool)));
                time_start_29696 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegred_nonseg_27357,
                                                            1, NULL,
                                                            global_work_sizze_29695,
                                                            local_work_sizze_29699,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegred_nonseg_27357_runs,
                                                                                                      &ctx->mainzisegred_nonseg_27357_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_29697 = get_wall_time();
                
                long time_diff_29698 = time_end_29697 - time_start_29696;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segred_nonseg_27357", time_diff_29698);
            }
        }
        
        int64_t read_res_29700;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_28800.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0 * sizeof(int64_t),
                                                     sizeof(int64_t),
                                                     &read_res_29700, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        int64_t res_25881 = read_res_29700;
        bool bounds_invalid_upwards_25886 = slt64(res_25881, 0);
        bool valid_25887 = !bounds_invalid_upwards_25886;
        bool range_valid_c_25888;
        
        if (!valid_25887) {
            ctx->error =
                msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                          "Range ", 0, "..", 1, "..<", res_25881,
                          " is invalid.",
                          "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:70:18-23\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:48:30-60\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:87:14-32\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:133:38-97\n   #6  /prelude/soacs.fut:56:19-23\n   #7  /prelude/soacs.fut:56:3-37\n   #8  cva.fut:126:44-136:50\n   #9  cva.fut:101:1-145:20\n");
            if (memblock_unref_device(ctx, &group_res_arr_mem_29030,
                                      "group_res_arr_mem_29030") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28797, "mem_28797") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28795, "mem_28795") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28785, "mem_28785") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28783, "mem_28783") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28762, "mem_28762") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28758, "mem_28758") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28754, "res_mem_28754") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28753, "res_mem_28753") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28752, "res_mem_28752") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_28907,
                                      "group_res_arr_mem_28907") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_28902, "out_mem_28902") !=
                0)
                return 1;
            return 1;
        }
        
        int64_t bytes_28801 = 8 * res_25881;
        struct memblock_device mem_28802;
        
        mem_28802.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28802, bytes_28801, "mem_28802")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i64(ctx, mem_28802, res_25881, 0) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int32_t num_subhistos_29067;
        struct memblock_device res_subhistos_mem_29068;
        
        res_subhistos_mem_29068.references = NULL;
        
        int64_t h_29070;
        
        h_29070 = (int32_t) sizeof(int64_t) * res_25881;
        
        int64_t seg_h_29071;
        
        seg_h_29071 = (int32_t) sizeof(int64_t) * res_25881;
        if (!(seg_h_29071 == 0)) {
            int64_t hist_H_29072 = res_25881;
            int64_t hist_el_sizze_29073 = sdiv_up64(h_29070, hist_H_29072) + 4;
            int64_t hist_N_29074 = flat_dim_25598;
            int64_t hist_RF_29075 = 1;
            
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegHist");
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Number of threads (T)",
                        (long long) sext_i64_i32(num_groups_27362 *
                        seghist_group_sizze_27360), '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Desired group size (B)",
                        (long long) seghist_group_sizze_27360, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Histogram size (H)",
                        (long long) hist_H_29072, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Input elements per histogram (N)",
                        (long long) hist_N_29074, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Number of segments",
                        (long long) 1, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Histogram element size (el_size)",
                        (long long) hist_el_sizze_29073, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Race factor (RF)",
                        (long long) hist_RF_29075, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Memory per set of subhistograms per segment",
                        (long long) h_29070, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Memory per set of subhistograms times segments",
                        (long long) seg_h_29071, '\n');
            
            int32_t hist_L_29076;
            
            hist_L_29076 = ctx->opencl.max_local_memory;
            
            int32_t max_group_sizze_29077;
            
            max_group_sizze_29077 = ctx->opencl.max_group_size;
            
            int64_t num_groups_29078;
            
            num_groups_29078 =
                sdiv_up64(sext_i32_i64(sext_i64_i32(num_groups_27362 *
                          seghist_group_sizze_27360)), max_group_sizze_29077);
            
            double hist_m_prime_29079;
            
            hist_m_prime_29079 =
                sitofp_i64_f64(smin64(sext_i32_i64(squot32(hist_L_29076,
                                                           hist_el_sizze_29073)),
                                      sdiv_up64(hist_N_29074,
                                                num_groups_29078))) /
                sitofp_i64_f64(hist_H_29072);
            
            int64_t hist_M0_29080;
            
            hist_M0_29080 = smax64(1, smin64(fptosi_f64_i64(hist_m_prime_29079),
                                             max_group_sizze_29077));
            
            int64_t hist_Nout_29081;
            
            hist_Nout_29081 = 1;
            
            int64_t hist_Nin_29082;
            
            hist_Nin_29082 = flat_dim_25598;
            
            int64_t work_asymp_M_max_29083;
            
            work_asymp_M_max_29083 = squot64(hist_Nout_29081 * hist_N_29074, 2 *
                                             num_groups_29078 * hist_H_29072);
            
            int32_t hist_M_29084;
            
            hist_M_29084 = sext_i64_i32(smin64(hist_M0_29080,
                                               work_asymp_M_max_29083));
            
            int64_t hist_C_29085;
            
            hist_C_29085 = sdiv_up64(max_group_sizze_29077,
                                     sext_i32_i64(smax32(1, hist_M_29084)));
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local hist_M0",
                        (long long) hist_M0_29080, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local work asymp M max",
                        (long long) work_asymp_M_max_29083, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local C",
                        (long long) hist_C_29085, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local B",
                        (long long) max_group_sizze_29077, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local M",
                        (long long) hist_M_29084, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local memory needed",
                        (long long) (hist_H_29072 * hist_el_sizze_29073 *
                                     sext_i32_i64(hist_M_29084)), '\n');
            
            int64_t local_mem_needed_29086;
            
            local_mem_needed_29086 = hist_el_sizze_29073 *
                sext_i32_i64(hist_M_29084);
            
            int32_t hist_S_29087;
            
            hist_S_29087 = sext_i64_i32(sdiv_up64(hist_H_29072 *
                                                  local_mem_needed_29086,
                                                  hist_L_29076));
            if (sle64(hist_H_29072, hist_Nin_29082) &&
                (sle64(local_mem_needed_29086, hist_L_29076) &&
                 (sle32(hist_S_29087, 6) && (sle64(hist_C_29085,
                                                   max_group_sizze_29077) &&
                                             slt32(0, hist_M_29084))))) {
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "## Using local memory");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Histogram size (H)",
                            (long long) hist_H_29072, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Multiplication degree (M)",
                            (long long) hist_M_29084, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Cooperation level (C)",
                            (long long) hist_C_29085, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Number of chunks (S)",
                            (long long) hist_S_29087, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c",
                            "Number of local subhistograms per group",
                            (long long) hist_M_29084, '\n');
                
                int64_t num_segments_29088;
                
                num_segments_29088 = 1;
                num_subhistos_29067 = num_groups_29078 * num_segments_29088;
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c",
                            "Number of subhistograms in global memory",
                            (long long) num_subhistos_29067, '\n');
                if (num_subhistos_29067 == 1) {
                    if (memblock_set_device(ctx, &res_subhistos_mem_29068,
                                            &mem_28802, "mem_28802") != 0)
                        return 1;
                } else {
                    if (memblock_alloc_device(ctx, &res_subhistos_mem_29068,
                                              sext_i32_i64(num_subhistos_29067) *
                                              res_25881 *
                                              (int32_t) sizeof(int64_t),
                                              "res_subhistos_mem_29068")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (futrts_builtinzhreplicate_i64(ctx,
                                                      res_subhistos_mem_29068,
                                                      num_subhistos_29067 *
                                                      res_25881, 0) != 0) {
                        err = 1;
                        goto cleanup;
                    }
                    if (res_25881 * (int32_t) sizeof(int64_t) > 0) {
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                                     mem_28802.mem,
                                                                     res_subhistos_mem_29068.mem,
                                                                     0, 0,
                                                                     res_25881 *
                                                                     (int32_t) sizeof(int64_t),
                                                                     0, NULL,
                                                                     ctx->profiling_paused ||
                                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
                        if (ctx->debugging)
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    }
                }
                for (int32_t chk_i_29089 = 0; chk_i_29089 < hist_S_29087;
                     chk_i_29089++) {
                    int64_t num_segments_29090 = 1;
                    int64_t hist_H_chk_29091 = sdiv_up64(res_25881,
                                                         sext_i32_i64(hist_S_29087));
                    int64_t histo_sizze_29092 = hist_H_chk_29091;
                    int32_t init_per_thread_29093 =
                            sext_i64_i32(sdiv_up64(sext_i32_i64(hist_M_29084) *
                                                   histo_sizze_29092,
                                                   max_group_sizze_29077));
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            1,
                                                            (int32_t) sizeof(int32_t) *
                                                            (hist_M_29084 *
                                                             hist_H_chk_29091),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            2,
                                                            (int32_t) sizeof(int64_t) *
                                                            (hist_M_29084 *
                                                             hist_H_chk_29091),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            3,
                                                            sizeof(flat_dim_25598),
                                                            &flat_dim_25598));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            4,
                                                            sizeof(res_25881),
                                                            &res_25881));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            5,
                                                            sizeof(mem_28795.mem),
                                                            &mem_28795.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            6,
                                                            sizeof(res_subhistos_mem_29068.mem),
                                                            &res_subhistos_mem_29068.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            7,
                                                            sizeof(max_group_sizze_29077),
                                                            &max_group_sizze_29077));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            8,
                                                            sizeof(num_groups_29078),
                                                            &num_groups_29078));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            9,
                                                            sizeof(hist_M_29084),
                                                            &hist_M_29084));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            10,
                                                            sizeof(chk_i_29089),
                                                            &chk_i_29089));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            11,
                                                            sizeof(num_segments_29090),
                                                            &num_segments_29090));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            12,
                                                            sizeof(hist_H_chk_29091),
                                                            &hist_H_chk_29091));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            13,
                                                            sizeof(histo_sizze_29092),
                                                            &histo_sizze_29092));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_local_27365,
                                                            14,
                                                            sizeof(init_per_thread_29093),
                                                            &init_per_thread_29093));
                    if (1 * ((size_t) num_groups_29078 *
                             (size_t) max_group_sizze_29077) != 0) {
                        const size_t global_work_sizze_29701[1] =
                                     {(size_t) num_groups_29078 *
                                     (size_t) max_group_sizze_29077};
                        const size_t local_work_sizze_29705[1] =
                                     {max_group_sizze_29077};
                        int64_t time_start_29702 = 0, time_end_29703 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.seghist_local_27365");
                            fprintf(stderr, "%zu", global_work_sizze_29701[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29705[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(int32_t) *
                                           (hist_M_29084 * hist_H_chk_29091) +
                                           (int32_t) sizeof(int64_t) *
                                           (hist_M_29084 * hist_H_chk_29091)));
                            time_start_29702 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainziseghist_local_27365,
                                                                        1, NULL,
                                                                        global_work_sizze_29701,
                                                                        local_work_sizze_29705,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainziseghist_local_27365_runs,
                                                                                                                  &ctx->mainziseghist_local_27365_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29703 = get_wall_time();
                            
                            long time_diff_29704 = time_end_29703 -
                                 time_start_29702;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.seghist_local_27365",
                                    time_diff_29704);
                        }
                    }
                }
            } else {
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "## Using global memory");
                
                int64_t hist_H_29125;
                
                hist_H_29125 = res_25881;
                
                double hist_RF_29126;
                
                hist_RF_29126 = (0.0 + sitofp_i32_f64(1)) / 1.0;
                
                int32_t hist_el_sizze_29127;
                
                hist_el_sizze_29127 =
                    squot32(sext_i64_i32((int32_t) sizeof(int32_t) +
                            (int32_t) sizeof(int64_t)), 2);
                
                double hist_C_max_29128;
                
                hist_C_max_29128 =
                    fmin64(sitofp_i32_f64(sext_i64_i32(num_groups_27362 *
                           seghist_group_sizze_27360)),
                           sitofp_i32_f64(hist_H_29125) / 2.0);
                
                int32_t hist_M_min_29129;
                
                hist_M_min_29129 = smax32(1,
                                          sext_i64_i32(fptosi_f64_i64(sitofp_i32_f64(sext_i64_i32(num_groups_27362 *
                                          seghist_group_sizze_27360)) /
                                          hist_C_max_29128)));
                
                int32_t L2_sizze_29130;
                
                L2_sizze_29130 = ctx->sizes.mainziL2_sizze_29130;
                
                double hist_RACE_exp_29131;
                
                hist_RACE_exp_29131 = fmax64(1.0, 0.75 * hist_RF_29126 / (64.0 /
                                                                          sitofp_i32_f64(hist_el_sizze_29127)));
                
                int32_t hist_S_29132;
                
                if (slt64(flat_dim_25598, hist_H_29125)) {
                    hist_S_29132 = 1;
                } else {
                    hist_S_29132 =
                        sext_i64_i32(sdiv_up64(sext_i32_i64(hist_M_min_29129) *
                                               hist_H_29125 *
                                               sext_i32_i64(hist_el_sizze_29127),
                                               fptosi_f64_i64(0.4 *
                                               sitofp_i32_f64(L2_sizze_29130) *
                                               hist_RACE_exp_29131)));
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s: %f%c",
                            "Race expansion factor (RACE^exp)",
                            (double) hist_RACE_exp_29131, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Number of chunks (S)",
                            (long long) hist_S_29132, '\n');
                
                int64_t hist_H_chk_29133;
                
                hist_H_chk_29133 = sdiv_up64(res_25881,
                                             sext_i32_i64(hist_S_29132));
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Chunk size (H_chk)",
                            (long long) hist_H_chk_29133, '\n');
                
                double hist_k_max_29134;
                
                hist_k_max_29134 = fmin64(0.4 *
                                          (sitofp_i32_f64(L2_sizze_29130) /
                                           sitofp_i32_f64(sext_i64_i32((int32_t) sizeof(int32_t) +
                                           (int32_t) sizeof(int64_t)))) *
                                          hist_RACE_exp_29131,
                                          sitofp_i32_f64(flat_dim_25598)) /
                    sitofp_i32_f64(sext_i64_i32(num_groups_27362 *
                    seghist_group_sizze_27360));
                
                int64_t hist_u_29135;
                
                hist_u_29135 = 1;
                
                double hist_C_29136;
                
                hist_C_29136 =
                    fmin64(sitofp_i32_f64(sext_i64_i32(num_groups_27362 *
                           seghist_group_sizze_27360)),
                           sitofp_i32_f64(hist_u_29135 * hist_H_chk_29133) /
                           hist_k_max_29134);
                
                int32_t hist_M_29137;
                
                hist_M_29137 = smax32(hist_M_min_29129,
                                      sext_i64_i32(fptosi_f64_i64(sitofp_i32_f64(sext_i64_i32(num_groups_27362 *
                                      seghist_group_sizze_27360)) /
                                      hist_C_29136)));
                if (ctx->debugging)
                    fprintf(stderr, "%s: %f%c",
                            "Elements/thread in L2 cache (k_max)",
                            (double) hist_k_max_29134, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Multiplication degree (M)",
                            (long long) hist_M_29137, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %f%c", "Cooperation level (C)",
                            (double) hist_C_29136, '\n');
                num_subhistos_29067 = sext_i32_i64(hist_M_29137);
                if (hist_M_29137 == 1) {
                    if (memblock_set_device(ctx, &res_subhistos_mem_29068,
                                            &mem_28802, "mem_28802") != 0)
                        return 1;
                } else {
                    if (num_subhistos_29067 == 1) {
                        if (memblock_set_device(ctx, &res_subhistos_mem_29068,
                                                &mem_28802, "mem_28802") != 0)
                            return 1;
                    } else {
                        if (memblock_alloc_device(ctx, &res_subhistos_mem_29068,
                                                  sext_i32_i64(num_subhistos_29067) *
                                                  res_25881 *
                                                  (int32_t) sizeof(int64_t),
                                                  "res_subhistos_mem_29068")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (futrts_builtinzhreplicate_i64(ctx,
                                                          res_subhistos_mem_29068,
                                                          num_subhistos_29067 *
                                                          res_25881, 0) != 0) {
                            err = 1;
                            goto cleanup;
                        }
                        if (res_25881 * (int32_t) sizeof(int64_t) > 0) {
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                                         mem_28802.mem,
                                                                         res_subhistos_mem_29068.mem,
                                                                         0, 0,
                                                                         res_25881 *
                                                                         (int32_t) sizeof(int64_t),
                                                                         0,
                                                                         NULL,
                                                                         ctx->profiling_paused ||
                                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
                            if (ctx->debugging)
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        }
                    }
                }
                
                struct memblock_device mainzihist_locks_mem_29138 =
                                       ctx->mainzihist_locks_mem_29138;
                
                for (int32_t chk_i_29140 = 0; chk_i_29140 < hist_S_29132;
                     chk_i_29140++) {
                    int64_t hist_H_chk_29141 = sdiv_up64(res_25881,
                                                         sext_i32_i64(hist_S_29132));
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_27365,
                                                            1,
                                                            sizeof(flat_dim_25598),
                                                            &flat_dim_25598));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_27365,
                                                            2,
                                                            sizeof(res_25881),
                                                            &res_25881));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_27365,
                                                            3,
                                                            sizeof(num_groups_27362),
                                                            &num_groups_27362));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_27365,
                                                            4,
                                                            sizeof(mem_28795.mem),
                                                            &mem_28795.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_27365,
                                                            5,
                                                            sizeof(num_subhistos_29067),
                                                            &num_subhistos_29067));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_27365,
                                                            6,
                                                            sizeof(res_subhistos_mem_29068.mem),
                                                            &res_subhistos_mem_29068.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_27365,
                                                            7,
                                                            sizeof(mainzihist_locks_mem_29138.mem),
                                                            &mainzihist_locks_mem_29138.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_27365,
                                                            8,
                                                            sizeof(chk_i_29140),
                                                            &chk_i_29140));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziseghist_global_27365,
                                                            9,
                                                            sizeof(hist_H_chk_29141),
                                                            &hist_H_chk_29141));
                    if (1 * ((size_t) num_groups_27362 *
                             (size_t) seghist_group_sizze_27360) != 0) {
                        const size_t global_work_sizze_29707[1] =
                                     {(size_t) num_groups_27362 *
                                     (size_t) seghist_group_sizze_27360};
                        const size_t local_work_sizze_29711[1] =
                                     {seghist_group_sizze_27360};
                        int64_t time_start_29708 = 0, time_end_29709 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.seghist_global_27365");
                            fprintf(stderr, "%zu", global_work_sizze_29707[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29711[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) 0);
                            time_start_29708 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainziseghist_global_27365,
                                                                        1, NULL,
                                                                        global_work_sizze_29707,
                                                                        local_work_sizze_29711,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainziseghist_global_27365_runs,
                                                                                                                  &ctx->mainziseghist_global_27365_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29709 = get_wall_time();
                            
                            long time_diff_29710 = time_end_29709 -
                                 time_start_29708;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.seghist_global_27365",
                                    time_diff_29710);
                        }
                    }
                }
            }
            if (num_subhistos_29067 == 1) {
                if (memblock_set_device(ctx, &mem_28802,
                                        &res_subhistos_mem_29068,
                                        "res_subhistos_mem_29068") != 0)
                    return 1;
            } else {
                if (slt64(num_subhistos_29067 * 2, seghist_group_sizze_27360)) {
                    int64_t segment_sizze_nonzzero_29154 = smax64(1,
                                                                  num_subhistos_29067);
                    int64_t num_threads_29155 = num_groups_27362 *
                            seghist_group_sizze_27360;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-small");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) res_25881, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) num_subhistos_29067, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segments_per_group",
                                (long long) squot64(seghist_group_sizze_27360,
                                                    segment_sizze_nonzzero_29154),
                                '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "required_groups",
                                (long long) sext_i64_i32(sdiv_up64(res_25881,
                                                                   squot64(seghist_group_sizze_27360,
                                                                           segment_sizze_nonzzero_29154))),
                                '\n');
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_29153,
                                                            1,
                                                            (int32_t) sizeof(int64_t) *
                                                            seghist_group_sizze_27360,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_29153,
                                                            2,
                                                            sizeof(res_25881),
                                                            &res_25881));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_29153,
                                                            3,
                                                            sizeof(num_groups_27362),
                                                            &num_groups_27362));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_29153,
                                                            4,
                                                            sizeof(mem_28802.mem),
                                                            &mem_28802.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_29153,
                                                            5,
                                                            sizeof(num_subhistos_29067),
                                                            &num_subhistos_29067));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_29153,
                                                            6,
                                                            sizeof(res_subhistos_mem_29068.mem),
                                                            &res_subhistos_mem_29068.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_29153,
                                                            7,
                                                            sizeof(segment_sizze_nonzzero_29154),
                                                            &segment_sizze_nonzzero_29154));
                    if (1 * ((size_t) num_groups_27362 *
                             (size_t) seghist_group_sizze_27360) != 0) {
                        const size_t global_work_sizze_29712[1] =
                                     {(size_t) num_groups_27362 *
                                     (size_t) seghist_group_sizze_27360};
                        const size_t local_work_sizze_29716[1] =
                                     {seghist_group_sizze_27360};
                        int64_t time_start_29713 = 0, time_end_29714 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.segred_small_29153");
                            fprintf(stderr, "%zu", global_work_sizze_29712[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29716[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(int64_t) *
                                           seghist_group_sizze_27360));
                            time_start_29713 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainzisegred_small_29153,
                                                                        1, NULL,
                                                                        global_work_sizze_29712,
                                                                        local_work_sizze_29716,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainzisegred_small_29153_runs,
                                                                                                                  &ctx->mainzisegred_small_29153_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29714 = get_wall_time();
                            
                            long time_diff_29715 = time_end_29714 -
                                 time_start_29713;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.segred_small_29153", time_diff_29715);
                        }
                    }
                } else {
                    int64_t groups_per_segment_29175 =
                            sdiv_up64(num_groups_27362, smax64(1, res_25881));
                    int64_t elements_per_thread_29176 =
                            sdiv_up64(num_subhistos_29067,
                                      seghist_group_sizze_27360 *
                                      groups_per_segment_29175);
                    int64_t virt_num_groups_29177 = groups_per_segment_29175 *
                            res_25881;
                    int64_t num_threads_29178 = num_groups_27362 *
                            seghist_group_sizze_27360;
                    int64_t threads_per_segment_29179 =
                            groups_per_segment_29175 *
                            seghist_group_sizze_27360;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-large");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) res_25881, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) num_subhistos_29067, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                                (long long) virt_num_groups_29177, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_groups",
                                (long long) num_groups_27362, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "group_size",
                                (long long) seghist_group_sizze_27360, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                                (long long) elements_per_thread_29176, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                                (long long) groups_per_segment_29175, '\n');
                    
                    struct memblock_device group_res_arr_mem_29180;
                    
                    group_res_arr_mem_29180.references = NULL;
                    if (memblock_alloc_device(ctx, &group_res_arr_mem_29180,
                                              (int32_t) sizeof(int64_t) *
                                              (seghist_group_sizze_27360 *
                                               virt_num_groups_29177),
                                              "group_res_arr_mem_29180")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    struct memblock_device mainzicounter_mem_29182 =
                                           ctx->mainzicounter_mem_29182;
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            1,
                                                            (int32_t) sizeof(bool),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            2,
                                                            (int32_t) sizeof(int64_t) *
                                                            seghist_group_sizze_27360,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            3,
                                                            sizeof(res_25881),
                                                            &res_25881));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            4,
                                                            sizeof(num_groups_27362),
                                                            &num_groups_27362));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            5,
                                                            sizeof(mem_28802.mem),
                                                            &mem_28802.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            6,
                                                            sizeof(num_subhistos_29067),
                                                            &num_subhistos_29067));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            7,
                                                            sizeof(res_subhistos_mem_29068.mem),
                                                            &res_subhistos_mem_29068.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            8,
                                                            sizeof(groups_per_segment_29175),
                                                            &groups_per_segment_29175));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            9,
                                                            sizeof(elements_per_thread_29176),
                                                            &elements_per_thread_29176));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            10,
                                                            sizeof(virt_num_groups_29177),
                                                            &virt_num_groups_29177));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            11,
                                                            sizeof(threads_per_segment_29179),
                                                            &threads_per_segment_29179));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            12,
                                                            sizeof(group_res_arr_mem_29180.mem),
                                                            &group_res_arr_mem_29180.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_29153,
                                                            13,
                                                            sizeof(mainzicounter_mem_29182.mem),
                                                            &mainzicounter_mem_29182.mem));
                    if (1 * ((size_t) num_groups_27362 *
                             (size_t) seghist_group_sizze_27360) != 0) {
                        const size_t global_work_sizze_29718[1] =
                                     {(size_t) num_groups_27362 *
                                     (size_t) seghist_group_sizze_27360};
                        const size_t local_work_sizze_29722[1] =
                                     {seghist_group_sizze_27360};
                        int64_t time_start_29719 = 0, time_end_29720 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.segred_large_29153");
                            fprintf(stderr, "%zu", global_work_sizze_29718[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29722[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(bool) +
                                           (int32_t) sizeof(int64_t) *
                                           seghist_group_sizze_27360));
                            time_start_29719 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainzisegred_large_29153,
                                                                        1, NULL,
                                                                        global_work_sizze_29718,
                                                                        local_work_sizze_29722,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainzisegred_large_29153_runs,
                                                                                                                  &ctx->mainzisegred_large_29153_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29720 = get_wall_time();
                            
                            long time_diff_29721 = time_end_29720 -
                                 time_start_29719;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.segred_large_29153", time_diff_29721);
                        }
                    }
                    if (memblock_unref_device(ctx, &group_res_arr_mem_29180,
                                              "group_res_arr_mem_29180") != 0)
                        return 1;
                }
            }
        }
        
        int64_t num_groups_27377;
        int32_t max_num_groups_29214;
        
        max_num_groups_29214 = ctx->sizes.mainzisegscan_num_groups_27376;
        num_groups_27377 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_25881,
                                                                   sext_i32_i64(segscan_group_sizze_27375)),
                                                         sext_i32_i64(max_num_groups_29214))));
        
        struct memblock_device mem_28806;
        
        mem_28806.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28806, res_25881, "mem_28806")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_28808;
        
        mem_28808.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28808, bytes_28801, "mem_28808")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, res_25881)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_29215;
            
            stage1_max_num_groups_29215 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_29216;
            
            stage1_num_groups_29216 = smin64(stage1_max_num_groups_29215,
                                             num_groups_27377);
            
            int32_t num_threads_29217;
            
            num_threads_29217 = sext_i64_i32(stage1_num_groups_29216 *
                segscan_group_sizze_27375);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27380,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_27375),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27380,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              segscan_group_sizze_27375),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27380,
                                                    3, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27380,
                                                    4, sizeof(mem_28802.mem),
                                                    &mem_28802.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27380,
                                                    5, sizeof(mem_28806.mem),
                                                    &mem_28806.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27380,
                                                    6, sizeof(mem_28808.mem),
                                                    &mem_28808.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27380,
                                                    7,
                                                    sizeof(num_threads_29217),
                                                    &num_threads_29217));
            if (1 * ((size_t) stage1_num_groups_29216 *
                     (size_t) segscan_group_sizze_27375) != 0) {
                const size_t global_work_sizze_29723[1] =
                             {(size_t) stage1_num_groups_29216 *
                             (size_t) segscan_group_sizze_27375};
                const size_t local_work_sizze_29727[1] =
                             {segscan_group_sizze_27375};
                int64_t time_start_29724 = 0, time_end_29725 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage1_27380");
                    fprintf(stderr, "%zu", global_work_sizze_29723[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29727[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_27375) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          segscan_group_sizze_27375)));
                    time_start_29724 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage1_27380,
                                                                1, NULL,
                                                                global_work_sizze_29723,
                                                                local_work_sizze_29727,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage1_27380_runs,
                                                                                                          &ctx->mainziscan_stage1_27380_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29725 = get_wall_time();
                    
                    long time_diff_29726 = time_end_29725 - time_start_29724;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage1_27380", time_diff_29726);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_27375 *
                                     sdiv_up64(res_25881,
                                               sext_i32_i64(num_threads_29217))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27380,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_29216),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27380,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              stage1_num_groups_29216),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27380,
                                                    3, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27380,
                                                    4, sizeof(mem_28806.mem),
                                                    &mem_28806.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27380,
                                                    5, sizeof(mem_28808.mem),
                                                    &mem_28808.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27380,
                                                    6,
                                                    sizeof(stage1_num_groups_29216),
                                                    &stage1_num_groups_29216));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27380,
                                                    7,
                                                    sizeof(num_threads_29217),
                                                    &num_threads_29217));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_29216) != 0) {
                const size_t global_work_sizze_29728[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_29216};
                const size_t local_work_sizze_29732[1] =
                             {stage1_num_groups_29216};
                int64_t time_start_29729 = 0, time_end_29730 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage2_27380");
                    fprintf(stderr, "%zu", global_work_sizze_29728[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29732[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_29216) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          stage1_num_groups_29216)));
                    time_start_29729 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage2_27380,
                                                                1, NULL,
                                                                global_work_sizze_29728,
                                                                local_work_sizze_29732,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage2_27380_runs,
                                                                                                          &ctx->mainziscan_stage2_27380_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29730 = get_wall_time();
                    
                    long time_diff_29731 = time_end_29730 - time_start_29729;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage2_27380", time_diff_29731);
                }
            }
            
            int32_t required_groups_29269;
            
            required_groups_29269 = sext_i64_i32(sdiv_up64(res_25881,
                                                           segscan_group_sizze_27375));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27380,
                                                    1, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27380,
                                                    2, sizeof(num_groups_27377),
                                                    &num_groups_27377));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27380,
                                                    3, sizeof(mem_28806.mem),
                                                    &mem_28806.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27380,
                                                    4, sizeof(mem_28808.mem),
                                                    &mem_28808.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27380,
                                                    5,
                                                    sizeof(num_threads_29217),
                                                    &num_threads_29217));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27380,
                                                    6,
                                                    sizeof(required_groups_29269),
                                                    &required_groups_29269));
            if (1 * ((size_t) num_groups_27377 *
                     (size_t) segscan_group_sizze_27375) != 0) {
                const size_t global_work_sizze_29733[1] =
                             {(size_t) num_groups_27377 *
                             (size_t) segscan_group_sizze_27375};
                const size_t local_work_sizze_29737[1] =
                             {segscan_group_sizze_27375};
                int64_t time_start_29734 = 0, time_end_29735 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage3_27380");
                    fprintf(stderr, "%zu", global_work_sizze_29733[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29737[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_29734 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage3_27380,
                                                                1, NULL,
                                                                global_work_sizze_29733,
                                                                local_work_sizze_29737,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage3_27380_runs,
                                                                                                          &ctx->mainziscan_stage3_27380_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29735 = get_wall_time();
                    
                    long time_diff_29736 = time_end_29735 - time_start_29734;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage3_27380", time_diff_29736);
                }
            }
        }
        if (memblock_unref_device(ctx, &mem_28802, "mem_28802") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28806, "mem_28806") != 0)
            return 1;
        
        int64_t num_groups_27385;
        int32_t max_num_groups_29281;
        
        max_num_groups_29281 = ctx->sizes.mainzisegscan_num_groups_27384;
        num_groups_27385 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_25881,
                                                                   sext_i32_i64(segscan_group_sizze_27383)),
                                                         sext_i32_i64(max_num_groups_29281))));
        
        struct memblock_device mem_28811;
        
        mem_28811.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28811, res_25881, "mem_28811")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_28813;
        
        mem_28813.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28813, bytes_28801, "mem_28813")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_28815;
        
        mem_28815.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28815, res_25881, "mem_28815")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, res_25881)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_29282;
            
            stage1_max_num_groups_29282 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_29283;
            
            stage1_num_groups_29283 = smin64(stage1_max_num_groups_29282,
                                             num_groups_27385);
            
            int32_t num_threads_29284;
            
            num_threads_29284 = sext_i64_i32(stage1_num_groups_29283 *
                segscan_group_sizze_27383);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27388,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_27383),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27388,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              segscan_group_sizze_27383),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27388,
                                                    3, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27388,
                                                    4, sizeof(mem_28808.mem),
                                                    &mem_28808.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27388,
                                                    5, sizeof(mem_28811.mem),
                                                    &mem_28811.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27388,
                                                    6, sizeof(mem_28813.mem),
                                                    &mem_28813.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27388,
                                                    7, sizeof(mem_28815.mem),
                                                    &mem_28815.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27388,
                                                    8,
                                                    sizeof(num_threads_29284),
                                                    &num_threads_29284));
            if (1 * ((size_t) stage1_num_groups_29283 *
                     (size_t) segscan_group_sizze_27383) != 0) {
                const size_t global_work_sizze_29738[1] =
                             {(size_t) stage1_num_groups_29283 *
                             (size_t) segscan_group_sizze_27383};
                const size_t local_work_sizze_29742[1] =
                             {segscan_group_sizze_27383};
                int64_t time_start_29739 = 0, time_end_29740 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage1_27388");
                    fprintf(stderr, "%zu", global_work_sizze_29738[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29742[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_27383) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          segscan_group_sizze_27383)));
                    time_start_29739 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage1_27388,
                                                                1, NULL,
                                                                global_work_sizze_29738,
                                                                local_work_sizze_29742,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage1_27388_runs,
                                                                                                          &ctx->mainziscan_stage1_27388_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29740 = get_wall_time();
                    
                    long time_diff_29741 = time_end_29740 - time_start_29739;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage1_27388", time_diff_29741);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_27383 *
                                     sdiv_up64(res_25881,
                                               sext_i32_i64(num_threads_29284))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27388,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_29283),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27388,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              stage1_num_groups_29283),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27388,
                                                    3, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27388,
                                                    4, sizeof(mem_28811.mem),
                                                    &mem_28811.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27388,
                                                    5, sizeof(mem_28813.mem),
                                                    &mem_28813.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27388,
                                                    6,
                                                    sizeof(stage1_num_groups_29283),
                                                    &stage1_num_groups_29283));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27388,
                                                    7,
                                                    sizeof(num_threads_29284),
                                                    &num_threads_29284));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_29283) != 0) {
                const size_t global_work_sizze_29743[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_29283};
                const size_t local_work_sizze_29747[1] =
                             {stage1_num_groups_29283};
                int64_t time_start_29744 = 0, time_end_29745 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage2_27388");
                    fprintf(stderr, "%zu", global_work_sizze_29743[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29747[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_29283) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          stage1_num_groups_29283)));
                    time_start_29744 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage2_27388,
                                                                1, NULL,
                                                                global_work_sizze_29743,
                                                                local_work_sizze_29747,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage2_27388_runs,
                                                                                                          &ctx->mainziscan_stage2_27388_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29745 = get_wall_time();
                    
                    long time_diff_29746 = time_end_29745 - time_start_29744;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage2_27388", time_diff_29746);
                }
            }
            
            int32_t required_groups_29336;
            
            required_groups_29336 = sext_i64_i32(sdiv_up64(res_25881,
                                                           segscan_group_sizze_27383));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27388,
                                                    1, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27388,
                                                    2, sizeof(num_groups_27385),
                                                    &num_groups_27385));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27388,
                                                    3, sizeof(mem_28811.mem),
                                                    &mem_28811.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27388,
                                                    4, sizeof(mem_28813.mem),
                                                    &mem_28813.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27388,
                                                    5,
                                                    sizeof(num_threads_29284),
                                                    &num_threads_29284));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27388,
                                                    6,
                                                    sizeof(required_groups_29336),
                                                    &required_groups_29336));
            if (1 * ((size_t) num_groups_27385 *
                     (size_t) segscan_group_sizze_27383) != 0) {
                const size_t global_work_sizze_29748[1] =
                             {(size_t) num_groups_27385 *
                             (size_t) segscan_group_sizze_27383};
                const size_t local_work_sizze_29752[1] =
                             {segscan_group_sizze_27383};
                int64_t time_start_29749 = 0, time_end_29750 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage3_27388");
                    fprintf(stderr, "%zu", global_work_sizze_29748[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29752[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_29749 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage3_27388,
                                                                1, NULL,
                                                                global_work_sizze_29748,
                                                                local_work_sizze_29752,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage3_27388_runs,
                                                                                                          &ctx->mainziscan_stage3_27388_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29750 = get_wall_time();
                    
                    long time_diff_29751 = time_end_29750 - time_start_29749;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage3_27388", time_diff_29751);
                }
            }
        }
        if (memblock_unref_device(ctx, &mem_28811, "mem_28811") != 0)
            return 1;
        
        int64_t num_groups_27393;
        int32_t max_num_groups_29348;
        
        max_num_groups_29348 = ctx->sizes.mainzisegscan_num_groups_27392;
        num_groups_27393 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_25881,
                                                                   sext_i32_i64(segscan_group_sizze_27391)),
                                                         sext_i32_i64(max_num_groups_29348))));
        
        struct memblock_device mem_28818;
        
        mem_28818.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28818, res_25881, "mem_28818")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t bytes_28819 = 4 * res_25881;
        struct memblock_device mem_28820;
        
        mem_28820.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28820, bytes_28819, "mem_28820")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, res_25881)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_29349;
            
            stage1_max_num_groups_29349 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_29350;
            
            stage1_num_groups_29350 = smin64(stage1_max_num_groups_29349,
                                             num_groups_27393);
            
            int32_t num_threads_29351;
            
            num_threads_29351 = sext_i64_i32(stage1_num_groups_29350 *
                segscan_group_sizze_27391);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    1,
                                                    sizeof(ctx->failure_is_an_option),
                                                    &ctx->failure_is_an_option));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    3, smax64(1,
                                                              (int32_t) sizeof(float) *
                                                              segscan_group_sizze_27391),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    4, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              segscan_group_sizze_27391),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    5, sizeof(n_25421),
                                                    &n_25421));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    6, sizeof(paths_25424),
                                                    &paths_25424));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    7, sizeof(a_25429),
                                                    &a_25429));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    8, sizeof(b_25430),
                                                    &b_25430));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    9, sizeof(sigma_25431),
                                                    &sigma_25431));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    10, sizeof(flat_dim_25598),
                                                    &flat_dim_25598));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    11, sizeof(res_25861),
                                                    &res_25861));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    12, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    13, sizeof(i_27272),
                                                    &i_27272));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    14,
                                                    sizeof(res_mem_28752.mem),
                                                    &res_mem_28752.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    15,
                                                    sizeof(res_mem_28753.mem),
                                                    &res_mem_28753.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    16,
                                                    sizeof(res_mem_28754.mem),
                                                    &res_mem_28754.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    17,
                                                    sizeof(res_mem_28755.mem),
                                                    &res_mem_28755.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    18, sizeof(mem_28783.mem),
                                                    &mem_28783.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    19, sizeof(mem_28808.mem),
                                                    &mem_28808.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    20, sizeof(mem_28813.mem),
                                                    &mem_28813.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    21, sizeof(mem_28815.mem),
                                                    &mem_28815.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    22, sizeof(mem_28818.mem),
                                                    &mem_28818.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    23, sizeof(mem_28820.mem),
                                                    &mem_28820.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27396,
                                                    24,
                                                    sizeof(num_threads_29351),
                                                    &num_threads_29351));
            if (1 * ((size_t) stage1_num_groups_29350 *
                     (size_t) segscan_group_sizze_27391) != 0) {
                const size_t global_work_sizze_29753[1] =
                             {(size_t) stage1_num_groups_29350 *
                             (size_t) segscan_group_sizze_27391};
                const size_t local_work_sizze_29757[1] =
                             {segscan_group_sizze_27391};
                int64_t time_start_29754 = 0, time_end_29755 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage1_27396");
                    fprintf(stderr, "%zu", global_work_sizze_29753[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29757[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(float) *
                                              segscan_group_sizze_27391) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          segscan_group_sizze_27391)));
                    time_start_29754 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage1_27396,
                                                                1, NULL,
                                                                global_work_sizze_29753,
                                                                local_work_sizze_29757,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage1_27396_runs,
                                                                                                          &ctx->mainziscan_stage1_27396_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29755 = get_wall_time();
                    
                    long time_diff_29756 = time_end_29755 - time_start_29754;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage1_27396", time_diff_29756);
                }
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_27391 *
                                     sdiv_up64(res_25881,
                                               sext_i32_i64(num_threads_29351))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27396,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(float) *
                                                              stage1_num_groups_29350),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27396,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              stage1_num_groups_29350),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27396,
                                                    3, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27396,
                                                    4, sizeof(mem_28818.mem),
                                                    &mem_28818.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27396,
                                                    5, sizeof(mem_28820.mem),
                                                    &mem_28820.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27396,
                                                    6,
                                                    sizeof(stage1_num_groups_29350),
                                                    &stage1_num_groups_29350));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27396,
                                                    7,
                                                    sizeof(num_threads_29351),
                                                    &num_threads_29351));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_29350) != 0) {
                const size_t global_work_sizze_29758[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_29350};
                const size_t local_work_sizze_29762[1] =
                             {stage1_num_groups_29350};
                int64_t time_start_29759 = 0, time_end_29760 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage2_27396");
                    fprintf(stderr, "%zu", global_work_sizze_29758[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29762[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(float) *
                                              stage1_num_groups_29350) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          stage1_num_groups_29350)));
                    time_start_29759 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage2_27396,
                                                                1, NULL,
                                                                global_work_sizze_29758,
                                                                local_work_sizze_29762,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage2_27396_runs,
                                                                                                          &ctx->mainziscan_stage2_27396_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29760 = get_wall_time();
                    
                    long time_diff_29761 = time_end_29760 - time_start_29759;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage2_27396", time_diff_29761);
                }
            }
            
            int32_t required_groups_29403;
            
            required_groups_29403 = sext_i64_i32(sdiv_up64(res_25881,
                                                           segscan_group_sizze_27391));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27396,
                                                    1, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27396,
                                                    2, sizeof(num_groups_27393),
                                                    &num_groups_27393));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27396,
                                                    3, sizeof(mem_28818.mem),
                                                    &mem_28818.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27396,
                                                    4, sizeof(mem_28820.mem),
                                                    &mem_28820.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27396,
                                                    5,
                                                    sizeof(num_threads_29351),
                                                    &num_threads_29351));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27396,
                                                    6,
                                                    sizeof(required_groups_29403),
                                                    &required_groups_29403));
            if (1 * ((size_t) num_groups_27393 *
                     (size_t) segscan_group_sizze_27391) != 0) {
                const size_t global_work_sizze_29763[1] =
                             {(size_t) num_groups_27393 *
                             (size_t) segscan_group_sizze_27391};
                const size_t local_work_sizze_29767[1] =
                             {segscan_group_sizze_27391};
                int64_t time_start_29764 = 0, time_end_29765 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage3_27396");
                    fprintf(stderr, "%zu", global_work_sizze_29763[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29767[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_29764 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage3_27396,
                                                                1, NULL,
                                                                global_work_sizze_29763,
                                                                local_work_sizze_29767,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage3_27396_runs,
                                                                                                          &ctx->mainziscan_stage3_27396_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29765 = get_wall_time();
                    
                    long time_diff_29766 = time_end_29765 - time_start_29764;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage3_27396", time_diff_29766);
                }
            }
        }
        if (memblock_unref_device(ctx, &mem_28808, "mem_28808") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28813, "mem_28813") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28818, "mem_28818") != 0)
            return 1;
        
        int64_t num_groups_27445;
        int32_t max_num_groups_29415;
        
        max_num_groups_29415 = ctx->sizes.mainzisegscan_num_groups_27444;
        num_groups_27445 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_25881,
                                                                   sext_i32_i64(segscan_group_sizze_27443)),
                                                         sext_i32_i64(max_num_groups_29415))));
        
        struct memblock_device mem_28823;
        
        mem_28823.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28823, bytes_28801, "mem_28823")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, res_25881)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_29416;
            
            stage1_max_num_groups_29416 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_29417;
            
            stage1_num_groups_29417 = smin64(stage1_max_num_groups_29416,
                                             num_groups_27445);
            
            int32_t num_threads_29418;
            
            num_threads_29418 = sext_i64_i32(stage1_num_groups_29417 *
                segscan_group_sizze_27443);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27448,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_27443),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27448,
                                                    2, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27448,
                                                    3, sizeof(mem_28815.mem),
                                                    &mem_28815.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27448,
                                                    4, sizeof(mem_28823.mem),
                                                    &mem_28823.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage1_27448,
                                                    5,
                                                    sizeof(num_threads_29418),
                                                    &num_threads_29418));
            if (1 * ((size_t) stage1_num_groups_29417 *
                     (size_t) segscan_group_sizze_27443) != 0) {
                const size_t global_work_sizze_29768[1] =
                             {(size_t) stage1_num_groups_29417 *
                             (size_t) segscan_group_sizze_27443};
                const size_t local_work_sizze_29772[1] =
                             {segscan_group_sizze_27443};
                int64_t time_start_29769 = 0, time_end_29770 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage1_27448");
                    fprintf(stderr, "%zu", global_work_sizze_29768[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29772[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_27443)));
                    time_start_29769 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage1_27448,
                                                                1, NULL,
                                                                global_work_sizze_29768,
                                                                local_work_sizze_29772,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage1_27448_runs,
                                                                                                          &ctx->mainziscan_stage1_27448_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29770 = get_wall_time();
                    
                    long time_diff_29771 = time_end_29770 - time_start_29769;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage1_27448", time_diff_29771);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_27443 *
                                     sdiv_up64(res_25881,
                                               sext_i32_i64(num_threads_29418))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27448,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_29417),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27448,
                                                    2, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27448,
                                                    3, sizeof(mem_28823.mem),
                                                    &mem_28823.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27448,
                                                    4,
                                                    sizeof(stage1_num_groups_29417),
                                                    &stage1_num_groups_29417));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage2_27448,
                                                    5,
                                                    sizeof(num_threads_29418),
                                                    &num_threads_29418));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_29417) != 0) {
                const size_t global_work_sizze_29773[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_29417};
                const size_t local_work_sizze_29777[1] =
                             {stage1_num_groups_29417};
                int64_t time_start_29774 = 0, time_end_29775 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage2_27448");
                    fprintf(stderr, "%zu", global_work_sizze_29773[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29777[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_29417)));
                    time_start_29774 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage2_27448,
                                                                1, NULL,
                                                                global_work_sizze_29773,
                                                                local_work_sizze_29777,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage2_27448_runs,
                                                                                                          &ctx->mainziscan_stage2_27448_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29775 = get_wall_time();
                    
                    long time_diff_29776 = time_end_29775 - time_start_29774;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage2_27448", time_diff_29776);
                }
            }
            
            int32_t required_groups_29454;
            
            required_groups_29454 = sext_i64_i32(sdiv_up64(res_25881,
                                                           segscan_group_sizze_27443));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27448,
                                                    1, sizeof(res_25881),
                                                    &res_25881));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27448,
                                                    2, sizeof(num_groups_27445),
                                                    &num_groups_27445));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27448,
                                                    3, sizeof(mem_28823.mem),
                                                    &mem_28823.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27448,
                                                    4,
                                                    sizeof(num_threads_29418),
                                                    &num_threads_29418));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainziscan_stage3_27448,
                                                    5,
                                                    sizeof(required_groups_29454),
                                                    &required_groups_29454));
            if (1 * ((size_t) num_groups_27445 *
                     (size_t) segscan_group_sizze_27443) != 0) {
                const size_t global_work_sizze_29778[1] =
                             {(size_t) num_groups_27445 *
                             (size_t) segscan_group_sizze_27443};
                const size_t local_work_sizze_29782[1] =
                             {segscan_group_sizze_27443};
                int64_t time_start_29779 = 0, time_end_29780 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.scan_stage3_27448");
                    fprintf(stderr, "%zu", global_work_sizze_29778[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29782[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_29779 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainziscan_stage3_27448,
                                                                1, NULL,
                                                                global_work_sizze_29778,
                                                                local_work_sizze_29782,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainziscan_stage3_27448_runs,
                                                                                                          &ctx->mainziscan_stage3_27448_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29780 = get_wall_time();
                    
                    long time_diff_29781 = time_end_29780 - time_start_29779;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.scan_stage3_27448", time_diff_29781);
                }
            }
        }
        
        bool cond_26074 = slt64(0, res_25881);
        int64_t num_segments_26075;
        
        if (cond_26074) {
            int64_t i_26076 = sub64(res_25881, 1);
            bool x_26077 = sle64(0, i_26076);
            bool y_26078 = slt64(i_26076, res_25881);
            bool bounds_check_26079 = x_26077 && y_26078;
            bool index_certs_26080;
            
            if (!bounds_check_26079) {
                ctx->error =
                    msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s",
                              "Index [", i_26076,
                              "] out of bounds for array of shape [", res_25881,
                              "].",
                              "-> #0  /prelude/array.fut:18:29-34\n   #1  lib/github.com/diku-dk/segmented/segmented.fut:29:36-59\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:91:6-36\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #4  cva.fut:133:38-97\n   #5  /prelude/soacs.fut:56:19-23\n   #6  /prelude/soacs.fut:56:3-37\n   #7  cva.fut:126:44-136:50\n   #8  cva.fut:101:1-145:20\n");
                if (memblock_unref_device(ctx, &mem_28823, "mem_28823") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28820, "mem_28820") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28818, "mem_28818") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28815, "mem_28815") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28813, "mem_28813") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28811, "mem_28811") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28808, "mem_28808") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28806, "mem_28806") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_subhistos_mem_29068,
                                          "res_subhistos_mem_29068") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28802, "mem_28802") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &group_res_arr_mem_29030,
                                          "group_res_arr_mem_29030") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28797, "mem_28797") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28795, "mem_28795") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28785, "mem_28785") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28783, "mem_28783") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28762, "mem_28762") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28758, "mem_28758") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_mem_28755,
                                          "res_mem_28755") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_mem_28754,
                                          "res_mem_28754") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_mem_28753,
                                          "res_mem_28753") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_mem_28752,
                                          "res_mem_28752") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &group_res_arr_mem_28907,
                                          "group_res_arr_mem_28907") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &out_mem_28902,
                                          "out_mem_28902") != 0)
                    return 1;
                return 1;
            }
            
            int64_t read_res_29783;
            
            OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                         mem_28823.mem,
                                                         ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                         i_26076 *
                                                         sizeof(int64_t),
                                                         sizeof(int64_t),
                                                         &read_res_29783, 0,
                                                         NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_scalar_from_dev_runs,
                                                                                                   &ctx->copy_scalar_from_dev_total_runtime)));
            if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
                return 1;
            
            int64_t res_26081 = read_res_29783;
            
            num_segments_26075 = res_26081;
        } else {
            num_segments_26075 = 0;
        }
        
        bool bounds_invalid_upwards_26082 = slt64(num_segments_26075, 0);
        bool valid_26083 = !bounds_invalid_upwards_26082;
        bool range_valid_c_26084;
        
        if (!valid_26083) {
            ctx->error =
                msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                          "Range ", 0, "..", 1, "..<", num_segments_26075,
                          " is invalid.",
                          "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:70:18-23\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:33:17-41\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:91:6-36\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:133:38-97\n   #6  /prelude/soacs.fut:56:19-23\n   #7  /prelude/soacs.fut:56:3-37\n   #8  cva.fut:126:44-136:50\n   #9  cva.fut:101:1-145:20\n");
            if (memblock_unref_device(ctx, &mem_28823, "mem_28823") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28820, "mem_28820") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28818, "mem_28818") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28815, "mem_28815") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28813, "mem_28813") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28811, "mem_28811") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28808, "mem_28808") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28806, "mem_28806") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_subhistos_mem_29068,
                                      "res_subhistos_mem_29068") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28802, "mem_28802") != 0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_29030,
                                      "group_res_arr_mem_29030") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28797, "mem_28797") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28795, "mem_28795") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28785, "mem_28785") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28783, "mem_28783") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28762, "mem_28762") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28758, "mem_28758") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28754, "res_mem_28754") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28753, "res_mem_28753") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28752, "res_mem_28752") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_28907,
                                      "group_res_arr_mem_28907") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_28902, "out_mem_28902") !=
                0)
                return 1;
            return 1;
        }
        
        int64_t bytes_28824 = 4 * num_segments_26075;
        struct memblock_device mem_28825;
        
        mem_28825.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28825, bytes_28824, "mem_28825")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f32(ctx, mem_28825, num_segments_26075,
                                          0.0F) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t segmap_group_sizze_27453;
        
        segmap_group_sizze_27453 = ctx->sizes.mainzisegmap_group_sizze_27452;
        
        int64_t segmap_usable_groups_27454 = sdiv_up64(res_25881,
                                                       segmap_group_sizze_27453);
        
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27450, 1,
                                                sizeof(res_25881), &res_25881));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27450, 2,
                                                sizeof(num_segments_26075),
                                                &num_segments_26075));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27450, 3,
                                                sizeof(mem_28815.mem),
                                                &mem_28815.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27450, 4,
                                                sizeof(mem_28820.mem),
                                                &mem_28820.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27450, 5,
                                                sizeof(mem_28823.mem),
                                                &mem_28823.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27450, 6,
                                                sizeof(mem_28825.mem),
                                                &mem_28825.mem));
        if (1 * ((size_t) segmap_usable_groups_27454 *
                 (size_t) segmap_group_sizze_27453) != 0) {
            const size_t global_work_sizze_29784[1] =
                         {(size_t) segmap_usable_groups_27454 *
                         (size_t) segmap_group_sizze_27453};
            const size_t local_work_sizze_29788[1] = {segmap_group_sizze_27453};
            int64_t time_start_29785 = 0, time_end_29786 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "main.segmap_27450");
                fprintf(stderr, "%zu", global_work_sizze_29784[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_29788[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_29785 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->mainzisegmap_27450,
                                                            1, NULL,
                                                            global_work_sizze_29784,
                                                            local_work_sizze_29788,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->mainzisegmap_27450_runs,
                                                                                                      &ctx->mainzisegmap_27450_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_29786 = get_wall_time();
                
                long time_diff_29787 = time_end_29786 - time_start_29785;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "main.segmap_27450", time_diff_29787);
            }
        }
        if (memblock_unref_device(ctx, &mem_28815, "mem_28815") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28820, "mem_28820") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28823, "mem_28823") != 0)
            return 1;
        
        bool dim_match_26092 = flat_dim_25598 == num_segments_26075;
        bool empty_or_match_cert_26093;
        
        if (!dim_match_26092) {
            ctx->error = msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s",
                                   "Value of (core language) shape (",
                                   num_segments_26075,
                                   ") cannot match shape of type `[",
                                   flat_dim_25598, "]b`.",
                                   "-> #0  lib/github.com/diku-dk/segmented/segmented.fut:103:6-45\n   #1  cva.fut:133:38-97\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  cva.fut:126:44-136:50\n   #5  cva.fut:101:1-145:20\n");
            if (memblock_unref_device(ctx, &mem_28825, "mem_28825") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28823, "mem_28823") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28820, "mem_28820") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28818, "mem_28818") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28815, "mem_28815") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28813, "mem_28813") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28811, "mem_28811") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28808, "mem_28808") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28806, "mem_28806") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_subhistos_mem_29068,
                                      "res_subhistos_mem_29068") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28802, "mem_28802") != 0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_29030,
                                      "group_res_arr_mem_29030") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28797, "mem_28797") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28795, "mem_28795") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28785, "mem_28785") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28783, "mem_28783") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28762, "mem_28762") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28758, "mem_28758") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28754, "res_mem_28754") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28753, "res_mem_28753") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28752, "res_mem_28752") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_28907,
                                      "group_res_arr_mem_28907") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_28902, "out_mem_28902") !=
                0)
                return 1;
            return 1;
        }
        
        float res_26095;
        int32_t local_memory_capacity_29613;
        
        local_memory_capacity_29613 = ctx->opencl.max_local_memory;
        if (sle64((int32_t) sizeof(bool) + (int32_t) sizeof(float) *
                  segred_group_sizze_27468,
                  sext_i32_i64(local_memory_capacity_29613)) &&
            suff_outer_redomap_27456) {
            struct memblock_device mem_28829;
            
            mem_28829.references = NULL;
            if (memblock_alloc_device(ctx, &mem_28829, bytes_28827,
                                      "mem_28829")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_28829, 0,
                                                      mem_28825, 0, 1, n_25421,
                                                      paths_25424) != 0) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_28832;
            
            mem_28832.references = NULL;
            if (memblock_alloc_device(ctx, &mem_28832, 4, "mem_28832")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mainzicounter_mem_29480 =
                                   ctx->mainzicounter_mem_29480;
            struct memblock_device group_res_arr_mem_29482;
            
            group_res_arr_mem_29482.references = NULL;
            if (memblock_alloc_device(ctx, &group_res_arr_mem_29482,
                                      (int32_t) sizeof(float) *
                                      (segred_group_sizze_27468 *
                                       num_groups_27469),
                                      "group_res_arr_mem_29482")) {
                err = 1;
                goto cleanup;
            }
            
            int64_t num_threads_29484;
            
            num_threads_29484 = num_groups_27469 * segred_group_sizze_27468;
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegRed");
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27466,
                                                    1, (int32_t) sizeof(float) *
                                                    segred_group_sizze_27468,
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27466,
                                                    2, (int32_t) sizeof(bool),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27466,
                                                    3, sizeof(n_25421),
                                                    &n_25421));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27466,
                                                    4, sizeof(paths_25424),
                                                    &paths_25424));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27466,
                                                    5, sizeof(num_groups_27469),
                                                    &num_groups_27469));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27466,
                                                    6, sizeof(mem_28829.mem),
                                                    &mem_28829.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27466,
                                                    7, sizeof(mem_28832.mem),
                                                    &mem_28832.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27466,
                                                    8,
                                                    sizeof(mainzicounter_mem_29480.mem),
                                                    &mainzicounter_mem_29480.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27466,
                                                    9,
                                                    sizeof(group_res_arr_mem_29482.mem),
                                                    &group_res_arr_mem_29482.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27466,
                                                    10,
                                                    sizeof(num_threads_29484),
                                                    &num_threads_29484));
            if (1 * ((size_t) num_groups_27469 *
                     (size_t) segred_group_sizze_27468) != 0) {
                const size_t global_work_sizze_29790[1] =
                             {(size_t) num_groups_27469 *
                             (size_t) segred_group_sizze_27468};
                const size_t local_work_sizze_29794[1] =
                             {segred_group_sizze_27468};
                int64_t time_start_29791 = 0, time_end_29792 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.segred_nonseg_27466");
                    fprintf(stderr, "%zu", global_work_sizze_29790[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29794[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + (int32_t) sizeof(float) *
                                   segred_group_sizze_27468 +
                                   (int32_t) sizeof(bool)));
                    time_start_29791 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainzisegred_nonseg_27466,
                                                                1, NULL,
                                                                global_work_sizze_29790,
                                                                local_work_sizze_29794,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainzisegred_nonseg_27466_runs,
                                                                                                          &ctx->mainzisegred_nonseg_27466_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29792 = get_wall_time();
                    
                    long time_diff_29793 = time_end_29792 - time_start_29791;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.segred_nonseg_27466", time_diff_29793);
                }
            }
            if (memblock_unref_device(ctx, &mem_28829, "mem_28829") != 0)
                return 1;
            
            float read_res_29795;
            
            OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                         mem_28832.mem,
                                                         ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                         0 * sizeof(float),
                                                         sizeof(float),
                                                         &read_res_29795, 0,
                                                         NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_scalar_from_dev_runs,
                                                                                                   &ctx->copy_scalar_from_dev_total_runtime)));
            if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
                return 1;
            
            float res_27482 = read_res_29795;
            
            if (memblock_unref_device(ctx, &mem_28832, "mem_28832") != 0)
                return 1;
            res_26095 = res_27482;
            if (memblock_unref_device(ctx, &group_res_arr_mem_29482,
                                      "group_res_arr_mem_29482") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28832, "mem_28832") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28829, "mem_28829") != 0)
                return 1;
        } else {
            struct memblock_device res_map_acc_mem_28845;
            
            res_map_acc_mem_28845.references = NULL;
            
            int32_t local_memory_capacity_29582;
            
            local_memory_capacity_29582 = ctx->opencl.max_local_memory;
            if (sle64(0, sext_i32_i64(local_memory_capacity_29582)) &&
                suff_outer_par_27564) {
                struct memblock_device mem_28835;
                
                mem_28835.references = NULL;
                if (memblock_alloc_device(ctx, &mem_28835, bytes_28827,
                                          "mem_28835")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_28835, 0,
                                                          mem_28825, 0, 1,
                                                          n_25421,
                                                          paths_25424) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_28838;
                
                mem_28838.references = NULL;
                if (memblock_alloc_device(ctx, &mem_28838, bytes_28757,
                                          "mem_28838")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27488,
                                                        1, sizeof(n_25421),
                                                        &n_25421));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27488,
                                                        2, sizeof(paths_25424),
                                                        &paths_25424));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27488,
                                                        3,
                                                        sizeof(mem_28835.mem),
                                                        &mem_28835.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27488,
                                                        4,
                                                        sizeof(mem_28838.mem),
                                                        &mem_28838.mem));
                if (1 * ((size_t) segmap_usable_groups_27568 *
                         (size_t) segmap_group_sizze_27567) != 0) {
                    const size_t global_work_sizze_29796[1] =
                                 {(size_t) segmap_usable_groups_27568 *
                                 (size_t) segmap_group_sizze_27567};
                    const size_t local_work_sizze_29800[1] =
                                 {segmap_group_sizze_27567};
                    int64_t time_start_29797 = 0, time_end_29798 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "main.segmap_27488");
                        fprintf(stderr, "%zu", global_work_sizze_29796[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_29800[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) 0);
                        time_start_29797 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->mainzisegmap_27488,
                                                                    1, NULL,
                                                                    global_work_sizze_29796,
                                                                    local_work_sizze_29800,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->mainzisegmap_27488_runs,
                                                                                                              &ctx->mainzisegmap_27488_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_29798 = get_wall_time();
                        
                        long time_diff_29799 = time_end_29798 -
                             time_start_29797;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "main.segmap_27488", time_diff_29799);
                    }
                }
                if (memblock_unref_device(ctx, &mem_28835, "mem_28835") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_map_acc_mem_28845, &mem_28838,
                                        "mem_28838") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28838, "mem_28838") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28835, "mem_28835") != 0)
                    return 1;
            } else {
                struct memblock_device mem_28841;
                
                mem_28841.references = NULL;
                if (memblock_alloc_device(ctx, &mem_28841, bytes_28757,
                                          "mem_28841")) {
                    err = 1;
                    goto cleanup;
                }
                if (slt64(n_25421 * 2, segred_group_sizze_27579)) {
                    int64_t segment_sizze_nonzzero_29517 = smax64(1, n_25421);
                    int64_t num_threads_29518 = num_groups_27580 *
                            segred_group_sizze_27579;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-small");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) paths_25424, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) n_25421, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segments_per_group",
                                (long long) squot64(segred_group_sizze_27579,
                                                    segment_sizze_nonzzero_29517),
                                '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "required_groups",
                                (long long) sext_i64_i32(sdiv_up64(paths_25424,
                                                                   squot64(segred_group_sizze_27579,
                                                                           segment_sizze_nonzzero_29517))),
                                '\n');
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_27529,
                                                            1,
                                                            (int32_t) sizeof(float) *
                                                            segred_group_sizze_27579,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_27529,
                                                            2, sizeof(n_25421),
                                                            &n_25421));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_27529,
                                                            3,
                                                            sizeof(paths_25424),
                                                            &paths_25424));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_27529,
                                                            4,
                                                            sizeof(num_groups_27580),
                                                            &num_groups_27580));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_27529,
                                                            5,
                                                            sizeof(mem_28825.mem),
                                                            &mem_28825.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_27529,
                                                            6,
                                                            sizeof(mem_28841.mem),
                                                            &mem_28841.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_small_27529,
                                                            7,
                                                            sizeof(segment_sizze_nonzzero_29517),
                                                            &segment_sizze_nonzzero_29517));
                    if (1 * ((size_t) num_groups_27580 *
                             (size_t) segred_group_sizze_27579) != 0) {
                        const size_t global_work_sizze_29801[1] =
                                     {(size_t) num_groups_27580 *
                                     (size_t) segred_group_sizze_27579};
                        const size_t local_work_sizze_29805[1] =
                                     {segred_group_sizze_27579};
                        int64_t time_start_29802 = 0, time_end_29803 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.segred_small_27529");
                            fprintf(stderr, "%zu", global_work_sizze_29801[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29805[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(float) *
                                           segred_group_sizze_27579));
                            time_start_29802 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainzisegred_small_27529,
                                                                        1, NULL,
                                                                        global_work_sizze_29801,
                                                                        local_work_sizze_29805,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainzisegred_small_27529_runs,
                                                                                                                  &ctx->mainzisegred_small_27529_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29803 = get_wall_time();
                            
                            long time_diff_29804 = time_end_29803 -
                                 time_start_29802;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.segred_small_27529", time_diff_29804);
                        }
                    }
                } else {
                    int64_t groups_per_segment_29538 =
                            sdiv_up64(num_groups_27580, smax64(1, paths_25424));
                    int64_t elements_per_thread_29539 = sdiv_up64(n_25421,
                                                                  segred_group_sizze_27579 *
                                                                  groups_per_segment_29538);
                    int64_t virt_num_groups_29540 = groups_per_segment_29538 *
                            paths_25424;
                    int64_t num_threads_29541 = num_groups_27580 *
                            segred_group_sizze_27579;
                    int64_t threads_per_segment_29542 =
                            groups_per_segment_29538 * segred_group_sizze_27579;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-large");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) paths_25424, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) n_25421, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                                (long long) virt_num_groups_29540, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_groups",
                                (long long) num_groups_27580, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "group_size",
                                (long long) segred_group_sizze_27579, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                                (long long) elements_per_thread_29539, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                                (long long) groups_per_segment_29538, '\n');
                    
                    struct memblock_device group_res_arr_mem_29543;
                    
                    group_res_arr_mem_29543.references = NULL;
                    if (memblock_alloc_device(ctx, &group_res_arr_mem_29543,
                                              (int32_t) sizeof(float) *
                                              (segred_group_sizze_27579 *
                                               virt_num_groups_29540),
                                              "group_res_arr_mem_29543")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    struct memblock_device mainzicounter_mem_29545 =
                                           ctx->mainzicounter_mem_29545;
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            1,
                                                            (int32_t) sizeof(bool),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            2,
                                                            (int32_t) sizeof(float) *
                                                            segred_group_sizze_27579,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            3, sizeof(n_25421),
                                                            &n_25421));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            4,
                                                            sizeof(num_groups_27580),
                                                            &num_groups_27580));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            5,
                                                            sizeof(mem_28825.mem),
                                                            &mem_28825.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            6,
                                                            sizeof(mem_28841.mem),
                                                            &mem_28841.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            7,
                                                            sizeof(groups_per_segment_29538),
                                                            &groups_per_segment_29538));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            8,
                                                            sizeof(elements_per_thread_29539),
                                                            &elements_per_thread_29539));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            9,
                                                            sizeof(virt_num_groups_29540),
                                                            &virt_num_groups_29540));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            10,
                                                            sizeof(threads_per_segment_29542),
                                                            &threads_per_segment_29542));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            11,
                                                            sizeof(group_res_arr_mem_29543.mem),
                                                            &group_res_arr_mem_29543.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_large_27529,
                                                            12,
                                                            sizeof(mainzicounter_mem_29545.mem),
                                                            &mainzicounter_mem_29545.mem));
                    if (1 * ((size_t) num_groups_27580 *
                             (size_t) segred_group_sizze_27579) != 0) {
                        const size_t global_work_sizze_29807[1] =
                                     {(size_t) num_groups_27580 *
                                     (size_t) segred_group_sizze_27579};
                        const size_t local_work_sizze_29811[1] =
                                     {segred_group_sizze_27579};
                        int64_t time_start_29808 = 0, time_end_29809 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "main.segred_large_27529");
                            fprintf(stderr, "%zu", global_work_sizze_29807[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29811[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(bool) +
                                           (int32_t) sizeof(float) *
                                           segred_group_sizze_27579));
                            time_start_29808 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->mainzisegred_large_27529,
                                                                        1, NULL,
                                                                        global_work_sizze_29807,
                                                                        local_work_sizze_29811,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->mainzisegred_large_27529_runs,
                                                                                                                  &ctx->mainzisegred_large_27529_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29809 = get_wall_time();
                            
                            long time_diff_29810 = time_end_29809 -
                                 time_start_29808;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "main.segred_large_27529", time_diff_29810);
                        }
                    }
                    if (memblock_unref_device(ctx, &group_res_arr_mem_29543,
                                              "group_res_arr_mem_29543") != 0)
                        return 1;
                }
                
                struct memblock_device mem_28844;
                
                mem_28844.references = NULL;
                if (memblock_alloc_device(ctx, &mem_28844, bytes_28757,
                                          "mem_28844")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27513,
                                                        1, sizeof(paths_25424),
                                                        &paths_25424));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27513,
                                                        2,
                                                        sizeof(mem_28841.mem),
                                                        &mem_28841.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegmap_27513,
                                                        3,
                                                        sizeof(mem_28844.mem),
                                                        &mem_28844.mem));
                if (1 * ((size_t) segmap_usable_groups_27590 *
                         (size_t) segmap_group_sizze_27589) != 0) {
                    const size_t global_work_sizze_29812[1] =
                                 {(size_t) segmap_usable_groups_27590 *
                                 (size_t) segmap_group_sizze_27589};
                    const size_t local_work_sizze_29816[1] =
                                 {segmap_group_sizze_27589};
                    int64_t time_start_29813 = 0, time_end_29814 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "main.segmap_27513");
                        fprintf(stderr, "%zu", global_work_sizze_29812[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_29816[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) 0);
                        time_start_29813 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->mainzisegmap_27513,
                                                                    1, NULL,
                                                                    global_work_sizze_29812,
                                                                    local_work_sizze_29816,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->mainzisegmap_27513_runs,
                                                                                                              &ctx->mainzisegmap_27513_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_29814 = get_wall_time();
                        
                        long time_diff_29815 = time_end_29814 -
                             time_start_29813;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "main.segmap_27513", time_diff_29815);
                    }
                }
                if (memblock_unref_device(ctx, &mem_28841, "mem_28841") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_map_acc_mem_28845, &mem_28844,
                                        "mem_28844") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28844, "mem_28844") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28841, "mem_28841") != 0)
                    return 1;
            }
            
            struct memblock_device mem_28848;
            
            mem_28848.references = NULL;
            if (memblock_alloc_device(ctx, &mem_28848, 4, "mem_28848")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mainzicounter_mem_29583 =
                                   ctx->mainzicounter_mem_29583;
            struct memblock_device group_res_arr_mem_29585;
            
            group_res_arr_mem_29585.references = NULL;
            if (memblock_alloc_device(ctx, &group_res_arr_mem_29585,
                                      (int32_t) sizeof(float) *
                                      (segred_group_sizze_27596 *
                                       num_groups_27597),
                                      "group_res_arr_mem_29585")) {
                err = 1;
                goto cleanup;
            }
            
            int64_t num_threads_29587;
            
            num_threads_29587 = num_groups_27597 * segred_group_sizze_27596;
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegRed");
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27562,
                                                    1, (int32_t) sizeof(float) *
                                                    segred_group_sizze_27596,
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27562,
                                                    2, (int32_t) sizeof(bool),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27562,
                                                    3, sizeof(paths_25424),
                                                    &paths_25424));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27562,
                                                    4, sizeof(num_groups_27597),
                                                    &num_groups_27597));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27562,
                                                    5,
                                                    sizeof(res_map_acc_mem_28845.mem),
                                                    &res_map_acc_mem_28845.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27562,
                                                    6, sizeof(mem_28848.mem),
                                                    &mem_28848.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27562,
                                                    7,
                                                    sizeof(mainzicounter_mem_29583.mem),
                                                    &mainzicounter_mem_29583.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27562,
                                                    8,
                                                    sizeof(group_res_arr_mem_29585.mem),
                                                    &group_res_arr_mem_29585.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->mainzisegred_nonseg_27562,
                                                    9,
                                                    sizeof(num_threads_29587),
                                                    &num_threads_29587));
            if (1 * ((size_t) num_groups_27597 *
                     (size_t) segred_group_sizze_27596) != 0) {
                const size_t global_work_sizze_29818[1] =
                             {(size_t) num_groups_27597 *
                             (size_t) segred_group_sizze_27596};
                const size_t local_work_sizze_29822[1] =
                             {segred_group_sizze_27596};
                int64_t time_start_29819 = 0, time_end_29820 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "main.segred_nonseg_27562");
                    fprintf(stderr, "%zu", global_work_sizze_29818[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29822[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + (int32_t) sizeof(float) *
                                   segred_group_sizze_27596 +
                                   (int32_t) sizeof(bool)));
                    time_start_29819 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->mainzisegred_nonseg_27562,
                                                                1, NULL,
                                                                global_work_sizze_29818,
                                                                local_work_sizze_29822,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->mainzisegred_nonseg_27562_runs,
                                                                                                          &ctx->mainzisegred_nonseg_27562_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29820 = get_wall_time();
                    
                    long time_diff_29821 = time_end_29820 - time_start_29819;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "main.segred_nonseg_27562", time_diff_29821);
                }
            }
            if (memblock_unref_device(ctx, &res_map_acc_mem_28845,
                                      "res_map_acc_mem_28845") != 0)
                return 1;
            
            float read_res_29823;
            
            OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                         mem_28848.mem,
                                                         ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                         0 * sizeof(float),
                                                         sizeof(float),
                                                         &read_res_29823, 0,
                                                         NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_scalar_from_dev_runs,
                                                                                                   &ctx->copy_scalar_from_dev_total_runtime)));
            if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
                return 1;
            
            float res_27604 = read_res_29823;
            
            if (memblock_unref_device(ctx, &mem_28848, "mem_28848") != 0)
                return 1;
            res_26095 = res_27604;
            if (memblock_unref_device(ctx, &group_res_arr_mem_29585,
                                      "group_res_arr_mem_29585") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28848, "mem_28848") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_map_acc_mem_28845,
                                      "res_map_acc_mem_28845") != 0)
                return 1;
        }
        if (memblock_unref_device(ctx, &mem_28825, "mem_28825") != 0)
            return 1;
        
        float res_26106 = res_26095 / res_25602;
        float negate_arg_26107 = a_25429 * res_25861;
        float exp_arg_26108 = 0.0F - negate_arg_26107;
        float res_26109 = fpow32(2.7182817F, exp_arg_26108);
        float x_26110 = 1.0F - res_26109;
        float B_26111 = x_26110 / a_25429;
        float x_26112 = B_26111 - res_25861;
        float x_26113 = y_25453 * x_26112;
        float A1_26114 = x_26113 / x_25449;
        float y_26115 = fpow32(B_26111, 2.0F);
        float x_26116 = x_25451 * y_26115;
        float A2_26117 = x_26116 / y_25454;
        float exp_arg_26118 = A1_26114 - A2_26117;
        float res_26119 = fpow32(2.7182817F, exp_arg_26118);
        float negate_arg_26120 = 5.0e-2F * B_26111;
        float exp_arg_26121 = 0.0F - negate_arg_26120;
        float res_26122 = fpow32(2.7182817F, exp_arg_26121);
        float res_26123 = res_26119 * res_26122;
        float res_26124 = res_26106 * res_26123;
        float res_25857 = res_26124 + redout_27270;
        
        {
            float write_tmp_29824 = res_26106;
            
            OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                          mem_28785.mem,
                                                          CL_TRUE, i_27272 *
                                                          sizeof(float),
                                                          sizeof(float),
                                                          &write_tmp_29824, 0,
                                                          NULL,
                                                          ctx->profiling_paused ||
                                                          !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                    &ctx->copy_scalar_to_dev_runs,
                                                                                                    &ctx->copy_scalar_to_dev_total_runtime)));
        }
        
        float redout_tmp_28976 = res_25857;
        
        redout_27270 = redout_tmp_28976;
        if (memblock_unref_device(ctx, &mem_28825, "mem_28825") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28823, "mem_28823") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28820, "mem_28820") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28818, "mem_28818") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28815, "mem_28815") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28813, "mem_28813") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28811, "mem_28811") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28808, "mem_28808") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28806, "mem_28806") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_subhistos_mem_29068,
                                  "res_subhistos_mem_29068") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28802, "mem_28802") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_29030,
                                  "group_res_arr_mem_29030") != 0)
            return 1;
    }
    res_25853 = redout_27270;
    if (memblock_unref_device(ctx, &res_mem_28752, "res_mem_28752") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28753, "res_mem_28753") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28754, "res_mem_28754") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28783, "mem_28783") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28795, "mem_28795") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28797, "mem_28797") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
        return 1;
    
    float CVA_26127 = 6.0e-3F * res_25853;
    struct memblock_device mem_28855;
    
    mem_28855.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28855, bytes_28767, "mem_28855")) {
        err = 1;
        goto cleanup;
    }
    if (steps_25425 * (int32_t) sizeof(float) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                     mem_28785.mem,
                                                     mem_28855.mem, 0, 0,
                                                     steps_25425 *
                                                     (int32_t) sizeof(float), 0,
                                                     NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
        if (ctx->debugging)
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
    }
    if (memblock_unref_device(ctx, &mem_28785, "mem_28785") != 0)
        return 1;
    out_arrsizze_28903 = steps_25425;
    if (memblock_set_device(ctx, &out_mem_28902, &mem_28855, "mem_28855") != 0)
        return 1;
    scalar_out_28901 = CVA_26127;
    *out_scalar_out_29644 = scalar_out_28901;
    (*out_mem_p_29645).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_29645, &out_mem_28902,
                            "out_mem_28902") != 0)
        return 1;
    *out_out_arrsizze_29646 = out_arrsizze_28903;
    if (memblock_unref_device(ctx, &mem_28855, "mem_28855") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28797, "mem_28797") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28795, "mem_28795") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28785, "mem_28785") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28783, "mem_28783") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28762, "mem_28762") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28758, "mem_28758") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28754, "res_mem_28754") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28753, "res_mem_28753") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28752, "res_mem_28752") != 0)
        return 1;
    if (memblock_unref_device(ctx, &group_res_arr_mem_28907,
                              "group_res_arr_mem_28907") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_28902, "out_mem_28902") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
static int futrts_test(struct futhark_context *ctx, float *out_scalar_out_29825,
                       int64_t paths_26128, int64_t steps_26129)
{
    (void) ctx;
    
    int err = 0;
    float scalar_out_28901;
    struct memblock_device mem_28729;
    
    mem_28729.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28729, 180, "mem_28729")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device testzistatic_array_28902 =
                           ctx->testzistatic_array_28902;
    
    if (45 * (int32_t) sizeof(float) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                     testzistatic_array_28902.mem,
                                                     mem_28729.mem, 0, 0, 45 *
                                                     (int32_t) sizeof(float), 0,
                                                     NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
        if (ctx->debugging)
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
    }
    
    struct memblock_device mem_28731;
    
    mem_28731.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28731, 360, "mem_28731")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device testzistatic_array_28903 =
                           ctx->testzistatic_array_28903;
    
    if (45 * (int32_t) sizeof(int64_t) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                     testzistatic_array_28903.mem,
                                                     mem_28731.mem, 0, 0, 45 *
                                                     (int32_t) sizeof(int64_t),
                                                     0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
        if (ctx->debugging)
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
    }
    
    struct memblock_device mem_28733;
    
    mem_28733.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28733, 180, "mem_28733")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device testzistatic_array_28904 =
                           ctx->testzistatic_array_28904;
    
    if (45 * (int32_t) sizeof(float) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                     testzistatic_array_28904.mem,
                                                     mem_28733.mem, 0, 0, 45 *
                                                     (int32_t) sizeof(float), 0,
                                                     NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
        if (ctx->debugging)
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
    }
    
    int64_t segred_group_sizze_27608;
    
    segred_group_sizze_27608 = ctx->sizes.testzisegred_group_sizze_27607;
    
    int64_t num_groups_27610;
    int32_t max_num_groups_28905;
    
    max_num_groups_28905 = ctx->sizes.testzisegred_num_groups_27609;
    num_groups_27610 = sext_i64_i32(smax64(1, smin64(sdiv_up64(45,
                                                               sext_i32_i64(segred_group_sizze_27608)),
                                                     sext_i32_i64(max_num_groups_28905))));
    
    struct memblock_device mem_28736;
    
    mem_28736.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28736, 4, "mem_28736")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device testzicounter_mem_28906 =
                           ctx->testzicounter_mem_28906;
    struct memblock_device group_res_arr_mem_28908;
    
    group_res_arr_mem_28908.references = NULL;
    if (memblock_alloc_device(ctx, &group_res_arr_mem_28908,
                              (int32_t) sizeof(float) *
                              (segred_group_sizze_27608 * num_groups_27610),
                              "group_res_arr_mem_28908")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_threads_28910;
    
    num_threads_28910 = num_groups_27610 * segred_group_sizze_27608;
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegRed");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_27615, 1,
                                            (int32_t) sizeof(float) *
                                            segred_group_sizze_27608, NULL));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_27615, 2,
                                            (int32_t) sizeof(bool), NULL));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_27615, 3,
                                            sizeof(num_groups_27610),
                                            &num_groups_27610));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_27615, 4,
                                            sizeof(mem_28731.mem),
                                            &mem_28731.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_27615, 5,
                                            sizeof(mem_28733.mem),
                                            &mem_28733.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_27615, 6,
                                            sizeof(mem_28736.mem),
                                            &mem_28736.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_27615, 7,
                                            sizeof(testzicounter_mem_28906.mem),
                                            &testzicounter_mem_28906.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_27615, 8,
                                            sizeof(group_res_arr_mem_28908.mem),
                                            &group_res_arr_mem_28908.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_27615, 9,
                                            sizeof(num_threads_28910),
                                            &num_threads_28910));
    if (1 * ((size_t) num_groups_27610 * (size_t) segred_group_sizze_27608) !=
        0) {
        const size_t global_work_sizze_29830[1] = {(size_t) num_groups_27610 *
                     (size_t) segred_group_sizze_27608};
        const size_t local_work_sizze_29834[1] = {segred_group_sizze_27608};
        int64_t time_start_29831 = 0, time_end_29832 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "test.segred_nonseg_27615");
            fprintf(stderr, "%zu", global_work_sizze_29830[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_29834[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) (0 + (int32_t) sizeof(float) *
                           segred_group_sizze_27608 + (int32_t) sizeof(bool)));
            time_start_29831 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->testzisegred_nonseg_27615,
                                                        1, NULL,
                                                        global_work_sizze_29830,
                                                        local_work_sizze_29834,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->testzisegred_nonseg_27615_runs,
                                                                                                  &ctx->testzisegred_nonseg_27615_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_29832 = get_wall_time();
            
            long time_diff_29833 = time_end_29832 - time_start_29831;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n",
                    "test.segred_nonseg_27615", time_diff_29833);
        }
    }
    
    float read_res_29835;
    
    OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                 mem_28736.mem,
                                                 ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                 0 * sizeof(float),
                                                 sizeof(float), &read_res_29835,
                                                 0, NULL,
                                                 ctx->profiling_paused ||
                                                 !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                           &ctx->copy_scalar_from_dev_runs,
                                                                                           &ctx->copy_scalar_from_dev_total_runtime)));
    if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
        return 1;
    
    float res_26133 = read_res_29835;
    
    if (memblock_unref_device(ctx, &mem_28736, "mem_28736") != 0)
        return 1;
    
    float res_26141 = sitofp_i64_f32(steps_26129);
    float dt_26142 = res_26133 / res_26141;
    bool suff_outer_par_27617;
    
    suff_outer_par_27617 = ctx->sizes.testzisuff_outer_par_0 <= 45;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "test.suff_outer_par_0", 45);
    
    int64_t segmap_group_sizze_27685;
    
    segmap_group_sizze_27685 = ctx->sizes.testzisegmap_group_sizze_27621;
    
    int64_t segmap_group_sizze_27834;
    
    segmap_group_sizze_27834 = ctx->sizes.testzisegmap_group_sizze_27770;
    
    struct memblock_device res_mem_28755;
    
    res_mem_28755.references = NULL;
    
    struct memblock_device res_mem_28756;
    
    res_mem_28756.references = NULL;
    
    struct memblock_device res_mem_28757;
    
    res_mem_28757.references = NULL;
    
    struct memblock_device res_mem_28758;
    
    res_mem_28758.references = NULL;
    
    int32_t local_memory_capacity_28948;
    
    local_memory_capacity_28948 = ctx->opencl.max_local_memory;
    if (sle64(0, sext_i32_i64(local_memory_capacity_28948)) &&
        suff_outer_par_27617) {
        int64_t segmap_usable_groups_27686 = sdiv_up64(45,
                                                       segmap_group_sizze_27685);
        struct memblock_device mem_28738;
        
        mem_28738.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28738, 180, "mem_28738")) {
            err = 1;
            goto cleanup;
        }
        if (45 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         mem_28733.mem,
                                                         mem_28738.mem, 0, 0,
                                                         45 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28740;
        
        mem_28740.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28740, 360, "mem_28740")) {
            err = 1;
            goto cleanup;
        }
        if (45 * (int32_t) sizeof(int64_t) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         mem_28731.mem,
                                                         mem_28740.mem, 0, 0,
                                                         45 *
                                                         (int32_t) sizeof(int64_t),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28742;
        
        mem_28742.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28742, 180, "mem_28742")) {
            err = 1;
            goto cleanup;
        }
        if (45 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         mem_28729.mem,
                                                         mem_28742.mem, 0, 0,
                                                         45 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28745;
        
        mem_28745.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28745, 180, "mem_28745")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_27619, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_27619, 3,
                                                sizeof(mem_28731.mem),
                                                &mem_28731.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_27619, 4,
                                                sizeof(mem_28733.mem),
                                                &mem_28733.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_27619, 5,
                                                sizeof(mem_28745.mem),
                                                &mem_28745.mem));
        if (1 * ((size_t) segmap_usable_groups_27686 *
                 (size_t) segmap_group_sizze_27685) != 0) {
            const size_t global_work_sizze_29836[1] =
                         {(size_t) segmap_usable_groups_27686 *
                         (size_t) segmap_group_sizze_27685};
            const size_t local_work_sizze_29840[1] = {segmap_group_sizze_27685};
            int64_t time_start_29837 = 0, time_end_29838 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "test.segmap_27619");
                fprintf(stderr, "%zu", global_work_sizze_29836[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_29840[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_29837 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->testzisegmap_27619,
                                                            1, NULL,
                                                            global_work_sizze_29836,
                                                            local_work_sizze_29840,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->testzisegmap_27619_runs,
                                                                                                      &ctx->testzisegmap_27619_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_29838 = get_wall_time();
                
                long time_diff_29839 = time_end_29838 - time_start_29837;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "test.segmap_27619", time_diff_29839);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_set_device(ctx, &res_mem_28755, &mem_28745, "mem_28745") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28756, &mem_28742, "mem_28742") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28757, &mem_28740, "mem_28740") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28758, &mem_28738, "mem_28738") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28745, "mem_28745") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28742, "mem_28742") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28740, "mem_28740") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28738, "mem_28738") != 0)
            return 1;
    } else {
        int64_t segmap_usable_groups_27835 = sdiv_up64(45,
                                                       segmap_group_sizze_27834);
        struct memblock_device mem_28747;
        
        mem_28747.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28747, 180, "mem_28747")) {
            err = 1;
            goto cleanup;
        }
        if (45 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         mem_28733.mem,
                                                         mem_28747.mem, 0, 0,
                                                         45 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28749;
        
        mem_28749.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28749, 360, "mem_28749")) {
            err = 1;
            goto cleanup;
        }
        if (45 * (int32_t) sizeof(int64_t) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         mem_28731.mem,
                                                         mem_28749.mem, 0, 0,
                                                         45 *
                                                         (int32_t) sizeof(int64_t),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28751;
        
        mem_28751.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28751, 180, "mem_28751")) {
            err = 1;
            goto cleanup;
        }
        if (45 * (int32_t) sizeof(float) > 0) {
            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                         mem_28729.mem,
                                                         mem_28751.mem, 0, 0,
                                                         45 *
                                                         (int32_t) sizeof(float),
                                                         0, NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
            if (ctx->debugging)
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
        }
        
        struct memblock_device mem_28754;
        
        mem_28754.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28754, 180, "mem_28754")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_27768, 1,
                                                sizeof(ctx->failure_is_an_option),
                                                &ctx->failure_is_an_option));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_27768, 3,
                                                sizeof(mem_28731.mem),
                                                &mem_28731.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_27768, 4,
                                                sizeof(mem_28733.mem),
                                                &mem_28733.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_27768, 5,
                                                sizeof(mem_28754.mem),
                                                &mem_28754.mem));
        if (1 * ((size_t) segmap_usable_groups_27835 *
                 (size_t) segmap_group_sizze_27834) != 0) {
            const size_t global_work_sizze_29841[1] =
                         {(size_t) segmap_usable_groups_27835 *
                         (size_t) segmap_group_sizze_27834};
            const size_t local_work_sizze_29845[1] = {segmap_group_sizze_27834};
            int64_t time_start_29842 = 0, time_end_29843 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "test.segmap_27768");
                fprintf(stderr, "%zu", global_work_sizze_29841[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_29845[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_29842 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->testzisegmap_27768,
                                                            1, NULL,
                                                            global_work_sizze_29841,
                                                            local_work_sizze_29845,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->testzisegmap_27768_runs,
                                                                                                      &ctx->testzisegmap_27768_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_29843 = get_wall_time();
                
                long time_diff_29844 = time_end_29843 - time_start_29842;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "test.segmap_27768", time_diff_29844);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_set_device(ctx, &res_mem_28755, &mem_28754, "mem_28754") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28756, &mem_28751, "mem_28751") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28757, &mem_28749, "mem_28749") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_28758, &mem_28747, "mem_28747") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28754, "mem_28754") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28751, "mem_28751") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28749, "mem_28749") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28747, "mem_28747") != 0)
            return 1;
    }
    if (memblock_unref_device(ctx, &mem_28729, "mem_28729") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28731, "mem_28731") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
        return 1;
    
    float sims_per_year_26208 = res_26141 / res_26133;
    bool bounds_invalid_upwards_26209 = slt64(steps_26129, 1);
    bool valid_26210 = !bounds_invalid_upwards_26209;
    bool range_valid_c_26211;
    
    if (!valid_26210) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 1, "..", 2, "...", steps_26129,
                               " is invalid.",
                               "-> #0  cva.fut:60:56-67\n   #1  cva.fut:112:17-44\n   #2  cva.fut:154:3-156:129\n   #3  cva.fut:153:1-156:137\n");
        if (memblock_unref_device(ctx, &res_mem_28758, "res_mem_28758") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28757, "res_mem_28757") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28756, "res_mem_28756") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_28908,
                                  "group_res_arr_mem_28908") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28736, "mem_28736") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28731, "mem_28731") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28729, "mem_28729") != 0)
            return 1;
        return 1;
    }
    
    bool bounds_invalid_upwards_26213 = slt64(paths_26128, 0);
    bool valid_26214 = !bounds_invalid_upwards_26213;
    bool range_valid_c_26215;
    
    if (!valid_26214) {
        ctx->error = msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", paths_26128,
                               " is invalid.",
                               "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:126:11-16\n   #2  lib/github.com/diku-dk/cpprandom/random.fut:174:8-56\n   #3  cva.fut:115:19-49\n   #4  cva.fut:154:3-156:129\n   #5  cva.fut:153:1-156:137\n");
        if (memblock_unref_device(ctx, &res_mem_28758, "res_mem_28758") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28757, "res_mem_28757") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28756, "res_mem_28756") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_28908,
                                  "group_res_arr_mem_28908") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28736, "mem_28736") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28731, "mem_28731") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28729, "mem_28729") != 0)
            return 1;
        return 1;
    }
    
    int64_t upper_bound_26218 = sub64(steps_26129, 1);
    float res_26219;
    
    res_26219 = futrts_sqrt32(dt_26142);
    
    int64_t segmap_group_sizze_28224;
    
    segmap_group_sizze_28224 = ctx->sizes.testzisegmap_group_sizze_28207;
    
    int64_t segmap_usable_groups_28225 = sdiv_up64(paths_26128,
                                                   segmap_group_sizze_28224);
    int64_t bytes_28760 = 4 * paths_26128;
    struct memblock_device mem_28761;
    
    mem_28761.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28761, bytes_28760, "mem_28761")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28205, 1,
                                            sizeof(paths_26128), &paths_26128));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28205, 2,
                                            sizeof(mem_28761.mem),
                                            &mem_28761.mem));
    if (1 * ((size_t) segmap_usable_groups_28225 *
             (size_t) segmap_group_sizze_28224) != 0) {
        const size_t global_work_sizze_29846[1] =
                     {(size_t) segmap_usable_groups_28225 *
                     (size_t) segmap_group_sizze_28224};
        const size_t local_work_sizze_29850[1] = {segmap_group_sizze_28224};
        int64_t time_start_29847 = 0, time_end_29848 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "test.segmap_28205");
            fprintf(stderr, "%zu", global_work_sizze_29846[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_29850[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_29847 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->testzisegmap_28205,
                                                        1, NULL,
                                                        global_work_sizze_29846,
                                                        local_work_sizze_29850,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->testzisegmap_28205_runs,
                                                                                                  &ctx->testzisegmap_28205_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_29848 = get_wall_time();
            
            long time_diff_29849 = time_end_29848 - time_start_29847;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n", "test.segmap_28205",
                    time_diff_29849);
        }
    }
    
    int64_t nest_sizze_28248 = paths_26128 * steps_26129;
    int64_t segmap_group_sizze_28249;
    
    segmap_group_sizze_28249 = ctx->sizes.testzisegmap_group_sizze_28144;
    
    int64_t segmap_usable_groups_28250 = sdiv_up64(nest_sizze_28248,
                                                   segmap_group_sizze_28249);
    int64_t bytes_28763 = 4 * nest_sizze_28248;
    struct memblock_device mem_28765;
    
    mem_28765.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28765, bytes_28763, "mem_28765")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28141, 1,
                                            sizeof(paths_26128), &paths_26128));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28141, 2,
                                            sizeof(steps_26129), &steps_26129));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28141, 3,
                                            sizeof(mem_28761.mem),
                                            &mem_28761.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28141, 4,
                                            sizeof(mem_28765.mem),
                                            &mem_28765.mem));
    if (1 * ((size_t) segmap_usable_groups_28250 *
             (size_t) segmap_group_sizze_28249) != 0) {
        const size_t global_work_sizze_29851[1] =
                     {(size_t) segmap_usable_groups_28250 *
                     (size_t) segmap_group_sizze_28249};
        const size_t local_work_sizze_29855[1] = {segmap_group_sizze_28249};
        int64_t time_start_29852 = 0, time_end_29853 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "test.segmap_28141");
            fprintf(stderr, "%zu", global_work_sizze_29851[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_29855[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_29852 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->testzisegmap_28141,
                                                        1, NULL,
                                                        global_work_sizze_29851,
                                                        local_work_sizze_29855,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->testzisegmap_28141_runs,
                                                                                                  &ctx->testzisegmap_28141_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_29853 = get_wall_time();
            
            long time_diff_29854 = time_end_29853 - time_start_29852;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n", "test.segmap_28141",
                    time_diff_29854);
        }
    }
    if (memblock_unref_device(ctx, &mem_28761, "mem_28761") != 0)
        return 1;
    
    int64_t segmap_group_sizze_28294;
    
    segmap_group_sizze_28294 = ctx->sizes.testzisegmap_group_sizze_28045;
    
    int64_t num_groups_28295;
    int32_t max_num_groups_28959;
    
    max_num_groups_28959 = ctx->sizes.testzisegmap_num_groups_28047;
    num_groups_28295 = sext_i64_i32(smax64(1, smin64(sdiv_up64(paths_26128,
                                                               sext_i32_i64(segmap_group_sizze_28294)),
                                                     sext_i32_i64(max_num_groups_28959))));
    
    struct memblock_device mem_28768;
    
    mem_28768.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28768, bytes_28763, "mem_28768")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_28768, 0, mem_28765, 0,
                                              1, steps_26129, paths_26128) !=
        0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
        return 1;
    
    struct memblock_device mem_28786;
    
    mem_28786.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28786, bytes_28763, "mem_28786")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_28770 = 4 * steps_26129;
    int64_t num_threads_28886 = segmap_group_sizze_28294 * num_groups_28295;
    int64_t total_sizze_28887 = bytes_28770 * num_threads_28886;
    struct memblock_device mem_28771;
    
    mem_28771.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28771, total_sizze_28887,
                              "mem_28771")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28043, 1,
                                            sizeof(ctx->failure_is_an_option),
                                            &ctx->failure_is_an_option));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28043, 3,
                                            sizeof(paths_26128), &paths_26128));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28043, 4,
                                            sizeof(steps_26129), &steps_26129));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28043, 5,
                                            sizeof(dt_26142), &dt_26142));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28043, 6,
                                            sizeof(upper_bound_26218),
                                            &upper_bound_26218));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28043, 7,
                                            sizeof(res_26219), &res_26219));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28043, 8,
                                            sizeof(num_groups_28295),
                                            &num_groups_28295));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28043, 9,
                                            sizeof(mem_28768.mem),
                                            &mem_28768.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28043, 10,
                                            sizeof(mem_28771.mem),
                                            &mem_28771.mem));
    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28043, 11,
                                            sizeof(mem_28786.mem),
                                            &mem_28786.mem));
    if (1 * ((size_t) num_groups_28295 * (size_t) segmap_group_sizze_28294) !=
        0) {
        const size_t global_work_sizze_29856[1] = {(size_t) num_groups_28295 *
                     (size_t) segmap_group_sizze_28294};
        const size_t local_work_sizze_29860[1] = {segmap_group_sizze_28294};
        int64_t time_start_29857 = 0, time_end_29858 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with global work size [",
                    "test.segmap_28043");
            fprintf(stderr, "%zu", global_work_sizze_29856[0]);
            fprintf(stderr, "] and local work size [");
            fprintf(stderr, "%zu", local_work_sizze_29860[0]);
            fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                    (int) 0);
            time_start_29857 = get_wall_time();
        }
        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                        ctx->testzisegmap_28043,
                                                        1, NULL,
                                                        global_work_sizze_29856,
                                                        local_work_sizze_29860,
                                                        0, NULL,
                                                        ctx->profiling_paused ||
                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                  &ctx->testzisegmap_28043_runs,
                                                                                                  &ctx->testzisegmap_28043_total_runtime)));
        if (ctx->debugging) {
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
            time_end_29858 = get_wall_time();
            
            long time_diff_29859 = time_end_29858 - time_start_29857;
            
            fprintf(stderr, "kernel %s runtime: %ldus\n", "test.segmap_28043",
                    time_diff_29859);
        }
    }
    ctx->failure_is_an_option = 1;
    if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28771, "mem_28771") != 0)
        return 1;
    
    int64_t flat_dim_26283 = 45 * paths_26128;
    float res_26287 = sitofp_i64_f32(paths_26128);
    int64_t segscan_group_sizze_28390;
    
    segscan_group_sizze_28390 = ctx->sizes.testzisegscan_group_sizze_28389;
    
    int64_t num_groups_28392;
    int32_t max_num_groups_28971;
    
    max_num_groups_28971 = ctx->sizes.testzisegscan_num_groups_28391;
    num_groups_28392 = sext_i64_i32(smax64(1, smin64(sdiv_up64(flat_dim_26283,
                                                               sext_i32_i64(segscan_group_sizze_28390)),
                                                     sext_i32_i64(max_num_groups_28971))));
    
    int64_t segred_group_sizze_28398;
    
    segred_group_sizze_28398 = ctx->sizes.testzisegred_group_sizze_28397;
    
    int64_t num_groups_28400;
    int32_t max_num_groups_28972;
    
    max_num_groups_28972 = ctx->sizes.testzisegred_num_groups_28399;
    num_groups_28400 = sext_i64_i32(smax64(1, smin64(sdiv_up64(flat_dim_26283,
                                                               sext_i32_i64(segred_group_sizze_28398)),
                                                     sext_i32_i64(max_num_groups_28972))));
    
    int64_t seghist_group_sizze_28408;
    
    seghist_group_sizze_28408 = ctx->sizes.testziseghist_group_sizze_28407;
    
    int64_t num_groups_28410;
    int32_t max_num_groups_28973;
    
    max_num_groups_28973 = ctx->sizes.testziseghist_num_groups_28409;
    num_groups_28410 = sext_i64_i32(smax64(1, smin64(sdiv_up64(flat_dim_26283,
                                                               sext_i32_i64(seghist_group_sizze_28408)),
                                                     sext_i32_i64(max_num_groups_28973))));
    
    int64_t segscan_group_sizze_28423;
    
    segscan_group_sizze_28423 = ctx->sizes.testzisegscan_group_sizze_28422;
    
    int64_t segscan_group_sizze_28431;
    
    segscan_group_sizze_28431 = ctx->sizes.testzisegscan_group_sizze_28430;
    
    int64_t segscan_group_sizze_28439;
    
    segscan_group_sizze_28439 = ctx->sizes.testzisegscan_group_sizze_28438;
    
    int64_t segscan_group_sizze_28491;
    
    segscan_group_sizze_28491 = ctx->sizes.testzisegscan_group_sizze_28490;
    
    bool suff_outer_redomap_28504;
    
    suff_outer_redomap_28504 = ctx->sizes.testzisuff_outer_redomap_7 <=
        paths_26128;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "test.suff_outer_redomap_7",
                paths_26128);
    
    int64_t segred_group_sizze_28516;
    
    segred_group_sizze_28516 = ctx->sizes.testzisegred_group_sizze_28506;
    
    int64_t num_groups_28517;
    int32_t max_num_groups_28974;
    
    max_num_groups_28974 = ctx->sizes.testzisegred_num_groups_28508;
    num_groups_28517 = sext_i64_i32(smax64(1, smin64(sdiv_up64(paths_26128,
                                                               sext_i32_i64(segred_group_sizze_28516)),
                                                     sext_i32_i64(max_num_groups_28974))));
    
    bool suff_outer_par_28612;
    
    suff_outer_par_28612 = ctx->sizes.testzisuff_outer_par_8 <= paths_26128;
    if (ctx->logging)
        fprintf(stderr, "Compared %s <= %d.\n", "test.suff_outer_par_8",
                paths_26128);
    
    int64_t segmap_group_sizze_28615;
    
    segmap_group_sizze_28615 = ctx->sizes.testzisegmap_group_sizze_28538;
    
    int64_t segred_group_sizze_28627;
    
    segred_group_sizze_28627 = ctx->sizes.testzisegred_group_sizze_28571;
    
    int64_t num_groups_28628;
    int32_t max_num_groups_28975;
    
    max_num_groups_28975 = ctx->sizes.testzisegred_num_groups_28573;
    num_groups_28628 = sext_i64_i32(smax64(1, smin64(sdiv_up64(flat_dim_26283,
                                                               sext_i32_i64(segred_group_sizze_28627)),
                                                     sext_i32_i64(max_num_groups_28975))));
    
    int64_t segmap_group_sizze_28637;
    
    segmap_group_sizze_28637 = ctx->sizes.testzisegmap_group_sizze_28563;
    
    int64_t segred_group_sizze_28644;
    
    segred_group_sizze_28644 = ctx->sizes.testzisegred_group_sizze_28602;
    
    int64_t num_groups_28645;
    int32_t max_num_groups_28976;
    
    max_num_groups_28976 = ctx->sizes.testzisegred_num_groups_28604;
    num_groups_28645 = sext_i64_i32(smax64(1, smin64(sdiv_up64(paths_26128,
                                                               sext_i32_i64(segred_group_sizze_28644)),
                                                     sext_i32_i64(max_num_groups_28976))));
    
    int64_t segmap_usable_groups_28616 = sdiv_up_safe64(paths_26128,
                                                        segmap_group_sizze_28615);
    int64_t segmap_usable_groups_28638 = sdiv_up_safe64(paths_26128,
                                                        segmap_group_sizze_28637);
    int64_t bytes_28788 = 8 * flat_dim_26283;
    struct memblock_device mem_28789;
    
    mem_28789.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28789, bytes_28788, "mem_28789")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_28791;
    
    mem_28791.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28791, bytes_28788, "mem_28791")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_28794;
    
    mem_28794.references = NULL;
    if (memblock_alloc_device(ctx, &mem_28794, 8, "mem_28794")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_28821 = 4 * flat_dim_26283;
    float res_26289;
    float redout_28320 = 0.0F;
    
    for (int64_t i_28321 = 0; i_28321 < steps_26129; i_28321++) {
        int64_t index_primexp_28686 = add64(1, i_28321);
        float res_26295 = sitofp_i64_f32(index_primexp_28686);
        float res_26296 = res_26295 / sims_per_year_26208;
        
        if (slt64(0, flat_dim_26283)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_28978;
            
            stage1_max_num_groups_28978 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_28979;
            
            stage1_num_groups_28979 = smin64(stage1_max_num_groups_28978,
                                             num_groups_28392);
            
            int32_t num_threads_28980;
            
            num_threads_28980 = sext_i64_i32(stage1_num_groups_28979 *
                segscan_group_sizze_28390);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28395,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_28390),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28395,
                                                    2, sizeof(flat_dim_26283),
                                                    &flat_dim_26283));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28395,
                                                    3, sizeof(res_26296),
                                                    &res_26296));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28395,
                                                    4,
                                                    sizeof(res_mem_28757.mem),
                                                    &res_mem_28757.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28395,
                                                    5,
                                                    sizeof(res_mem_28758.mem),
                                                    &res_mem_28758.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28395,
                                                    6, sizeof(mem_28789.mem),
                                                    &mem_28789.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28395,
                                                    7, sizeof(mem_28791.mem),
                                                    &mem_28791.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28395,
                                                    8,
                                                    sizeof(num_threads_28980),
                                                    &num_threads_28980));
            if (1 * ((size_t) stage1_num_groups_28979 *
                     (size_t) segscan_group_sizze_28390) != 0) {
                const size_t global_work_sizze_29861[1] =
                             {(size_t) stage1_num_groups_28979 *
                             (size_t) segscan_group_sizze_28390};
                const size_t local_work_sizze_29865[1] =
                             {segscan_group_sizze_28390};
                int64_t time_start_29862 = 0, time_end_29863 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage1_28395");
                    fprintf(stderr, "%zu", global_work_sizze_29861[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29865[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_28390)));
                    time_start_29862 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage1_28395,
                                                                1, NULL,
                                                                global_work_sizze_29861,
                                                                local_work_sizze_29865,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage1_28395_runs,
                                                                                                          &ctx->testziscan_stage1_28395_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29863 = get_wall_time();
                    
                    long time_diff_29864 = time_end_29863 - time_start_29862;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage1_28395", time_diff_29864);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_28390 *
                                     sdiv_up64(flat_dim_26283,
                                               sext_i32_i64(num_threads_28980))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28395,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_28979),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28395,
                                                    2, sizeof(flat_dim_26283),
                                                    &flat_dim_26283));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28395,
                                                    3, sizeof(mem_28789.mem),
                                                    &mem_28789.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28395,
                                                    4,
                                                    sizeof(stage1_num_groups_28979),
                                                    &stage1_num_groups_28979));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28395,
                                                    5,
                                                    sizeof(num_threads_28980),
                                                    &num_threads_28980));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_28979) != 0) {
                const size_t global_work_sizze_29866[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_28979};
                const size_t local_work_sizze_29870[1] =
                             {stage1_num_groups_28979};
                int64_t time_start_29867 = 0, time_end_29868 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage2_28395");
                    fprintf(stderr, "%zu", global_work_sizze_29866[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29870[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_28979)));
                    time_start_29867 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage2_28395,
                                                                1, NULL,
                                                                global_work_sizze_29866,
                                                                local_work_sizze_29870,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage2_28395_runs,
                                                                                                          &ctx->testziscan_stage2_28395_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29868 = get_wall_time();
                    
                    long time_diff_29869 = time_end_29868 - time_start_29867;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage2_28395", time_diff_29869);
                }
            }
            
            int32_t required_groups_29016;
            
            required_groups_29016 = sext_i64_i32(sdiv_up64(flat_dim_26283,
                                                           segscan_group_sizze_28390));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28395,
                                                    1, sizeof(flat_dim_26283),
                                                    &flat_dim_26283));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28395,
                                                    2, sizeof(num_groups_28392),
                                                    &num_groups_28392));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28395,
                                                    3, sizeof(mem_28789.mem),
                                                    &mem_28789.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28395,
                                                    4,
                                                    sizeof(num_threads_28980),
                                                    &num_threads_28980));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28395,
                                                    5,
                                                    sizeof(required_groups_29016),
                                                    &required_groups_29016));
            if (1 * ((size_t) num_groups_28392 *
                     (size_t) segscan_group_sizze_28390) != 0) {
                const size_t global_work_sizze_29871[1] =
                             {(size_t) num_groups_28392 *
                             (size_t) segscan_group_sizze_28390};
                const size_t local_work_sizze_29875[1] =
                             {segscan_group_sizze_28390};
                int64_t time_start_29872 = 0, time_end_29873 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage3_28395");
                    fprintf(stderr, "%zu", global_work_sizze_29871[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29875[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_29872 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage3_28395,
                                                                1, NULL,
                                                                global_work_sizze_29871,
                                                                local_work_sizze_29875,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage3_28395_runs,
                                                                                                          &ctx->testziscan_stage3_28395_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29873 = get_wall_time();
                    
                    long time_diff_29874 = time_end_29873 - time_start_29872;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage3_28395", time_diff_29874);
                }
            }
        }
        
        struct memblock_device testzicounter_mem_29028 =
                               ctx->testzicounter_mem_29028;
        struct memblock_device group_res_arr_mem_29030;
        
        group_res_arr_mem_29030.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_29030,
                                  (int32_t) sizeof(int64_t) *
                                  (segred_group_sizze_28398 * num_groups_28400),
                                  "group_res_arr_mem_29030")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_29032;
        
        num_threads_29032 = num_groups_28400 * segred_group_sizze_28398;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28405,
                                                1, (int32_t) sizeof(int64_t) *
                                                segred_group_sizze_28398,
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28405,
                                                2, (int32_t) sizeof(bool),
                                                NULL));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28405,
                                                3, sizeof(flat_dim_26283),
                                                &flat_dim_26283));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28405,
                                                4, sizeof(num_groups_28400),
                                                &num_groups_28400));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28405,
                                                5, sizeof(mem_28791.mem),
                                                &mem_28791.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28405,
                                                6, sizeof(mem_28794.mem),
                                                &mem_28794.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28405,
                                                7,
                                                sizeof(testzicounter_mem_29028.mem),
                                                &testzicounter_mem_29028.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28405,
                                                8,
                                                sizeof(group_res_arr_mem_29030.mem),
                                                &group_res_arr_mem_29030.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28405,
                                                9, sizeof(num_threads_29032),
                                                &num_threads_29032));
        if (1 * ((size_t) num_groups_28400 *
                 (size_t) segred_group_sizze_28398) != 0) {
            const size_t global_work_sizze_29877[1] =
                         {(size_t) num_groups_28400 *
                         (size_t) segred_group_sizze_28398};
            const size_t local_work_sizze_29881[1] = {segred_group_sizze_28398};
            int64_t time_start_29878 = 0, time_end_29879 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "test.segred_nonseg_28405");
                fprintf(stderr, "%zu", global_work_sizze_29877[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_29881[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) (0 + (int32_t) sizeof(int64_t) *
                               segred_group_sizze_28398 +
                               (int32_t) sizeof(bool)));
                time_start_29878 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->testzisegred_nonseg_28405,
                                                            1, NULL,
                                                            global_work_sizze_29877,
                                                            local_work_sizze_29881,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->testzisegred_nonseg_28405_runs,
                                                                                                      &ctx->testzisegred_nonseg_28405_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_29879 = get_wall_time();
                
                long time_diff_29880 = time_end_29879 - time_start_29878;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "test.segred_nonseg_28405", time_diff_29880);
            }
        }
        
        int64_t read_res_29882;
        
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     mem_28794.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0 * sizeof(int64_t),
                                                     sizeof(int64_t),
                                                     &read_res_29882, 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_scalar_from_dev_runs,
                                                                                               &ctx->copy_scalar_from_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
        
        int64_t res_26316 = read_res_29882;
        bool bounds_invalid_upwards_26321 = slt64(res_26316, 0);
        bool valid_26322 = !bounds_invalid_upwards_26321;
        bool range_valid_c_26323;
        
        if (!valid_26322) {
            ctx->error =
                msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                          "Range ", 0, "..", 1, "..<", res_26316,
                          " is invalid.",
                          "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:70:18-23\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:48:30-60\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:87:14-32\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:133:38-97\n   #6  /prelude/soacs.fut:56:19-23\n   #7  /prelude/soacs.fut:56:3-37\n   #8  cva.fut:126:44-136:50\n   #9  cva.fut:154:3-156:129\n   #10 cva.fut:153:1-156:137\n");
            if (memblock_unref_device(ctx, &group_res_arr_mem_29030,
                                      "group_res_arr_mem_29030") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28794, "mem_28794") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28791, "mem_28791") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28789, "mem_28789") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28771, "mem_28771") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28786, "mem_28786") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28761, "mem_28761") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28758, "res_mem_28758") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28757, "res_mem_28757") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28756, "res_mem_28756") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_28908,
                                      "group_res_arr_mem_28908") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28736, "mem_28736") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28731, "mem_28731") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28729, "mem_28729") != 0)
                return 1;
            return 1;
        }
        
        int64_t bytes_28795 = 8 * res_26316;
        struct memblock_device mem_28796;
        
        mem_28796.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28796, bytes_28795, "mem_28796")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i64(ctx, mem_28796, res_26316, 0) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int32_t num_subhistos_29067;
        struct memblock_device res_subhistos_mem_29068;
        
        res_subhistos_mem_29068.references = NULL;
        
        int64_t h_29070;
        
        h_29070 = (int32_t) sizeof(int64_t) * res_26316;
        
        int64_t seg_h_29071;
        
        seg_h_29071 = (int32_t) sizeof(int64_t) * res_26316;
        if (!(seg_h_29071 == 0)) {
            int64_t hist_H_29072 = res_26316;
            int64_t hist_el_sizze_29073 = sdiv_up64(h_29070, hist_H_29072) + 4;
            int64_t hist_N_29074 = flat_dim_26283;
            int64_t hist_RF_29075 = 1;
            
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegHist");
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Number of threads (T)",
                        (long long) sext_i64_i32(num_groups_28410 *
                        seghist_group_sizze_28408), '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Desired group size (B)",
                        (long long) seghist_group_sizze_28408, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Histogram size (H)",
                        (long long) hist_H_29072, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Input elements per histogram (N)",
                        (long long) hist_N_29074, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Number of segments",
                        (long long) 1, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Histogram element size (el_size)",
                        (long long) hist_el_sizze_29073, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "Race factor (RF)",
                        (long long) hist_RF_29075, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Memory per set of subhistograms per segment",
                        (long long) h_29070, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c",
                        "Memory per set of subhistograms times segments",
                        (long long) seg_h_29071, '\n');
            
            int32_t hist_L_29076;
            
            hist_L_29076 = ctx->opencl.max_local_memory;
            
            int32_t max_group_sizze_29077;
            
            max_group_sizze_29077 = ctx->opencl.max_group_size;
            
            int64_t num_groups_29078;
            
            num_groups_29078 =
                sdiv_up64(sext_i32_i64(sext_i64_i32(num_groups_28410 *
                          seghist_group_sizze_28408)), max_group_sizze_29077);
            
            double hist_m_prime_29079;
            
            hist_m_prime_29079 =
                sitofp_i64_f64(smin64(sext_i32_i64(squot32(hist_L_29076,
                                                           hist_el_sizze_29073)),
                                      sdiv_up64(hist_N_29074,
                                                num_groups_29078))) /
                sitofp_i64_f64(hist_H_29072);
            
            int64_t hist_M0_29080;
            
            hist_M0_29080 = smax64(1, smin64(fptosi_f64_i64(hist_m_prime_29079),
                                             max_group_sizze_29077));
            
            int64_t hist_Nout_29081;
            
            hist_Nout_29081 = 1;
            
            int64_t hist_Nin_29082;
            
            hist_Nin_29082 = flat_dim_26283;
            
            int64_t work_asymp_M_max_29083;
            
            work_asymp_M_max_29083 = squot64(hist_Nout_29081 * hist_N_29074, 2 *
                                             num_groups_29078 * hist_H_29072);
            
            int32_t hist_M_29084;
            
            hist_M_29084 = sext_i64_i32(smin64(hist_M0_29080,
                                               work_asymp_M_max_29083));
            
            int64_t hist_C_29085;
            
            hist_C_29085 = sdiv_up64(max_group_sizze_29077,
                                     sext_i32_i64(smax32(1, hist_M_29084)));
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local hist_M0",
                        (long long) hist_M0_29080, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local work asymp M max",
                        (long long) work_asymp_M_max_29083, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local C",
                        (long long) hist_C_29085, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local B",
                        (long long) max_group_sizze_29077, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local M",
                        (long long) hist_M_29084, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "local memory needed",
                        (long long) (hist_H_29072 * hist_el_sizze_29073 *
                                     sext_i32_i64(hist_M_29084)), '\n');
            
            int64_t local_mem_needed_29086;
            
            local_mem_needed_29086 = hist_el_sizze_29073 *
                sext_i32_i64(hist_M_29084);
            
            int32_t hist_S_29087;
            
            hist_S_29087 = sext_i64_i32(sdiv_up64(hist_H_29072 *
                                                  local_mem_needed_29086,
                                                  hist_L_29076));
            if (sle64(hist_H_29072, hist_Nin_29082) &&
                (sle64(local_mem_needed_29086, hist_L_29076) &&
                 (sle32(hist_S_29087, 6) && (sle64(hist_C_29085,
                                                   max_group_sizze_29077) &&
                                             slt32(0, hist_M_29084))))) {
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "## Using local memory");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Histogram size (H)",
                            (long long) hist_H_29072, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Multiplication degree (M)",
                            (long long) hist_M_29084, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Cooperation level (C)",
                            (long long) hist_C_29085, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Number of chunks (S)",
                            (long long) hist_S_29087, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c",
                            "Number of local subhistograms per group",
                            (long long) hist_M_29084, '\n');
                
                int64_t num_segments_29088;
                
                num_segments_29088 = 1;
                num_subhistos_29067 = num_groups_29078 * num_segments_29088;
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c",
                            "Number of subhistograms in global memory",
                            (long long) num_subhistos_29067, '\n');
                if (num_subhistos_29067 == 1) {
                    if (memblock_set_device(ctx, &res_subhistos_mem_29068,
                                            &mem_28796, "mem_28796") != 0)
                        return 1;
                } else {
                    if (memblock_alloc_device(ctx, &res_subhistos_mem_29068,
                                              sext_i32_i64(num_subhistos_29067) *
                                              res_26316 *
                                              (int32_t) sizeof(int64_t),
                                              "res_subhistos_mem_29068")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (futrts_builtinzhreplicate_i64(ctx,
                                                      res_subhistos_mem_29068,
                                                      num_subhistos_29067 *
                                                      res_26316, 0) != 0) {
                        err = 1;
                        goto cleanup;
                    }
                    if (res_26316 * (int32_t) sizeof(int64_t) > 0) {
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                                     mem_28796.mem,
                                                                     res_subhistos_mem_29068.mem,
                                                                     0, 0,
                                                                     res_26316 *
                                                                     (int32_t) sizeof(int64_t),
                                                                     0, NULL,
                                                                     ctx->profiling_paused ||
                                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
                        if (ctx->debugging)
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    }
                }
                for (int32_t chk_i_29089 = 0; chk_i_29089 < hist_S_29087;
                     chk_i_29089++) {
                    int64_t num_segments_29090 = 1;
                    int64_t hist_H_chk_29091 = sdiv_up64(res_26316,
                                                         sext_i32_i64(hist_S_29087));
                    int64_t histo_sizze_29092 = hist_H_chk_29091;
                    int32_t init_per_thread_29093 =
                            sext_i64_i32(sdiv_up64(sext_i32_i64(hist_M_29084) *
                                                   histo_sizze_29092,
                                                   max_group_sizze_29077));
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            1,
                                                            (int32_t) sizeof(int32_t) *
                                                            (hist_M_29084 *
                                                             hist_H_chk_29091),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            2,
                                                            (int32_t) sizeof(int64_t) *
                                                            (hist_M_29084 *
                                                             hist_H_chk_29091),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            3,
                                                            sizeof(flat_dim_26283),
                                                            &flat_dim_26283));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            4,
                                                            sizeof(res_26316),
                                                            &res_26316));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            5,
                                                            sizeof(mem_28789.mem),
                                                            &mem_28789.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            6,
                                                            sizeof(res_subhistos_mem_29068.mem),
                                                            &res_subhistos_mem_29068.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            7,
                                                            sizeof(max_group_sizze_29077),
                                                            &max_group_sizze_29077));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            8,
                                                            sizeof(num_groups_29078),
                                                            &num_groups_29078));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            9,
                                                            sizeof(hist_M_29084),
                                                            &hist_M_29084));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            10,
                                                            sizeof(chk_i_29089),
                                                            &chk_i_29089));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            11,
                                                            sizeof(num_segments_29090),
                                                            &num_segments_29090));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            12,
                                                            sizeof(hist_H_chk_29091),
                                                            &hist_H_chk_29091));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            13,
                                                            sizeof(histo_sizze_29092),
                                                            &histo_sizze_29092));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_local_28413,
                                                            14,
                                                            sizeof(init_per_thread_29093),
                                                            &init_per_thread_29093));
                    if (1 * ((size_t) num_groups_29078 *
                             (size_t) max_group_sizze_29077) != 0) {
                        const size_t global_work_sizze_29883[1] =
                                     {(size_t) num_groups_29078 *
                                     (size_t) max_group_sizze_29077};
                        const size_t local_work_sizze_29887[1] =
                                     {max_group_sizze_29077};
                        int64_t time_start_29884 = 0, time_end_29885 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "test.seghist_local_28413");
                            fprintf(stderr, "%zu", global_work_sizze_29883[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29887[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(int32_t) *
                                           (hist_M_29084 * hist_H_chk_29091) +
                                           (int32_t) sizeof(int64_t) *
                                           (hist_M_29084 * hist_H_chk_29091)));
                            time_start_29884 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->testziseghist_local_28413,
                                                                        1, NULL,
                                                                        global_work_sizze_29883,
                                                                        local_work_sizze_29887,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->testziseghist_local_28413_runs,
                                                                                                                  &ctx->testziseghist_local_28413_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29885 = get_wall_time();
                            
                            long time_diff_29886 = time_end_29885 -
                                 time_start_29884;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "test.seghist_local_28413",
                                    time_diff_29886);
                        }
                    }
                }
            } else {
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "## Using global memory");
                
                int64_t hist_H_29125;
                
                hist_H_29125 = res_26316;
                
                double hist_RF_29126;
                
                hist_RF_29126 = (0.0 + sitofp_i32_f64(1)) / 1.0;
                
                int32_t hist_el_sizze_29127;
                
                hist_el_sizze_29127 =
                    squot32(sext_i64_i32((int32_t) sizeof(int32_t) +
                            (int32_t) sizeof(int64_t)), 2);
                
                double hist_C_max_29128;
                
                hist_C_max_29128 =
                    fmin64(sitofp_i32_f64(sext_i64_i32(num_groups_28410 *
                           seghist_group_sizze_28408)),
                           sitofp_i32_f64(hist_H_29125) / 2.0);
                
                int32_t hist_M_min_29129;
                
                hist_M_min_29129 = smax32(1,
                                          sext_i64_i32(fptosi_f64_i64(sitofp_i32_f64(sext_i64_i32(num_groups_28410 *
                                          seghist_group_sizze_28408)) /
                                          hist_C_max_29128)));
                
                int32_t L2_sizze_29130;
                
                L2_sizze_29130 = ctx->sizes.testziL2_sizze_29130;
                
                double hist_RACE_exp_29131;
                
                hist_RACE_exp_29131 = fmax64(1.0, 0.75 * hist_RF_29126 / (64.0 /
                                                                          sitofp_i32_f64(hist_el_sizze_29127)));
                
                int32_t hist_S_29132;
                
                if (slt64(flat_dim_26283, hist_H_29125)) {
                    hist_S_29132 = 1;
                } else {
                    hist_S_29132 =
                        sext_i64_i32(sdiv_up64(sext_i32_i64(hist_M_min_29129) *
                                               hist_H_29125 *
                                               sext_i32_i64(hist_el_sizze_29127),
                                               fptosi_f64_i64(0.4 *
                                               sitofp_i32_f64(L2_sizze_29130) *
                                               hist_RACE_exp_29131)));
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s: %f%c",
                            "Race expansion factor (RACE^exp)",
                            (double) hist_RACE_exp_29131, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Number of chunks (S)",
                            (long long) hist_S_29132, '\n');
                
                int64_t hist_H_chk_29133;
                
                hist_H_chk_29133 = sdiv_up64(res_26316,
                                             sext_i32_i64(hist_S_29132));
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Chunk size (H_chk)",
                            (long long) hist_H_chk_29133, '\n');
                
                double hist_k_max_29134;
                
                hist_k_max_29134 = fmin64(0.4 *
                                          (sitofp_i32_f64(L2_sizze_29130) /
                                           sitofp_i32_f64(sext_i64_i32((int32_t) sizeof(int32_t) +
                                           (int32_t) sizeof(int64_t)))) *
                                          hist_RACE_exp_29131,
                                          sitofp_i32_f64(flat_dim_26283)) /
                    sitofp_i32_f64(sext_i64_i32(num_groups_28410 *
                    seghist_group_sizze_28408));
                
                int64_t hist_u_29135;
                
                hist_u_29135 = 1;
                
                double hist_C_29136;
                
                hist_C_29136 =
                    fmin64(sitofp_i32_f64(sext_i64_i32(num_groups_28410 *
                           seghist_group_sizze_28408)),
                           sitofp_i32_f64(hist_u_29135 * hist_H_chk_29133) /
                           hist_k_max_29134);
                
                int32_t hist_M_29137;
                
                hist_M_29137 = smax32(hist_M_min_29129,
                                      sext_i64_i32(fptosi_f64_i64(sitofp_i32_f64(sext_i64_i32(num_groups_28410 *
                                      seghist_group_sizze_28408)) /
                                      hist_C_29136)));
                if (ctx->debugging)
                    fprintf(stderr, "%s: %f%c",
                            "Elements/thread in L2 cache (k_max)",
                            (double) hist_k_max_29134, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "Multiplication degree (M)",
                            (long long) hist_M_29137, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %f%c", "Cooperation level (C)",
                            (double) hist_C_29136, '\n');
                num_subhistos_29067 = sext_i32_i64(hist_M_29137);
                if (hist_M_29137 == 1) {
                    if (memblock_set_device(ctx, &res_subhistos_mem_29068,
                                            &mem_28796, "mem_28796") != 0)
                        return 1;
                } else {
                    if (num_subhistos_29067 == 1) {
                        if (memblock_set_device(ctx, &res_subhistos_mem_29068,
                                                &mem_28796, "mem_28796") != 0)
                            return 1;
                    } else {
                        if (memblock_alloc_device(ctx, &res_subhistos_mem_29068,
                                                  sext_i32_i64(num_subhistos_29067) *
                                                  res_26316 *
                                                  (int32_t) sizeof(int64_t),
                                                  "res_subhistos_mem_29068")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (futrts_builtinzhreplicate_i64(ctx,
                                                          res_subhistos_mem_29068,
                                                          num_subhistos_29067 *
                                                          res_26316, 0) != 0) {
                            err = 1;
                            goto cleanup;
                        }
                        if (res_26316 * (int32_t) sizeof(int64_t) > 0) {
                            OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue,
                                                                         mem_28796.mem,
                                                                         res_subhistos_mem_29068.mem,
                                                                         0, 0,
                                                                         res_26316 *
                                                                         (int32_t) sizeof(int64_t),
                                                                         0,
                                                                         NULL,
                                                                         ctx->profiling_paused ||
                                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                   &ctx->copy_dev_to_dev_runs,
                                                                                                                   &ctx->copy_dev_to_dev_total_runtime)));
                            if (ctx->debugging)
                                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        }
                    }
                }
                
                struct memblock_device testzihist_locks_mem_29138 =
                                       ctx->testzihist_locks_mem_29138;
                
                for (int32_t chk_i_29140 = 0; chk_i_29140 < hist_S_29132;
                     chk_i_29140++) {
                    int64_t hist_H_chk_29141 = sdiv_up64(res_26316,
                                                         sext_i32_i64(hist_S_29132));
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_global_28413,
                                                            1,
                                                            sizeof(flat_dim_26283),
                                                            &flat_dim_26283));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_global_28413,
                                                            2,
                                                            sizeof(res_26316),
                                                            &res_26316));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_global_28413,
                                                            3,
                                                            sizeof(num_groups_28410),
                                                            &num_groups_28410));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_global_28413,
                                                            4,
                                                            sizeof(mem_28789.mem),
                                                            &mem_28789.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_global_28413,
                                                            5,
                                                            sizeof(num_subhistos_29067),
                                                            &num_subhistos_29067));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_global_28413,
                                                            6,
                                                            sizeof(res_subhistos_mem_29068.mem),
                                                            &res_subhistos_mem_29068.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_global_28413,
                                                            7,
                                                            sizeof(testzihist_locks_mem_29138.mem),
                                                            &testzihist_locks_mem_29138.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_global_28413,
                                                            8,
                                                            sizeof(chk_i_29140),
                                                            &chk_i_29140));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziseghist_global_28413,
                                                            9,
                                                            sizeof(hist_H_chk_29141),
                                                            &hist_H_chk_29141));
                    if (1 * ((size_t) num_groups_28410 *
                             (size_t) seghist_group_sizze_28408) != 0) {
                        const size_t global_work_sizze_29889[1] =
                                     {(size_t) num_groups_28410 *
                                     (size_t) seghist_group_sizze_28408};
                        const size_t local_work_sizze_29893[1] =
                                     {seghist_group_sizze_28408};
                        int64_t time_start_29890 = 0, time_end_29891 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "test.seghist_global_28413");
                            fprintf(stderr, "%zu", global_work_sizze_29889[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29893[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) 0);
                            time_start_29890 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->testziseghist_global_28413,
                                                                        1, NULL,
                                                                        global_work_sizze_29889,
                                                                        local_work_sizze_29893,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->testziseghist_global_28413_runs,
                                                                                                                  &ctx->testziseghist_global_28413_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29891 = get_wall_time();
                            
                            long time_diff_29892 = time_end_29891 -
                                 time_start_29890;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "test.seghist_global_28413",
                                    time_diff_29892);
                        }
                    }
                }
            }
            if (num_subhistos_29067 == 1) {
                if (memblock_set_device(ctx, &mem_28796,
                                        &res_subhistos_mem_29068,
                                        "res_subhistos_mem_29068") != 0)
                    return 1;
            } else {
                if (slt64(num_subhistos_29067 * 2, seghist_group_sizze_28408)) {
                    int64_t segment_sizze_nonzzero_29154 = smax64(1,
                                                                  num_subhistos_29067);
                    int64_t num_threads_29155 = num_groups_28410 *
                            seghist_group_sizze_28408;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-small");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) res_26316, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) num_subhistos_29067, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segments_per_group",
                                (long long) squot64(seghist_group_sizze_28408,
                                                    segment_sizze_nonzzero_29154),
                                '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "required_groups",
                                (long long) sext_i64_i32(sdiv_up64(res_26316,
                                                                   squot64(seghist_group_sizze_28408,
                                                                           segment_sizze_nonzzero_29154))),
                                '\n');
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_29153,
                                                            1,
                                                            (int32_t) sizeof(int64_t) *
                                                            seghist_group_sizze_28408,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_29153,
                                                            2,
                                                            sizeof(res_26316),
                                                            &res_26316));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_29153,
                                                            3,
                                                            sizeof(num_groups_28410),
                                                            &num_groups_28410));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_29153,
                                                            4,
                                                            sizeof(mem_28796.mem),
                                                            &mem_28796.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_29153,
                                                            5,
                                                            sizeof(num_subhistos_29067),
                                                            &num_subhistos_29067));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_29153,
                                                            6,
                                                            sizeof(res_subhistos_mem_29068.mem),
                                                            &res_subhistos_mem_29068.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_29153,
                                                            7,
                                                            sizeof(segment_sizze_nonzzero_29154),
                                                            &segment_sizze_nonzzero_29154));
                    if (1 * ((size_t) num_groups_28410 *
                             (size_t) seghist_group_sizze_28408) != 0) {
                        const size_t global_work_sizze_29894[1] =
                                     {(size_t) num_groups_28410 *
                                     (size_t) seghist_group_sizze_28408};
                        const size_t local_work_sizze_29898[1] =
                                     {seghist_group_sizze_28408};
                        int64_t time_start_29895 = 0, time_end_29896 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "test.segred_small_29153");
                            fprintf(stderr, "%zu", global_work_sizze_29894[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29898[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(int64_t) *
                                           seghist_group_sizze_28408));
                            time_start_29895 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->testzisegred_small_29153,
                                                                        1, NULL,
                                                                        global_work_sizze_29894,
                                                                        local_work_sizze_29898,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->testzisegred_small_29153_runs,
                                                                                                                  &ctx->testzisegred_small_29153_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29896 = get_wall_time();
                            
                            long time_diff_29897 = time_end_29896 -
                                 time_start_29895;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "test.segred_small_29153", time_diff_29897);
                        }
                    }
                } else {
                    int64_t groups_per_segment_29175 =
                            sdiv_up64(num_groups_28410, smax64(1, res_26316));
                    int64_t elements_per_thread_29176 =
                            sdiv_up64(num_subhistos_29067,
                                      seghist_group_sizze_28408 *
                                      groups_per_segment_29175);
                    int64_t virt_num_groups_29177 = groups_per_segment_29175 *
                            res_26316;
                    int64_t num_threads_29178 = num_groups_28410 *
                            seghist_group_sizze_28408;
                    int64_t threads_per_segment_29179 =
                            groups_per_segment_29175 *
                            seghist_group_sizze_28408;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-large");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) res_26316, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) num_subhistos_29067, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                                (long long) virt_num_groups_29177, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_groups",
                                (long long) num_groups_28410, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "group_size",
                                (long long) seghist_group_sizze_28408, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                                (long long) elements_per_thread_29176, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                                (long long) groups_per_segment_29175, '\n');
                    
                    struct memblock_device group_res_arr_mem_29180;
                    
                    group_res_arr_mem_29180.references = NULL;
                    if (memblock_alloc_device(ctx, &group_res_arr_mem_29180,
                                              (int32_t) sizeof(int64_t) *
                                              (seghist_group_sizze_28408 *
                                               virt_num_groups_29177),
                                              "group_res_arr_mem_29180")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    struct memblock_device testzicounter_mem_29182 =
                                           ctx->testzicounter_mem_29182;
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            1,
                                                            (int32_t) sizeof(bool),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            2,
                                                            (int32_t) sizeof(int64_t) *
                                                            seghist_group_sizze_28408,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            3,
                                                            sizeof(res_26316),
                                                            &res_26316));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            4,
                                                            sizeof(num_groups_28410),
                                                            &num_groups_28410));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            5,
                                                            sizeof(mem_28796.mem),
                                                            &mem_28796.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            6,
                                                            sizeof(num_subhistos_29067),
                                                            &num_subhistos_29067));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            7,
                                                            sizeof(res_subhistos_mem_29068.mem),
                                                            &res_subhistos_mem_29068.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            8,
                                                            sizeof(groups_per_segment_29175),
                                                            &groups_per_segment_29175));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            9,
                                                            sizeof(elements_per_thread_29176),
                                                            &elements_per_thread_29176));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            10,
                                                            sizeof(virt_num_groups_29177),
                                                            &virt_num_groups_29177));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            11,
                                                            sizeof(threads_per_segment_29179),
                                                            &threads_per_segment_29179));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            12,
                                                            sizeof(group_res_arr_mem_29180.mem),
                                                            &group_res_arr_mem_29180.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_29153,
                                                            13,
                                                            sizeof(testzicounter_mem_29182.mem),
                                                            &testzicounter_mem_29182.mem));
                    if (1 * ((size_t) num_groups_28410 *
                             (size_t) seghist_group_sizze_28408) != 0) {
                        const size_t global_work_sizze_29900[1] =
                                     {(size_t) num_groups_28410 *
                                     (size_t) seghist_group_sizze_28408};
                        const size_t local_work_sizze_29904[1] =
                                     {seghist_group_sizze_28408};
                        int64_t time_start_29901 = 0, time_end_29902 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "test.segred_large_29153");
                            fprintf(stderr, "%zu", global_work_sizze_29900[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29904[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(bool) +
                                           (int32_t) sizeof(int64_t) *
                                           seghist_group_sizze_28408));
                            time_start_29901 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->testzisegred_large_29153,
                                                                        1, NULL,
                                                                        global_work_sizze_29900,
                                                                        local_work_sizze_29904,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->testzisegred_large_29153_runs,
                                                                                                                  &ctx->testzisegred_large_29153_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29902 = get_wall_time();
                            
                            long time_diff_29903 = time_end_29902 -
                                 time_start_29901;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "test.segred_large_29153", time_diff_29903);
                        }
                    }
                    if (memblock_unref_device(ctx, &group_res_arr_mem_29180,
                                              "group_res_arr_mem_29180") != 0)
                        return 1;
                }
            }
        }
        
        int64_t num_groups_28425;
        int32_t max_num_groups_29214;
        
        max_num_groups_29214 = ctx->sizes.testzisegscan_num_groups_28424;
        num_groups_28425 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_26316,
                                                                   sext_i32_i64(segscan_group_sizze_28423)),
                                                         sext_i32_i64(max_num_groups_29214))));
        
        struct memblock_device mem_28800;
        
        mem_28800.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28800, res_26316, "mem_28800")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_28802;
        
        mem_28802.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28802, bytes_28795, "mem_28802")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, res_26316)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_29215;
            
            stage1_max_num_groups_29215 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_29216;
            
            stage1_num_groups_29216 = smin64(stage1_max_num_groups_29215,
                                             num_groups_28425);
            
            int32_t num_threads_29217;
            
            num_threads_29217 = sext_i64_i32(stage1_num_groups_29216 *
                segscan_group_sizze_28423);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28428,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_28423),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28428,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              segscan_group_sizze_28423),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28428,
                                                    3, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28428,
                                                    4, sizeof(mem_28796.mem),
                                                    &mem_28796.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28428,
                                                    5, sizeof(mem_28800.mem),
                                                    &mem_28800.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28428,
                                                    6, sizeof(mem_28802.mem),
                                                    &mem_28802.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28428,
                                                    7,
                                                    sizeof(num_threads_29217),
                                                    &num_threads_29217));
            if (1 * ((size_t) stage1_num_groups_29216 *
                     (size_t) segscan_group_sizze_28423) != 0) {
                const size_t global_work_sizze_29905[1] =
                             {(size_t) stage1_num_groups_29216 *
                             (size_t) segscan_group_sizze_28423};
                const size_t local_work_sizze_29909[1] =
                             {segscan_group_sizze_28423};
                int64_t time_start_29906 = 0, time_end_29907 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage1_28428");
                    fprintf(stderr, "%zu", global_work_sizze_29905[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29909[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_28423) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          segscan_group_sizze_28423)));
                    time_start_29906 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage1_28428,
                                                                1, NULL,
                                                                global_work_sizze_29905,
                                                                local_work_sizze_29909,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage1_28428_runs,
                                                                                                          &ctx->testziscan_stage1_28428_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29907 = get_wall_time();
                    
                    long time_diff_29908 = time_end_29907 - time_start_29906;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage1_28428", time_diff_29908);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_28423 *
                                     sdiv_up64(res_26316,
                                               sext_i32_i64(num_threads_29217))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28428,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_29216),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28428,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              stage1_num_groups_29216),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28428,
                                                    3, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28428,
                                                    4, sizeof(mem_28800.mem),
                                                    &mem_28800.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28428,
                                                    5, sizeof(mem_28802.mem),
                                                    &mem_28802.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28428,
                                                    6,
                                                    sizeof(stage1_num_groups_29216),
                                                    &stage1_num_groups_29216));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28428,
                                                    7,
                                                    sizeof(num_threads_29217),
                                                    &num_threads_29217));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_29216) != 0) {
                const size_t global_work_sizze_29910[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_29216};
                const size_t local_work_sizze_29914[1] =
                             {stage1_num_groups_29216};
                int64_t time_start_29911 = 0, time_end_29912 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage2_28428");
                    fprintf(stderr, "%zu", global_work_sizze_29910[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29914[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_29216) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          stage1_num_groups_29216)));
                    time_start_29911 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage2_28428,
                                                                1, NULL,
                                                                global_work_sizze_29910,
                                                                local_work_sizze_29914,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage2_28428_runs,
                                                                                                          &ctx->testziscan_stage2_28428_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29912 = get_wall_time();
                    
                    long time_diff_29913 = time_end_29912 - time_start_29911;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage2_28428", time_diff_29913);
                }
            }
            
            int32_t required_groups_29269;
            
            required_groups_29269 = sext_i64_i32(sdiv_up64(res_26316,
                                                           segscan_group_sizze_28423));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28428,
                                                    1, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28428,
                                                    2, sizeof(num_groups_28425),
                                                    &num_groups_28425));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28428,
                                                    3, sizeof(mem_28800.mem),
                                                    &mem_28800.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28428,
                                                    4, sizeof(mem_28802.mem),
                                                    &mem_28802.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28428,
                                                    5,
                                                    sizeof(num_threads_29217),
                                                    &num_threads_29217));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28428,
                                                    6,
                                                    sizeof(required_groups_29269),
                                                    &required_groups_29269));
            if (1 * ((size_t) num_groups_28425 *
                     (size_t) segscan_group_sizze_28423) != 0) {
                const size_t global_work_sizze_29915[1] =
                             {(size_t) num_groups_28425 *
                             (size_t) segscan_group_sizze_28423};
                const size_t local_work_sizze_29919[1] =
                             {segscan_group_sizze_28423};
                int64_t time_start_29916 = 0, time_end_29917 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage3_28428");
                    fprintf(stderr, "%zu", global_work_sizze_29915[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29919[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_29916 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage3_28428,
                                                                1, NULL,
                                                                global_work_sizze_29915,
                                                                local_work_sizze_29919,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage3_28428_runs,
                                                                                                          &ctx->testziscan_stage3_28428_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29917 = get_wall_time();
                    
                    long time_diff_29918 = time_end_29917 - time_start_29916;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage3_28428", time_diff_29918);
                }
            }
        }
        if (memblock_unref_device(ctx, &mem_28796, "mem_28796") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
            return 1;
        
        int64_t num_groups_28433;
        int32_t max_num_groups_29281;
        
        max_num_groups_29281 = ctx->sizes.testzisegscan_num_groups_28432;
        num_groups_28433 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_26316,
                                                                   sext_i32_i64(segscan_group_sizze_28431)),
                                                         sext_i32_i64(max_num_groups_29281))));
        
        struct memblock_device mem_28805;
        
        mem_28805.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28805, res_26316, "mem_28805")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_28807;
        
        mem_28807.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28807, bytes_28795, "mem_28807")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_28809;
        
        mem_28809.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28809, res_26316, "mem_28809")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, res_26316)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_29282;
            
            stage1_max_num_groups_29282 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_29283;
            
            stage1_num_groups_29283 = smin64(stage1_max_num_groups_29282,
                                             num_groups_28433);
            
            int32_t num_threads_29284;
            
            num_threads_29284 = sext_i64_i32(stage1_num_groups_29283 *
                segscan_group_sizze_28431);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28436,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_28431),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28436,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              segscan_group_sizze_28431),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28436,
                                                    3, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28436,
                                                    4, sizeof(mem_28802.mem),
                                                    &mem_28802.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28436,
                                                    5, sizeof(mem_28805.mem),
                                                    &mem_28805.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28436,
                                                    6, sizeof(mem_28807.mem),
                                                    &mem_28807.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28436,
                                                    7, sizeof(mem_28809.mem),
                                                    &mem_28809.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28436,
                                                    8,
                                                    sizeof(num_threads_29284),
                                                    &num_threads_29284));
            if (1 * ((size_t) stage1_num_groups_29283 *
                     (size_t) segscan_group_sizze_28431) != 0) {
                const size_t global_work_sizze_29920[1] =
                             {(size_t) stage1_num_groups_29283 *
                             (size_t) segscan_group_sizze_28431};
                const size_t local_work_sizze_29924[1] =
                             {segscan_group_sizze_28431};
                int64_t time_start_29921 = 0, time_end_29922 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage1_28436");
                    fprintf(stderr, "%zu", global_work_sizze_29920[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29924[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_28431) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          segscan_group_sizze_28431)));
                    time_start_29921 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage1_28436,
                                                                1, NULL,
                                                                global_work_sizze_29920,
                                                                local_work_sizze_29924,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage1_28436_runs,
                                                                                                          &ctx->testziscan_stage1_28436_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29922 = get_wall_time();
                    
                    long time_diff_29923 = time_end_29922 - time_start_29921;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage1_28436", time_diff_29923);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_28431 *
                                     sdiv_up64(res_26316,
                                               sext_i32_i64(num_threads_29284))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28436,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_29283),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28436,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              stage1_num_groups_29283),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28436,
                                                    3, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28436,
                                                    4, sizeof(mem_28805.mem),
                                                    &mem_28805.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28436,
                                                    5, sizeof(mem_28807.mem),
                                                    &mem_28807.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28436,
                                                    6,
                                                    sizeof(stage1_num_groups_29283),
                                                    &stage1_num_groups_29283));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28436,
                                                    7,
                                                    sizeof(num_threads_29284),
                                                    &num_threads_29284));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_29283) != 0) {
                const size_t global_work_sizze_29925[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_29283};
                const size_t local_work_sizze_29929[1] =
                             {stage1_num_groups_29283};
                int64_t time_start_29926 = 0, time_end_29927 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage2_28436");
                    fprintf(stderr, "%zu", global_work_sizze_29925[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29929[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_29283) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          stage1_num_groups_29283)));
                    time_start_29926 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage2_28436,
                                                                1, NULL,
                                                                global_work_sizze_29925,
                                                                local_work_sizze_29929,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage2_28436_runs,
                                                                                                          &ctx->testziscan_stage2_28436_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29927 = get_wall_time();
                    
                    long time_diff_29928 = time_end_29927 - time_start_29926;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage2_28436", time_diff_29928);
                }
            }
            
            int32_t required_groups_29336;
            
            required_groups_29336 = sext_i64_i32(sdiv_up64(res_26316,
                                                           segscan_group_sizze_28431));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28436,
                                                    1, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28436,
                                                    2, sizeof(num_groups_28433),
                                                    &num_groups_28433));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28436,
                                                    3, sizeof(mem_28805.mem),
                                                    &mem_28805.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28436,
                                                    4, sizeof(mem_28807.mem),
                                                    &mem_28807.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28436,
                                                    5,
                                                    sizeof(num_threads_29284),
                                                    &num_threads_29284));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28436,
                                                    6,
                                                    sizeof(required_groups_29336),
                                                    &required_groups_29336));
            if (1 * ((size_t) num_groups_28433 *
                     (size_t) segscan_group_sizze_28431) != 0) {
                const size_t global_work_sizze_29930[1] =
                             {(size_t) num_groups_28433 *
                             (size_t) segscan_group_sizze_28431};
                const size_t local_work_sizze_29934[1] =
                             {segscan_group_sizze_28431};
                int64_t time_start_29931 = 0, time_end_29932 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage3_28436");
                    fprintf(stderr, "%zu", global_work_sizze_29930[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29934[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_29931 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage3_28436,
                                                                1, NULL,
                                                                global_work_sizze_29930,
                                                                local_work_sizze_29934,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage3_28436_runs,
                                                                                                          &ctx->testziscan_stage3_28436_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29932 = get_wall_time();
                    
                    long time_diff_29933 = time_end_29932 - time_start_29931;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage3_28436", time_diff_29933);
                }
            }
        }
        if (memblock_unref_device(ctx, &mem_28805, "mem_28805") != 0)
            return 1;
        
        int64_t num_groups_28441;
        int32_t max_num_groups_29348;
        
        max_num_groups_29348 = ctx->sizes.testzisegscan_num_groups_28440;
        num_groups_28441 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_26316,
                                                                   sext_i32_i64(segscan_group_sizze_28439)),
                                                         sext_i32_i64(max_num_groups_29348))));
        
        struct memblock_device mem_28812;
        
        mem_28812.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28812, res_26316, "mem_28812")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t bytes_28813 = 4 * res_26316;
        struct memblock_device mem_28814;
        
        mem_28814.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28814, bytes_28813, "mem_28814")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, res_26316)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_29349;
            
            stage1_max_num_groups_29349 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_29350;
            
            stage1_num_groups_29350 = smin64(stage1_max_num_groups_29349,
                                             num_groups_28441);
            
            int32_t num_threads_29351;
            
            num_threads_29351 = sext_i64_i32(stage1_num_groups_29350 *
                segscan_group_sizze_28439);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    1,
                                                    sizeof(ctx->failure_is_an_option),
                                                    &ctx->failure_is_an_option));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    3, smax64(1,
                                                              (int32_t) sizeof(float) *
                                                              segscan_group_sizze_28439),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    4, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              segscan_group_sizze_28439),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    5, sizeof(paths_26128),
                                                    &paths_26128));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    6, sizeof(flat_dim_26283),
                                                    &flat_dim_26283));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    7, sizeof(res_26296),
                                                    &res_26296));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    8, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    9, sizeof(i_28321),
                                                    &i_28321));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    10,
                                                    sizeof(res_mem_28755.mem),
                                                    &res_mem_28755.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    11,
                                                    sizeof(res_mem_28756.mem),
                                                    &res_mem_28756.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    12,
                                                    sizeof(res_mem_28757.mem),
                                                    &res_mem_28757.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    13,
                                                    sizeof(res_mem_28758.mem),
                                                    &res_mem_28758.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    14, sizeof(mem_28786.mem),
                                                    &mem_28786.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    15, sizeof(mem_28802.mem),
                                                    &mem_28802.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    16, sizeof(mem_28807.mem),
                                                    &mem_28807.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    17, sizeof(mem_28809.mem),
                                                    &mem_28809.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    18, sizeof(mem_28812.mem),
                                                    &mem_28812.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    19, sizeof(mem_28814.mem),
                                                    &mem_28814.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28444,
                                                    20,
                                                    sizeof(num_threads_29351),
                                                    &num_threads_29351));
            if (1 * ((size_t) stage1_num_groups_29350 *
                     (size_t) segscan_group_sizze_28439) != 0) {
                const size_t global_work_sizze_29935[1] =
                             {(size_t) stage1_num_groups_29350 *
                             (size_t) segscan_group_sizze_28439};
                const size_t local_work_sizze_29939[1] =
                             {segscan_group_sizze_28439};
                int64_t time_start_29936 = 0, time_end_29937 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage1_28444");
                    fprintf(stderr, "%zu", global_work_sizze_29935[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29939[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(float) *
                                              segscan_group_sizze_28439) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          segscan_group_sizze_28439)));
                    time_start_29936 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage1_28444,
                                                                1, NULL,
                                                                global_work_sizze_29935,
                                                                local_work_sizze_29939,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage1_28444_runs,
                                                                                                          &ctx->testziscan_stage1_28444_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29937 = get_wall_time();
                    
                    long time_diff_29938 = time_end_29937 - time_start_29936;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage1_28444", time_diff_29938);
                }
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_28439 *
                                     sdiv_up64(res_26316,
                                               sext_i32_i64(num_threads_29351))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28444,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(float) *
                                                              stage1_num_groups_29350),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28444,
                                                    2, smax64(1,
                                                              (int32_t) sizeof(bool) *
                                                              stage1_num_groups_29350),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28444,
                                                    3, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28444,
                                                    4, sizeof(mem_28812.mem),
                                                    &mem_28812.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28444,
                                                    5, sizeof(mem_28814.mem),
                                                    &mem_28814.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28444,
                                                    6,
                                                    sizeof(stage1_num_groups_29350),
                                                    &stage1_num_groups_29350));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28444,
                                                    7,
                                                    sizeof(num_threads_29351),
                                                    &num_threads_29351));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_29350) != 0) {
                const size_t global_work_sizze_29940[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_29350};
                const size_t local_work_sizze_29944[1] =
                             {stage1_num_groups_29350};
                int64_t time_start_29941 = 0, time_end_29942 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage2_28444");
                    fprintf(stderr, "%zu", global_work_sizze_29940[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29944[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(float) *
                                              stage1_num_groups_29350) +
                                   smax64(1, (int32_t) sizeof(bool) *
                                          stage1_num_groups_29350)));
                    time_start_29941 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage2_28444,
                                                                1, NULL,
                                                                global_work_sizze_29940,
                                                                local_work_sizze_29944,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage2_28444_runs,
                                                                                                          &ctx->testziscan_stage2_28444_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29942 = get_wall_time();
                    
                    long time_diff_29943 = time_end_29942 - time_start_29941;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage2_28444", time_diff_29943);
                }
            }
            
            int32_t required_groups_29403;
            
            required_groups_29403 = sext_i64_i32(sdiv_up64(res_26316,
                                                           segscan_group_sizze_28439));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28444,
                                                    1, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28444,
                                                    2, sizeof(num_groups_28441),
                                                    &num_groups_28441));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28444,
                                                    3, sizeof(mem_28812.mem),
                                                    &mem_28812.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28444,
                                                    4, sizeof(mem_28814.mem),
                                                    &mem_28814.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28444,
                                                    5,
                                                    sizeof(num_threads_29351),
                                                    &num_threads_29351));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28444,
                                                    6,
                                                    sizeof(required_groups_29403),
                                                    &required_groups_29403));
            if (1 * ((size_t) num_groups_28441 *
                     (size_t) segscan_group_sizze_28439) != 0) {
                const size_t global_work_sizze_29945[1] =
                             {(size_t) num_groups_28441 *
                             (size_t) segscan_group_sizze_28439};
                const size_t local_work_sizze_29949[1] =
                             {segscan_group_sizze_28439};
                int64_t time_start_29946 = 0, time_end_29947 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage3_28444");
                    fprintf(stderr, "%zu", global_work_sizze_29945[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29949[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_29946 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage3_28444,
                                                                1, NULL,
                                                                global_work_sizze_29945,
                                                                local_work_sizze_29949,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage3_28444_runs,
                                                                                                          &ctx->testziscan_stage3_28444_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29947 = get_wall_time();
                    
                    long time_diff_29948 = time_end_29947 - time_start_29946;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage3_28444", time_diff_29948);
                }
            }
        }
        if (memblock_unref_device(ctx, &mem_28802, "mem_28802") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28807, "mem_28807") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28812, "mem_28812") != 0)
            return 1;
        
        int64_t num_groups_28493;
        int32_t max_num_groups_29415;
        
        max_num_groups_29415 = ctx->sizes.testzisegscan_num_groups_28492;
        num_groups_28493 = sext_i64_i32(smax64(1, smin64(sdiv_up64(res_26316,
                                                                   sext_i32_i64(segscan_group_sizze_28491)),
                                                         sext_i32_i64(max_num_groups_29415))));
        
        struct memblock_device mem_28817;
        
        mem_28817.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28817, bytes_28795, "mem_28817")) {
            err = 1;
            goto cleanup;
        }
        if (slt64(0, res_26316)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int64_t stage1_max_num_groups_29416;
            
            stage1_max_num_groups_29416 = ctx->opencl.max_group_size;
            
            int64_t stage1_num_groups_29417;
            
            stage1_num_groups_29417 = smin64(stage1_max_num_groups_29416,
                                             num_groups_28493);
            
            int32_t num_threads_29418;
            
            num_threads_29418 = sext_i64_i32(stage1_num_groups_29417 *
                segscan_group_sizze_28491);
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28496,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              segscan_group_sizze_28491),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28496,
                                                    2, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28496,
                                                    3, sizeof(mem_28809.mem),
                                                    &mem_28809.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28496,
                                                    4, sizeof(mem_28817.mem),
                                                    &mem_28817.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage1_28496,
                                                    5,
                                                    sizeof(num_threads_29418),
                                                    &num_threads_29418));
            if (1 * ((size_t) stage1_num_groups_29417 *
                     (size_t) segscan_group_sizze_28491) != 0) {
                const size_t global_work_sizze_29950[1] =
                             {(size_t) stage1_num_groups_29417 *
                             (size_t) segscan_group_sizze_28491};
                const size_t local_work_sizze_29954[1] =
                             {segscan_group_sizze_28491};
                int64_t time_start_29951 = 0, time_end_29952 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage1_28496");
                    fprintf(stderr, "%zu", global_work_sizze_29950[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29954[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              segscan_group_sizze_28491)));
                    time_start_29951 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage1_28496,
                                                                1, NULL,
                                                                global_work_sizze_29950,
                                                                local_work_sizze_29954,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage1_28496_runs,
                                                                                                          &ctx->testziscan_stage1_28496_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29952 = get_wall_time();
                    
                    long time_diff_29953 = time_end_29952 - time_start_29951;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage1_28496", time_diff_29953);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_28491 *
                                     sdiv_up64(res_26316,
                                               sext_i32_i64(num_threads_29418))),
                        '\n');
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28496,
                                                    1, smax64(1,
                                                              (int32_t) sizeof(int64_t) *
                                                              stage1_num_groups_29417),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28496,
                                                    2, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28496,
                                                    3, sizeof(mem_28817.mem),
                                                    &mem_28817.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28496,
                                                    4,
                                                    sizeof(stage1_num_groups_29417),
                                                    &stage1_num_groups_29417));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage2_28496,
                                                    5,
                                                    sizeof(num_threads_29418),
                                                    &num_threads_29418));
            if (1 * ((size_t) 1 * (size_t) stage1_num_groups_29417) != 0) {
                const size_t global_work_sizze_29955[1] = {(size_t) 1 *
                             (size_t) stage1_num_groups_29417};
                const size_t local_work_sizze_29959[1] =
                             {stage1_num_groups_29417};
                int64_t time_start_29956 = 0, time_end_29957 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage2_28496");
                    fprintf(stderr, "%zu", global_work_sizze_29955[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29959[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + smax64(1, (int32_t) sizeof(int64_t) *
                                              stage1_num_groups_29417)));
                    time_start_29956 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage2_28496,
                                                                1, NULL,
                                                                global_work_sizze_29955,
                                                                local_work_sizze_29959,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage2_28496_runs,
                                                                                                          &ctx->testziscan_stage2_28496_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29957 = get_wall_time();
                    
                    long time_diff_29958 = time_end_29957 - time_start_29956;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage2_28496", time_diff_29958);
                }
            }
            
            int32_t required_groups_29454;
            
            required_groups_29454 = sext_i64_i32(sdiv_up64(res_26316,
                                                           segscan_group_sizze_28491));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28496,
                                                    1, sizeof(res_26316),
                                                    &res_26316));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28496,
                                                    2, sizeof(num_groups_28493),
                                                    &num_groups_28493));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28496,
                                                    3, sizeof(mem_28817.mem),
                                                    &mem_28817.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28496,
                                                    4,
                                                    sizeof(num_threads_29418),
                                                    &num_threads_29418));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testziscan_stage3_28496,
                                                    5,
                                                    sizeof(required_groups_29454),
                                                    &required_groups_29454));
            if (1 * ((size_t) num_groups_28493 *
                     (size_t) segscan_group_sizze_28491) != 0) {
                const size_t global_work_sizze_29960[1] =
                             {(size_t) num_groups_28493 *
                             (size_t) segscan_group_sizze_28491};
                const size_t local_work_sizze_29964[1] =
                             {segscan_group_sizze_28491};
                int64_t time_start_29961 = 0, time_end_29962 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.scan_stage3_28496");
                    fprintf(stderr, "%zu", global_work_sizze_29960[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29964[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) 0);
                    time_start_29961 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testziscan_stage3_28496,
                                                                1, NULL,
                                                                global_work_sizze_29960,
                                                                local_work_sizze_29964,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testziscan_stage3_28496_runs,
                                                                                                          &ctx->testziscan_stage3_28496_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29962 = get_wall_time();
                    
                    long time_diff_29963 = time_end_29962 - time_start_29961;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.scan_stage3_28496", time_diff_29963);
                }
            }
        }
        
        bool cond_26503 = slt64(0, res_26316);
        int64_t num_segments_26504;
        
        if (cond_26503) {
            int64_t i_26505 = sub64(res_26316, 1);
            bool x_26506 = sle64(0, i_26505);
            bool y_26507 = slt64(i_26505, res_26316);
            bool bounds_check_26508 = x_26506 && y_26507;
            bool index_certs_26509;
            
            if (!bounds_check_26508) {
                ctx->error =
                    msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s",
                              "Index [", i_26505,
                              "] out of bounds for array of shape [", res_26316,
                              "].",
                              "-> #0  /prelude/array.fut:18:29-34\n   #1  lib/github.com/diku-dk/segmented/segmented.fut:29:36-59\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:91:6-36\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #4  cva.fut:133:38-97\n   #5  /prelude/soacs.fut:56:19-23\n   #6  /prelude/soacs.fut:56:3-37\n   #7  cva.fut:126:44-136:50\n   #8  cva.fut:154:3-156:129\n   #9  cva.fut:153:1-156:137\n");
                if (memblock_unref_device(ctx, &mem_28817, "mem_28817") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28814, "mem_28814") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28812, "mem_28812") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28809, "mem_28809") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28807, "mem_28807") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28805, "mem_28805") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28802, "mem_28802") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_subhistos_mem_29068,
                                          "res_subhistos_mem_29068") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28796, "mem_28796") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &group_res_arr_mem_29030,
                                          "group_res_arr_mem_29030") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28794, "mem_28794") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28791, "mem_28791") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28789, "mem_28789") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28771, "mem_28771") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28786, "mem_28786") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28761, "mem_28761") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_mem_28758,
                                          "res_mem_28758") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_mem_28757,
                                          "res_mem_28757") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_mem_28756,
                                          "res_mem_28756") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_mem_28755,
                                          "res_mem_28755") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &group_res_arr_mem_28908,
                                          "group_res_arr_mem_28908") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28736, "mem_28736") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28731, "mem_28731") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28729, "mem_28729") != 0)
                    return 1;
                return 1;
            }
            
            int64_t read_res_29965;
            
            OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                         mem_28817.mem,
                                                         ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                         i_26505 *
                                                         sizeof(int64_t),
                                                         sizeof(int64_t),
                                                         &read_res_29965, 0,
                                                         NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_scalar_from_dev_runs,
                                                                                                   &ctx->copy_scalar_from_dev_total_runtime)));
            if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
                return 1;
            
            int64_t res_26510 = read_res_29965;
            
            num_segments_26504 = res_26510;
        } else {
            num_segments_26504 = 0;
        }
        
        bool bounds_invalid_upwards_26511 = slt64(num_segments_26504, 0);
        bool valid_26512 = !bounds_invalid_upwards_26511;
        bool range_valid_c_26513;
        
        if (!valid_26512) {
            ctx->error =
                msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s",
                          "Range ", 0, "..", 1, "..<", num_segments_26504,
                          " is invalid.",
                          "-> #0  /prelude/array.fut:60:3-10\n   #1  /prelude/array.fut:70:18-23\n   #2  lib/github.com/diku-dk/segmented/segmented.fut:33:17-41\n   #3  lib/github.com/diku-dk/segmented/segmented.fut:91:6-36\n   #4  lib/github.com/diku-dk/segmented/segmented.fut:103:6-37\n   #5  cva.fut:133:38-97\n   #6  /prelude/soacs.fut:56:19-23\n   #7  /prelude/soacs.fut:56:3-37\n   #8  cva.fut:126:44-136:50\n   #9  cva.fut:154:3-156:129\n   #10 cva.fut:153:1-156:137\n");
            if (memblock_unref_device(ctx, &mem_28817, "mem_28817") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28814, "mem_28814") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28812, "mem_28812") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28809, "mem_28809") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28807, "mem_28807") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28805, "mem_28805") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28802, "mem_28802") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_subhistos_mem_29068,
                                      "res_subhistos_mem_29068") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28796, "mem_28796") != 0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_29030,
                                      "group_res_arr_mem_29030") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28794, "mem_28794") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28791, "mem_28791") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28789, "mem_28789") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28771, "mem_28771") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28786, "mem_28786") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28761, "mem_28761") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28758, "res_mem_28758") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28757, "res_mem_28757") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28756, "res_mem_28756") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_28908,
                                      "group_res_arr_mem_28908") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28736, "mem_28736") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28731, "mem_28731") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28729, "mem_28729") != 0)
                return 1;
            return 1;
        }
        
        int64_t bytes_28818 = 4 * num_segments_26504;
        struct memblock_device mem_28819;
        
        mem_28819.references = NULL;
        if (memblock_alloc_device(ctx, &mem_28819, bytes_28818, "mem_28819")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f32(ctx, mem_28819, num_segments_26504,
                                          0.0F) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t segmap_group_sizze_28501;
        
        segmap_group_sizze_28501 = ctx->sizes.testzisegmap_group_sizze_28500;
        
        int64_t segmap_usable_groups_28502 = sdiv_up64(res_26316,
                                                       segmap_group_sizze_28501);
        
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28498, 1,
                                                sizeof(res_26316), &res_26316));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28498, 2,
                                                sizeof(num_segments_26504),
                                                &num_segments_26504));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28498, 3,
                                                sizeof(mem_28809.mem),
                                                &mem_28809.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28498, 4,
                                                sizeof(mem_28814.mem),
                                                &mem_28814.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28498, 5,
                                                sizeof(mem_28817.mem),
                                                &mem_28817.mem));
        OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28498, 6,
                                                sizeof(mem_28819.mem),
                                                &mem_28819.mem));
        if (1 * ((size_t) segmap_usable_groups_28502 *
                 (size_t) segmap_group_sizze_28501) != 0) {
            const size_t global_work_sizze_29966[1] =
                         {(size_t) segmap_usable_groups_28502 *
                         (size_t) segmap_group_sizze_28501};
            const size_t local_work_sizze_29970[1] = {segmap_group_sizze_28501};
            int64_t time_start_29967 = 0, time_end_29968 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with global work size [",
                        "test.segmap_28498");
                fprintf(stderr, "%zu", global_work_sizze_29966[0]);
                fprintf(stderr, "] and local work size [");
                fprintf(stderr, "%zu", local_work_sizze_29970[0]);
                fprintf(stderr, "]; local memory parameters sum to %d bytes.\n",
                        (int) 0);
                time_start_29967 = get_wall_time();
            }
            OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                            ctx->testzisegmap_28498,
                                                            1, NULL,
                                                            global_work_sizze_29966,
                                                            local_work_sizze_29970,
                                                            0, NULL,
                                                            ctx->profiling_paused ||
                                                            !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                      &ctx->testzisegmap_28498_runs,
                                                                                                      &ctx->testzisegmap_28498_total_runtime)));
            if (ctx->debugging) {
                OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                time_end_29968 = get_wall_time();
                
                long time_diff_29969 = time_end_29968 - time_start_29967;
                
                fprintf(stderr, "kernel %s runtime: %ldus\n",
                        "test.segmap_28498", time_diff_29969);
            }
        }
        if (memblock_unref_device(ctx, &mem_28809, "mem_28809") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28814, "mem_28814") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28817, "mem_28817") != 0)
            return 1;
        
        bool dim_match_26521 = flat_dim_26283 == num_segments_26504;
        bool empty_or_match_cert_26522;
        
        if (!dim_match_26521) {
            ctx->error = msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s",
                                   "Value of (core language) shape (",
                                   num_segments_26504,
                                   ") cannot match shape of type `[",
                                   flat_dim_26283, "]b`.",
                                   "-> #0  lib/github.com/diku-dk/segmented/segmented.fut:103:6-45\n   #1  cva.fut:133:38-97\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  cva.fut:126:44-136:50\n   #5  cva.fut:154:3-156:129\n   #6  cva.fut:153:1-156:137\n");
            if (memblock_unref_device(ctx, &mem_28819, "mem_28819") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28817, "mem_28817") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28814, "mem_28814") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28812, "mem_28812") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28809, "mem_28809") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28807, "mem_28807") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28805, "mem_28805") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28802, "mem_28802") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_subhistos_mem_29068,
                                      "res_subhistos_mem_29068") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28796, "mem_28796") != 0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_29030,
                                      "group_res_arr_mem_29030") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28794, "mem_28794") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28791, "mem_28791") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28789, "mem_28789") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28771, "mem_28771") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28786, "mem_28786") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28761, "mem_28761") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28758, "res_mem_28758") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28757, "res_mem_28757") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28756, "res_mem_28756") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &group_res_arr_mem_28908,
                                      "group_res_arr_mem_28908") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28736, "mem_28736") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28731, "mem_28731") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28729, "mem_28729") != 0)
                return 1;
            return 1;
        }
        
        float res_26524;
        int32_t local_memory_capacity_29613;
        
        local_memory_capacity_29613 = ctx->opencl.max_local_memory;
        if (sle64((int32_t) sizeof(bool) + (int32_t) sizeof(float) *
                  segred_group_sizze_28516,
                  sext_i32_i64(local_memory_capacity_29613)) &&
            suff_outer_redomap_28504) {
            struct memblock_device mem_28823;
            
            mem_28823.references = NULL;
            if (memblock_alloc_device(ctx, &mem_28823, bytes_28821,
                                      "mem_28823")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_28823, 0,
                                                      mem_28819, 0, 1, 45,
                                                      paths_26128) != 0) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_28826;
            
            mem_28826.references = NULL;
            if (memblock_alloc_device(ctx, &mem_28826, 4, "mem_28826")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device testzicounter_mem_29480 =
                                   ctx->testzicounter_mem_29480;
            struct memblock_device group_res_arr_mem_29482;
            
            group_res_arr_mem_29482.references = NULL;
            if (memblock_alloc_device(ctx, &group_res_arr_mem_29482,
                                      (int32_t) sizeof(float) *
                                      (segred_group_sizze_28516 *
                                       num_groups_28517),
                                      "group_res_arr_mem_29482")) {
                err = 1;
                goto cleanup;
            }
            
            int64_t num_threads_29484;
            
            num_threads_29484 = num_groups_28517 * segred_group_sizze_28516;
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegRed");
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28514,
                                                    1, (int32_t) sizeof(float) *
                                                    segred_group_sizze_28516,
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28514,
                                                    2, (int32_t) sizeof(bool),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28514,
                                                    3, sizeof(paths_26128),
                                                    &paths_26128));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28514,
                                                    4, sizeof(num_groups_28517),
                                                    &num_groups_28517));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28514,
                                                    5, sizeof(mem_28823.mem),
                                                    &mem_28823.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28514,
                                                    6, sizeof(mem_28826.mem),
                                                    &mem_28826.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28514,
                                                    7,
                                                    sizeof(testzicounter_mem_29480.mem),
                                                    &testzicounter_mem_29480.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28514,
                                                    8,
                                                    sizeof(group_res_arr_mem_29482.mem),
                                                    &group_res_arr_mem_29482.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28514,
                                                    9,
                                                    sizeof(num_threads_29484),
                                                    &num_threads_29484));
            if (1 * ((size_t) num_groups_28517 *
                     (size_t) segred_group_sizze_28516) != 0) {
                const size_t global_work_sizze_29972[1] =
                             {(size_t) num_groups_28517 *
                             (size_t) segred_group_sizze_28516};
                const size_t local_work_sizze_29976[1] =
                             {segred_group_sizze_28516};
                int64_t time_start_29973 = 0, time_end_29974 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.segred_nonseg_28514");
                    fprintf(stderr, "%zu", global_work_sizze_29972[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_29976[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + (int32_t) sizeof(float) *
                                   segred_group_sizze_28516 +
                                   (int32_t) sizeof(bool)));
                    time_start_29973 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testzisegred_nonseg_28514,
                                                                1, NULL,
                                                                global_work_sizze_29972,
                                                                local_work_sizze_29976,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testzisegred_nonseg_28514_runs,
                                                                                                          &ctx->testzisegred_nonseg_28514_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_29974 = get_wall_time();
                    
                    long time_diff_29975 = time_end_29974 - time_start_29973;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.segred_nonseg_28514", time_diff_29975);
                }
            }
            if (memblock_unref_device(ctx, &mem_28823, "mem_28823") != 0)
                return 1;
            
            float read_res_29977;
            
            OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                         mem_28826.mem,
                                                         ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                         0 * sizeof(float),
                                                         sizeof(float),
                                                         &read_res_29977, 0,
                                                         NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_scalar_from_dev_runs,
                                                                                                   &ctx->copy_scalar_from_dev_total_runtime)));
            if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
                return 1;
            
            float res_28530 = read_res_29977;
            
            if (memblock_unref_device(ctx, &mem_28826, "mem_28826") != 0)
                return 1;
            res_26524 = res_28530;
            if (memblock_unref_device(ctx, &group_res_arr_mem_29482,
                                      "group_res_arr_mem_29482") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28826, "mem_28826") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28823, "mem_28823") != 0)
                return 1;
        } else {
            struct memblock_device res_map_acc_mem_28839;
            
            res_map_acc_mem_28839.references = NULL;
            
            int32_t local_memory_capacity_29582;
            
            local_memory_capacity_29582 = ctx->opencl.max_local_memory;
            if (sle64(0, sext_i32_i64(local_memory_capacity_29582)) &&
                suff_outer_par_28612) {
                struct memblock_device mem_28829;
                
                mem_28829.references = NULL;
                if (memblock_alloc_device(ctx, &mem_28829, bytes_28821,
                                          "mem_28829")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_28829, 0,
                                                          mem_28819, 0, 1, 45,
                                                          paths_26128) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_28832;
                
                mem_28832.references = NULL;
                if (memblock_alloc_device(ctx, &mem_28832, bytes_28760,
                                          "mem_28832")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28536,
                                                        1, sizeof(paths_26128),
                                                        &paths_26128));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28536,
                                                        2,
                                                        sizeof(mem_28829.mem),
                                                        &mem_28829.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28536,
                                                        3,
                                                        sizeof(mem_28832.mem),
                                                        &mem_28832.mem));
                if (1 * ((size_t) segmap_usable_groups_28616 *
                         (size_t) segmap_group_sizze_28615) != 0) {
                    const size_t global_work_sizze_29978[1] =
                                 {(size_t) segmap_usable_groups_28616 *
                                 (size_t) segmap_group_sizze_28615};
                    const size_t local_work_sizze_29982[1] =
                                 {segmap_group_sizze_28615};
                    int64_t time_start_29979 = 0, time_end_29980 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "test.segmap_28536");
                        fprintf(stderr, "%zu", global_work_sizze_29978[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_29982[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) 0);
                        time_start_29979 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->testzisegmap_28536,
                                                                    1, NULL,
                                                                    global_work_sizze_29978,
                                                                    local_work_sizze_29982,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->testzisegmap_28536_runs,
                                                                                                              &ctx->testzisegmap_28536_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_29980 = get_wall_time();
                        
                        long time_diff_29981 = time_end_29980 -
                             time_start_29979;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "test.segmap_28536", time_diff_29981);
                    }
                }
                if (memblock_unref_device(ctx, &mem_28829, "mem_28829") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_map_acc_mem_28839, &mem_28832,
                                        "mem_28832") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28832, "mem_28832") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28829, "mem_28829") != 0)
                    return 1;
            } else {
                struct memblock_device mem_28835;
                
                mem_28835.references = NULL;
                if (memblock_alloc_device(ctx, &mem_28835, bytes_28760,
                                          "mem_28835")) {
                    err = 1;
                    goto cleanup;
                }
                if (slt64(90, segred_group_sizze_28627)) {
                    int64_t segment_sizze_nonzzero_29517 = 45;
                    int64_t num_threads_29518 = num_groups_28628 *
                            segred_group_sizze_28627;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-small");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) paths_26128, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) 45, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segments_per_group",
                                (long long) squot64(segred_group_sizze_28627,
                                                    segment_sizze_nonzzero_29517),
                                '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "required_groups",
                                (long long) sext_i64_i32(sdiv_up64(paths_26128,
                                                                   squot64(segred_group_sizze_28627,
                                                                           segment_sizze_nonzzero_29517))),
                                '\n');
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_28577,
                                                            1,
                                                            (int32_t) sizeof(float) *
                                                            segred_group_sizze_28627,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_28577,
                                                            2,
                                                            sizeof(paths_26128),
                                                            &paths_26128));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_28577,
                                                            3,
                                                            sizeof(num_groups_28628),
                                                            &num_groups_28628));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_28577,
                                                            4,
                                                            sizeof(mem_28819.mem),
                                                            &mem_28819.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_28577,
                                                            5,
                                                            sizeof(mem_28835.mem),
                                                            &mem_28835.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_small_28577,
                                                            6,
                                                            sizeof(segment_sizze_nonzzero_29517),
                                                            &segment_sizze_nonzzero_29517));
                    if (1 * ((size_t) num_groups_28628 *
                             (size_t) segred_group_sizze_28627) != 0) {
                        const size_t global_work_sizze_29983[1] =
                                     {(size_t) num_groups_28628 *
                                     (size_t) segred_group_sizze_28627};
                        const size_t local_work_sizze_29987[1] =
                                     {segred_group_sizze_28627};
                        int64_t time_start_29984 = 0, time_end_29985 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "test.segred_small_28577");
                            fprintf(stderr, "%zu", global_work_sizze_29983[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29987[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(float) *
                                           segred_group_sizze_28627));
                            time_start_29984 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->testzisegred_small_28577,
                                                                        1, NULL,
                                                                        global_work_sizze_29983,
                                                                        local_work_sizze_29987,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->testzisegred_small_28577_runs,
                                                                                                                  &ctx->testzisegred_small_28577_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29985 = get_wall_time();
                            
                            long time_diff_29986 = time_end_29985 -
                                 time_start_29984;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "test.segred_small_28577", time_diff_29986);
                        }
                    }
                } else {
                    int64_t groups_per_segment_29538 =
                            sdiv_up64(num_groups_28628, smax64(1, paths_26128));
                    int64_t elements_per_thread_29539 = sdiv_up64(45,
                                                                  segred_group_sizze_28627 *
                                                                  groups_per_segment_29538);
                    int64_t virt_num_groups_29540 = groups_per_segment_29538 *
                            paths_26128;
                    int64_t num_threads_29541 = num_groups_28628 *
                            segred_group_sizze_28627;
                    int64_t threads_per_segment_29542 =
                            groups_per_segment_29538 * segred_group_sizze_28627;
                    
                    if (ctx->debugging)
                        fprintf(stderr, "%s\n", "\n# SegRed-large");
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_segments",
                                (long long) paths_26128, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "segment_size",
                                (long long) 45, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                                (long long) virt_num_groups_29540, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "num_groups",
                                (long long) num_groups_28628, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "group_size",
                                (long long) segred_group_sizze_28627, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                                (long long) elements_per_thread_29539, '\n');
                    if (ctx->debugging)
                        fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                                (long long) groups_per_segment_29538, '\n');
                    
                    struct memblock_device group_res_arr_mem_29543;
                    
                    group_res_arr_mem_29543.references = NULL;
                    if (memblock_alloc_device(ctx, &group_res_arr_mem_29543,
                                              (int32_t) sizeof(float) *
                                              (segred_group_sizze_28627 *
                                               virt_num_groups_29540),
                                              "group_res_arr_mem_29543")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    struct memblock_device testzicounter_mem_29545 =
                                           ctx->testzicounter_mem_29545;
                    
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            1,
                                                            (int32_t) sizeof(bool),
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            2,
                                                            (int32_t) sizeof(float) *
                                                            segred_group_sizze_28627,
                                                            NULL));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            3,
                                                            sizeof(num_groups_28628),
                                                            &num_groups_28628));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            4,
                                                            sizeof(mem_28819.mem),
                                                            &mem_28819.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            5,
                                                            sizeof(mem_28835.mem),
                                                            &mem_28835.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            6,
                                                            sizeof(groups_per_segment_29538),
                                                            &groups_per_segment_29538));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            7,
                                                            sizeof(elements_per_thread_29539),
                                                            &elements_per_thread_29539));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            8,
                                                            sizeof(virt_num_groups_29540),
                                                            &virt_num_groups_29540));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            9,
                                                            sizeof(threads_per_segment_29542),
                                                            &threads_per_segment_29542));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            10,
                                                            sizeof(group_res_arr_mem_29543.mem),
                                                            &group_res_arr_mem_29543.mem));
                    OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_large_28577,
                                                            11,
                                                            sizeof(testzicounter_mem_29545.mem),
                                                            &testzicounter_mem_29545.mem));
                    if (1 * ((size_t) num_groups_28628 *
                             (size_t) segred_group_sizze_28627) != 0) {
                        const size_t global_work_sizze_29989[1] =
                                     {(size_t) num_groups_28628 *
                                     (size_t) segred_group_sizze_28627};
                        const size_t local_work_sizze_29993[1] =
                                     {segred_group_sizze_28627};
                        int64_t time_start_29990 = 0, time_end_29991 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr,
                                    "Launching %s with global work size [",
                                    "test.segred_large_28577");
                            fprintf(stderr, "%zu", global_work_sizze_29989[0]);
                            fprintf(stderr, "] and local work size [");
                            fprintf(stderr, "%zu", local_work_sizze_29993[0]);
                            fprintf(stderr,
                                    "]; local memory parameters sum to %d bytes.\n",
                                    (int) (0 + (int32_t) sizeof(bool) +
                                           (int32_t) sizeof(float) *
                                           segred_group_sizze_28627));
                            time_start_29990 = get_wall_time();
                        }
                        OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                        ctx->testzisegred_large_28577,
                                                                        1, NULL,
                                                                        global_work_sizze_29989,
                                                                        local_work_sizze_29993,
                                                                        0, NULL,
                                                                        ctx->profiling_paused ||
                                                                        !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                                  &ctx->testzisegred_large_28577_runs,
                                                                                                                  &ctx->testzisegred_large_28577_total_runtime)));
                        if (ctx->debugging) {
                            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                            time_end_29991 = get_wall_time();
                            
                            long time_diff_29992 = time_end_29991 -
                                 time_start_29990;
                            
                            fprintf(stderr, "kernel %s runtime: %ldus\n",
                                    "test.segred_large_28577", time_diff_29992);
                        }
                    }
                    if (memblock_unref_device(ctx, &group_res_arr_mem_29543,
                                              "group_res_arr_mem_29543") != 0)
                        return 1;
                }
                
                struct memblock_device mem_28838;
                
                mem_28838.references = NULL;
                if (memblock_alloc_device(ctx, &mem_28838, bytes_28760,
                                          "mem_28838")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28561,
                                                        1, sizeof(paths_26128),
                                                        &paths_26128));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28561,
                                                        2,
                                                        sizeof(mem_28835.mem),
                                                        &mem_28835.mem));
                OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegmap_28561,
                                                        3,
                                                        sizeof(mem_28838.mem),
                                                        &mem_28838.mem));
                if (1 * ((size_t) segmap_usable_groups_28638 *
                         (size_t) segmap_group_sizze_28637) != 0) {
                    const size_t global_work_sizze_29994[1] =
                                 {(size_t) segmap_usable_groups_28638 *
                                 (size_t) segmap_group_sizze_28637};
                    const size_t local_work_sizze_29998[1] =
                                 {segmap_group_sizze_28637};
                    int64_t time_start_29995 = 0, time_end_29996 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with global work size [",
                                "test.segmap_28561");
                        fprintf(stderr, "%zu", global_work_sizze_29994[0]);
                        fprintf(stderr, "] and local work size [");
                        fprintf(stderr, "%zu", local_work_sizze_29998[0]);
                        fprintf(stderr,
                                "]; local memory parameters sum to %d bytes.\n",
                                (int) 0);
                        time_start_29995 = get_wall_time();
                    }
                    OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                    ctx->testzisegmap_28561,
                                                                    1, NULL,
                                                                    global_work_sizze_29994,
                                                                    local_work_sizze_29998,
                                                                    0, NULL,
                                                                    ctx->profiling_paused ||
                                                                    !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                              &ctx->testzisegmap_28561_runs,
                                                                                                              &ctx->testzisegmap_28561_total_runtime)));
                    if (ctx->debugging) {
                        OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                        time_end_29996 = get_wall_time();
                        
                        long time_diff_29997 = time_end_29996 -
                             time_start_29995;
                        
                        fprintf(stderr, "kernel %s runtime: %ldus\n",
                                "test.segmap_28561", time_diff_29997);
                    }
                }
                if (memblock_unref_device(ctx, &mem_28835, "mem_28835") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_map_acc_mem_28839, &mem_28838,
                                        "mem_28838") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28838, "mem_28838") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_28835, "mem_28835") != 0)
                    return 1;
            }
            
            struct memblock_device mem_28842;
            
            mem_28842.references = NULL;
            if (memblock_alloc_device(ctx, &mem_28842, 4, "mem_28842")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device testzicounter_mem_29583 =
                                   ctx->testzicounter_mem_29583;
            struct memblock_device group_res_arr_mem_29585;
            
            group_res_arr_mem_29585.references = NULL;
            if (memblock_alloc_device(ctx, &group_res_arr_mem_29585,
                                      (int32_t) sizeof(float) *
                                      (segred_group_sizze_28644 *
                                       num_groups_28645),
                                      "group_res_arr_mem_29585")) {
                err = 1;
                goto cleanup;
            }
            
            int64_t num_threads_29587;
            
            num_threads_29587 = num_groups_28645 * segred_group_sizze_28644;
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegRed");
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28610,
                                                    1, (int32_t) sizeof(float) *
                                                    segred_group_sizze_28644,
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28610,
                                                    2, (int32_t) sizeof(bool),
                                                    NULL));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28610,
                                                    3, sizeof(paths_26128),
                                                    &paths_26128));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28610,
                                                    4, sizeof(num_groups_28645),
                                                    &num_groups_28645));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28610,
                                                    5,
                                                    sizeof(res_map_acc_mem_28839.mem),
                                                    &res_map_acc_mem_28839.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28610,
                                                    6, sizeof(mem_28842.mem),
                                                    &mem_28842.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28610,
                                                    7,
                                                    sizeof(testzicounter_mem_29583.mem),
                                                    &testzicounter_mem_29583.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28610,
                                                    8,
                                                    sizeof(group_res_arr_mem_29585.mem),
                                                    &group_res_arr_mem_29585.mem));
            OPENCL_SUCCEED_OR_RETURN(clSetKernelArg(ctx->testzisegred_nonseg_28610,
                                                    9,
                                                    sizeof(num_threads_29587),
                                                    &num_threads_29587));
            if (1 * ((size_t) num_groups_28645 *
                     (size_t) segred_group_sizze_28644) != 0) {
                const size_t global_work_sizze_30000[1] =
                             {(size_t) num_groups_28645 *
                             (size_t) segred_group_sizze_28644};
                const size_t local_work_sizze_30004[1] =
                             {segred_group_sizze_28644};
                int64_t time_start_30001 = 0, time_end_30002 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with global work size [",
                            "test.segred_nonseg_28610");
                    fprintf(stderr, "%zu", global_work_sizze_30000[0]);
                    fprintf(stderr, "] and local work size [");
                    fprintf(stderr, "%zu", local_work_sizze_30004[0]);
                    fprintf(stderr,
                            "]; local memory parameters sum to %d bytes.\n",
                            (int) (0 + (int32_t) sizeof(float) *
                                   segred_group_sizze_28644 +
                                   (int32_t) sizeof(bool)));
                    time_start_30001 = get_wall_time();
                }
                OPENCL_SUCCEED_OR_RETURN(clEnqueueNDRangeKernel(ctx->opencl.queue,
                                                                ctx->testzisegred_nonseg_28610,
                                                                1, NULL,
                                                                global_work_sizze_30000,
                                                                local_work_sizze_30004,
                                                                0, NULL,
                                                                ctx->profiling_paused ||
                                                                !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                          &ctx->testzisegred_nonseg_28610_runs,
                                                                                                          &ctx->testzisegred_nonseg_28610_total_runtime)));
                if (ctx->debugging) {
                    OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
                    time_end_30002 = get_wall_time();
                    
                    long time_diff_30003 = time_end_30002 - time_start_30001;
                    
                    fprintf(stderr, "kernel %s runtime: %ldus\n",
                            "test.segred_nonseg_28610", time_diff_30003);
                }
            }
            if (memblock_unref_device(ctx, &res_map_acc_mem_28839,
                                      "res_map_acc_mem_28839") != 0)
                return 1;
            
            float read_res_30005;
            
            OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                         mem_28842.mem,
                                                         ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                         0 * sizeof(float),
                                                         sizeof(float),
                                                         &read_res_30005, 0,
                                                         NULL,
                                                         ctx->profiling_paused ||
                                                         !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                   &ctx->copy_scalar_from_dev_runs,
                                                                                                   &ctx->copy_scalar_from_dev_total_runtime)));
            if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
                return 1;
            
            float res_28652 = read_res_30005;
            
            if (memblock_unref_device(ctx, &mem_28842, "mem_28842") != 0)
                return 1;
            res_26524 = res_28652;
            if (memblock_unref_device(ctx, &group_res_arr_mem_29585,
                                      "group_res_arr_mem_29585") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_28842, "mem_28842") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_map_acc_mem_28839,
                                      "res_map_acc_mem_28839") != 0)
                return 1;
        }
        if (memblock_unref_device(ctx, &mem_28819, "mem_28819") != 0)
            return 1;
        
        float res_26535 = res_26524 / res_26287;
        float negate_arg_26536 = 1.0e-2F * res_26296;
        float exp_arg_26537 = 0.0F - negate_arg_26536;
        float res_26538 = fpow32(2.7182817F, exp_arg_26537);
        float x_26539 = 1.0F - res_26538;
        float B_26540 = x_26539 / 1.0e-2F;
        float x_26541 = B_26540 - res_26296;
        float x_26542 = 4.4999997e-6F * x_26541;
        float A1_26543 = x_26542 / 1.0e-4F;
        float y_26544 = fpow32(B_26540, 2.0F);
        float x_26545 = 1.0000001e-6F * y_26544;
        float A2_26546 = x_26545 / 4.0e-2F;
        float exp_arg_26547 = A1_26543 - A2_26546;
        float res_26548 = fpow32(2.7182817F, exp_arg_26547);
        float negate_arg_26549 = 5.0e-2F * B_26540;
        float exp_arg_26550 = 0.0F - negate_arg_26549;
        float res_26551 = fpow32(2.7182817F, exp_arg_26550);
        float res_26552 = res_26548 * res_26551;
        float res_26553 = res_26535 * res_26552;
        float res_26292 = res_26553 + redout_28320;
        float redout_tmp_28977 = res_26292;
        
        redout_28320 = redout_tmp_28977;
        if (memblock_unref_device(ctx, &mem_28819, "mem_28819") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28817, "mem_28817") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28814, "mem_28814") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28812, "mem_28812") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28809, "mem_28809") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28807, "mem_28807") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28805, "mem_28805") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28802, "mem_28802") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28800, "mem_28800") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_subhistos_mem_29068,
                                  "res_subhistos_mem_29068") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_28796, "mem_28796") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_29030,
                                  "group_res_arr_mem_29030") != 0)
            return 1;
    }
    res_26289 = redout_28320;
    if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28756, "res_mem_28756") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28757, "res_mem_28757") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28758, "res_mem_28758") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28786, "mem_28786") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28789, "mem_28789") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28791, "mem_28791") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28794, "mem_28794") != 0)
        return 1;
    
    float CVA_26554 = 6.0e-3F * res_26289;
    
    scalar_out_28901 = CVA_26554;
    *out_scalar_out_29825 = scalar_out_28901;
    if (memblock_unref_device(ctx, &mem_28794, "mem_28794") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28791, "mem_28791") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28789, "mem_28789") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28771, "mem_28771") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28786, "mem_28786") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28768, "mem_28768") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28765, "mem_28765") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28761, "mem_28761") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28758, "res_mem_28758") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28757, "res_mem_28757") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28756, "res_mem_28756") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_28755, "res_mem_28755") != 0)
        return 1;
    if (memblock_unref_device(ctx, &group_res_arr_mem_28908,
                              "group_res_arr_mem_28908") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28736, "mem_28736") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28733, "mem_28733") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28731, "mem_28731") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_28729, "mem_28729") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
struct futhark_i64_1d {
    struct memblock_device mem;
    int64_t shape[1];
} ;
struct futhark_i64_1d *futhark_new_i64_1d(struct futhark_context *ctx, const
                                          int64_t *data, int64_t dim0)
{
    struct futhark_i64_1d *bad = NULL;
    struct futhark_i64_1d *arr =
                          (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(int64_t),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * sizeof(int64_t) > 0)
        OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                      arr->mem.mem, CL_TRUE, 0,
                                                      (size_t) dim0 *
                                                      sizeof(int64_t), data + 0,
                                                      0, NULL,
                                                      ctx->profiling_paused ||
                                                      !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                &ctx->copy_dev_to_host_runs,
                                                                                                &ctx->copy_dev_to_host_total_runtime)));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_i64_1d *futhark_new_raw_i64_1d(struct futhark_context *ctx, const
                                              cl_mem data, int offset,
                                              int64_t dim0)
{
    struct futhark_i64_1d *bad = NULL;
    struct futhark_i64_1d *arr =
                          (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(int64_t),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * sizeof(int64_t) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue, data,
                                                     arr->mem.mem, offset, 0,
                                                     (size_t) dim0 *
                                                     sizeof(int64_t), 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
        if (ctx->debugging)
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
    }
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr)
{
    lock_lock(&ctx->lock);
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_i64_1d(struct futhark_context *ctx,
                          struct futhark_i64_1d *arr, int64_t *data)
{
    lock_lock(&ctx->lock);
    if ((size_t) arr->shape[0] * sizeof(int64_t) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     arr->mem.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0, (size_t) arr->shape[0] *
                                                     sizeof(int64_t), data + 0,
                                                     0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_host_to_dev_runs,
                                                                                               &ctx->copy_host_to_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
    }
    lock_unlock(&ctx->lock);
    return 0;
}
cl_mem futhark_values_raw_i64_1d(struct futhark_context *ctx,
                                 struct futhark_i64_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_i64_1d(struct futhark_context *ctx,
                                    struct futhark_i64_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_f32_1d {
    struct memblock_device mem;
    int64_t shape[1];
} ;
struct futhark_f32_1d *futhark_new_f32_1d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0)
{
    struct futhark_f32_1d *bad = NULL;
    struct futhark_f32_1d *arr =
                          (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(float),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * sizeof(float) > 0)
        OPENCL_SUCCEED_OR_RETURN(clEnqueueWriteBuffer(ctx->opencl.queue,
                                                      arr->mem.mem, CL_TRUE, 0,
                                                      (size_t) dim0 *
                                                      sizeof(float), data + 0,
                                                      0, NULL,
                                                      ctx->profiling_paused ||
                                                      !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                                &ctx->copy_dev_to_host_runs,
                                                                                                &ctx->copy_dev_to_host_total_runtime)));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_f32_1d *futhark_new_raw_f32_1d(struct futhark_context *ctx, const
                                              cl_mem data, int offset,
                                              int64_t dim0)
{
    struct futhark_f32_1d *bad = NULL;
    struct futhark_f32_1d *arr =
                          (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(float),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * sizeof(float) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueCopyBuffer(ctx->opencl.queue, data,
                                                     arr->mem.mem, offset, 0,
                                                     (size_t) dim0 *
                                                     sizeof(float), 0, NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_dev_to_dev_runs,
                                                                                               &ctx->copy_dev_to_dev_total_runtime)));
        if (ctx->debugging)
            OPENCL_SUCCEED_FATAL(clFinish(ctx->opencl.queue));
    }
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f32_1d(struct futhark_context *ctx, struct futhark_f32_1d *arr)
{
    lock_lock(&ctx->lock);
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f32_1d(struct futhark_context *ctx,
                          struct futhark_f32_1d *arr, float *data)
{
    lock_lock(&ctx->lock);
    if ((size_t) arr->shape[0] * sizeof(float) > 0) {
        OPENCL_SUCCEED_OR_RETURN(clEnqueueReadBuffer(ctx->opencl.queue,
                                                     arr->mem.mem,
                                                     ctx->failure_is_an_option ? CL_FALSE : CL_TRUE,
                                                     0, (size_t) arr->shape[0] *
                                                     sizeof(float), data + 0, 0,
                                                     NULL,
                                                     ctx->profiling_paused ||
                                                     !ctx->profiling ? NULL : opencl_get_event(&ctx->opencl,
                                                                                               &ctx->copy_host_to_dev_runs,
                                                                                               &ctx->copy_host_to_dev_total_runtime)));
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0)
            return 1;
    }
    lock_unlock(&ctx->lock);
    return 0;
}
cl_mem futhark_values_raw_f32_1d(struct futhark_context *ctx,
                                 struct futhark_f32_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f32_1d(struct futhark_context *ctx,
                                    struct futhark_f32_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
int futhark_entry_main(struct futhark_context *ctx, float *out0,
                       struct futhark_f32_1d **out1, const int64_t in0, const
                       int64_t in1, const struct futhark_f32_1d *in2, const
                       struct futhark_i64_1d *in3, const
                       struct futhark_f32_1d *in4, const float in5, const
                       float in6, const float in7, const float in8)
{
    struct memblock_device swap_term_mem_28728;
    
    swap_term_mem_28728.references = NULL;
    
    struct memblock_device payments_mem_28729;
    
    payments_mem_28729.references = NULL;
    
    struct memblock_device notional_mem_28730;
    
    notional_mem_28730.references = NULL;
    
    int64_t n_25421;
    int64_t n_25422;
    int64_t n_25423;
    int64_t paths_25424;
    int64_t steps_25425;
    float a_25429;
    float b_25430;
    float sigma_25431;
    float r0_25432;
    float scalar_out_28901;
    struct memblock_device out_mem_28902;
    
    out_mem_28902.references = NULL;
    
    int64_t out_arrsizze_28903;
    
    lock_lock(&ctx->lock);
    paths_25424 = in0;
    steps_25425 = in1;
    swap_term_mem_28728 = in2->mem;
    n_25421 = in2->shape[0];
    payments_mem_28729 = in3->mem;
    n_25422 = in3->shape[0];
    notional_mem_28730 = in4->mem;
    n_25423 = in4->shape[0];
    a_25429 = in5;
    b_25430 = in6;
    sigma_25431 = in7;
    r0_25432 = in8;
    
    int ret = futrts_main(ctx, &scalar_out_28901, &out_mem_28902,
                          &out_arrsizze_28903, swap_term_mem_28728,
                          payments_mem_28729, notional_mem_28730, n_25421,
                          n_25422, n_25423, paths_25424, steps_25425, a_25429,
                          b_25430, sigma_25431, r0_25432);
    
    if (ret == 0) {
        *out0 = scalar_out_28901;
        assert((*out1 =
                (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d))) !=
            NULL);
        (*out1)->mem = out_mem_28902;
        (*out1)->shape[0] = out_arrsizze_28903;
    }
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_test(struct futhark_context *ctx, float *out0, const
                       int64_t in0, const int64_t in1)
{
    int64_t paths_26128;
    int64_t steps_26129;
    float scalar_out_28901;
    
    lock_lock(&ctx->lock);
    paths_26128 = in0;
    steps_26129 = in1;
    
    int ret = futrts_test(ctx, &scalar_out_28901, paths_26128, steps_26129);
    
    if (ret == 0) {
        *out0 = scalar_out_28901;
    }
    lock_unlock(&ctx->lock);
    return ret;
}
